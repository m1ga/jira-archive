---
title: "[AC-147] Clouds.Users.query's $nearSphere has reversed Lat/Long requirements"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2015-06-12T06:28:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>ArrowDB</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Keylo E.</td></tr>
<tr><th>Assignee</th><td>Radamantis Torres-Lechuga</td></tr>
<tr><th>Created</th><td>2015-06-02T02:35:29.000+0000</td></tr>
<tr><th>Updated</th><td>2015-06-12T06:28:37.000+0000</td></tr>
</table>

<h3>Description</h3>

Following <a href="http://docs.appcelerator.com/arrowdb/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/arrowdb/latest/#</a>!/guide/search_query for $nearSphere and $maxDistance, fails to find users coordinates 4 miles from current position at even greater maxDistances until reversing Long/Lat to Lat/Long. Since API calls return Users' Coordinates objects reversed from what is seen in ArrowDB's Dashboard I was unsure if this was a bug all around or a documentation issue.

<code><pre>
Titanium.Geolocation.getCurrentPosition(function(e)
	{
	    if (e.error) {
	        alert('cannot get your current location');
	        return;
	    }
		Cloud.Users.query({
			response_json_depth: 2,
		        page: 1,
		        per_page: 100,
		        where: { 
	    		"coordinates":{"$nearSphere":[Number(e.coords.longitude), Number(e.coords.latitude)], "$maxDistance" : 0.025}
	        } 
		}, function (e) {
		    if (e.success) {
		        alert('Success: ' + e.users.length);
		    } else {
		        alert('Error:\n' + ((e.error && e.message) || JSON.stringify(e)));
		    }
		});
	});
</pre></code>

<h3>Comments</h3>

<ol>
<li>Keylo E. 2015-06-11

   $nearSphere is working as it should be. 
   The confusion was from mistakes I'd made changing Lat/Lon in ArrowDB's Users coordinates, thinking I'd entered them incorrectly because the coordinates object returned by Cloud.users.query was reversed and had no (apparent) way to access individual lat or lon. My appologies.
   A means of accessing the returned event.users[0].custom_fields.coordinates.LATITUDE by name would help.
   
   ArrowDB's User Lat/Lon (correct/popular order)
   !<a href="http://ibin.co/24t0r8VU5rvI" rel="nofollow" target="_blank">http://ibin.co/24t0r8VU5rvI</a>!
   
   returned coordinates object using Cloud.Users.query method (reversed order)
   !<a href="http://ibin.co/24t1k5QjI8yc" rel="nofollow" target="_blank">http://ibin.co/24t1k5QjI8yc</a>!</li>
<li>Fokke Zandbergen 2015-06-12

   User error.</li>
</ol>


<p><a href="/AC/AC-147.json">JSON Source</a></p>