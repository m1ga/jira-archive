---
title: "[AC-200] iOS: Using buildin moment.js case uncaught exception"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2015-08-05T08:11:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ethan Chen</td></tr>
<tr><th>Assignee</th><td>Radamantis Torres-Lechuga</td></tr>
<tr><th>Created</th><td>2015-07-07T02:03:24.000+0000</td></tr>
<tr><th>Updated</th><td>2015-08-19T17:49:16.000+0000</td></tr>
</table>

<h3>Description</h3>

I'm using buildin moment.js with locale <code>zh-Hant</code>,
but I got a uncaught exception and exit the app automatically.
<code><pre>
/alloy/moment/lang/zh-Hant.js, Resource: alloy/moment/lang/zh-Hant_js
Uncaught exception: Couldn't find module: alloy/moment/lang/zh-Hant for architecture: i386
</pre></code>

Controller:
<code><pre>
var moment = require('alloy/moment');
console.log(moment.version)
</pre></code>

even though I use a <code>moment + locales.js</code> from [official site](<a href="http://momentjs.com/)" rel="nofollow" target="_blank">http://momentjs.com/)</a> and put the file moment.js on <code>lib</code>, same problem just happened:
<code><pre>
var moment = require('moment');
moment.locale('en-US');    // exception
moment.locale('en-us');    // exception
moment.locale('zh-TW');    // exception
moment.locale('zh-tw');    // exception
moment.locale('zh-CN');    // exception
moment.locale('zh-cn');    // exception
moment.locale('en');        // working fine
</pre></code>

<h3>Comments</h3>

<ol>
<li>Motiur Rahman 2015-07-07

   Hello,
   We did not reproduce this issue when we use Alloy.builtins.moment  we get this following 
   <code><pre>
   var moment = require('alloy/moment');
   console.log(moment.version)
   </pre></code>
   
   *Output*
   <code><pre>
   [INFO] :   2.7.0
   </pre></code>
   
   When we use moment + locales.js from [official site](<a href="http://momentjs.com/)" rel="nofollow" target="_blank">http://momentjs.com/)</a> and put the file on Assets folder and the result, is
   
   <code><pre>
   var moment = require('moment-with-locales');
   console.log(moment.locale('en-US'));   
   console.log(moment.locale('en-us'));    
   console.log(moment.locale('zh-TW'));    
   console.log(moment.locale('zh-tw'));    
   console.log(moment.locale('zh-CN'));   
   console.log(moment.locale('zh-cn'));    
   console.log(moment.locale('en'));     
   </pre></code>
   
   *Output*
   <code><pre>
   [INFO] :   en
   [INFO] :   en
   [INFO] :   zh-tw
   [INFO] :   zh-tw
   [INFO] :   zh-cn
   [INFO] :   zh-cn
   [INFO] :   en
   </pre></code>
   
   We did not get any exception.
   Thanks</li>
<li>Ethan Chen 2015-07-08

   In the [document](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/Alloy_Controllers) it says:
   {quote}
   Some JavaScript code might not be suitable as controller code, since it does not have an associated view, or you want to separate it from the MVC framework for easier reusability. Create a folder called <code>lib</code> in the <code>app</code> directory of your Alloy project. Add your CommonJS modules or JavaScript code using the CommonJS format into the lib folder. These files are copied to the Resources folder, when compiling your Alloy project.
   {quote}
   
   so I put my <code>moment.js</code> into <code>app/lib</code>, but still got exception
   bq. <code><pre>Couldn'y find module: ./locale/en-US for architecture: i386</pre></code></li>
<li>Ethan Chen 2015-07-08

   I try putting the <code>moment.js</code> in <code>app/assets</code> folder,
   same test code, same exceptions, same crushes.
   <code><pre>
   [ERROR] :  The application has crashed with an uncaught exception 'org.test.kroll'.
   [ERROR] :  Reason:
   [ERROR] :  Couldn't find module: ./locale/en-US for architecture: i386
   [ERROR] :  Stack trace:
   [ERROR] :  
   [ERROR] :  0   CoreFoundation                      0x04f7e72a __exceptionPreprocess + 154
   [ERROR] :  1   libobjc.A.dylib                     0x04b51a97 objc_exception_throw + 44
   [ERROR] :  2   test                                0x00024550 -[KrollBridge require:path:] + 4496
   [ERROR] :  3   test                                0x0002d1b6 CommonJSRequireCallback + 230
   [ERROR] :  4   test                                0x0039fe9a _ZN2TI19APICallbackFunction4callINS_18JSCallbackFunctionEEExPNS_9ExecStateE + 698
   [ERROR] :  5   test                                0x0037ae86 _ZN2TI14handleHostCallEPNS_9ExecStateENS_7TiValueENS_22CodeSpecializationKindE + 630
   [ERROR] :  6   test                                0x0037b25c linkFor + 156
   [ERROR] :  7   test                                0x003758d9 operationLinkCall + 25
   [ERROR] :  8   ???                                 0x503c9134 0x0 + 1346146612
   [ERROR] :  
   [ERROR] :  2015-07-08 10:33:19.545 test[20774:4690187] *** Terminating app due to uncaught exception 'org.test.kroll', reason: 'Couldn't find module: ./locale/en-US for architecture: i386'
   [ERROR] :  *** First throw call stack:
   [ERROR] :  (
   [ERROR] :  	0   CoreFoundation                      0x04f7e746 __exceptionPreprocess + 182
   [ERROR] :  	1   libobjc.A.dylib                     0x04b51a97 objc_exception_throw + 44
   [ERROR] :  	2   test                                0x00024550 -[KrollBridge require:path:] + 4496
   [ERROR] :  	3   test                                0x0002d1b6 CommonJSRequireCallback + 230
   [ERROR] :  	4   test                                0x0039fe9a _ZN2TI19APICallbackFunction4callINS_18JSCallbackFunctionEEExPNS_9ExecStateE + 698
   [ERROR] :  	5   test                                0x0037ae86 _ZN2TI14handleHostCallEPNS_9ExecStateENS_7TiValueENS_22CodeSpecializationKindE + 630
   [ERROR] :  	6   test                                0x0037b25c linkFor + 156
   [ERROR] :  	7   test                                0x003758d9 operationLinkCall + 25
   [ERROR] :  	8   ???                                 0x503c9134 0x0 + 1346146612
   [ERROR] :  )
   [ERROR] :  libc++abi.dylib: terminating with uncaught exception of type NSException
   </pre></code></li>
<li>Motiur Rahman 2015-07-23

   Hello [~ethancfchen],
   
   Please test with latest Studio 4.1.1 and SDK 4.1.0 and let us know. 
   
   Thanks.</li>
<li>Manuel Conde Vendrell 2015-08-19

   Hi. I was able to made it work as @Motiur explained with Ti 4.1.1 (getting moment-with-locales and putting it in assets), but I have one question:
   
   Is this the new way to use localized moments? In Ti3.5.0GA the translations worked alone, you only need to set the format and moment get the current device language alone.
   
   Why this changed in 4.1.1?</li>
</ol>


<p><a href="/AC/AC-200.json">JSON Source</a></p>