---
title: "[AC-795] TiDownloadManager crashes with links returning redirects (302)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-06-29T17:12:36.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>TCSupportTriage</td></tr>
<tr><th>Reporter</th><td>Matteo Landi</td></tr>
<tr><th>Assignee</th><td>Radamantis Torres-Lechuga</td></tr>
<tr><th>Created</th><td>2014-12-29T15:22:51.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:37:04.000+0000</td></tr>
</table>

<h3>Description</h3>

TiDownloadManager doesn't seem to properly handle redirects on Android Lollipop.  This is the exception I get:

<code><pre>
ERROR] TiDownloadManager: (pool-4-thread-1) [916,916] Exception downloading <a href="https://graph.facebook.com/100008778152788/picture?width=200&height=200" rel="nofollow" target="_blank">https://graph.facebook.com/100008778152788/picture?width=200&height=200</a>
[ERROR] TiDownloadManager: java.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.startsWith(java.lang.String)' on a null object reference
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.StatusLine.&lt;init&gt;(StatusLine.java:24)
[ERROR] TiDownloadManager: 	at com.android.okhttp.Response$Builder.statusLine(Response.java:419)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.JavaApiConverter.createOkResponse(JavaApiConverter.java:116)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.ResponseCacheAdapter.get(ResponseCacheAdapter.java:53)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.HttpEngine.sendRequest(HttpEngine.java:190)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:373)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:323)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.HttpURLConnectionImpl.getInputStream(HttpURLConnectionImpl.java:190)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.DelegatingHttpsURLConnection.getInputStream(DelegatingHttpsURLConnection.java:210)
[ERROR] TiDownloadManager: 	at com.android.okhttp.internal.http.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:25)
[ERROR] TiDownloadManager: 	at java.net.URL.openStream(URL.java:470)
[ERROR] TiDownloadManager: 	at org.appcelerator.titanium.util.TiDownloadManager$DownloadJob.run(TiDownloadManager.java:135)
[ERROR] TiDownloadManager: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
[ERROR] TiDownloadManager: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
[ERROR] TiDownloadManager: 	at java.lang.Thread.run(Thread.java:818)
</pre></code>

Attached you can find a single window application in which two image views are used to display remote images.  The second of the two uses some facebook redirect to get the actual image url, and TiDownloadManager crashes while fetching the data.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-795_53368/redirect.tgz">redirect.tgz</td></td><td>2014-12-29T15:22:51.000+0000</td><td>4085569</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>grebulon 2015-03-16

   To work around this, call setUseCaches(false) on the URL connection before opening the stream, but I don't know why this happens.</li>
<li>grebulon 2015-03-31

   This is caused by a bug in TiCacheResponse.
   I reported this in a separate issue - TC-5388
   Also see: <a href="http://stackoverflow.com/a/29147399/2603965" rel="nofollow" target="_blank">http://stackoverflow.com/a/29147399/2603965</a></li>
<li>Arnaud Besnier 2015-05-21

   Any update for this issue?
   
   Or do we have to implement our own image cache?</li>
<li>grebulon 2015-05-21

   This is the same as item TC-5388 which has just been fixed for 4.0.1</li>
</ol>


<p><a href="/AC/AC-795.json">JSON Source</a></p>