---
title: "[AC-834] `Widget` Scope Not Available in CommonJS Modules"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2014-09-01T06:51:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy</td></tr>
<tr><th>Labels</th><td>Alloy, TCSupport</td></tr>
<tr><th>Reporter</th><td>Allen Hartwig</td></tr>
<tr><th>Assignee</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Created</th><td>2014-06-18T17:23:16.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:37:07.000+0000</td></tr>
</table>

<h3>Description</h3>

When developing an Alloy Widget, the <code>Widget</code> scope is not available in CommonJS modules used within the widget. It seems like <code>Widget</code> should be available much like <code>Alloy</code> is available throughout all project JS resources. 

When defining models and collections on the Widget level, it makes it difficult to access them from CommonJS assets within a widget. I understand the <code>Widget</code> context can be passed into a module, however, this becomes tedious when dealing with a large project with many modules. 

The <code>Widget</code> context be globally available on the widget level, no matter if it is a /controller/.js file or a /lib/.js file.

<h3>Comments</h3>

<ol>
<li>Allen Hartwig 2014-06-18

   Additionally the WPATH() method does not seem to be accessible outside of the controller directory, including the models directory. If a /models/myModel.js would like to use a common utils.js CommonJS in the  /lib/ folder of my widget, there is no way to easily require it; relative paths don't even work, eg: require('../lib/utils.js').</li>
<li>Motiur Rahman 2014-08-10

   Hello,
   
   We have tested this issue for a simple test case. And we can pass value from widget to commonJS scope easily. 
   
   <h4>Testing Environment: </h4>
   Titanium SDK: 3.3.0.GA,
   Titanium CLI: 3.3.0,
   Android SDK: 4.4.2,4.2.2,
   IOS Simulator: 7.1,
   OS X Version: 10.9.3,
   Appcelerator Studio: 3.3.0
   
   <h4>Steps to Test:</h4>
   1. Create a Alloy project.
   2. Create a widget named test .
   2. Paste this code in index.js , index.xml file and widget.js ,widget.xml file
   3. Run this code with the testing environment.
   
   <h4>Test Code</h4>
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Window class="container" layout='vertical'&gt;
   		&lt;Widget id='testWidget' src="test" &gt;&lt;/Widget&gt;
   		&lt;Button width="Ti.UI.SIZE" height="Ti.UI.SIZE" onClick="doClick" top="20" title="Show"&gt;&lt;/Button&gt;
   	&lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   function doClick() {
   	alert($.testWidget.testValue());
   
   }
   
   $.index.open();
   
   </pre></code>
   
   <code><pre>
   &lt;Alloy&gt;
   
   	&lt;View height="80"&gt;
   		&lt;TextField id='text' width="Ti.UI.FILL" height="Ti.UI.SIZE" hintText="Enter Some Things" borderRadius="6" borderWidth="2" borderColor="red" top="30" color="#000"&gt;&lt;/TextField&gt;
   		
   	&lt;/View&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   exports.testValue = function() {
   
   	return $.text.value;
   
   };
   
   
   </pre></code>
   
   Thanks.
   </li>
<li>Mauro Parra-Miranda 2014-09-01

   Please take a look into the provided testcase. If you can still reproduce, please provide a testcase that will show the issue. </li>
<li>Reymundo LÃ³pez 2014-12-11

   The example provided is wrong, it does not make use of any CommonJS modules inside of the /lib folder inside of the widget, here is a more apropiate example:
   
   * Create a blank Alloy App
   * Create a widget called test
   * Add the two CommonJS modules listed bellow
   * Try to run the app
   
   <code><pre>
   function doClick(e) {
       alert($.label.text);
   }
   
   $.index.open();
   </pre></code>
   
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Window class="container"&gt;
   		&lt;Widget id="testWidget" src="test" /&gt;
   		&lt;Label id="label" onClick="doClick"&gt;Hello, World&lt;/Label&gt;
   	&lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Label onClick="startWorking"&gt;I'm the default widget&lt;/Label&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   var simple = require(WPATH('simple'));
   
   function startWorking(){
   	simple.getSolutionToWork();
   }
   </pre></code>
   
   <code><pre>
   var solution = require(WPATH('solution'));
   module.exports = (function(){
   	var getSolutionToWork = function(){
   		solution.work();
   	};
   
   	return { 
   		getSolutionToWork : getSolutionToWork
   	};
   })();
   </pre></code>
   
   <code><pre>
   module.exports = (function(){
   	var work = function(){
   		Ti.API.log("I'm working");
   	};
   
   	return { 
   		work : work
   	};
   })();
   </pre></code>
   
   Expected result will be to get a message in the console.
   
   Actual result is <code>Can't find variable: WPATH</code>
   
   And the same goes for <code>Widget.generateController()</code> or the <code>Widget</code> variable alone inside of any CommonJS file located inside of the <code>lib</code> folder of any widget.</li>
<li>Vincent Degroote 2015-02-13

   Hello,
   
   I have the same problem, my fix was to inject from the controller the Widget namespace or the WPATH helper into the lib. It becomes really annoying when you want to require a lib into another. Could we reopen this issue?</li>
</ol>


<p><a href="/AC/AC-834.json">JSON Source</a></p>