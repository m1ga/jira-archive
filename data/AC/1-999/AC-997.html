---
title: "[AC-997] Location services doesn't always work"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Not Our Bug</td></tr>
<tr><th>Resolution Date</th><td>2015-09-29T01:52:23.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Samie Syed</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2015-02-08T12:34:06.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:37:19.000+0000</td></tr>
</table>

<h3>Description</h3>

Steps to replicate:

After modifying my TiAPP editor, and adding this to enable location services:

                <key>NSLocationAlwaysUsageDescription</key>
				<string>App requires this to be enabled.</string>
                <key>NSLocationWhenInUseUsageDescription</key>
				<string>App requires this to be enabled.</string>

I find that after running the app in a simulator for the first time a dialog box pops up, if i press "always allow" it works. However, if I close the simulator, then re run it, location services are not running for the app. I have to manually go to debug > location > select a location

This was working fine before.

Any idea why this is happening, thanks


Simple Test case:

1) create new alloy project

2)Modify tiapp.xml file

<?xml version="1.0" encoding="UTF-8"?>
<ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>">
    <id>com.testLocationServices</id>
    <name>testLocationServices</name>
    <version>1.0</version>
    <publisher>ss</publisher>
    <url>http://</url>
    <description/>
    <copyright>2015 by ss</copyright>
    <icon>appicon.png</icon>
    <fullscreen>false</fullscreen>
    <navbar-hidden>false</navbar-hidden>
    <analytics>true</analytics>
    <guid>eec6a952-5cf4-42e8-974d-36868fb64701</guid>
    <property name="ti.ui.defaultunit" type="string">dp</property>
    <ios>
        <plist>
            <dict>
                <key>UISupportedInterfaceOrientations~iphone</key>
                <array>
                    <string>UIInterfaceOrientationPortrait</string>
                </array>
                <key>UISupportedInterfaceOrientations~ipad</key>
                <array>
                    <string>UIInterfaceOrientationPortrait</string>
                    <string>UIInterfaceOrientationPortraitUpsideDown</string>
                    <string>UIInterfaceOrientationLandscapeLeft</string>
                    <string>UIInterfaceOrientationLandscapeRight</string>
                </array>
                <key>UIRequiresPersistentWiFi</key>
                <false/>
                <key>UIPrerenderedIcon</key>
                <false/>
                <key>UIStatusBarHidden</key>
                <false/>
                <key>UIStatusBarStyle</key>
                <string>UIStatusBarStyleDefault</string>
                <key>NSLocationUsageDescription</key>
                <string>app requires this to be enabled.</string>
                <key>NSLocationAlwaysUsageDescription</key>
                <string>app requires this to be enabled.</string>
                <key>NSLocationWhenInUseUsageDescription</key>
                <string>app requires this to be enabled.</string>
            </dict>
        </plist>
    </ios>
    <android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"/>
    <mobileweb>
        <precache/>
        <splash>
            <enabled>true</enabled>
            <inline-css-images>true</inline-css-images>
        </splash>
        <theme>default</theme>
    </mobileweb>
    <modules/>
    <deployment-targets>
        <target device="android">true</target>
        <target device="blackberry">false</target>
        <target device="ipad">true</target>
        <target device="iphone">true</target>
        <target device="mobileweb">true</target>
    </deployment-targets>
    <sdk-version>3.4.1.v20141001062512</sdk-version>
    <plugins>
        <plugin version="1.0">ti.alloy</plugin>
    </plugins>
</ti:app>

add the following lines into tiapp.xml to enable location services (as above)

                <key>NSLocationUsageDescription</key>
                <string>app requires this to be enabled.</string>
                <key>NSLocationAlwaysUsageDescription</key>
                <string>app requires this to be enabled.</string>
                <key>NSLocationWhenInUseUsageDescription</key>
                <string>app requires this to be enabled.</string>


Controller:

index.js

Titanium.Geolocation.addEventListener('location', function(e) {
	if (e.error) {
		alert(e.error);

	} else {
		Ti.API.info(e.coords);

	}
});

Run in ioS 8.1 simulator iphone 6.
Compiled in SDK 3.4.1

You will get a authorisation dialog box when you first start the app, after accepting ok, location services are not turned on and the error alert fires.

<h3>Comments</h3>

<ol>
<li>Shuo Liang 2015-02-09

   Hi,
   
   Please provide a simple test case to reproduce your problem. That will be real helpful to address the problem. Thanks
   
   Regards,
   Shuo</li>
<li>Samie Syed 2015-02-15

   Done</li>
<li>Samie Syed 2015-02-15

   See edit.</li>
<li>Shuo Liang 2015-02-16

   The test case should include the following content, please review. Thanks.
   [<a href="http://docs.appcelerator.com/titanium/3.0/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/3.0/#</a>!/guide/How_to_Submit_a_Bug_Report-section-29004732_HowtoSubmitaBugReport-CreatingaTestCase]</li>
<li>Samie Syed 2015-02-16

   changed it.</li>
<li>Samie Syed 2015-02-16

   Seems like someone else has experienced the same problem here:
   
   <a href="https://developer.appcelerator.com/question/178407/ios8-with-ti-340-sdk-getcurrentposition-error-the-operation-couldnt-be-completed" rel="nofollow" target="_blank">https://developer.appcelerator.com/question/178407/ios8-with-ti-340-sdk-getcurrentposition-error-the-operation-couldnt-be-completed</a>
   
   And was unable to resolve it. Appcelerator can you help please, thanks.</li>
<li>Motiur Rahman 2015-09-08

   Hello,
   
   It's not an issue. It's a default behavior of simulator or device if you don't allow anything to the App launch. Next time, you have to manually permission this otherwise it will not work.  For doing that Settings>> APP_NAME>> Then enable permission.
   
   Thanks.</li>
</ol>


<p><a href="/AC/AC-997.json">JSON Source</a></p>