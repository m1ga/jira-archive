---
title: "[AC-1074] iOS: HTTPClient redirect 303 with POST instead of GET"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2015-09-28T15:41:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>TCSupportTriage</td></tr>
<tr><th>Reporter</th><td>Pierre VAN DE VELDE</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2014-10-06T09:35:32.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:37:25.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
From titanium 3.3.0, when sending a POST request that being redirected with http code 303, the redirection is followed using POST method instead of GET (POST/redirect/GET design pattern).

<h4>Test case</h4>
Run this sample code with 3.2.3.GA, then with 3.3.0.GA :
<code><pre>
 var handler = function(e) { Titanium.API.info( e, http.responseText ); };
 var http = Ti.Network.createHTTPClient({
     onload: handler,
     onerror: handler,
     timeout: 1000
 });
 http.open('POST', '<a href="http://jigsaw.w3.org/HTTP/300/Go_303" rel="nofollow" target="_blank">http://jigsaw.w3.org/HTTP/300/Go_303</a>');
 http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
 http.send();
</pre></code>

<h4>Expected results</h4>
Running Titanium *3.2.3*, output should be :
<code><pre>
 {
     code = 0;
     source = "[object TiNetworkClient]";
     success = 1;
     type = load;
 }
 ... <title>Redirect test page</title> ...
 Your browser made it!
</pre></code>

Running Titanium *3.3.0* or greater, output should be :
<code><pre>
 {
     code = 405;
     error = "HTTP error";
     source = "[object TiNetworkHTTPClient]";
     success = 0;
     type = error;
 }
 Method POST not allowed on this resource.
</pre></code>

<h3>Comments</h3>

<ol>
<li>Pierre VAN DE VELDE 2014-10-06

   Thanks to Fokke's help, I've noticed that here: 
   <a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiNetworkHTTPClientProxy.m#L237-L247" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiNetworkHTTPClientProxy.m#L237-L247</a>
   
   It uses APSHTTPClient module, could it be that here is where it is missing the POST/redirect/GET pattern ?
   <a href="https://github.com/appcelerator/APSHTTPClient/blob/20fb741880ea5c0f79a5446c5f7f73debccc73af/APSHTTPClient/APSHTTPRequest.m#L250-L256" rel="nofollow" target="_blank">https://github.com/appcelerator/APSHTTPClient/blob/20fb741880ea5c0f79a5446c5f7f73debccc73af/APSHTTPClient/APSHTTPRequest.m#L250-L256</a>
   </li>
<li>Pierre VAN DE VELDE 2014-10-26

   I think [~Fokke] was right pointing this location in the code, actually this issue comes from this commit: <a href="https://github.com/appcelerator/APSHTTPClient/commit/0d86619e42b128faa090ce0066f398bf757468f4" rel="nofollow" target="_blank">https://github.com/appcelerator/APSHTTPClient/commit/0d86619e42b128faa090ce0066f398bf757468f4</a>
   
   As far as I understand, it seems [~vduggal] overrided the native behaviour of NSURLConnection (which should redirect using GET) by creating a new request:
   
   <code><pre>
   if (response) {
   	NSMutableURLRequest *r = [self.request mutableCopy];
   	r.URL = request.URL;
   	return r;
   } else {
   	return request;
   }
   </pre></code>
   
   Reverting to this piece of code should work:
   <code><pre>
   if (response) {
   	self.request.URL = request.URL;
   	return self.request;
   </pre></code>
   *edit after testing*: this is wrong. Simply returning <code>request</code> works for me instead (remove the whole condition on <code>response</code>). Might not handle 307 though
   
   [~vduggal]: Do you agree ? I hope we can fix this ASAP since it prevents me from updating!
   
   +Sources:+
   _Blog post about overriding NSURLConnection behaviour_: <a href="http://tewha.net/2012/05/handling-302303-redirects" rel="nofollow" target="_blank">http://tewha.net/2012/05/handling-302303-redirects</a>
   _NSURLConnection doc about handling redirection_: <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/Articles/RequestChanges.html" rel="nofollow" target="_blank">https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/Articles/RequestChanges.html</a>
   
   *There's an interesting discussion about this topic on stackoverflow*: <a href="http://stackoverflow.com/a/3393499" rel="nofollow" target="_blank">http://stackoverflow.com/a/3393499</a></li>
<li>Amimul Hossain 2015-08-31

   Hello, I have tested this With the latest SDK release. The issue seems to be resolved in the latest SDK. 
   
   TESTING ENVIONMENT
   
   CLI version 4.1.2, Appcelerator SDK version 4.1.0.GA
   iOS Simulator 8.3
   
   Observed Result
   <code><pre>
   [INFO] :   helloappli/1.0 (4.1.0.d57aa7d)
   [INFO] :   {
   [INFO] :       code = 501;
   [INFO] :       error = "HTTP error";
   [INFO] :       source = "[object TiNetworkHTTPClient]";
   [INFO] :       success = 0;
   [INFO] :       type = error;
   [INFO] :   } Method GET not implemented.
   </pre></code>
   
   Thanks.</li>
</ol>


<p><a href="/AC/AC-1074.json">JSON Source</a></p>