---
title: "[AC-1375] Cloud PushNotifications expire_after_seconds issue"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-03-14T08:46:30.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>Cloud, PushNotifications, expire_after_seconds</td></tr>
<tr><th>Reporter</th><td>Stephan Jensen</td></tr>
<tr><th>Assignee</th><td>Shuo Liang</td></tr>
<tr><th>Created</th><td>2014-03-07T08:33:39.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:37:47.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem Description:</h4>
We are unable to use the expire_after_seconds option when using the REST API
We are getting the following response
{
  "meta": {
    "code": 400,
    "status": "fail",
    "message": "Invalid json format on options parameter: can't convert ActiveSupport::HashWithIndifferentAccess into String"
  }
}
\\
<h4>Testcase:</h4>
Uri
<a href="https://api.cloud.appcelerator.com/v1/push_notification/notify_tokens.json?key=" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/push_notification/notify_tokens.json?key=</a><removed>
\\
<h4>Request headers</h4>
User-Agent: Fiddler
Host: api.cloud.appcelerator.com
Content-Length: 174
Cookie: <removed>
Content-Type: application/json
\\
<h4>Request body (POST)</h4>
<code><pre>
{
	"channel": "test",
	"to_tokens": "everyone",
	"payload": {
		"alert": "Push Notification Test",
		"title": "this is the title"
	},
        "options": {"expire_after_seconds": 86400}
}
</pre></code>

<h3>Comments</h3>

<ol>
<li>Shuo Liang 2014-03-11

   Hi, 
   
   I tested that API and check the source code. Are you sure you set options by the exactly same format {"expire_after_seconds": 86400}.
   because if you use single quotation marks like {'expire_after_seconds': 86400}, it will cause error then get the exception like you got.
   
   And there is something wrong with the documents. we have to use double quotation marks here.</li>
<li>Stephan Jensen 2014-03-11

   Yes we are using double quotes
   We are still getting the same error as described above</li>
<li>Shuo Liang 2014-03-12

   Would please tell me do you use the notify_token API in a app, or a curl commands?
   And can you pass parts of the code you wrote, I have to make sure the data format.</li>
<li>Stephan Jensen 2014-03-12

   We have tried using the notify_tokens API both from .NET 4.0 and Fiddler
   Here's a screenshot of how we compose the fiddler request: 
   !<a href="https://www.dropbox.com/s/fz41rw3d4r7z625/fiddler.jpg" rel="nofollow" target="_blank">https://www.dropbox.com/s/fz41rw3d4r7z625/fiddler.jpg</a>! <a href="https://www.dropbox.com/s/fz41rw3d4r7z625/fiddler.jpg" rel="nofollow" target="_blank">https://www.dropbox.com/s/fz41rw3d4r7z625/fiddler.jpg</a>
   
   We are also having trouble showing the letters æøå on android devices, they are being shown as ? symbols
   UTF-8 encoding is being used from our .NET application</li>
<li>Shuo Liang 2014-03-14

   Hi, 
   
   I am still testing notidy_tokens API's issue. Will notice you as soon as solve it.
   
   For the letter display problem, you may use ASCII code.
   Ref: <a href="http://www.ascii-code.com/" rel="nofollow" target="_blank">http://www.ascii-code.com/</a></li>
<li>Shuo Liang 2014-03-14

   </li>
<li>Stephan Jensen 2014-03-14

   Thanks for the update
   
   We can't get the ASCII encoding to work with Å, Æ, Ø
   The iPhone accepts displays the ascii encoded characters correctly, but our android devices still shows ? symbols
   
   Your options fix seems to be working, so thanks for that :)
   Should I open a new issue about the encoding problem?</li>
<li>Shuo Liang 2014-03-14

   Ye, Please create a new issue about encoding problem, thanks.</li>
<li>Shuo Liang 2014-03-14

   Customer's options issue fixed.</li>
<li>Stephan Jensen 2014-06-02

    The fix is no longer working.
    Everytime we try and apply the option expire_after_seconds, the API responds with a 500 Internal Server Error.
    You could guys Please fix the problem without having to apply a workaround.
    
    <h4>Test with previous workaround applied:</h4>
    <code><pre>
    {
    	"channel": "test",
    	"to_tokens": "everyone",
    	"payload":{
    		"alert": "Test message.",
    		"title": ""
    	},
    	"options": '{"expire_after_seconds": 3600}'
    }
    </pre></code>
    
    <h4>Response:</h4>
    <code><pre>
    {
      "meta": {
        "status":"fail",
        "code":500,
        "message":"Internal server error. The Appcelerator Cloud Services Team has just been notified of this problem."
      }
    }
    </pre></code></li>
<li>Shuo Liang 2014-06-03

    Hi,
    
    First of all, the "expire_after_seconds" quotes issue has been fixed,  and will be deployed to production in next release. By the time, you won't need work around any more. 
    
    Then, I have tested your problem in last comment. I can't reproduce your problem. The code works well for me. So would you please try "curl" command again, if still not working, can you send me part of your code which I can find the problem.
    
    Ref my example:
    <code><pre>
    Appc-MBP:Documents shuoliang$ curl -b cookies.txt -c cookies.txt -F "channel=Test 1" -F "to_tokens=everyone" -F "payload=Test Message" -F 'options={"expire_after_seconds":86400}' '<a href="https://api.cloud.appcelerator.com/v1/push_notification/notify_tokens.json?key=H3PcVB7YSocRMbC8iGUoFtRxrGDFUfd1" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/push_notification/notify_tokens.json?key=H3PcVB7YSocRMbC8iGUoFtRxrGDFUfd1</a>'
    {
      "meta": {
        "status": "ok",
        "code": 200,
        "method_name": "NotifyTokens"
      }
    }
    </pre></code>
    
    Regards,
    Shuo</li>
</ol>


<p><a href="/AC/AC-1375.json">JSON Source</a></p>