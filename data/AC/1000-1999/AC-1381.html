---
title: "[AC-1381] Cloud.Users.update of photo returns 'failed to upload photo: undefined method `destroy' for nil:NilClass'"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2015-09-30T03:54:28.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Keylo E.</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2015-06-16T02:10:34.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:37:48.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Steps to Reproduce</h4>
(All tests done on same user
The standard Cloud.Users.update method of updating a user's photo was confirmed, installed the app on ipad and confirmed again.

Continued testing from laptop for MobileWeb portion of the app with this, 
<a href="http://developer.appcelerator.com/question/182699/cloudusersupdate-photo-returns-success-but-no-change-wrong-media-type" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/182699/cloudusersupdate-photo-returns-success-but-no-change-wrong-media-type</a> , resulted in error "Failed to upload photo: Failed to indentify photo file" or depending upon my sent data, silently failed when changing reader.readAsDataURL() to reader.readAsBinaryString() and various methods from this reference <a href="http://www.html5rocks.com/en/tutorials/file/dndfiles" rel="nofollow" target="_blank">http://www.html5rocks.com/en/tutorials/file/dndfiles</a> until I started getting consistent error responses 'failed to upload photo: undefined method <code>destroy' for nil:NilClass'

I returned to the device to test with working, unchanged  installed app and got the same error same response, 'failed to upload photo: undefined method </code>destroy' for nil:NilClass'

Tested from dashboard, same error response
(All tests done on same user)

<h4>Actual Result</h4>
Existing user's photo deleted but not replaced. Unable to update

<h4>Expected Result</h4>
successful update

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-1381_55837/.log">.log</td></td><td>2015-06-16T02:11:02.000+0000</td><td>6211688</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-1381_55838/diagnostic903946955486080361.log">diagnostic903946955486080361.log</td></td><td>2015-06-16T02:11:06.000+0000</td><td>78861</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Radamantis Torres-Lechuga 2015-06-17

   [~keylo] you mind sharing a test case with us? So far we can not reproduce this issue
   
   Thanks
   </li>
<li>Keylo E. 2015-06-17

   Everything is in the link I posted <a href="http://developer.appcelerator.com/question/182699/cloudusersupdate-photo-returns-success-but-no-change-wrong-media-type" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/182699/cloudusersupdate-photo-returns-success-but-no-change-wrong-media-type</a> and description above.
   
   Started with a working Cloud.Users.update method, which you can reproduce without my help, then did what the link states, changing  reader.readAsDataURL() to reader.readAsBinaryString(), reader.readAsText(), reader.readAsArrayBuffer(), sometimes passing update the result.data as well as the result until it breaks. It might have taken 10 or 20 tries before shutting down. I may have also tried passing handleFileSelect's evt[0] (file) directly from the <input> without passing it through the reader.
   
   Returned to the working update method to confirm</li>
<li>Radamantis Torres-Lechuga 2015-06-22

   [~morahman] Did you try from dashboard? </li>
<li>Keylo E. 2015-06-22

   "Tested from dashboard, same error response"</li>
<li>Motiur Rahman 2015-06-26

   [~keylo] we also have tested from the dashboard and it works, if it shows error it may cause of large file  so just try it again.  And this test case User photo is updated properly. So first check your webView chooseing image getting the titanium code.
   
   <code><pre>
   var win = Ti.UI.createWindow({
   	backgroundColor : '#fff'
   });
    
   // Create a Button.
   var Update_Photo = Ti.UI.createButton({
   	title : 'Update_Photo',
   	height : Ti.UI.SIZE,
   	width : Ti.UI.SIZE,
   	top : 20,
    
   });
    
   // Add to the parent view.
   win.add(Update_Photo);
    
   var Cloud = require("ti.cloud");
    
   Cloud.Users.create({
   	email : 'test@mycompany.com',
   	first_name : 'test_firstname',
   	last_name : 'test_lastname',
   	password : 'test_password',
   	password_confirmation : 'test_password',
   	photo : Titanium.Filesystem.getFile('KS_nav_ui.png')
   }, function(e) {
   	if (e.success) {
   		var user = e.users[0];
   		alert('Success:\n' + 'id: ' + user.id + '\n' + 'sessionId: ' + Cloud.sessionId + '\n' + 'first name: ' + user.first_name + '\n' + 'last name: ' + user.last_name);
   	} else {
   		alert('Error:\n' + ((e.error && e.message) || JSON.stringify(e)));
   	}
   });
    
   function update_photo() {
   	Cloud.Users.update({
   		email : 'test@mycompany.com',
   		first_name : 'test_firstname',
   		last_name : 'test_lastname',
   		photo : Titanium.Filesystem.getFile('KS_nav_views.png'),
   		custom_fields : {
   			favorite_color : 'blue',
   			age : 25
   		}
   	}, function(e) {
   		if (e.success) {
   			var user = e.users[0];
   			alert('Success:\n' + 'id: ' + user.id + '\n' + 'first name: ' + user.first_name + '\n' + 'last name: ' + user.last_name);
   		} else {
   			alert('Error:\n' + ((e.error && e.message) || JSON.stringify(e)));
   		}
   	});
   }
    
   // Listen for click events.
   Update_Photo.addEventListener('click', function() {
   	update_photo();
   });
    
   win.open();
    
   </pre></code>
   
   Thanks.</li>
<li>Keylo E. 2015-06-26

   Titanium.Filesystem.getFile('KS_nav_views.png')
   would not work in the scenario described as the need was to browse to a file in a MobileWeb app, thus the WebView HTML solution, which broke the system.</li>
<li>Radamantis Torres-Lechuga 2015-06-26

   [~keylo] can you please attach a runnable test case that reproduces the issue? So far we can not replicate the issue</li>
</ol>


<p><a href="/AC/AC-1381.json">JSON Source</a></p>