---
title: "[AC-1652] iOS: Large or multiple downloads crash the app with NSInvalidArgumentException"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2015-09-29T01:01:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Szymon Tomasz Stefanek</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2014-11-20T10:07:18.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:38:08.000+0000</td></tr>
</table>

<h3>Description</h3>

After a number of large downloads made via TiHTTPClient the application crashes on RAM allocation. It's almost like it's keeping the whole downloaded data in memory and not freeing it.

<code><pre>
ERROR] :  The application has crashed with an uncaught exception 'NSInvalidArgumentException'.
[ERROR] :  Reason:
[ERROR] :  *** NSAllocateMemoryPages(236102400) failed
[ERROR] :  Stack trace:
[ERROR] :  
[ERROR] :  0   CoreFoundation                      0x24d3fe3f &lt;redacted&gt; + 126
[ERROR] :  1   libobjc.A.dylib                     0x327f3c8b objc_exception_throw + 38
[ERROR] :  2   CoreFoundation                      0x24d3fd85 &lt;redacted&gt; + 0
[ERROR] :  3   Foundation                          0x259ec989 NSAllocateMemoryPages + 92
[ERROR] :  4   Foundation                          0x259c4561 &lt;redacted&gt; + 24
[ERROR] :  5   Foundation                          0x25993c09 &lt;redacted&gt; + 220
[ERROR] :  6   Foundation                          0x25993b23 &lt;redacted&gt; + 78
[ERROR] :  7   Foundation                          0x259a151b &lt;redacted&gt; + 118
[ERROR] :  8   Museo900                            0x0029466b Museo900 + 1807979
[ERROR] :  9   Museo900                            0x0029472d Museo900 + 1808173
[ERROR] :  10  Museo900                            0x00296705 Museo900 + 1816325
[ERROR] :  11  CFNetwork                           0x2489d5a1 &lt;redacted&gt; + 56
[ERROR] :  12  Foundation                          0x25a39ae1 &lt;redacted&gt; + 8
[ERROR] :  13  Foundation                          0x259a4b7d &lt;redacted&gt; + 148
[ERROR] :  14  Foundation                          0x25997337 &lt;redacted&gt; + 774
[ERROR] :  15  Foundation                          0x25a3c44b &lt;redacted&gt; + 186
[ERROR] :  16  libdispatch.dylib                   0x32d5b651 &lt;redacted&gt; + 952
[ERROR] :  17  libdispatch.dylib                   0x32d5609d &lt;redacted&gt; + 84
[ERROR] :  18  libdispatch.dylib                   0x32d5cba1 &lt;redacted&gt; + 320
[ERROR] :  19  libdispatch.dylib                   0x32d5dcd7 &lt;redacted&gt; + 94
[ERROR] :  20  libsystem_pthread.dylib             0x32eb4e31 _pthread_wqthread + 668
[ERROR] :  21  libsystem_pthread.dylib             0x32eb4b84 start_wqthread + 8
[ERROR] :  *** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '*** NSAllocateMemoryPages(236102400) failed'
[ERROR] :  *** First throw call stack:
</pre></code>

Another stack, different (small) download size:
<code><pre>
[ERROR] The application has crashed with an uncaught exception 'NSInvalidArgumentException'.
Reason:
*** NSAllocateMemoryPages(183259200) failed
Stack trace:
0   CoreFoundation                      0x24d3fe3f &lt;redacted&gt; + 126
1   libobjc.A.dylib                     0x327f3c8b objc_exception_throw + 38
2   CoreFoundation                      0x24d3fd85 &lt;redacted&gt; + 0
3   Foundation                          0x259ec989 NSAllocateMemoryPages + 92
4   Foundation                          0x259c4561 &lt;redacted&gt; + 24
5   Foundation                          0x25993c09 &lt;redacted&gt; + 220
6   Foundation                          0x25993b23 &lt;redacted&gt; + 78
7   Foundation                          0x259a151b &lt;redacted&gt; + 118
8   Museo900                            0x0038733b Museo900 + 2753339
9   Museo900                            0x003873fd Museo900 + 2753533
10  Museo900                            0x003893d5 Museo900 + 2761685
11  CFNetwork                           0x2489d5a1 &lt;redacted&gt; + 56
</pre></code>




<h3>Comments</h3>

<ol>
<li>Szymon Tomasz Stefanek 2014-11-20

   I should add that:
   
   - the very same code works reliably on Android (tried different devices)
   - the out-of-memory condition can't be handled from javascript in any way
   - limiting the number of concurrent downloads to 1 avoids the problem</li>
<li>Shuo Liang 2014-11-21

   Please provide a test case to reproduce this problem, Thanks</li>
</ol>


<p><a href="/AC/AC-1652.json">JSON Source</a></p>