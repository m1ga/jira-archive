---
title: "[AC-1709] HttpClient.send() changes order of POST values"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2016-01-31T06:54:40.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>HttpClient</td></tr>
<tr><th>Reporter</th><td>Stephen Ostrow</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2016-01-22T06:04:22.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:38:12.000+0000</td></tr>
</table>

<h3>Description</h3>

HttpClient.send() does not respect the order of the array of data given to it.

When using a pre-authorized POST url for Amazon's AWS S3 the order of the POST fields matters.

For instance

<code><pre>
var httpClient = Ti.Network.createHTTPClient({
						onload: function(e) {
							Ti.API.info("Upload file responseText: " + this.responseText);
		    				_encodedFilename = awsPolicyFields.formInputs.key;
		                    callback(true);
						},
			            onerror : function(e) {
	            			Ti.API.error("Error uploading file: " + e.error);
							Ti.API.debug("Upload file responseText: " + this.responseText);
			               	callback(false);
			            },
					    onsendstream : function(e) {  
					        var progress = parseFloat(e.progress);
					        Ti.API.trace("Upload progress: " + (progress * 100));
					        Ti.App.fireEvent('progress_update', {'progress' : progress});
					    },
			            validatesSecureCertificate : _validatesSSL
					});
					
					var args = {
						'key': awsPolicyFields.formInputs['key'],
						'policy' : awsPolicyFields.formInputs['policy'],
						'signature' : awsPolicyFields.formInputs['signature'],
						'AWSAccessKeyId' : awsPolicyFields.formInputs['AWSAccessKeyId'],
						'success_action_status' : awsPolicyFields.formInputs['success_action_status'],
						'x-amz-server-side-encryption' : awsPolicyFields.formInputs['x-amz-server-side-encryption'],
						'Content-Type' : awsPolicyFields.formInputs['Content-Type'],
						'file' : videoFile,
					};
					
					httpClient.open(awsPolicyFields.formAttributes.method, awsPolicyFields.formAttributes.action);
					httpClient.send(args);
			        networkManager.addRequest(httpClient);
</pre></code>

sent the following request

<code><pre>
=============== New Request at 2016-01-22T03:02:08+00:00 ===================
POST /endpoint
x-newrelic-id: XXXXXXXXXXXX=
Accept-Encoding: identity
X-Titanium-Id: XXXXXXXXXXXXXXXXXXXX
Content-Type: multipart/form-data; boundary=j6FN2IMH7hRNiksUXnkOufIDEOdD4CH9jEHbdh
X-Requested-With: XMLHttpRequest
User-Agent: Appcelerator Titanium/5.1.2 (Android SDK built for x86_64; Android API Level: 22; en-US;)
Host: example.org
Connection: Keep-Alive
Content-Length: 279029
--------------------- php://input -----------------
--------------------- $_POST -----------------
AWSAccessKeyId: XXXXXXXXXXXXX
Content-Type: video/mp4
key: keydir/XXXXXX/sadfsdaf.mp4
signature: a+TJ/dJX/ei76vm4EURakrg7q+s=
policy: eyJleHBpcmF0aW9uIjoiMjAxNi0wMS0yMlQwNDowMTo0NloiLCJjb25kaXRpb25zIjpbeyJidWNrZXQiOiJXXXXXXXXXXXXXXXXXXXXXXvbl9zdGF0dXMiOiIyMDAifSx7ImtleSI6ImRlbW9cL2Z0cF91cGxvYWRzXC84LWdlbmVyYWwtbWFuYWdlclwvc2FkZnNkYWYubXA0In0seyJ4LWXXXXXXXXXXXXXXXXXXXB0aW9uIjoiQUVTMjU2In0seyJDb250ZW50LVR5cGUiOiJ2aWRlb1wvbXA0In1dfQ==
success_action_status: 200
x-amz-server-side-encryption: AES256
--------------------- $_FILE -----------------
file:
array (
  'name' =&gt; 'VID_20160121_220135.mp4',
  'type' =&gt; 'application/octet-stream',
  'tmp_name' =&gt; '/tmp/phpOI761z',
  'error' =&gt; 0,
  'size' =&gt; 277413,
)
</pre></code>

<h3>Comments</h3>

<ol>
<li>Stephen Ostrow 2016-01-22

   I believe this is due to ti.modules.titanium.network.TiHTTPClient using a HashMap for parts
   
   <a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L139" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L139</a>
   
   A HashMap does not guarantee ordering and it appears every time you add to it you mach the ordering of it.</li>
<li>Jebun Naher 2016-01-27

   Hello,
   
   I tried to test the ordering of the post data using below code but couldn't reproduce it. It would be helpful if you attach a complete test code and steps to reproduce this issue.
   
   *Testing Environment:*
   Appcelerator Studio, build: 4.4.0.201511241829
   Appcelerator Command-Line Interface, version 5.1.0
   Titanium Command-Line Interface, CLI version 5.0.5, 
   Titanium SDK version : 5.1.2 GA
   Mac OS X : 10.11.1 (EI Capitan)
   Node.js Version             = 0.12.7
   Java Development Kit= 1.7.0_65
   VirtualBox Version     = 4.3.28r100309
   
   *Test Code:*
   index.xml
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Window id="todoWin" title="Todo" platform="android,ios"&gt;
   		&lt;Button id="button" onClick="postData"&gt;
   			Post
   		&lt;/Button&gt;
   	&lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   index.js
   <code><pre>
   $.todoWin.open();
   function postData() {
   var xhr = Ti.Network.createHTTPClient({
   		onload : function() {
   			Ti.API.info("STATUS: " + this.status);
   			alert("TEXT:   " + this.responseText);
   			//json = JSON.parse(this.responseText);
   },
   		onerror : function(e) {
   			Ti.API.info("STATUS: " + this.status);
   			Ti.API.info("TEXT:   " + this.responseText);
   			Ti.API.info("ERROR:  " + e.error);
   			alert(L('network_problem'));
   		},
   		timeout : 50000
   	});
   var data = {
   		Name : 'username',
   		password : 'password',
   		city : 'select city',
   		country : 'select country',
   		order : 'order 1'
   	};
   	alert('data' + JSON.stringify(data));
   	xhr.open('POST', encodeURI('http://localhost/Test/postdata.php'));
   	xhr.setRequestHeader('Content-Type', 'application/json');
   	xhr.send(JSON.stringify(data));
   }
   </pre></code>
   
   postdata.php
   <code><pre>
   &lt;?php
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
           $params = file_get_contents('php://input');
           $params = json_decode(str_replace('\"', '"', $params));
             echo json_encode($params);
          
       } else {
           echo json_encode((object) array('error' =&gt; 'invalid verb'));
       } 
   ?&gt;
   </pre></code>
   
   *Output:*
   <code><pre>
   {"Name":"username","password":"password","city":"select city","country":"select country","order":"order 1"}
   </pre></code>
   
   Thanks.</li>
</ol>


<p><a href="/AC/AC-1709.json">JSON Source</a></p>