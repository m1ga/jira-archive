---
title: "[AC-1744] Ti.Storekit: receiptVerificationSandbox always TRUE if set"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-05-22T21:41:06.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Appcelerator Modules</td></tr>
<tr><th>Labels</th><td>store, storekit</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2013-05-22T14:43:33.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:40:37.000+0000</td></tr>
</table>

<h3>Description</h3>

Consider the following tests:

<code><pre>
var Storekit = require('ti.storekit');
Ti.API.error('Storekit.receiptVerificationSandbox: (' + (typeof Storekit.receiptVerificationSandbox) + ') ' + Storekit.receiptVerificationSandbox);        

Storekit.receiptVerificationSandbox = false;
Ti.API.error('Storekit.receiptVerificationSandbox: (' + (typeof Storekit.receiptVerificationSandbox) + ') ' + Storekit.receiptVerificationSandbox);        

Storekit.receiptVerificationSandbox = true;
Ti.API.error('Storekit.receiptVerificationSandbox: (' + (typeof Storekit.receiptVerificationSandbox) + ') ' + Storekit.receiptVerificationSandbox);        

Storekit.receiptVerificationSandbox = 0;
Ti.API.error('Storekit.receiptVerificationSandbox: (' + (typeof Storekit.receiptVerificationSandbox) + ') ' + Storekit.receiptVerificationSandbox);        

Storekit.receiptVerificationSandbox = 1;
Ti.API.error('Storekit.receiptVerificationSandbox: (' + (typeof Storekit.receiptVerificationSandbox) + ') ' + Storekit.receiptVerificationSandbox);       
</pre></code>

Resulting in the following outcome:

<code><pre>
May 22 16:09:19 iPad VerhaaltjesApp[9707] &lt;Warning&gt;: [ERROR] Storekit.receiptVerificationSandbox: (number) 0
May 22 16:09:19 iPad VerhaaltjesApp[9707] &lt;Warning&gt;: [ERROR] Storekit.receiptVerificationSandbox: (boolean) true
May 22 16:09:19 iPad VerhaaltjesApp[9707] &lt;Warning&gt;: [ERROR] Storekit.receiptVerificationSandbox: (boolean) true
May 22 16:09:19 iPad VerhaaltjesApp[9707] &lt;Warning&gt;: [ERROR] Storekit.receiptVerificationSandbox: (boolean) true
May 22 16:09:19 iPad VerhaaltjesApp[9707] &lt;Warning&gt;: [ERROR] Storekit.receiptVerificationSandbox: (boolean) true
</pre></code>

In the docs and example code of the module it says <code>receiptVerificationSandbox</code> is a <code>boolean</code> and defaults to <code>false</code>. The tests above show it's a <code>number</code>, that defaults to <code>0</code> but changes to a <code>boolean</code> with value <code>TRUE</code> if you change it to *whatever* value!

This means if you do something like:

<code><pre>
Storekit.receiptVerificationSandbox = (Ti.App.deployType !== 'production');
Storekit.receiptVerificationSandbox = Alloy.CFG.receiptVerificationSandbox;
</pre></code>

Receipts will *always* be verified against the sandbox!

Since you will not know this before the app has been approved (and yes, it will be) this is an extremely critical issue that should be fixed soon. 

Although it is advised by both Apple and Appcelerator to verify receipts on your own back-end server, the in-app verification should and must work - correctly.

<h3>Comments</h3>

<ol>
<li>Jeff English 2013-05-22

   Fixed issue in module with incorrect property type. Updated module (version 2.0.2) will be in the MarketPlace shortly.</li>
<li>Fokke Zandbergen 2013-05-23

   Thanks for your quick response.
   
   I see you now have this line in the <code>app.js</code>:
   
   <code><pre>
   Storekit.receiptVerificationSandbox = (Ti.App.deployType !== 'production');
   </pre></code>
   
   You probably took this from my example, but this test is not valid :) The <code>Ti.App.deployType</code> can also be <code>production</code> if the app is *not* distributed via the App Store, e.g. Ad Hoc.
   
   I don't know if there is any way to detect if the app is distributed via the App Store. If so, then the <code>receiptVerificationSandbox</code> could be removed completely and handled internally.</li>
<li>jammer 2013-06-14

   Hi,
   
   So, now Storekit.receiptVerificationSandbox is real boolean. Good :)
   
   But, did you manage how to make it work during Apple's review?? 
   </li>
<li>Fokke Zandbergen 2013-06-25

   I just removed setting <code>receiptVerificationSandbox</code>, since its default is <code>false</code>.</li>
<li>Shak Hossain 2014-01-03

   Hi Fokke Zandbergen,
   
   I believe this is fixed. Please let me know if this ticket can be closed.
   
   Thanks,
   Shak</li>
<li>Fokke Zandbergen 2014-01-04

   Yeo, was fixed indeed</li>
</ol>


<p><a href="/AC/AC-1744.json">JSON Source</a></p>