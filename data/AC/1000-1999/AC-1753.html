---
title: "[AC-1753] App crashes on Android when firing synthetic geo-location event"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2014-01-31T17:25:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy</td></tr>
<tr><th>Labels</th><td>alloy, android-4.2.2, geolocation</td></tr>
<tr><th>Reporter</th><td>Michael Stelly</td></tr>
<tr><th>Assignee</th><td>Ritu Agrawal</td></tr>
<tr><th>Created</th><td>2014-01-26T20:26:39.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:40:38.000+0000</td></tr>
</table>

<h3>Description</h3>

First, this app works as intended on iOS simulator and iPhone 5. 

I launch the app, navigate to my TableView, and select a row which fires the breakpoint at the custom event. Stepping through the code on my android device, 
I call my geoLocation event <code><pre>Ti.API.fireEvent('getCurrentPosition');</pre></code>
which fires
<code><pre>
Ti.App.addEventListener('getCurrentPosition', function() {
	Ti.Geolocation.getCurrentPosition(updateGeolocation);
});
</pre></code>
which in turn calls
<code><pre>
function updateGeolocation(e) {

	Ti.App.Properties.setDouble('geo.lat', e.coords.latitude);
	Ti.App.Properties.setDouble('geo.lon', e.coords.longitude);

	return;
}
</pre></code>. Upon reaching updateGeoLocation(), the app crashes with an error(see screenshot) with the console output noted in the attached text file. Something is definitely wrong with the geo-location piece because if I comment it out, I can navigate to the row's child record. I tried getting assistance on the forum, but never got any response whatsoever. Finally, when the app launches, it performs a geo-permission test like this:
<code><pre>
function checkGeoPermission() {
	if (Ti.Geolocation.locationServicesEnabled === false) {
		helper.showDialog({
			title : 'Mapping Error',
			message : 'Your device has geo turned off - turn it on.'
		});
	} else {
		if (OS_IOS) {
			var authorization = Ti.Geolocation.getLocationServicesAuthorization();
			if (authorization == Ti.Geolocation.AUTHORIZATION_DENIED) {
				helper.showDialog({
					title : 'Mapping Error',
					message : 'You have disallowed App from running geolocation services.'
				});
			} else if (authorization == Ti.Geolocation.AUTHORIZATION_RESTRICTED) {
				helper.showDialog({
					title : 'Mapping Error',
					message : 'Your system has disallowed App from running geolocation services.'
				});
			}
		}
	}
	return;
};
</pre></code>
I think this may be a bug with how android handles location services. If I can get help resolving it, I would be most grateful.

Regards,
Mike.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-1753_45390/foodtruck-console.txt">foodtruck-console.txt</td></td><td>2014-01-26T20:26:39.000+0000</td><td>25137</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-1753_45391/Screenshot_2014-01-26-13-33-43.png">Screenshot_2014-01-26-13-33-43.png</td></td><td>2014-01-26T20:26:39.000+0000</td><td>68349</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ritu Agrawal 2014-01-27

   I noticed that you are checking Geo permission for iOS platform but not for Android platform. Can you check for permissions on Android platform in checkGeoPermission function as well? It may also be related to not having the correct geo entry in the manifest file. Please provide a simple but complete test case to reproduce this issue.</li>
<li>Michael Stelly 2014-01-28

   Ritu,
   I wasn't able to find any specific Android related location services permission checks in the api. The Ti.Geolocation.Android doc states, 
   
   {quote}Manual configuration is recommended for applications that have more demanding geolocation needs (for example, driving directions). However, for basic geolocation information, *simple mode* geolocation may be sufficient.{quote}
   
   I am using simple mode, so the only check I do for android is in my init() method,
   <code><pre>	if (OS_ANDROID) {
   		Titanium.Geolocation.Android.LocationProvider = Ti.Geolocation.PROVIDER_GPS;
   		Ti.Geolocation.accuracy = Ti.Geolocation.ACCURACY_HIGH;
   	}
   </pre></code>
   If you know of something else in the api that I haven't found, please let me know. As for a test case, I gave you what I have. The app's table view links to an ACS table for which you don't have access, so that won't help you at all. How else can I help move this forward?</li>
<li>Ritu Agrawal 2014-01-29

   Thanks for the update. We need a complete runnable test case that we can run as it is to reproduce exactly the same issue you are running into. You don't need to provide us access to ACS table as you should be able to reproduce this issue without ACS by putting some dummy values in the table view.</li>
<li>Michael Stelly 2014-01-31

   Ritu,
   Please close. It must not be a bug, because I cannot replicate the error with a test case. Sorry to waste your time.
   
   Regards.</li>
<li>Ritu Agrawal 2014-01-31

   No problem [~madcode]. </li>
</ol>


<p><a href="/AC/AC-1753.json">JSON Source</a></p>