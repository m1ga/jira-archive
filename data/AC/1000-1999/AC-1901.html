---
title: "[AC-1901] Javascript Whirlpool implementation causes null-pointer exception"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2014-01-12T06:23:44.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>core, defect, ios</td></tr>
<tr><th>Reporter</th><td>Kenan Sulayman</td></tr>
<tr><th>Assignee</th><td>Ritu Agrawal</td></tr>
<tr><th>Created</th><td>2013-12-10T03:07:07.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:40:49.000+0000</td></tr>
</table>

<h3>Description</h3>

We're requiring client-side hashing for logging into some of our company-internal infrastructure. That is, I took the same code we use on our web-login to Titanium. When pasting the attached code to /any/ place in the code, Titanium will crash with a null-pointer exception.

It looks like Titanium has troubles with reading strings using the \u<0000> notation inside JavascriptCore.

If you like pictures, checkout the attached screenshot.

I can't really do anything without this. Is there a way to hook openSSL's crypto-functions or at least somehow get a working Whirlpool implementation? If not, let's see how this evolves.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-1901_44514/Bildschirmfoto 2013-12-10 um 04.03.17.png">Bildschirmfoto 2013-12-10 um 04.03.17.png</td></td><td>2013-12-10T03:07:07.000+0000</td><td>462025</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-1901_44516/Text 2013.12.10 04-01-34.txt">Text 2013.12.10 04-01-34.txt</td></td><td>2013-12-10T03:13:07.000+0000</td><td>6441</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ritu Agrawal 2013-12-23

   [~kenansulayman] Would it be possible for you to provide a simple Titanium test case that can help us reproduce this issue?</li>
<li>Ritu Agrawal 2014-01-12

   I had to add missing semi colons to the provided test case but it works fine after that. Here is the code and output. Let us know if it does not resolve your issue and we would be happy to reopen the ticket.
   
   <code><pre>
   var wp = (function () {
           var p, c = [],
                   u = [],
                   b, e, v, s, z, w, A;
           for (b = 8; 0 &lt; b--;) c[b] = [];
           for (e = 0; 256 &gt; e; e++)
                   for (b = "\u1823\uc6e8\u87b8\u014f\u36a6\ud2f5\u796f\u9152\u60bc\u9b8e\ua30c\u7b35\u1de0\ud7c2\u2e4b\ufe57\u1577\u37e5\u9ff0\u4ada\u58c9\u290a\ub1a0\u6b85\ubd5d\u10f4\ucb3e\u0567\ue427\u418b\ua77d\u95d8\ufbee\u7c66\udd17\u479e\uca2d\ubf07\uad5a\u8333\u6302\uaa71\uc819\u49d9\uf2e3\u5b88\u9a26\u32b0\ue90f\ud580\ubecd\u3448\uff7a\u905f\u2068\u1aae\ub454\u9322\u64f1\u7312\u4008\uc3ec\udba1\u8d3d\u9700\ucf2b\u7682\ud61b\ub5af\u6a50\u45f3\u30ef\u3f55\ua2ea\u65ba\u2fc0\ude1c\ufd4d\u9275\u068a\ub2e6\u0e1f\u62d4\ua896\uf9c5\u2559\u8472\u394c\u5e78\u388c\ud1a5\ue261\ub321\u9c1e\u43c7\ufc04\u5199\u6d0d\ufadf\u7e24\u3bab\uce11\u8f4e\ub7eb\u3c81\u94f7\ub913\u2cd3\ue76e\uc403\u5644\u7fa9\u2abb\uc153\udc0b\u9d6c\u3174\uf646\uac89\u14e1\u163a\u6909\u70b6\ud0ed\ucc42\u98a4\u285c\uf886".charCodeAt(e /
                           2), b = 0 == (e & 1) ? b &gt;&gt;&gt; 8 : b & 255, v = b &lt;&lt; 1, 256 &lt;= v && (v ^= 285), s = v &lt;&lt; 1, 256 &lt;= s && (s ^= 285), z = s ^ b, w = s &lt;&lt; 1, 256 &lt;= w && (w ^= 285), A = w ^ b, c[0][e] = [0, 0], c[0][e][0] = b &lt;&lt; 24 | b &lt;&lt; 16 | s &lt;&lt; 8 | b, c[0][e][1] = w &lt;&lt; 24 | z &lt;&lt; 16 | v &lt;&lt; 8 | A, b = 1; 8 &gt; b; b++) c[b][e] = [0, 0], c[b][e][0] = c[b - 1][e][0] &gt;&gt;&gt; 8 | c[b - 1][e][1] &lt;&lt; 24, c[b][e][1] = c[b - 1][e][1] &gt;&gt;&gt; 8 | c[b - 1][e][0] &lt;&lt; 24;
           u[0] = [0, 0];
           for (e = 1; 10 &gt;= e; e++) b = 8 * (e - 1), u[e] = [0, 0], u[e][0] = c[0][b][0] & 4278190080 ^ c[1][b + 1][0] & 16711680 ^ c[2][b + 2][0] & 65280 ^ c[3][b + 3][0] & 255, u[e][1] = c[4][b + 4][1] & 4278190080 ^ c[5][b + 5][1] & 16711680 ^ c[6][b + 6][1] &
                   65280 ^ c[7][b + 7][1] & 255;
           var x = [],
                   g = [],
                   m = 0,
                   l = 0,
                   q = [],
                   n = [],
                   h = [],
                   t = [],
                   r = [],
                   y = function() {
                           var a, f, b, k, d;
                           for (f = a = 0; 8 &gt; a; a++, f += 8) t[a] = [0, 0], t[a][0] = (g[f] & 255) &lt;&lt; 24 ^ (g[f + 1] & 255) &lt;&lt; 16 ^ (g[f + 2] & 255) &lt;&lt; 8 ^ g[f + 3] & 255, t[a][1] = (g[f + 4] & 255) &lt;&lt; 24 ^ (g[f + 5] & 255) &lt;&lt; 16 ^ (g[f + 6] & 255) &lt;&lt; 8 ^ g[f + 7] & 255;
                           for (a = 0; 8 &gt; a; a++) r[a] = [0, 0], n[a] = [0, 0], r[a][0] = t[a][0] ^ (n[a][0] = q[a][0]), r[a][1] = t[a][1] ^ (n[a][1] = q[a][1]);
                           for (b = 1; 10 &gt;= b; b++) {
                                   for (a = 0; 8 &gt; a; a++)
                                           for (h[a] = [0, 0], d = 0, k = 56, f = 0; 8 &gt; d; d++, k -= 8, f = 32 &gt; k ? 1 : 0) h[a][0] ^= c[d][n[a - d & 7][f] &gt;&gt;&gt; k % 32 & 255][0],
                                   h[a][1] ^= c[d][n[a - d & 7][f] &gt;&gt;&gt; k % 32 & 255][1];
                                   for (a = 0; 8 &gt; a; a++) n[a][0] = h[a][0], n[a][1] = h[a][1];
                                   n[0][0] ^= u[b][0];
                                   n[0][1] ^= u[b][1];
                                   for (a = 0; 8 &gt; a; a++)
                                           for (h[a][0] = n[a][0], h[a][1] = n[a][1], d = 0, k = 56, f = 0; 8 &gt; d; d++, k -= 8, f = 32 &gt; k ? 1 : 0) h[a][0] ^= c[d][r[a - d & 7][f] &gt;&gt;&gt; k % 32 & 255][0], h[a][1] ^= c[d][r[a - d & 7][f] &gt;&gt;&gt; k % 32 & 255][1];
                                   for (a = 0; 8 &gt; a; a++) r[a][0] = h[a][0], r[a][1] = h[a][1];
                           }
                           for (a = 0; 8 &gt; a; a++) q[a][0] = q[a][0] ^ r[a][0] ^ t[a][0], q[a][1] = q[a][1] ^ r[a][1] ^ t[a][1];
                   };
           p = function(a) {
                   return p.init().add(a).finalize();
           };
           p.init =
                   function() {
                           for (var a = 32; 0 &lt; a--;) x[a] = 0;
                           m = l = 0;
                           g = [0];
                           for (a = 8; 0 &lt; a--;) q[a] = [0, 0];
                           return p;
           };
           p.add = function(a, f) {
                   if (!a) return p;
                   if (!f) {
                           var b, k, d, c = a.toString();
                           b = [];
                           for (k = 0; k &lt; c.length; k++) d = c.charCodeAt(k), 256 &lt;= d && b.push(d &gt;&gt;&gt; 8 & 255), b.push(d & 255);
                           a = b;
                           f = 8 * a.length;
                   }
                   b = 0;
                   k = 8 - (f & 7) & 7;
                   d = m & 7;
                   var e, h = f,
                           c = 31;
                   for (e = 0; 0 &lt;= c; c--) e += (x[c] & 255) + h % 256, x[c] = e & 255, e &gt;&gt;&gt;= 8, h = Math.floor(h / 256);
                   for (; 8 &lt; f;) {
                           c = a[b] &lt;&lt; k & 255 | (a[b + 1] & 255) &gt;&gt;&gt; 8 - k;
                           if (0 &gt; c || 256 &lt;= c) return 0;
                           g[l++] |= c &gt;&gt;&gt; d;
                           m += 8 - d;
                           512 == m && (y(),
                                   m = l = 0, g = []);
                           g[l] = c &lt;&lt; 8 - d & 255;
                           m += d;
                           f -= 8;
                           b++;
                   }
                   0 &lt; f ? (c = a[b] &lt;&lt; k & 255, g[l] |= c &gt;&gt;&gt; d) : c = 0;
                   8 &gt; d + f || (l++, m += 8 - d, f -= 8 - d, 512 == m && (y(), m = l = 0, g = []), g[l] = c &lt;&lt; 8 - d & 255);
                   m += f;
                   return p;
           };
           p.finalize = function() {
                   var a, b, c, e = "",
                           d = [],
                           h = ["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];
                   g[l] |= 128 &gt;&gt;&gt; (m & 7);
                   l++;
                   if (32 &lt; l) {
                           for (; 64 &gt; l;) g[l++] = 0;
                           y();
                           l = 0;
                           g = [];
                   }
                   for (; 32 &gt; l;) g[l++] = 0;
                   g.push.apply(g,x);
                   y();
                   for (b = a = 0; 8 &gt; a; a++, b += 8) c = q[a][0], d[b] = c &gt;&gt;&gt; 24 & 255, d[b + 1] = c &gt;&gt;&gt; 16 & 255, d[b + 2] = c &gt;&gt;&gt; 8 & 255, d[b + 3] = c & 255, c = q[a][1], d[b + 4] = c &gt;&gt;&gt; 24 & 255, d[b + 5] = c &gt;&gt;&gt; 16 & 255, d[b + 6] = c &gt;&gt;&gt; 8 & 255, d[b +
                           7] = c & 255;
                   for (a = 0; a &lt; d.length; a++) e += h[d[a] &gt;&gt;&gt; 4], e += h[d[a] & 15];
                   return e;
           };
   
           return p;
   })();
   
   Ti.API.info("test: " + wp("test"));
   </pre></code>
   
   [INFO] :   test: b913d5bbb8e461c2c5961cbe0edcdadfd29f068225ceb37da6defcf89849368f8c6c2eb6a4c4ac75775d032a0ecfdfe8550573062b653fe92fc7b8fb3b7be8d6</li>
</ol>


<p><a href="/AC/AC-1901.json">JSON Source</a></p>