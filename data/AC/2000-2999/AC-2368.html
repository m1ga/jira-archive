---
title: "[AC-2368] Android: ActionBar not ready at window open event on API 18 (Android 4.3)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2013-08-28T21:46:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>3.1.1, 3.1.2, actionbar, android</td></tr>
<tr><th>Reporter</th><td>Mark Mokryn</td></tr>
<tr><th>Assignee</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Created</th><td>2013-08-21T17:02:10.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:41:23.000+0000</td></tr>
</table>

<h3>Description</h3>

Setting a handler for onHomeIconItemSelected on Android 4.3 has no effect - the home area is highlighted when clicked, but the handler doesn't trigger. This is not a regression of the Ti SDK, buggy on 3.1.1 too. Note that my tiapp.xml is within the specified Titanium compatibility matrix:
<code><pre>
<android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>">
    <tool-api-level>17</tool-api-level>
    <manifest android:installLocation="preferExternal">
        <uses-sdk android:minSdkVersion="10" android:targetSdkVersion="16"/>
    </manifest>
</android>
</pre></code>
Test application attached.

Here is the faulting code:

*win2.xml*
<code><pre>
<Alloy>
	<Window id="win2" class="container" navBarHidden="false">
		<Label text="Close me by clicking on up button"/>
	</Window>
</Alloy>
</pre></code>

*win2.js*
<code><pre>
function closeMe() {
    // this handler doesn't get called on Android 4.3
    $.win2.close();
}

$.win2.addEventListener('open', function() {
	if (OS_ANDROID) {
		var activity = $.win2.getActivity();
		var actionBar = activity.actionBar;
			if (actionBar){
				actionBar.title = 'Click to my left :)';
				actionBar.displayHomeAsUp = true;
				actionBar.onHomeIconItemSelected = closeMe;
			}
	}
});
</pre></code>

*index.xml*
<code><pre>
<Alloy>
	<Window class="container">
		<Label id="label" onClick="doClick">Click this label to open Window 2</Label>
	</Window>
</Alloy>
</pre></code>

*index.js*
<code><pre>
function doClick(e) {  
    Alloy.createController('win2').getView().open();
}

$.index.open();
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-2368_41767/upButtonBug.zip">upButtonBug.zip</td></td><td>2013-08-21T17:02:10.000+0000</td><td>10317841</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Mark Mokryn 2013-08-21

   It's a timing issue with getting activity.actionBar. If I wrap that with with a short timeout (i.e. setTimeout(function() {var actionBar = activity.actionBar;........ then the issue goes away. However - if I delay just the following ActionBar manipulation code the issue persists. BTW - I am now also seeing occasional crashes with ActionBar on API 18 (SDK 3.1.1.GA - not even bothering with 3.1.2.GA since it is much flakier) - "ActionBarImpl can only be used with a compatible window decor layout, source: var actionBar = activity.actionBar". Have never seen this with earlier API levels.</li>
<li>Mark Mokryn 2013-08-22

   If I hook on focus event instead of open - it works.</li>
<li>Hieu Pham 2013-08-28

   </li>
<li>Mark Mokryn 2013-08-29

   </li>
<li>Mark Mokryn 2013-08-30

   </li>
</ol>


<p><a href="/AC/AC-2368.json">JSON Source</a></p>