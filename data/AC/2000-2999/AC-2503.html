---
title: "[AC-2503] Alloy: Migrations bugs"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2013-07-23T22:02:25.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy, Appcelerator CLI</td></tr>
<tr><th>Labels</th><td>Backbone, Models, adapter, migration</td></tr>
<tr><th>Reporter</th><td>Mads Moller</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2013-07-12T11:51:39.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:41:33.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi Tony,

I have two bugs regarding migration in Alloy.

*Bug/unexpected result 1:*

When doing a migration with the *sql* adapter, the script fails when executing migrations on first run on a fresh installed app. This is because the migration script will go through each migration, without creating the table beforehand. Hence, the first migration MUST include the definition of the table. e.g. 

<code><pre>
migration.up = function(migrator) {
	migrator.createTable({
		"columns": {
		    "id": "INTEGER",
		    "title": "TEXT",
		    "icon": "TEXT",
		    "type": "TEXT",
		    "parent_id": "INTEGER"
		}
	});
	
	migrator.db.execute('ALTER TABLE ' + migrator.table + ' ADD COLUMN sort INT;');
};
</pre></code>

But this is not logical. In my opinion the best approach would be to have the adapter create the table if it does not exists and afterwards go through all the migrations. In this manner, the above migration should only be:

<code><pre>
migration.up = function(migrator) {
	migrator.db.execute('ALTER TABLE ' + migrator.table + ' ADD COLUMN sort INT;');
};
</pre></code>

Make sense? 


*Bug 2:*
This might be a tooling issue, but here we go.
When I want to create a new migration for a model, its not possible because it already have a migration. This is wrong, because the migrations are controlled by timestamps, so its the idea to have the same name. Please look at the attachment migration.png. 


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-2503_40708/migration.png">migration.png</td></td><td>2013-07-12T11:51:39.000+0000</td><td>25994</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-07-12

   1. I don't know, I think I prefer the usage of migrations to be explicit. If you don't use migrations, the table will be created automatically. If you do use migrations, the assumption is that you should handle things manually as you may need to do something before you even create the table. I don't think that's one I'm going to change, but if you have a more compelling argument I'm all ears.
   
   2. This would be a TISTUD issue, as this is definitely not a limitation imposed by Alloy. I will bring [~mxia] into the conversation so that he can get it addressed in Studio.</li>
<li>Michael Xia 2013-07-12

   The No. 2 is covered in TISTUD-2300 and fixed for the upcoming 3.1.2 release. If you would like to update to it now, you could use the update site <a href="http://preview.appcelerator.com/appcelerator/studio/standalone/update/beta/." rel="nofollow" target="_blank">http://preview.appcelerator.com/appcelerator/studio/standalone/update/beta/.</a>
   </li>
</ol>


<p><a href="/AC/AC-2503.json">JSON Source</a></p>