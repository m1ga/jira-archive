---
title: "[AC-2521] ActionBar.setActionView() not executed in the UI Thread"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2013-05-07T21:34:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>android</td></tr>
<tr><th>Reporter</th><td>Thomas Keunebroek</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2012-12-13T10:28:37.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:41:35.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi,
I'm using the new Titanium version, that adds Android's ActionBar support. I have a refresh button as Action, and I'd like to display an ActivityIndicator where the user presses it, while the view is being refreshed.

Here's a very simple piece of code:

<code><pre>
var activity = win.activity;
	activity.onCreateOptionsMenu = function(e) {
	var menu = e.menu;
	var refresh = menu.add({
		title: 'Refresh',
		icon: Titanium.App.Android.R.drawable.ic_menu_refresh,
		showAsAction: Ti.Android.SHOW_AS_ACTION_ALWAYS
	});
	refresh.addEventListener('click', function() {
		var activityIndicator = Ti.UI.createActivityIndicator({
			color: 'white',
			font: {
				 fontFamily: 'Droid Sans',
				 fontSize: 26,
				 fontWeight: 'bold'
			},
			style: Ti.UI.ActivityIndicatorStyle.PLAIN,
		});
		this.setActionView(activityIndicator);
	});
</pre></code>

I end up with a Ti Runtime Error, as shown in the attachment. 

Thanks for your help guys!

EDIT: sorry, should be moved to the TIMOB project. Can't figure out how to do it myself though

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-2521_34144/setActionView_error.png">setActionView_error.png</td></td><td>2012-12-13T10:28:37.000+0000</td><td>46637</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Carter Lathrop 2013-05-07

   Thomas,
   
   Thanks for bringing this to our attention. In order for a community ticket (TC) to be moved to Mobile it has to be first verified, this is why you cannot move it yourself. As for your ticket, would you mind providing a runnable test case that shows the behavior. Having an app.js that can be easily copied and pasted into a project that can clearly show the bug allows for a speedy review and transition to Ti-Mobile. Once the test case is provided I will gladly take a look at it. For future reference:
   <a href="https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report</a>
   Thanks for your cooperation,
   Carter</li>
<li>Mostafizur Rahman 2013-12-10

   Hello,
   
   We tested this issue with the test code below. We canâ€™t reproduce this issue in Ti SDK 3.1.3GA. Please install the latest SDK and test your app. If you continue to get error, please send us a test case with steps to reproduce. 
   
   <h4>Testing Environment:</h4>
   Ti CLI 3.3.0
   Titanium SDK: 3.1.3 and later   
   Android SDK: 4.2.2 
   
   <h4>Test Code</h4>
   
   app.js
   <code><pre>
   var win = Ti.UI.createWindow({
   	navBarHidden : false,
   	title : 'Action Bar',
   	backgroundColor : '#000'
   
   });
   
   // var activity = win.activity;
   win.activity.onCreateOptionsMenu = function(e) {
   	var menu = e.menu;
   	var refresh = menu.add({
   		title : 'Refresh',
   		showAsAction : Ti.Android.SHOW_AS_ACTION_ALWAYS
   	});
   
   	refresh.addEventListener('click', function() {
   		var activityIndicator = Ti.UI.createActivityIndicator({
   			color : 'white',
   			font : {
   				fontSize : 26,
   				fontWeight : 'bold'
   			},
   			style : Ti.UI.ActivityIndicatorStyle.DARK,
   		});
   		this.setActionView(activityIndicator);
   	});
   
   };
   
   win.open(); 
   
   </pre></code>
   
   
   tiapp.xml
   
   <code><pre>
    &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
           &lt;tool-api-level&gt;16&lt;/tool-api-level&gt;
           &lt;manifest&gt;
               &lt;uses-sdk android:minSdkVersion="8" android:targetSdkVersion="16"/&gt;
           &lt;/manifest&gt;
       &lt;/android&gt;
   
   </pre></code>
   
   
   <h4>Steps to Test</h4>
   
   1. Create a sample Project
   2. Update app.js file with my test code
   3. Update tiapp.xml file with above code 
   4. And run this project with testing environment
   
   Thanks </li>
<li>Shak Hossain 2014-01-20

   Closing since the issue is not reproducible and the reporter has not got back to us with any further updated comments.</li>
</ol>


<p><a href="/AC/AC-2521.json">JSON Source</a></p>