---
title: "[AC-2697] Setting dataCollection or dataFilter on a Ti.UI.View via <Widget> or <Require> doesn't work"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2014-06-30T07:30:48.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy</td></tr>
<tr><th>Labels</th><td>alloy, arguments</td></tr>
<tr><th>Reporter</th><td>Lee Driscoll</td></tr>
<tr><th>Assignee</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Created</th><td>2013-11-08T11:28:23.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:41:48.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi there,

I wish to set-up custom binding logic for a widget using as much standard TiAPI principles as possible.

I have the following XML:

views/scheduler.xml
<code><pre>
&lt;Alloy&gt;
	&lt;Collection src="job" /&gt;
	&lt;Window title="Scheduler" navBarHidden="false" layout="vertical"&gt;
		&lt;Widget src="uk.co.mycompany.scheduler" dataCollection="job" dataTransform="transformFn" dataFilter="filterFn" startDate="Date.today()" id="schedulerWidget" /&gt;
	&lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

In my widget's controller I have the following (lazy) tests:

widgets/uk.co.mycompany.scheduler/controllers/widget.js
<code><pre>
var args = arguments[0] || {};
args['dataCollection'] || Alloy.Globals.Log.error('[FAIL] dataCollection required parameter');
args['dataFilter'] || Alloy.Globals.Log.error('[FAIL] dataFilter required parameter');
args['dataTransform'] || Alloy.Globals.Log.error('[FAIL] dataTransform required parameter');
</pre></code>

When I run the code, only dataTransform is present in the arguments object.

I have tested in a variety of scenarios, also using the <Require> tag. The results were always the same.

Lee.

<h3>Comments</h3>

<ol>
<li>Mauro Parra-Miranda 2013-11-21

   Hello Lee! 
   
   Can you please help us with a complete test case? Currently your test case fails because there is no model. 
   
   Best,
   
   Mauro </li>
<li>Lee Driscoll 2013-11-21

   Hi Mauro !
   
   Apologies for that - here's is the model file
   
   What else do you need?
   
   models/job.js
   <code><pre>
   var moment = require('alloy/moment');
   
   exports.definition = {
       config : {
           columns : {
               'jobID' : 'TEXT',
               'description' : 'TEXT',
               'location' : 'TEXT',
               'startTime' : 'TEXT',
               'endTime' : 'TEXT',
               'story' : 'BLOB'
           },
           adapter : {
               idAttribute : 'jobId',
               type : Ti.Platform.name == 'mobileweb' ? 'localStorage' : 'sql',
               db_name : 'jobs',
               collection_name : 'job'
           }
       },
       extendModel : function(Model) {
           if (Model && Model.prototype) {
               _.extend(Model.prototype, {
                   // extended functions and properties go here
               });
           }
   
           return Model;
       },
       extendCollection : function(Collection) {
           if (Collection && Collection.prototype) {
               _.extend(Collection.prototype, {
                   getByWeek : function(weekStart) {
   
                       var weekEnd = moment(weekStart).add('d', 7),
                           sqlQuery,
                           results;
   
                       sqlQuery = ' \
                           SELECT * FROM job \
                           WHERE startTime \
                           BETWEEN ' + weekStart + ' AND ' + weekEnd + '\
                           OR endTime \
                           BETWEEN ' + weekStart + ' AND ' + weekEnd;
   
                       results = this.fetch({
                           query : sqlQuery
                       });
   
                       if (results) {
                           Ti.API.info('Requested jobs found: ' + results);
                       } else {
                           Ti.API.info('No jobs found: ' + results);
                       }
   
                       return results;
                   }
                   // extended functions and properties go here
               });
           }
   
           return Collection;
       }
   }; 
   </pre></code></li>
<li>Mauro Parra-Miranda 2013-12-04

   Hello Lee,
   we will need the widget as well, so we can test exactly the same code than you.
   
   Best,
   Mauro </li>
<li>Mauro Parra-Miranda 2014-06-30

   We didn't get a response from customer. </li>
</ol>


<p><a href="/AC/AC-2697.json">JSON Source</a></p>