---
title: "[AC-2795] iOS: UI.iPhone - NavigationGroup.close() crashes with EXC_BAD_ACCESS"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2011-12-28T06:37:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Paul Mietz Egli</td></tr>
<tr><th>Assignee</th><td>Paul Dowsett</td></tr>
<tr><th>Created</th><td>2011-11-06T16:07:40.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:47:43.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

<code>Ti.UI.iPhone.NavigationGroup.close()</code> crashes with EXC_BAD_ACCESS

<h4>Test case</h4>

When using an unmodified 1.8.20111028x CI build, the following testcase generally crashes with EXC_BAD_ACCESS after 2 to 10 presses of the "Start Test" button.

<code><pre>
var root = Ti.UI.createWindow({
  title: 'Root Window',
  backgroundColor: 'white',
  layout: 'vertical',
});

var startButton = Ti.UI.createButton({
  title: 'Start Test',
  height:'50dp',
  width:'200dp',
  top:'20dp',  
});
startButton.addEventListener('click', function() {
  // for (;;) {
    var windows = [], n = Math.floor(Math.random() * 10) + 3;
    for (var i=0; i &lt; n; i++) {
      var w = Ti.UI.createWindow({
        title: 'Window '+i,
        backgroundColor: 'white',
        layout: 'vertical',
      });
      windows.push(w);
      navgroup.open(w, {animated:false});
      Ti.API.info('opened '+w.title);
    }
    
    while (windows.length &gt; 0) {
      var winToClose = windows.pop();
      navgroup.close(winToClose, { animated: false});
      Ti.API.info('closed '+w.title);
    }
  // }
});
root.add(startButton);

var navgroup = Ti.UI.iPhone.createNavigationGroup({
  window: root
});

var container = Ti.UI.createWindow();
container.add(navgroup);
container.open();

</pre></code>

<h4>Solution</h4>

Running the app under Instruments shows that a message is being sent to a deallocated object in the <code>createProxy:forName:context: method in TiModule.m</code> (line 155 in the referenced build).  The actual problem appears to be in the <code>close:withObject: method of  TiUIiPhoneNavigationGroup.m</code>.

The following changes to <code>TiUIiPhoneNavigationGroup.m</code> resolves the issue:

<code><pre>
@@ -117,8 +119,9 @@
 	NSMutableArray* newControllers = [NSMutableArray arrayWithArray:controller.viewControllers];
 	BOOL animated = [TiUtils boolValue:@"animated" properties:properties def:(windowController == [newControllers lastObject])];
 	[newControllers removeObject:windowController];
-	[closingProxy autorelease];
-	closingProxy = [window retain];
+//	[closingProxy autorelease];
+//	closingProxy = [window retain];
+    [window close:nil];
 	[controller setViewControllers:newControllers animated:animated];
 	
 }
@@ -152,9 +155,9 @@
 		}
 		[self setVisibleProxy:newWindow];
 	}
-	[closingProxy close:nil];
-	[closingProxy release];
-	closingProxy = nil;
+//	[closingProxy close:nil];
+//	[closingProxy release];
+//	closingProxy = nil;
 	opening = NO;
 	[newWindow windowDidOpen];
 }
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-2795_24069/app.js">app.js</td></td><td>2011-11-07T08:03:32.000+0000</td><td>995</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Paul Mietz Egli 2011-11-06

   After some additional testing, I was able to avoid the leak by making the following changes to TiUIiPhoneNavigationGroup.m:
   
   <code><pre>
   @@ -117,8 +119,9 @@
    	NSMutableArray* newControllers = [NSMutableArray arrayWithArray:controller.viewControllers];
    	BOOL animated = [TiUtils boolValue:@"animated" properties:properties def:(windowController == [newControllers lastObject])];
    	[newControllers removeObject:windowController];
   -	[closingProxy autorelease];
   -	closingProxy = [window retain];
   +//	[closingProxy autorelease];
   +//	closingProxy = [window retain];
   +    [window close:nil];
    	[controller setViewControllers:newControllers animated:animated];
    	
    }
   @@ -152,9 +155,9 @@
    		}
    		[self setVisibleProxy:newWindow];
    	}
   -	[closingProxy close:nil];
   -	[closingProxy release];
   -	closingProxy = nil;
   +//	[closingProxy close:nil];
   +//	[closingProxy release];
   +//	closingProxy = nil;
    	opening = NO;
    	[newWindow windowDidOpen];
    }
   </pre></code></li>
<li>Paul Mietz Egli 2011-11-07

   I've attached sample code to help reproduce the crash.  When using an unmodified 1.8.20111028x CI build, the app generally crashes for me after one or two presses of the "Start Test" button.  If TiUIiPhoneNavigationGroup.m is modified as described above, the code runs fine.  </li>
<li>Paul Dowsett 2011-12-28

   Paul
   
   Do you know if this has been resolved in 1.8.0.1? Does your test case still exhibit the same issue?
   
   Thank you for including the solution to this. In order for us to use any of your code, you will need to sign the CLA. See [Signing the Contributors License Agreement (CLA)](<a href="https://wiki.appcelerator.org/display/guides/How+to+Contribute+Code#HowtoContributeCode-SigningtheContributorsLicenseAgreement%28CLA%29)" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Contribute+Code#HowtoContributeCode-SigningtheContributorsLicenseAgreement%28CLA%29)</a> for info. Have you done this, or do we need to organize it?
   
   Thanks</li>
<li>Paul Dowsett 2012-02-17

   Closing due to inactivity. If this issue still exists, please raise a new ticket, including all the information in the [JIRA Ticket Checklist](<a href="https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-JIRATicketChecklist)" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-JIRATicketChecklist)</a> to ensure that we can escalate it quickly. Read [How to Submit a Bug Report](<a href="https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report)" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report)</a> if you have not read it before, and always start a ticket using the [JIRA Ticket Template](<a href="https://wiki.appcelerator.org/display/guides/JIRA+Ticket+Template)." rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/JIRA+Ticket+Template).</a>
   
   Thanks in advance</li>
</ol>


<p><a href="/AC/AC-2795.json">JSON Source</a></p>