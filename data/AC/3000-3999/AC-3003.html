---
title: "[AC-3003] global `setTimeout()` short-circuits the target object"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2012-05-29T22:34:17.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>settimeout, testing</td></tr>
<tr><th>Reporter</th><td>Kenneth Kan</td></tr>
<tr><th>Assignee</th><td>Betty Tran</td></tr>
<tr><th>Created</th><td>2012-05-25T15:52:27.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:48:01.000+0000</td></tr>
</table>

<h3>Description</h3>

setTimeout seems to break method replacements by spies. The <code>this</code> in object <code>a</code> does not refer to the same <code>c</code> as replaced by the spy. Tried this on SDK 1.7.0, 1.8.2, and 2.0.1 with Sinon.js and Jasmine testing frameworks.

{noformat}
a = {
  b: function() {
    Ti.API.debug("a.b() called");
    this.c();
  },
  c: function() {
    Ti.API.debug("a.c() called");
  }
};
 
describe("some test suite", function(){
  it("some test case", function(){
    setTimeout(function(){ a.b(); }, 1000);
    // or setTimeout(function(){ eval("a.b();"); }, 1000);
 
    spyOn(a, "b");
    spyOn(a, "c");
    // or sinon.spy(a, "b");
    //    sinon.spy(a, "c");
 
    // After 1 second...
    // "[DEBUG] a.b() called" is printed to terminal
    // "[DEBUG] a.c() called" is printed to terminal
    expect(a.b.callCount).toEqual(0); // succeed
    expect(a.b).toHaveBeenCalled(); // fail
    expect(a.c.callCount).toEqual(0); // succeed
    expect(a.c).toHaveBeenCalled(); // fail
  });
});
{noformat}

<h3>Comments</h3>

<ol>
<li>Kenneth Kan 2012-05-29

   My apology. This is actually valid behavior. Because I used jasmine-titanium the test suite output is on the simulator and I made incorrect assumption. After having attached timestamp to the output. The order is correct. Someone with the authority to close this ticket please do so. Thank you.</li>
<li>Betty Tran 2012-05-29

   Ticket closed as this is valid behavior.</li>
<li>Shak Hossain 2013-12-27

   Closing as per Kenneth's comment.</li>
</ol>


<p><a href="/AC/AC-3003.json">JSON Source</a></p>