---
title: "[AC-3321] Alloy with HTML Parser not working certain use case - "'undefined' is not a constructor"
---
<table>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2014-07-29T07:00:35.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy</td></tr>
<tr><th>Labels</th><td>defect</td></tr>
<tr><th>Reporter</th><td>Axil Rolce</td></tr>
<tr><th>Assignee</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Created</th><td>2014-03-26T03:23:02.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-08T07:57:45.000+0000</td></tr>
</table>

<h3>Description</h3>

I tried Alloy with HTML parser based on <a href="http://developer.appcelerator.com/question/60731/what-is-the-best-way-to-parse-html" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/60731/what-is-the-best-way-to-parse-html</a>
It works at the beginning and then after going to background and foreground it doesnt work. And causes this error "'undefined' is not a constructor (evaluating 'new htmlparser.DefaultHandler')";

You can download this sample app I made: <a href="https://github.com/axilaris/testnavhtmlparser" rel="nofollow" target="_blank">https://github.com/axilaris/testnavhtmlparser</a>

this is the parsing code: <a href="https://github.com/axilaris/testnavhtmlparser/blob/master/app/controllers/nextwin.js" rel="nofollow" target="_blank">https://github.com/axilaris/testnavhtmlparser/blob/master/app/controllers/nextwin.js</a>

this is how I call push the window <a href="https://github.com/axilaris/testnavhtmlparser/blob/master/app/controllers/index.js" rel="nofollow" target="_blank">https://github.com/axilaris/testnavhtmlparser/blob/master/app/controllers/index.js</a>

here are the parsing code: <a href="https://github.com/axilaris/testnavhtmlparser/tree/master/app/assets/lib" rel="nofollow" target="_blank">https://github.com/axilaris/testnavhtmlparser/tree/master/app/assets/lib</a>

Steps to reproduce: 
1. click nextWindow 
2. click getPageandParse - no problem parsing 
3. click back - i even tried explicitly closing the window with .close(), didnt work 
4. click getPageandParse - the error below pops up

Error output: 
"'undefined' is not a constructor (evaluating 'new htmlparser.DefaultHandler')";


error dump [ERROR] : Script Error { [ERROR] : backtrace = "#0 () at :0"; [ERROR] : line = 17; [ERROR] : message = "'undefined' is not a constructor (evaluating 'new htmlparser.DefaultHandler')"; [ERROR] : name = TypeError; [ERROR] : sourceId = 276543488; [ERROR] : sourceURL = "file:///Users/test/Library/Application%20Support/iPhone%20Simulator/7.0.3-64/Applications/9D672583-9B94-45E8-A75F-9EE090202C13/testnavhtmlparser.app/alloy/controllers/nextwin.js"; 


I tried backslash on Ti.include, I tried to that particular window. This always happen when the window goes to background and foreground again. Very strange.

Titanium SDK 3.2.2 GA
Titanium Studio, build: 3.2.1.201402041146
OSX 10.9.2
IOS 7
XCode 5.0.2



<h3>Comments</h3>

<ol>
<li>Mostafizur Rahman 2014-07-08

   Hello,
   
   We have tested this sample code. This is not titanium bug. Its report coding issue.  
   
    As per our docs, include mechanism is not supported with Alloy projects.
     
   We recommended instead of include method please create a CommonJS module and use the require () method to include external JavaScript code.
    
   For more information please visit following link: <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium-method-include
   
   Thanks 
   </li>
<li>Mauro Parra-Miranda 2014-07-29

   Please don't use include in Alloy. </li>
</ol>


<p><a href="/AC/AC-3321.json">JSON Source</a></p>