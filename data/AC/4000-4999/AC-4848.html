---
title: "[AC-4848] ACS push notifications break"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2017-03-16T14:11:01.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Appcelerator Studio 4.5.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Arrow Push</td></tr>
<tr><th>Labels</th><td>android, defect</td></tr>
<tr><th>Reporter</th><td>Zarir Bhesania</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2017-03-09T17:31:55.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-16T14:11:01.000+0000</td></tr>
</table>

<h3>Description</h3>

ACS push notifications are breaking. It displays JSON payload in the notification body. Please check the attached screenshot. I am assuming the break is due to some special character like hyphen.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-4848_61810/1.jpeg">1.jpeg</td></td><td>2017-03-09T17:27:00.000+0000</td><td>128687</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2017-03-09

   Hello, I tested ACS push. It's working fine. Please share code that you are using. I am using a sample code from <a href="http://titaniumsolution.blogspot.com/2016/12/sending-push-via-firebase-api-key.html." rel="nofollow" target="_blank">http://titaniumsolution.blogspot.com/2016/12/sending-push-via-firebase-api-key.html.</a> Thanks.</li>
<li>Zarir Bhesania 2017-03-09

   The notification is sent from the php server. Its not the front end code that breaks the notifications, its something with the server side push. I am pasting the code below
   
   <?php
       $key        = "********************";
       $username   = "**************";
       $password   = "***************";
   
       $to_tokens  = $_REQUEST["device_token"]=="all"? "everyone" : $_REQUEST['device_token'];
       $channel    = "PUSH";
       $message    = $_REQUEST['message'];
       $title      = trim($_REQUEST["title"]);	
      $payload_type = trim($_REQUEST["payload"]);
   	
       $tmp_fname  = 'cookie.txt';
   	
       $json       = '{"alert":"'. $message .'","title":"'. $title .'","badge":+1,"vibrate":true,"sound":"default", "icon":"notify", "pl":"'.$payload_type.'"}';//, "param":"'.$payload_param.'"
    	
    	//print_r($json); exit;
           /*** PUSH NOTIFICATION ***********************************/
           $post_array = array('login' => $username, 'password' => $password);
   
           /*** INIT CURL *******************************************/
           $curlObj    = curl_init();
           $c_opt      = 	array(CURLOPT_URL => '<a href="https://api.cloud.appcelerator.com/v1/users/login.json?key=" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/users/login.json?key=</a>'.$key,
                               CURLOPT_COOKIEJAR => $tmp_fname, 
                               CURLOPT_COOKIEFILE => $tmp_fname, 
                               CURLOPT_RETURNTRANSFER => true, 
                               CURLOPT_POST => 1,
                               CURLOPT_POSTFIELDS => "login=" . $username . "&password=" . $password,
                               CURLOPT_FOLLOWLOCATION  =>  1,
                               CURLOPT_TIMEOUT => 60);
   
           /*** LOGIN **********************************************/
   
           curl_setopt_array($curlObj, $c_opt); 
           $session = curl_exec($curlObj);     
   
           /*** SEND PUSH ******************************************/
           
           $c_opt[CURLOPT_URL]         = '<a href="https://api.cloud.appcelerator.com/v1/push_notification/notify_tokens.json?key=" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/push_notification/notify_tokens.json?key=</a>'.$key; 
           $c_opt[CURLOPT_POSTFIELDS]  = "channel=".$channel."&payload=".$json."&to_tokens=".$to_tokens; 
           curl_setopt_array($curlObj, $c_opt); 
           $session = curl_exec($curlObj);
   
           /*** THE END ********************************************/
           curl_close($curlObj);
           header('Content-Type: application/json');
           die(json_encode(array('response' => json_decode($session)))); 
   ?>
   </li>
<li>Sharif AbuDarda 2017-03-10

   So, you are not using our ArrowDB server for push? We checked and the push is fine from ArrowDB. The problem is with your php script. Can you try with the code here <a href="https://gist.github.com/ricardoalcocer/51b63b6ddba293c83c3e" rel="nofollow" target="_blank">https://gist.github.com/ricardoalcocer/51b63b6ddba293c83c3e</a> ? Thanks.</li>
<li>Hans Kn√∂chel 2017-03-10

   Check [this link](<a href="https://www.fusetools.com/community/forums/general/push_notifications_body_json_structure)" rel="nofollow" target="_blank">https://www.fusetools.com/community/forums/general/push_notifications_body_json_structure)</a> that states that Android notification responses are usually under the "notification" object I guess.</li>
<li>Zarir Bhesania 2017-03-10

   @Sharif The gist link you pasted has identical code as mine accept for one thing. My code has header('Content-Type: application/json'); which is not present in the link.
   </li>
<li>Sharif AbuDarda 2017-03-14

   Hello [~zarirbhesania@gmail.com], Can you get back on Hans comment? Thanks. </li>
<li>Zarir Bhesania 2017-03-16

   Hi Sharif AbuDarda,
   
   I figured out the issue. The push payload was breaking because of "&" used in the title/message. With URL encode this issue is resolved. For both iOS and android common payload structure is used.</li>
<li>Sharif AbuDarda 2017-03-16

   Thanks for letting us know. Closing the issue. </li>
</ol>


<p><a href="/AC/AC-4848.json">JSON Source</a></p>