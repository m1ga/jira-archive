---
title: "[AC-4864] Callback not called in requestLocationPermissions on Android"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-03-27T18:39:16.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Debuisson Eugène</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2017-03-20T14:24:41.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-06T07:47:55.000+0000</td></tr>
</table>

<h3>Description</h3>

Hello,

When I use Ti.Geolocation.requestLocationPermissions the callback is not called at all on Android. I tried to put Ti.API.error or alert in it but nothing happened.

<code><pre>
Ti.Geolocation.requestLocationPermissions(Titanium.Geolocation.AUTHORIZATION_ALWAYS, function(e) {
            Ti.API.error('hello');
            Ti.API.error(JSON.stringify(e));
        });
}}
</pre></code>

I'm using SDK 6.0.2 and building on Android.

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2017-03-20

   Hello, AUTHORIZATION_ALWAYS is only for iOS and windows app. Not supported for Android. I can get the logs by the below code.
   <code><pre>
   var win = Ti.UI.createWindow({
       theme : "Theme.AppCompat.Fullscreen",
       backgroundColor : '#fff'
   });
   
   var btn = Ti.UI.createButton({
       title : 'Pick',
       top : 50,
   });
   btn.addEventListener('click', function() {
       Ti.Geolocation.requestLocationPermissions(Titanium.Geolocation.AUTHORIZATION_ALWAYS, function(e) {
           Ti.API.error('hello');
           Ti.API.error(JSON.stringify(e));
       });
   });
   win.add(btn);
   
   win.open();
   </pre></code>
   
   Location permissinon popup opens and allowing that gives this response.
   <code><pre>
   [ERROR] :  hello
   [ERROR] :  {"code":0,"success":true}
   </pre></code>
   
   Once the permission is granted later try would not show the permission popup and the log for click on the button. You need to remove the permission from settings. There seems to be no issue here. Thanks.</li>
<li>Debuisson Eugène 2017-03-21

   In the docs I saw requestLocationPermissions was for Android too but didn't check the authorization type.
   
   So I tried this: 
   
   {noformat}
   Ti.Android.requestPermissions(["android.permission.ACCESS_FINE_LOCATION"], function(e) {
   alert('hey');
   Ti.API.error(JSON.stringify(e));
   });
   {noformat}
   
   And put <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/> into the manifest in the tiapp.xml. but still the callback is never called.
   
   Any idea why this isn't working ?</li>
<li>Sharif AbuDarda 2017-03-21

   Hello, Try this sample code as a workaround.
   
   <code><pre>
   var win = Ti.UI.createWindow();
   var locationPermission = "android.permission.ACCESS_FINE_LOCATION";
   var hasLocationPermission = Ti.Android.hasPermission(locationPermission);
   var permissionsToRequest = [];
   
   if (!hasLocationPermission) {
       permissionsToRequest.push(locationPermission);
   }
   if (permissionsToRequest.length &gt; 0) {
       Ti.Android.requestPermissions(permissionsToRequest, function(e) {
           if (e.success) {
               Ti.API.info("SUCCESS");
               win.open();
           } else {
               Ti.API.info("ERROR: " + e.error);
           }
       });
   }
   if (hasLocationPermission) {
       win.open();
   }
   
   </pre></code>
   </li>
<li>Debuisson Eugène 2017-03-22

   Hello,
   
   I tried that workaround but the callback isn't called.</li>
<li>Sharif AbuDarda 2017-03-22

   Hello, Send the full code you are testing. The code I sent is working perfectly. It shows the success log. Thanks.</li>
<li>Debuisson Eugène 2017-03-23

   I tried it in a new project.</li>
<li>Sharif AbuDarda 2017-03-23

   Hello, Are you using my code? use the below code
   
   <code><pre>
   var win = Ti.UI.createWindow({
       theme : "Theme.AppCompat.Fullscreen",
       backgroundColor : '#fff'
   });
   
   var locationPermission = "android.permission.ACCESS_FINE_LOCATION";
   var hasLocationPermission = Ti.Android.hasPermission(locationPermission);
   
   Ti.Android.requestPermissions(["android.permission.ACCESS_FINE_LOCATION"], function(e) {
   
       if (e.success) {
           Ti.API.info("SUCCESS");
           win.open();
           alert("SUCCESS");
   
       } else {
           Ti.API.info("ERROR: " + e.error);
       }
   });
   if (hasLocationPermission) {
       win.open();
   }
   </pre></code>
   
   Callback only calls on first run on device. After you grant the access the callback calls and window opens. If you remove the permission from setting it should call again.
   
   Make sure you set 
   <code><pre>
               &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/&gt;
   </pre></code> in tiapp.xml. Thanks.</li>
<li>Debuisson Eugène 2017-03-24

   Hello,
   
   This code works for me ! Thanks !</li>
<li>Mitul Bhalia 2018-03-06

   The above code does not work for me with 6.0.2 and with 6.3.1 too.
   
   It does not call success or error callback.
   
   Can somebody help me to sort this out?</li>
</ol>


<p><a href="/AC/AC-4864.json">JSON Source</a></p>