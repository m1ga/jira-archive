---
title: "[AC-5081] iOS: 6.1.1 GA / removeEventListener under addEventListener without error?"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2017-07-19T18:50:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Maxim Khrichtchatyi</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2017-07-12T17:51:54.000+0000</td></tr>
<tr><th>Updated</th><td>2017-07-19T18:50:56.000+0000</td></tr>
</table>

<h3>Description</h3>

Titanium SDK 6.1.0 GA – the below code works successfully
Titanium SDK 6.1.1 GA – Error 

<code><pre>
[ERROR] :      message = "Invalid type passed to function";
[ERROR] :      nativeLocation = "-[TiProxy addEventListener:] (TiProxy.m:838)";
[ERROR] :      nativeReason = "expected: Function, was: String";
</pre></code>


Help to fix the bug and correct me if I did something wrong.

<code><pre>
    var avatar = {
	    RemoteImage: function(a) {
			a = a || {};

			var md5;
			var needsToSave = false;
			var savedFile;

			if (a.image) {
				md5 = Ti.Utils.md5HexDigest(a.image) + '.png';
				savedFile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, md5);

				if (savedFile.exists()) {
					a.image = savedFile;
				}
				else {
					needsToSave = true;
				}
			}

			if (needsToSave == true) {
				var image = Ti.UI.createImageView(a);

				function saveImage(e) {
					image.removeEventListener('load', saveImage);
					savedFile.write(
						image.toImage(null, true)
					);
				};

				image.addEventListener('load', saveImage);

				function defaultAvatar(e) {
					image.setImage(a.data_user_avatar_default);
					image.removeEventListener('error', defaultAvatar);
				};

				image.addEventListener('error', defaultAvatar);
			}
			else {
				var image = Ti.UI.createImageView(a);
			}

			return image;
		}
	};

        var profileAvatar = avatar.RemoteImage({
		image: '<a href="https://www.gravatar.com/avatar/image.png" rel="nofollow" target="_blank">https://www.gravatar.com/avatar/image.png</a>',
	        data_user_avatar_default: '<a href="https://www.gravatar.com/avatar/md5.png" rel="nofollow" target="_blank">https://www.gravatar.com/avatar/md5.png</a>',
		defaultImage: '/img/avatar_preload.png',
		width: 60,
		height: 60
	});
</pre></code>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2017-07-14

   Hello, please share a full reproducible test code. </li>
</ol>


<p><a href="/AC/AC-5081.json">JSON Source</a></p>