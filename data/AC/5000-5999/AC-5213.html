---
title: "[AC-5213] appcelerator.https - Invalid certificate accepted if valid certificate was accepted before only for iOS"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2017-09-20T15:22:25.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Manasa Chirumamilla</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2017-09-20T05:04:35.000+0000</td></tr>
<tr><th>Updated</th><td>2017-09-20T15:22:25.000+0000</td></tr>
</table>

<h3>Description</h3>

As per the appcelerator document Modules.Https, when an invalid secure certificate is passed through the security manager an error "Leaf certificate could not be verified with provided public key" is reported. But this is working fine with the first request only
When passing the valid secure certificate for the first URL request and an invalid certificate for the next URL request of the same domain the error isn't been logged. Or if we didn't apply the security manager for the first request and apply the valid security certificate to the next request of the same domain then also error isn't been logged.

EX:
var url1 = "<a href="http://www.appcelerator.com/" rel="nofollow" target="_blank">http://www.appcelerator.com/</a>";
    var securityManager = https.createX509CertificatePinningSecurityManager([
    {
        url: url1,
        serverCertificate: "appcelerator.com.der",
    }
]);
    var httpClient = Ti.Network.createHTTPClient({
    onload: firstSuccess,
    onerror: firstfailure,
    timeout : 5000,
    securityManager: securityManager,
    validatesSecureCertificate : true,
 });
httpClient.open("GET", url1); 
httpClient.send();
 
var url2 = "<a href="https://www.appcelerator.com/mobile-app-development-products/" rel="nofollow" target="_blank">https://www.appcelerator.com/mobile-app-development-products/</a>";
    var securityManager = https.createX509CertificatePinningSecurityManager([
    {
        url: url2,
        serverCertificate: "google.com.der", // Should not work, because it's pinned to a different domain
    }
]);
    var httpClient = Ti.Network.createHTTPClient({
    onload: secondSuccess,
    onerror: secondfailure,
    timeout : 5000,
    securityManager: securityManager,
    validatesSecureCertificate : true,
 });
httpClient.open("GET", url2); 
httpClient.send();
<code><pre>
// Some comments here
public String getFoo()
{
    return foo;
}
</pre></code>
Now in the above example for the second request error method should be called because we are passing google certificate to the security manager. But in the code it is directly calling success method with out reporting any errors.

<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2017-09-20

   Duplicate of MOD-2355.</li>
</ol>


<p><a href="/AC/AC-5213.json">JSON Source</a></p>