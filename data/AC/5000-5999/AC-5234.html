---
title: "[AC-5234] iOS 11: Ti.Media.saveToPhotoGallery is broken and causes app to crash"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-10-20T21:54:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>David Fox</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2017-09-26T03:16:54.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-14T06:45:46.000+0000</td></tr>
</table>

<h3>Description</h3>

Any call to Ti.Media.saveToPhotoGallery on iOS 11 with any Titanium SDK causes the app to crash with no error or messaging in the console. The permission dialog is never shown. Same code with iOS 10.1 works fine.

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2017-09-26

   </li>
<li>David Fox 2017-09-26

   Hi Hans,
   
   Thanks a bunch for the info, that was the issue and adding that permission fixed it! Glad to see that PR, that will definitely be helpful. I'm not sure if it's in the documentation anywhere but I didn't see anything off hand - it might be helpful to add what you wrote here maybe.
   
   Thanks again.</li>
<li>Muhammad Sabir 2018-03-20

   @Hans Knochel Is there any method to check/request that permission like Ti.Media.has***** and Ti.Media.request**** ??? Currently the code for save to gallery is executed before the permissions popup by iOS.</li>
<li>Marian Kucharcik 2018-08-13

   This code works for me(iOS 11.4.1, iPX):
   
   <code><pre>
   saveToPhotoGalleryButton.addEventListener("click", function()
   {
   	var image = takenPhotoImageView.toImage(function(e)
   	{
   		if(Ti.Media.hasPhotoGalleryPermissions)
   		{
   			Ti.Media.saveToPhotoGallery(image, 
   			{
   				success:function(e)
   				{
   					alert("Image saved");
   				},
   				error:function(e)
   				{
   					alert("Image not saved: "+e.error);
   				}
   			});
   		}
   		else
   		{
   			Ti.Media.requestPhotoGalleryPermissions();
   		}
   	}, true);
   	
   });
   </pre></code>
   If there is no permissions granted, I request them. in tiapp.xml you have to add this:
   
   <code><pre>
   <key>NSPhotoLibraryAddUsageDescription</key>
   <string>App wants to save photos to gallery</string>
   </pre></code>
   
   Hans or somebody from appc, can you please modify docs and put this info there? Because there is no single word about missing key and permissions...
   Thanks
   </li>
<li>Hans Knöchel 2018-08-14

   Thanks for the feedback [~max87]. Note that it is <code>hasPhotoGalleryPermissions()</code> not <code>hasPhotoGalleryPermissions</code>. The latter one will always be true, because the function itself always exists (which is what you are checking).</li>
<li>Marian Kucharcik 2018-08-14

   Yeah, you're right and I'm sorry, it's a typo(I can't edit my previous comment to correct it)</li>
<li>Hans Knöchel 2018-08-14

   PR to update the docs: <a href="https://github.com/appcelerator/titanium_mobile/pull/10252" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10252</a></li>
</ol>


<p><a href="/AC/AC-5234.json">JSON Source</a></p>