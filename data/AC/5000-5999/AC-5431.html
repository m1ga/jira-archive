---
title: "[AC-5431] Android: Enable Multi-Dex support for Android 4.X.X"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Done</td></tr>
<tr><th>Resolution Date</th><td>2018-01-03T22:02:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Muhammad Ahmed Fahad</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2017-12-08T08:18:43.000+0000</td></tr>
<tr><th>Updated</th><td>2018-01-24T01:11:23.000+0000</td></tr>
</table>

<h3>Description</h3>

Currently we have multi-dex support and have made it default which enables us compiling apps with massive libraries and works fine for Android 5+. But when the number of method goes above 65K the app completely stops working on Android 4.X.X which the SDK still claims to support.

Here is what is mentioned in the Android Studio doc to enable multi-dex for devices running Android versions which were prior to 5.0.0: *[<a href="https://developer.android.com/studio/build/multidex.html#mdex-pre-l" rel="nofollow" target="_blank">https://developer.android.com/studio/build/multidex.html#mdex-pre-l</a>](<a href="https://developer.android.com/studio/build/multidex.html#mdex-pre-l)" rel="nofollow" target="_blank">https://developer.android.com/studio/build/multidex.html#mdex-pre-l)</a>*

I tried changing the android application name, i.e.:
*<application android:name="android.support.multidex.MultiDexApplication" >
*as mentioned in: [<a href="https://developer.android.com/studio/build/multidex.html#mdex-pre-l" rel="nofollow" target="_blank">https://developer.android.com/studio/build/multidex.html#mdex-pre-l</a>](<a href="https://developer.android.com/studio/build/multidex.html#mdex-pre-l)" rel="nofollow" target="_blank">https://developer.android.com/studio/build/multidex.html#mdex-pre-l)</a>
but while trying to run the application, the app crashes with the error:
E/AndroidRuntime(32659): java.lang.RuntimeException: Unable to start activity ComponentInfo
{com.xyz/com.xyz.XYZActivity}
: java.lang.ClassCastException: android.support.multidex.MultiDexApplication cannot be cast to org.appcelerator.titanium.TiApplication
Or how can I override the attachBaseContext method on the Main application class?

<h3>Comments</h3>

<ol>
<li>Muhammad Ahmed Fahad 2017-12-08

   
   <code><pre>
   
   package org.appcelerator.titanium;
   
   import android.content.Intent;
   import android.os.Bundle;
   import org.appcelerator.kroll.KrollDict;
   import org.appcelerator.titanium.proxy.ActivityProxy;
   import org.appcelerator.titanium.proxy.IntentProxy;
   import android.support.multidex.MultiDex;
   
   public class TiActivity extends TiBaseActivity
   {
   .
   .
   .
     @Override
     protected void attachBaseContext(Context base) {
        super.attachBaseContext(base);
        MultiDex.install(this);
     }
   .
   .
   .
   }
   </pre></code>
   ???</li>
<li>Sharif AbuDarda 2017-12-08

   Hello, Can you share a sample app that we can test to verify the issue in Android 4.x.x and also see the response in 5.x.x and above. Please provide a sample app and list of steps to follow for successful regeneration. Thanks.</li>
<li>Hans Kn√∂chel 2017-12-09

   [~jquick] Thoughts?</li>
<li>Joshua Quick 2017-12-11

   I've confirmed that multidex support for Android 4.x isn't reliable and will mostly likely crash on app startup. For now, the only reliable work-around is to set the min supported Android OS version to 5.0 by adding the following to your "tiapp.xml" file...
   
   <code><pre>
   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
   	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
   		&lt;manifest&gt;
   			&lt;uses-sdk android:minSdkVersion="21" android:targetSdkVersion="25"/&gt;
   		&lt;/manifest&gt;
   	&lt;/android&gt;
   &lt;/ti:app&gt;
   </pre></code>
   
   *Technical Reason:*
   The Titanium build tools needs to embed the "TiApplication" Java class and all of the Java classes it uses into the main dex file. This is because the application class needs to enable multidex support on Android 4.x, but the application class and its members need to be loaded successfully from the main dex file before doing so. This involves us passing a "--main-dex-list" command line argument when building a multidex app. This will never be a problem on Android 5.0 and above since those OS versions have built-in multidexing support.
   </li>
<li>Joshua Quick 2018-01-24

   This issue will be resolved by the fix for [TIMOB-25597] in Titanium 7.0.2.</li>
<li>Joshua Quick 2018-01-24

   Closing as duplicate.</li>
</ol>


<p><a href="/AC/AC-5431.json">JSON Source</a></p>