---
title: "[AC-5560] Android: Ti.identity failure to encrypt the data with the generated key."
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2018-03-21T22:59:19.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>android, android-6, authentication, fingerprint, ti.identity, touchid</td></tr>
<tr><th>Reporter</th><td>Ayoub Zamouchi</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2018-01-30T09:37:20.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-22T17:43:59.000+0000</td></tr>
</table>

<h3>Description</h3>

In Ti.identity module, there is an additional step after a fingerprint validation success, which is to try to encrypt some data with the generated key in createKey method .

[See onAuthenticationSucceeded method in FingerPrintHelper.java](<a href="https://github.com/azamouchi/titanium-identity/blob/63e0bd48d234b6211095007dd0750da9bf840d8c/android/src/ti/identity/FingerPrintHelper.java#L149)" rel="nofollow" target="_blank">https://github.com/azamouchi/titanium-identity/blob/63e0bd48d234b6211095007dd0750da9bf840d8c/android/src/ti/identity/FingerPrintHelper.java#L149)</a>

[See tryEncrypt method in FingerPrintHelper.java](<a href="https://github.com/azamouchi/titanium-identity/blob/63e0bd48d234b6211095007dd0750da9bf840d8c/android/src/ti/identity/FingerPrintHelper.java#L118)" rel="nofollow" target="_blank">https://github.com/azamouchi/titanium-identity/blob/63e0bd48d234b6211095007dd0750da9bf840d8c/android/src/ti/identity/FingerPrintHelper.java#L118)</a>

The problem is, on some android devices running Android 6.0 the encryption of the data with the previously generated key raise an exception, which leads to fails the authentification.
As mentioned in this [stackOverflow thread](<a href="https://stackoverflow.com/questions/36043912/error-after-fingerprint-touched-on-samsung-phones-android-security-keystoreexce)" rel="nofollow" target="_blank">https://stackoverflow.com/questions/36043912/error-after-fingerprint-touched-on-samsung-phones-android-security-keystoreexce)</a>, the problem seems to be encountered randomly on some android devices running Android 6 like Samsung, OnPlus, in my case i face the problem every time i try to authenticate with [this device](<a href="https://www.gsmarena.com/wiko_u_feel_lite-8204.php)" rel="nofollow" target="_blank">https://www.gsmarena.com/wiko_u_feel_lite-8204.php)</a>, which make the fingerprint authentification impossible.

My question : Is this encryption step mandatory ? can we make it optional ? since the onAuthenticationSucceeded method has been already called, which means that the fingerprint verification is OK.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-5560_64798/Samsung_Galaxy_S6_Android_7_0_0.png">Samsung_Galaxy_S6_Android_7_0_0.png</td></td><td>2018-02-04T19:39:59.000+0000</td><td>47600</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-5560_64802/testTouchId.zip">testTouchId.zip</td></td><td>2018-02-04T19:43:44.000+0000</td><td>10014362</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-5560_64799/Wiko_U_FEEL_LITE_Android_6_0_0.png">Wiko_U_FEEL_LITE_Android_6_0_0.png</td></td><td>2018-02-04T19:40:02.000+0000</td><td>32430</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2018-01-31

   Hello, Can you please provide a full reproducible code/project that we can test to validate the issue on some of those mentioned devices? Thanks.</li>
<li>Ayoub Zamouchi 2018-02-04

   Hi, Sorry for the delay.
   
   You can find attached, a simple project that uses the packaged module version of ti.identity (SKD 7.0.1.GA).
   i tested the app on a [Wiko device](<a href="https://www.gsmarena.com/wiko_u_feel_lite-8204.php)" rel="nofollow" target="_blank">https://www.gsmarena.com/wiko_u_feel_lite-8204.php)</a> (Android 6.0.0) and A Samsung Galaxy S6 (Android 7.0.0), the problem occur on Wiko and not on Samsung. (See attached screen shots)
   
   !Samsung_Galaxy_S6_Android_7_0_0.png|thumbnail!  !Wiko_U_FEEL_LITE_Android_6_0_0.png|thumbnail!  
   
   Test project : [^testTouchId.zip] </li>
<li>Ayoub Zamouchi 2018-02-23

   Any news ? have you been able to reproduce the problem ?</li>
<li>Sharif AbuDarda 2018-02-23

   Hello, So far we are unable to reproduce the issue. We don't have your specific device. Can you run a trace log of the issue? Thanks.</li>
<li>Sharif AbuDarda 2018-03-16

   Hello [~azamouchi], Can you follow up here? Whats the update of your issue? </li>
<li>Gary Mathews 2018-03-22

   I notice you linked to a fork of <code>ti.identity</code>, are you using this fork? If so, try using the latest [ti.identity-android-2.1.0.zip](<a href="https://github.com/appcelerator-modules/titanium-identity/releases/download/android-2.1.0/ti.identity-android-2.1.0.zip)" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/titanium-identity/releases/download/android-2.1.0/ti.identity-android-2.1.0.zip)</a> release</li>
</ol>


<p><a href="/AC/AC-5560.json">JSON Source</a></p>