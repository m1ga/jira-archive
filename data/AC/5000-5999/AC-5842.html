---
title: "[AC-5842] Query custom objects field with $text and $search"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2018-11-28T22:10:04.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Arrow Cloud, ArrowDB, Documentation, Studio</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Andy Kirra</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2018-08-17T16:34:32.000+0000</td></tr>
<tr><th>Updated</th><td>2018-11-28T22:10:04.000+0000</td></tr>
</table>

<h3>Description</h3>

I have arrowdb custom objects that have a field named “message”
I'm trying to perform a query by keywords on this field

-> my query where obj:

<code><pre>
where = { "message" : { "$text" : { "$search" : "keyword" } } }
</pre></code>


Following the documentation:

Perform a text search on the contents of the field. A $text expression has the following syntax: 

<code><pre>
{ "$text": { "$search": &lt;string&gt; }} 
</pre></code>


Also here's an example from the documentation: 

<code><pre>
where={"$text": { "$search": "javascript,ruby,python,-php" }}
</pre></code>


+PROBLEM+
 I'm getting a 500 error:
 {
   "success": false,
   "error": true,
    "code": 500,
    "message": {}
 }

+EXPECTED+
Perform a text search on the contents of the field message.

+TEST CASE+
The following code has 2 functions:
1(doCreate) - creates a custom "report" object (with property message =  'abc aaa bbb ccc')
2(doSearch) - query the reports by field message (by keyword 'abc')



<code><pre>
//QUERY THE FIELD MESSAGE OF THE PREVIOUSLY CREATED CUSTOM OBJ
function doSearch(e) {
	
Cloud.Objects.query({
    classname: 'report',
    page: 1,
    per_page: 10,
    where: {
    //WORKING QUERIES (give the expected result)
    	 //"message" : "abc aaa bbb ccc"
    	 //"message" : { "$regex": "^" + "abc"} 
    //NOT WORKING (Gives 500 error)
         "message" : { "$text" : {"$search" : "abc"} }
    }
	}, function (e) {
	    if (e.success) {
	        for (var i = 0; i &lt; e.report.length; i++) {
	            var report = e.report[i];
	            Ti.API.info("report: "+JSON.stringify(report,null,2));
	        }
	    } else {
	       Ti.API.info('Error:\n' + JSON.stringify(e,null,2)); 
	    }
	});
}

//CREATE A CUSTOM OBJECT (to have an object to query )
function doCreate(e) {
	
Cloud.Objects.create({
    classname: 'report',
    fields: {
        message: 'abc aaa bbb ccc',
    }
	}, function (e) {
	    if (e.success) {
	    	
	        var report = e.report[0];
	        Ti.API.info("report: "+JSON.stringify(report,null,2));
	    } else {
	        alert('Error:\n' +
	            ((e.error && e.message) || JSON.stringify(e)));
	    }
	});
	
}
</pre></code>


<Alloy>
	<Window class="container">
		<Label id="label" top="100" onClick="doCreate">Create Object</Label>
		<Label id="label" top="200" onClick="doSearch">Keyword Search</Label>
	</Window>
</Alloy>

<h3>Comments</h3>

<ol>
<li>Rakhi Mitro 2018-08-21

   Hello,
   
   Thanks for sharing with us. Can you please test this on latest SDK and let us know how it goes.</li>
<li>Andy Kirra 2018-08-24

   Hi,
   Thanks for your answer, I get the same error on SDK 7.3.0. (code: 500)</li>
<li>Rakhi Mitro 2018-08-26

   Hello,
   Thanks for your feedback. In which platform you are getting this error? Please attach complete test case and full console logs.
   
   
   </li>
</ol>


<p><a href="/AC/AC-5842.json">JSON Source</a></p>