---
title: "[AC-6151] [Android] Run on main thread = true not firing Destroy and Stop Events"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2019-02-26T21:55:54.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>7.5.0.GA, android, run-on-main-thread</td></tr>
<tr><th>Reporter</th><td>josh.mocek</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2019-02-26T20:46:37.000+0000</td></tr>
<tr><th>Updated</th><td>2019-02-27T21:53:25.000+0000</td></tr>
</table>

<h3>Description</h3>

Build this app onto an android device. Connect a bluetooth keyboard. Open the app. Press the blue button a few times. Disconnect the scanner while the app is counting. The app resets and picks back up where it left off.


I did notice that on 7.5.0 run-on-main-thread = false when the scanner disconnects it calls:
destroy
stop
window open
start
resume

when run-on-main-thread = true it only runs:
window open
start
resume

Should it not still be running destroy and stop when run-on-main-thread = true?

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66194/alloy.js">alloy.js</td></td><td>2019-02-26T20:45:19.000+0000</td><td>1696</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66192/app.tss">app.tss</td></td><td>2019-02-26T20:45:19.000+0000</td><td>780</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66201/index.js">index.js</td></td><td>2019-02-27T21:53:21.000+0000</td><td>1831</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66193/index.js">index.js</td></td><td>2019-02-26T20:45:19.000+0000</td><td>2640</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66191/index.tss">index.tss</td></td><td>2019-02-26T20:45:19.000+0000</td><td>155</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66202/index.xml">index.xml</td></td><td>2019-02-27T21:53:21.000+0000</td><td>368</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66190/index.xml">index.xml</td></td><td>2019-02-26T20:45:19.000+0000</td><td>386</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6151_66189/tiapp.xml">tiapp.xml</td></td><td>2019-02-26T20:45:43.000+0000</td><td>3863</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2019-02-26

   Hello [~josh.mocek], You were in touch with our team on the same issue in another ticket AC-5929. Please do not create a separate ticket of the same issue. Please post your comment in that ticket. Closing this. Thanks.</li>
<li>Joshua Quick 2019-02-26

   This specific issue that [~josh.mocek] has brought up is a duplicate of [TIMOB-26850]</li>
<li>Joshua Quick 2019-02-26

   This is also only an issue with the 1st activity window when backing out of the app.
   
   I recommend that you use the <code>Ti.UI.Window</code> object's "close" event instead. Especially since it work on both Android and iOS.</li>
<li>Joshua Quick 2019-02-27

   [~josh.mocek],
   
   Admittedly there is a design issue here on Titaniums' end. Titanium's activity callbacks (<code>onCreate</code>, <code>onStart</code>, <code>onDestroy</code>, etc.) *+need+* to be synchronous. They need to be invoked as soon as the equivalent Java methods are invoked. Especially for <code>onDestroy</code> on the last activity window, because the app is about to exit. Currently, when "run-on-main-thread" is set to <code>true</code>, they are queued to be invoked after their equivalent Java method has been called, which has a short delay.
   
   If we change these callbacks to be synchronous, then this will cause a breaking-change where you can no longer set up your callbacks from the <code>Ti.UI.Window</code> "open" event listener anymore, because that event gets fired after the Java <code>onCreate()</code>, <code>onStart()</code>, and <code>onResume()</code> methods get called on startup. But that said, there is an easy backward compatible solution to this. You would need to set up your callback before calling <code>Window.open()</code>.
   
   For example:
   <code><pre>
   var window = Ti.UI.createWindow();
   window.activity.onCreate = function() {
   	Ti.API.info("### Activity.onCreate() called.");
   };
   window.open();
   </pre></code>
   </li>
<li>josh.mocek 2019-02-27

   Unfortunately the scanner disconnect does not call the onClose event. Here is the cleaned up file I was testing with. [^index.js]  [^index.xml] </li>
</ol>


<p><a href="/AC/AC-6151.json">JSON Source</a></p>