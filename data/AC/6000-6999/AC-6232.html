---
title: "[AC-6232] Regression - Webview deviceHeight reports incorrect number"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2019-08-19T22:11:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>ios, webview</td></tr>
<tr><th>Reporter</th><td>roeland p</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2019-04-29T11:14:57.000+0000</td></tr>
<tr><th>Updated</th><td>2019-08-19T22:11:15.000+0000</td></tr>
</table>

<h3>Description</h3>

I have webview anomalies on ios 12.1 simulator Ti.SDK 8. Looking to make a true fullscreen webview with a local html file.

Ti.WebView itself honours the full device width / height, as can be seen from the red borders, however contents inside, act weirdly (see image of 2 scenarios using viewport-meta tag)

When using Safari-Developer inspection I notice the actual <HTML>-element / <code>document.body.clientHeight = 647</code> is reporting not the "Ti.UI.WebView"-s height and off by 20px in this iPhone 8 simulator (which corresponds with the safeArea padding.top fyi)

<code>Ti.Webview.toImage().height = 667</code>
but inside the webview: 
<code>document.body.clientHeight = 647</code>

=== 

When running the same samples on Ti.SDK 7.5.2 GA, the deviceHeight inside the webview reports correctly and the webview's HTML uses the full height as the Ti.UI.Webview has. 

Might be related to TIMOB-26984 ? 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66578/7.5.2-shows ok.png">7.5.2-shows ok.png</td></td><td>2019-04-29T11:17:37.000+0000</td><td>713436</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66577/anomalies.png">anomalies.png</td></td><td>2019-04-29T11:08:06.000+0000</td><td>3384035</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66586/iPhone7-contain-landscape.png">iPhone7-contain-landscape.png</td></td><td>2019-05-01T02:24:42.000+0000</td><td>143850</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66585/iPhone7-contain-portrait.png">iPhone7-contain-portrait.png</td></td><td>2019-05-01T02:24:39.000+0000</td><td>194844</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66590/iPhone7-cover-landscape.png">iPhone7-cover-landscape.png</td></td><td>2019-05-01T02:25:35.000+0000</td><td>145787</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66589/iPhone7-cover-portrait.png">iPhone7-cover-portrait.png</td></td><td>2019-05-01T02:25:32.000+0000</td><td>196442</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66584/iPhoneX-contain-landscape.png">iPhoneX-contain-landscape.png</td></td><td>2019-05-01T02:24:33.000+0000</td><td>147937</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66583/iPhoneX-contain-portrait.png">iPhoneX-contain-portrait.png</td></td><td>2019-05-01T02:24:26.000+0000</td><td>214441</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66588/iPhoneX-cover-landscape.png">iPhoneX-cover-landscape.png</td></td><td>2019-05-01T02:25:23.000+0000</td><td>143486</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66587/iPhoneX-cover-portrait.png">iPhoneX-cover-portrait.png</td></td><td>2019-05-01T02:25:18.000+0000</td><td>217760</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66591/WebViewInsetsTest.js">WebViewInsetsTest.js</td></td><td>2019-05-01T02:28:57.000+0000</td><td>3401</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/AC/AC-6232_66613/wkwebviewtest.zip">wkwebviewtest.zip</td></td><td>2019-05-17T08:19:07.000+0000</td><td>8662963</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-04-29

   I haven't tried this myself, but I'm pretty sure this can be solved via a <code><meta/></code> viewport tag. For example...
   <code><pre>
   <!DOCTYPE html>
   <html>
   	<head>
   		<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
   	</head>
   	<body>
   		<p>Your content goes here.</p>
   	</body>
   </html>
   </pre></code>
   
   The key thing is the <code>viewport-fit=cover</code> which tells the <code>WKWebView</code> to ignore the safe-ares padding and allow content to be overlapped by the top status bar, iPhone X notch, and to not compensate for rounded corners.
   </li>
<li>roeland p 2019-04-30

   @joshua please see the (2nd) attached image (anomalies.png) in the issue which has screenshot running with 2 different variations on "viewport" including an anomaly on the bottom of the viewport (right screenshot) when working with the "viewport-fit="cover" tag. 
   
   It seems that with vieport-fit-cover indeed the safearea padding-top is put to 0, however WKwebview.innerHeight seems not aware that has those extra pixels available. (just a guess). </li>
<li>roeland p 2019-04-30

   maybe this is due to me opening my "test"-controller from index.js which in my case just hosts a "tabgroup" and not a "window" element. </li>
<li>Joshua Quick 2019-04-30

   </li>
<li>Joshua Quick 2019-05-01

   I've tested this with the following code.
   <code><pre>
   var htmlString =
   		'<!DOCTYPE html>\n' +
   		'<html>\n' +
   		'	<head>\n' +
   //		'		<meta name="viewport" content="width=device-width, initial-scale=1.0">\n' +
   //		'		<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain">\n' +
   		'		<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">\n' +
   		'		<style>\n' +
   		'			p { background-color:limegreen; margin:4px }\n' +
   		'		</style>\n' +
   		'	</head>\n' +
   		'	<body style="margin:0; padding:0; background-color:yellow">\n' +
   		'		<p>Row 01: This is an HTML test.</p>\n' +
   		'		<p>Row 02: This is an HTML test.</p>\n' +
   		'		<p>Row 03: This is an HTML test.</p>\n' +
   		'		<p>Row 04: This is an HTML test.</p>\n' +
   		'		<p>Row 05: This is an HTML test.</p>\n' +
   		'		<p>Row 06: This is an HTML test.</p>\n' +
   		'		<p>Row 07: This is an HTML test.</p>\n' +
   		'		<p>Row 08: This is an HTML test.</p>\n' +
   		'		<p>Row 09: This is an HTML test.</p>\n' +
   		'		<p>Row 10: This is an HTML test.</p>\n' +
   		'		<p>Row 11: This is an HTML test.</p>\n' +
   		'		<p>Row 12: This is an HTML test.</p>\n' +
   		'		<p>Row 13: This is an HTML test.</p>\n' +
   		'		<p>Row 14: This is an HTML test.</p>\n' +
   		'		<p>Row 15: This is an HTML test.</p>\n' +
   		'		<p>Row 16: This is an HTML test.</p>\n' +
   		'		<p>Row 17: This is an HTML test.</p>\n' +
   		'		<p>Row 18: This is an HTML test.</p>\n' +
   		'		<p>Row 19: This is an HTML test.</p>\n' +
   		'		<p>Row 20: This is an HTML test.</p>\n' +
   		'		<p>Row 21: This is an HTML test.</p>\n' +
   		'		<p>Row 22: This is an HTML test.</p>\n' +
   		'		<p>Row 23: This is an HTML test.</p>\n' +
   		'		<p>Row 24: This is an HTML test.</p>\n' +
   		'		<p>Row 25: This is an HTML test.</p>\n' +
   		'		<p>Row 26: This is an HTML test.</p>\n' +
   		'		<p>Row 27: This is an HTML test.</p>\n' +
   		'		<p>Row 28: This is an HTML test.</p>\n' +
   		'		<p>Row 29: This is an HTML test.</p>\n' +
   		'		<p>Row 30: This is an HTML test.</p>\n' +
   		'		<p>Row 31: This is an HTML test.</p>\n' +
   		'		<p>Row 32: This is an HTML test.</p>\n' +
   		'		<p>Row 33: This is an HTML test.</p>\n' +
   		'		<p>Row 34: This is an HTML test.</p>\n' +
   		'		<p>Row 35: This is an HTML test.</p>\n' +
   		'		<p>Row 36: This is an HTML test.</p>\n' +
   		'		<p>Row 37: This is an HTML test.</p>\n' +
   		'		<p>Row 38: This is an HTML test.</p>\n' +
   		'		<p>Row 39: This is an HTML test.</p>\n' +
   		'		<p>Row 40: This is an HTML test.</p>\n' +
   		'		<p>Row 41: This is an HTML test.</p>\n' +
   		'		<p>Row 42: This is an HTML test.</p>\n' +
   		'		<p>Row 43: This is an HTML test.</p>\n' +
   		'		<p>Row 44: This is an HTML test.</p>\n' +
   		'		<p>Row 45: This is an HTML test.</p>\n' +
   		'		<p>Row 46: This is an HTML test.</p>\n' +
   		'		<p>Row 47: This is an HTML test.</p>\n' +
   		'		<p>Row 48: This is an HTML test.</p>\n' +
   		'		<p>Row 49: This is an HTML test.</p>\n' +
   		'		<p>Row 50: This is an HTML test.</p>\n' +
   		'	</body>\n' +
   		'</html>\n';
   
   var windowSettings = {
   	extendSafeArea: true,
   //	fullscreen: true,
   };
   if (Ti.App.Android) {
   	windowSettings.theme = "Theme.AppCompat.NoTitleBar";
   	windowSettings.windowFlags |= Ti.UI.Android.FLAG_TRANSLUCENT_STATUS;
   	windowSettings.windowFlags |= Ti.UI.Android.FLAG_TRANSLUCENT_NAVIGATION;
   }
   var window = Ti.UI.createWindow(windowSettings);
   var webView = Ti.UI.createWebView({
   	html: htmlString,
   	width: Ti.UI.FILL,
   	height: Ti.UI.FILL,
   });
   window.add(webView);
   window.open();
   </pre></code>
   
   By default, the <code>WKWebView</code> uses <code>viewport-fit=contain</code>, which will inset the web view's contents to avoid overlap. I took screenshots of the above code with the "contain" setting on iPhoneX and iPhone7.
    !iPhoneX-contain-portrait.png|thumbnail!  !iPhoneX-contain-landscape.png|thumbnail! 
    !iPhone7-contain-portrait.png|thumbnail!  !iPhone7-contain-landscape.png|thumbnail! 
   
   When I changed the code to use <code>viewport-fit=cover</code>, I see the following on iPhoneX and iPhone7.
    !iPhoneX-cover-portrait.png|thumbnail!  !iPhoneX-cover-landscape.png|thumbnail! 
    !iPhone7-cover-portrait.png|thumbnail!  !iPhone7-cover-landscape.png|thumbnail! 
   
   Note that Android does not support the <code>viewport-fit=contain</code> setting. So, if you're using a translucent status bar or navigation bar as shown in my above code, then they will always overlap the content.</li>
<li>Sharif AbuDarda 2019-05-16

   Hello [~rpl], Can you follow up here? What's the status of your issue? </li>
<li>roeland p 2019-05-17

   @sharif sorry for the non response, got buried in email. 
   
   I've attached a barebones test project where I am using the Meta key viewport settings as instructed and extendSafeArea=true padding 
   
   What you will notice is that (testing on iphone 8) the console logs are as followed: 
   
   [INFO]   Ti.Platform.displayCaps.platformHeight 667
   [INFO]   data = "from webview (onload)- window.innerHeight ---> 647
   
   Inside the webview - onload, somehow reports window.innerHeight = 647. (so minus statusbar height)
   
   BUT, when i change the window to "fullscreen = true" the window.innerHeight is reporting the correct behaviour. 
   So either I am not understanding window.innerHeight or something is off. The webview seems to be running from top to bottom of screen tho.  
   
   [^wkwebviewtest.zip] </li>
<li>roeland p 2019-05-17

   more testing and digging into this behaviour.
   
   When using the  <code>screen.height</code> property it reports the correct number. So i'm still not sure if <code>window.innerHeight</code> is intended to return a different value (w/o safeAreapadding) but the webview itself uses the full height including the safeAreapadding area :) 
   
   for now I will detect if my webview is on IOS and use the screen.height property for properly scaling some divs. 
   
   Thanks all for helping with this. I hope my comments are still valuable. 
   
   kr roeland</li>
<li>Rakhi Mitro 2019-06-26

   [~rpl],
   Thanks for your valuable comment. We appreciate it. Are you able to get that sorted out?  Please let us know if you need more help with this issue.
   
   </li>
<li>Rakhi Mitro 2019-07-25

    Hello,
    We have not heard back from you since our last update. I just wanted to follow up with you about this issue? Are you still experiencing this problem?
    Please let us know if you need more help with this issue.</li>
<li>Rakhi Mitro 2019-08-18

    [~rpl],
    I just wanted to follow up and check the status of your issue. We have not heard back from you since our last update.Did you manage to resolve the problem? Let us know the update.</li>
</ol>


<p><a href="/AC/AC-6232.json">JSON Source</a></p>