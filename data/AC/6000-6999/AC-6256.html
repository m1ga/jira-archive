---
title: "[AC-6256] iOS: TiWebView (WKWebView) The application has crashed with an uncaught exception 'NSInternalInconsistencyException'"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2019-09-11T20:06:08.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>8.0.0.GA, iOS, webview</td></tr>
<tr><th>Reporter</th><td>Nikos Poulios</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2019-05-14T13:24:10.000+0000</td></tr>
<tr><th>Updated</th><td>2019-09-11T20:06:08.000+0000</td></tr>
</table>

<h3>Description</h3>

I cannot provide a link to reproduce but in some cases I get app crashes on iOS with the message below: 


<code><pre>
[ERROR]  The application has crashed with an uncaught exception 'NSInternalInconsistencyException'.
[ERROR]  Reason:
[ERROR]  Completion handler passed to -[TiUIWebView webView:decidePolicyForNavigationResponse:decisionHandler:] was not called
[ERROR]  Stack trace:
[ERROR]  0 CoreFoundation 0x000000010eccf6fb __exceptionPreprocess + 331
[ERROR]  1 libobjc.A.dylib 0x000000010dae4ac5 objc_exception_throw + 48
[ERROR]  2 CoreFoundation 0x000000010eccf555 +[NSException raise:format:] + 197
[ERROR]  3 WebKit 0x00000001101011fd _ZN6WebKit28CompletionHandlerCallCheckerD2Ev + 125
[ERROR]  4 WebKit 0x00000001101abf1d _ZNK3WTF20ThreadSafeRefCountedIN6WebKit28CompletionHandlerCallCheckerELNS_17DestructionThreadE0EE5derefEv + 33
[ERROR]  5 WebKit 0x000000011018d611 _ZZN3WTF8BlockPtrIFv26WKNavigationResponsePolicyEE12fromCallableIZN6WebKit15NavigationState16NavigationClient33decidePolicyForNavigationResponseERNS5_12WebPageProxyEONS_3RefIN3API18NavigationResponseENS_13DumbPtrTraitsISC_EEEEONSA_INS5_27WebFramePolicyListenerProxyENSD_ISH_EEEEPNSB_6ObjectEE3$_6EES3_T_ENUlPKvE_8__invokeESQ_ + 23
[ERROR]  6 libsystem_blocks.dylib 0x00000001111dc9cd _Block_release + 105
[ERROR]  7 WebKit 0x000000011018a9aa _ZN6WebKit15NavigationState16NavigationClient33decidePolicyForNavigationResponseERNS_12WebPageProxyEON3WTF3RefIN3API18NavigationResponseENS4_13DumbPtrTraitsIS7_EEEEONS5_INS_27WebFramePolicyListenerProxyENS8_ISC_EEEEPNS6_6ObjectE + 572
[ERROR]  8 WebKit 0x00000001101eec44 _ZN6WebKit12WebPageProxy29decidePolicyForResponseSharedEON3WTF3RefINS_15WebProcessProxyENS1_13DumbPtrTraitsIS3_EEEEyRKN7WebCore18SecurityOriginDataENS8_21PolicyCheckIdentifierEyRKNS8_16ResourceResponseERKNS8_15ResourceRequestEbyRKNS_8UserDataE + 738
[ERROR]  9 WebKit 0x00000001101ee930 _ZN6WebKit12WebPageProxy23decidePolicyForResponseEyRKN7WebCore18SecurityOriginDataENS1_21PolicyCheckIdentifierEyRKNS1_16ResourceResponseERKNS1_15ResourceRequestEbyRKNS_8UserDataE + 94
[ERROR]  10 WebKit 0x00000001103f4e0d _ZN3IPC22callMemberFunctionImplIN6WebKit12WebPageProxyEMS2_FvyRKN7WebCore18SecurityOriginDataENS3_21PolicyCheckIdentifierEyRKNS3_16ResourceResponseERKNS3_15ResourceRequestEbyRKNS1_8UserDataEENSt3__15tupleIJyS4_S7_yS8_SB_bySE_EEEJLm0ELm1ELm2ELm3ELm4ELm5ELm6ELm7ELm8EEEEvPT_T0_OT1_NSJ_16integer_sequenceImJXspT2_EEEE + 92
[ERROR]  11 WebKit 0x00000001103efa23 _ZN3IPC13handleMessageIN8Messages12WebPageProxy23DecidePolicyForResponseEN6WebKit12WebPageProxyEMS5_FvyRKN7WebCore18SecurityOriginDataENS6_21PolicyCheckIdentifierEyRKNS6_16ResourceResponseERKNS6_15ResourceRequestEbyRKNS4_8UserDataEEEEvRNS_7DecoderEPT0_T1_ + 102
[ERROR]  12 WebKit 0x00000001100582a6 _ZN3IPC18MessageReceiverMap15dispatchMessageERNS_10ConnectionERNS_7DecoderE + 126
[ERROR]  13 WebKit 0x000000011020e762 _ZN6WebKit15WebProcessProxy17didReceiveMessageERN3IPC10ConnectionERNS1_7DecoderE + 24
[ERROR]  14 WebKit 0x000000011004b1c8 _ZN3IPC10Connection15dispatchMessageENSt3__110unique_ptrINS_7DecoderENS1_14default_deleteIS3_EEEE + 108
[ERROR]  15 WebKit 0x000000011004dbdd _ZN3IPC10Connection24dispatchIncomingMessagesEv + 717
[ERROR]  16 JavaScriptCore 0x00000001088371f4 _ZN3WTF7RunLoop11performWorkEv + 228
[ERROR]  17 JavaScriptCore 0x0000000108837482 _ZN3WTF7RunLoop11performWorkEPv + 34
[ERROR]  18 CoreFoundation 0x000000010ec36be1 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17
[ERROR]  19 CoreFoundation 0x000000010ec36463 __CFRunLoopDoSources0 + 243
[ERROR]  20 CoreFoundation 0x000000010ec30b1f __CFRunLoopRun + 1231
[ERROR]  21 CoreFoundation 0x000000010ec30302 CFRunLoopRunSpecific + 626
[ERROR]  22 GraphicsServices 0x0000000111f822fe GSEventRunModal + 65
[ERROR]  23 UIKitCore 0x000000011b546ba2 UIApplicationMain + 140
[ERROR]  24 EW 0x0000000108334fed main + 1005
[ERROR]  25 libdyld.dylib 0x0000000111156541 start + 1
</pre></code>

I noticed that if I build the sdk commenting out <a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiUIWebView.m#L1061" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiUIWebView.m#L1061</a> if part,  and always return decisionHandler(WKNavigationResponsePolicyAllow) crash is not occurring anymore, I cannot see what exactly the problem is though

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6256_66603/Screen Recording 2019-05-15 at 12.02.23 PM.mov">Screen Recording 2019-05-15 at 12.02.23 PM.mov</td></td><td>2019-05-15T09:24:11.000+0000</td><td>1984048</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2019-05-14

   Hello, How often the crash happens? is there a video demonstration of the crash happening can you share with us? This is quite hard for us to investigate if we don't have a sample reproducible code. Also, is the issue is only with the Ti SDK and iOS version specified? or also in other versions?</li>
<li>Nikos Poulios 2019-05-15

   I understand it might be a bit hard to reproduce, I got it in an internal page we have which requires specific headers as well so I cannot provide you the URL. As you can see in the video above crash occurs after I hit the retry button a couple of times which tries to reload the page. In this particular page and flow crash happens all the time. Sometimes the titanium console log ends as seen on the video, while some others I get the error I posted in description and then it ends. In all cases I see the error above in the iphone console. Error happens only on Ti 8 (WKWebView), I tested on iOS 12.2 (simulator + device) and a 10.3.3 device, all have the same behavior  [^Screen Recording 2019-05-15 at 12.02.23 PM.mov] 
   
   </li>
<li>Rakhi Mitro 2019-07-10

   [~nipoul],
   Thanks for your feedback. Can you please test this issue on 8.0.2.GA and let us know the results?</li>
<li>Sharif AbuDarda 2019-07-12

   Hello [~nipoul], Without a proper sample code we can't verify the issue and investigate for the bug. We need the sample code. Please try will the latest SDK. See if that helps? Thanks.</li>
<li>Rakhi Mitro 2019-08-05

   
   Hello,
   We have not heard back from you since our last update.I just wanted to follow up with you about this issue? Are you still experiencing this problem?Please let us know if you need more help with this issue.</li>
<li>Nikos Poulios 2019-08-05

   Hello, sorry for not responding to your previous comments, I can still reproduce the issue on 8.0.2.GA and 8.1.0.v20190801142345 but I haven't came across the issue again with another web page. Unfortunately as I mentioned I cannot provide example code, since it seems to be a combination of the webpage and the WebView and that page is not accessible from outside. I will let you know if I can provide an example with another page. For a number of reasons we ended up using  SFSafariViewController from ti.webdialog for that short of pages</li>
<li>Sharif AbuDarda 2019-08-23

   Hello, Can you try on the latest SDK 8.1.0.GA? </li>
</ol>


<p><a href="/AC/AC-6256.json">JSON Source</a></p>