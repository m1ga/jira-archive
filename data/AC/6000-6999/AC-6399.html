---
title: "[AC-6399] App Crashes when requesting location"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2019-12-30T16:24:55.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Peter Ladis</td></tr>
<tr><th>Assignee</th><td>Motiur Rahman</td></tr>
<tr><th>Created</th><td>2019-10-08T14:52:54.000+0000</td></tr>
<tr><th>Updated</th><td>2020-03-06T19:10:23.000+0000</td></tr>
</table>

<h3>Description</h3>

Appcelerator Command-Line Interface, version 7.1.1

Operating System
  Name                        = Mac OS X
  Version                     = 10.14.6
  Architecture                = 64bit
  # CPUs                      = 12
  Memory                      = 17179869184
Node.js
  Node.js Version             = 10.15.3
  npm Version                 = 6.4.1
Titanium CLI
  CLI Version                 = 5.2.1
Titanium SDK
  SDK Version                 = 8.2.0.GA


Repro Steps:

1. Open up the application
2. Make a call to location services, app will crash with this error

Invalid parameter not satisfying: !stayUp || CLClientIsBackgroundable(internal->fClient) || _CFMZEnabled()


This crash will go away if I add location to the BackgroundMode...however apple fails my app from review with this setting on

Any ideas?

<h3>Comments</h3>

<ol>
<li>Vijay Singh 2019-10-09

   See discussion at <a href="https://forums.developer.apple.com/thread/36745" rel="nofollow" target="_blank">https://forums.developer.apple.com/thread/36745</a>, if it helps you.</li>
<li>Peter Ladis 2019-10-09

   @vijay...This article does not help...the crash is coming from the SDK and crashing the app</li>
<li>Peter Ladis 2019-10-10

   Any updates on this?</li>
<li>Vijay Singh 2019-10-10

   [~peterladis] 
   1. Please share a test case and steps to reproduce the issue. We'll look in this.
   2. What was apples' comment to reject the app?
   3. I believe that you have used property permission keys in tiapp.xml.
   </li>
<li>Peter Ladis 2019-10-10

   with background location OFF...this is the error
   
   [ERROR]  The application has crashed with an uncaught exception 'NSInternalInconsistencyException'.
   
   [ERROR]  Reason:
   
   [ERROR]  Invalid parameter not satisfying: !stayUp || CLClientIsBackgroundable(internal->fClient)
   
   [ERROR]  Stack trace:
   
   [ERROR]  0 CoreFoundation 0x00000001109286fb __exceptionPreprocess + 331
   
   [ERROR]  1 libobjc.A.dylib 0x000000010fbbaac5 objc_exception_throw + 48
   
   [ERROR]  2 CoreFoundation 0x0000000110928482 +[NSException raise:format:arguments:] + 98
   
   [ERROR]  3 Foundation 0x000000010c9f2927 -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 194
   
   [ERROR]  4 CoreLocation 0x000000010b832bae CLClientStopVehicleHeadingUpdates + 26015
   
   [ERROR]  5 LilyPad 0x0000000109ab10d7 -[GeolocationModule locationManager] + 1111
   
   [ERROR]  6 LilyPad 0x0000000109ab1568 -[GeolocationModule startStopLocationManagerIfNeeded] + 312
   
   [ERROR]  7 LilyPad 0x0000000109ab2362 -[GeolocationModule getCurrentPosition:] + 754
   
   [ERROR]  8 CoreFoundation 0x000000011092f4cc __invoking___ + 140
   
   [ERROR]  9 CoreFoundation 0x000000011092ca45 -[NSInvocation invoke] + 325
   
   [ERROR]  10 JavaScriptCore 0x000000010a48eaf8 _ZN3JSC24ObjCCallbackFunctionImpl4callEP9JSContextP13OpaqueJSValuemPKPKS3_PS6_ + 440
   
   [ERROR]  11 JavaScriptCore 0x000000010a48e52c _ZN3JSCL34objCCallbackFunctionCallAsFunctionEPK15OpaqueJSContextP13OpaqueJSValueS4_mPKPKS3_PS6_ + 236
   
   [ERROR]  12 JavaScriptCore 0x000000010a48dddc _ZN3JSC19APICallbackFunction4callINS_20ObjCCallbackFunctionEEExPNS_9ExecStateE + 492
   
   [ERROR]  13 ??? 0x00004d5bffa0102d 0x0 + 85057526042669
   
   [ERROR]  14 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  15 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  16 JavaScriptCore 0x000000010a47928d llint_entry + 63482
   
   [ERROR]  17 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  18 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  19 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  20 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  21 JavaScriptCore 0x000000010a47928d llint_entry + 63482
   
   [ERROR]  22 JavaScriptCore 0x000000010a47928d llint_entry + 63482
   
   [ERROR]  23 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  24 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  25 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  26 JavaScriptCore 0x000000010a478b71 llint_entry + 61662
   
   [ERROR]  27 JavaScriptCore 0x000000010a4698d9 vmEntryToJavaScript + 200
   
   [ERROR]  28 JavaScriptCore 0x000000010a84f730 _ZN3JSC11Interpreter11executeCallEPNS_9ExecStateEPNS_8JSObjectENS_8CallTypeERKNS_8CallDataENS_7JSValueERKNS_7ArgListE + 464
   
   [ERROR]  29 JavaScriptCore 0x000000010aa94634 _ZN3JSC12profiledCallEPNS_9ExecStateENS_15ProfilingReasonENS_7JSValueENS_8CallTypeERKNS_8CallDataES3_RKNS_7ArgListE + 196
   
   [ERROR]  30 JavaScriptCore 0x000000010a4b46fe JSObjectCallAsFunction + 478
   
   [ERROR]  31 TitaniumKit 0x000000010f46933f __65-[KrollObject invokeCallbackForKey:withObject:thisObject:onDone:]_block_invoke + 477
   
   [ERROR]  32 libdispatch.dylib 0x0000000112c48ccf _dispatch_call_block_and_release + 12
   
   [ERROR]  33 libdispatch.dylib 0x0000000112c49d02 _dispatch_client_callout + 8
   
   [ERROR]  34 libdispatch.dylib 0x0000000112c55a50 _dispatch_main_queue_callback_4CF + 1276
   
   [ERROR]  35 CoreFoundation 0x000000011088f8a9 __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__ + 9
   
   [ERROR]  36 CoreFoundation 0x0000000110889f56 __CFRunLoopRun + 2310
   
   [ERROR]  37 CoreFoundation 0x0000000110889302 CFRunLoopRunSpecific + 626
   
   [ERROR]  38 GraphicsServices 0x00000001165492fe GSEventRunModal + 65
   
   [ERROR]  39 UIKitCore 0x000000011b073ba2 UIApplicationMain + 140
   
   [ERROR]  40 LilyPad 0x0000000109905941 main + 1041
   
   [ERROR]  41 libdyld.dylib 0x0000000112cb7541 start + 1
   
   [ERROR]  42 ??? 0x0000000000000001 0x0 + 1
   </li>
<li>Sharif AbuDarda 2019-11-13

   Hello [~peterladis], Please provide the information that Vijay asked. We will be testing the issue on our end. Thank you.</li>
<li>Motiur Rahman 2019-12-23

   Hello! [~peterladis] are you still having this issue with the latest Ti SDK 8.2.1.GA, 8.3.0.GA? If so please share a test case and steps to reproduce the issue. If your app is rejected by Apple then what was apple's comment to reject the app?
   
   Regards,
   Motiur Rahman</li>
<li>Peter Ladis 2020-03-06

   FYI..this is still happening and apple sometimes rejects my app if I put location as a UIBackGround option in the plist
   
   Any ideas</li>
</ol>


<p><a href="/AC/AC-6399.json">JSON Source</a></p>