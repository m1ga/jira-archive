---
title: "[AC-6427] EncryptedDB - Android - Fetching from db very slow."
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Done</td></tr>
<tr><th>Resolution Date</th><td>2019-12-21T07:25:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Andrew Sankey</td></tr>
<tr><th>Assignee</th><td>Aminul Islam</td></tr>
<tr><th>Created</th><td>2019-11-06T12:57:21.000+0000</td></tr>
<tr><th>Updated</th><td>2019-12-21T07:25:56.000+0000</td></tr>
</table>

<h3>Description</h3>

We are experiencing a significant slowdown on Android when fetching data from an encrypted database using the appcelerator.encrypteddatabase module v3.1.0.

Using the sample todo app provided with the module running on a Nexus 6 device, when profiling the fetch calls, we are experiencing times of up to 1.5 seconds per fetch.  For comparison, when fetching from a standard database without encryption, the same calls are taking around 0.058s.

We have currently tried implementing suggestions from AC-6207, however these have had no effect.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6427_67161/EncryptedDB_Log.txt">EncryptedDB_Log.txt</td></td><td>2019-12-03T09:08:33.000+0000</td><td>37716</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/AC/AC-6427_67162/StandardDB_Log.txt">StandardDB_Log.txt</td></td><td>2019-12-03T09:08:38.000+0000</td><td>36347</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Aminul Islam 2019-12-02

   Hello!
   Thanks for reaching out! Could you please add your SDK version and comparison log for with and without the encryption database?
   
   Thanks </li>
<li>Andrew Sankey 2019-12-03

   The Titanium SDK used is 8.2.0.GA with the appcelerator.encrypteddatabase module v3.1.0.
   Device being used is Motorola Nexus 6 running Android v7.1.1.
   
   Using the sample todo app provided by the encrypted database, four todo entries where added to the database, then the fetch was profiled within the showTasks method found in index.js.
   
   When profiled with the encrypted database, these fetches where taking between 1.68 to 1.85 seconds.  With the encrypted database removed, the same fetches where only taking approx. 0.05 seconds. 
   
   See logs attached.
   [^EncryptedDB_Log.txt]  [^StandardDB_Log.txt] </li>
<li>Aminul Islam 2019-12-04

   Hello!
   We use the SQLCipher library to implement encrypted SQLite database support on Android and iOS. They provide the following guidance in improving performance...
   <a href="https://discuss.zetetic.net/t/sqlcipher-performance/14" rel="nofollow" target="_blank">https://discuss.zetetic.net/t/sqlcipher-performance/14</a>
   
   So, transactions should be used when doing multiple INSERTs and UPDATEs as a single batch. And you should be using indexes to reduce the SELECT, INSER, and UPDATE execution times as well. Also, opening the database file is expensive as well and you should leave it open if you are actively using it. Don't open and close it per database transaction.
   
   Note that execution times on Android are going to be a bit slower compared to iOS because there is "language-interop" involved. On iOS, the JavaScript, SQLite, and encryption APIs are all implemented in C, so there is no language interop or extra string copies that need to happen. On Android, there's additional overhead with copying the JavaScript C/C++ stringss to/from Java strings (involves transcoding to/from UTF-8 and UTF-16 too).
   
   
   Thanks </li>
<li>Matt Ward 2019-12-06

   Hi,
   Thank you for your response on optimisation,   however please can you perform some testing on the issue raised and confirm whether your can or cannot replicate.
   
   As outlined in the issue the timings are based on simple fetch statements from the example code you provide with the encrypted module,   whilst we understand there is overhead due to the encryption / decryption the fact are this has now risen from milliseconds to seconds over a couple of versions makes this library totally unusable.
   
   Thanks Matt</li>
<li>Aminul Islam 2019-12-19

   Hello!
   Yes, we can replicate this and it is not a platform bug.We use the SQLCipher library to implement encrypted SQLite database support on Android and iOS. Writes/read to file with encryption is especially expensive. To significantly improve performance, you need to reduce the number of file writes via database "transactions".
   
   Thanks </li>
</ol>


<p><a href="/AC/AC-6427.json">JSON Source</a></p>