---
title: "[AC-6452] Alloy custom $model.__transform mapping is broken"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Alloy</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Jorge Macias Garcia</td></tr>
<tr><th>Assignee</th><td>Shak Hossain</td></tr>
<tr><th>Created</th><td>2019-12-03T08:19:15.000+0000</td></tr>
<tr><th>Updated</th><td>2019-12-03T22:24:03.000+0000</td></tr>
</table>

<h3>Description</h3>

EDIT: Updated with working error example:

This [commit](<a href="https://github.com/appcelerator/alloy/commit/0d6a312cfa42d82919b695f38583a31cbedeb9c2#diff-a59a2178e486f81366775c39e5393695)" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/commit/0d6a312cfa42d82919b695f38583a31cbedeb9c2#diff-a59a2178e486f81366775c39e5393695)</a> brokes this use case:

- Custom mapping object with *$model.__transform* property

Example:

It's my fault Ewan. Try passing a deep object:


{noformat}
[ERROR] Script Error {
[ERROR]     column = 385;
[ERROR]     line = 49;
[ERROR]     message = "undefined is not an object (evaluating 'Alloy['Models']['user'].on')";
[ERROR]     sourceURL = "file:///Users/jormagar/Library/Developer/CoreSimulator/Devices/E90BCD03-DD1A-4ED4-A53E-E855EAF8D0F7/data/Containers/Bundle/Application/1285D017-A679-4740-AF70-0C257BD62EAF/AlloyDeepBinding.app/alloy/controllers/detail.js";
[ERROR]     stack = "    at Controller(/alloy/controllers/detail.js:49:385)\n    at (/alloy.js:428:53)\n    at doClick(/alloy/controllers/index.js:54:27)";
[ERROR]     toJSON = "<KrollCallback: 0x600002b9d780>";
[ERROR] } 
{noformat}

<code><pre>
//detail.xml
&lt;Alloy&gt;
  &lt;Window layout="vertical"&gt;  
    &lt;Label text="{user.owner.name}" top="50"/&gt;
    &lt;Label text="{user.contributor.name}" top="75"/&gt;
  &lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

<code><pre>

//index.js
  function onClick() {
    Alloy.createController('MyView', {
      $model: {
        __transform: {
          user: {
            owner: {
              name: 'Bob'
            },
            contributor: {
              name: 'Tom'
            }
          }
        }
      }
    }).getView().open();
  }

$.index.open();

</pre></code>

Coming back to the previous code before commit fixes it.


<h3>Comments</h3>

<ol>
<li>Ewan Harris 2019-12-03

   [~jormagar] could you elaborate a little more as to what the expected outcome is here, my code is below. When using the latest version of alloy (1.14.5) and building to an iOS simulator, I'm seeing two labels with "Bob" and "Bobson" after clicking on the button, when I revert the referenced commit I see exactly the same.
   
   To me the behaviour I'm seeing is expected, am I wrong? Am I creating the test case incorrectly?
   
   When
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Window class="container" &gt;
           &lt;Label onClick="onClick"&gt;Hello World&lt;/Label&gt;
   	&lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   function onClick() {
   	Alloy.createController('MyView', {
   		$model: {
   		  __transform: {
   			name: 'Bob',
   			surname: 'Bobson'
   		  }
   		}
   	  }).getView().open();
   }
   
   $.index.open();
   </pre></code>
   
   <code><pre>
   &lt;Alloy&gt;
     &lt;Window layout="vertical"&gt;  
       &lt;Label text="{name}" top="50"/&gt;
       &lt;Label text="{surname}" top="75"/&gt;
     &lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code></li>
<li>Jorge Macias Garcia 2019-12-03

   It's my fault Ewan. Try passing a deep object:
   
   
   {noformat}
   [ERROR] Script Error {
   [ERROR]     column = 385;
   [ERROR]     line = 49;
   [ERROR]     message = "undefined is not an object (evaluating 'Alloy['Models']['user'].on')";
   [ERROR]     sourceURL = "file:///Users/jormagar/Library/Developer/CoreSimulator/Devices/E90BCD03-DD1A-4ED4-A53E-E855EAF8D0F7/data/Containers/Bundle/Application/1285D017-A679-4740-AF70-0C257BD62EAF/AlloyDeepBinding.app/alloy/controllers/detail.js";
   [ERROR]     stack = "    at Controller(/alloy/controllers/detail.js:49:385)\n    at (/alloy.js:428:53)\n    at doClick(/alloy/controllers/index.js:54:27)";
   [ERROR]     toJSON = "<KrollCallback: 0x600002b9d780>";
   [ERROR] } 
   {noformat}
   
   
   <code><pre>
   //detail.xml
   &lt;Alloy&gt;
     &lt;Window layout="vertical"&gt;  
       &lt;Label text="{user.owner.name}" top="50"/&gt;
       &lt;Label text="{user.contributor.name}" top="75"/&gt;
     &lt;/Window&gt;
   &lt;/Alloy&gt;
   
   //index.js
     function onClick() {
       Alloy.createController('MyView', {
         $model: {
           __transform: {
             user: {
               owner: {
                 name: 'Bob'
               },
               contributor: {
                 name: 'Tom'
               }
             }
           }
         }
       }).getView().open();
     }
   
   $.index.open();
   
   </pre></code>
   </li>
</ol>


<p><a href="/AC/AC-6452.json">JSON Source</a></p>