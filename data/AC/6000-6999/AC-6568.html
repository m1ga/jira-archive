---
title: "[AC-6568] iOS: WebView.setHtml with baseURL doesn't seem to work correctly"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Titanium SDK & CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Teun Klijn</td></tr>
<tr><th>Assignee</th><td>Abir Mukherjee</td></tr>
<tr><th>Created</th><td>2020-07-07T12:40:57.000+0000</td></tr>
<tr><th>Updated</th><td>2020-07-21T08:01:56.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary*

I'm downloading some images from the internet and storing them in the Ti.Filesystem.applicationDataDirectory. Since WKWebView was introduced we can no longer access the application directory directly, but I thought we could work around this by setting the baseURL in the second parameter of WebView.setHTML.

*Step to reproduce*

<h4>Add the example code to a Titanium classic project</h4>
<h4>Set the SDK to 9.0.3.GA</h4>
<h4>Run the app on iOS and wait for the webview to load (black content)</h4>

<code><pre>
const window = Ti.UI.createWindow();
const wv = Ti.UI.createWebView();
window.add(wv);

function getContentDir() {
  var dir = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, 'content/');
  if (!dir.exists()) {
    dir.createDirectory();
  }
  return dir;
}

function getImage() {
  const contentDir = getContentDir();
  return Ti.Filesystem.getFile(contentDir.nativePath, 'image.png');
}

function request() {
  return new Promise(function (resolve, reject) {
    const req = Ti.Network.createHTTPClient({
      onload: () =&gt; {
        resolve(req.responseData);
      },
      onerror: (error) =&gt; {
        reject(error);
      },
      timeout: 15000
    });

    req.open("GET", "<a href="https://www.appcelerator.com/wp-content/uploads/Axway_logo_horiz_clr_rev_rgb.png" rel="nofollow" target="_blank">https://www.appcelerator.com/wp-content/uploads/Axway_logo_horiz_clr_rev_rgb.png</a>");
    req.send(null);
  });
}

function getWrappedHTML(bodyContent) {
  return <code>&lt;!doctype html&gt;
          &lt;html&gt;
            &lt;head&gt;
              &lt;meta charset="utf-8"&gt;
              &lt;meta name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"&gt;
            &lt;/head&gt;
            &lt;body style="background-color: black;"&gt;
              &lt;div&gt;${bodyContent}&lt;/div&gt;
            &lt;/body&gt;
          &lt;/html&gt;</code>;
}

function loadImage() {
  console.log(getContentDir().nativePath);
  // setHtml with baseURL
  wv.setHtml(getWrappedHTML(<code>&lt;img src="image.png" /&gt;</code>), { baseURL : getContentDir().nativePath });
}

window.addEventListener('open', () =&gt; {
  const image = getImage();

  if (image.exists()) {
    loadImage(image);
  } else {
    request().then((response) =&gt; {
      image.write(response);
      loadImage(image);
    }).catch((error) =&gt; {
      console.log(error);
    });
  } 
});

window.open();
</pre></code>

*Expected result*

The webview shows the axway logo on a black background.

*Actual result*

The webview shows a black background with a missing image.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-07-07

   As of 9.0.0, the <code>WebView</code> has a new "assetsDirectory" property. Set it to the same directory as your "baseURL".
   <a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.WebView-property-assetsDirectory
   
   This is a security feature in Apple's <code>WKWebView</code>. You have to give it permission to access files from local storage by setting this property.
   </li>
<li>Teun Klijn 2020-07-08

   Thank you for your feedback, but it still doesn't work when I set the assetsDirectory. This does work when I set the url property instead using setHtml, but I don't want to use html files. The strange thing is that I don't even see the image on a simulator, and I think a simulator does have access to the application directory without setting the assetsDirectory right?</li>
<li>Teun Klijn 2020-07-16

   Is there any update on this?</li>
<li>Vijay Singh 2020-07-20

   [~teunklijn@telfort.nl] See discussion in TIMOB-27064. Probably it will help you. 
   So -
   1. It is limitation from WKWebView.
   2. Either you can use base64 encoding of image in your html text (example is given in comment section of TIMOB-27064) Or
   3. Write your html data in a file and use in combination with assetsDirectory (again example is in comment section of TIMOB-27064)
   
   Thanks!</li>
<li>Teun Klijn 2020-07-21

   Ok thanks! I was already using the base64 method, so I guess I'll keep using that.</li>
</ol>


<p><a href="/AC/AC-6568.json">JSON Source</a></p>