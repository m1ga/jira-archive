---
title: "[ALOY-267] Improve Malformed XML error reporting"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-10-01T19:51:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>2012 Sprint 19</td></tr>
<tr><th>Fix Version/s</th><td>2012 Sprint 20, Release 3.0.0</td></tr>
<tr><th>Components</th><td>XML</td></tr>
<tr><th>Labels</th><td>notable</td></tr>
<tr><th>Reporter</th><td>Tony Lukasavage</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2012-09-14T07:48:18.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-07T22:26:11.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

ALOY-250 solved the issue of malformed XML and making it abort Alloy compilation. Unfortunately it required a hack-ish workaround to a shortcoming in the xmldom module. Specifically, xmldom only reports a message via <code>console.warn</code> when it encounters malformed XML. It does not abort the parsing, which results in tough-to-debug, unexpected behavior for developers. To remedy, when executing <code>new DOMParser().parseFromString</code> in Alloy, we override <code>console.warn</code> before the call to make it abort the app if encountered, and then set <code>console.warn</code> back to normal afterwards. here's the snippet:

<code><pre>
var warn = console.warn;
console.warn = function(msg) {
	exports.die(['Error parsing XML document', msg]);
};
var doc = new DOMParser().parseFromString(string);
console.warn = warn;
</pre></code>

Obviously this type of hack should ideally be avoided. it would also be nice if we could get more information other than just the tag names of the XML involved, like perhaps line numbers. In any case, this needs to be revisited and improved.

* The hack alternatives
** An issue has been logged for error reporting. Ideally this will be implemented by the owner, but the repository doesn't exactly see a lot of activity.
** fork and modify ourselves and maintain a alloy-specific version of xmldom
** Looks for other xml alternatives, like jsdom (see also, time-consuming)

<h4>Update (9/14/2012)</h4>

My original logged issue has not yet been commented on: <a href="https://github.com/jindw/xmldom/issues/36" rel="nofollow" target="_blank">https://github.com/jindw/xmldom/issues/36</a>

but the apparently work is underway: <a href="https://github.com/jindw/xmldom/commit/eb17b3af06eae4d7d29c5debe74780e347deb0b3" rel="nofollow" target="_blank">https://github.com/jindw/xmldom/commit/eb17b3af06eae4d7d29c5debe74780e347deb0b3</a>

Will watch progress and keep an eye out for new published version to npm.

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2012-10-01

   Increased the priority as it turns out some of the bad xmldom error reporting, or lack thereof, can cause freezes in the alloy process. Not ending in error, but instead chewing up resources until it is manually aborted. </li>
<li>Tony Lukasavage 2012-10-01

   Got a few other devs to test more complex apps and all looks good with the xml parsing and new error output.</li>
</ol>


<p><a href="/ALOY/ALOY-267.json">JSON Source</a></p>