---
title: "[ALOY-272] Grammar for TSS files"
---
<table>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-01-08T16:29:22.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>2012 Sprint 20</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 0.3.5, 2013 Sprint 02</td></tr>
<tr><th>Components</th><td>XML</td></tr>
<tr><th>Labels</th><td>GA-candidate, notable</td></tr>
<tr><th>Reporter</th><td>Tony Lukasavage</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2012-09-15T09:10:25.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-07T22:25:33.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>description</h4>

Our current parsers rely on the style being able to be parsed by the uglifyjs AST parser. Removing the commas breaks this first initial step before we pass it to the JSON parser. It shows us a larger problem in that we should probably have a complete parsing expression grammar for TSS files. This will allow us to account for more than just commas, but also comments and things like that.

We should attempt to use [pegjs](<a href="http://pegjs.majda.cz/)" rel="nofollow" target="_blank">http://pegjs.majda.cz/)</a> to create the grammar as it can then be run through Alloy's node scripts. After that it can be incorporated into Alloy, replacing the current method of using the uglifyjs AST parsing, followed by JSON.parse. 

<h4>notes</h4>

* We may need to drop <code>expr()</code> syntax to keep the grammar from needing to understand all of Javascript as well, which is not a small grammar as you might imagine. I think dropping expr() is fine as it was a catch-all before we had device queries and will be made further obsolete with the introduction of dynamic styles in ALOY-210.
* Grammar will allow us to add comments, which we can't do with the current method.
* This will make our styles more flexibile in the future if we need further changes

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2012-09-15

   Initial grammar here: <a href="https://github.com/appcelerator/alloy/blob/master/Alloy/grammar/tss.pegjs" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/Alloy/grammar/tss.pegjs</a></li>
<li>Tony Lukasavage 2013-01-08

   Grammar-based parser now being used for TSS parsing. All unit tests are passing. Additionally the Codestrong app also parses all of its styles correctly.</li>
</ol>


<p><a href="/ALOY/ALOY-272.json">JSON Source</a></p>