---
title: "[ALOY-479] Migration processing bug"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-01-23T16:45:42.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 0.3.6</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.0.0, 2013 Sprint 02</td></tr>
<tr><th>Components</th><td>Runtime</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Tony Lukasavage</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2013-01-22T14:43:10.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-07T22:25:52.000+0000</td></tr>
</table>

<h3>Description</h3>

from Ben Hatfield:

Here is the code:  <a href="https://gist.github.com/4589676" rel="nofollow" target="_blank">https://gist.github.com/4589676</a>

Here are the step to reproduce the two issues:

<h4>Make sure line #16 (migration attribute) in models/book.js is commented.  Run code as is on the iOS simulator.  Application should run OK.  Table version should be at version #2. In console output, the collection data should show title, author, alloy_id and isbn (as null).</h4>
<h4>Uncomment line #16 in models/book.js.  Run code. Application should run OK. Table version should be at version 1. Console output should show collection data with only title, author and alloy_id.  Isbn field should be gone.</h4>
<h4>Recomment line #16 and run code.  The preloaded data is displayed twice on the simulator. Table version is at version 2 again. --> Table upgrade is OK except duplicate preload data. Seems to be applying version 1 again despite already being at that state previously.</h4>
<h4>Uncomment line #16 in models/book.js, and uncomment line #16 (dropTable) and comment out line #15 (DROP TABLE + db.name) in migrations/201300182216120_book.js (second version). Run code. Application throws SQL statement error.</h4>
<h4>Undo changes to migration file. Recomment line #16 and uncomment line #15.  Run code.  Application should run OK.  All data is gone since the migration was interrupted in the previous step. --> dropTable method is not working for this downgrade.</h4>

<h3>Comments</h3>

<p>No comments</p>

<p><a href="/ALOY/ALOY-479.json">JSON Source</a></p>