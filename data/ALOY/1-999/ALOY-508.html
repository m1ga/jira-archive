---
title: "[ALOY-508] sql_new adapter doesn't save the id provided when creating a new object"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-02-07T13:53:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.1.0, 2013 Sprint 03</td></tr>
<tr><th>Components</th><td>Runtime</td></tr>
<tr><th>Labels</th><td>qe-port, qe-sdk3.0.2</td></tr>
<tr><th>Reporter</th><td>Jordi Vicedo</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-01-24T06:49:32.000+0000</td></tr>
<tr><th>Updated</th><td>2013-03-12T18:16:48.000+0000</td></tr>
</table>

<h3>Description</h3>

When you create a new object like:
m = Alloy.createModel(modelName);
m.attributes.customID = 1234;
m.save();

it doesn't save the id provided. I think that this provided should be saved, because if you provide this value is because you want this object to have this id (for example for synchronizing from another source).

Assuming this is the desided behaviour, the line that is wrong is (sql_new.js:98)
model.idAttribute === ALLOY_ID_DEFAULT ? model.id = util.guid() : model.id = null;

And should be replaced by:
model.idAttribute === ALLOY_ID_DEFAULT ? model.id = util.guid() : model.id = model.attributes[model.idAttribute];




<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-02-07

   Why wouldn't you just set m.idAttribute to "customId"?</li>
<li>Jordi Vicedo 2013-02-07

   In the model, is set to customid:
   {noformat}
   [...]
   "adapter": {
       [...]
       idAttribute: "customID"
   }
   [...]
   {noformat}
   
   After working with Alloy for various days, I've found that we don't need this: we can make any field a primary key, and then retrieve the object using a query ( collection.fetch{query: ... }); )</li>
<li>Tony Lukasavage 2013-02-07

   OK, I'm understanding what you mean in the original ticket description now. I'll take a look and see what I can do.</li>
<li>Tony Lukasavage 2013-02-07

   On a side note, use <code>m.set('customId',1234)</code>, not <code>m.attributes.customID = 1234;</code>. Setting m.attributes directly will circumvent any Backbone.js eventing that should take place.</li>
<li>Tony Lukasavage 2013-02-07

   Resolved, tested, and will be available in Alloy 1.0.0. 
   
   The easiest way to test this fix is to use the [models/sql_keywords test app](<a href="https://github.com/appcelerator/alloy/tree/master/test/apps/models/sql_keywords)" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/models/sql_keywords)</a>, but *BEFORE* running it, make sure to remove the *AUTOINCREMENT* keyword from both the model and migration files. In addition, add a *fighterId* field to each inserted row in the migration. The changes are summed up in this gist:
   
   <a href="https://gist.github.com/tonylukasavage/4731041" rel="nofollow" target="_blank">https://gist.github.com/tonylukasavage/4731041</a>
   
   Make these changes in the test app, before running it, then run it and inspect the sqlite db file on the simulator/device to confirm that the ids from the migrations are used, not autoincrement ids.</li>
<li>Federico Casali 2013-02-07

   Verified fixed on 1.0.0-cr and 1_0_X latest branch on iOS (iPAd 6.0, iPhone 5) and Android (Nexus 4 4.2, Nexus 7 4.1.2 and Nexus One 2.2.2)</li>
</ol>


<p><a href="/ALOY/ALOY-508.json">JSON Source</a></p>