---
title: "[ALOY-533] Better error message when defining menu on a lightweight window"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-07-19T19:03:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.2.0, 2013 Sprint 15</td></tr>
<tr><th>Components</th><td>Runtime, XML</td></tr>
<tr><th>Labels</th><td>qe-testadded</td></tr>
<tr><th>Reporter</th><td>Jeff English</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-02-22T16:10:52.000+0000</td></tr>
<tr><th>Updated</th><td>2013-07-24T00:07:04.000+0000</td></tr>
</table>

<h3>Description</h3>

If you define a lightweight window that includes the definition of a 'menu' and attempt to 'open' it, at runtime it will display an obscure error message -- "Uncaught TypeError: Cannot call method 'extend' of undefined"

(see attached screen shot)

It turns out that this is due to the fact that a menu can only be defined on a heavyweight window. Changing the window definition to be a heavyweight window resolves the issue.

It would be helpful to have the error message indicate that you are attempting to set a menu on a lightweight window.

Reproduction Steps:
1. Create a new Alloy project (use the default 'simple' template)
2. Edit the index.xml file
3. Add a menu to the window definition
4. Run as an Android application (simulator or device)

You should get the attached error dialog

5. Add the 'navBarHidden=true' attribute to the 'Window' element in index.xml
6. Run as an Android application (simulator or device)

The application should run fine and you should see the menu when you press the menu button.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-533_35697/Screen Shot 2013-02-22 at 10.03.29 AM.png">Screen Shot 2013-02-22 at 10.03.29 AM.png</td></td><td>2013-02-22T16:10:52.000+0000</td><td>27187</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-07-19

   PR: <a href="https://github.com/appcelerator/alloy/pull/189" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/189</a>
   test app: <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/ui/android_menu" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/ui/android_menu</a>
   
   This only needs to be tested functionally on Android. Follow these steps.
   
   <h4>Run the test app on Android</h4>
   <h4>on Window 1, press the menu button to open the Android Menu. You should see a "help" and "home" button, like in the first attached screenshot.</h4>
   <h4>Click the "home" button, which should open window 2.</h4>
   <h4>Click the menu button again, which should open the a menu with different menu buttons (wrench and arrow), pictured in the second screenshot</h4>
   
   after you have confirmed that you are getting 2 separate menus, go back to the app code and try this now:
   
   <h4>Open "app/styles/win2.tss" and remove "modal: false". This will make the window 2 a lightweight window.</h4>
   <h4>Run the app again</h4>
   <h4>Follow steps 2-3 from the first section</h4>
   <h4>Check the console log and make sure you see the warning in the 3rd screenshot</h4>
   <h4>Click the menu button. It should be the same menu as the first window since window 2 is lightweight and cannot hold its own menu.</h4></li>
<li>Federico Casali 2013-07-23

   Verified as fixed.
   
   Environment:
   
   Titanium SDK 3.1.2.v20130718094558
   Alloy 1.2.0
   Appcelerator Studio 3.1.1.201306131423
   LiveView 0.1.28
   
   Android device 4.2.2
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-533.json">JSON Source</a></p>