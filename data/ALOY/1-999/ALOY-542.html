---
title: "[ALOY-542] idAttribute set to a model attribute that is of type text not persisting"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-03-15T22:05:15.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.1.0, 2013 Sprint 06</td></tr>
<tr><th>Components</th><td>Titanium SDK</td></tr>
<tr><th>Labels</th><td>alloy, ios, model, sqlite</td></tr>
<tr><th>Reporter</th><td>David Welch</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-03-05T21:00:50.000+0000</td></tr>
<tr><th>Updated</th><td>2013-03-26T01:07:53.000+0000</td></tr>
</table>

<h3>Description</h3>

The example of idAttribute in the alloy test examples (sql_keywords) works, but when setting idAttribute to a model attribute that is of type text it won't persist the data. 

Example app attached. 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-542_35927/app.zip">app.zip</td></td><td>2013-03-05T21:00:50.000+0000</td><td>5766452</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-03-05

   Did you try this on a fresh project, or did you change the idAttribute after the SQLite database had already been built?</li>
<li>David Welch 2013-03-05

   I tried this on a fresh project. After it didn't work I deleted the app and tried it without idAttribute where it worked. </li>
<li>David Welch 2013-03-05

   It should be noted that it only works when artist_id is "integer PRIMARY KEY AUTOINCREMENT". If it's "integer PRIMARY KEY" or "text" the data won't persist. I delete the database each time to start fresh.</li>
<li>David Welch 2013-03-05

   Clearly, when I set artist_id to "integer PRIMARY KEY AUTOINCREMENT" or "integer PRIMARY KEY" I change my code in index.js to set it to an integer instead of string. </li>
<li>Tony Lukasavage 2013-03-05

   That's weird since the default behavior in the absence of the idAttribute is for alloy to create one itself, a GUID that is a TEXT field named "alloy_id". I'll have to dig into your sample to see why it's not working in your case.</li>
<li>David Welch 2013-03-05

   I thought so as well since alloy_id is text. Either way I wasn't able to persist the data.</li>
<li>Kaos Arts 2013-03-11

   Ran into this bug too. 
   
   // idAttribute = "email"
   
   // This silently fails to save
   var userM = Alloy.createModel('userModel', {email: userEmail, name: "Test"});
   userM.save();
   
   // This works
   var userM = Alloy.createModel('userModel', {email: userEmail, name: "Test"});
   userM.id = null;
   userM.save();
   
   Looks like the root cause of this bug is that when idAttribute value is set the model.id is also assigned immediately, before its saved.  Too soon.  That causes backbone's isNew() to return false at save, and attempt an update instead of a create.  Which then silently fails obviously (it'll even call the success function if you set one!)  A hack-around is to set model.id = null after createModel() but before save().
   </li>
<li>Tony Lukasavage 2013-03-13

   I found the same Kimberlee, apologies for not logging it here earlier to save the time of others investigating. I'm working on this one now.</li>
<li>Tony Lukasavage 2013-03-15

   This turned out to be a lot more complicated than expected initially. Mainly because the resolution to this issue involved changing the way the sql adapter inserts and updates, which is now based on DB constraints. This in turn changed the properties of the default alloy_id field used for automatically assigning unique ids to models, which had implications on adding alloy_id to existing databases, particularly preloaded ones. Details of all this are covered in this commit (props to Aaron Saunders for the initial code for these changes): <a href="https://github.com/appcelerator/alloy/commit/d511ebd64b5b1e8f840d1be80b90f0639d251e87" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/commit/d511ebd64b5b1e8f840d1be80b90f0639d251e87</a>
   
   In addition, the core issue of this ticket can be seen addressed in the following test app: <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/models/sql_idAttribute" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/models/sql_idAttribute</a></li>
</ol>


<p><a href="/ALOY/ALOY-542.json">JSON Source</a></p>