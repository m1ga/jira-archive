---
title: "[ALOY-552] Alloy generates erroneous code to set an event listener inside a repetition view"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-03-18T19:27:39.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.1.0, 2013 Sprint 06</td></tr>
<tr><th>Components</th><td>Runtime, XML</td></tr>
<tr><th>Labels</th><td>alloy, alloy-generate, qe-port</td></tr>
<tr><th>Reporter</th><td>Andrey Chirikba</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-03-12T11:28:58.000+0000</td></tr>
<tr><th>Updated</th><td>2013-05-01T14:56:29.000+0000</td></tr>
</table>

<h3>Description</h3>

When using XML markup to set an event listener on an element inside a repetition view, Alloy generates erroneous code. The auto-generated object ids are not counted correctly, which leads to using one id to create an object and another id to try and set an event listener on it. Consider this snippet:

<View dataCollection="document" layout="vertical">
	<Label text="{id}" onClick="idClicked"/>
</View>

It is translated to the below:

    var __alloyId8 = function(e) {
        var models = Alloy.Collections.document.models, children = $.__views.__alloyId4.children;
        for (var d = children.length - 1; d >= 0; d--) $.__views.__alloyId4.remove(children[d]);
        len = models.length;
        for (var i = 0; i < len; i++) {
            var __alloyId5 = models[i];
            __alloyId5.__transform = {};
            var __alloyId7 = Ti.UI.createLabel({
                width: Ti.UI.SIZE,
                height: Ti.UI.SIZE,
                color: "#000",
                text: typeof __alloyId5.__transform.id != "undefined" ? __alloyId5.__transform.id : __alloyId5.get("id"),
                id: "__alloyId6"
            });
            $.__views.__alloyId4.add(__alloyId7);
            idClicked ? $.__views.__alloyId6.addEventListener("click", idClicked) : __defers["$.__views.__alloyId6!click!idClicked"] = !0;
        }
    };

Notice the __alloyId6 id is used to try and set the event listener instead of __alloyId7 that was actually defined.

This leads to a run-time crash. Please see a testcase attached.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-552_36196/RepeaterTestcase.zip">RepeaterTestcase.zip</td></td><td>2013-03-12T11:28:58.000+0000</td><td>38300</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Federico Casali 2013-04-09

   Verified as fixed.
   
   Alloy version 1.1.0-cr
   CLI version 3.1.0-cr
   Android and iOS
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-552.json">JSON Source</a></p>