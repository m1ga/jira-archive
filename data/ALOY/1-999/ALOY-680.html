---
title: "[ALOY-680] add compiler directives to distinguish between ad-hoc and app-store distribution"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-02-05T23:11:33.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.4.0, 2014 Sprint 03</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>notable, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Daniel Sefton</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-05-31T16:26:53.000+0000</td></tr>
<tr><th>Updated</th><td>2014-05-19T09:14:48.000+0000</td></tr>
</table>

<h3>Description</h3>

It would be nice, if it would be possible to programmatically distinguish between ad-hoc and app-store distribution.

So like the other environment compiler directives:
ENV_DEV
ENV_TEST
ENV_PROD
it would be nice to have something like:
DIST_IOS_ADHOC
DIST_IOS_APPSTORE

also see Q&A:
<a href="http://developer.appcelerator.com/question/152765/alloy-is-there-any-way-to-have-conditional-code-distinguishing-between-ad-hoc-distribution-and-app-store-distribution" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/152765/alloy-is-there-any-way-to-have-conditional-code-distinguishing-between-ad-hoc-distribution-and-app-store-distribution</a>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-680_45398/app.zip">app.zip</td></td><td>2014-01-27T15:52:39.000+0000</td><td>3835821</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2013-11-21

   Yes yes yes, want this! Also would like to have them available in <code>config.json</code> so I can set different API keys for stuff like TestFlight, push and backends.</li>
<li>Malcolm Hollingsworth 2013-11-21

   This is one of those things that really hits a specific need - whilst it will not benefit everyone - the power users really need this sort of thing.</li>
<li>Tim Poulsen 2014-01-27

   Goal is for an app like the attached to output ad-hoc values when built from Studio or CLI as an Ad-Hoc build. Proposal that the config.json value would be ENV_ADHOC because ad-hoc is a type of a production build -- you can do a production build for the App Store *or* Ad-Hoc, but not both. So, there's no need to have to set both ENV_PRODUCTION and DIST_TYPE=adhoc to identify an ad-hoc build.</li>
<li>Fokke Zandbergen 2014-01-27

   As long as an adhoc build also has ENV_PRODUCTION true I'm fine with it.</li>
<li>Tony Lukasavage 2014-01-27

   Yep, ENV_ADHOC will also set ENV_PRODUCTION and ENV_PROD</li>
<li>Fokke Zandbergen 2014-01-27

   And then there should be ENV_STORE of course</li>
<li>Tim Poulsen 2014-01-27

   Why? If the default of ENV_ADHOC is false (as it is for any of the values), simply testing for ENV_PROD should be sufficient. What am I missing?</li>
<li>Tony Lukasavage 2014-01-27

   We were going to have that be implied with ENV_PROD is ENV_ADHOC was not true. This is making think that developers should have access to make compiler conditionals on any value from the CLI they choose. Unless you have a strong objection [~fokke] we will likely leave this ticket as defined and just account for ENV_ADHOC, but another ticket for giving access to the data in the alloy hook that comes straight from the CLI might be beneficial, heading this problem off before it occurs again.</li>
<li>Fokke Zandbergen 2014-01-27

   So if I want to target code for App Store only I need this?
   
   <code><pre>
   if (ENV_PRODUCTION && !ENV_ADHOC) {}
   </pre></code></li>
<li>Tim Poulsen 2014-01-28

    Your build target (app store or adhoc) is decided by the CLI and passed to Alloy as a parameter.
    
    ENV_ADHOC will be true only for ad-hoc builds. ENV_PROD will be true for both app store and ad-hoc builds.
    
    config.json: 
     * settings in ENV_PROD will be applied in both types of builds
     * settings in ENV_ADHOC will be applied for only ad-hoc builds, and would override settings in ENV_PROD
    
    compiler directives in controllers:
     * if(ENV_PROD) {} // would run in both app store and ad-hoc builds, though obviously you'd do one or the other type build
     * if(ENV_ADHOC) {} // would run in only ad-hoc builds if build type is ad-hoc
     * if(ENV_PROD && !ENV_ADHOC) {} // would run for only an app-store build
     * if(ENV_ADHOC && !ENV_PROD) {} // wouldn't run
    </li>
<li>Fokke Zandbergen 2014-01-28

    Well, I dont find that very logical, but I guess it will do</li>
<li>Fokke Zandbergen 2014-01-28

    My final attempt to talk you out of (only) <code>ENV_ADHOC</code>:
    
    - Targeting App Store using <code>ENV_PROD && !ENV_ADHOC</code> is like using <code>!OS_IOS</code> to target Android. It requires people to know about all options and how they relate.
    - As it is now both <code>OS_</code> and <code>ENV_</code> have only one of them <code>true</code> at the same time. I would keep it that way.
    - I don't know of any other OS or language where two types of ENV (environment) can be <code>true</code> at the same time.
    - AdHoc and AppStore are no environments, they are two ways to distribute.
    
    I would strongly advice to go with both <code>DIST_ADHOC</code> and <code>DIST_STORE</code> and make the second one <code>TRUE</code> both both <code>dist-appstore</code> and <code>dist-playstore</code> targets.</li>
<li>Tony Lukasavage 2014-02-05

    <h4>implementation</h4>
    
    * *DIST_ADHOC* - will be true when the iOS build target is "dist-adhoc"
    * *DIST_STORE* - will be true when the iOS build target is "dist-appstore", or the android build target is "dist-playstore" 
    
    <h4>code</h4>
    
    PR: <a href="https://github.com/appcelerator/alloy/pull/329" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/329</a>
    test app: <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-680" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-680</a>
    
    <h4>functional test</h4>
    
    This should be executed for all of the following. The "deployType" for all will be "production", the "target" is shown in the parens next to each:
    
    * Android playstore distribution ("store")
    * iOS adhoc build ("adhoc")
    * iOS itunes store build ("store")
    
    <h4>Execute one of the build process mentioned above on the test app</h4>
    <h4>While you could do the entire packaging, and easier way to test would be to abort the build process after the alloy step completes and then inspect the generated code.</h4>
    <h4>Go to "Resources/PLATFORM/alloy/controllers/index.js"</h4>
    <h4>Check the end of the generated code where the "deployType" and "dist" variables are assigned. </h4>
    <h4>Confirm that the strings assigned to those variables match what you would expect, as noted in parens next to each build type above.</h4>
    </li>
<li>Fokke Zandbergen 2014-05-19

    </li>
<li>Malcolm Hollingsworth 2014-05-19

    </li>
</ol>


<p><a href="/ALOY/ALOY-680.json">JSON Source</a></p>