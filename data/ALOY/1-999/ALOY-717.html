---
title: "[ALOY-717] Improve "reflow"/"repaint" functionality when adding and removing classes"
---
<table>
<tr><th>Type</th><td>Sub-task</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-08-26T11:37:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.2.0, 2013 Sprint 15</td></tr>
<tr><th>Components</th><td>Runtime, Styling</td></tr>
<tr><th>Labels</th><td>notable, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Tony Lukasavage</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2013-06-21T15:57:20.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-07T22:25:55.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>problem</h4>

Currently when adding/removing position or visual properties from a proxy via the <code>Alloy.addClass()</code> or <code>Alloy.removeClass()</code>, these properties are not reset. To illustrate what I mean, consider the following styles:

<code><pre>
".label": {
    text: "I'm in the middle",
    width: 150
}

".right": {
    text: "I'll be on the right",
    right: 0
}
</pre></code>

If I create an XML UI component like this:

<code><pre>
&lt;Label class="label"/&gt;
</pre></code>

The label will say "I'm in the middle" and be centered. If I add the "right" class to it via <code>Alloy.addClass()</code>, as expected, it will then say "I'll be on the right" and will move to the right side of the screen. If I then use <code>Alloy.removeClass()</code> to remove the "right" class, the expectation would be that it would move back to the center and reset the text to the original. Unfortunately, only the text will be reset since it will be reapplied by the "label" class, but <code>right:0</code> will remain attached to the proxy, keeping it on the right. 

We need to devise a way to automatically, and safely, reset positioning and visual properties on a proxy when removing classes.

<h4>workaround</h4>

The case given above would behave as expected if you set <code>right:null</code> in the "label" style, like this:

<code><pre>
".label": {
    text: "I'm in the middle",
    width: 150,
    right: null
}

".right": {
    text: "I'll be on the right",
    right: 0
}
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-717_41869/alloy717_1_android_4.0.4.png">alloy717_1_android_4.0.4.png</td></td><td>2013-08-26T10:56:54.000+0000</td><td>52970</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-717_41867/alloy717_1.png">alloy717_1.png</td></td><td>2013-08-26T10:56:54.000+0000</td><td>56886</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-717_41870/alloy717_3_android_4.0.4.png">alloy717_3_android_4.0.4.png</td></td><td>2013-08-26T10:56:54.000+0000</td><td>96952</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-717_41868/alloy717_5.png">alloy717_5.png</td></td><td>2013-08-26T10:56:54.000+0000</td><td>84559</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-07-16

   PR: <a href="https://github.com/appcelerator/alloy/pull/181" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/181</a>
   test app: <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-717" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-717</a>
   
   Functional testing should be confirmed on all supported platforms. To confirm that everything is working as expected do the following:
   
   <h4>Run the app, it should start without error</h4>
   <h4>Read the first class name in the list presented on the screen.</h4>
   <h4>Click the "change classes" button</h4>
   <h4>The first class will be removed and the Label will reflect that in its text and properties. For example, the first click will remove the "transform" class, which should make the text display flat instead of rotated 45 degrees. </h4>
   <h4>Repeat steps 2-4 until you cycle through all properties and end up back to the original state</h4></li>
<li>Paras Mishra 2013-08-26

   Executed the app <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-717" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-717</a> on Linux OS.
   
   Steps to reproduce:
   
   1. Run the app, it should start without error
   2. Read the first class name in the list presented on the screen.
   3. Click the "change classes" button
   4. The first class will be removed and the Label will reflect that in its text and properties. For example, the first click will  remove the "transform" class, which should make the text display flat instead of rotated 45 degrees.
   5. Repeat steps 2-4 until you cycle through all properties and end up back to the original state
   
   Actual:
   After cycling through all properties original state is not reached.Screen shots are attached. Issue occurs on android 2.3.6 devices.
   Using the Test Environment as
   
   Device: Google nexus 3, android v4.0.4
   Device: Samasung Galaxy Note, android v2.3.6
   OS: Ubuntu 10.04.4 LTS
   SDK: 3.1.3.v20130822140128, 3.1.2 GA
   Appcelerator Studio: 3.1.3.201308201707
   Alloy: 1.2.1-cr2
   CLI version : 3.1.2
   
   </li>
<li>Tony Lukasavage 2013-08-26

   [~pmishra] the issue you cite on android is a direct result of this linked ticket: TIMOB-14568
   
   The functionality from Alloy's perspective is executing as expected. The app will work as expected when all linked tickets are resolved, and this particular issue will be resolved when the aforementioned ticket is resolved.</li>
</ol>


<p><a href="/ALOY/ALOY-717.json">JSON Source</a></p>