---
title: "[ALOY-753] Alloy properties adapter 'reset' event fired twice"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-07-22T16:31:52.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.2.0, 2013 Sprint 15</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>qe-testadded</td></tr>
<tr><th>Reporter</th><td>Jong Eun Lee</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-07-20T06:52:55.000+0000</td></tr>
<tr><th>Updated</th><td>2013-07-31T00:45:14.000+0000</td></tr>
</table>

<h3>Description</h3>

When collection fetch, "reset" event fired twice.

user.js
<code><pre> 
exports.definition = {
	config: {
		adapter: {
			type: "properties",
			collection_name: "user"
		}
	},		
	extendModel: function(Model) {		
		_.extend(Model.prototype, {
			// extended functions and properties go here
		});
		
		return Model;
	},
	extendCollection: function(Collection) {		
		_.extend(Collection.prototype, {
			// extended functions and properties go here
		});
		
		return Collection;
	}
}
</pre></code> 

index.js
<code><pre> 
var personCol = Alloy.createCollection('user');

personCol.on('reset',function(){
	alert('reset');
});

personCol.fetch();
</pre></code> 

Why properties adapter call reset method in Sync function (19line properties.js)?

<code><pre>
function Sync(method, model, opts) {
    var prefix = model.config.adapter.collection_name ? model.config.adapter.collection_name : "default";
    var regex = new RegExp("^(" + prefix + ")\\-(.+)$");
    var resp = null;
    if ("read" === method) if (opts.parse) {
        var list = [];
        _.each(TAP.listProperties(), function(prop) {
            var match = prop.match(regex);
            null !== match && list.push(TAP.getObject(prop));
        });
        model.reset(list); // <!--- THIS LINE
        resp = list;
    } else {
...
.
</pre></code>

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-07-22

   PR: <a href="https://github.com/appcelerator/alloy/pull/192" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/192</a></li>
<li>Tony Lukasavage 2013-07-22

   Original PR: <a href="https://github.com/appcelerator/alloy/pull/192" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/192</a>
   PR with test app: <a href="https://github.com/appcelerator/alloy/pull/193" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/193</a>
   test app: <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-753" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/testing/ALOY-753</a>
   
   Functional testing can be passed by simply running the test app and confirming that the "reset" alert dialog only pops up one. Before this fix it would have popped up twice.</li>
<li>Federico Casali 2013-07-31

   Verified to be working as expected.
   
   Titanium SDK 3.1.2.v20130726192706
   Alloy 1.2.0-alpha
   Appcelerator Studio 3.1.2.201307261628
   CLI 3.1.2
   Node 0.8.22
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-753.json">JSON Source</a></p>