---
title: "[ALOY-765] Alloy: Introduce a compiler hook that runs before assets are copied"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-10-23T20:27:50.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.3.0, 2013 Sprint 22</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>alloy, compiler, hook, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-07-27T18:53:37.000+0000</td></tr>
<tr><th>Updated</th><td>2013-11-11T22:14:05.000+0000</td></tr>
</table>

<h3>Description</h3>

The first compiler hook is currently <code>pre:compile</code> and runs before compile (duh..), but after libs and assets have been copied.

I did an <code>alloy.jmk</code> file that searches for retina <code>@2x</code> images and uses ImageMagick to generate non-retina images if they don't already exist. Now because the <code>pre:compile</code> hooks runs *after* the assets have been copied, I have to search both the <code>app</code> and the <code>Resources</code> folder.

I'm sure there are other cases like this, for which a new <code>pre:assets|files|copy</code> hook would be useful. For the above use case, having this hook would also allow me to know the time of the previous compile (by getting the ctime of the <code>Resources/alloy</code> folder) and use this to detect updated retina files as well.

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-07-30

   Oe would it make more sense to just have the pre:compile hook fire earlier in the process, before anything is moved to the Resources folder?</li>
<li>Fokke Zandbergen 2013-07-30

   If that wouldn't mess up how people use it that would be OK of course. The only reason it would is that you want to change the copied files BEFORE compile, but since these files are not affected by compile that wouldn't make sense. So yeah, if you're OK with that... GO :)</li>
<li>Fokke Zandbergen 2013-10-23

   PR: <a href="https://github.com/appcelerator/alloy/pull/252" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/252</a></li>
<li>Tony Lukasavage 2013-10-23

   <h4>functionality</h4>
   
   The existing *pre:compile* and *post:compile* tasks will execute just as they have in the past, at the same time in the process that they always have. A new task *pre:load* will be executed before any assets or libraries are copied into the alloy project's resources folder.
   
   <h4>testing</h4>
   
   PR: <a href="https://github.com/appcelerator/alloy/pull/255" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/255</a>
   test app: <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/advanced/alloy_jmk" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/advanced/alloy_jmk</a>
   
   Functional test:
   
   <h4>Run the test app</h4>
   <h4>Check the alloy console output to ensure that all 3 hooks fire in this order</h4>
   ** pre:load
   ** pre:compile
   ** post:compile
   <h4>Ensure that the files <code>dummy1.txt, dummy2.txt, dummy3.txt</code> appear in the list of files in the *pre:compile* step, but not the *pre:load* step. *NOTE:* If you perform the compile more than once, the dummy files will appear in both steps.</h4>
   <h4>Make sure there are no errors</h4></li>
<li>Federico Casali 2013-10-28

   Verified working as expected. 
   
   TiSDK 3.2.0.v20131028093244 
   CLI 3.2.0
   Alloy 1.3.0
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-765.json">JSON Source</a></p>