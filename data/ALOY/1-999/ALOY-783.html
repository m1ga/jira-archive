---
title: "[ALOY-783] Alloy: config.json environment-specific global values are ignored, always returning the env:development value"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-08-14T23:52:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.2.0, 2013 Sprint 17</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.2.0, 2013 Sprint 17</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>qe-3.1.2, qe-testadded, regression</td></tr>
<tr><th>Reporter</th><td>Federico Casali</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-08-14T07:03:36.000+0000</td></tr>
<tr><th>Updated</th><td>2013-08-15T22:56:04.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
Environment specific global values are not respected, the value returned is always the one relative to the 'env:development'

<h4>Steps to reproduce</h4>
1. Run the sample code

<h4>config.json</h4>
<code><pre>
{
	"global": {
		"key": "defaultValue",
		"anotherKey": 12345
	},
	"env:development": {
		"environment": "development"
	},
	"env:test": {
		"environment": "test"
	},
	"env:production": {
		"environment": "production"
	},
	"os:ios": {
		"key": "iosValue"
	},
	"os:android": {
		"key": "androidValue"
	},
	"dependencies": {}
}
</pre></code>

<h4>index.xml</h4>
<code><pre>
&lt;Alloy&gt;
    &lt;Window id="win" backgroundColor="white" exitOnClose="true" fullscreen="false" title="ScrollView Demo"&gt;
        &lt;View id="view" backgroundColor="#336699"&gt;
        	&lt;Label id='label1' top='20'&gt;platform key: &lt;/Label&gt;
        	&lt;Label id='label2' top='80'&gt;global key: &lt;/Label&gt;
        	&lt;Label id='label3' top='140'&gt;environment: &lt;/Label&gt;
        &lt;/View&gt;
    &lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

<h4>index.js</h4>
<code><pre>
// Alloy.Globals.someGlobalObject = { key: 'value' };

$.label1.text =  $.label1.text + ' ' + Alloy.CFG.key;
$.label2.text =  $.label2.text + ' ' + Alloy.CFG.anotherKey;
$.label3.text =  $.label3.text + ' ' + Alloy.CFG.environment;


if ((Alloy.isHandheld) && (OS_IOS)){
	alert('iphone handheld!')
}
else if ((Alloy.isHandheld) && (OS_ANDROID)){
	alert('android handheld')
}
else if ((Alloy.isTablet)&&(OS_IOS)){
	alert('ipad tablet!')
}
else if ((Alloy.isTablet)&&(OS_ANDROID)){
	alert('android tablet')
}
else if (OS_MOBILEWEB){
	alert('mobileweb!')
}
else {
	alert("I don't know!'")
}

$.win.open();

</pre></code>

2. Build for packaging (tested on Android)
3. Install the package on device and run the app

Result: 'environment: development' label is displayed
Expected result: "environment: production" label should be displayed.

<h4>Note</h4>
This is not reproducible on Alloy 1.1.3, so is a regression.

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-08-14

   Notes so far:
   
   I am able to see this problem even on 1.1.3, doing both test and production builds, they always show up as development. I've also tried various versions of the CLI (3.1.0-3.2.0) and the TiSDK. All behave the same way for android builds. 
   
   In perusing the CLI android build command code, it appears that the deploy type is never actually set. Unfortunately, due to the way the CLI is structured, this appears to be a change that needs to be made in the TiSDK, not the CLI node module. 
   
   <a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/cli/commands/_build.js" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/cli/commands/_build.js</a>
   
   If you look in the above file you'll see that "deploy-type" is not implemented as an option (it's commented out). In addition, when specifying a device build, you'd use the "--target, -T" option, which does not modify the deploy type in anyway. In fact, as Federico confirmed with the packaging test, no where in the _build.js file does it appear that the deploy type is taken into account. The "deployTypes" defined at the top of the file appear to be unused.
   
   This appears to be a TIMOB CLI issue, but I will need to confirm with [~fcasali].</li>
<li>Tony Lukasavage 2013-08-14

   PR: <a href="https://github.com/appcelerator/alloy/pull/221" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/221</a>
   
   [~fcasali] can you test this against the test app you laid out in the ticket here and make sure that it behaves as expected for all builds? Please install alloy with the following command:
   
   <code><pre>
   sudo npm install -g git://github.com/appcelerator/alloy.git#1_2_X
   </pre></code></li>
<li>Tony Lukasavage 2013-08-14

   Re-opening to address issue with CFG.js not updating when deploy type changes. Also is affected by TIMOB-14884.</li>
<li>Tony Lukasavage 2013-08-14

   PR: <a href="https://github.com/appcelerator/alloy/pull/222" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/222</a>
   
   [~fcasali] try all the tests again. All mentioned issues should now pass when installing from the 1_2_X branch as mentioned above.
   
   <code><pre>
   sudo npm install -g git://github.com/appcelerator/alloy.git#1_2_X
   </pre></code></li>
<li>Tony Lukasavage 2013-08-14

   Confirmed as resolved. Pushed alloy 1.2.0-beta as a result.</li>
<li>Federico Casali 2013-08-15

   Verified fixed. 
   Environment specific global variables are returned correctly depending on the deploy.
   
   Titanium SDK  3.1.2.v20130814124556
   Alloy 1.2.0-beta
   Appcelerator Studio 3.1.2.201308091728
   CLI 3.1.2-alpha
   Node 0.10.13
   
   Android, iOS and MobileWeb
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-783.json">JSON Source</a></p>