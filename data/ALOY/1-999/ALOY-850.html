---
title: "[ALOY-850] Alloy: Automatically remove constants for platforms not targeted on compile"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2013-10-18T18:01:50.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Tooling</td></tr>
<tr><th>Labels</th><td>alloy, compiler, platform</td></tr>
<tr><th>Reporter</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Assignee</th><td>Tony Lukasavage</td></tr>
<tr><th>Created</th><td>2013-10-17T13:55:11.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-22T13:23:13.000+0000</td></tr>
</table>

<h3>Description</h3>

I'm all for using <code>[platform=ios]</code> and so, but I wonder if the Alloy compiler could take away the need to do that for the very simple and very common case where in TSS, but also in JS/XML you would use platform specific constants that don't exist if you don't build for that platform.

<h4>Example code</h4>

1. Create a new project: <code>titanium create -p android,ios -n ns --id ti.ns -d .</code>
2. Initialize Alloy: <code>cd ns && alloy new</code>
3. Replace the contents of <code>index.tss</code> with:
    <code><pre>
    ".container": {
        statusBarStyle: Titanium.UI.iPhone.statusBarStyle.LIGHT_CONTENT
    }
    </pre></code>
4. Build for Android: <code>titanium build -p android -T device</code>
5. The app will crash with:
    <code><pre>
    10-17 15:39:40.420: E/TiExceptionHandler(12559): (main) [152,152] ----- Titanium Javascript Runtime Error -----
    10-17 15:39:40.425: E/TiExceptionHandler(12559): (main) [0,152] - In alloy/controllers/index.js:15,58
    10-17 15:39:40.425: E/TiExceptionHandler(12559): (main) [1,153] - Message: Uncaught TypeError: Cannot read property 'LIGHT_CONTENT' of undefined
    10-17 15:39:40.425: E/TiExceptionHandler(12559): (main) [0,153] - Source:         statusBarStyle: Titanium.UI.iPhone.statusBarStyle.LIGHT_CONTENT,
    10-17 15:39:40.450: W/ResourceType(12559): Failure getting entry for 0x010802c0 (t=7 e=704) in package 0 (error -75)
    10-17 15:39:40.455: E/V8Exception(12559): Exception occurred at alloy/controllers/index.js:15: Uncaught TypeError: Cannot read property 'LIGHT_CONTENT' of undefined
    </pre></code>

<h4>Possible solutions</h4>
The TSS/XML/JS parsers could check for references to these platform specific constants and then just replace them with <code>null</code> (or <code>undefined</code>?) when that specific platform is not targeted.

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2013-10-18

   I don't see a reason to do this, particularly when it will increase compile time, when the device query is already readily available. </li>
<li>Malcolm Hollingsworth 2013-10-19

   @Tony - this is a very annoying issue that I have come across myself more than once even though I take care in the code I am creating.
   
   Whilst it will increase the time to compile - that time must surely be measured in the milliseconds in total.  By forcing a code based exception surely there is more code to check against for the compiler - so I would imagine one would cancel the other out.
   
   At the most basic level this could be nothing more than "if constant includes ios/iphone/ipad ignore for others" and so on.
   
   I would greatly value this clean-up method being automatic, Alloy is not meant to do our work for us, but it should be able to handle something I find such an obvious feature requirement.
   
   I vote this is re-opened.</li>
<li>Stephen Feather 2013-10-19

   What is the true time increase on compile?
   
   What is the cost to implement?
   
   What is the cost savings across 1 developer?
   
   What is the cost savings across all developers?</li>
<li>Fokke Zandbergen 2013-10-19

   From your standpoint and role to keep Alloy lean and mean I understand you don't like to add this Tony. However, from a developer stand point this is just another way in which Alloy saves us time and code to write. So I hope you can take a more pragmatic standpoint and allow me to do a PR including test and benchmark.</li>
</ol>


<p><a href="/ALOY/ALOY-850.json">JSON Source</a></p>