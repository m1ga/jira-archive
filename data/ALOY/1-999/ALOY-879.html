---
title: "[ALOY-879] Alloy: Properly expose Alloy NPM package as a CommonJS module"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 2.0.0</td></tr>
<tr><th>Components</th><td>Tooling</td></tr>
<tr><th>Labels</th><td>alloy, tooling</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2013-11-11T12:08:27.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-07T22:26:07.000+0000</td></tr>
</table>

<h3>Description</h3>

Right now, the Alloy NPM <code>package.json</code> points to <code>./bin/alloy</code> for the executable and <code>./Alloy/alloy</code> for the main entry point when required externally using <code>require('alloy');</code>:

<code><pre>
  "bin": {
    "alloy": "./bin/alloy"
  },
  "scripts": {
    "test": "jake test:all"
  },
  "main": "./Alloy/alloy",
</pre></code>

However, under the hood the executable simply requires <code>./Alloy/alloy</code>, which is not exporting any methods but instead just uses commander to manage the CLI. This makes an external require of Alloy absolutely useless.

<h4>Why support <code>require</code>?</h4>

Alloy is very well organised, with different utilities that are also of interest for stand-alone contributions like now promoted with the pluggable Titanium CLI in 3.2 master. For example:

* <code>./Alloy/commands/compile/styler</code> for reading TSS files etc.
* <code>./Alloy/utils.js</code> for XML view manipulation, searching for widgets etc.
* <code>./Alloy/tiapp.js</code> for reading and manipulating <code>tiapp.xml</code>.

It would be nice if these would be available externally, e.g.:

<code><pre>
var styler = require('alloy').styler;
style = styler.loadStyle('my.tss');
</pre></code>

<h4>How?</h4>
The easy way would just to add new file and change the <code>main</code> property in the <code>package.json</code> to point to it, containing e.g.:

<code><pre>
exports.styler = require('./commands/compile/styler.js');
exports.utils = require('./utils.js');
exports.tiapp = require('./tiapp.js');
</pre></code>

But I'd even recommend restructuring the files a little. Move the code currently in <code>./Alloy/alloy.js</code> to <code>./bin/alloy</code> or create a new <code>./Alloy/cli.js</code> and require this from the executable. Then keep <code>alloy.js</code> as the entry point for external require's.

<h3>Comments</h3>

<p>No comments</p>

<p><a href="/ALOY/ALOY-879.json">JSON Source</a></p>