---
title: "[ALOY-913] Error TextField on addEventListener on dataCollection"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-08-26T18:23:47.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.5.0</td></tr>
<tr><th>Components</th><td>Models, XML</td></tr>
<tr><th>Labels</th><td>ios, qe-manualtest</td></tr>
<tr><th>Reporter</th><td>Afranio Martins</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2013-12-24T14:42:05.000+0000</td></tr>
<tr><th>Updated</th><td>2014-08-27T23:22:27.000+0000</td></tr>
</table>

<h3>Description</h3>

index.xml:

<code><pre>
&lt;Alloy&gt;
  &lt;Collection id="library" src="library" instance="true"/&gt;
  &lt;Window id="index"&gt;
    &lt;View dataCollection="$.library"&gt;
      &lt;Label text="{name}" /&gt;
      &lt;TextField text="Quantity" onBlur="setQuantity" /&gt;
    &lt;/View&gt;
  &lt;Window&gt;
&lt;/Alloy&gt;
</pre></code>

Add a viewMore function in index.js:

<code><pre>

function setQuantity(event) {
  alert('View more');
}
 
$.index.open();

</pre></code>

<h4>Results Alloy output</h4>

<code><pre>
for (var i = 0; len &gt; i; i++) {
//...
var __alloyId219 = Ti.UI.createTextField({});

setQuantity ? $.__views.__alloyId211.addEventListener("blur", setQuantity) : __defers["$.__views.__alloyId211!blur!setQuantity"] = true;

//...
}
</pre></code>

<h4>error</h4>

message = "'undefined' is not an object (evaluating '$.__views.__alloyId211.addEventListener')";

<h3>Comments</h3>

<ol>
<li>Afranio Martins 2014-01-08

   <h4>A solution that works, but do not know if it is correct</h4>
   
   {color:red}
   File Alloy/commands/compile/parsers/Ti.UI.TextField.js
   <code><pre>
   
   *After*
   </pre></code>
   	// Update the parsing state
   	return {
   		parent: {},
   		styles: state.styles,
   		code: code
   	};
   <code><pre>
   
   *Before*
   
   </pre></code>
   	// Update the parsing state
   	nodeState.styles = state.styles;
   	nodeState.code = code;
   	return nodeState;
   ```
   
   :D</li>
<li>Tim Poulsen 2014-05-19

   Fix for one is probably going to solve the other</li>
<li>Feon Sua Xin Miao 2014-05-28

   PR: <a href="https://github.com/appcelerator/alloy/pull/419" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/419</a>
   Test app: <a href="https://github.com/feons/alloy/tree/ALOY-913/test/apps/testing/ALOY-913" rel="nofollow" target="_blank">https://github.com/feons/alloy/tree/ALOY-913/test/apps/testing/ALOY-913</a>
   
   Functional Test:
   
       1. Run the test app on iOS
       2. Check Resources/iphone/alloy/controllers/index.js: 
   <code><pre>
    37             var __alloyId6 = Ti.UI.createTextField({
    38                 right: 0,
    39                 height: "50dp",
    40                 width: "100dp",
    41                 borderColor: "#ccc",
    42                 borderWidth: 1,
    43                 value: "1",
    44                 color: "#000",
    45                 text: "Quantity"
    46             });
    47             __alloyId4.add(__alloyId6);
    48             setQuantity ? __alloyId6.addEventListener("focus", setQuantity) : __defers["__alloyId6!focus!setQuantity"] = true;
   </pre></code>
       3. The event listener is attached to the right object *__alloyId6.*
   </li>
<li>Tim Poulsen 2014-05-30

   PR tested and merged</li>
<li>Federico Casali 2014-08-22

   Event listener seems to be attached correctly, however the sample app presents a couple of issues. 
   
   1. In Styles folder, instead of app.tss , there is an app.js , which in studio is generating an error message.
   2. Sample is not runnable on Android as in the index.xml the <TabbedBar> object is used, which is iOS only. Removing it , it runs fine also on Android.
   
   Reopening.
   
   TiSDK  3.4.0.v20140820125714
   Appcelerator Studio 3.4.0.201408201526 
   CLI 3.4.0-dev
   Alloy 1.5.0-dev
   Xcode6-beta5
   </li>
<li>Feon Sua Xin Miao 2014-08-26

   Master PR: <a href="https://github.com/appcelerator/alloy/pull/525" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/525</a>
   1_5_X PR: <a href="https://github.com/appcelerator/alloy/pull/526" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/526</a>
   
   Updated test app.</li>
<li>Feon Sua Xin Miao 2014-08-26

   [~skypanther] would you review & merge those PRs?</li>
<li>Tim Poulsen 2014-08-26

   I've merged the PR against master. However the PR on 1_5_X includes extraneous changes. It will need to be resubmitted.</li>
<li>Feon Sua Xin Miao 2014-08-26

   [~skypanther] Here's the new PR.
   New PR for 1_5_X: <a href="https://github.com/appcelerator/alloy/pull/529" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/529</a>
   </li>
<li>Tim Poulsen 2014-08-26

    Both PRs merged</li>
<li>Ewan Harris 2014-08-27

    Verified fix on:
    
    Mac OSX 10.9.4
    Appcelerator Studio, build: 3.4.0.201408270900
    Titanium SDK build:  3.4.0.v20140827134113 
    Titanium CLI, build: 3.4.0-dev
    Alloy: 1.5.0-dev
    iOS Device 5S (7.1.1)
    Android Emulator 4.4.2
    
    Event listener is attached correctly as per Federico's comment. Sample is now runnable on Android as <TabbedBar> has been removed and the app.js file in styles has been replaced by app.tss.
    
    Closing ticket.</li>
</ol>


<p><a href="/ALOY/ALOY-913.json">JSON Source</a></p>