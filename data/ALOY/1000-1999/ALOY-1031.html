---
title: "[ALOY-1031] Alloy: ListView not binding correctly with Collection when using Encrypted Database Module"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2014-05-28T17:33:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.3.1</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.5.0</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>qe-manualtest, supportTeam</td></tr>
<tr><th>Reporter</th><td>Marco Cota</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-05-23T01:27:42.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-07T22:28:27.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue</h4>

In iOS when using a custom sync for enabling the Encrypted Database Module as a type for the model and binding the collection to a listView after calling  the first fetch the listView get correctly populated, but when trying to call a fetch with a SQL query the listView does not reflect the new data in the collection.

After testing using the standard sql type or using the encrypted database in Android everything works as expected.

<h4>Steps to repro</h4>

1. Run the Sample app attached (encDB.zip) in iOS.
2. Type 3 letter into the search bar.

Expected Result:

After inserting 3 characters the collection will fetch using a SQL query and the listView will be updated. 

Actual Result:

After inserting 3 characters the collection is fetch using a SQL query but the listView is not updated. 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1031_48299/encDB.zip">encDB.zip</td></td><td>2014-05-23T01:27:42.000+0000</td><td>9809953</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen 2014-05-28

   Here's what I did to get your example app working.
   
   *Solution 1*
   
   First, I removed <code>onChange="didTextChangeInSearchBar"</code> from the <code>&lt;SearchBar&gt;</code> component. Also in the XML, I added searchableText="{title}" to the ListItem within the ListSection to specify the text to be searched. Then, in searchController.js, I added this to the top:
   
   <code><pre>
   $.searchList.addEventListener('change', function(e){
   	if($.searchList.value.trim().length &gt;=3 ) {
   		$.listMain.searchText = e.value;
   		Ti.API.info('****** search text = ' + e.value);
   	} else {
   		$.listMain.searchText = '';
   	}
   });
   $.searchList.addEventListener('cancel', function(e){
   	$.listMain.searchText = '';
   });
   </pre></code>
   
   Using that code, once you've entered three characters into the search box, the list is filtered as expected. If you backspace or tap Cancel, the filter is removed and the entire list contents is removed. You could merge my code here with your <code>didTextChangeInSearchBar()</code> function if you wanted.
   
   *Solution 2*
   
   Alternatively, you can use the ListView's native filtering function by doing this: Again, start by removing <code>onChange="didTextChangeInSearchBar"</code> from the <code>&lt;SearchBar&gt;</code> component and adding searchableText="{title}" to the ListItem. Then, to searchController.js add this single statement but not the preceding code:
   
   <code><pre>
   $.listMain.searchView = $.searchList;
   </pre></code>
   
   You can't set this property in the XML (for which I'll file a separate ticket). And it filters automatically on each character you enter (not waiting till you've entered three characters as your use-case specifies).
   
   *Environment*
   
   * - Ti SDK 3.2.3.GA
   * - CLI 3.4.0-dev
   * - Alloy 1.4.0-alpha4 (though there's no reason why my solution above wouldn't also work with 1.3.1)
   * - Encrypted DB module -- the version that was included with your encDB.zip file
   * - App version - whatever was in encDB.zip
   </li>
<li>Tim Poulsen 2014-05-28

   Works as expected when using the API techniques as documented and as illustrated in the comments added to the ticket.</li>
<li>Eric Merriman  2018-03-07

   Closing as invalid. If this is incorrect, please reopen.</li>
</ol>


<p><a href="/ALOY/ALOY-1031.json">JSON Source</a></p>