---
title: "[ALOY-1038] Conditionals with negation are not working"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-06-05T00:42:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.4.0</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.4.0</td></tr>
<tr><th>Components</th><td>Styling, XML</td></tr>
<tr><th>Labels</th><td>qe-3.3.0, qe-testadded, regression</td></tr>
<tr><th>Reporter</th><td>Federico Casali</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-06-03T19:39:38.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-06T21:57:43.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
On Android, using a conditional with negation is not working on 1.4.0.
Works fine using Alloy 1.3.1 so is a regression.

<h4>Steps to reproduce</h4>
The Journal sample app can be used to reproduce the issue.
1. Get the code from:  <a href="https://github.com/appcelerator/alloy/tree/master/test/apps/models/journal" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/tree/master/test/apps/models/journal</a>
2. Run on Android. Add an item. 
Result: when adding an entry a runtime error is displayed (see screenshot). 

3. Go to "views/add.xml" and change:
<code><pre>
&lt;Picker id="mood" platform="!ios"&gt;
</pre></code>
to
<code><pre>
&lt;Picker id="mood" platform="android"&gt;
</pre></code>
Run on Android and add an item

Result: item is added as expected. 

Basically, using the conditional "!ios" is not working and the picker object was not being correctly created.

 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1038_48575/Screen Shot 2014-06-03 at 12.38.33 PM.png">Screen Shot 2014-06-03 at 12.38.33 PM.png</td></td><td>2014-06-03T19:39:38.000+0000</td><td>57814</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen 2014-06-05

   In part, this issue was caused by the change to fix ALOY-989. However, negation only ever worked in the XML. In other words, this would have worked prior to 989:
   
   <code>&lt;View platform="!ios"/&gt;</code>
   
   However, this would not have:
   
   <code>"#someView\[platform=!ios]"</code>
   
   This fix submitted here enables negation in both XML and TSS, as well as supporting comma-separated lists of conditionals in both XML & TSS.
   
   PR <a href="https://github.com/appcelerator/alloy/pull/428" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/428</a>
   
   Functional test
   
   1. Use the test app included with the PR. Labels in the app describe the XML <code>platform</code> or TSS platform conditionals used. 
   2. Build for each of iOS, Android, and MobileWeb. You should see the number of labels as described in the app's output.
   3. Compare the labels displayed with the XML/TSS selectors used in the app's code</li>
<li>Tim Poulsen 2014-06-05

   PR tested and merged</li>
<li>Federico Casali 2014-06-06

   Verified fixed.
   
   Conditionals with negations works fine both when used into XML and TSS files for platform and formFactor queries. 
   CustomTSS queries does not support conditionals with negation.
   
   TiSDK 3.3.0.v20140605150555
   Alloy 1.4.0-beta2 
   Appcelerator Studio 3.3.0.201405271647
   CLI 3.3.0-beta2
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-1038.json">JSON Source</a></p>