---
title: "[ALOY-1066] Windows, Android: Alloy build to device fails when spawning Alloy compile command"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-11-26T22:40:34.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.4.0</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.5.0, Alloy 1.4.0</td></tr>
<tr><th>Components</th><td>Tooling</td></tr>
<tr><th>Labels</th><td>qe-3.3.0, qe-noTestNeeded</td></tr>
<tr><th>Reporter</th><td>Samuel Dowse</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-07-01T18:11:21.000+0000</td></tr>
<tr><th>Updated</th><td>2014-11-26T22:40:34.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>
Android device builds will fail with Android SDK-Tools 23.0.1 installed.
Attached the log file of the error from the CLI.

<h4>Steps To Reproduce</h4>
1. Install the Android SDK-Tools 23.0.1 and all the necessary components
2. Create an Alloy project
3. Build to device

<h4>Expected Result</h4>
App should install on device

<h4>Actual Result</h4>
Build throws and errors and fails to install on device

<code><pre>
[ERROR] Failed to run command "build"
[ERROR] TypeError: Cannot call method 'on' of null
    at C:\Users\Tester\Documents\Appcelerator_Studio_Workspace\alloyAndroidProject\plugins\ti.alloy\hooks\alloy.js:132:18
</pre></code>

This error is happening because the stdio is not inheriting properly from the parent Titanium CLI process. This could be a Node.js issue, but I doubt it.

<h4>Solution</h4>

I think we need to explicitly specify the stdio streams for the spawned process. Inheriting stdio does not appear to be working.

In the long term, the Alloy compile command needs to be a first-class CLI hook that does not spawn the Alloy compile command. That will fix this permanently.

+Extra Information+
This only occurs on Windows.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1066_49409/Android2301Alloy.txt">Android2301Alloy.txt</td></td><td>2014-07-01T18:11:21.000+0000</td><td>6603</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen 2014-07-01

   PR: <a href="https://github.com/appcelerator/alloy/pull/468" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/468</a> 
   
   The problem is not due to child process not inheriting stdio, but rather that child.stdout and child.stderr aren't valid objects in the case of a compile error. To get error output on Windows, I have to pass in the \{ stdio: 'inherit' \} options object and I have to test for the validity of the child properties before listening for the on data events.
   
   I've tested this fix on Windows using Node 0.10.26 and 0.10.29 as well as on OS X with Node 0.10.28. It works as intended on all.
   
   If you're testing with an existing project, you'll have to do <code>ti clean</code> or copy <alloy_repo>hooks/alloy.js to <your_project>/plugins/ti.alloy/hooks/alloy.js.</li>
<li>Tim Poulsen 2014-07-01

   I need to test with the Android R23 tools before considering this issue resolved.</li>
<li>Tim Poulsen 2014-07-02

   Tested with Android R23 tools: the PR works as expected. The original issue is unrelated to Android tooling level.</li>
<li>Tim Poulsen 2014-07-02

   PR merged to master and 1_4_X branches</li>
</ol>


<p><a href="/ALOY/ALOY-1066.json">JSON Source</a></p>