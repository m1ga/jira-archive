---
title: "[ALOY-1092] Allow more query options / scope in .tss"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-10-07T04:17:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.5.0, Alloy 1.4.1</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.7.0</td></tr>
<tr><th>Components</th><td>Styling</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Rick Blalock</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-07-21T01:24:29.000+0000</td></tr>
<tr><th>Updated</th><td>2014-10-23T19:47:52.000+0000</td></tr>
</table>

<h3>Description</h3>

The docs state that you have to use Alloy.Globals.* in a .tss query.  You can actually use a local function in a controller too, i.e. <code>"#window[if=myFunc()]"</code> and that will work too.

What won't work however is basing a query off of params passed to the controller instance.  It would work, but the Alloy compiler doesn't allow it - <code>"#window[if=arguments[0].someProp]"</code>

This would be a very powerful addition to the new queries available.  It technically already works in the runtime code (I hardcoded it and tried it)...but it just won't compile right now because we're not allowed to put those characters in the tss query.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-1092_51794/Screen Shot 2014-10-03 at 3.34.28 PM.png">Screen Shot 2014-10-03 at 3.34.28 PM.png</td></td><td>2014-10-03T19:58:58.000+0000</td><td>252219</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ingo Muschenetz 2014-07-21

   [~rblalock] Which characters is it complaining about? The brackets? Could you escape them?</li>
<li>Tim Poulsen 2014-10-03

   See the attached screen. Even if the <code>arguments\[0\]</code> syntax worked, it would be pointing to the wrong arguments object. Your components are defined inside self-calling functions so <code>arguments</code> correspond to that function's args.
   
   My couple of attempts to work around this by using a local function didn't work either.
   
   <code><pre>
   function isSomePropertyTrue() {
      return args.someProperty;
      // fails because args has no value when this is run
      // because of hoisting (args exists, but has no value yet)
   }
   
   function isSomePropertyTrue() {
      return Array.prototype.slice.call(arguments)[0].someProperty;
      // fails because it runs in the context of the nested
      // IIFE and thus points to the wrong arguments object
   }
   </pre></code>
   
   And of course this wouldn't work either, as again it refers to the wrong arguments object
   
   <code><pre>
   "#argLabel[if=Array.prototype.slice.call(arguments).pop().someProperty]": {
      text: 'args.someProperty is truthy'
   }
   </pre></code></li>
<li>Rick Blalock 2014-10-03

   I wouldn't focus on my "arguments[0]" as what should be the solution - the goal of this ticket is not to try to tell you how to provide the solution.  The ticket is a request for more query options for TSS...the use case isn't "arguments[0]" but rather providing a scope from which the styles can be dynamic.
   
   As an idea for the problem you point out above.., instead of arguments[0] ... what if there was a <code>var __arguments = arguments[0];</code> put as the first line in the function?  That would be assessable inside the closure then.  
   
   Whatever the implementation is...the request is to allow arguments passed in a controller to determine tss styles.</li>
<li>Tim Poulsen 2014-10-06

   Reopening. I might be able to satisfy both this and ALOY-1037 with the same additions to the Controller() definition.</li>
<li>Tim Poulsen 2014-10-06

   PR <a href="https://github.com/appcelerator/alloy/pull/584" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/584</a> 
   
   Functional test: run the included ALOY\-1092 test app. Click the "Tap for new window" label. In the resulting window should be two labels, one saying the passed property was truthy and the other is present. Edit index.js and change the someProperty argument value to false and rebuild. This time, the child window will have just the first label saying the parameter was falsey.</li>
<li>Feon Sua Xin Miao 2014-10-07

   PR merged.</li>
</ol>


<p><a href="/ALOY/ALOY-1092.json">JSON Source</a></p>