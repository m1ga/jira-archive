---
title: "[ALOY-1118] Allow theming of tiapp.xml e.g. through Alloy themes"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2015-02-04T14:39:51.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.7.0</td></tr>
<tr><th>Components</th><td>Styling</td></tr>
<tr><th>Labels</th><td>themes, tiapp.xml</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-07-18T06:57:23.000+0000</td></tr>
<tr><th>Updated</th><td>2015-02-04T14:39:52.000+0000</td></tr>
</table>

<h3>Description</h3>

Now Alloy supports theming of <code>app/config.json</code> and <code>i18n</code> and <code>platforms</code> on their way, the last thing to tackle for easily building branded apps of a white label codebase is "theming" <code>tiapp.xml</code>.

This might me the most challenging one, since I guess the CLI already reads some information from <code>tiapp.xml</code> before the first hook that Alloy uses is triggered. Also, it will require some serious smarts to know when to overwrite and when to append XML tags and attributes.

<h3>Comments</h3>

<ol>
<li>Mauro Parra-Miranda 2014-08-26

   Thanks for your report [~fokke]! [~tlukasavage]: can you please set [~fokke] as the reporter? The system still switches it  to mover. </li>
<li>Tim Poulsen 2015-01-27

   This should be easily possible through the use of an Alloy JMK file. First-attempt resolution of this ticket should be the creation of a demonstration project using a JMK file to "theme" the tiapp.xml. Values to be changed per theme could be appid, guid, android map keys, and custom properties.
   
   (Incidentally, a grunt or gulp script could also easily accomplish the sorts of tiapp.xml customizations requested. As would <a href="https://github.com/jasonkneen/tich)" rel="nofollow" target="_blank">https://github.com/jasonkneen/tich)</a></li>
<li>Tim Poulsen 2015-02-03

   After playing with this for a bit, I've determined that neither the Alloy JMK or CLI hook is the solution to this. 
   
   Alloy JMK files hook into the build process too late. By the time they run, the CLI has read and cached the tiapp.xml. Swapping out the file at that point has no effect on the resulting build process.
   
   The CLI hooks don't have access to the necessary Alloy configuration information. (Such as the active theme.) While I could probably create a hook that reads in the config.json file, parses it, determines the theme, environment, etc. I think the resulting script would be a bit fragile.
   
   A reasonably simple solution is to use a grunt script.
   
   <h4>Step 1: Install grunt-cli</h4>
   
   <code>npm install -g grunt-cli</code>
   
   <h4>Step 2: In your project's directory, create a package.json file with contents like this:</h4>
   
   <code><pre>
   {
     "name": "YourAppName",
     "version": "1.0.0",
     "devDependencies": {
       "grunt": "~0.4.5"
     }
   }
   </pre></code>
   
   <h4>Step 3: In your project's directory, run:</h4>
   
   <code>npm install</code>
   
   <h4>Step 4: Create a file named Gruntfile.js in your project's directory. Copy the code below into it.</h4>
   
   <h4>Step 5: Use the grunt script:</h4>
   
   First, put a copy of tiapp.xml into the app/themes/yourtheme folder and customize that copy as necessary. Then:
   
   {noformat}
   > grunt theme:active_theme_name  // to swap in the theme's tiapp.xml
   > ti build -p ios ...  // as needed to build your app
   > grunt reset // to restore the original tiapp.xml
   {noformat}
   
   An exercise left to the reader is to implement the grunt-titanium plug-in to automate the building of the app.
   
   <code><pre>
   var fs = require('fs'),
     path = require('path');
   
   module.exports = function(grunt) {
     grunt.registerTask('theme', 'Swaps in a theme tiapp.xml', function(arg1) {
       if (arguments.length === 0) {
         grunt.log.writeln("You must pass the name of the theme in the form:");
         grunt.log.writeln("   grunt theme:foo")
       } else {
         grunt.log.writeln("Applying theme " + arg1);
         var projectDir = path.resolve('.');
         var themedir = path.join(projectDir, 'app', 'themes', arg1);
         if(fs.existsSync(path.join(themedir, 'tiapp.xml'))) {
           // And the active theme has a tiapp.xml, so we'll back up the original
           // and copy the theme's tiapp.xml over the original
           var tiappxml = path.join(projectDir, 'tiapp.xml');
           var origTiappxml = path.join(projectDir, 'tiapp_original.xml');
           if(!fs.existsSync(origTiappxml)) {
             // don't re-back up the original
             fs.renameSync(tiappxml, origTiappxml);
           }
           fs.writeFileSync(tiappxml, fs.readFileSync(path.join(themedir, 'tiapp.xml')));
         }
       }
     });
   
     grunt.registerTask('reset', 'Resets the original tiapp.xml', function() {
       grunt.log.writeln("Restoring original tiapp.xml");
       var projectDir = path.resolve('.');
       // remove themed tiapp.xml
       fs.unlinkSync(path.join(projectDir, 'tiapp.xml'));
       // rename the backup
       fs.renameSync(path.join(projectDir, 'tiapp_original.xml'), path.join(projectDir, 'tiapp.xml'))
     });
   
     grunt.registerTask('default', ['theme']);
   };
   </pre></code></li>
<li>Fokke Zandbergen 2015-02-04

   [~skypanther] As I wrote in the original ticket description, I was expecting this to be a chicken-egg problem already and I agree it should be handled via Grunt or alike. Instead of your solution to replace the <code>tiapp.xml</code> I would rather read the theme's <code>config.json</code> and then use Tony's <code>tiapp.xml</code> module to make specific changes, but that's just details. It might be a good subject for a blog post.</li>
<li>Tim Poulsen 2015-02-04

   Resolving as Won't Fix because we'll resolve this through a blog post describing how to use a build automation tool to accomplish the goal.</li>
</ol>


<p><a href="/ALOY/ALOY-1118.json">JSON Source</a></p>