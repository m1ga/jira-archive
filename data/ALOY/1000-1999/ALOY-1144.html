---
title: "[ALOY-1144] Alloy: createStyle turns proxy objects into JS objects"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-09-23T02:52:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.5.0</td></tr>
<tr><th>Components</th><td>Styling</td></tr>
<tr><th>Labels</th><td>1.5.0, Alloy, blocker, createStyle, deepExtend, qe-manualtest</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-09-19T10:54:42.000+0000</td></tr>
<tr><th>Updated</th><td>2014-11-19T00:23:40.000+0000</td></tr>
</table>

<h3>Description</h3>

In Alloy 1.5.0 [<code>Alloy.createStyle()</code>](<a href="https://github.com/appcelerator/alloy/blob/master/Alloy/lib/alloy.js#L233)" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/Alloy/lib/alloy.js#L233)</a> uses a new utility method [<code>deepExtend</code>](<a href="https://github.com/appcelerator/alloy/blob/master/Alloy/lib/alloy.js#L609)" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/Alloy/lib/alloy.js#L609)</a> to clone the merged properties. However, because of its implementation a proxy object like the transform passed as a default in the following example [will be turned into a JS object](<a href="https://github.com/appcelerator/alloy/blob/master/Alloy/lib/alloy.js#L652):" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/Alloy/lib/alloy.js#L652):</a>

<code><pre>
$.someView.animate($.createStyle({
  id: 'someId',
  transform: Ti.UI.create2DMatrix().scale(.5, .5),
  duration: 500
}));
</pre></code>

I have a PR to fix <code>deepExtend</code> by checking for <code>.__prototype</code> before cloning objects:

- <a href="https://github.com/appcelerator/alloy/pull/567" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/567</a>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen 2014-09-19

   Fokke's PR works as described. I've merged his PR into master.
   
   I've submitted <a href="https://github.com/appcelerator/alloy/pull/568" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/568</a> against the 1_5_X branch. This PR includes Fokke's fix as well as a test case app.
   
   Functional test: run the ALOY\-1144 test case app. Click the label, it should shrink by 50% in height & width. Without the fix provided by Fokke, an invalid transform option is supplied to the animate() method and nothing happens when you click the label.
   
   </li>
<li>Feon Sua Xin Miao 2014-09-19

   PR merged.</li>
<li>Fokke Zandbergen 2014-09-22

   There was an error in the PR causing JS objects also not to be deep extended. The fix:
   
   <a href="https://github.com/appcelerator/alloy/pull/569" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/569</a></li>
<li>Tim Poulsen 2014-09-22

   PR569 did not resolve the issue. However, PR 570 did. Approved and merged to the 1_5_X branch. 
   
   I've opened <a href="https://github.com/appcelerator/alloy/pull/571" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/571</a> to implement the same fix in the master branch.
   
   The proper functional test for this is the ALOY\-1051 test app (not the 1144 app previously mentioned).
   
   1. Run the ALOY\-1051 test app on iOS. The text should be large (30pt) in American Typewriter font.
   2. Tap the label. The alert box should show:
   
   <code><pre>
   {"font":{"fontFamily":"AmericanTypewriter", "fontSize": 30},"classes":["family","size"]}
   </pre></code>
   
   3. Run the same app on Android. The font family is not supported on Android, and depending on the emulator size/density, the font size will probably be visually pretty small. However, if you tap the label and you should get the same output as above. Not required, but you could modify the index.tss in the test app to set the font size to '30dp' rather than 30 to confirm that font properties are being properly mixed.</li>
<li>Feon Sua Xin Miao 2014-09-23

   PR merged.</li>
<li>Federico Casali 2014-09-25

   Verified fixed.
   
   TiSDK 3.4.0.v20140924140915 
   Appcelerator Studio 3.4.0.201409231834 
   CLI 3.4.0-rc4 
   Alloy 1.5.0-rc4 
   Xcode6
   
   iPad mini & iPhone 5 (iOS 8) and Android Galaxy Nexus 4.3
   
   Closing.</li>
</ol>


<p><a href="/ALOY/ALOY-1144.json">JSON Source</a></p>