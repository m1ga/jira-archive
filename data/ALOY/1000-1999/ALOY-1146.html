---
title: "[ALOY-1146] Picker values are not correctly returned using Dynamic Styles"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-09-26T20:22:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Alloy 1.5.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>qe-3.4.0, qe-manualtest, regression</td></tr>
<tr><th>Reporter</th><td>Federico Casali</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-09-23T00:48:47.000+0000</td></tr>
<tr><th>Updated</th><td>2014-11-20T22:16:06.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
Using Dynamic Styles classes, some properties of Picker objects are not returned correctly. 
It might be related to the fix introduced for ALOY-1051 (and eventually in PR501 for ALOY-1144), as is not reproducible using Alloy 1.4.1 and 1.5.0-rc3, but is reproducible using Alloy versions 1.5.0-rc4 and 1.5.0-rc (or 1.5.0-dev). 

<h4>Steps to reproduce</h4>
1. Run the attached sample code
2. Click on the 'Hello World' label and check console log

Result: 
<code><pre>
Ti.API.info(JSON.stringify($.createStyle({
		classes:['test', "pickerClass"]
	})));
</pre></code>

should return:<code><pre>
{"type":1,"minDate":"2012-01-01T00:00:00.000Z","maxDate":"2014-05-01T19:00:00.000Z","value":"2014-04-15T19:00:00.000Z","classes":["test","pickerClass"]}
</pre></code>
(and that is what is being returned using 1.4.1 and 1.5.0-rc3)

instead, using Alloy 1.5.0-rc or 1.5.0-rc4, it returns:
<code><pre>
{"type":1,"minDate":{},"maxDate":{},"value":{},"classes":["test","pickerClass"]}
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1146_51501/PickerProperties_dynamicStyles.zip">PickerProperties_dynamicStyles.zip</td></td><td>2014-09-23T00:48:47.000+0000</td><td>10393171</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2014-09-23

   ..</li>
<li>Tim Poulsen 2014-09-23

   With RC4 the alert/info statements show:
   
   * the properly merged properties for the dynamic style based on the family & size classes
   * incompletely merged properties for the dynamic style based on the test & pickerClass classes
   * the properly merged properties for the dynamic style based on the test2 & viewClass classes
   
   <code><pre>
   [INFO]  {"font":{"fontFamily":"AmericanTypewriter","fontSize":50},"duration":1000,"classes":["family","size"]}
   [INFO]  {"type":1,"minDate":{},"maxDate":{},"value":{},"classes":["test","pickerClass"]}
   [INFO]  {"type":1,"id":"pickerTest","value":"2014-04-15T16:00:00.000Z","horizontalWrap":true,"minDate":"2012-01-01T00:00:00.000Z","columns":[],"maxDate":"2014-05-01T16:00:00.000Z"}
   [INFO]  {"backgroundColor":"blue","width":"90%","height":50,"bottom":0,"pippo":"tanto pippo test, 22343","classes":["test2","viewClass"]}
   </pre></code>
   
   With RC3, the alert/info statements show:
   
   * incompletely merged properties for the dynamic style based on the family & size classes
   * the properly merged properties for the dynamic style based on the test & pickerClass classes
   * the properly merged properties for the dynamic style based on the test2 & viewClass classes
   
   <code><pre>
   [INFO]  {"font":{"fontSize":50},"duration":1000,"classes":["family","size"]}
   [INFO]  {"type":1,"minDate":"2012-01-01T00:00:00.000Z","maxDate":"2014-05-01T16:00:00.000Z","value":"2014-04-15T16:00:00.000Z","classes":["test","pickerClass"]}
   [INFO]  {"type":1,"id":"pickerTest","value":"2014-04-15T16:00:00.000Z","horizontalWrap":true,"minDate":"2012-01-01T00:00:00.000Z","columns":[],"maxDate":"2014-05-01T16:00:00.000Z"}
   [INFO]  {"backgroundColor":"blue","width":"90%","height":50,"bottom":0,"pippo":"tanto pippo test, 22343","classes":["test2","viewClass"]}
   </pre></code>
   
   The pickerClass class would generate JavaScript Date objects, which would be evaluated when the info/alert methods are run. The <code>JSON.stringify()</code> method returns <code>null</code> for objects with methods, which would include those Date objects. This is most likely the reason for the different output. 
   </li>
<li>Fokke Zandbergen 2014-09-23

   I think there *is* an issue with Date objects, which can be fixed by:
   
   <code><pre>
   ..
           if (_.isDate(copy)) {
             clone = new Date(copy.valueOf());
   
           // Recurse if we're merging plain objects or arrays
           } else if (deep && copy && ((_.isObject(copy) && typeof copy.apiName !== 'string') || (copy_is_array = _.isArray(copy)))) {
   ..
   </pre></code></li>
<li>Fokke Zandbergen 2014-09-23

   Which can be fixed by my comment above yours.</li>
<li>Tim Poulsen 2014-09-23

   PRs:
   
   1_5_X -- <a href="https://github.com/appcelerator/alloy/pull/572" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/572</a>
   master -- <a href="https://github.com/appcelerator/alloy/pull/573" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/573</a>
   
   Functional tests:
   
   * Run the attached app & follow steps to reproduce. The app should output the expected values
   * Run the ALOY\-1051 test app. Clicking the label should alert the properly merged style values
   * Run the advanced/complex_styling app and all font styles should be properly merged and displayed</li>
<li>Praveen Innamuri 2014-09-23

   Merged PRs.</li>
<li>Feon Sua Xin Miao 2014-09-24

   Merged PRs: 
   Master: <a href="https://github.com/appcelerator/alloy/pull/575" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/575</a> 
   1_5_X: <a href="https://github.com/appcelerator/alloy/pull/576" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/576</a></li>
<li>Visalakshi Chidambaram 2014-09-24

   When I run the attached project now with alloy 1.5.0 -rc4 taken from : git://github.com/appcelerator/alloy.git#1_5_X 
   I am able to see the following result:
   <code><pre>
   
   [INFO] :   {"font":{"fontFamily":"AmericanTypewriter","fontSize":50},"duration":1000,"classes":["family","size"]}
   [INFO] :   {"type":1,"minDate":"2012-01-01T00:00:00.000Z","maxDate":"2014-05-01T04:00:00.000Z","value":"2014-04-15T04:00:00.000Z","classes":["test","pickerClass"]}
   [INFO] :   {"type":1,"id":"pickerTest","value":"2014-04-15T04:00:00.000Z","horizontalWrap":true,"minDate":"2012-01-01T00:00:00.000Z","columns":[],"maxDate":"2014-05-01T04:00:00.000Z"}
   [INFO] :   {"backgroundColor":"blue","width":"90%","height":50,"bottom":0,"pippo":"tanto pippo test, 22343","classes":["test2","viewClass"]}
   
   </pre></code>
   
   Hence, able to see the expected results.</li>
<li>Federico Casali 2014-09-25

   Verified fixed. 
   
   TiSDK 3.4.0.v20140924140915  
   Appcelerator Studio 3.4.0.201409231834
   CLI 3.4.0-rc4
   Alloy 1.5.0-rc4
   Xcode6
   
   iPad mini & iPhone 5 (iOS 8) and Android Galaxy Nexus 4.3
   
   Closing.</li>
<li>Tim Poulsen 2014-09-26

    Added story points</li>
</ol>


<p><a href="/ALOY/ALOY-1146.json">JSON Source</a></p>