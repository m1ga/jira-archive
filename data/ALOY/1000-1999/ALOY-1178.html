---
title: "[ALOY-1178] Models: Data not retrieved from/saved to a table altered via migration using a SQL statement"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Alloy 1.6.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Tim Poulsen</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2014-10-22T18:42:31.000+0000</td></tr>
<tr><th>Updated</th><td>2015-06-08T17:39:22.000+0000</td></tr>
</table>

<h3>Description</h3>

Per <a href="http://developer.appcelerator.com/question/178611/data-is-not-saved-in-column-after-alter-table-through-alloy-migration" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/178611/data-is-not-saved-in-column-after-alter-table-through-alloy-migration</a> 

After applying a migration that alters a table structure, data saved to the new columns is not persisted to the SQLite database.

<code><pre>
// from the sample app, annotated
function doClick(e) {
	var m = Alloy.createModel('books');
	m.fetch({id: e.row.rowid}) // rowid is the alloy_id primary key
	Ti.API.info(JSON.stringify(m.toJSON()));
	//  {"title":"Changed","alloy_id":"d6bfe744-8e7a-9b24-c958-1e4275318276","pagecount":null}

	m.save({title: 'Changed', pagecount: 200});
	Ti.API.info(JSON.stringify(m.toJSON()));
	// {"title":"Changed","alloy_id":"d6bfe744-8e7a-9b24-c958-1e4275318276","pagecount":200}

	// but looking in the app's db, the pagecount column is still null

	Alloy.Collections.books.fetch();
}
</pre></code>

Sample / test app attached. Also, screenshot of app's database after migration has been applied and a few new models have been added (any labeled Changed were added after the migration and should have a pagecount)

This behavior is present with Alloy 1.6.0-dev, 1.5.1, 1.4.1, and 1.3.1.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1178_52114/app.zip">app.zip</td></td><td>2014-10-22T18:42:31.000+0000</td><td>7221</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1178_52115/Screen Shot 2014-10-22 at 2.41.05 PM.png">Screen Shot 2014-10-22 at 2.41.05 PM.png</td></td><td>2014-10-22T18:42:31.000+0000</td><td>281563</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen 2014-10-22

   On further investigation, this would never have worked with code as reported. The list of columns is built from the model definition. With a custom SQL command being used to alter the table, there's no way for the sync adapter to know of the existence of that new column.
   
   The way to deal with this is to use this technique for adding a new column to the table:
   
   First, create your migration file (e.g. with <code>alloy generate migration MODEL_NAME</code>)
   
   Then, add code like this to that file:
   
   <code><pre>
   migration.up = function(migrator) {
      db.createTable({
       "columns" : {
         "title" : "text",
         "pagecount": "integer" /* the new field */
       },
       "adapter": {
         "type": "sql",
         "collection_name": "books"
       }
     });
   };
   
   migration.down = function(db) {
   };
   </pre></code>
   
   Next, you must modify your original model file to also add that same new column. That's what the sync adapter is keyed off of to determine which fields data will be read from / written to.
   
   I'm re-casting this ticket as a feature request. Perhaps we could implement a function similar to createTable() (in the migration) that would alter the table to add the field; or, some means in the migration file to update the list of columns; or updated code in the model-generation script that would read the live db table's config.</li>
</ol>


<p><a href="/ALOY/ALOY-1178.json">JSON Source</a></p>