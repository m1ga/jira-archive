---
title: "[ALOY-1199] Deep merge config.json"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Alloy 1.11.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Runtime</td></tr>
<tr><th>Labels</th><td>compile, compiler</td></tr>
<tr><th>Reporter</th><td>me@gmail.com</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2014-08-13T02:07:22.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-17T22:14:36.000+0000</td></tr>
</table>

<h3>Description</h3>

Action:
A config.json file with the following contents is added to the project:
<code><pre>
{
    "global": {
        "theme":"default",
        "dir": {
            "template": "/"
        }
    },
    "env:development": {},
    "env:test": {},
    "env:production": {},
    "os:ios": {
        "theme":"ios"
    },
    "os:android": {
        "theme":"android"
    },
    "os:mobileweb":{
        "theme":"mobileweb"
    },
    "dependencies": {}
}
</pre></code>

Expected result:
Should result in alloy looking for templates in the root directory of the system. 

Actual result:
An error is thrown of "Arguments to path.join must be strings" in the alloy compile due to the rest of the dir paths not being set in the config.json file. allow uses _.defaults and this does a "shallow" style clone rather then deep.

lo-dash has a fix for this already (well... provided a workaround, the community has made modules from this workaround) ... sadly underscore has not yet fixed this as far as I can tell. Creating a workaround for underscore should not be difficult though

Example use case:
Wanting to override the alloy templates for a project, and so wanting to change the template directory for the project to a custom one

<h3>Comments</h3>

<ol>
<li>Mauro Parra-Miranda 2014-12-10

   Original Reporter: me@mattapperson.com</li>
<li>Fokke Zandbergen 2015-02-14

   Another use case is to have platform-specific widget-dependencies:
   
   <code><pre>
   {
     "global": {
       "dependencies": {
         "foo": "1.0"
       }
     },
     "os:ios": {
       "dependencies": {
         "bar": "1.0"
       }
     }
   }
   </pre></code>
   
   Right now the result is:
   
   <code><pre>
   module.exports = {
     "dependencies": {
       "bar": "1.0"
     }
   };
   </pre></code>
   
   Where with deep merge you'd get:
   
   <code><pre>
   module.exports = {
     "dependencies": {
       "foo": "1.0",
       "bar": "1.0"
     }
   };
   </pre></code></li>
<li>Fokke Zandbergen 2015-02-14

   A sub-task should be created to document the added support for platform/environment specific widget-dependencies.</li>
<li>Creative 2015-07-23

   Why is this actually being generated form a json file? It would be much more convenient to just use a config.js file with some exports for each of the platforms/deployment-types. Then we can also use variables and the likes.
   
   This, together with a deep-merge functionality will make this a much better setup!</li>
<li>Fokke Zandbergen 2015-08-13

   [~uzbbert] that's actually a good idea and also what we do for Arrow. Can you create a new JIRA ticket requesting this and link it to this one?</li>
<li>Creative 2016-11-17

   bump
   can this priority be increased?
   
   If we could change this file to a <code>config.js</code> I could actually use my own implementation, which is using Lodash's <code>_.merge()</code> or <code>_.extend()</code> which can deep merge the config files.
   
   Sadly underscore doesnt have deep merge at the moment</li>
<li>Creative 2017-10-09

   can this priority be increased? Also please consider TIMOB-24162 </li>
<li>Muhammad Qasim 2020-11-17

   In my case it is multiple themes. config.json files from different themes are not truly merged so you can't inherit common configs from global config.json so have to copy over full file per theme. I think its related to this ticket.</li>
<li>Creative 2020-11-17

   ---</li>
<li>Muhammad Qasim 2020-11-17

    There are no limitations if you could write native modules or use Hyperloop. Thanks for the suggestion though :)</li>
</ol>


<p><a href="/ALOY/ALOY-1199.json">JSON Source</a></p>