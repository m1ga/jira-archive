---
title: "[ALOY-1210] Alloy: Add support for DIST in the Project Configuration File"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-09-30T20:08:25.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Runtime</td></tr>
<tr><th>Labels</th><td>config.json</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2014-12-18T09:27:55.000+0000</td></tr>
<tr><th>Updated</th><td>2015-10-09T00:24:06.000+0000</td></tr>
</table>

<h3>Description</h3>

Recently, in Alloy 1.4.0 <code>DIST_ADHOC</code> and <code>DIST_STORE</code> were added the options for [conditional code in controllers](<a href="http://docs.appcelerator.com/titanium/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/latest/#</a>!/guide/Alloy_Controllers-section-34636384_AlloyControllers-ConditionalCode).

I'd like to also have support the same conditions in <code>config.json</code>.

The use case would be to have different endpoints, keys or other configuration variables for production ad-hoc builds and production store-builds.

Example:

<code><pre>
{
 "global": {"foo":1},
 "env:development": {"foo":2},
 "env:test":{"foo":3},
 "env:production":{"foo":4},
 "os:ios env:production": {"foo":5},
 "os:ios env:development": {"foo":6},
 "os:ios env:test": {"foo":7},
 "os:android":{"foo":8},
 "os:mobileweb":{"foo":9},
 "os:ios dist:adhoc": {"foo":10},
 "os:ios dist:store": {"foo":10},
 "dependencies": {
  "com.foo.widget":"1.0"
 }
} 
</pre></code>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen 2015-08-25

   We use different endpoints for AdHoc builds (Installr/TestFlight beta builds) vs our production releases. Currently, we have to manually copy & paste the contents of the config.json file to support such builds. This has resulted in mistakes. While we can use external tooling, like a grunt script, to manipulate the files, it would be best if Alloy itself supported something like:
   
   <code><pre>
   {
       "env:development": {"url":"<a href="https://dev.example.com" rel="nofollow" target="_blank">https://dev.example.com</a>"},
       "env:test":{"url":"<a href="https://test.example.com" rel="nofollow" target="_blank">https://test.example.com</a>"},
       "env:production":{"url":"<a href="https://production.example.com" rel="nofollow" target="_blank">https://production.example.com</a>"},
       "dist:adhoc":{"url":"<a href="https://adhoc.example.com" rel="nofollow" target="_blank">https://adhoc.example.com</a>"},
       "dist:store":{"url":"<a href="https://production.example.com" rel="nofollow" target="_blank">https://production.example.com</a>"},
   }
   </pre></code>
   
   Given that we need this support for both iOS and Android, the key can't be <code>env:adhoc</code> or something iOS-specific. In the above proposal, <code>dist:adhoc</code> and <code>dist:store</code> would need to override <code>env:production</code>. 
   
   And yes, I realize that natively Android doesn't have a notion of "adhoc" builds. But, I need a signed APK (with our company certificate) that points to our testing endpoints for Installr beta releases...that's exactly what I need for iOS (for Testflight/Installr builds). 
   </li>
<li>Feon Sua Xin Miao 2015-09-03

   <a href="https://github.com/appcelerator/alloy/pull/721" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/721</a>
   
   <code>config.json</code> now supports <code>dist:adhoc</code> & <code>dist:store</code> key. 
   <code><pre>
   {
       "env:development": {"url":"<a href="https://dev.example.com" rel="nofollow" target="_blank">https://dev.example.com</a>"},
       "env:test":{"url":"<a href="https://test.example.com" rel="nofollow" target="_blank">https://test.example.com</a>"},
       "env:production":{"url":"<a href="https://production.example.com" rel="nofollow" target="_blank">https://production.example.com</a>"},
       "dist:adhoc":{"url":"<a href="https://adhoc.example.com" rel="nofollow" target="_blank">https://adhoc.example.com</a>"},
       "dist:store":{"url":"<a href="https://production.example.com" rel="nofollow" target="_blank">https://production.example.com</a>"},
   }
   </pre></code></li>
<li>Feon Sua Xin Miao 2015-09-30

   PR merged.</li>
<li>Fokke Zandbergen 2015-10-01

   [~fmiao] Looking at <a href="https://github.com/appcelerator/alloy/blob/8d32fa1aa0629473ec0eb7ea5c0ca0be32da58da/Alloy/commands/compile/compilerUtils.js#L867-L868" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/8d32fa1aa0629473ec0eb7ea5c0ca0be32da58da/Alloy/commands/compile/compilerUtils.js#L867-L868</a> it will only work for <code>os:ios dist:adhoc</code> and not <code>dist:adhoc os:ios</code>. And <code>env</code> is not involved at all. We might have to refactor <code>parseConfig()</code> this way:
   
   * Loop through the <code>config.json</code> keys
   * Split on space
   * When all <code>&lt;type&gt;:&lt;value&gt;</code> conditions are true, extend the config object with it
   
   This means that the order of the keys in <code>config.json</code> determine what overwrites what instead of our code. This makes perfect sense I think, although we might want to force <code>global</code> to always come first.
   
   Let me know if you need new ticket or can change this PR still.</li>
</ol>


<p><a href="/ALOY/ALOY-1210.json">JSON Source</a></p>