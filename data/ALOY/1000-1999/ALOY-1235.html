---
title: "[ALOY-1235] Alloy: Improve how config.json conditions are handled"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Tooling</td></tr>
<tr><th>Labels</th><td>Alloy.CFG, config.json, theme</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Tim Poulsen</td></tr>
<tr><th>Created</th><td>2015-02-01T14:30:29.000+0000</td></tr>
<tr><th>Updated</th><td>2015-02-09T16:45:30.000+0000</td></tr>
</table>

<h3>Description</h3>

Currently, Alloy does a (shallow) merge of the different sections of the app's <code>config.json</code> and an optional theme <code>config.json</code> in the following [hard-coded](<a href="https://github.com/appcelerator/alloy/blob/master/Alloy/commands/compile/compilerUtils.js#L765-L846)" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/Alloy/commands/compile/compilerUtils.js#L765-L846)</a> order:

* global
* env:*
* os:*
* env:* os:*
* os:* env:*

I'd suggest the following change:

Loop the <code>config.json</code> sections in the order in which they appear in the file and merge them when the conditions are met, just like we do with conditions in TSS and JS.

Example:

<code><pre>
{
  "global": {
    "foo": 1
  },
  "env:test os:ios": {
    "foo": 2
  }
}
</pre></code>

Would be handles as if you'd do this in a JS file:

<code><pre>
var cfg = 
if (true) {
  _.extend(cfg, { foo: 1 });
}
if (ENV_TEST && OS_IOS) {
  _.extend(cfg, { foo: 2 });
}
</pre></code>

Use case:

This is more transparent to the developer to see what the value will be if multiple sections are valid for the target environment and platform. It will also make it easier (less code) to introduce a new condition, as requested in ALOY-1210.

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2015-02-01

   Sorry, I guess this tickets needs to be moved to TC.</li>
<li>Mauro Parra-Miranda 2015-02-02

   Original Reporter: Fokke Zandbergen</li>
<li>Tim Poulsen 2015-02-09

   This is a duplicate of ALOY-1199</li>
<li>Fokke Zandbergen 2015-02-09

   [~skypanther] please not that this ticket is only duplicate to ALOY-1199 in part. Only the second of the 2 suggested changes is. The first one I'd still like to see implemented as well.
   
   What's the correct procedure? Can I just reopen and change the ticket to only be about the first item? Or should you?</li>
<li>Tim Poulsen 2015-02-09

   Yes, please feel free to reopen tickets that you think were resolved incorrectly. Let me know if you don't have permissions to do so. Sorry I missed that only part of this was covered by ALOY-1199.</li>
<li>Fokke Zandbergen 2015-02-09

   Reopening because only part of the ticket duplicates by ALOY-1199.
   
   I'll edit and take out the duplicate part.</li>
</ol>


<p><a href="/ALOY/ALOY-1235.json">JSON Source</a></p>