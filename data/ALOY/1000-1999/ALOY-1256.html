---
title: "[ALOY-1256] Widget/Require as top-level element uses controller as view"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-08-12T13:10:59.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.5.1, Alloy 1.7.0</td></tr>
<tr><th>Fix Version/s</th><td>CLI Release 8.1.0</td></tr>
<tr><th>Components</th><td>XML</td></tr>
<tr><th>Labels</th><td>griffin-app, merge-to-next, require, view, widgets, xml</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Brenton House</td></tr>
<tr><th>Created</th><td>2015-03-04T12:50:59.000+0000</td></tr>
<tr><th>Updated</th><td>2021-06-16T14:13:54.000+0000</td></tr>
</table>

<h3>Description</h3>

When a controller-view has a widget or require as a root element, the compiled code will use the required controller as the view, as seen in the following example:

*index.xml*
<code><pre>
<Alloy>
  <Widget src="foo" />
</Alloy>
</pre></code>

*widget.xml*
<code><pre>
<Alloy>
  <Window>
    <Label>I'm the default widget</Label>
  </Window>
</Alloy>
</pre></code>

*index.js (compiled)*
<code><pre>
//..
    $.__views.index = Alloy.createWidget("foo", "widget", {
        id: "index"
    });
    $.__views.index && $.addTopLevelView($.__views.index);
//..
</pre></code>

*console*
<code><pre>
[ERROR] TypeError: undefined is not a function (evaluating '$.index.open()')
[ERROR] File: app.js
[ERROR] Line: 33
[ERROR] SourceId: <null>
[ERROR] Backtrace:
[ERROR]  undefined
</pre></code>

*index.js (expected)*
<code><pre>
//..
    $.__views.index = Alloy.createWidget("foo", "widget", {
        id: "index"
    });
    $.__views.index && $.addTopLevelView($.__views.index.getView());
    // OR: $.__views.index && $.addTopLevelView($.__views.index.getViewEx({recurse:true}));
//..
</pre></code>

Found via this GitHub ticket, which includes a link to a full example:
<a href="https://github.com/FokkeZB/nl.fokkezb.pullToRefresh/issues/39" rel="nofollow" target="_blank">https://github.com/FokkeZB/nl.fokkezb.pullToRefresh/issues/39</a>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2015-03-04

   It might seem like it doesn't make sense to have a widget/require as top-level element, but as <a href="https://github.com/miko91/test-widget/blob/master/app/views/news.xml" rel="nofollow" target="_blank">https://github.com/miko91/test-widget/blob/master/app/views/news.xml</a> shows with the recent support for children tags it can be very useful.</li>
<li>Nuno Costa 2015-05-08

   There is a temporary fix for this situation? I have the same issue.
   
   <code><pre>
   <View class="container">
   <Widget id="ptr" src="nl.fokkezb.pullToRefresh" onRelease="myRefresher">
   <ListView id="listView" backgroundColor="white" defaultItemTemplate="template" module="CollectionView" method="createCollectionView">
   .....
   </Widget>
   </View>
   
   still fails with the view.`
   </pre></code>
   
   P.S Just on Android</li>
<li>Nuno Costa 2015-05-10

   You can ignore my report above, please see what happened.
   
    [<a href="https://github.com/FokkeZB/nl.fokkezb.pullToRefresh/issues/39" rel="nofollow" target="_blank">https://github.com/FokkeZB/nl.fokkezb.pullToRefresh/issues/39</a>]</li>
<li>Brenton House 2019-12-18

   Transferring work from ALOY-1713 as it was a duplicate</li>
<li>Brenton House 2019-12-18

   Created PR: <a href="https://github.com/appcelerator/alloy/pull/949" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/949</a></li>
<li>Ewan Harris 2020-02-10

   Test project <a href="https://github.com/brentonhouse/alloy-widget-test" rel="nofollow" target="_blank">https://github.com/brentonhouse/alloy-widget-test</a></li>
<li>Ewan Harris 2020-07-20

   Test steps:
   
   Check out the test project at <a href="https://github.com/brentonhouse/alloy-widget-test" rel="nofollow" target="_blank">https://github.com/brentonhouse/alloy-widget-test</a></li>
<li>Samir Mohammed 2020-08-12

   Closing ticket, fix verified in CLI version <code>8.1.0-master.10</code>, tested using the test case above. </li>
<li>Muhammad Qasim 2021-05-18

   What if someone need to refer the widget controller itself to call certain controller methods? Previously with this code
   
   <code><pre>
   <Widget id="drawer" src="my.widget" />
   </pre></code>
   
   $.drawer would refer to the Widget controller object but now it only refer to the top level view from the widget. No way to access controller object from xml except creating the widget in js code.</li>
</ol>


<p><a href="/ALOY/ALOY-1256.json">JSON Source</a></p>