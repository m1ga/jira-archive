---
title: "[ALOY-1265] Update builtin moment.js library to 2.10.6 (or latest)"
---
<table>
<tr><th>Type</th><td>Sub-task</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-12-17T18:43:03.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>alloy 1.7.29</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.0, alloy 1.7.30</td></tr>
<tr><th>Components</th><td>Builtins</td></tr>
<tr><th>Labels</th><td>Alloy, moment.js</td></tr>
<tr><th>Reporter</th><td>Shannon Hicks</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2015-05-12T19:28:41.000+0000</td></tr>
<tr><th>Updated</th><td>2016-02-02T23:08:45.000+0000</td></tr>
</table>

<h3>Description</h3>

Moment.js has changed how it handles time zones/UTC. Took me forever to figure out why my calls to <code>moment().utcOffset();</code> didn't work.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-1265_57801/Simulator Screen Shot 17 Dec 2015 10.03.24.png">Simulator Screen Shot 17 Dec 2015 10.03.24.png</td></td><td>2015-12-17T09:09:31.000+0000</td><td>125059</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2015-05-13

   Since the new versions of Moment use <code>require()</code> in *all* of the [locale files](<a href="https://github.com/moment/moment/blob/develop/locale/af.js#L6)" rel="nofollow" target="_blank">https://github.com/moment/moment/blob/develop/locale/af.js#L6)</a> it might be worth considering using the [version that has all the locales included](<a href="http://momentjs.com/downloads/moment-with-locales.js)" rel="nofollow" target="_blank">http://momentjs.com/downloads/moment-with-locales.js)</a> so we don't need to patch it at all.</li>
<li>Fokke Zandbergen 2015-05-13

   PR on master: <a href="https://github.com/appcelerator/alloy/pull/687" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/687</a></li>
<li>Feon Sua Xin Miao 2015-05-20

   The version also has a bigger file size than the one without locales included.
   moment + locales  : 361kb
   moment : 85kb</li>
<li>Feon Sua Xin Miao 2015-12-17

   PR: <a href="https://github.com/appcelerator/alloy/pull/747" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/747</a></li>
<li>Fokke Zandbergen 2015-12-17

   Verified with:
   
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Window backgroundColor="white"&gt;
   		&lt;ScrollView top="20" id="container" layout="vertical" contentWidth="Ti.UI.FILL" contentHeight="Ti.UI.SIZE" /&gt;
   	&lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   var moment = require('alloy/moment');
   var day = moment("2016-01-01");
   
   addText("require('alloy/moment')\nday = moment()\nmoment.locale(): " + moment.locale() + '\nday.locale(): ' + day.locale() + '\n' + day.format("LLL"));
   
   require('alloy/moment/lang/en-gb');
   require('alloy/moment/lang/de');
   require('alloy/moment/lang/de-at');
   var day2 = moment();
   
   addText("require('alloy/moment/lang/en-gb,de,de-at')\nday2 = moment()\nmoment.locale(): " + moment.locale() + '\nday.locale(): ' + day.locale() + '\n' + day.format("LLL") + '\nday2.locale(): ' + day2.locale() + '\n' + day2.format("LLL"));
   
   moment.locale(Ti.Locale.currentLocale);
   var day3 = moment();
   
   addText("moment.locale(Ti.Locale.currentLocale = " + Ti.Locale.currentLocale + ")\nday3 = moment()\nmoment.locale(): " + moment.locale() + '\nday.locale(): ' + day.locale() + '\n' + day.format("LLL") + '\nday3.locale(): ' + day3.locale() + '\n' + day3.format("LLL"));
   
   ['en-gb', 'de', 'de-at', 'foo'].forEach(function(locale) {
     day.locale(locale);
     addText("day.locale('" + locale + "')\nmoment.locale(): " + moment.locale() + '\nday.locale(): ' + day.locale() + '\n' + day.format("LLL"));
   });
   
   $.index.open();
   
   function addText(text) {
     $.container.add(Ti.UI.createLabel({
       top: 10,
       textAlign: Ti.UI.TEXT_ALIGNMENT_CENTER,
       text: text
     }));
   }
   </pre></code>
   
   !Simulator Screen Shot 17 Dec 2015 10.03.24.png|thumbnail!</li>
<li>Fokke Zandbergen 2015-12-17

   A few notes on the PR:
   
   * We should leave the default locale to <code>en</code> as that is the only built-in locale moments has. So <a href="https://github.com/feons/alloy/blob/ALOY-1265-update/Alloy/builtins/moment.js#L2799" rel="nofollow" target="_blank">https://github.com/feons/alloy/blob/ALOY-1265-update/Alloy/builtins/moment.js#L2799</a> has to remain like <a href="https://github.com/moment/moment/blob/develop/moment.js#L2799" rel="nofollow" target="_blank">https://github.com/moment/moment/blob/develop/moment.js#L2799</a>
   * I actually wonder if the change to <code>loadLocale</code> (<a href="https://github.com/feons/alloy/blob/ALOY-1265-update/Alloy/builtins/moment.js#L269)" rel="nofollow" target="_blank">https://github.com/feons/alloy/blob/ALOY-1265-update/Alloy/builtins/moment.js#L269)</a> makes sense. Since we require users to require any languages they want to support trying to load any other language will never succeed. So we might as well make <code>loadLocale</code> a NOOP or leave it as is will (which has same effect).
   
   We also need to update <a href="https://appcelerator.github.io/appc-docs/platform/latest/#" rel="nofollow" target="_blank">https://appcelerator.github.io/appc-docs/platform/latest/#</a>!/api/Alloy.builtins.moment to say:
   
   * That <code>lang()</code> is now deprecated and should be <code>locale()</code>
   * That any languages you want to support at run-time need to be required, hard-coded (no vars) so that Alloy includes them (must be very clear)
   * That the last required language will become the global locale.
   * That changes to the global locale will not effect already created instances.
   * That you can change the locale of a instance without affecting the global locale.</li>
<li>Feon Sua Xin Miao 2015-12-17

   1. leave default to locale to <code>en</code>, totally agree
   2. the change to <code>loadLocale</code> is needed, because users only have to explicitly do require when the language is not specified in the project's "i18n" folder.</li>
<li>Fokke Zandbergen 2015-12-17

   OK, with that change I approve ;)</li>
<li>Fokke Zandbergen 2015-12-17

   O wait, you probably want to include the API reference change in the PR as well?</li>
<li>Feon Sua Xin Miao 2015-12-17

    Thank you for your approval! :D
    Yes, will do.</li>
<li>Eric Wieber 2016-02-02

    Verified fixed, using:
    
    MacOS 10.11.3 (15D21)
    Studio 4.5.0.201601262138
    Ti SDK 5.2.0.v20160202103508
    Appc NPM 4.2.3-1
    Appc CLI 5.2.0-239
    Alloy 1.7.33
    Xcode 7.2 (7C68)
    
    moment.js library is now using version 2.10.6 and time zones are working as expected. Tested with the provided samples above and simple calls to moment().utcOffset() in a modified sample Alloy app.</li>
</ol>


<p><a href="/ALOY/ALOY-1265.json">JSON Source</a></p>