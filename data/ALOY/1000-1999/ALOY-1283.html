---
title: "[ALOY-1283] ActionView views with an ID cannot be found under $ because they are created after merge"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-10-16T00:38:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.6.2, alloy 1.7.17</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.1.0, alloy 1.7.18</td></tr>
<tr><th>Components</th><td>XML</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2015-06-25T10:16:10.000+0000</td></tr>
<tr><th>Updated</th><td>2015-11-10T23:35:36.000+0000</td></tr>
</table>

<h3>Description</h3>

ALOY-1175 fixed this issue for IDs set on <code>&lt;MenuItem&gt;</code> but it is still an issue for views under <code>&lt;ActionView&gt;</code>. Because they are created after the controller merges <code>$.__views</code> with <code>$</code> you cannot access the views via <code>$.&lt;id&gt;</code>.

*index.xml*

<code><pre>
&lt;Alloy&gt;
    &lt;Window&gt;
        &lt;Menu&gt;
            &lt;MenuItem title="Open" showAsAction="Titanium.Android.SHOW_AS_ACTION_ALWAYS"&gt;
                &lt;ActionView&gt;
                    &lt;View id="myViewInActionView" backgroundColor="red"&gt;
                    	&lt;Button onClick="changeColor"&gt;Change Color&lt;/Button&gt;
                    &lt;/View&gt;
                &lt;/ActionView&gt;
            &lt;/MenuItem&gt;
        &lt;/Menu&gt;            
    &lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

*index.js*

<code><pre>
$.index.open();
 
function changeColor() {
  $.myViewInActionView.backgroundColor = 'green';
}
</pre></code>

<h3>Comments</h3>

<ol>
<li>Feon Sua Xin Miao 2015-10-15

   PR: <a href="https://github.com/appcelerator/alloy/pull/732" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/732</a></li>
<li>Fokke Zandbergen 2015-10-15

   [~fmiao] I updated the test case to make it simpler but the PR doesn't fix it. The above - with your PR - compiles to:
   
   <code><pre>
       function __alloyId4() {
           $.__views.index.removeEventListener("open", __alloyId4);
           if ($.__views.index.activity) $.__views.index.activity.onCreateOptionsMenu = function(e) {
               $.__views.myViewInActionView = Ti.UI.createView({
                   id: "myViewInActionView",
                   backgroundColor: "red"
               });
               $.__views.__alloyId2 = Ti.UI.createButton({
                   title: "Change Color",
                   id: "__alloyId2"
               });
               $.__views.myViewInActionView.add($.__views.__alloyId2);
               changeColor ? $.addListener($.__views.__alloyId2, "click", changeColor) : __defers["$.__views.__alloyId2!click!changeColor"] = true;
               var __alloyId3 = {
                   title: "Open",
                   showAsAction: Titanium.Android.SHOW_AS_ACTION_ALWAYS,
                   id: "__alloyId1"
               };
               $.__views.myViewInActionView && (__alloyId3.actionView = $.__views.myViewInActionView);
               $.__views.__alloyId1 = e.menu.add(_.pick(__alloyId3, Alloy.Android.menuItemCreateArgs));
               $.__views.__alloyId1.applyProperties(_.omit(__alloyId3, Alloy.Android.menuItemCreateArgs));
               $.__alloyId1 = $.__views.__alloyId1;
           }; else {
               Ti.API.warn("You attempted to attach an Android Menu to a lightweight Window");
               Ti.API.warn("or other UI component which does not have an Android activity.");
               Ti.API.warn("Android Menus can only be opened on TabGroups and heavyweight Windows.");
           }
       }
   </pre></code>
   
   And since <code>onCreateOptionsMenu</code> executes _after_ <code>_.extend($, $.__views);</code> the above has no effect anymore on <code>$</code>.
   
   So whatever happens inside <code>onCreateOptionsMenu</code> needs to write directly to <code>$</code> or merge its views with it at the end.</li>
<li>Feon Sua Xin Miao 2015-10-15

   It's interesting that the generated code is different for me.
   <code><pre>
               $.__views.myViewInActionView.add($.__views.__alloyId3);
               changeColor ? $.addListener($.__views.__alloyId3, "click", changeColor) : __defers["$.__views.__alloyId3!click!changeColor"] = true;
               $.myViewInActionView = $.__views.myViewInActionView; // &lt;---- missing
               var __alloyId4 = {
                   title: "Open",
                   showAsAction: Titanium.Android.SHOW_AS_ACTION_ALWAYS,
                   id: "__alloyId1"
               };
   </pre></code></li>
<li>Fokke Zandbergen 2015-10-15

   Sorry [~fmiao], my fault.. patched the wrong (global) alloy. Verified fixed.</li>
<li>Feon Sua Xin Miao 2015-10-16

   PR merged.</li>
<li>Eric Wieber 2015-11-10

   Verified fixed, using:
   
   MacOS 10.11.2 (15C31f)
   Studio 4.4.0.201511040454
   Ti SDK 5.1.0.v20151110110428
   Appc NPM 4.2.1
   Appc CLI 5.1.0-45
   Ti CLI 5.0.5
   Alloy 1.7.24
   Arrow 1.3.19
   Xcode 7.2 (7C46t)
   Node v0.12.7
   Java 1.7.0_80
   production
   
   ActionViews can be accessed with $.<id>, as expected. Used the provided test code. ActionView properties/methods can be accessed during runtime with the standard $.<id>.</li>
</ol>


<p><a href="/ALOY/ALOY-1283.json">JSON Source</a></p>