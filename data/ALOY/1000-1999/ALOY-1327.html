---
title: "[ALOY-1327] Android: Alloy not working well when activity recreated by system"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 5.2.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shawn Lan</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2015-08-20T23:56:47.000+0000</td></tr>
<tr><th>Updated</th><td>2019-04-04T01:13:43.000+0000</td></tr>
</table>

<h3>Description</h3>

Refer to "don't keep activities option" [here](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Android.Activity)

So I test it with my app written in Alloy. Several issues. For example, action bar menu items are gone if the menu is defined only in Alloy markup. With Titanium Class, it seems fine.

Usually people won't turn on "Don't keep activities," but it's available under developer's options for us to simulate the scenario when the system destroys (due to low memory) and recreates our activities.

I believe the problem is with Alloy. I just list one example issue. Please investigate.

Test cases:

Classic
<code><pre>
var win = Ti.UI.createWindow({
  fullscreen: true
});

var activity = win.activity;

activity.onCreateOptionsMenu = function(e){
  var menu = e.menu;
  var menuItem = menu.add({
    title: "Item 1",
    icon:  "item1.png",
    showAsAction: Ti.Android.SHOW_AS_ACTION_IF_ROOM
  });
  menuItem.addEventListener("click", function(e) {
    Ti.API.debug("I was clicked");
  });
};

win.open();
</pre></code>

Alloy
index.js
<code><pre>
function doClick(e) {
    Ti.API.info("Menu item clicked: " + e.source.title);
}

// Ensure menu is displayed
function doOpen(e) {
    $.win.invalidateOptionsMenu();
}
</pre></code>

index.xml
<code><pre>
&lt;Alloy&gt;
    &lt;!-- Create a heavyweight window to use the Android menu. --&gt;
    &lt;Window id="win" fullscreen="true" onOpen="doOpen"&gt;

        &lt;!-- The Menu tag adds the Android menu. --&gt;
        &lt;Menu id="menu" platform="android"&gt;

            &lt;!-- Cannot specify node text.  Use attributes only. --&gt;
            &lt;MenuItem id="menuItem" title="Item 1" icon="item1.png" onClick="doClick" showAsAction="Ti.Android.SHOW_AS_ACTION_IF_ROOM" /&gt;
        &lt;/Menu&gt;

        &lt;!-- Place additional views here --&gt;
    &lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1327_57907/Screen Shot 2016-01-07 at 6.21.33 PM.png">Screen Shot 2016-01-07 at 6.21.33 PM.png</td></td><td>2016-01-08T02:30:46.000+0000</td><td>78010</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/ALOY/ALOY-1327_57906/Screen Shot 2016-01-07 at 6.22.21 PM.png">Screen Shot 2016-01-07 at 6.22.21 PM.png</td></td><td>2016-01-08T02:30:46.000+0000</td><td>62029</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Shawn Lan 2015-10-02

   Like I said, there are several issues, but the root cause is the same. Use the menu sample as a start. See my updated description. Thanks.
   
   </li>
<li>Feon Sua Xin Miao 2015-11-12

   I'm not able to reproduce the reported issue.
   Also, the test app <code>index.js</code> should be updated as follows:
   <code><pre>
   $.win.invalidateOptionsMenu(); // should be --&gt; $.win.activity.invalidateOptionsMenu();
   </pre></code>
    </li>
<li>Shawn Lan 2016-01-08

   Can you please share with me how to test it? The issue is there, at least from my test. Thanks.</li>
<li>Feon Sua Xin Miao 2016-01-08

   Reopen to upload screenshots</li>
<li>Feon Sua Xin Miao 2016-01-08

   [~shawnlan], attached are what I get running the alloy test app you provided. 
   Please let me know if I have overlooked anything.</li>
<li>Shawn Lan 2016-01-08

   To test "Do Not Keep Activities:" after launching the app, press "Home" (not Back) to put the app into background. Then bring the app to the foreground from launcher. See if this time the menu item is gone.
   
   Make sure you are using the Alloy example, not the Classic example. Thanks!</li>
<li>Feon Sua Xin Miao 2016-01-08

   [~shawnlan], thanks for the clarification, I'll look into!</li>
</ol>


<p><a href="/ALOY/ALOY-1327.json">JSON Source</a></p>