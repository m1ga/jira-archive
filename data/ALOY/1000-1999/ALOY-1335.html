---
title: "[ALOY-1335] Use Alloy's deepExtend to handle conditional on-device style inheritance"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-11-30T20:50:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>alloy 1.7.28</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.0, alloy 1.7.29</td></tr>
<tr><th>Components</th><td>Styling</td></tr>
<tr><th>Labels</th><td>Alloy, inheritance, styles</td></tr>
<tr><th>Reporter</th><td>Xavier Lacot</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2015-11-27T10:41:20.000+0000</td></tr>
<tr><th>Updated</th><td>2016-01-20T23:18:33.000+0000</td></tr>
</table>

<h3>Description</h3>

Alloy selectors provide ways to overload style rules based on switches (formFactor, OS, conditional rules, etc.). Say the TSS is somehow:

<code><pre>
...
".title-home": {
	bottom: 4,
},
".title-home[formFactor=tablet]": {
	bottom: 8
},
...
</pre></code>

The generated code will look like:

<code><pre>
Alloy.deepExtend(true, o, {
    bottom: 4
});
Alloy.isTablet && _.extend(o, {
    bottom: 8
});
</pre></code>

If this works fine with most of the properties, this is particularly annoying with font or nested properties. For instance, 

<code><pre>
".title-home": {
	font: {
		fontFamily: "Delius-Regular",
		fontSize: 11
	}
},
".title-home[formFactor=tablet]": {
	font: {
		fontSize: 22
	}
},
</pre></code>

will result in the font name being simply ignored on tablets, as <code>_.extend()</code> is not a deepExtend method. We're lucky, Alloy provides a <code>deepExtend()</code> implementation which we may want to use. I therefore propose to switch from <code>_.extend()</code> to Alloy's <code>deepExtend</code> implementation. This will allow much more efficient ways of integrating complex graphical interfaces, with style inheritances all across the app:

<code><pre>
&lt;Label class="fonticon icon-row-right icon-arrow-md icon-arrow-right white" /&gt;
</pre></code>

All styles are merged deeply, and it becomes unnecessary to repeat over and over the font name.

I _know_ that this change may break many tests, but I strongly believe that this behavior is the right way styles _should_ work, in the sake for development efficiency.

<h3>Comments</h3>

<ol>
<li>Xavier Lacot 2015-11-27

   A pull request has been proposed in <a href="https://github.com/appcelerator/alloy/pull/744" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/744</a></li>
<li>Fokke Zandbergen 2015-11-28

   Thank you [~xavier]! Didn't even know we were not deep merging this as do deep merge normal classes? Wonderful!</li>
<li>Feon Sua Xin Miao 2015-11-30

   PR merged.
   
   To test:
   1. Create an project
   2. Add a label in index.xml, i.e <code>&lt;Label class="title-home"&gt;Hello, World&lt;/Label&gt;</code>
   3. Add the following style to index.tss
   <code><pre>
   ".title-home": {
   	font: {
   		fontFamily: "Delius-Regular",
   		fontSize: 11
   	}
   }
   
   ".title-home[formFactor=handheld]": {
   	font: {
   		fontSize: 22,
   		fontWeight: 'bold'
   	}
   }
   </pre></code>
   4. Build the project for handheld devices, the label text should be in bold.</li>
<li>Eric Wieber 2016-01-20

   Verified fixed, using:
   
   MacOS 10.11.3 (15D21)
   Studio 4.4.0.201511241829
   Ti SDK 5.2.0.v20160114021251
   Appc NPM 4.2.3-1
   Appc CLI 5.2.0-232
   Alloy 1.7.33 
   Xcode 7.2 (7C68)
   Node v0.12.7
   Java 1.7.0_80
   
   Now using Alloy's deepExtend() over .extend() and can now see the generated code is conditioned properly. Used the provided steps and code to verify that the fonts are being bolded.</li>
</ol>


<p><a href="/ALOY/ALOY-1335.json">JSON Source</a></p>