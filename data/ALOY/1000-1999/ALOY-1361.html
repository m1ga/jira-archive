---
title: "[ALOY-1361] Destroy calling off on variables that may be undefined"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-03-24T00:41:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>alloy 1.8.0</td></tr>
<tr><th>Components</th><td>XML</td></tr>
<tr><th>Labels</th><td>alloy, databinding, destroy</td></tr>
<tr><th>Reporter</th><td>Brenton House</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2016-02-25T14:50:54.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-06T18:50:03.000+0000</td></tr>
</table>

<h3>Description</h3>

If you have an Alloy component that uses databinding and has conditional code defined in the xml, the destroy function is not taking into consideration the fact that the component may be undefined before calling the <code>off</code> function.

Alloy xml: 

<code><pre>
	           &lt;TableViewRow id="trainer_row" layout="composite" class="listitem_row" hasChild="true" onClick="$.togglePicker" if="$.args.editmode"&gt;
                        &lt;View height="50" top="0" layout="composite" touchEnabled="false"&gt;
                            &lt;Label text="Trainer" class="listitem_settings_name" touchEnabled="false" /&gt;
                            &lt;Label text="{mymodel.trainer_name}" class="listitem_settings_value_haschild" touchEnabled="false" /&gt;
                        &lt;/View&gt;
                        &lt;Picker id="trainer" width="350" height="150" visible="false" onChange="$.onChange" top="40"&gt;
                            &lt;Column dataCollection="trainer"&gt;
                                &lt;Row title="{name}" value="{id}" /&gt;
                            &lt;/Column&gt;
                        &lt;/Picker&gt;
                    &lt;/TableViewRow&gt;
</pre></code>

Generated code: 

<code><pre>
  if ($.args.editmode) {

       // ------ only showing relevant code  ------

         var __alloyId287 = Alloy.Collections["trainer"] || trainer;
        __alloyId287.on("fetch destroy change add remove reset", __alloyId288);


    }

    exports.destroy = function() {
        __alloyId281.off("fetch destroy change add remove reset", __alloyId282);
        __alloyId293.off("fetch destroy change add remove reset", __alloyId294);
        __alloyId314.off("fetch destroy change add remove reset", __alloyId315);
        __alloyId330.off("fetch destroy change add remove reset", __alloyId331);
	Alloy.Models.mymodel.off("fetch change destroy", __alloyId346);
    };

</pre></code>

In this case, <code>__alloyId281</code> is actually undefined because it was declared and a value assigned inside the conditional if block.  

This is a pretty serious issue as I believe the error that occurs is stopping the other (existing) <code>off</code> functions from being called and causing a memory leak.
  

<h3>Comments</h3>

<ol>
<li>Brenton House 2016-02-25

   Added PR:  <a href="https://github.com/appcelerator/alloy/pull/762" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/762</a>
   </li>
<li>Sharif AbuDarda 2016-02-25

   This is a valid PR. Thanks for letting us know. Our engineer will look into it. </li>
<li>Feon Sua Xin Miao 2016-03-24

   PR merged.</li>
</ol>


<p><a href="/ALOY/ALOY-1361.json">JSON Source</a></p>