---
title: "[ALOY-1369] Complex data binding for collection doesn't work with transform"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-03-21T19:21:46.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>alloy 1.7.35</td></tr>
<tr><th>Fix Version/s</th><td>alloy 1.8.1, Release 5.2.2</td></tr>
<tr><th>Components</th><td>Models, XML</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Fokke Zandbergen</td></tr>
<tr><th>Created</th><td>2016-03-16T12:55:32.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-31T22:39:53.000+0000</td></tr>
</table>

<h3>Description</h3>

The complex data binding introduced by ALOY-443 does not work if the model has a <code>__transform</code> property:

<code><pre>
&lt;Alloy&gt;
	&lt;Collection src="user" /&gt;
	&lt;Window&gt;
		&lt;TableView dataCollection="user"&gt;
			&lt;TableViewRow foo="{a}" bar="the {a}" title="{a} {b}" /&gt;
		&lt;/TableView&gt;
	&lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

Compiles to:

<code><pre>
    __alloyId3.__transform = {};
    var __alloyId5 = Ti.UI.createTableViewRow({
      foo: typeof __alloyId3.__transform['a'] !== 'undefined' ? __alloyId3.__transform['a'] : __alloyId3.get('a'),
      bar: typeof __alloyId3.__transform['a'] !== 'undefined' ? __alloyId3.__transform['a'] : the '+__alloyId3.get('
      a ') +',
      title: typeof __alloyId3.__transform['a'] !== 'undefined' ? __alloyId3.__transform['a'] : __alloyId3.get('a') + ' ' + __alloyId3.get('b'),
    });
</pre></code>

Which will cause Uglify to crash on the syntax error on line 3.

For the other 2 cases the values will always that of <code>a</code> if the model has a <code>__transform</code> property.

The correct code should be:

<code><pre>
    __alloyId3.__transform = _.isFunction(__alloyId3.transform) ? __alloyId3.transform() : __alloyId3.toJSON();
    var __alloyId5 = Ti.UI.createTableViewRow({
      foo: _.template("&lt;%=a%&gt;", __alloyId3.__transform),
      bar: _.template("&lt;%=the a%&gt;", __alloyId3.__transform),
      title: _.template("&lt;%=a b%&gt;", __alloyId3.__transform)
    });
</pre></code>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2016-03-16

   PR: <a href="https://github.com/appcelerator/alloy/pull/769" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/769</a></li>
<li>Eric Wieber 2016-03-31

   Verified fixed, using:
   
   MacOS 10.11.4 (15E65)
   Studio 4.5.0.201602170821
   Ti SDK 5.2.2.v20160328141205
   Appc NPM 4.2.5-1
   Appc CLI 5.2.2-3
   Alloy 1.8.5
   Xcode 7.3 (7D175)
   
   Complex data binding for collections using transform are working as expected. Tested using the project in ALOY-1474 as well as custom apps using collections with transform functions. Code generated matches the form of the correct code in ticket description.</li>
</ol>


<p><a href="/ALOY/ALOY-1369.json">JSON Source</a></p>