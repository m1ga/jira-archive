---
title: "[ALOY-1476] Travis does not test against known good generated code because it targets Linux only"
---
<table>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-03-28T16:25:35.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>alloy 1.8.2</td></tr>
<tr><th>Fix Version/s</th><td>alloy 1.8.3, Release 5.2.2</td></tr>
<tr><th>Components</th><td>Testing</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Fokke Zandbergen</td></tr>
<tr><th>Created</th><td>2016-03-28T11:42:10.000+0000</td></tr>
<tr><th>Updated</th><td>2016-04-05T23:12:49.000+0000</td></tr>
</table>

<h3>Description</h3>

While working on ALOY-1474 and local tests I ran into 355 failures to match against known good generated code, while Travis didn't fail at all.

After submitting <a href="https://github.com/appcelerator/alloy/pull/775" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/775</a> I noticed Travis logs don't mention the tests against the known good generated code at all:

<code><pre>
[PASS] alloy compile advanced/device_query --&gt; preparing test app
[PASS] alloy compile advanced/device_query [android] --&gt; compiles without critical error
[PASS] alloy compile advanced/device_query [android] --&gt; leaves no compiler directives in generated code
[PASS] alloy compile advanced/device_query [android] --&gt; has no undefined style entries
[PASS] alloy compile advanced/device_query [ios] --&gt; compiles without critical error
[PASS] alloy compile advanced/device_query [ios] --&gt; leaves no compiler directives in generated code
[PASS] alloy compile advanced/device_query [ios] --&gt; has no undefined style entries
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; compiles without critical error
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; leaves no compiler directives in generated code
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; has no undefined style entries
</pre></code>

while locally it fails:

<code><pre>
[PASS] alloy compile advanced/device_query --&gt; preparing test app
[PASS] alloy compile advanced/device_query [android] --&gt; compiles without critical error
[PASS] alloy compile advanced/device_query [android] --&gt; leaves no compiler directives in generated code
[PASS] alloy compile advanced/device_query [android] --&gt; has no undefined style entries
[PASS] alloy compile advanced/device_query [android] --&gt; generated a alloy/controllers/index.js file
[FAIL] alloy compile advanced/device_query [android] --&gt; matches known good generated code for alloy/controllers/index.js
[PASS] alloy compile advanced/device_query [ios] --&gt; compiles without critical error
[PASS] alloy compile advanced/device_query [ios] --&gt; leaves no compiler directives in generated code
[PASS] alloy compile advanced/device_query [ios] --&gt; has no undefined style entries
[PASS] alloy compile advanced/device_query [ios] --&gt; generated a alloy/controllers/index.js file
[FAIL] alloy compile advanced/device_query [ios] --&gt; matches known good generated code for alloy/controllers/index.js
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; compiles without critical error
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; leaves no compiler directives in generated code
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; has no undefined style entries
[PASS] alloy compile advanced/device_query [mobileweb] --&gt; generated a alloy/controllers/index.js file
[FAIL] alloy compile advanced/device_query [mobileweb] --&gt; matches known good generated code for alloy/controllers/index.js
</pre></code>

I also saw this test only runs on darwin:
<a href="https://github.com/appcelerator/alloy/blob/master/test/specs/compile.js#L173" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/test/specs/compile.js#L173</a>

We don't specify an OS:
<a href="https://github.com/appcelerator/alloy/blob/master/.travis.yml" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/.travis.yml</a>

Which seems to make Travis to only test on Linux:
<a href="https://travis-ci.org/appcelerator/alloy/builds/118954721" rel="nofollow" target="_blank">https://travis-ci.org/appcelerator/alloy/builds/118954721</a>

Unfortunately enabling osx on Travis fails:
<a href="https://travis-ci.org/appcelerator/alloy/jobs/118956715" rel="nofollow" target="_blank">https://travis-ci.org/appcelerator/alloy/jobs/118956715</a>

Because of:
<a href="https://github.com/travis-ci/travis-ci/issues/2311" rel="nofollow" target="_blank">https://github.com/travis-ci/travis-ci/issues/2311</a>

Which can be workaround like:
<a href="https://github.com/travis-ci/travis-ci/issues/2311#issuecomment-171180704" rel="nofollow" target="_blank">https://github.com/travis-ci/travis-ci/issues/2311#issuecomment-171180704</a>

Which I did:
<a href="https://github.com/appcelerator/alloy/pull/775/files#diff-354f30a63fb0907d4ad57269548329e3L1" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/775/files#diff-354f30a63fb0907d4ad57269548329e3L1</a>

And now Travis is failing 355 tests on OSX just like local:
<a href="https://travis-ci.org/appcelerator/alloy/builds/118959856" rel="nofollow" target="_blank">https://travis-ci.org/appcelerator/alloy/builds/118959856</a>

I've checked all 355 failures and all were expected because of tests that were not updated for tickets like ALOY-1355, ALOY-1237 and ALOY-1335, so generated new known good code for all.

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2016-03-28

   Included this fix in <a href="https://github.com/appcelerator/alloy/pull/775" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/775</a> for ALOY-1475</li>
<li>Feon Sua Xin Miao 2016-03-28

   PR merged.</li>
<li>Fokke Zandbergen 2016-03-28

   [~cng] we are already at 1.8.2 - this would be 1.8.3</li>
</ol>


<p><a href="/ALOY/ALOY-1476.json">JSON Source</a></p>