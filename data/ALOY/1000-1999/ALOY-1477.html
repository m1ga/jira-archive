---
title: "[ALOY-1477] Regression: Missing model attributes cause error on collection data binding"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-03-29T17:37:52.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>alloy 1.8.0, alloy 1.8.3</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.2, alloy 1.8.4</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Fokke Zandbergen</td></tr>
<tr><th>Created</th><td>2016-03-29T10:06:01.000+0000</td></tr>
<tr><th>Updated</th><td>2016-03-31T23:24:36.000+0000</td></tr>
</table>

<h3>Description</h3>

ALOY-1369 solved one data-binding issue, but uncovered another.

<code>_.template()</code> demands all variables used in a template to exist. Now ALOY-1369 uses this method apps will error if this is not the case. A very typical use case is when you add a new model to a collection and use an auto incremented primary key. In this case that field will be empty when Alloy first updates the UI in response to <code>create</code>. Once the model has been synced to the DB Alloy would update the UI again to show the now populated field. But since Alloy 1.8.0 it would never get there because of the error.

The solution is likely to be found in how we use <code>_.template()</code> for model data-binding. Here don't pass the individual model fields as variables but the object as a whole. <code>_.template()</code> seems to have no problem with properties of that object being empty and simply renders an empty string.

*index.xml*

<code><pre>
&lt;Alloy&gt;
	&lt;Model src="mymodel" /&gt;
	&lt;Collection src="mymodel" /&gt;
	&lt;Window&gt;
		&lt;ScrollView layout="vertical"&gt;
			&lt;Label top="30" text="{mymodel.id} - {mymodel.title}" /&gt;
			&lt;ListView&gt;
				&lt;ListSection dataCollection="mymodel"&gt;
					&lt;ListItem title="{id} - {title}" /&gt;
				&lt;/ListSection&gt;
			&lt;/ListView&gt;
			&lt;Button onClick="createModel"&gt;Create Model&lt;/Button&gt;
		&lt;/ScrollView&gt;
	&lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

*index.js*

<code><pre>
Alloy.Models.mymodel.set({
  id: 0,
  title: 'mod TITLE'
});

Alloy.Collections.mymodel.reset([{
  id: 0,
  title: 'col TITLE'
}]);

$.index.open();

function createModel() {
  Alloy.Collections.mymodel.create({
    title: 'crt TITLE'
  });
}
</pre></code>

*mymodel.js*

<code><pre>
exports.definition = {
  config: {
    "columns": {
      "id": "INTEGER PRIMARY KEY AUTOINCREMENT",
      "title": "TEXT"
    },
    "adapter": {
      "type": "sql",
      "collection_name": "mymodel",
      "idAttribute": "id"
    }
  }
};
</pre></code>

*Template code*

<code><pre>
[INFO]  var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
[INFO]  with(obj||{}){
[INFO]  __p+='{mymodel.id} - {mymodel.title}';
[INFO]  }
[INFO]  return __p;
[INFO]
[INFO]  var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
[INFO]  with(obj||{}){
[INFO]  __p+=''+
[INFO]  ((__t=(id))==null?'':__t)+
[INFO]  ' - '+
[INFO]  ((__t=(title))==null?'':__t)+
[INFO]  '';
[INFO]  }
[INFO]  return __p;
</pre></code>

*Error*

<code><pre>
[ERROR] Script Error {
[ERROR]     column = 10;
[ERROR]     line = 4;
[ERROR]     message = "Can't find variable: id";
</pre></code>

Found by SO user:
<a href="http://stackoverflow.com/questions/36274177/alloy-data-binding-error-after-alloy-1-8-upgrade" rel="nofollow" target="_blank">http://stackoverflow.com/questions/36274177/alloy-data-binding-error-after-alloy-1-8-upgrade</a>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2016-03-29

   PR: <a href="https://github.com/appcelerator/alloy/pull/778" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/778</a>
   
   To test:
   
   1. Run <code>jake app:run dir=testing/ALOY-1234</code> with Alloy 1.8.3 and confirm the spec fails
   2. Run again with fix and confirm the spec passes</li>
<li>Feon Sua Xin Miao 2016-03-29

   PR merged.
   Alloy@1.8.4</li>
<li>Anna 2016-03-30

   with Alloy 1.8.4 the problem still happen....</li>
<li>Fokke Zandbergen 2016-03-30

   [~amurcia] could you give me a reproducible test case? The test case included in the description and PR test app does work with 1.8.4</li>
<li>Anna 2016-03-30

   Yes, this is my example:
   
   Model definition: <a href="http://pastebin.com/AhnPBQ2q" rel="nofollow" target="_blank">http://pastebin.com/AhnPBQ2q</a>
   Code: <a href="http://pastebin.com/du95qk2r" rel="nofollow" target="_blank">http://pastebin.com/du95qk2r</a>
   
   </li>
<li>Fokke Zandbergen 2016-03-30

   [~amurcia] Let's chat on TiSlack (fokkezb) or Skype (fokke.zandbergen).
   
   I took some changes to get those snippets work at all and after it did it worked on both Alloy 1.7.35 and 1.8.4 for me:
   
   <a href="http://get.fokkezb.nl/_/5mhW77c" rel="nofollow" target="_blank">http://get.fokkezb.nl/_/5mhW77c</a></li>
<li>Anna 2016-03-30

   It works now doing this at console:
   
   appc use 5.2.1-12
   
   
   from here: <a href="http://www.appcelerator.com/blog/2016/03/release-candidates-for-titanium-appcelerator-cli-5-2-1/#comment-157507" rel="nofollow" target="_blank">http://www.appcelerator.com/blog/2016/03/release-candidates-for-titanium-appcelerator-cli-5-2-1/#comment-157507</a>
   </li>
<li>Fokke Zandbergen 2016-03-30

   [~amurcia] if you are using the <code>appc</code> CLI then that will use the Alloy CLI bundled with what you select via <code>appc use</code>. You can see the Alloy version via <code>appc alloy -v</code>. Could you let me know what Alloy version it was that was failing?
   
   BTW, <code>appc use 5.2.1</code> will get you the GA version of 5.2.1-12</li>
<li>Anna 2016-03-30

   appc 5.0.6 with alloy 1.8.4  -> FAIL
   appc 5.2.1-12 with alloy 1.8.4 -> OK</li>
<li>Fokke Zandbergen 2016-03-30

    [~amurcia] I'm sorry but here's no <code>appc use 5.0.6</code> and <code>appc use 5.2.1-12</code> comes with Alloy 1.7.35 (<code>appc alloy -v</code>). Could you double check?</li>
<li>Anna 2016-03-30

    This is my config now:
    
    $ appc -v
    5.2.1-12
    $ alloy -v
    1.8.4
    $ appc alloy -v
    1.7.35
    
    My config before:
    
    Node.js Version = 0.12.7
    CLI Version = 5.0.6
    $ npm -v
    2.11.3
    $ ti -v
    5.0.5
    $ alloy -v
    1.7.19
    </li>
<li>Fokke Zandbergen 2016-03-30

    So it worked when you used <code>ti build</code> with Alloy 1.7.19 and it failed when you run via <code>appc run</code> with Alloy 1.7.35?</li>
<li>Anna 2016-03-31

    Yes</li>
<li>Fokke Zandbergen 2016-03-31

    [~amurcia] I ran <a href="http://get.fokkezb.nl/_/5mhW77c" rel="nofollow" target="_blank">http://get.fokkezb.nl/_/5mhW77c</a> with both Alloy 1.7.19 and 1.7.35 and both work. I'm using SDK 5.2.1.GA in both cases. Can you verify using the same test case? Please create a new JIRA ticket if you manage to get a reproducible test case.</li>
<li>Anna 2016-03-31

    I'm using SDK 5.1.2.GA</li>
<li>Fokke Zandbergen 2016-03-31

    [~amurcia] just tested both Alloy versions with SDK 5.1.2.GA and still works. Please try to get the linked test case to fail and open a new JIRA ticket if you succeed in failing ;)</li>
<li>Anna 2016-03-31

    ok</li>
<li>Eric Wieber 2016-03-31

    Verified fixed, using:
    
    MacOS 10.11.4 (15E65)
    Studio 4.5.0.201602170821
    Ti SDK 5.2.2.v20160328141205
    Appc NPM 4.2.5-1
    Appc CLI 5.2.2-3
    Alloy 1.8.5
    Xcode 7.3 (7D175)
    
    Missing model attributes no longer cause an error. Tested with provided test case and project provided by a user, in addition to a created test case. No errors encountered and blank strings are rendered instead.</li>
</ol>


<p><a href="/ALOY/ALOY-1477.json">JSON Source</a></p>