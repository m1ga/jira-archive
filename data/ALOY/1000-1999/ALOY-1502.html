---
title: "[ALOY-1502] Destroy Model in Alloy doesn't seem to be working"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2016-10-18T19:02:36.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.2.2</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>alloy, destroy</td></tr>
<tr><th>Reporter</th><td>Aminul Islam</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2016-06-05T16:42:37.000+0000</td></tr>
<tr><th>Updated</th><td>2016-10-18T19:04:55.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi,
Trying to delete models using destroy() events seems not working.
Steps to reproduce :
1. Create a simple Alloy project.
2.Create a model TestUser.js
<code><pre>
exports.definition = {
	config: {
		columns: {
			'id': 'INTEGER PRIMARY KEY AUTOINCREMENT',
		    "firstName": "TEXT",
		    "lastName": "TEXT",
		    "street": "TEXT"
		},
		adapter: {
			type: "sql",
			collection_name: "TestModel",
			idAttribute: 'id'
		}
	}
};
</pre></code>
3. Copy the following code in index.js 
<code><pre>
var user = Alloy.createModel('TestUser');
user.save({id:1, firstName:'aa', lastName:'bb', street:'cc'},{
	success:function()
	{
		Ti.API.info('*** user before destroy\n' + JSON.stringify(user,null,2));
		alert('*** user before destroy\n' + JSON.stringify(user,null,2));
		user.destroy({
			success:function()
			{
				Ti.API.info('*** user after destroy\n' + JSON.stringify(user,null,2));
				alert('*** user after destroy\n' + JSON.stringify(user,null,2));
			}
		});
		
	}
});
/*
user.fetch();
user.destroy({
	success:function()
	{
		Ti.API.info('*** user after destroy\n' + JSON.stringify(user,null,2));
		alert('*** user after destroy\n' + JSON.stringify(user,null,2));
	}
});
*/
$.index.open();
</pre></code>
4. Run this project

Destroy Model in Alloy doesn't seem to be working, because I get same log before and after destroy();

Log
<code><pre>
[INFO] :   *** book before destroy

[INFO] :   {

[INFO] :   "title": "aa2",

[INFO] :   "author": "bb2",

[INFO] :   "alloy_id": "3da5ac16-aa00-0e52-727d-9ad551f5c850"

[INFO] :   }

[INFO] :   *** book after destroy

[INFO] :   {

[INFO] :   "title": "aa2",

[INFO] :   "author": "bb2",

[INFO] :   "alloy_id": "3da5ac16-aa00-0e52-727d-9ad551f5c850"

[INFO] :   }

</pre></code>

Environment 
<code><pre>
Operating System
  Name                        = Mac OS X
  Version                     = 10.11.5
  Architecture                = 64bit
  # CPUs                      = 4
  Memory                      = 8.0GB

Node.js
  Node.js Version             = 4.4.4
  npm Version                 = 2.15.1

Appcelerator CLI
  Installer                   = 4.2.6
  Core Package                = 5.3.0

Titanium CLI
  CLI Version                 = 5.0.8
  node-appc Version           = 0.2.31
Titanium SDK : 5.3.0.GA
alloy -v : 1.7.33

</pre></code>


Thanks

<h3>Comments</h3>

<ol>
<li>Feon Sua Xin Miao 2016-10-18

   <code>model.destroy</code> triggers a DELETE event to the database, it doesn't destroy the model object instance stored in memory. Model objects are garbage collected like everything else in JS, and will go away once they are unreachable.
   
   To verify, the row is removed from the table:
   <code><pre>
   var user = Alloy.createModel('TestUser');
   user.save({id:1, firstName:'aa', lastName:'bb', street:'cc'},{
   	success: function() {
   		Ti.API.info('|************************************');
   		Ti.API.info('*** user before destroy\n' + JSON.stringify(user,null,2));
   
   		var db = Ti.Database.open('_alloy_');
   		var sql = 'SELECT * FROM TestModel';
   		var rs = db.execute(sql);
   		while (rs.isValidRow()) {
   			Ti.API.info(rs.fieldByName('id') + ' ' + rs.fieldByName('firstName') + ' ' + rs.fieldByName('lastName'));
   			rs.next();
   		}
   		rs.close();
   
   		user.destroy({
   			success: function(model, response) {
   				Ti.API.info('*** user after destroy\n' + JSON.stringify(user,null,2));
   				rs = db.execute(sql);
   				while (rs.isValidRow()) {
   					Ti.API.info(rs.fieldByName('id') + ' ' + rs.fieldByName('firstName') + ' ' + rs.fieldByName('lastName'));
   					rs.next();
   				}
   
   				rs.close();
   				db.close();
   				Ti.API.info('************************************|');
   			},
   			error: function(err){
   				Ti.API.info('error');
   				Ti.API.info(err);
   			}
   		});
   	}
   });
   </pre></code></li>
</ol>


<p><a href="/ALOY/ALOY-1502.json">JSON Source</a></p>