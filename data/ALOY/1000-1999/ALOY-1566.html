---
title: "[ALOY-1566] Compile process appears to fail when optimizing files with OS_* declarations "
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-05-30T18:43:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.10.0</td></tr>
<tr><th>Fix Version/s</th><td>CLI Release 6.3.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>regression</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2017-05-26T13:34:28.000+0000</td></tr>
<tr><th>Updated</th><td>2017-10-10T20:41:26.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

When running alloy compile on the studentfutter app, it will error out with the below, at first glance it appears to be choking on the Ti API usage I think <a href="https://github.com/hansemannn/studentenfutter-app/blob/2855926288f8ada820b947336f4d3dbd9f5f0f4e/app/lib/android/actionbar.js" rel="nofollow" target="_blank">https://github.com/hansemannn/studentenfutter-app/blob/2855926288f8ada820b947336f4d3dbd9f5f0f4e/app/lib/android/actionbar.js</a>

<code><pre>
[INFO] ----- OPTIMIZING -----
[INFO] - alloy/moment/lang/de-at.js
[INFO] - alloy/moment/lang/de.js
[INFO] - alloy/moment/lang/en-au.js
[INFO] - alloy/moment/lang/en-ca.js
[INFO] - alloy/moment/lang/en-gb.js
[INFO] - alloy/moment/lang/es.js
[INFO] - alloy/moment/lang/pt-br.js
[INFO] - alloy/moment/lang/pt.js
[INFO] - iphone/actionbar.js
[INFO] - iphone/alloy.js
[INFO] - iphone/api.js
[INFO] - iphone/dateutils.js
[INFO] - iphone/loader.js
[INFO] - iphone/locations.js
[INFO] - iphone/request.js
[INFO] - iphone/utils.js
[INFO] - iphone/alloy/models/Cart.js
[INFO] - iphone/alloy/models/Lunch.js
[INFO] - iphone/alloy/sync/localStorage.js
[INFO] - iphone/alloy/sync/properties.js
[INFO] - iphone/alloy/sync/sql.js
[INFO] - iphone/alloy/widgets/nl.fokkezb.pullToRefresh/styles/widget.js
[ERROR] Error transforming JS file
[ERROR] /Users/eharris/Documents/git/testing_apps/studentenfutter-app/Resources/iphone/actionbar.js: Property id of VariableDeclarator expected node to be of a type ["LVal"] but instead got "BooleanLiteral"
</pre></code>

<h4>Steps to reproduce</h4>

<h4>Download studenfutter <a href="https://github.com/hansemannn/studentenfutter-app" rel="nofollow" target="_blank">https://github.com/hansemannn/studentenfutter-app</a></h4>
<h4>Run <code>alloy compile --config platform=ios</code></h4>

<h4>Actual</h4>

Compile process will error out with the above

<h4>Expected</h4>

Compile process should not error out

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2017-05-26

   I dont think this is because of Ti API usage
   
   Uncommenting the platforms optimization gets rid of this  error <a href="https://github.com/appcelerator/alloy/blob/master/Alloy/commands/compile/ast/optimizer-plugin.js#L28-L30" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/master/Alloy/commands/compile/ast/optimizer-plugin.js#L28-L30</a>
   <a href="https://github.com/appcelerator/alloy/blob/18ec7eae9b2447cc8affad0909f1ed92a893e184/Alloy/commands/compile/ast/optimizer-plugin.js#L64-L66" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/18ec7eae9b2447cc8affad0909f1ed92a893e184/Alloy/commands/compile/ast/optimizer-plugin.js#L64-L66</a>
   
   <code><pre>
   if (this.defines.hasOwnProperty(path.node.name)) {
   					if (path.parent.type !== 'VariableDeclarator') {
   						path.replaceWith(types.booleanLiteral(this.defines[path.node.name]));
   					}
   				}
   </pre></code></li>
<li>Feon Sua Xin Miao 2017-05-30

   PR: <a href="https://github.com/appcelerator/alloy/pull/828" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/828</a></li>
<li>Abir Mukherjee 2017-10-10

   Validated with the environment:
   Node Version: 6.10.3
   NPM Version: 3.10.10
   Mac OS: 10.13
   Appc CLI: 6.3.0-master.7
   Appc CLI NPM: 4.2.9
   Titanium SDK version: 6.1.2
   
   The app compiled with no errors and the fix is validated.. One side note is that the test app needs to be updated by moving DefaultIcon.png to app/
   </li>
</ol>


<p><a href="/ALOY/ALOY-1566.json">JSON Source</a></p>