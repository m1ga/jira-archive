---
title: "[ALOY-1622] Migration on a model with sql adapter type: build error due to an undefined variable"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-07-18T21:44:36.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.13.0</td></tr>
<tr><th>Fix Version/s</th><td>CLI Release 7.0.5, Alloy 1.13.1</td></tr>
<tr><th>Components</th><td>Models</td></tr>
<tr><th>Labels</th><td>alloy, bug, migration</td></tr>
<tr><th>Reporter</th><td>Vittorio Sorbera</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2018-06-14T09:06:16.000+0000</td></tr>
<tr><th>Updated</th><td>2018-07-18T22:12:51.000+0000</td></tr>
</table>

<h3>Description</h3>

I tried to do a migration on a model with sql adapter type, following the example of the guide: <a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/guide/Alloy_Sync_Adapters_and_Migrations-section-src-36739597_AlloySyncAdaptersandMigrations-Example
But the build fails with the error in the attached image. 
The problem seems to be due to a <code>db</code> variable that has not been defined in the <code>/Alloy/lib/alloy/sync/sql.js</code> file, exactly it is this: <a href="https://github.com/appcelerator/alloy/blob/6c311743af90da438f9c30bfdbe29275247daa51/Alloy/lib/alloy/sync/sql.js#L341" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/6c311743af90da438f9c30bfdbe29275247daa51/Alloy/lib/alloy/sync/sql.js#L341</a>

If I modify it in <code>var db = Ti.Database.open(config.adapter.db_name);</code> everything works properly.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/ALOY/ALOY-1622_65262/sql-error.jpg">sql-error.jpg</td></td><td>2018-06-14T08:48:58.000+0000</td><td>113746</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2018-06-14

   Which Alloy- and appc-cli version do you use? This looks valid and could be a side-effect of recent strict mode or Babel changes. [~eharris] ?
   
   </li>
<li>Vittorio Sorbera 2018-06-14

   * alloy 1.12.0
   * appc-cli 7.0.3
   * hyperloop 3.0.5
   </li>
<li>Ewan Harris 2018-06-19

   [~hknoechel] You're more than likely correct, it looks to be due to <code>db</code> being assigned without ever being declared in scope, which with strict mode is an error. It looks to only be a problem on Android.
   
   PR here <a href="https://github.com/appcelerator/alloy/pull/898" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/898</a></li>
</ol>


<p><a href="/ALOY/ALOY-1622.json">JSON Source</a></p>