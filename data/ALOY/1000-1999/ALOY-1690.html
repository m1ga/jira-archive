---
title: "[ALOY-1690] sourcemaps not being generated for files under lib"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-06-20T19:13:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.13.9</td></tr>
<tr><th>Fix Version/s</th><td>CLI Release 7.1.0, Alloy 1.14.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2019-05-24T12:22:32.000+0000</td></tr>
<tr><th>Updated</th><td>2019-06-24T17:40:05.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

Alloy should be generating sourcemaps for files under <code>lib</code> according to ALOY-616 but this currently is not occurring. It looks like this was broken in ALOY-1262 as it checks whether the target file (i.e the file we're about to write exists) rather than the file we're generating the sourcemap for.

<h4>Steps to reproduce</h4>

1. Compile kitchensink-v2 <code>\[appc\] alloy compile --config platform=ios</code>
2. Check the sourcemap directory <code>ls ./build/map/Resources/iphone</code>

<h4>Expected</h4>

There should be <code>actionbar.js.map</code>, <code>logger.js.map</code>, and, <code>permissions.js.map</code> files in that folder

<h4>Actual</h4>

Those files do not exist

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2019-05-24

   Looking closer at this, the whole sourcemapping for the lib files seems off. It's setting the filename in the sourcemaps to a non-existent .js file under the build/map directory, however after some reading/looking at controller sourcemapping filename should be the filename for the file the sourcemap represents in the classic code at runtime e.g. <code>Resources/alloy/logger.js</code> for <code>app/lib/logger.js</code>.</li>
<li>Ewan Harris 2019-05-29

   Included in ALOY-1612 <a href="https://github.com/appcelerator/alloy/pull/893/commits/900be2d4679674fd5d84aa5571cff9bb0a48976e" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/893/commits/900be2d4679674fd5d84aa5571cff9bb0a48976e</a></li>
<li>Christopher Williams 2019-06-19

   Note that there is still an unresolved known issue here in that while the external source maps are generated in the build/map folder - the copied file under <code>Resources/</code> *does not* have a <code>//# sourcemappingURL=</code> comment pointing to it, so babel/Studio/Safari/Chrome DevTools aren't aware of it and able to "carry" it forward like files under <code>app/</code> are.
   
   I think another ticket should be opened to fix that issue as well, otherwise under the debugger for the "source" file you set the <code>Resources/&lt;platform&gt;/file.js</code> path/file rather then the path/file from <code>app/lib/file.js</code> (Additionally, it's entirely possible the source map for the file is wrong due to a post-processing run of the "optimizer".
   
   The fix for this is more involved and requires doing the optimizing, source map generation and writing of the copied/generated file all at once, rather than as 3 separate steps.</li>
<li>Keerthi Mahalingam 2019-06-20

   Tested and Verified the Fix on cli 7.1.0-master.22. actionbar.js.map, logger.js.map, and, permissions.js.map  files were shown  when complied.Works as expected. Closing.
   <code><pre>
     Name                        = Mac OS X
     Version                     = 10.13.6
     Architecture                = 64bit
   Node.js
     Node.js Version             = 8.9.1
     npm Version                 = 5.5.1
   Titanium CLI
     CLI Version                 = 5.1.1
   Studio version =5.1.2.201903111843
   Cli =7.1.0-master.22
   </pre></code></li>
</ol>


<p><a href="/ALOY/ALOY-1690.json">JSON Source</a></p>