---
title: "[ALOY-1698] Compile: Errors thrown during sourcemap step are not visible to a user"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-08-20T21:48:43.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Alloy 1.14.0</td></tr>
<tr><th>Fix Version/s</th><td>CLI Release 7.1.1, Alloy 1.14.1</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>regression</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Samuel Haig</td></tr>
<tr><th>Created</th><td>2019-07-22T14:48:59.000+0000</td></tr>
<tr><th>Updated</th><td>2019-08-20T21:48:43.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

*This is a regression due to ALOY-1629, as babel became stricter on syntax being "more correct. There's nothing we can do to stop this being thrown, other than backing that out which imo we shouldnt do. We should prefer correctness*

When we hit an error in the parsing of code in the sourcemap step we currently log it a trace level and rethrow it. This doesn't really help a user figure out what's wrong, we should handle it similarly to other babel processing errors where we construct a codeframe for the error and log that to give a user some context as to what the error is

We should be able to achieve this by using the [dieWithCodeFrame](<a href="https://github.com/appcelerator/alloy/blob/c63914c87610bcd1bc0e8be3426b160783a0991e/Alloy/utils.js#L535)" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/blob/c63914c87610bcd1bc0e8be3426b160783a0991e/Alloy/utils.js#L535)</a> function from utils, as the error is thrown by babel we should have the required info

<h4>Steps to reproduce</h4>

1. Add the below to a file under lib
<code><pre>
function getStoredAnswers() {

}

function getStoredAnswers() {
	
}
</pre></code>
2. Run a build for any platform

<h4>Actual</h4>

The build errors with a stacktrace, but no real useful info

<h4>Expected</h4>

The build should error with a codeframe to try and point a user to the right location and what the error is

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2019-08-14

   PR: <a href="https://github.com/appcelerator/alloy/pull/935" rel="nofollow" target="_blank">https://github.com/appcelerator/alloy/pull/935</a></li>
<li>Lokesh Choudhary 2019-08-20

   FR Passed.
   
   Better error is shown with the fix:
   e.g
   <code><pre>
   [ERROR] :  Error parsing code in app/lib/test.js. Identifier 'getStoredAnswers' has already been declared (9:9)
   [ERROR] :  7 |
   [ERROR] :  8 |
   [ERROR] :  &gt;  9 | function getStoredAnswers() {
   [ERROR] :  |         ^
   [ERROR] :  10 |
   [ERROR] :  11 |
   [ERROR] :  12 |
   [ERROR] :  Alloy compiler failed
   [ERROR] Application Installer abnormal process termination. Process exit value was 1
   </pre></code>
   
   Closing.
   
   Studio Ver:     5.1.3.201907112159
   SDK Ver:        8.1.1.v20190820115323
   OS Ver:         10.14.5
   Xcode Ver:      Xcode 11.0
   Appc NPM:       4.2.14
   Appc CLI:       7.1.1-master.5
   Daemon Ver:     1.1.3
   Ti CLI Ver:     5.2.1
   Alloy Ver:      1.14.1
   Node Ver:       10.16.1
   NPM Ver:        6.9.0
   Java Ver:       10.0.2
   Devices:        â‡¨ google Pixel (Android 9)</li>
</ol>


<p><a href="/ALOY/ALOY-1698.json">JSON Source</a></p>