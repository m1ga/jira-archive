---
title: "[DAEMON-12] androidlib v2"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-11-13T13:07:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Appc Daemon 1.0.0</td></tr>
<tr><th>Components</th><td>androidlib</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2016-02-04T03:10:12.000+0000</td></tr>
<tr><th>Updated</th><td>2017-11-13T13:07:05.000+0000</td></tr>
</table>

<h3>Description</h3>

androidlib (<a href="https://github.com/appcelerator/androidlib)" rel="nofollow" target="_blank">https://github.com/appcelerator/androidlib)</a> was originally built for early Hyperloop prototypes, but lacked the robustness and features of the Android tooling in the Titanium SDK. The purpose of this ticket is to update androidlib with the logic from the Titanium SDK while maintaining API consistency with ioslib and windowslib and preserving the features at androidlib supports.

<h4>Detect installed Android environment</h4>

<code>detect()</code> must return the following Android installation information:

* SDK information
** Path to the SDK
** Paths to each executable and <code>.jar</code> file listed above
** <code>build-tools</code>, <code>platform-tools</code>, and <code>tools</code> paths and versions
** Targets (SDKs, add-ons)
* NDK information
* Android home directory path
* Emulators
* Devices

When detecting the Android environment, there are a number of options that <code>detect()</code> must accept and use to override the defaults. These include:

* <code>bypassCache</code> (Boolean)- When <code>true</code>, re-detects Android environment (default: <code>false</code>)
* <code>sdkPath</code> (String) - The path to an Android SDK
* <code>ndkPath</code> (String) - The path to an Android NDK
* <code>androidHomePath</code> (String)
* <code>executables</code> (Object) - Key/value lookup of executable name (i.e. <code>android</code>, <code>adb</code>, <code>dx</code>, etc) to its path

<h4>Android SDK</h4>

While there could be many Android installations, we only care about a single installation. To find it, search the the following locations:

<h4>The <code>sdkPath</code> specified in the <code>detect()</code> <code>opts</code> argument</h4>
<h4><code>ANDROID_SDK_ROOT</code> environment variable</h4>
<h4><code>ANDROID_SDK</code> environment variable</h4>
<h4>The parent folder containing the <code>android</code> or <code>android.bat</code> executable</h4>
<h4>The parent folder containing the <code>adb</code> or <code>adb.exe</code> executable</h4>
<h4>Various common paths</h4>
* Windows: <code>%SystemDrive%</code>, <code>%ProgramFiles%</code>, <code>%ProgramFiles(x86)%</code>, <code>%CommonProgramFiles%</code>, <code>~</code>
* OS X/Linux: <code>/opt</code>, <code>/opt/local</code>, <code>/usr</code>, <code>/usr/local</code>, <code>~</code>

In order for a path to be deemed a valid Android installation, it must have the following:

* <code>build-tools/&lt;version&gt;/aapt</code> / <code>build-tools/&lt;version&gt;/aapt.exe</code>
* <code>build-tools/&lt;version&gt;/aidl</code> / <code>build-tools/&lt;version&gt;/aidl.exe</code>
* <code>build-tools/&lt;version&gt;/dx</code> / <code>build-tools/&lt;version&gt;/dx.bat</code>
* <code>platform-tools/adb</code> / <code>platform-tools/adb.exe</code>
* <code>platform-tools/lib/dx.jar</code>
* <code>tools/android</code> / <code>tools/android.bat</code>
* <code>tools/emulator</code> / <code>tools/emulator.exe</code>
* <code>tools/mksdcard</code> / <code>tools/mksdcard.exe</code>
* <code>tools/proguard/lib/proguard.jar</code>
* <code>tools/source.properties</code>
* <code>tools/zipalign</code> / <code>tools/zipalign</code>

<h4>Detect installed Android targets (SDKs and Addons)</h4>

Required information:
* <code>id</code> (String) Example: <code>"android-23"</code>
* <code>name</code> (String) Example: <code>"Android 6.0"</code>
* <code>description</code> (String) Example: <code>"Android + Google APIs"</code>
* <code>type</code> (String}} Either <code>"platform"</code> or <code>"add-on"</code>
* <code>api-level</code> (String}} Examples: <code>"23"</code>, <code>"N"</code>
* <code>sdk</code> (Number) Examples: <code>23</code>, <code>24</code>
* <code>abis</code> (Array<String>)
* <code>skins</code> (Array<String>)
* <code>revision</code> (Number)
* <code>path</code> (String)
* <code>androidJar</code> (String) Path to <code>android.jar</code>. Needed for <code>aapt package</code>.
* <code>aidl</code> (String) Path to <code>framework.aidl</code> file.
* <code>based-on</code> (Object) Used for add-ons and used to derive <code>aidl</code> since only <code>platform</code> has an <code>aidl</code> file
* <code>libraries</code> (Object) Map of add-on libraries. Used for for detecting if SDK supports maps, but this is probably not needed, just nice to have.

<h4>Android NDK</h4>

TODO

<h4>Android Home Directory</h4>

Derived based on <code>androidHomePath</code> option, <code>ANDROID_SDK_HOME</code> environment variable, or <code>~/.android</code>.

<h4>Emulators</h4>

An array of emulators containing the following information:

NOTE: Incomplete

* <code>type</code> (String) Either <code>"avd"</code> or <code>"genymotion"</code>
* <code>name</code> (String) For Android emulators, this value is returned from <code>avd name</code> when telnetting into the emulator. For Genymotion, we get this from VM name in VirtualBox using <code>vboxmanage</code>.
* <code>id</code> (String) Same value as <code>name</code>. Devices do not have a <code>name</code>, but we need a common identifier for the target, hence <code>id</code>.
* <code>abi</code> (String)
* <code>api-level</code> Not possible to get with older versions of Genymotion, so just set to <code>null</code> for Genymotion.

Android emulator specific:
* <code>device</code> (String)
* <code>path</code> (String)
* <code>skin</code> (String)

Genymotion specific:
* <code>guid</code> (String)

<h4>Devices</h4>

An array of devices.

<h4>androidlib should NOT...</h4>

* Determine if any SDK is supported or not
* Determine if any sort of "issues"

<h3>Comments</h3>

<ol>
<li>Feon Sua Xin Miao 2016-03-28

   PR: <a href="https://github.com/appcelerator/androidlib/pull/5" rel="nofollow" target="_blank">https://github.com/appcelerator/androidlib/pull/5</a></li>
</ol>


<p><a href="/DAEMON/DAEMON-12.json">JSON Source</a></p>