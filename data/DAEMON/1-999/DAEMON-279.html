---
title: "[DAEMON-279] node-ios-device: Refactor to use N-API"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-07-01T18:33:50.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Appc Daemon 2.3.0</td></tr>
<tr><th>Components</th><td>node-ios-device</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2019-06-05T03:08:12.000+0000</td></tr>
<tr><th>Updated</th><td>2019-07-01T18:33:50.000+0000</td></tr>
</table>

<h3>Description</h3>

<code>node-ios-device</code> uses nan (Native Abstractions for Node.js) and whenever there's a new major version of Node, something breaks.

 To future-proof <code>node-ios-device</code>, we need to adopt Node's N-API.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2019-06-21

   PR: <a href="https://github.com/appcelerator/node-ios-device/pull/47" rel="nofollow" target="_blank">https://github.com/appcelerator/node-ios-device/pull/47</a>
   
   <h4>Testing Prerequisites</h4>
   
   Xcode, Node, npm, and iOS devices, lots of iOS devices.
   
   <h4>Testing Steps</h4>
   
   1. Check out the source and build:
   
   <code><pre>
   git clone <a href="https://github.com/appcelerator/node-ios-device.git" rel="nofollow" target="_blank">https://github.com/appcelerator/node-ios-device.git</a>
   cd node-ios-device
   git checkout -b v2 origin/v2
   npm i
   </pre></code>
   
   2. You should probably manually open <code>test/TestApp/TestApp.xcodeproj</code> and build it to make sure the provisioning profiles are in order.
   
   3. Run the unit tests:
   
   <code><pre>
   npm test
   </pre></code>
   
   The tests will install the TestApp. Midway through the tests, it will print a message to launch the TestApp on device. You have 15 seconds. Go!
   
   4. Run the CLI:
   
   <code><pre>
   node bin/node-ios-device
   
   node bin/node-ios-device ls
   
   node bin/node-ios-device watch
   
   node bin/node-ios-device install test/TestApp/build/Release-iphoneos/TestApp.app
   
   node bin/node-ios-device syslog &lt;udid&gt;
   
   node bin/node-ios-device forward 12345 &lt;udid&gt;
   </pre></code>
   
   <h4>Testing Cases</h4>
   
   * Node.js ^8.12.0 and >= 10.2.0
   * macOS Mojave and Catalina
   * 0 to 2 devices
   * iPhones, iPads, whatever you have
   * Unplug device while performing an action
   
   Keep an eye out for fatal errors: seg faults, mutex lock fails, libuv close errors, deadlocks, and other nasty issues.</li>
</ol>


<p><a href="/DAEMON/DAEMON-279.json">JSON Source</a></p>