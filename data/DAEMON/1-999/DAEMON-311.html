---
title: "[DAEMON-311] Improve appcd plugin management"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-04-14T21:25:39.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Appc Daemon 4.0.0</td></tr>
<tr><th>Components</th><td>appcd, appcd-core</td></tr>
<tr><th>Labels</th><td>cb-next</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2020-01-14T21:40:30.000+0000</td></tr>
<tr><th>Updated</th><td>2020-04-14T21:25:39.000+0000</td></tr>
</table>

<h3>Description</h3>

Appc Daemon needs a better way to install and manage appcd plugins.

<h4>Problem</h4>

Currently, <code>appcd</code> plugins are installed via the <code>appcd-default-plugins</code> package. When the <code>appcd-default-plugins</code> package is installed (via <code>appcd-core</code>, via <code>appcd</code>), it will attempt to download and install the packages in an npm script. However, npm runs scripts as "nobody" which generally does not have access to the user's home directory on macOS and Linux and thus no plugins are installed. Plugins cannot be marked as traditional dependencies since we need to support multiple major versions installed side-by-side.

Whenever the Appc Daemon is started, it will attempt to reconcile and install the default plugins. This solves the permission issue, but now requires you to start the daemon while online to download the plugins.

<h4>Proposal</h4>

1. Migrate plugin install logic from <code>appcd-default-plugins</code> to <code>appcd-core</code>.

2. Add a <code>appcd pm</code> command that would allow users to install the default plugins, setup local dev plugins, install 3rd party plugins, uninstall plugins, and view installed plugins. Subcommands include <code>list</code>, <code>install</code>, <code>uninstall</code>, <code>search</code>, <code>update</code>, and <code>view</code>.

3. Add a file to <code>appcd</code> containing the prescribed default plugin list based on the list currently in <code>appcd-default-plugins</code>.

a. We could elect to lockdown plugin versions instead of using semver ranges.
b. We could check online to download an updated list so that we don't have to ship a new <code>appcd</code> whenever we want to update plugins.

4. Add a <code>appcd setup</code> command that leverages the plugin command's logic (from #1) to reconcile and install the default appcd plugins defined in the list (from \#2). Note that <code>appcd setup</code> is generic in nature and can be used to configure specific behavior such as telemetry opt-in and proxy settings.

5. After <code>appcd</code> is installed, an npm script would print a message instructing the user to run <code>"appcd setup"</code>. Note that no appcd plugins would be installed at install time via an npm script.

6. Remove <code>appcd-default-plugins</code>. At runtime, instead of attempting to reconcile and install the default plugins, print the "<code>Run: appcd setup</code>" message.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2020-04-14

   PR: <a href="https://github.com/appcelerator/appc-daemon/pull/468" rel="nofollow" target="_blank">https://github.com/appcelerator/appc-daemon/pull/468</a></li>
</ol>


<p><a href="/DAEMON/DAEMON-311.json">JSON Source</a></p>