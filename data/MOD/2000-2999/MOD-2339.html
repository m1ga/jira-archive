---
title: "[MOD-2339] APS-SDK: Cannot build project"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Hans Kn√∂chel</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2017-06-10T11:50:29.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-06T18:52:16.000+0000</td></tr>
</table>

<h3>Description</h3>

 When trying to build the [APS SDK](<a href="https://github.com/appcelerator/aps_sdk)" rel="nofollow" target="_blank">https://github.com/appcelerator/aps_sdk)</a> from the source (using <code>travis_build.sh</code> or the platform-specific <code>build.js</code>, the build fails during the recompiling of the <code>node-gyp</code> module:
<code><pre>
Hans-Macbook-Pro:ios hknoechel$ ./travis_build.sh 

Setting up the node modules for the build scripts

Installing APSCrypto library
./travis_build.sh: line 15: pushd: ios/framework/Libraries/APSCrypto/: No such file or directory
<h4>100.0%</h4>
./travis_build.sh: line 17: popd: directory stack empty
Installing Node modules for Analytics
./travis_build.sh: line 20: cd: ios/support/analytics: No such file or directory
npm WARN deprecated wrench@1.5.9: wrench.js is deprecated! You should check out fs-extra (<a href="https://github.com/jprichardson/node-fs-extra)" rel="nofollow" target="_blank">https://github.com/jprichardson/node-fs-extra)</a> for any operations you were using wrench for. Thanks for all the usage over the years.

&gt; ref@1.3.4 install /Users/hknoechel/Documents/appcelerator_modules/aps_sdk/ios/node_modules/ref
&gt; node-gyp rebuild

  CXX(target) Release/obj.target/binding/src/binding.o
  SOLINK_MODULE(target) Release/binding.node
clang: warning: libstdc++ is deprecated; move to libc++ with a minimum deployment target of OS X 10.9 [-Wdeprecated]

&gt; ffi@1.2.5 install /Users/hknoechel/Documents/appcelerator_modules/aps_sdk/ios/node_modules/ffi
&gt; node-gyp rebuild

  CC(target) Release/obj.target/ffi/deps/libffi/src/prep_cif.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/types.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/raw_api.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/java_raw_api.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/closures.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/x86/ffi.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/x86/ffi64.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/x86/darwin.o
  CC(target) Release/obj.target/ffi/deps/libffi/src/x86/darwin64.o
  LIBTOOL-STATIC Release/libffi.a
  CXX(target) Release/obj.target/ffi_bindings/src/ffi.o
In file included from ../src/ffi.cc:2:
../src/ffi.h:57:43: error: unknown type name 'Arguments'; did you mean 'v8::internal::Arguments'?
    static Handle&lt;Value&gt; FFIPrepCif(const Arguments& args);
                                          ^~~~~~~~~
                                          v8::internal::Arguments
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:147:7: note: 'v8::internal::Arguments' declared
      here
class Arguments;
      ^
In file included from ../src/ffi.cc:2:
../src/ffi.h:58:46: error: unknown type name 'Arguments'; did you mean 'v8::internal::Arguments'?
    static Handle&lt;Value&gt; FFIPrepCifVar(const Arguments& args);
                                             ^~~~~~~~~
                                             v8::internal::Arguments
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:147:7: note: 'v8::internal::Arguments' declared
      here
class Arguments;
      ^
In file included from ../src/ffi.cc:2:
../src/ffi.h:59:40: error: unknown type name 'Arguments'; did you mean 'v8::internal::Arguments'?
    static Handle&lt;Value&gt; FFICall(const Arguments& args);
                                       ^~~~~~~~~
                                       v8::internal::Arguments
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:147:7: note: 'v8::internal::Arguments' declared
      here
class Arguments;
      ^
In file included from ../src/ffi.cc:2:
../src/ffi.h:60:45: error: unknown type name 'Arguments'; did you mean 'v8::internal::Arguments'?
    static Handle&lt;Value&gt; FFICallAsync(const Arguments& args);
                                            ^~~~~~~~~
                                            v8::internal::Arguments
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:147:7: note: 'v8::internal::Arguments' declared
      here
class Arguments;
      ^
In file included from ../src/ffi.cc:2:
../src/ffi.h:64:40: error: unknown type name 'Arguments'; did you mean 'v8::internal::Arguments'?
    static Handle&lt;Value&gt; Strtoul(const Arguments& args);
                                       ^~~~~~~~~
                                       v8::internal::Arguments
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:147:7: note: 'v8::internal::Arguments' declared
      here
class Arguments;
      ^
In file included from ../src/ffi.cc:2:
../src/ffi.h:94:41: error: unknown type name 'Arguments'; did you mean 'v8::internal::Arguments'?
    static Handle&lt;Value&gt; Callback(const Arguments& args);
                                        ^~~~~~~~~
                                        v8::internal::Arguments
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:147:7: note: 'v8::internal::Arguments' declared
      here
class Arguments;
      ^
../src/ffi.cc:19:15: error: calling a protected constructor of class 'v8::HandleScope'
  HandleScope scope;
              ^
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:915:13: note: declared protected here
  V8_INLINE HandleScope() {}
            ^
../src/ffi.cc:21:3: error: unexpected namespace name 'Buffer': expected expression
  Buffer *buf = Buffer::New(ptr, length, wrap_pointer_cb, user_data);
  ^
../src/ffi.cc:21:11: error: use of undeclared identifier 'buf'
  Buffer *buf = Buffer::New(ptr, length, wrap_pointer_cb, user_data);
          ^
../src/ffi.cc:21:17: error: no matching function for call to 'New'
  Buffer *buf = Buffer::New(ptr, length, wrap_pointer_cb, user_data);
                ^~~~~~~~~~~
/Users/hknoechel/.node-gyp/6.10.2/include/node/node_buffer.h:34:40: note: candidate function not
      viable: requires at most 3 arguments, but 4 were provided
NODE_EXTERN v8::MaybeLocal&lt;v8::Object&gt; New(v8::Isolate* isolate,
                                       ^
/Users/hknoechel/.node-gyp/6.10.2/include/node/node_buffer.h:46:40: note: candidate function not
      viable: requires 3 arguments, but 4 were provided
NODE_EXTERN v8::MaybeLocal&lt;v8::Object&gt; New(v8::Isolate* isolate,
                                       ^
/Users/hknoechel/.node-gyp/6.10.2/include/node/node_buffer.h:39:40: note: candidate function not
      viable: requires 5 arguments, but 4 were provided
NODE_EXTERN v8::MaybeLocal&lt;v8::Object&gt; New(v8::Isolate* isolate,
                                       ^
/Users/hknoechel/.node-gyp/6.10.2/include/node/node_buffer.h:31:40: note: candidate function not
      viable: requires 2 arguments, but 4 were provided
NODE_EXTERN v8::MaybeLocal&lt;v8::Object&gt; New(v8::Isolate* isolate, size_t length);
                                       ^
../src/ffi.cc:22:16: error: no member named 'Close' in 'v8::HandleScope'
  return scope.Close(buf-&gt;handle_);
         ~~~~~ ^
../src/ffi.cc:22:22: error: use of undeclared identifier 'buf'
  return scope.Close(buf-&gt;handle_);
                     ^
../src/ffi.cc:28:33: error: too few arguments to function call, single argument 'isolate' was not
      specified
  Local&lt;Object&gt; o = Object::New();
                    ~~~~~~~~~~~ ^
/Users/hknoechel/.node-gyp/6.10.2/include/node/v8.h:3006:3: note: 'New' declared here
  static Local&lt;Object&gt; New(Isolate* isolate);
  ^
../src/ffi.cc:31:18: error: no member named 'NewSymbol' in 'v8::String'
  o-&gt;Set(String::NewSymbol("dlopen"),  WrapPointer((char *)dlopen));
         ~~~~~~~~^
../src/ffi.cc:32:18: error: no member named 'NewSymbol' in 'v8::String'
  o-&gt;Set(String::NewSymbol("dlclose"), WrapPointer((char *)dlclose));
         ~~~~~~~~^
../src/ffi.cc:33:18: error: no member named 'NewSymbol' in 'v8::String'
  o-&gt;Set(String::NewSymbol("dlsym"),   WrapPointer((char *)dlsym));
         ~~~~~~~~^
../src/ffi.cc:34:18: error: no member named 'NewSymbol' in 'v8::String'
  o-&gt;Set(String::NewSymbol("dlerror"), WrapPointer((char *)dlerror));
         ~~~~~~~~^
../src/ffi.cc:36:23: error: no member named 'NewSymbol' in 'v8::String'
  target-&gt;Set(String::NewSymbol("StaticFunctions"), o);
              ~~~~~~~~^
../src/ffi.cc:49:3: error: no matching function for call to 'NODE_SET_METHOD'
  NODE_SET_METHOD(target, "ffi_prep_cif", FFIPrepCif);
  ^~~~~~~~~~~~~~~
/Users/hknoechel/.node-gyp/6.10.2/include/node/node.h:269:25: note: expanded from macro
      'NODE_SET_METHOD'
#define NODE_SET_METHOD node::NODE_SET_METHOD
                        ^~~~~~~~~~~~~~~~~~~~~
/Users/hknoechel/.node-gyp/6.10.2/include/node/node.h:257:13: note: candidate function not viable:
      no known conversion from 'Handle&lt;v8::Value&gt; (const v8::internal::Arguments &)' (aka
      'v8::Local&lt;v8::Value&gt; (const v8::internal::Arguments &)') to 'v8::FunctionCallback' (aka 'void
      (*)(const FunctionCallbackInfo&lt;v8::Value&gt; &)') for 3rd argument
inline void NODE_SET_METHOD(v8::Local&lt;v8::Object&gt; recv,
            ^
/Users/hknoechel/.node-gyp/6.10.2/include/node/node.h:244:13: note: candidate function not viable:
      no known conversion from 'Handle&lt;v8::Value&gt; (const v8::internal::Arguments &)' (aka
      'v8::Local&lt;v8::Value&gt; (const v8::internal::Arguments &)') to 'v8::FunctionCallback' (aka 'void
      (*)(const FunctionCallbackInfo&lt;v8::Value&gt; &)') for 3rd argument
inline void NODE_SET_METHOD(v8::Local&lt;v8::Template&gt; recv,
            ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
make: *** [Release/obj.target/ffi_bindings/src/ffi.o] Error 1
gyp ERR! build error 
gyp ERR! stack Error: <code>make</code> failed with exit code: 2
gyp ERR! stack     at ChildProcess.onExit (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/build.js:276:23)
gyp ERR! stack     at emitTwo (events.js:106:13)
gyp ERR! stack     at ChildProcess.emit (events.js:191:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:215:12)
gyp ERR! System Darwin 16.6.0
gyp ERR! command "/usr/local/bin/node" "/usr/local/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js" "rebuild"
gyp ERR! cwd /Users/hknoechel/Documents/appcelerator_modules/aps_sdk/ios/node_modules/ffi
gyp ERR! node -v v6.10.2
gyp ERR! node-gyp -v v3.4.0
gyp ERR! not ok 
Appcelerator-Framework@3.0.1 /Users/hknoechel/Documents/appcelerator_modules/aps_sdk/ios
‚îú‚îÄ‚îÄ colors@1.1.2 
‚îú‚îÄ‚î¨ commander@2.9.0 
‚îÇ ‚îî‚îÄ‚îÄ graceful-readlink@1.0.1 
‚îú‚îÄ‚îÄ fibers@2.0.0 
‚îú‚îÄ‚î¨ fields@0.1.24 
‚îÇ ‚îú‚îÄ‚îÄ colors@0.6.2 
‚îÇ ‚îú‚îÄ‚îÄ keypress@0.2.1 
‚îÇ ‚îî‚îÄ‚îÄ sprintf@0.1.5 
‚îú‚îÄ‚î¨ program@0.1.0 
‚îÇ ‚îú‚îÄ‚îÄ async@0.2.10 
‚îÇ ‚îú‚îÄ‚îÄ ini@1.1.0 
‚îÇ ‚îî‚îÄ‚î¨ tilde-expansion@0.0.0 
‚îÇ   ‚îî‚îÄ‚î¨ etc-passwd@0.0.1 
‚îÇ     ‚îî‚îÄ‚îÄ lazylines@1.0.0 
‚îú‚îÄ‚îÄ semver@5.3.0 
‚îú‚îÄ‚îÄ validator@7.0.0 
‚îî‚îÄ‚îÄ wrench@1.5.9 

npm WARN Appcelerator-Framework@3.0.1 No repository field.
npm WARN Appcelerator-Framework@3.0.1 No license field.
npm ERR! Darwin 16.6.0
npm ERR! argv "/usr/local/bin/node" "/usr/local/bin/npm" "install"
npm ERR! node v6.10.2
npm ERR! npm  v3.10.10
npm ERR! code ELIFECYCLE

npm ERR! ffi@1.2.5 install: <code>node-gyp rebuild</code>
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the ffi@1.2.5 install script 'node-gyp rebuild'.
npm ERR! Make sure you have the latest version of node.js and npm installed.
npm ERR! If you do, this is most likely a problem with the ffi package,
npm ERR! not with npm itself.
npm ERR! Tell the author that this fails on your system:
npm ERR!     node-gyp rebuild
npm ERR! You can get information on how to open an issue for this project with:
npm ERR!     npm bugs ffi
npm ERR! Or if that isn't available, you can get their info via:
npm ERR!     npm owner ls ffi
npm ERR! There is likely additional logging output above.
</pre></code>
I am using Node 6.10.2 and npm 3.10.10.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2017-06-10

   The reason this is failing is because the <code>ffi</code> module apparently doesn't support Node.js 6.10.2. According to the <code>ffi</code> readme, it only supports 0.10 and older, however they do test Node.js 6.x in their Travis CI build: <a href="https://travis-ci.org/node-ffi/node-ffi/builds/226530385." rel="nofollow" target="_blank">https://travis-ci.org/node-ffi/node-ffi/builds/226530385.</a>
   
   I'll have to investigate more when I have some time. Stay tuned.</li>
<li>Chris Barber 2017-06-13

   I'm not sure which dependency is pulling in <code>ffi@1.2.5</code>, but <code>ffi@1.2.5</code> is 4 years old and does not support Node.js 6. This is likely due to aps_sdk depending on a no-longer-maintained packages.
   
   The aps_sdk iOS scripts need to be updated. There are at least 3 NPM dependencies that are no longer maintained and have compatibility problems with newer Node.js versions.
   
   Until the scripts can be fixed/updated, you should use Node.js 0.10 and NPM 2 to build aps_sdk.</li>
</ol>


<p><a href="/MOD/MOD-2339.json">JSON Source</a></p>