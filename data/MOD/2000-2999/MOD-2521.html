---
title: "[MOD-2521] Encrypted Database: Android: Add access to preKey and postKey hooks "
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Encrypted SQLite DB</td></tr>
<tr><th>Labels</th><td>android, encrypted_database, sqlite</td></tr>
<tr><th>Reporter</th><td>John V Pataki</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2019-05-22T21:19:37.000+0000</td></tr>
<tr><th>Updated</th><td>2019-05-28T19:19:18.000+0000</td></tr>
</table>

<h3>Description</h3>

The code base used in the Encrypted Database module is sqlcipher.

Currently the module relies on the java openOrCreateDatabase() method which passes in the key at the java level (not at the javascript level) wrapped up in the open() function called in javascript. This means you can't set any PRAGMAs just before or just after the key is set. There are valid reasons (I will articulate in another ticket an actual issue found) for why you may want to set a PRAGMA before or after the key is provided, but before the other operations (like the test against sqlite_master) in openOrCreateDatabase().

There exists already accepts these two hooks that can be called in the sqlcipher code for preKey() and postKey() and a construct for handling it as [SQLiteDatabaseHook](<a href="https://github.com/sqlcipher/android-database-sqlcipher/blob/master/android-database-sqlcipher/src/main/java/net/sqlcipher/database/SQLiteDatabaseHook.java)" rel="nofollow" target="_blank">https://github.com/sqlcipher/android-database-sqlcipher/blob/master/android-database-sqlcipher/src/main/java/net/sqlcipher/database/SQLiteDatabaseHook.java)</a>  and you can see in this method  [keyDatabase](<a href="https://github.com/sqlcipher/android-database-sqlcipher/blob/79bfeedaedfc5329e31c70a47666c9f7eaf20d87/android-database-sqlcipher/src/main/java/net/sqlcipher/database/SQLiteDatabase.java#L2633)" rel="nofollow" target="_blank">https://github.com/sqlcipher/android-database-sqlcipher/blob/79bfeedaedfc5329e31c70a47666c9f7eaf20d87/android-database-sqlcipher/src/main/java/net/sqlcipher/database/SQLiteDatabase.java#L2633)</a> the way those hooks are applied before and after the actual key "run" step.

This will open up the ability to perform operations before or after the key is provided within the open() function / openOrCreateDatabase() method.

<h3>Comments</h3>

<p>No comments</p>

<p><a href="/MOD/MOD-2521.json">JSON Source</a></p>