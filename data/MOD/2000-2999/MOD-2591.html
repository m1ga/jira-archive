---
title: "[MOD-2591] Android: Add properties "hmacAlgorithm" and "hmacKdfIterations" to encrypted DB module"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-04-15T01:35:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Encrypted SQLite DB</td></tr>
<tr><th>Labels</th><td>android, database, encrypted_database, encryption, hash, module, performance</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-04-04T03:39:21.000+0000</td></tr>
<tr><th>Updated</th><td>2020-04-22T17:36:47.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The "appcelerator.encrypteddatabase" module's default settings for its hashing algorithm has changed recently from <code>SHA1</code> to <code>SHA512</code>, with KDF iterations from <code>64000</code> to <code>256000</code>. While this has made it much more secure, it comes at the cost of performance.

On Android, the defaults changed in module v3.0.3.
On iOS, the defaults changed in module v2.0.6.

We should add new properties that allowing app developers to control these settings.
(ie: Sacrifice security for speed or sacrifice speed for security.)

*Requirements:*
Add the following constants to the module. These must be integer IDs.
* <code>HMAC_SHA1</code>
* <code>HMAC_SHA256</code>
* <code>HMAC_SHA512</code>

Add the following properties to the module.
* <code>hmacAlgorithm</code> - to be assigned one of the above constants. Defaults to <code>HMAC_SHA512</code>.
* <code>hmacKdfIterations</code> - to be assigned an integer. Defaults to <code>256000</code>. Min value is <code>4000</code>.

The above properties are "stateful" like the <code>password</code> property. Meaning that they affect the next time you call the <code>open()</code> method. When opening an existing database with different hmac settings above, then the module must auto-migrate it to use the module's current hmac settings.

*Usage Test:*
<code><pre>
var database = require("appcelerator.encrypteddatabase");
database.password = "password";

//database.hmacAlgorithm = database.HMAC_SHA1;
database.hmacAlgorithm = database.HMAC_SHA256;
//database.hmacAlgorithm = database.HMAC_SHA512;

database.hmacKdfIterations = 64000;
//database.hmacKdfIterations = 128000;
//database.hmacKdfIterations = 256000;

var openStartTime = new Date();
var dbConnection = database.open("test_encrypted.db");
Ti.API.info("@@@ DB open duration: " + (new Date() - openStartTime) + " ms");

dbConnection.execute("CREATE TABLE IF NOT EXISTS test(id integer PRIMARY KEY, name TEXT);");
dbConnection.execute("INSERT OR REPLACE INTO test(id, name) VALUES (?, ?)", 1, "Hello World");
dbConnection.close();
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/MOD/MOD-2591_67323/DatabaseEncryptMigrationTest.js">DatabaseEncryptMigrationTest.js</td></td><td>2020-04-06T19:24:02.000+0000</td><td>2388</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/MOD/MOD-2591_67326/DatabaseEncryptMigrationTest.png">DatabaseEncryptMigrationTest.png</td></td><td>2020-04-06T19:37:33.000+0000</td><td>157626</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-04-04

   PR (android): <a href="https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/48" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/48</a>
   </li>
<li>Joshua Quick 2020-04-06

   The attached  [^DatabaseEncryptMigrationTest.js] script can help test this change.
    !DatabaseEncryptMigrationTest.png|thumbnail! </li>
<li>Lokesh Choudhary 2020-04-15

   PR Merged.</li>
<li>Joshua Quick 2020-04-20

   Here is a back-port which will work with Titanium 7.0.0+. (Not built with gradle.)
   PR (android)(3_3_X): <a href="https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/50" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/50</a>
   </li>
<li>Joshua Quick 2020-04-21

   This updates the documented properties to the back-ported version.
   PR: <a href="https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/51" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/51</a></li>
<li>Lokesh Choudhary 2020-04-22

   Verified the improvements in 4.1.0 & backported 3.3.0 module .
   Closing.</li>
</ol>


<p><a href="/MOD/MOD-2591.json">JSON Source</a></p>