---
title: "[MOD-2593] iOS: Add properties "hmacAlgorithm" and "hmacKdfIterations" to encrypted DB module"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-04-22T17:34:28.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Encrypted SQLite DB</td></tr>
<tr><th>Labels</th><td>database, encrypted_database, encryption, hash, ios, module, performance</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2020-04-06T17:48:46.000+0000</td></tr>
<tr><th>Updated</th><td>2020-04-22T17:34:28.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The "appcelerator.encrypteddatabase" module's default settings for its hashing algorithm has changed recently from <code>SHA1</code> to <code>SHA512</code>, with KDF iterations from <code>64000</code> to <code>256000</code>. While this has made it much more secure, it comes at the cost of performance.

On Android, the defaults changed in module v3.0.3.
On iOS, the defaults changed in module v2.0.6.

We should add new properties that allowing app developers to control these settings.
(ie: Sacrifice security for speed or sacrifice speed for security.)

*Requirements:*
Add the following constants to the module. These must be integer IDs.
* <code>HMAC_SHA1</code>
* <code>HMAC_SHA256</code>
* <code>HMAC_SHA512</code>

Add the following properties to the module.
* <code>hmacAlgorithm</code> - to be assigned one of the above constants. Defaults to <code>HMAC_SHA512</code>.
* <code>hmacKdfIterations</code> - to be assigned an integer. Defaults to <code>256000</code>. Min value is <code>4000</code>.

The above properties are "stateful" like the <code>password</code> property. Meaning that they affect the next time you call the <code>open()</code> method. When opening an existing database with different hmac settings above, then the module must auto-migrate it to use the module's current hmac settings.

*Usage Test:*
<code><pre>
var database = require("appcelerator.encrypteddatabase");
database.password = "password";

//database.hmacAlgorithm = database.HMAC_SHA1;
database.hmacAlgorithm = database.HMAC_SHA256;
//database.hmacAlgorithm = database.HMAC_SHA512;

database.hmacKdfIterations = 64000;
//database.hmacKdfIterations = 128000;
//database.hmacKdfIterations = 256000;

var openStartTime = new Date();
var dbConnection = database.open("test_encrypted.db");
Ti.API.info("@@@ DB open duration: " + (new Date() - openStartTime) + " ms");

dbConnection.execute("CREATE TABLE IF NOT EXISTS test(id integer PRIMARY KEY, name TEXT);");
dbConnection.execute("INSERT OR REPLACE INTO test(id, name) VALUES (?, ?)", 1, "Hello World");
dbConnection.close();
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/MOD/MOD-2593_67324/DatabaseEncryptMigrationTest.js">DatabaseEncryptMigrationTest.js</td></td><td>2020-04-06T19:24:53.000+0000</td><td>2388</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/MOD/MOD-2593_67325/DatabaseEncryptMigrationTest.png">DatabaseEncryptMigrationTest.png</td></td><td>2020-04-06T19:34:11.000+0000</td><td>146724</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Vijay Singh 2020-04-06

   PR - <a href="https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/49" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/appcelerator.encrypteddatabase/pull/49</a></li>
<li>Joshua Quick 2020-04-06

   The attached  [^DatabaseEncryptMigrationTest.js] script can help test this change. Particularly for testing the migration of the database when changing the hashing algorithm settings on the next time you open it.
    !DatabaseEncryptMigrationTest.png|thumbnail! </li>
<li>Lokesh Choudhary 2020-04-22

   Works as expected. Checked with module 2.1.0. 
   Closing.</li>
</ol>


<p><a href="/MOD/MOD-2593.json">JSON Source</a></p>