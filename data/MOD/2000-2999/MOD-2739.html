---
title: "[MOD-2739] Identity: Authenticating multiple times on Android throws error"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-09-10T18:08:02.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Identity</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2020-08-19T13:19:38.000+0000</td></tr>
<tr><th>Updated</th><td>2021-07-12T23:47:16.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

When authenticating multiple times on Android the below error is thrown
<code><pre>
{
    error: 'Failed to encrypt the data with the generated key.',
    success: false
}
</pre></code>

Adding some further logging clarifies the error a little better

<code><pre>
FingerPrintHelper: (pool-4-thread-1) [25314,25397] java.lang.IllegalStateException: IV has already been used. Reusing IV in encryption mode violates security best practices.
</pre></code>

I applied the approach in <a href="https://github.com/appcelerator-modules/titanium-identity/pull/36" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/titanium-identity/pull/36</a> to the current module and that worked

<h4>Steps to reproduce</h4>

1. Build the module using <code>ti build -p android</code> 
2. Click the <code>Authenticate with: Touch ID</code> button and authenticate with your fingerprint
3. Click the <code>Authenticate with: Touch ID</code> button and authenticate with your fingerprint

<h4>Actual</h4>

On the second attempt an error occurs

<h4>Expected</h4>

Should be able to auth everytime

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2020-08-19

   I will fix up the linked PR to remove the merge conflicts</li>
<li>Ewan Harris 2020-08-19

   PR: <a href="https://github.com/appcelerator-modules/titanium-identity/pull/59" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/titanium-identity/pull/59</a></li>
<li>Lokesh Choudhary 2020-09-10

   FR Passed.
   PR Merged.</li>
<li>Lokesh Choudhary 2020-09-10

   We would need a PR to add this to the SDK in the future</li>
<li>Joshua Quick 2021-07-12

   PR (titanium_mobile): <a href="https://github.com/appcelerator/titanium_mobile/pull/12951" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12951</a>
   
   _(To be included in Titanium SDK 10.0.1.)_</li>
</ol>


<p><a href="/MOD/MOD-2739.json">JSON Source</a></p>