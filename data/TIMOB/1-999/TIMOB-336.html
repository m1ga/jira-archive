---
title: "[TIMOB-336] I met a problem ! who can help me?"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2011-04-15T02:27:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>struggermen</td></tr>
<tr><th>Assignee</th><td>Reggie Seagraves</td></tr>
<tr><th>Created</th><td>2011-04-15T02:27:27.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-09T21:13:56.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Hi,Donald Thorp<br>
In my develop programe,I want to use jni , use javah create .h
files</p>
<p>in my c files</p>
<h1>include "com_android_jnitest_jnitest.h"</h1>
<h1>include &lt;string.h&gt;</h1>
<p>JNIEXPORT jstring JNICALL
Java_com_android_jnitest_jnitest_fpathchange<br>
(JNIEnv *env,jobject obj,jstring filename){</p>
<p>//&#35843;&#29992; java &#31867; tiros_files &#20013;&#30340;
getPath() &#26041;&#27861;</p>
<pre>
<code>  jclass cls =(*env)-&gt;FindClass(env,"com/android/jnitest/tiros_files");

  // &#36825;&#37324;&#20256;&#36807;&#26469;&#19968;&#20010; private Context context = null Context 

  jmethodID cls_mid = (*env)-&gt;GetMethodID(env,cls,"tr_java_fpathchange","(Ljava/lang/String;)Ljava/lang/String;");

  jstring  str = (*env) -&gt;CallObjectMethod(env, cls , cls_mid ,"java/lang/String;" );

  return str;</code>
</pre>
<p>}</p>
<p>In my java programe</p>
<pre>
<code>public class jnitest extends Activity {

public String str = "my love is liping!" ;

public TextView tv = null ;

public Button  bt = null ;

private tiros_files tf = null;

/** Called when the activity is first created. */
@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);

    tv = (TextView)this.findViewById(R.id.t1);
    bt = (Button)this.findViewById(R.id.rb);

    bt.setOnClickListener(btlistener);


   tf = new tiros_files(this);

}

Button.OnClickListener  btlistener =new Button.OnClickListener(){

    @Override
    public void onClick(View v) {
        // TODO Auto-generated method stub

         tv.setText(""+fpathchange(str));

    }

};

static{

    System.loadLibrary("jnitest");

}

/**
 * 
 * @param filename &#25991;&#20214;&#21517;
 * @return &#25991;&#20214;&#36335;&#24452;
 */
public native String fpathchange(String filename);</code>
</pre>
<p>}</p>
<p>public class tiros_files {</p>
<pre>
<code>private Context context = null;

public tiros_files(Context cont){

    this.context = cont;

    Log.v("context", "init ok!");

}

//&#33719;&#21462;&#25991;&#20214;&#36335;&#24452;
public  String tr_java_fpathchange(String filename){

    Log.v("tr_java_fpathchange", "ok!");

    String filepath = null;

    boolean is =filename.contains("$");

    if(is){

        String substr = filename.substring(0, 2);

        if(substr.equals("fs0")){ //&#25163;&#26426;&#20869;&#37096; /data/data/packagename/files/filename

            String pakgename =context.getPackageName();

            filepath =Environment.getDataDirectory()+"/data/"+pakgename+"/files/"+filename;

        }
        else if(substr.equals("fs1")){ //  /sdcard/navidog/files/filename 


            filepath =Environment.getExternalStorageDirectory()+"/navidog/files/"+filename;
        }
        else{

            return "file path format is false";

        }
    }

    return filepath;
}</code>
</pre>
<p>}</p>
<p>Log cat :</p>
<p>01-11 06:03:49.617: INFO/DEBUG(547): Build fingerprint:
'generic/sdk/generic/:1.5/CUPCAKE/150240:eng/test-keys'<br>
01-11 06:03:49.626: INFO/DEBUG(547): pid: 6093, tid: 6093
&gt;&gt;&gt; com.android.jnitest &lt;&lt;&lt;<br>
01-11 06:03:49.626: INFO/DEBUG(547): signal 11 (SIGSEGV), fault
addr 000000ee<br>
01-11 06:03:49.638: INFO/DEBUG(547): r0 000000e4 r1 41049a98 r2
00000000 r3 43744ab8<br>
01-11 06:03:49.638: INFO/DEBUG(547): r4 41684dda r5 41049aa8 r6
bedbc5e0 r7 ad00e540<br>
01-11 06:03:49.648: INFO/DEBUG(547): r8 000053f8 r9 00000000 10
41049a84 fp 00000000<br>
01-11 06:03:49.648: INFO/DEBUG(547): ip 00000006 sp bedbc5a0 lr
ad01236c pc ad013084 cpsr 00000010<br>
01-11 06:03:49.748: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/00" title="Ticket #00">#00</a> pc 00013084
/system/lib/libdvm.so<br>
01-11 06:03:49.757: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/01" title="Ticket #01">#01</a> pc 00017b1c
/system/lib/libdvm.so<br>
01-11 06:03:49.766: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/02" title="Ticket #02">#02</a> pc 00017560
/system/lib/libdvm.so<br>
01-11 06:03:49.779: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/03" title="Ticket #03">#03</a> pc 00052268
/system/lib/libdvm.so<br>
01-11 06:03:49.787: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/04" title="Ticket #04">#04</a> pc 000596ee
/system/lib/libdvm.so<br>
01-11 06:03:49.796: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/05" title="Ticket #05">#05</a> pc 00013118
/system/lib/libdvm.so<br>
01-11 06:03:49.808: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/06" title="Ticket #06">#06</a> pc 00017b1c
/system/lib/libdvm.so<br>
01-11 06:03:49.818: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/07" title="Ticket #07">#07</a> pc 00017560
/system/lib/libdvm.so<br>
01-11 06:03:49.827: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/08" title="Ticket #08">#08</a> pc 000520ec
/system/lib/libdvm.so<br>
01-11 06:03:49.836: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/09" title="Ticket #09">#09</a> pc 0003f0f8
/system/lib/libdvm.so<br>
01-11 06:03:49.836: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/10" title="Ticket #10">#10</a> pc 00031ac2
/system/lib/libdvm.so<br>
01-11 06:03:49.848: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/11" title="Ticket #11">#11</a> pc 00028280
/system/lib/libandroid_runtime.so<br>
01-11 06:03:49.857: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/12" title="Ticket #12">#12</a> pc 00028d7e
/system/lib/libandroid_runtime.so<br>
01-11 06:03:49.867: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/13" title="Ticket #13">#13</a> pc 00008bf2
/system/bin/app_process<br>
01-11 06:03:49.867: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/14" title="Ticket #14">#14</a> pc 0001fd22
/system/lib/libc.so<br>
01-11 06:03:49.876: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/15" title="Ticket #15">#15</a> pc 0000bcb2
/system/lib/libc.so<br>
01-11 06:03:49.888: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/16" title="Ticket #16">#16</a> pc b000157e
/system/bin/linker<br>
01-11 06:03:49.907: INFO/DEBUG(547): stack:<br>
01-11 06:03:49.918: INFO/DEBUG(547): bedbc560 00000000<br>
01-11 06:03:49.918: INFO/DEBUG(547): bedbc564 ad058c5b
/system/lib/libdvm.so<br>
01-11 06:03:49.918: INFO/DEBUG(547): bedbc568 00000002<br>
01-11 06:03:49.918: INFO/DEBUG(547): bedbc56c 4000ca60<br>
01-11 06:03:49.918: INFO/DEBUG(547): bedbc570 ad083e10<br>
01-11 06:03:49.927: INFO/DEBUG(547): bedbc574 00000000<br>
01-11 06:03:49.927: INFO/DEBUG(547): bedbc578 00000000<br>
01-11 06:03:49.938: INFO/DEBUG(547): bedbc57c 00000000<br>
01-11 06:03:49.938: INFO/DEBUG(547): bedbc580 afe0d920
/system/lib/libc.so<br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc584 bedbc5e0 <a href=
"/projects/32238/changesets/stack" title=
"Changeset [stack]">[stack]</a><br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc588 ad00e540
/system/lib/libdvm.so<br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc58c 41684bbe<br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc590 41049a7c<br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc594 bedbc5e0 <a href=
"/projects/32238/changesets/stack" title=
"Changeset [stack]">[stack]</a><br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc598 df002777<br>
01-11 06:03:49.948: INFO/DEBUG(547): bedbc59c e3a070ad<br>
01-11 06:03:49.967: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/00" title="Ticket #00">#00</a> bedbc5a0
43731360<br>
01-11 06:03:49.967: INFO/DEBUG(547): bedbc5a4 41048200<br>
01-11 06:03:49.977: INFO/DEBUG(547): bedbc5a8 bedbc5e0 <a href=
"/projects/32238/changesets/stack" title=
"Changeset [stack]">[stack]</a><br>
01-11 06:03:49.987: INFO/DEBUG(547): bedbc5ac ad017ac4
/system/lib/libdvm.so<br>
01-11 06:03:49.987: INFO/DEBUG(547): bedbc5b0 00000328<br>
01-11 06:03:49.997: INFO/DEBUG(547): bedbc5b4 bedbc668 <a href=
"/projects/32238/changesets/stack" title=
"Changeset [stack]">[stack]</a><br>
01-11 06:03:49.997: INFO/DEBUG(547): bedbc5b8 0000bc60 <a href=
"/projects/32238/changesets/heap" title=
"Changeset [heap]">[heap]</a><br>
01-11 06:03:49.997: INFO/DEBUG(547): bedbc5bc 41049f04<br>
01-11 06:03:49.997: INFO/DEBUG(547): bedbc5c0 00000000<br>
01-11 06:03:49.997: INFO/DEBUG(547): bedbc5c4 ad017b20
/system/lib/libdvm.so<br>
01-11 06:03:49.997: INFO/DEBUG(547): <a href=
"/projects/32238/tickets/01" title="Ticket #01">#01</a> bedbc5c8
400307a0<br>
01-11 06:03:49.997: INFO/DEBUG(547): bedbc5cc 00000001<br>
01-11 06:03:50.006: INFO/DEBUG(547): bedbc5d0 0000bc60 <a href=
"/projects/32238/changesets/heap" title=
"Changeset [heap]">[heap]</a><br>
01-11 06:03:50.006: INFO/DEBUG(547): bedbc5d4 ad017564
/system/lib/libdvm.so<br>
01-11 06:03:50.487: DEBUG/dalvikvm(617): GC freed 9285 objects /
524376 bytes in 356ms<br>
01-11 06:03:51.357: INFO/ActivityManager(577): Process
com.android.jnitest (pid 6093) has died.<br>
01-11 06:03:51.376: INFO/WindowManager(577): WIN DEATH:
Window{43716278 com.android.jnitest/com.android.jnitest.jnitest
paused=false}<br>
01-11 06:03:51.598: WARN/InputManagerService(577): Got
RemoteException sending setActive(false) notification to pid 6093
uid 10034<br>
01-11 06:03:51.637: DEBUG/Zygote(549): Process 6093 terminated by
signal (11)<br>
01-11 06:19:23.288: DEBUG/dalvikvm(617): GC freed 9272 objects /
524192 bytes in 132ms</p></div>

<h3>Comments</h3>

<ol>
<li>Thomas Huelbert 2011-04-15

   <div><p>housecleaning old bugs</p></div></li>
<li>Lee Morris 2017-03-09

   Closing ticket as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-336.json">JSON Source</a></p>