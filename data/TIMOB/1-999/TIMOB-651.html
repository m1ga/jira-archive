---
title: "[TIMOB-651] Audio Player crash"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:53:48.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.2.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Nolan Wright</td></tr>
<tr><th>Assignee</th><td>Blain Hamon</td></tr>
<tr><th>Created</th><td>2011-04-15T02:33:46.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:53:48.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>get this</p>
<p>2010-03-26 11:46:28.667 TwitterUI[51108:530b] *** Terminating
app due to uncaught exception 'NSInternalInconsistencyException',
reason: 'stopAudioSession called too many times'</p>
<p>seems to be a problem with the guard.</p>
<p>run attached app (click button on page1, then click row on table
view, close modal, repeat -&gt; crash)</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-651_17877/archive.zip">archive.zip</td></td><td>2011-04-15T02:33:47.000+0000</td><td>10898</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Stephen Tramer 2011-04-15

   <div><p>Claimed from Blain. My previous description of the bug was
   erroneous.</p></div></li>
<li>Stephen Tramer 2011-04-15

   <div><p>This appears to be a much more serious issue. Stack traces
   indicate the following:</p>
   <p>Creation: (count = 1)<br>
   0: -[TiMediaAudioSession startAudioSession]<br>
   1: -[TiMediaAudioPlayerProxy <em>initWithProperties:]<br>
   2: -[TiProxy</em> initWithPageContext:args:]<br>
   3: -[TiModule createProxy:forName:context:]</p>
   <p>With the following when the tab (NOT the modal window!) are
   closed:</p>
   <p>Destruction:</p>
   <p>Once for context destruction: (count = 0)<br>
   1: -[TiMediaAudioSession stopAudioSession]<br>
   2: -[TiMediaAudioPlayerProxy _destroy]<br>
   3: -[TiProxy contextShutdown:]</p>
   <p>And once for the proxy destruction: (count = -1)</p>
   <p>1: -[TiMediaAudioSession stopAudioSession]<br>
   2: -[TiMediaAudioPlayerProxy _destroy]<br>
   3: -[TiProxy dealloc]</p>
   <p>The solution is to perform a sanity check on (count), but please
   be aware of the larger issue: All <em>destroy functions MUST
   RELEASE_TO_NIL() all variables and/or perform operations which are
   guaranteed to have NO side-effects in other classes (in this case,
   TiMediaAudioPlayerProxy calls a function with a side-effect in
   another class: TiMediaAudioSession.) If they must call functions
   with side-effects, there should be a 'BOOL destroyed' variable
   which tracks whether or not the object has already been destroyed.
   (ED'S NOTE: Calling [super</em> destroy] in the appropriate place
   handles this already; ignore my advice.)</p>
   <p>Strongly recommend that this variable (and a sanity check
   associated with it) be added to TiProxy.</p></div></li>
<li>Stephen Tramer 2011-04-15

   <div><p>Well I'll be - there's already this variable (and an associated
   sanity check!) in _destroy for TiProxy.</p>
   <p>The problem was that [super _destroy] was not called. Fixed.</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/31b5596dc6480e8f6e753a48949505706e7a2f2a"
   title=
   "Changeset [31b5596dc6480e8f6e753a48949505706e7a2f2a]">[31b5596dc6480e8f6e753a48949505706e7a2f2a]</a>)
   Closes <a href="/projects/32238/tickets/651" title=
   "Ticket #651">#651</a> - Didn't call [super _destroy]. <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/31b5596dc6480e8f6e753a48949505706e7a2f2a" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/31b5596dc6480e8f6e753a48949505706e7a2f2a</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/31b5596dc6480..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/31b5596dc6480...</a></a></p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-651.json">JSON Source</a></p>