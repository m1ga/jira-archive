---
title: "[TIMOB-896] Android: Map addAnnotation throws NPE"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:54:35.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0 M05</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect</td></tr>
<tr><th>Reporter</th><td>Don Thorp</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T02:38:44.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:54:35.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>There are several places in ViewProxy.java (the map ViewProxy)
that refer to the variable (field) named "view". That thing is
never ever set anywhere. It's always null. The Atlanta KS test
works because the annotations are passed at the time of createView
and not added later.</p></div>

<h3>Comments</h3>

<ol>
<li>Joshua 2011-04-15

   <div><p>Is there a work around for this? I have a map where users can
   filter the type of venue's they can see on the map, but that
   requires the map to remove current annotations and add new ones.
   This currently doesn't work on android.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>I'm "in the code" anyway looking at <a href=
   "/projects/32238/tickets/2154" title="Ticket #2154">#2154</a>, so
   I'll have a look at this today.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Failcase app.js (don't worry about the UI, just run this as your
   app.js):</p>
   <pre>
   <code class=
   "javascript">var dawson = Titanium.Map.createAnnotation({
       latitude:48.199678,
       longitude:16.395807,
       title:"Dawsonhaus"
   });
   
   var regionDefault = {latitude:48.199678,longitude:16.4,animate:true,latitudeDelta:0.04, longitudeDelta:0.04};
   
   var mapview = Titanium.Map.createView({
       mapType: Titanium.Map.STANDARD_TYPE,
       region:regionDefault,
       regionFit:true,
       top: 50, left: 0, right: 0, bottom: 0,
       userLocation:true
   });
   
   mapview.addAnnotation(dawson);</code>
   </pre></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/7b2cd40ce89729fa4cd7bca5a3697ecd6d97e534"
   title=
   "Changeset [7b2cd40ce89729fa4cd7bca5a3697ecd6d97e534]">[7b2cd40ce89729fa4cd7bca5a3697ecd6d97e534]</a>)
   [<a href="/projects/32238/tickets/896" title="Ticket #896">#896</a>
   status:fixed-in-qa] use peekView() and null checks to avoid NPEs
   when trying to set TiMapView properties or call methods <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/7b2cd40ce89729fa4cd7bca5a3697ecd6d97e534" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/7b2cd40ce89729fa4cd7bca5a3697ecd6d97e534</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/7b2cd40ce897..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/7b2cd40ce897...</a></a></p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Added <a href="/projects/32238/tickets/2546" title=
   "Ticket #2546">#2546</a> for a bigger issue, namely that
   pre-view-creation anything done with <code>.addAnnotation</code>
   and <code>.removeAnnotation</code> (and maybe other stuff) is
   ignored.</p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p><a href="/projects/32238/changesets/INFO" title=
   "Changeset [INFO]">[INFO]</a> Titanium SDK version: 1.5.0 (12/10/10
   09:14 0c31e15) using provided sample. need to add it to
   bugtests</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-896.json">JSON Source</a></p>