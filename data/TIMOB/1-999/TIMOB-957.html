---
title: "[TIMOB-957] Removing annotations from MapView breaks map evens"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:54:47.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.4.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>annotations, maps, mapview</td></tr>
<tr><th>Reporter</th><td>Gavin Joyce</td></tr>
<tr><th>Assignee</th><td>Reggie Seagraves</td></tr>
<tr><th>Created</th><td>2011-04-15T02:40:14.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:54:47.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Hi,</p>
<p>I've outlined the issue on Q&amp;A: <a href=
"<a href="http://developer.appcelerator.com/question/26471/mapview-click-event-does-not-fire-after-changing-annotations" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/26471/mapview-click-event-does-not-fire-after-changing-annotations</a>">
<a href="http://developer.appcelerator.com/question/26471/mapview-click-even..." rel="nofollow" target="_blank">http://developer.appcelerator.com/question/26471/mapview-click-even...</a></a>.</p>
<p>Calling mapview.removeAnnotations seems to break the mapview
'click' event listener.</p>
<p>The following reproduces the issue:</p>
<pre>
<code class="javascript">//create two sets of pins
var pins1 = [
  Titanium.Map.createAnnotation({ latitude:37.390749, longitude:-122.081651, title:"pins1: A" }),
  Titanium.Map.createAnnotation({ latitude:37.74511, longitude:-84.38993, title:"pins1: B" }),
];
 
var pins2 = [
  Titanium.Map.createAnnotation({ latitude:37.390749, longitude:-122.081651, title:"pins2: A" }),
  Titanium.Map.createAnnotation({ latitude:37.74511, longitude:-84.38993, title:"pins2: B" }),
];
 
var mapview = Titanium.Map.createView({
    mapType: Titanium.Map.STANDARD_TYPE,
    animate:true,
    userLocation:false,
    annotations:pins1 //the initial setup, both pins will handle click events correctly
});
mapview.addEventListener('click', function(e) {
  Ti.API.log('- mapview click event : ' + e.clicksource);
});
Ti.UI.currentWindow.add(mapview);
 
 
//add a button to change the pins
var changePins = Titanium.UI.createButton({
    title:'change pins',
    style:Titanium.UI.iPhone.SystemButtonStyle.BORDERED
});
 
changePins.addEventListener('click',function() {
  //removing the initial pins and adding the seconds set - the second pind does not fire the clicked event 
    mapview.removeAnnotations(pins1);
    mapview.addAnnotations(pins2);
});
 
Ti.UI.currentWindow.setToolbar([changePins]);</code>
</pre></div>

<h3>Comments</h3>

<ol>
<li>Stephen Tramer 2011-04-15

   <div><p>Works for me. I'll need confirmation from a second source to
   mark the bug as invalid - either this was fixed in 1.3.0 or as part
   of another event handling bug.</p></div></li>
<li>Gavin Joyce 2011-04-15

   <div><p>I've rechecked checked this on SDK 1.3.0 on my dev machine and
   the issue is present.</p>
   <p>I'm going to install a clean titanium on another mac and try
   there. I'll keep you posted.</p></div></li>
<li>Gavin Joyce 2011-04-15

   <div><p>I've just confirmed the bug in 1.3.0 on a clean install of
   Titanium.</p>
   <p>Just to be clear, here is what I'm seeing:</p>
   <p>On initial load, clicking the first pin results in two click
   events. Clicking on subsequent pins results in single click events.
   After clicking the 'change pins' button, only one pin raises click
   events. The second pin doesn't raise any events.</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/3328be99875f5468f4c6fae0dd9a4358d63ac0bb"
   title=
   "Changeset [3328be99875f5468f4c6fae0dd9a4358d63ac0bb]">[3328be99875f5468f4c6fae0dd9a4358d63ac0bb]</a>)
   Closes <a href="/projects/32238/tickets/957" title=
   "Ticket #957">#957</a>: Annotations now need refresh on creation.
   <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/3328be99875f5468f4c6fae0dd9a4358d63ac0bb" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/3328be99875f5468f4c6fae0dd9a4358d63ac0bb</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/3328be99875f5..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/3328be99875f5...</a></a></p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-957.json">JSON Source</a></p>