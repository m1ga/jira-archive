---
title: "[TIMOB-1327] setRequestHeader -> \"If-Modified-Since\""
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2017-06-05T20:15:44.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, base64encode, defect, if-modified-since, setrequestheader</td></tr>
<tr><th>Reporter</th><td>marco.schierhorn (at gmail)</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2011-04-15T02:49:29.000+0000</td></tr>
<tr><th>Updated</th><td>2017-06-05T20:15:44.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>I cant use setRequestHeader with "If-Modified-Since" to get back
at 304 Status.<br>
I want to use this for storing images and xml files on the
device.<br>
And everytime the xml or the image is requested by the application
it should check<br>
if a newer version is found on the server.<br>
Im sending the date "Mon, 19 Jul 2010 11:20:22 GMT"<br>
And im receiving the date "Mon, 19 Jul 2010 10:20:17 GMT" from the
server.<br>
Usually it should work and return a 304 status.</p>
<pre>
<code>
if (Titanium.Network.online)
{
      var c = Titanium.Network.createHTTPClient();
      if (c.status == 304)
      {
        // XML File not necessary - Clientlog File is newer
        console.log('Use Client XML File - is newer than the server XML');
        fn_end(file_obj);
        return;
      }
      // ...here will follow some code to store the files on the device

      c.open('GET', url);
      c.setRequestHeader("If-Modified-Since", "Mon, 19 Jul 2010 11:20:22 GMT");
      c.send();
}</code>
</pre></div>

<h3>Comments</h3>

<ol>
<li>Don Thorp 2011-04-15

   <div><p>What platform(s) are you reporting the issue on?</p></div></li>
<li>marco.schierhorn (at gmail) 2011-04-15

   <div><p>Hey Don,</p>
   <p>thanks for the response.<br>
   Im reporting this issue on Android using Titanium SDK 1.3.0 and
   Android SDK 2.1.<br>
   Currently im only testing it on the SDK/Emulator and not on a real
   phone.</p></div></li>
<li>Robby 2011-04-15

   <div><p>Since this ticket has the attention of the devs, it looks like
   setRequestHeader is broken under SDK 1.4.0 with iOS as well. I am
   having problems setting it with basically the same code as used
   above:</p>
   <pre>
   <code class="javascript">var myUsername = 'testuser';
   var myPassword = 'testpass';
   
   var request = Titanium.Network.createHTTPClient({
           onload:function(e) {
               if (request.status != 200 &amp;&amp; request.status != 201) {
                   request.onerror(e);
                   return;
               }
           },
           onerror:function(e) {
               Ti.API.info("Got Error: "
                   + e.error);
           }
       });
   
   request.open('GET', 'https://myserverurl', true);
   request.setRequestHeader('Authorization','Basic '  + Titanium.Utils.base64encode(myUsername + ':' + myPassword));
   request.send();</code>
   </pre>
   <p>On the server side (Google App engine), I examine the headers
   and see that 'Authorization' isn't set. I get the same results for
   'PUT' and 'POST' as well (header not set). This happens with the
   iPhone simulator (iOS SDK 4.0.1). About to try it out on hardware
   now...</p>
   <p>I've looked at the ObjC source of it...looks very
   straightforward. Perhaps it is a scoping issue?</p>
   <p>Since the original author had an Android issue, I can create a
   new ticket for this if necessary.</p>
   <p>Robby</p></div></li>
<li>Jacob Avlund 2011-04-15

   <div><p>It appears that the problem has to do with setRequestHeader
   silently failing if there's a line break in the value parameter -
   which there will be in regular use of base64encode.</p>
   <p>My suggestion is to:</p>
   <p>a) make it possible to call base64encode with a parameter to get
   a result without line breaks (which otherwise will occur for large
   strings)<br>
   b) log an error message if the setRequestHeader function is called
   with a string with line breaks (or just remove the line breaks from
   the string)</p>
   <p>I described the error and a workaround in greater detail here:
   <a href=
   "<a href="http://developer.appcelerator.com/question/102491/bug-discovered-base64-line-breaks#182241" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/102491/bug-discovered-base64-line-breaks#182241</a>">
   <a href="http://developer.appcelerator.com/question/102491/bug-discovered-ba..." rel="nofollow" target="_blank">http://developer.appcelerator.com/question/102491/bug-discovered-ba...</a></a>
   , since I was too daft to find this Lighthouse site on my own.</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1327.json">JSON Source</a></p>