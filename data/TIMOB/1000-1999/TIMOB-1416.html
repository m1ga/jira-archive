---
title: "[TIMOB-1416] zIndex View Issue: Property changes, but is not visible until removing and re-adding the view."
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:56:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.6.0 M07</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios, order, release-1.6.0, view, zindex</td></tr>
<tr><th>Reporter</th><td>Fred Spencer</td></tr>
<tr><th>Assignee</th><td>Reggie Seagraves</td></tr>
<tr><th>Created</th><td>2011-04-15T02:51:46.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:56:07.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>The following is a quick drag and drop case. You can make this
work by removing and re-adding the view, but then you have to
untouch and retouch the object. That part is not in this code, but
should be enough to demonstrate the issue. Please see code
comments.</p>
<p>I have a workaround for this, but the performance is pretty
terrible on device (iPad), using extra views.</p>
<pre>
<code>var win = Ti.UI.createWindow();
var v01 = Ti.UI.createView({ name:"v01", width:100, height:100, left:0, backgroundColor:"#f00", zIndex:0 });
var v02 = Ti.UI.createView({ name:"v02", width:100, height:100, right:0, backgroundColor:"#0f0", zIndex:0 });
var vCont = Ti.UI.createView({ width:200, height:100, backgroundColor:"#00f" });

win.open(); win.add(vCont); vCont.add(v01); vCont.add(v02);

function dropView(e) {
    e.source.addEventListener("touchstart", selectView);
    e.source.removeEventListener("touchmove", moveView);
    e.source.removeEventListener("touchend", dropView);
    e.source.zIndex = 0;
}

function moveView(e) {
    // un-comment the next two lines to see it working
    // vCont.remove(e.source); vCont.add(e.source);
    // e.source.width = 150;
    
    // comment the next line, if un-commenting the top two
    e.source.center = {x:e.x + e.source.animatedCenter.x - e.source.width / 2};
}

function selectView(e) {
    e.source.zIndex = 1;
    Ti.API.info("Evt Source: " + e.source.zIndex);
    Ti.API.info(v01.name + " zIndex: " + v01.zIndex);
    Ti.API.info(v01.name + " zIndex: " + v02.zIndex);
    e.source.removeEventListener("touchstart", moveView);
    e.source.addEventListener("touchmove", moveView);
    e.source.addEventListener("touchend", dropView);
}


v01.addEventListener("touchstart", selectView);
v02.addEventListener("touchstart", selectView);</code>
</pre></div>

<h3>Comments</h3>

<ol>
<li>Jean-Etienne LaVallee 2011-04-15

   <div><p>See issue 775:</p>
   <p><a href=
   "<a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/775" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/775</a>">
   <a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobi..." rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobi...</a></a></p>
   <p>Neat trick with the view bouncing, tho, not a particularly nice
   solution.</p></div></li>
<li>Jean-Etienne LaVallee 2011-04-15

   <div><p>FYI, is this a dupe?</p>
   <p><a href=
   "<a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/1416" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/1416</a>">
   <a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobi..." rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobi...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/48efc48d8a2d072fbe5347247fb3748a809cc582"
   title=
   "Changeset [48efc48d8a2d072fbe5347247fb3748a809cc582]">[48efc48d8a2d072fbe5347247fb3748a809cc582]</a>)
   [<a href="/projects/32238/tickets/775" title="Ticket #775">#775</a>
   status:fixed-in-qa] [<a href="/projects/32238/tickets/1426" title=
   "Ticket #1426">#1426</a> status:fixed-in-qa] [<a href=
   "/projects/32238/tickets/1416" title="Ticket #1416">#1416</a>
   status:fixed-in-qa] zIndex sorting must happen in the parent of the
   view whose zIndex changed. <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/48efc48d8a2d072fbe5347247fb3748a809cc582" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/48efc48d8a2d072fbe5347247fb3748a809cc582</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/48efc48d8a2d0..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/48efc48d8a2d0...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/6a5a8a1cd4fe1e05fbfcfb076d3a1bdb9238d27b"
   title=
   "Changeset [6a5a8a1cd4fe1e05fbfcfb076d3a1bdb9238d27b]">[6a5a8a1cd4fe1e05fbfcfb076d3a1bdb9238d27b]</a>)
   [<a href="/projects/32238/tickets/775" title="Ticket #775">#775</a>
   status:fixed-in-qa] [<a href="/projects/32238/tickets/1426" title=
   "Ticket #1426">#1426</a> status:fixed-in-qa] [<a href=
   "/projects/32238/tickets/1416" title="Ticket #1416">#1416</a>
   status:fixed-in-qa] zIndex sorting must happen in the parent of the
   view whose zIndex changed. <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/6a5a8a1cd4fe1e05fbfcfb076d3a1bdb9238d27b" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/6a5a8a1cd4fe1e05fbfcfb076d3a1bdb9238d27b</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/6a5a8a1cd4fe1..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/6a5a8a1cd4fe1...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/483124c7082e31db4e80b3de4739f7eeb703da27"
   title=
   "Changeset [483124c7082e31db4e80b3de4739f7eeb703da27]">[483124c7082e31db4e80b3de4739f7eeb703da27]</a>)
   [<a href="/projects/32238/tickets/2183" title=
   "Ticket #2183">#2183</a> state:fixed-in-qa] [<a href=
   "/projects/32238/tickets/775" title="Ticket #775">#775</a>
   state:fixed-in-qa] [<a href="/projects/32238/tickets/2092" title=
   "Ticket #2092">#2092</a> state:fixed-in-qa] [<a href=
   "/projects/32238/tickets/1426" title="Ticket #1426">#1426</a>
   state:fixed-in-qa] [<a href="/projects/32238/tickets/1416" title=
   "Ticket #1416">#1416</a> state:fixed-in-qa] This time, zIndex is
   fixed for sure! Really now! Honest! <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/483124c7082e31db4e80b3de4739f7eeb703da27" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/483124c7082e31db4e80b3de4739f7eeb703da27</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/483124c7082e3..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/483124c7082e3...</a></a></p></div></li>
<li>Blain Hamon 2011-04-15

   <div><p>Mea culpa. This is because setZIndex is expecting an int, but we
   pass an object. The workaround is to do view.animate({zIndex:});
   which does a different code path.</p>
   <p>The fix will be in KrollObject.m, lines 793:</p>
   <pre>
   <code>    selector = NSSelectorFromString([NSString stringWithFormat:@"set%@:",name]);
       if ([target respondsToSelector:selector])
       {
           [target performSelector:selector withObject:value];
       }
       else 
       {
           [target setValue:value forKey:key];
       }</code>
   </pre>
   <p>Replace with [target setValue:value forKey:key];, since it will
   check for setFoo anyways, and faster. Since we're so close to
   1.5.0, pushing to 1.5.1.</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/97ef54ba316f4b52d6e9aecb50977d4561d87c89"
   title=
   "Changeset [97ef54ba316f4b52d6e9aecb50977d4561d87c89]">[97ef54ba316f4b52d6e9aecb50977d4561d87c89]</a>)
   [<a href="/projects/32238/tickets/1416" title=
   "Ticket #1416">#1416</a> state:fixed-in-qa] checking for setFoo was
   redundant and didn't account for non-object arguments <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/97ef54ba316f4b52d6e9aecb50977d4561d87c89" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/97ef54ba316f4b52d6e9aecb50977d4561d87c89</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/97ef54ba316f..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/97ef54ba316f...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/e8a8ee647699f2ab443583a300b0da3eabb5d863"
   title=
   "Changeset [e8a8ee647699f2ab443583a300b0da3eabb5d863]">[e8a8ee647699f2ab443583a300b0da3eabb5d863]</a>)
   Revert "[<a href="/projects/32238/tickets/1416" title=
   "Ticket #1416">#1416</a> state:fixed-in-qa] checking for setFoo was
   redundant and didn't account for non-object arguments"</p>
   <p>This reverts commit
   97ef54ba316f4b52d6e9aecb50977d4561d87c89.<br>
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/e8a8ee647699f2ab443583a300b0da3eabb5d863" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e8a8ee647699f2ab443583a300b0da3eabb5d863</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/e8a8ee647699..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e8a8ee647699...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/c4cca8b8dc8b30af5883ecce20e328fd830b1f2e"
   title=
   "Changeset [c4cca8b8dc8b30af5883ecce20e328fd830b1f2e]">[c4cca8b8dc8b30af5883ecce20e328fd830b1f2e]</a>)
   Revert "Revert "[<a href="/projects/32238/tickets/1416" title=
   "Ticket #1416">#1416</a> state:fixed-in-qa] checking for setFoo was
   redundant and didn't account for non-object arguments""</p>
   <p>This reverts commit
   e8a8ee647699f2ab443583a300b0da3eabb5d863.<br>
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/c4cca8b8dc8b30af5883ecce20e328fd830b1f2e" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/c4cca8b8dc8b30af5883ecce20e328fd830b1f2e</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/c4cca8b8dc8b..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/c4cca8b8dc8b...</a></a></p></div></li>
<li>Blain Hamon 2011-04-15

    <div><p>Fix moved from master. It's still open again.</p></div></li>
<li>Jeff Haynie 2011-04-15

    <div><p>(from <a href=
    "/projects/32238/changesets/a418c7495fa816675b62f2b2580da0e61ce3840b"
    title=
    "Changeset [a418c7495fa816675b62f2b2580da0e61ce3840b]">[a418c7495fa816675b62f2b2580da0e61ce3840b]</a>)
    [<a href="/projects/32238/tickets/1416" title=
    "Ticket #1416">#1416</a> state:fixed-in-qa] Ensuring that zIndex is
    setValue:forKey:ed. <a href=
    "<a href="https://github.com/appcelerator/titanium_mobile/commit/a418c7495fa816675b62f2b2580da0e61ce3840b" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a418c7495fa816675b62f2b2580da0e61ce3840b</a>">
    <a href="https://github.com/appcelerator/titanium_mobile/commit/a418c7495fa8..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a418c7495fa8...</a></a></p></div></li>
<li>Ralf Pfeiffer 2011-04-15

    <div><p>Test is put into Integrity. Unclear on the behavior expected and
    how to validate fix.</p></div></li>
<li>Stephen Tramer 2011-04-15

    <div><p>Tested simulator 4.2.1 release, iPod 3GT 4.2.1 release. Behavior
    is as expected.</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1416.json">JSON Source</a></p>