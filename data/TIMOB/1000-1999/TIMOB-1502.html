---
title: "[TIMOB-1502] HTTPClient: problems with header parsing and responseData in onerror handler"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:56:20.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0 M04</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>getresponseheader, httpclient, ios, iphone, responsedata</td></tr>
<tr><th>Reporter</th><td>Robby</td></tr>
<tr><th>Assignee</th><td>Reggie Seagraves</td></tr>
<tr><th>Created</th><td>2011-04-15T02:54:30.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:56:20.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Using SDK 1.4.0 release. I have a site that gives back a token
in both the header (and as the body) of a HTTP 401 (auth required)
response. For the life of me, I can't get HTTPClient to be able to
get anything but NULL out of this.responseData/this.responseText.
Also, this.getResponseHeader() for my custom header always shows up
as NULL. If I change the returned code to 200 (OK), then I can get
the responseText/responseData result no problem, but still can't
parse my custom X-GUID response header.</p>
<p>So what I'm trying to say is that I may be running into two
separate problems here:</p>
<ol>
<li>
<p>getResponseHeader doesn't appear to work properly on error
(4xx/5xx) OR valid (2xx) responses: One user in the Q&amp;A section
thinks it's because only the first header is being retrieved:<br>
<a href=
"<a href="http://developer.appcelerator.com/question/49401/cookies-problem" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/49401/cookies-problem</a>"><a href="http://developer.appcelerator.com/question/49401/cookies-problem" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/49401/cookies-problem</a></a></p>
</li>
<li>
<p>responseData/responseText is not populated on error responses
(onerror callback handler), even if there is data in the response
body. More info on this at: <a href=
"<a href="http://developer.appcelerator.com/question/50501/problem-getting-responsetextheaders-from-error-response" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/50501/problem-getting-responsetextheaders-from-error-response</a>">
<a href="http://developer.appcelerator.com/question/50501/problem-getting-re..." rel="nofollow" target="_blank">http://developer.appcelerator.com/question/50501/problem-getting-re...</a></a></p>
</li>
<li>
<p>having HTTP auth problems with basic HTTP (but that may be
already fixed going into 1.5.0, so I'll make another bug if that
appears to be the case)</p>
</li>
</ol>
<p>All in all, unless I'm being stupid here, it appears that
HTTPClient is pretty broken for all but the most basic usecases in
this 1.4.0 release. :/</p></div>

<h3>Comments</h3>

<ol>
<li>Brion Vibber 2011-04-15

   <div><p>The getResponseHeader bit is covered in <a href=
   "/projects/32238/tickets/519" title="Ticket #519">#519</a> but
   hasn't been fixed yet: <a href=
   "<a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/519-problem-with-this-in-callbacks-for-xhr" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/519-problem-with-this-in-callbacks-for-xhr</a>">
   <a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobi..." rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobi...</a></a></p>
   <p>This is hitting us for StatusNet Mobile; we need to be able to
   check the content-type so we don't try to parse XML on non-XML
   fetches (and thus explode), and it's a bit frustrating for these
   basic things to just not work.</p>
   <p>Sample code to reproduce:</p>
   <pre>
   <code>var client = Titanium.Network.createHTTPClient();
   client.onload = function() {
       Titanium.API.info("Loaded! Status: " + this.status);
   
       var contentType = this.getResponseHeader('Content-Type');
       Titanium.API.info("Content-Type: " + contentType);
   };
   client.open("GET", "<a href="http://example.com/" rel="nofollow" target="_blank">http://example.com/</a>");
   client.send();</code>
   </pre>
   <p>got on iphone:<br>
   <a href="/projects/32238/changesets/INFO" title=
   "Changeset [INFO]">[INFO]</a> Loaded! Status: 200 <a href=
   "/projects/32238/changesets/INFO" title=
   "Changeset [INFO]">[INFO]</a> Content-Type: null &lt;- BROKEN</p>
   <p>got on android:<br>
   I/TiAPI (11249): (kroll$1) [23,606] Loaded! Status: 200<br>
   I/TiAPI (11249): (kroll$1) [13,619] Content-Type: text/html;
   charset=UTF-8 &lt;- fine</p>
   <p>Assigning to our support contact.</p></div></li>
<li>Brion Vibber 2011-04-15

   <div><p>Workaround: pull headers from an original reference instead of
   the 'this' reference:</p>
   <pre>
   <code>var client = Titanium.Network.createHTTPClient();
   client.onload = function() {
       Titanium.API.info("Loaded! Status: " + this.status);
   
       var contentType = this.getResponseHeader('Content-Type');
       Titanium.API.info("Content-Type (from this): " + contentType);
   
       var xcontentType = client.getResponseHeader('Content-Type');
       Titanium.API.info("Content-Type (from client): " + xcontentType);
   };
   client.open("GET", "<a href="http://example.com/" rel="nofollow" target="_blank">http://example.com/</a>");
   client.send();</code>
   </pre>
   <p>which gives on iPhone:<br></p>
   <pre>
   <code>[INFO] Loaded! Status: 200
   [INFO] Content-Type (from this): null
   [INFO] Content-Type (from client): text/html; charset=UTF-8</code>
   </pre>
   <p>and on Android:<br></p>
   <pre>
   <code>I/TiAPI   (11302): (kroll$1) [29,639] Loaded! Status: 200
   I/TiAPI   (11302): (kroll$1) [4,643] Content-Type (from this): text/html; charset=UTF-8
   I/TiAPI   (11302): (kroll$1) [1,644] Content-Type (from client): text/html; charset=UTF-8</code>
   </pre></div></li>
<li>Ralf Pfeiffer 2011-04-15

   <div><p>to scrub.</p></div></li>
<li>Stephen Tramer 2011-04-15

   <div><p>Paring this down to 2. only. <a href=
   "/projects/32238/tickets/519" title="Ticket #519">#519</a> has been
   resolved and auth issues are separate and being addressed.</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/4a2acd75260b60f09a89b23c26856039ad7a4b75"
   title=
   "Changeset [4a2acd75260b60f09a89b23c26856039ad7a4b75]">[4a2acd75260b60f09a89b23c26856039ad7a4b75]</a>)
   [<a href="/projects/32238/tickets/1502" title=
   "Ticket #1502">#1502</a> state:fixed-in-qa] No longer erase
   response information on failures. Need to revisit this for XHR
   compliance. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/4a2acd75260b60f09a89b23c26856039ad7a4b75" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/4a2acd75260b60f09a89b23c26856039ad7a4b75</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/4a2acd75260b..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/4a2acd75260b...</a></a></p></div></li>
<li>Stephen Tramer 2011-04-15

   <div><p>Note that better XHR compliance is scheduled for a near-future
   release. If the XHR standard says that we MUST or SHOULD not
   provide any response data on 401, etc. then we will not.</p></div></li>
<li>Pedro Enrique 2011-04-15

   <div><p>test file exists in bug tests.<br>
   Tested in iPhone 4 running 4.2 and Simulator 4.2<br>
   SDK 1.5 12/9/2010 - r43358e5f</p>
   <p>When testing on simulator, changed Titanium.API.info() to
   alert() to I could see the result</p>
   <p>Console:<br></p>
   <pre>
   <code>[INFO] Error! Status: 401
   [INFO] Response: &lt;html&gt;&lt;body&gt;YOU CAN'T HANDLE THE AUTHORIZATION&lt;/body&gt;&lt;/html&gt;</code>
   </pre></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1502.json">JSON Source</a></p>