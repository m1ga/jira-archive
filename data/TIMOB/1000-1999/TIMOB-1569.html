---
title: "[TIMOB-1569] Android: Implement Image Cache"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:56:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0 M04</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, feature</td></tr>
<tr><th>Reporter</th><td>Don Thorp</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T02:56:16.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:56:32.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Remote images are currently downloaded, but not cached. Add
support for better background downloading and caching of
images.</p></div>

<h3>Comments</h3>

<ol>
<li>Don Thorp 2011-04-15

   <div><p>My prototype code for the feature is on this branch <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/tree/dst-cachit" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/tree/dst-cachit</a>">dst-cachit</a>
   it was done in 1_4_X so it'll have to be ported to 1.5.</p>
   <p>The goal of this support was to replace the current background
   download of images which doesn't know if something is already
   downloaded. I also wanted to provide a cleanup thread and some
   cache configuration parameters like max # items, max mbs, scan
   frequency. We should also add a clear method that could be invoked.
   Eventually we'll turn this into a media agnostic cache manager, but
   the initial need is for remote images. Especially wrt to TableViews
   use of them.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>The remote image test in KS (Base UI - Views - Image Views -
   Remote Image). Is it related to changes made for this ticket?
   Tested with c680f8c in 2.1 emulator. I verified that my emulator
   has an sdcard.</p>
   <p>There should also be a drillbit test for remote image.</p>
   <p>Logcat:</p>
   <pre>
   <code>E/TiDrawableReference(  326): java.io.FileNotFoundException: /sdcard/com.appcelerator.titanium/remote-image-cache/46b7e15e92d07bc31815c72c06be3693b5f73bed.hdr
   E/TiDrawableReference(  326):   at org.apache.harmony.luni.platform.OSFileSystem.open(OSFileSystem.java:244)
   E/TiDrawableReference(  326):   at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:77)
   E/TiDrawableReference(  326):   at java.io.FileReader.&lt;init&gt;(FileReader.java:42)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.util.TiResponseCache.get(TiResponseCache.java:179)
   E/TiDrawableReference(  326):   at org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnection.getFromCache(HttpURLConnection.java:848)
   E/TiDrawableReference(  326):   at org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:755)
   E/TiDrawableReference(  326):   at org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1051)
   E/TiDrawableReference(  326):   at java.net.URL.openStream(URL.java:653)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.util.TiFileHelper.openInputStream(TiFileHelper.java:147)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.view.TiDrawableReference.getInputStream(TiDrawableReference.java:359)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.view.TiDrawableReference.getBitmap(TiDrawableReference.java:171)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.view.TiDrawableReference.getBitmap(TiDrawableReference.java:233)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.util.TiBackgroundImageLoadTask.doInBackground(TiBackgroundImageLoadTask.java:71)
   E/TiDrawableReference(  326):   at org.appcelerator.titanium.util.TiBackgroundImageLoadTask.doInBackground(TiBackgroundImageLoadTask.java:28)</code>
   </pre></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>This also affects the "Basic" image view test, since it uses a
   remote url. And the Facebook login test. (Probably other tests
   too...)</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/116948f0cb8a79ceff779c6f8955420d5aab547f"
   title=
   "Changeset [116948f0cb8a79ceff779c6f8955420d5aab547f]">[116948f0cb8a79ceff779c6f8955420d5aab547f]</a>)
   [<a href="/projects/32238/tickets/1569" title=
   "Ticket #1569">#1569</a>] TiResponseCache.get() should return null
   when cache doesn't contain item. If cachedir doesn't exist, create
   it. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/116948f0cb8a79ceff779c6f8955420d5aab547f" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/116948f0cb8a79ceff779c6f8955420d5aab547f</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/116948f0cb8a..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/116948f0cb8a...</a></a></p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/8e66e2c70caf59e50fd9b98641cc2e64acd2311f"
   title=
   "Changeset [8e66e2c70caf59e50fd9b98641cc2e64acd2311f]">[8e66e2c70caf59e50fd9b98641cc2e64acd2311f]</a>)
   [<a href="/projects/32238/tickets/1569" title=
   "Ticket #1569">#1569</a>] Test to guard against TiResponseCache
   crashing <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/8e66e2c70caf59e50fd9b98641cc2e64acd2311f" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/8e66e2c70caf59e50fd9b98641cc2e64acd2311f</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/8e66e2c70caf..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/8e66e2c70caf...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/a0f4151a5b12ab0a7ed4a77d752ff74c1aeae581"
   title=
   "Changeset [a0f4151a5b12ab0a7ed4a77d752ff74c1aeae581]">[a0f4151a5b12ab0a7ed4a77d752ff74c1aeae581]</a>)
   [<a href="/projects/32238/tickets/1569" title=
   "Ticket #1569">#1569</a> state:fixed-in-qa] work around android SDK
   bug which calls abort() even on success <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/a0f4151a5b12ab0a7ed4a77d752ff74c1aeae581" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a0f4151a5b12ab0a7ed4a77d752ff74c1aeae581</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/a0f4151a5b12..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a0f4151a5b12...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>closed against (1.5.0.7d08f15) ks tests used: Basic image test,
   remote image</p></div></li>
<li>Michael Del Tito 2011-04-15

   <div><p>this is still an issue it seems under 1.5.1</p>
   <p>remote images loaded in a scrollableView are re-downloaded on
   each scroll</p></div></li>
<li>Dawson Toth 2011-04-15

   <div><p>Michael, are your images getting scaled at all? Or are they the
   precise size that will be used?</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1569.json">JSON Source</a></p>