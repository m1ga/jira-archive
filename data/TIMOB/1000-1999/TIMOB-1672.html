---
title: "[TIMOB-1672] Android: XHR to XML (responseXML) does not respect encoding"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:56:49.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T02:59:01.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:56:49.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Customer uses a feed service which provides xml in ISO-8859-1.
The xml processing instruction accurately reflects that the
charset=ISO-8859-1. Our <code>HTTPClient.responseText</code> also
accurately determines the charset, but
<code>HTTPClient.responseXML</code> just hands off the string to
<code>XMLModule.parse</code> without telling it what the encoding
is.<br></p>
<p>In the customer's specific case, this meant that umlauts (e.g.,
&ouml;) and accented characters (e.g., &eacute;) were screwed up
when displayed on the android (or emulator) screen.</p>
<p>Screenshot of problem:</p>
<p><a href=
"<a href="http://skitch.com/billdawson/dwk1r/5560-titanium-5-hvga" rel="nofollow" target="_blank">http://skitch.com/billdawson/dwk1r/5560-titanium-5-hvga</a>"><a href="http://skitch.com/billdawson/dwk1r/5560-titanium-5-hvga" rel="nofollow" target="_blank">http://skitch.com/billdawson/dwk1r/5560-titanium-5-hvga</a></a></p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1672_18035/emulator.png">emulator.png</td></td><td>2011-04-15T02:59:01.000+0000</td><td>119408</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1672_18037/remotefile.js">remotefile.js</td></td><td>2011-04-15T02:59:02.000+0000</td><td>6789</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1672_18036/titanium.png">titanium.png</td></td><td>2011-04-15T02:59:01.000+0000</td><td>148157</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>Test case (see me via e-mail for the URL for
   <code>xhr.open()</code> -- it's not to be made public).</p>
   <pre>
   <code class="javascript">
   var win = Titanium.UI.createWindow({  
       title:'Drivers',
       backgroundColor:'#fff',
       fullscreen: true,
       exitOnClose: true
   });
   
   win.open();
   
   var rows = [];
   var xhr = Ti.Network.createHTTPClient();
   xhr.onload = function(e) {
       try {
           var xml = xhr.responseXML;
           if (xml) {
               var session = xml.getElementsByTagName('session');
               if (session) {
                   session = session.item(0);
               } else { 
                   alert('session list not fetched');
                   return;
               }
               if (session) {
                   if (!session.hasChildNodes()) {
                       alert('No child nodes');
                       return;
                   }
                   var length = session.childNodes.length;
                   for (var i = 0; i &lt; length; i++) {
                       var child = session.childNodes.item(i);
                       if (child.nodeType == child.ELEMENT_NODE) {
                           rows.push(Ti.UI.createTableViewRow({color: 'black', title: child.getAttribute("driver")}));
                       }
                   }
                   win.add(Ti.UI.createTableView({data: rows}));
               } else {
                   alert('"session" not found');
               }
           } else {
               alert('XML did not load');
           }
       } catch(ex) {
           alert(ex);
       }
   };
   xhr.open('GET', '(SEE BILL FOR URL -- IT IS NOT TO BE MADE PUBLIC)');
   xhr.send();</code>
   </pre>
   <p>Screenshot when fixed:<br>
   <a href=
   "<a href="http://skitch.com/billdawson/dwk16/5560-titanium-5-hvga" rel="nofollow" target="_blank">http://skitch.com/billdawson/dwk16/5560-titanium-5-hvga</a>"><a href="http://skitch.com/billdawson/dwk16/5560-titanium-5-hvga" rel="nofollow" target="_blank">http://skitch.com/billdawson/dwk16/5560-titanium-5-hvga</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/5a5703997aa24b161599439e25ca4c5fce0f3e80"
   title=
   "Changeset [5a5703997aa24b161599439e25ca4c5fce0f3e80]">[5a5703997aa24b161599439e25ca4c5fce0f3e80]</a>)
   [<a href="/projects/32238/tickets/1672" title=
   "Ticket #1672">#1672</a> state:fixed-in-qa] XHR now respects
   encoding when passing string to XMLModule.parse for responseXML
   <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/5a5703997aa24b161599439e25ca4c5fce0f3e80" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/5a5703997aa24b161599439e25ca4c5fce0f3e80</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/5a5703997aa24..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/5a5703997aa24...</a></a></p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Actually you can get the feed address from the problem
   description in helpdesk ticket 38891.</p></div></li>
<li>marco.schierhorn (at gmail) 2011-04-15

   <div><p>Hey Bill,</p>
   <p>thanks a lot for your help again. I have attached 2 screenshots
   bcs im still having the "umlaut" issue. And im using the build from
   your continous build server.</p>
   <p>Maybe its because im downloading the file and save it into
   another file. I have also attached the js file which handles the
   downloading and saving of the file. And im using responseData
   instead of responseXML.</p>
   <p>Best regards, Marco</p></div></li>
<li>marco.schierhorn (at gmail) 2011-04-15

   <div><p>Here is the remoteFile.js File</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Hi Marco,</p>
   <p>Please add to your helpdesk ticket instead of here. The issue
   described by the title of this lighthouse ticket really is
   resolved, so we should carry on with other problems (i.e., going
   through a file) via helpdesk.</p>
   <p>thank you,<br>
   Bill</p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>confirmed</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1672.json">JSON Source</a></p>