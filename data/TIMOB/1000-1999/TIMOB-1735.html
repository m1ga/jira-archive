---
title: "[TIMOB-1735] iOS: Blob data returned from File.read becomes empty when the file is deleted"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2017-06-21T21:58:20.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>api</td></tr>
<tr><th>Reporter</th><td>Brion Vibber</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2011-04-15T03:00:53.000+0000</td></tr>
<tr><th>Updated</th><td>2017-06-21T21:58:20.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>The File.read method is documented to "return the contents of
file as blob":</p>
<p><a href=
"<a href="https://developer.appcelerator.com/apidoc/mobile/latest/Titanium.Filesystem.File.read-method.html" rel="nofollow" target="_blank">https://developer.appcelerator.com/apidoc/mobile/latest/Titanium.Filesystem.File.read-method.html</a>">
<a href="https://developer.appcelerator.com/apidoc/mobile/latest/Titanium.Fi..." rel="nofollow" target="_blank">https://developer.appcelerator.com/apidoc/mobile/latest/Titanium.Fi...</a></a></p>
<p>It seems like a reasonable expectation that the returned blob
actually contains the data read from the file, however this doesn't
appear to be the case; we seem to end up with some sort of indirect
reference to the file instead!</p>
<p>If the file is subsequently deleted or altered, our blob also
magically empties or changes, contrary to expectations.</p>
<p>Here's some sample code to create a file, read its contents,
then delete it. Before deleting it our blob contains the expected
amount of data; afterwards its contents appear to have disappeared.
(Note that we have to check both .size and .length properties
because the undocumented Ti.Blob type has inconsistent APIs between
Android and iPhone implementations.)</p>
<pre>
<code>// Create a temporary file and return its pathname
function buildFile() {
    //var tempFile = Ti.Filesystem.createTempFile();
    var tempFile = Ti.Filesystem.getFile(
        Ti.Filesystem.applicationDataDirectory + '/myfile');
    tempFile.write("Hello I am a temp file");
    return tempFile.nativePath;
}

// Read the given file's contents into a blob
function readFile(path) {
    return Ti.Filesystem.getFile(path).read();
}

function deleteFile(path) {
    return Ti.Filesystem.getFile(path).deleteFile();
}

// Create a temporary file and read it in
var path = buildFile();
Ti.API.info("Created temp file " + path);

var blob = readFile(path);
Ti.API.info("We got a blob! It's " + (blob.length || blob.size) + " bytes long");

// We no longer need the temporary file!
Ti.API.info("Deleting " + path);
deleteFile(path);

Ti.API.info("Now our blob is " + (blob.length || blob.size) + " bytes long");</code>
</pre>
<p>Android:<br></p>
<pre>
<code>[INFO] [779,976] Created temp file file:///data/data/net.status.client.quicktest/app_appdata/myfile
[INFO] [290,1266] We got a blob! It's 22 bytes long
[INFO] [2,1268] Deleting file:///data/data/net.status.client.quicktest/app_appdata/myfile
[INFO] [81,1349] Now our blob is null bytes long</code>
</pre>
<p>iPhone:<br></p>
<pre>
<code>[INFO] Created temp file /Users/brion/Library/Application Support/iPhone Simulator/4.0.2/Applications/74ED2286-A5A1-45AF-902F-4FFF2DABFD72/Documents/myfile
[INFO] We got a blob! It's 22 bytes long
[INFO] Deleting /Users/brion/Library/Application Support/iPhone Simulator/4.0.2/Applications/74ED2286-A5A1-45AF-902F-4FFF2DABFD72/Documents/myfile
[INFO] Now our blob is 0 bytes long</code>
</pre>
<p>If this is intended behavior, it needs to be documented in the
docs for File.read; it also should be documented in the docs for
the Ti.Blob type (which is conspicuously absent at this time).
There also needs to be a clear way added to <em>actually</em> read
the current contents of a file, independent of the file's continued
existence or contents...</p>
<p>Assigning to our support contact. (Nolan, is there anyone
specific we should be assigning bugs in the filesystem area to?
Thanks!)</p>
<p>Related issues:</p>
<p>lack of docs for Ti.Blob: <a href=
"<a href="https://appcelerator.lighthouseapp.com/projects/32238/tickets/1580-titaniumblob-tiblob-missing-from-mobile-api-documentation" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238/tickets/1580-titaniumblob-tiblob-missing-from-mobile-api-documentation</a>">
<a href="https://appcelerator.lighthouseapp.com/projects/32238/tickets/1580-..." rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238/tickets/1580-...</a></a></p>
<p>inconsistent API for Ti.Blob size/length: <a href=
"<a href="https://appcelerator.lighthouseapp.com/projects/32238/tickets/1656-api-inconsistency-tiblob-has-length-property-on-android-size-on-ios" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238/tickets/1656-api-inconsistency-tiblob-has-length-property-on-android-size-on-ios</a>">
<a href="https://appcelerator.lighthouseapp.com/projects/32238/tickets/1656-..." rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238/tickets/1656-...</a></a></p></div>

<h3>Comments</h3>

<ol>
<li>Stephen Tramer 2011-04-15

   <div><p>Known filesystem issue. This is a dupe of something but not sure
   what.</p></div></li>
<li>Stephen Tramer 2012-07-25

   Validated against SDK 2.2.0.014b86f. A consequence of file blobs not being stored in memory.</li>
<li>Lee Morris 2017-06-21

   Closing ticket due to time passed and lack of progress for a number of years. Any problems, please file a new ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-1735.json">JSON Source</a></p>