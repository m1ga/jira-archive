---
title: "[TIMOB-1767] Android: event listeners in reopened window do not fire."
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2011-04-15T03:01:40.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:01:38.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-02T19:03:23.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>app.js:</p>
<pre>
<code class="javascript">Ti.UI.setBackgroundColor('#000');
Ti.UI.createWindow({
    backgroundColor: 'blue',
    url: 'main.js',
    fullscreen:true,
    exitOnClose: true
}).open();</code>
</pre>
<p>main.js:</p>
<pre>
<code class="javascript">
var win = Ti.UI.currentWindow;
var btn = Ti.UI.createButton({
    title: 'open subwindow'
});

var win2 = Ti.UI.createWindow({
    url: 'sub.js',
    fullscreen: true,
    backgroundColor: 'red'
});
win2.addEventListener('close', function() {Ti.API.info('window close');});

btn.addEventListener('click', function(){win2.open();});

win.add(btn);</code>
</pre>
<p>sub.js:</p>
<pre>
<code class="javascript">var win = Ti.UI.currentWindow;
var btn = Ti.UI.createButton({title: 'close'});
btn.addEventListener('click', function(){win.close();});
win.add(btn);</code>
</pre>
<p>The second time you open sub window, the button inside it will
not work anymore.</p>
<p>Very likely caused by <a href=
"<a href="http://github.com/appcelerator/titanium_mobile/commit/026c645a26d0c83587246af2eaf8d6e82ae65179" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/026c645a26d0c83587246af2eaf8d6e82ae65179</a>">
this commit</a>, wherein I thought I was limiting to app events --
but perhaps that distinction cannot really be made.</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1767_18056/test_files.zip">test_files.zip</td></td><td>2011-04-15T03:01:39.000+0000</td><td>1218</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>Actually my failcase here is stupid. Each opening of the 2nd
   window stacks a button right on top of the previous button, (since
   all buttons from previous openings of the window get retained).
   Then the topmost button ends up being the first button, whose event
   listener has been destroyed. Each new button does indeed have an
   event listener -- it's just that the button never gets clicked
   (touched/tapped) since it's below all previous buttons.</p>
   <p>I'll put a more logical failcase in here.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Using our latest builds, I'm failing to find a relevant fail
   case. I've some fairly comprehensive testing, the details of which
   I'll paste here. The attached zip file contains the three test
   files.</p>
   <h2>Tests</h2>
   <p><strong>The goals:</strong></p>
   <p>1) in each of the below scenarios, the context that creates the
   second window will add a close event for it. Each time that second
   window closes, that close event in the creating context should
   fire.</p>
   <p>2) in each of the scenarios, the second window will get a
   "close" button put on to it. That close button will have a click
   event listener which, in turn, will close the window that it is on
   (i.e., the second window). This should always work.</p>
   <p>3) in two of the scenarios -- the scenarios that use 'url'
   properties for the second window -- the second window will get a
   second 'close' event listener created inside the second JS file. It
   should fire when the second window is closed. In this case, two
   'close' event handlers should be created: the one from the first
   window and the one from inside the second window.</p>
   <p><strong>Scenarios:</strong></p>
   <p>a) Second window is a "heavyweight" window (a window that gets
   its own Android Activity) and has its own url. Go back to the first
   window using the 'Close' button. Reopen and repeat.</p>
   <p>b) Same as (a), but go back to the first window using the
   Android back button. Reopen and repeat.</p>
   <p>c) Second window is a "heavyweight" window (a window that gets
   its own Android Activity) but does not have its own url. Go back to
   the first window using the 'Close' button. Reopen and repeat.</p>
   <p>d) Same as (c), but go back to the first window using the
   Android back button. Reopen and repeat.</p>
   <p>e) Second window is a "lightweight" window and has its own url.
   (Note: cannot use Android back button because it's lightweight.)
   Click the 'Close' button to go back to the first window. Reopen and
   repeat.</p>
   <p>f) Second window is a "lightweight" window and does not have its
   own url. Click the 'Close' button to go back to the first window.
   Reopen and repeat.</p>
   <p><strong>Scenario Results:</strong></p>
   <p>a) Success. Close events were captured both from inside the
   second window and outside. The click event on the button inside the
   window always worked.</p>
   <p>b) same as (a)</p>
   <p>c) Success. The close event in the first window succeeded, and
   click event on the button in the second window always worked.</p>
   <p>d) same as (c)</p>
   <p>e) Success: the close button always worked, and the close event
   was always captured both in the first and second window's
   handlers.</p>
   <p>f) Success: the close button always worked and the close event
   was always captured in the handler in the first window.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Lukasz appears to be the only one following this. Lukasz do you
   have a fail case for the symptom described in the title of this
   item?</p></div></li>
<li>Lukasz 2011-04-15

   <div><p>No, I do not have any fail case for this bug. I can of course
   test it, but not before Monday. I did not report this bug. My
   problem is a little bit different because I'm using TabGroups
   instead of Windows. Did you read this ticket <a href=
   "<a href="https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/1742" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238-titanium-mobile/tickets/1742</a>">
   "Android: Window in TabGroup loses event listeners"</a>? I attached
   a fail case there.</p>
   <p>Thanks, Lukasz</p></div></li>
<li>Lukasz 2011-04-15

   <div><p>Hi Bill,</p>
   <p>I've tested the scenarios using
   mobilesdk-1.4.1-20100909194301-osx.zip and all 6 are working
   correctly.</p></div></li>
<li>Friedrich Seydel 2011-04-15

   <div><p>Hi Bill.<br>
   I've tested the scenearios using
   mobilesdk-1.4.1-20100915120231-win32.zip and the close events were
   captured, but way too often.</p>
   <p>Results:<br>
   a) Close event captured seven times.<br>
   b) Close event captured two times.<br>
   c) Close event captured four times.<br>
   d) Close event captured one time.<br>
   e) Close event captured seven times.<br>
   f) Close event captured four times.</p>
   <p>And it seems memory is not always freed correctly when
   closing.</p>
   <p>Test Case: Set a big backgroundImage for win2 before opening,
   e.g. change the event listener in line 11 of main.js:<br></p>
   <pre>
   <code class="javascript">btn.addEventListener('click', function(){
     win2.backgroundImage="<a href="http://ddiff.com/wp-content/uploads/2009/11/Hurricane-Isabel-NASA.jpg" rel="nofollow" target="_blank">http://ddiff.com/wp-content/uploads/2009/11/Hurricane-Isabel-NASA.jpg</a>";
     win2.open();
   });</code>
   </pre>
   Results:<br>
   a) Crashes on second opening of subwindow: <em>Unable to load
   bitmap. Not enough memory: bitmap size exceeds VM budget</em>.<br>
   b) same as (a)<br>
   c) same as (a)<br>
   d) Sucess: This DOES work without crashing!<br>
   e) same as (a)<br>
   f) same as (a)
   <p>There seems to be a connection between this memory leak and the
   close event being captured more than once.<br>
   Only scenario (d) is working properly, the event is captured once
   and there seems to be no leak.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Friedrich's comment relates to a different problem than that
   described by this item, so created <a href=
   "/projects/32238/tickets/1827" title="Ticket #1827">#1827</a> and
   referenced Friedrich's comment.</p>
   <p>Closing this ticket as invalid since the original issue doesn't
   appear to be happening.</p></div></li>
<li>Lee Morris 2017-03-02

   Closing as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-1767.json">JSON Source</a></p>