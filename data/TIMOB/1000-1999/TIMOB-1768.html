---
title: "[TIMOB-1768] Android: KS alerts are not respecting opacity."
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:57:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0 M03</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, regression</td></tr>
<tr><th>Reporter</th><td>Thomas Huelbert</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T03:01:41.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:57:07.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>1.launch KS on device or simulator<br>
2.note the pop ups that show the sdk version and tab info (change
tabs to generate more)</p>
<p>results: the windows are not opaque, as per the script they
should reflect:</p>
<p>opacity:0.7,</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-1768_18057/1768_master.diff">1768_master.diff</td></td><td>2011-04-15T03:01:41.000+0000</td><td>2363</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>Here's a sample app.js that shows the problem (so you don't have
   to build KS):</p>
   <pre>
   <code class="javascript">/*global Ti, Titanium, alert, JSON */
   Titanium.UI.setBackgroundColor('#000');
   var win = Titanium.UI.createWindow({  
       title:'Test',
       backgroundColor:'#fff',
       fullscreen: true,
       exitOnClose: true
   });
   
   
   var messageView = Titanium.UI.createView({
       top: 0,
       height:30,
       width:250,
       borderRadius:10,
       backgroundColor:'blue',
       opacity:0.7,
       touchEnabled:false
   });
   win.add(messageView);
   
   var v = Titanium.UI.createView({
       top: 50,
       height:30,
       width:250,
       borderRadius:10,
       backgroundColor:'blue',
       touchEnabled:false
   });
   win.add(v);
   win.open();</code>
   </pre>
   <p>The top view -- which sets opacity -- should look different than
   the bottom view, which is otherwise the same. Because of this bug,
   they look identical.</p>
   <p>What's happening is that because a border property is being set
   in addition to background, a TiBackgroundDrawable is being used.
   TiBackgroundDrawable maintains its own copy of a drawable which it
   draws to the canvas. It doesn't respect any of the alpha stuff
   being done in TiUIHelper.setDrawableOpacity.</p>
   <p>I can get it to work properly by...</p>
   <ul>
   <li>
   <p>Overriding setAlpha() in TiBackgroundDrawable and keeping track
   of the alpha value internally there, then setting it in the
   internal "background" variable (a drawable) before it draws to
   canvas.</p>
   </li>
   <li>
   <p>In <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/blob/master/android/titanium/src/org/appcelerator/titanium/util/TiUIHelper.java#L599" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/blob/master/android/titanium/src/org/appcelerator/titanium/util/TiUIHelper.java#L599</a>">
   TiUIHelper.setDrawableOpacity</a>, change ...</p>
   </li>
   </ul>
   <pre>
   <code class="javascript">if (drawable instanceof ColorDrawable) {
        ColorDrawable colorDrawable = (ColorDrawable) drawable;
        colorDrawable.setAlpha(Math.round(opacity * 255));
   ....</code>
   </pre>
   <p>... to ...</p>
   <pre>
   <code class=
   "javascript">if (drawable instanceof ColorDrawable || drawable instanceof TiBackgroundDrawable) {
        drawable.setAlpha(Math.round(opacity * 255));
   ....</code>
   </pre>
   <p>This means, however, that TiBackgroundDrawable doesn't get the
   color matrix / color filter stuff -- .setColorFilter() is not
   called on it. I tried overriding .setColorFilter in
   TiBackgroundDrawable and passing the value to its private
   'background' Drawable, but that didn't work at all. Are we sure the
   color filter / color matrix thing works?</p>
   <p>I haven't committed these changes, as I'm not strong in this
   area of drawables, color filters, etc. If Don/Marshall wants me to,
   I can.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>here's a diff patch (based on master) in case you wanna use
   it.</p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/df00caa5c7758796ef957e3b58eb3b742e271e4a"
   title=
   "Changeset [df00caa5c7758796ef957e3b58eb3b742e271e4a]">[df00caa5c7758796ef957e3b58eb3b742e271e4a]</a>)
   merging Bill's original patch for fixing opacity on views with
   custom background drawables. tested with [<a href=
   "/projects/32238/tickets/2031" title="Ticket #2031">#2031</a>] as
   well to verify [<a href="/projects/32238/tickets/1768" title=
   "Ticket #1768">#1768</a> state:fixed-in-qa] <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/df00caa5c7758796ef957e3b58eb3b742e271e4a" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/df00caa5c7758796ef957e3b58eb3b742e271e4a</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/df00caa5c775..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/df00caa5c775...</a></a></p></div></li>
<li>Matt Schmulen 2011-04-15

   <div><p>Failed in 1.6 and 2.1, seems to work fore createImageView, but
   not createView.<br>
   Titanium SDK version: 1.5.0 (11/22/10 20:42 19a59fd)</p>
   <p>used the test code above</p></div></li>
<li>Matt Schmulen 2011-04-15

   <div><p>passed Android 2.1 Titanium SDK version: 1.5.0 (11/24/10 12:05
   c0aff27)<br>
   passed Android 1.6 Titanium SDK version: 1.5.0 (11/24/10 12:05
   c0aff27)</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1768.json">JSON Source</a></p>