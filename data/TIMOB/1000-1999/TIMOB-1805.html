---
title: "[TIMOB-1805] Android: Too deep recursion"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2013-08-01T00:11:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, recursion, rhino, rplist, stackoverflowerror</td></tr>
<tr><th>Reporter</th><td>Marshall Culpepper</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2011-04-15T03:02:52.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-20T17:53:34.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Some apps will cause Rhino / Dalvik to reach a
StackOverflowError and show an error message "Too deep recursion
when parsing". We need to either increase the stack size of the
Thread that parses the Javascript, or pre-compile the AST so the
parsing doesn't happen on device (the latter might be good for
speed anyway)</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1805_25229/module_media.zip">module_media.zip</td></td><td>2012-01-20T11:55:20.000+0000</td><td>4873819</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1805_25228/module_media log.txt">module_media log.txt</td></td><td>2012-01-20T11:55:20.000+0000</td><td>19193</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1805_27425/sample_cloud_log.txt">sample_cloud_log.txt</td></td><td>2012-04-26T15:19:15.000+0000</td><td>13383</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1805_27426/sample_cloud.zip">sample_cloud.zip</td></td><td>2012-04-26T15:19:15.000+0000</td><td>3197608</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/ef98bfab872f7a5b08398a809da37b5ffe67a550"
   title=
   "Changeset [ef98bfab872f7a5b08398a809da37b5ffe67a550]">[ef98bfab872f7a5b08398a809da37b5ffe67a550]</a>)
   use a 16K stack for Javascript parsing, this seems to give more
   room so some apps don't spit out the "Too deep recursion" error.
   copied the android HandlerThread class in so we could expose the
   stack size constructor of Thread [<a href=
   "/projects/32238/tickets/1805" title="Ticket #1805">#1805</a>]
   <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/ef98bfab872f7a5b08398a809da37b5ffe67a550" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/ef98bfab872f7a5b08398a809da37b5ffe67a550</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/ef98bfab872f7..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/ef98bfab872f7...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/99989c74f5b83ad5fc6c45601d21e6ada78e16e1"
   title=
   "Changeset [99989c74f5b83ad5fc6c45601d21e6ada78e16e1]">[99989c74f5b83ad5fc6c45601d21e6ada78e16e1]</a>)
   16K, not 16M (good eye Bill) [<a href=
   "/projects/32238/tickets/1805" title="Ticket #1805">#1805</a>]
   <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/99989c74f5b83ad5fc6c45601d21e6ada78e16e1" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/99989c74f5b83ad5fc6c45601d21e6ada78e16e1</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/99989c74f5b83..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/99989c74f5b83...</a></a></p></div></li>
<li>Jick Steen 2011-04-15

   <div><p>FYI: I ran into this issue after I minified my JS using "google
   closure". I also merged all "library" files into one file before
   building a release version to reduce stat calls. The result was a
   file larger than 40k. Dont know whether the file size has something
   to do with the stack size.</p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/54629899a5631d2d2e1ef9ca4025c5831f640d1a"
   title=
   "Changeset [54629899a5631d2d2e1ef9ca4025c5831f640d1a]">[54629899a5631d2d2e1ef9ca4025c5831f640d1a]</a>)
   initial implementation of Rhino JS-&gt;bytecode compiler for
   production apps, dramatically decreasing startup time and runtime
   code execution in general. this falls back on dynamic/unoptimized
   evaluation when a compiled script isn't found, and each file is
   compiled separately to avoid the arg size limit in windows. added a
   "ti.android.threadstacksize" property that allows each app to
   control the stack size allocated for each JS thread (by default
   it's 16K, but this may not be big enough for some apps) [<a href=
   "/projects/32238/tickets/1109" title="Ticket #1109">#1109</a>]
   [<a href="/projects/32238/tickets/1805" title=
   "Ticket #1805">#1805</a>] <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/54629899a5631d2d2e1ef9ca4025c5831f640d1a" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/54629899a5631d2d2e1ef9ca4025c5831f640d1a</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/54629899a5631..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/54629899a5631...</a></a></p></div></li>
<li>Jick Steen 2011-04-15

   <div><p>Hi Marshall,</p>
   <p>how can someone determine the best/correct/needed
   threadstacksize?</p>
   <p>Best regards</p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>@Jick</p>
   <p>Try the new default stack size, and if you're still seeing the
   "Too deep recursion" error, you might need to try specifying
   something larger (I'd recommend increasing by factors of 2)</p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/d8ba51d99dd0a067968102ad63b628aad4d8fc71"
   title=
   "Changeset [d8ba51d99dd0a067968102ad63b628aad4d8fc71]">[d8ba51d99dd0a067968102ad63b628aad4d8fc71]</a>)
   fixed a source code generation bug when a tiapp.xml property had an
   empty / bad value, turned on deploy type and a new
   ti.android.compilejs property to control when/if JS gets compiled
   for an application [<a href="/projects/32238/tickets/1805" title=
   "Ticket #1805">#1805</a>] <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/d8ba51d99dd0a067968102ad63b628aad4d8fc71" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/d8ba51d99dd0a067968102ad63b628aad4d8fc71</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/d8ba51d99dd0a..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/d8ba51d99dd0a...</a></a></p></div></li>
<li>Matt Schmulen 2011-04-15

   <div><p>regression tested on 1.5.0 (11/22/10 20:42 19a59fd) Android sim
   2.1,</p>
   <p>function recurse(count) {<br></p>
   <pre>
   <code>return ( count &gt; 0 ) ? recurse( count - 1) : count;</code>
   </pre>
   <p>};//end recurse</p>
   <p>recurse(1000000);</p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>resolved as per Matt</p></div></li>
<li>Dustin Hyde 2012-01-20

    Reopening Issue.
    Bug Still Valid.
    
    Attached new fail-case test project: module_media.zip
    Attached runtime error log: module_media log.txt
    
    Error caused by: module_media/Resources/acceptance.js > tpl.at.timob_5900 = function (_window) {...}) (lines 248-332)
    There is a syntax/semantic error in this function involving two extra curly braces (lines 248 and 328). Removing them will allow the app to run.
    Note: Studio does not recognize the error and there are no recursion errors in iOS/V8 (these platforms appear to behave correctly).
    
    SDK: 1.9.0.v20120119134634, 1.8.0.1.v20120119133134
    Android: Rhino
    Studio: 1.0.8.201201190907
    OS: Lion
    Devices Tested: Galaxy Nexus 4.0.2, Droid3 2.3.4
    
    Steps to Reproduce:
    
    1. Run project using Rhino.
    
    Expected Result:
    
    App should run.
    
    Actual Result:
    
    Runtime Error.
    </li>
<li>Wilson Luu 2012-04-26

    Also getting too deep recursion error when running the cloud sample app.
    
    Bug appears on:
    SDK build: 2.0.1.GA2
    Runtime: Rhino
    Titanium Studio, build: 2.0.2.201204252015
    Device: Droid 3 2.3.4
    
    Steps to reproduce:
    1. Launch cloud_app in rhino</li>
<li>Chris Barber 2013-08-01

    Won't fix because Rhino is no longer supported.</li>
<li>Lee Morris 2017-03-20

    Closing ticket as Rhino is no longer supported.</li>
</ol>


<p><a href="/TIMOB/TIMOB-1805.json">JSON Source</a></p>