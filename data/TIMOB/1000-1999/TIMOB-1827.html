---
title: "[TIMOB-1827] Android: window close event firing multiple times"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-03-11T22:20:25.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.6.0 M03, Sprint 2012-02, Release 2.0.0, Release 1.8.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>parity, qe-testadded, release-1.6.0</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2011-04-15T03:03:15.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-10T06:18:54.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>In this simple example, if you click the close button in the
second window the close event listener runs FOUR times:</p>
<pre>
<code class="javascript">
/*global Ti, Titanium, alert */
Titanium.UI.setBackgroundColor('#000');
var win1 = Titanium.UI.createWindow({  title:'Test', backgroundColor:'#fff', fullscreen: true, exitOnClose: true });

var win2 = Ti.UI.createWindow({title:'window 2', fullscreen:true, backgroundColor: 'green'});
win2.addEventListener('close',function(){Ti.API.info('CLOSE');});

var open = Ti.UI.createButton({title: 'open'});
open.addEventListener('click', function(){win2.open();});
win1.add(open);

var close = Ti.UI.createButton({title: 'close'});
close.addEventListener('click', function(){win2.close();});
win2.add(close);

win1.open();</code>
</pre>
<p>Note: if you click the back button instead of clicking the close
button, it fires only once.</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-1827_18064/closetest.zip">closetest.zip</td></td><td>2011-04-15T03:03:15.000+0000</td><td>772036</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>After this is fixed see if it helps at all with the OOM
   experienced by Friedrich Seydel in <a href=
   "<a href="https://appcelerator.lighthouseapp.com/projects/32238/tickets/1767-android-event-listeners-in-reopened-window-do-not-fire#ticket-1767-11" rel="nofollow" target="_blank">https://appcelerator.lighthouseapp.com/projects/32238/tickets/1767-android-event-listeners-in-reopened-window-do-not-fire#ticket-1767-11</a>">
   this comment from ticket 1827</a>.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Assign to Don for milestone/priority. (Feel free to assign back!
   :) )</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>cf <a href="/projects/32238/tickets/1489" title=
   "Ticket #1489">#1489</a> re the backgroundImage and OOM</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>Related to Activity refactor. There are multiple close paths
   through the different exit methods that can fire 1 to n events.</p></div></li>
<li>Jeff 2011-04-15

   <div><p>Please change that back to 1.5 and make sure this issue is
   resolved in the Q4 release. This is a critical issue and we've had
   to work around this for 2 major projects and over 9 months.</p>
   <p>If Android is not going to receive the attention it needs to be
   stable, we will be canceling our account and moving to another
   cross-platform development suite at the first of the year.</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>Unfortunately 1.5.0 is fully planned and we're working to get it
   shipped in December. I've created a new 1.5.1 M01 milestone and I'm
   moving this ticket there so we can start working on it as soon as
   1.5.0 is out the door. It will then be available from the CI
   build.</p></div></li>
<li>Scott 2011-04-15

   <div><p>This is a major problem for me as well. Is there any workaround
   any one can think of at the moment until this bug is fixed and any
   ideas when a fix for this will be complete?</p></div></li>
<li>jimwilliams 2011-04-15

   <div><p>I'm opening windows and showing them modally. Since javascript
   allows methods and properties to be added dynamically to an object,
   I can get around this problem with code like this (from the example
   above):</p>
   <pre>
   <code class=
   "javascript">var win2 = Ti.UI.createWindow({title:'window 2', fullscreen:true, backgroundColor: 'green'});
   win2.CloseFired = false;
   
   win2.addEventListener('close',
   function()
   {
      if (this.CloseFired) return;
    
      this.CloseFired = true;
      // do what needs to be done 
      Ti.API.info('CLOSE');
   });</code>
   </pre>
   <p>It's not very sophisticated, but seems to do the trick.</p></div></li>
<li>jimwilliams 2011-04-15

   <div><p>Quick follow-up; the technique I used above works ok for
   Android, but not for iPhone which seems to somehow reuse the
   windows/listeners. I've made the fix conditional for Android only
   in my code and both seem to now work as expected.</p></div></li>
<li>Bill Dawson 2011-04-15

    <div><p>To QA:</p>
    <p>To test this, use attached CloseTest.zip (import the project
    therein). When you run it, you <strong>should</strong> see only one
    close event (in the console / logcat) when you close the windows
    that are opened with the "no url" buttons -- in fact, with the
    failing version of the SDK, you'll see 3 per closure, which is a
    bug. For the "own url" windows, you <strong>should</strong> see two
    (one from an event listener created in the main window, one from an
    event listener created inside the second window's own JS file), but
    you'll see six.</p></div></li>
<li>Bill Dawson 2011-04-15

    <div><p>(from <a href=
    "/projects/32238/changesets/4ede763ab6c786a90f2e0397152d78b0a79781f5"
    title=
    "Changeset [4ede763ab6c786a90f2e0397152d78b0a79781f5]">[4ede763ab6c786a90f2e0397152d78b0a79781f5]</a>)
    [<a href="/projects/32238/tickets/1827" title=
    "Ticket #1827">#1827</a> state:fixed-in-qa] Fix multiple window
    close event firings by making sure that the multiple possible code
    paths from a window closure still only result in one close event
    being fired. <a href=
    "<a href="https://github.com/appcelerator/titanium_mobile/commit/4ede763ab6c786a90f2e0397152d78b0a79781f5" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/4ede763ab6c786a90f2e0397152d78b0a79781f5</a>">
    <a href="https://github.com/appcelerator/titanium_mobile/commit/4ede763ab6c7..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/4ede763ab6c7...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

    <div><p>confirmed on a G2 running 2.2 and a g1 running 1.6. <a href=
    "/projects/32238/changesets/INFO" title=
    "Changeset [INFO]">[INFO]</a> Titanium SDK version: 1.6.0 (12/28/10
    10:46 4ede763). results as Bill describes.</p></div></li>
<li>Wilson Luu 2012-01-10

    Reopening bug. Both test cases attached to this bug fails in the following environment:
    
    SDK build: 1.8.0.1
    Runtime: V8, Rhino
    Titanium Studio, build: 1.0.8.201201091758
    Device: Nexus S (2.3.6)
    
    Note: For both test cases, the bug does not appear in sdk build *1.7.5*</li>
<li>Shawn Lipscomb 2012-01-16

    I get the close event twice on a heavyweight url-based window.  SDK 1.8.0.1 and 1.9.0.v20120111233134.</li>
<li>Paul Dowsett 2012-01-16

    This issue still exists for Continuous Build Titanium 1.9.0 (2012/01/16 11:16 366b32d) and v8 runtime (rhino not tested)</li>
<li>Michael Pettiford 2012-01-25

    Reopening issue
    
    Tested with Ti Studio build 1.0.8.201201210622
    Ti Mob SDK 1.8.1.v20120124200134
    OSX Lion
    
    Android Emulator 2.2
    
    Both test cases failed (fail case in description and Bill's test app) by producing two close events</li>
<li>Opie Cyrus 2012-01-25

    fixed in 1.9 master.</li>
<li>Michael Pettiford 2012-01-28

    Closing issue
    
    Tested with Ti Studio build 1.0.8.201201262211
    Ti Mob SDK 1.8.1.v20120127173134
    OSX Lion
    Nexus S OS 2.2.2
    
    Verified that only one window close event is fired</li>
<li>Michael Pettiford 2012-01-30

    Reopening/closing to add/remove labels</li>
<li>Shameer Jan 2013-12-10

    Anvil testcase PR <a href="https://github.com/appcelerator/titanium_mobile/pull/4967" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4967</a>
    </li>
</ol>


<p><a href="/TIMOB/TIMOB-1827.json">JSON Source</a></p>