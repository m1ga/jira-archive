---
title: "[TIMOB-1945] Android: tableview .setData while view being assembled can cause IndexOutOfBoundsException"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:57:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:06:16.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:57:37.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Using this failcase app.js, tap very quickly from one tab to
another. If you do it fast enough, you will cause a crash:</p>
<pre>
<code class="javascript">
Titanium.UI.setBackgroundColor('#000');

var table;

function updateTable() {
    Ti.API.info('updateTable');
    var rowcount = ((Math.floor(Math.random() * 10)) % 2 === 0) ? 5 : 500;
    var rows = [];
    table.data = [];
    for (var i = 0; i &lt; rowcount; i++) {
        var tr = Ti.UI.createTableViewRow();
        tr.leftImage = 'KS_nav_ui.png';
        tr.title = "Row " + i;
        rows.push(tr);
    }
    table.data = rows;
}

var tabGroup = Titanium.UI.createTabGroup();
tabGroup.addEventListener('focus', function(e)
{
    updateTable();
});


var win1 = Titanium.UI.createWindow({  
    title:'Tab 1',
    backgroundColor:'#fff'
});
var tab1 = Titanium.UI.createTab({  
    icon:'KS_nav_views.png',
    title:'Tab 1',
    window:win1
});

table = Ti.UI.createTableView();
win1.add(table);

var win2 = Titanium.UI.createWindow({  
    title:'Tab 2',
    backgroundColor:'#fff'
});
var tab2 = Titanium.UI.createTab({  
    icon:'KS_nav_ui.png',
    title:'Tab 2',
    window:win2
});

tabGroup.addTab(tab1);  
tabGroup.addTab(tab2);  
tabGroup.open();</code>
</pre>
<p>The problem appears to be that <code>.setData</code> is not
thread safe. It can be called in quick succession from different
threads. While one of the threads is in the part of the method that
calls <code>updateView()</code>, the other thread can "pull the
data out from underneath it", so to speak, by calling
<code>.setData</code> again.</p></div>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/d398c65d1f3fbd322582ec0441b0ba0f254bb472"
   title=
   "Changeset [d398c65d1f3fbd322582ec0441b0ba0f254bb472]">[d398c65d1f3fbd322582ec0441b0ba0f254bb472]</a>)
   [<a href="/projects/32238/tickets/1945" title=
   "Ticket #1945">#1945</a> state:fixed-in-qa] Synchronize methods
   that both insert/delete rows (or replace the row data completely)
   and call updateView, so that the data cannot be again changed while
   updateView is still running. <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/d398c65d1f3fbd322582ec0441b0ba0f254bb472" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/d398c65d1f3fbd322582ec0441b0ba0f254bb472</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/d398c65d1f3fb..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/d398c65d1f3fb...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>1.4.2.4ce7ff G1 running 1.6, 2.2 simulator</p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>Ti Mobile sdk 1.5.0.02c264</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-1945.json">JSON Source</a></p>