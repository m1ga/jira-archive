---
title: "[TIMOB-10093] Android: HTTPClient leaks function callbacks (ex: onload, ondatastream)"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-08-14T16:01:18.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-16 API, Release 3.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>core, module_xml, qe-review, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Josh Roesslein</td></tr>
<tr><th>Assignee</th><td>Josh Roesslein</td></tr>
<tr><th>Created</th><td>2012-07-23T13:19:17.000+0000</td></tr>
<tr><th>Updated</th><td>2013-09-05T17:37:39.000+0000</td></tr>
</table>

<h3>Description</h3>

It appears the HTTPClient never releases the function callbacks for on*** events (ex: onload).
This can lead to memory referenced by variables in this function's scope getting leaked.

Create an application with the attached app.js script.

1. Run the application and monitor with DDMS.
2. Click "Send XHR Request".
3. Repeat step #2 and see if the heap size continues to grow out of control.

Expected: Memory referenced by the function callback should eventually get collected.
Actual: Memory is never collected causing the heap to grow indefinitely.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-10093_29962/app.js">app.js</td></td><td>2012-07-23T13:19:30.000+0000</td><td>868</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Josh Roesslein 2012-07-23

   Another cause of the memory leak seen in TIMOB-10040.</li>
<li>Josh Roesslein 2012-08-07

   Created [PR #2687](<a href="https://github.com/appcelerator/titanium_mobile/pull/2687)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2687)</a> to resolve issue.</li>
<li>Josh Roesslein 2012-08-14

   Created [PR #2746](<a href="https://github.com/appcelerator/titanium_mobile/pull/2746)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2746)</a> to back port fix into 2_1_X.</li>
<li>Satyam Sekhri 2012-09-10

   The referenced memory gets collected.
   Verified on:
   Titanium Studio: 2.1.3.201209071738
   Titanium SDK: 2.2.0.v20120907162025
   Android Emulator v2.3
   Runtime: v8</li>
<li>jordi domenech 2012-11-13

   In TiHTTPClient.java, method setReadyState, you're calling:
   
   dispatchCallback("onreadystatechanged", null);
   
   but is "onreadystatechange" <-- notice there's no -d </li>
<li>Josh Roesslein 2012-11-13

   Jordi, you saved the day! Thanks for catching this regression and typo.
   I have opened TIMOB-11751 to resolve this bug.</li>
</ol>


<p><a href="/TIMOB/TIMOB-10093.json">JSON Source</a></p>