---
title: "[TIMOB-10157] iOS: Web View beforeload event fires when clicking on links that link within the same web page."
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2012-08-24T16:40:51.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.0.2, Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-17 API</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>api</td></tr>
<tr><th>Reporter</th><td>Betty Tran</td></tr>
<tr><th>Assignee</th><td>Blain Hamon</td></tr>
<tr><th>Created</th><td>2012-07-26T10:22:40.000+0000</td></tr>
<tr><th>Updated</th><td>2013-03-13T15:05:36.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

The beforeload event fires when we click on links that link to anchors within the same currently loaded web page. No loading is occurring when we navigate within the same web page as the page is already loaded but the event still fires.

<h4>Code to reproduce</h4>

<code><pre>
var webview = Ti.UI.createWebView({
	height: Ti.UI.FILL,
	width: Ti.UI.FILL,
	url: '<a href="https://raw.github.com/gist/22a51c5d42ebdf3e47f2/31858a3f1e119825497164fc03c4e47cd8fd0aef/bacon.html" rel="nofollow" target="_blank">https://raw.github.com/gist/22a51c5d42ebdf3e47f2/31858a3f1e119825497164fc03c4e47cd8fd0aef/bacon.html</a>'
});

webview.addEventListener('beforeload', function(e){
	alert('hi');
});

var win = Ti.UI.createWindow();
win.open();
win.add(webview);

</pre></code>

<h4>Steps to reproduce</h4>

1. When the app starts 'beforeload' event is fired as expected.
2. Click on a link.
3. 'beforeload' event is fired.

<h4>Expected result</h4>

'beforeload' event is fired before the web view starts to load the web page contents. The event should not be fired when navigating within the page as the page is not reloaded.


<h3>Comments</h3>

<ol>
<li>Blain Hamon 2012-08-21

   This is due to Apple's [native implementation](<a href="https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIWebViewDelegate_Protocol/Reference/Reference.html#//apple_ref/occ/intf/UIWebViewDelegate)." rel="nofollow" target="_blank">https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIWebViewDelegate_Protocol/Reference/Reference.html#//apple_ref/occ/intf/UIWebViewDelegate).</a> We could surpress this event, in fact I recall a pull for this, but the pull needed rewriting (It would accidentally surpress actual new page loads that happened to have a hash in it). I suppose the first question is how one determines if it's the same page, and does it surpress it for when you're intentionally reloading the page?</li>
<li>Blain Hamon 2012-08-23

   [2:56pm] srahim: bhamon: are you working on Timob-10157 ?
   [2:56pm] bhamon: You can grab it. I was poking about as to what defines a new load.
   [2:56pm] bhamon: Because having a hash does not necessarily mean it's not a load.
   [2:57pm] bhamon: For example, going from <a href="https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIWebViewDelegate_Protocol/Reference/Reference.html" rel="nofollow" target="_blank">https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIWebViewDelegate_Protocol/Reference/Reference.html</a> to <a href="https://developer.apple.com/library/ios/" rel="nofollow" target="_blank">https://developer.apple.com/library/ios/</a>, despite it being just cropping off the #, IS a new load.
   [2:58pm] srahim: bhamon: hmmm. interesting.
   [2:59pm] srahim: bhamon: so is there even a possible solution for this ?
   [2:59pm] bhamon: Yeah. I should note that.
   [2:59pm] bhamon: Not sure.
   [2:59pm] bhamon: Too too easy to have a false negative and suppress a proper load.
   [2:59pm] srahim: bhamon: that is true. looking at edge cases for it can lead to lot of false negatives.</li>
<li>Sabil Rahim 2012-08-24

   We fire the <code>beforeload</code> event before a web view begins loading a frame. This happens regardless if you open a link or click on anchor to the same page and there is not much that can be done from the native side. As we fire of these events from the native webview delegate 
   <code>- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType;</code>
    Trying to see if this load events are called from the same page would most probably lead to more false negatives and can cause regressions. 
   For example the following url  <a href="https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIWebViewDelegate_Protocol/Reference/Reference.html" rel="nofollow" target="_blank">https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIWebViewDelegate_Protocol/Reference/Reference.html</a> has a # tag indicating that it might be an anchor but if you try removing <a href="https://developer.apple.com/library/ios/" rel="nofollow" target="_blank">https://developer.apple.com/library/ios/</a> , would take you to diff page all together. 
   
   The best option left would be  for the developer to identify this in javascript using the <code>beforeLoad</code> events <code>navigationType</code> property, which gives info about the type of navigation that is being handled .
   navigationType would relate to :
     0 -  UIWebViewNavigationTypeLinkClicked, - User tapped a link.
     1 -  UIWebViewNavigationTypeFormSubmitted, - User submitted a form.
     2 -  UIWebViewNavigationTypeBackForward, - User tapped the back or forward button.
     3 -  UIWebViewNavigationTypeReload, - User tapped the reload button.
     4 -  UIWebViewNavigationTypeFormResubmitted, - User resubmitted a form.
     5 -  UIWebViewNavigationTypeOther - Some other action occurred.
   
   So marking this bug as invalid.</li>
<li>Natalie Huynh 2012-12-04

   Closing as invalid</li>
</ol>


<p><a href="/TIMOB/TIMOB-10157.json">JSON Source</a></p>