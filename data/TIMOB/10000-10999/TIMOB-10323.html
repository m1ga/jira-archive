---
title: "[TIMOB-10323] MobileWeb: WebView - Ti is not defined in a script in a webview"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-03-23T02:24:29.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0, Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>2014 Sprint 05, 2014 Sprint 05 Tooling, Release 3.3.0</td></tr>
<tr><th>Components</th><td>MobileWeb</td></tr>
<tr><th>Labels</th><td>core, mobileweb, qe-closed-3.3.0, qe-testadded, supportTeam</td></tr>
<tr><th>Reporter</th><td>Jon Alter</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2012-08-06T11:25:31.000+0000</td></tr>
<tr><th>Updated</th><td>2014-05-06T23:07:40.000+0000</td></tr>
</table>

<h3>Description</h3>

Unable to run anything Ti in a webView (We should be able to use info and fireEvent).

<h4>Steps to reproduce:</h4>
1. Run the code below
2. notice the error: "Ti is not defined"

<h4>app.js</h4>
<code><pre>
var win = Ti.UI.createWindow();
win.open();

var webView = Ti.UI.createWebView({
	url: 'test.html'
});
win.add(webView);
</pre></code>

<h4>test.html</h4>
<code><pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Webview Logging&lt;/title&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
	&lt;script&gt;

	Ti.API.log("info","1. webview: this should go to DEBUG log");
	Ti.API.info("2. webview: this should not crash. double backslashes: \\\\");
	Ti.API.info("3. webview: this should not crash. carriage returns \n\r");
	Ti.API.info("4. webview: this should not crash. forward slashes: //");
	Ti.API.info("5. webview: this should not crash. urls! <a href="http://www.appcelerator.com/?foo=bar&t=1" rel="nofollow" target="_blank">http://www.appcelerator.com/?foo=bar&t=1</a>^");
	Titanium.API.info("6. webview:Welcome  餵 こんにちは 안녕하세요 Привет Γειά हैलो สวัสดี שלום");
	Titanium.API.info("7. webview:Testing various unicode encodings: ⓼ ⑆ ش Ⴔ € ぇ ⌘ ᚎ ᑺ ༀ Җ ℥ \"'\" ?");
	Ti.API.info("8. webview: this should not crash. kanji: ド標準第5版の刊行を大いに");

	// TEST for backslash encoding issue over the bridge
	Titanium.API.info("9. webview:Testing Backslash =&gt; {\\}");
	Titanium.API.info("10. webview:Testing New Line =&gt; {\n}");

	&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;Look at the log and make sure you see 10 log statements with webview: prefix.&lt;/div&gt;
	&lt;div&gt;Look ma... UTF-8&lt;/div&gt;
	&lt;div&gt; 餵 こんにちは 안녕하세요 Привет Γειά हैलो สวัสดี שלום&lt;/div&gt;
	&lt;div&gt; ⓼ ⑆ ش Ⴔ € ぇ ⌘ ᚎ ᑺ ༀ Җ ℥&lt;/div&gt;
	&lt;div&gt; ド標準第5版の刊行を大いに &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></code>

<h3>Comments</h3>

<ol>
<li>Bryan Hughes 2012-08-09

   Edited the wrong ticket by accident.</li>
<li>Chris Barber 2012-08-09

   As documented in the Mobile Web limitations wiki page, if you want to execute code in a WebView that uses the Ti or Titanium globals, you MUST wrap your code in an onload handler.
   
   Furthermore, some browsers will fire the window.onload event before the iframe's load event, so you'll need to wrap the code again in a setTimeout():
   
   <code><pre>
   window.onload = function() {
       setTimeout(function() {
           Ti.API.log("hi from the webview");
       }, 25);
   };
   </pre></code></li>
<li>Jon Alter 2012-09-17

   This seeing this issue
   
   <h4>test.html</h4>
   <code><pre>
   &lt;html&gt;
   &lt;head&gt;
   	&lt;title&gt;Webview Logging&lt;/title&gt;
   	&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
   	&lt;script&gt;
   	window.onload = function() {
   	    setTimeout(function() {
   	        Ti.API.log("hi from the webview");
   	    }, 25);
   	};
   	&lt;/script&gt;
   &lt;/head&gt;
   &lt;body&gt;
   	&lt;div&gt;Look at the log and make sure you see 10 log statements with webview: prefix.&lt;/div&gt;
   	&lt;div&gt;Look ma... UTF-8&lt;/div&gt;
   	&lt;div&gt; 餵 こんにちは 안녕하세요 Привет Γειά हैलो สวัสดี שלום&lt;/div&gt;
   	&lt;div&gt; ⓼ ⑆ ش Ⴔ € ぇ ⌘ ᚎ ᑺ ༀ Җ ℥&lt;/div&gt;
   	&lt;div&gt; ド標準第5版の刊行を大いに &lt;/div&gt;
   &lt;/body&gt;
   &lt;/html&gt;
   </pre></code></li>
<li>Chris Barber 2014-03-04

   Master pull request: <a href="https://github.com/appcelerator/titanium_mobile/pull/5423" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5423</a>
   3_2_X_hybrid pull request: <a href="https://github.com/appcelerator/titanium_mobile/pull/5424" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5424</a></li>
<li>Chris Barber 2014-03-04

   Here's the test case:
   
   <h4>app.js</h4>
   
   <code><pre>
   var win = Titanium.UI.createWindow({
       backgroundColor: '#fff'
   });
   
   Ti.App.addEventListener('foo', function (evt) {
   	console.log(evt);
   });
   
   var webview = Ti.UI.createWebView({
   	url: 'test.html'
   });
   
   win.add(webview);
   
   win.open();
   </pre></code>
   
   <h4>test.html</h4>
   
   <code><pre>
   &lt;!DOCTYPE html&gt;
   &lt;html&gt;
   &lt;body&gt;
   
   &lt;script&gt;
   window.onload = function () {
   	setTimeout(function () {
   		Ti.API.log('it works!', Date.now());
   	}, 0);
   
   };
   
   function foo() {
   	Ti.API.log('it works!', Date.now());
   	Ti.App.fireEvent('foo', { data: 123 });
   }
   &lt;/script&gt;
   
   &lt;button id="mybutton" onclick="foo()"&gt;click me&lt;/button&gt;
   
   &lt;/body&gt;
   &lt;/html&gt;
   </pre></code>
   
   <h4>Expected Result</h4>
   
   In the console:
   
   <code><pre>
   [INFO] Appcelerator Titanium 3.3.0 Mobile Web
   [INFO] it works! 1393968546491
   </pre></code>
   
   Then click the button:
   
   <code><pre>
   [INFO] it works! 1393968547423 (index):2591
   Object {data: 123, source: Object, type: "foo"}
   </pre></code>
   
   NOTE: The number is a timestamp that will obviously be different for you.</li>
<li>Olga Romero 2014-05-06

   Used [~cbarber] test case
   Mac osx 10.9.2 Mavericks
   Appcelerator Studio, build: 3.3.0.201405011408
   Titanium SDK, build: 3.3.0.v20140505115416
   Node.JS Version: v0.10.13
   NPM Version: 1.3.2
    acs@1.0.14
    alloy@1.4.0-dev
    npm@1.3.2
    titanium@3.3.0-dev
    titanium-code-processor@1.1.1
   Safari 7.0.3
   Chrome 34.0.1847.131
   Verified the expected result is correct.
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-10323.json">JSON Source</a></p>