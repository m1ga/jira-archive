---
title: "[TIMOB-10351] Android: Timers (setTimeout, setInterval) leak memory."
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-08-14T16:21:48.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-16 API, Release 2.1.2, Release 3.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>core, module_titanium, qe-review, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Josh Roesslein</td></tr>
<tr><th>Assignee</th><td>Josh Roesslein</td></tr>
<tr><th>Created</th><td>2012-08-08T12:30:54.000+0000</td></tr>
<tr><th>Updated</th><td>2012-09-11T09:49:40.000+0000</td></tr>
</table>

<h3>Description</h3>

Timers on Android currently never release the callback function
once the timer has finished (fired once or was cancelled). A leak will
be created since the callback function and any objects it retains will never get collected.

<h4>Timer leak example</h4>

<code><pre>
function startTimer() {
  // 1 mb buffer
  var buffer = Ti.createBuffer({length: 1024 * 1024});

  setTimeout(function() {
    alert('Buffer: length = ' + buffer.length);
  }, 2000);
}

var win = Ti.UI.createWindow();

var startTimerButton = Ti.UI.createButton({title: 'Start timer'});
startTimerButton.addEventListener('click', startTimer);
win.add(startTimerButton);

win.open();
</pre></code>

1. Run the test code and monitor the heap usage with DDMS.
2. Click the "Start timer" button and wait for an alert.
3. Dismiss the alert once it is shown and check the heap usage in DDMS.
4. Repeat steps 2-3 and watch for heap growth.

Expected: No long term growth in heap size should happen. It should reach a equilibrium.
Actual: The heap grows indefinitely eventually running out of memory.


<h3>Comments</h3>

<ol>
<li>Josh Roesslein 2012-08-08

   Created [PR #2703](<a href="https://github.com/appcelerator/titanium_mobile/pull/2703)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2703)</a> to resolve issue.</li>
<li>Josh Roesslein 2012-08-14

   Created [PR #2748](<a href="https://github.com/appcelerator/titanium_mobile/pull/2748)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2748)</a> to back port fix into 2.1.2 release.</li>
<li>Olga Romero 2012-08-15

   Verified fix with:
   Titanium Studio, build: 2.1.1.201207271312
   Titanium SDK: 2.1.2.v20120815081613
   Devices:
   Droid 2.2.3
   Nexus7 4.1
   Mac osx 10.8 Mountain Lion</li>
</ol>


<p><a href="/TIMOB/TIMOB-10351.json">JSON Source</a></p>