---
title: "[TIMOB-10445] Android: TableView "data" creation arg rows never get released even if complete row set is replaced later using setData"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2015-11-05T00:36:11.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>core, dev-investigate</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2012-08-14T14:50:21.000+0000</td></tr>
<tr><th>Updated</th><td>2015-11-05T00:36:11.000+0000</td></tr>
</table>

<h3>Description</h3>

If you use set a table view's initial set of rows using the <code>data</code> property of a creation-time argument object (e.g. <code>Ti.UI.createTableView({data: rows});</code> the rows that you set there never seemed to be released from memory if the tableview is in the current scope.

<h4>Test case</h4>

This test case requires that you know DDMS and MAT (Memory Analyzer Tool).  No instructions are provided for that.

1. Use this app.js in a new app:

<code><pre>

setInterval(function(){},1000);
var ROWS = 200;
var DATA_AT_CREATION = true;
Titanium.UI.setBackgroundColor('#333');

var win = Ti.UI.createWindow({
	exitOnClose: true,
	title:'Test',
	backgroundColor:'#333',
	orientationModes: [Ti.UI.PORTRAIT]
});
win.add(Ti.UI.createLabel({
	left: "8dp", right: "8dp", top: "8dp", height: "48dp",
	text: DATA_AT_CREATION ? "Initial data set at creation time" :
		"Initial data set via setData after creation"
}));

var tv, btnBuild, btnTeardown;
var iter = 0;

var buildup = function() {
	iter++;
	var rows=[], i;

	for (i = 0; i &lt; ROWS; i++) {
		rows.push(
			Ti.UI.createTableViewRow({
				title: "Iter " + iter + "; Row " + (i + 1),
				height: "48dp"
		}));
	}
	return rows;
};

if (DATA_AT_CREATION) {
	win.add(tv = Ti.UI.createTableView({
		top: "64dp", bottom: "64dp", data: buildup()
	}));
} else {
	win.add(tv = Ti.UI.createTableView({
		top: "64dp", bottom: "64dp"
	}));
	tv.setData(buildup());
}

win.add(btnBuild = Ti.UI.createButton({
	bottom: "8dp", height: "48dp", left: "16dp", width: "112dp",
	title: "Build up"
}));

win.add(btnTeardown = Ti.UI.createButton({
	bottom: "8dp", height: "48dp", left: "144dp", width: "112dp",
	title: "Tear down"
}));

btnBuild.addEventListener("click", function() {
	tv.setData(buildup());
});

btnTeardown.addEventListener("click", function() {
	tv.setData([Ti.UI.createTableViewRow({title: "empty"})]);
});

win.open();
</pre></code>

2. Run the app and click "Build up" several times (5 times is fine).  Each time you click that you replace the rows in the table view with 200 new rows.

3. Click "Tear down"

4. Let the device/emulator idle for 40 seconds (this gives extra opportunities for the V8 GC to run.)

5. In DDMS, find the running app, turn on heap updates for it, and cause GCs until the heap size stabilizes.

6. Export the HPROF for MAT.

7. In MAT, get a dominator tree and sort it by package.

8. Find the ti.* packages, and drilldown to ti.modules.titanium.ui.

9. Look at the number of TableViewProxy objects: there will probably be about 211, even though there is only 1 row in the table after you click that "Tear down" button.  When testing a fix, this number should be down at 11 or so.

<h4>Compare to using setData</h4>

1. Change the constant <code>DATA_AT_CREATION</code> to <code>false</code> up near the top of app.js.

2. Follow steps 2-8 from above.  This time when you check the number of TableViewProxy objects, it should be 11 or so.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-10445_57267/Eclipse_Memory_Analyzer.png">Eclipse_Memory_Analyzer.png</td></td><td>2015-11-05T00:29:01.000+0000</td><td>187066</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2012-08-14

   Note that this could be a general thing about proxy creation args; I just happened to notice it with TableView.</li>
<li>Ingo Muschenetz 2014-04-14

   Needs investigation to see if it still exists.</li>
<li>Wilson Luu 2015-11-05

   Closing ticket as cannot reproduce. Verified that the TableViewProxy object count is consistently below 11 in the following scenarios (using the above steps):
   * Setting the <code>DATA_AT_CREATION</code> to true
   * Setting the <code>DATA_AT_CREATION</code> to false
   * <code>Build up</code> five times and more
   * Tested against Android device and Genymotion running 4.4.X
   * See !Eclipse_Memory_Analyzer.png|thumbnail!
   
   *Tested on:*
   
   Appcelerator Studio, build: 4.4.0.201511040454
   Appc CLI NPM: 4.2.1
   Appc CLI Core: 5.1.0-42
   Arrow: 1.3.18
   SDK: 5.1.0.v20151104110027
   Node: v4.2.1
   OS: El Capitan (10.11.1)
   Devices: Samsung Galaxy S5 (4.4.2), Genymotion Emulator (4.4.4)
   
   *Notes for getting HPROF from DDMS:*
   * You will need to enable your Titanium app for Android debugging; add this in tiapp.xml:
   <code><pre>
   &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
           &lt;manifest&gt;
               &lt;application android:debuggable="true"/&gt;
           &lt;/manifest&gt;
       &lt;/android&gt;
   </pre></code>
   * Here is the link to the stand-alone memory analyzer: <a href="https://eclipse.org/mat/downloads.php." rel="nofollow" target="_blank">https://eclipse.org/mat/downloads.php.</a>
   * Once you have obtained the .hprof file from DDMS, you will need to convert it with Android tool's <code>hprof-conv</code> .</li>
</ol>


<p><a href="/TIMOB/TIMOB-10445.json">JSON Source</a></p>