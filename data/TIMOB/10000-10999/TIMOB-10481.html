---
title: "[TIMOB-10481] iOS: Audio recording functionality only works up-to SDK v2.0.2 GA"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2012-08-20T11:17:49.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0, Release 2.1.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>api</td></tr>
<tr><th>Reporter</th><td>Nikhil Sharma</td></tr>
<tr><th>Assignee</th><td>Sabil Rahim</td></tr>
<tr><th>Created</th><td>2012-08-16T18:18:22.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-09T23:10:49.000+0000</td></tr>
</table>

<h3>Description</h3>

Audio recording functionality doesn't work after the Ti SDK 2.0.2.GA.

<h4>Repo Steps</h4>
1. Run the below code in your app.js
2. Open the application and you can't record the audio.

<code><pre>
var win = Titanium.UI.createWindow();

Titanium.Media.audioSessionMode = Ti.Media.AUDIO_SESSION_MODE_PLAY_AND_RECORD;
var recording = Ti.Media.createAudioRecorder();
Ti.Media.addEventListener('recordinginput', function(e) {
	Ti.API.info('Input availability changed: '+e.available);
	if (!e.available && recording.recording) {
		b1.fireEvent('click', {});
	}
});

var file;
var timer;
var sound;


var label = Titanium.UI.createLabel({
	text:'',
	top:150,
	color:'#999',
	textAlign:'center',
	width:'auto',
	height:'auto'
});

win.add(label);

function lineTypeToStr()
{
	var type = Ti.Media.audioLineType;
	switch(type)
	{
		case Ti.Media.AUDIO_HEADSET_INOUT:
			return "headset";
		case Ti.Media.AUDIO_RECEIVER_AND_MIC:
			return "receiver/mic";
		case Ti.Media.AUDIO_HEADPHONES_AND_MIC:
			return "headphones/mic";
		case Ti.Media.AUDIO_HEADPHONES:
			return "headphones";
		case Ti.Media.AUDIO_LINEOUT:
			return "lineout";
		case Ti.Media.AUDIO_SPEAKER:
			return "speaker";
		case Ti.Media.AUDIO_MICROPHONE:
			return "microphone";
		case Ti.Media.AUDIO_MUTED:
			return "silence switch on";
		case Ti.Media.AUDIO_UNAVAILABLE:
			return "unavailable";
		case Ti.Media.AUDIO_UNKNOWN:
			return "unknown";
	}
}

var linetype = Titanium.UI.createLabel({
	text: "audio line type: "+lineTypeToStr(),
	bottom:20,
	color:'#999',
	textAlign:'center',
	width:'auto',
	height:'auto'
});

win.add(linetype);

var volume = Titanium.UI.createLabel({
	text: "volume: "+Ti.Media.volume,
	bottom:50,
	color:'#999',
	textAlign:'center',
	width:'auto',
	height:'auto'
});

win.add(volume);

Ti.Media.addEventListener('linechange',function(e)
{
	linetype.text = "audio line type: "+lineTypeToStr();
});

Ti.Media.addEventListener('volume',function(e)
{
	volume.text = "volume: "+e.volume;
});

var duration = 0;

function showLevels()
{
	var peak = Ti.Media.peakMicrophonePower;
	var avg = Ti.Media.averageMicrophonePower;
	duration++;
	label.text = 'duration: '+duration+' seconds\npeak power: '+peak+'\navg power: '+avg;
}

var b1 = Titanium.UI.createButton({
	title:'Start Recording',
	width:200,
	height:40,
	top:20
});
b1.addEventListener('click', function()
{
	if (recording.recording)
	{
		file = recording.stop();
		b1.title = "Start Recording";
		b2.show();
		pause.hide();
		clearInterval(timer);
		Ti.Media.stopMicrophoneMonitor();
	}
	else
	{
		if (!Ti.Media.canRecord) {
			Ti.UI.createAlertDialog({
				title:'Error!',
				message:'No audio recording hardware is currently connected.'
			}).show();
			return;
		}
		b1.title = "Stop Recording";
		recording.start();
		b2.hide();
		pause.show();
		Ti.Media.startMicrophoneMonitor();
		duration = 0;
		timer = setInterval(showLevels,1000);
	}
});
win.add(b1);

var pause = Titanium.UI.createButton({
	title:'Pause recording',
	width:200,
	height:40,
	top:80
});
win.add(pause);
pause.hide();

pause.addEventListener('click', function() {
	if (recording.paused) {
		pause.title = 'Pause recording';
		recording.resume();
		timer = setInterval(showLevels,1000);
	}
	else {
		pause.title = 'Unpause recording';
		recording.pause();
		clearInterval(timer);
	}
});

var b2 = Titanium.UI.createButton({
	title:'Playback Recording',
	width:200,
	height:40,
	top:80
});

win.add(b2);
b2.hide();
b2.addEventListener('click', function()
{
	if (sound && sound.playing)
	{
		sound.stop();
		sound.release();
		sound = null;
		b2.title = 'Playback Recording';
	}
	else
	{
		Ti.API.info("recording file size: "+file.size);
		sound = Titanium.Media.createSound({sound:file});
		sound.addEventListener('complete', function()
		{
			b2.title = 'Playback Recording';
		});
		sound.play();
		b2.title = 'Stop Playback';
	}
});

var switchLabel = Titanium.UI.createLabel({
	text:'Hi-fidelity:',
	width:'auto',
	height:'auto',
	textAlign:'center',
	color:'#999',
	bottom:115
});
var switcher = Titanium.UI.createSwitch({
	value:false,
	bottom:80
});

switcher.addEventListener('change',function(e)
{
	if (!switcher.value)
	{
		recording.compression = Ti.Media.AUDIO_FORMAT_ULAW;
	}
	else
	{
		recording.compression = Ti.Media.AUDIO_FORMAT_LINEAR_PCM;
	}
});
win.add(switchLabel);
win.add(switcher);
win.open();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Blain Hamon 2012-08-17

   The support link hints to an exception raised by the audio driver within simulator. Is this the case in the TIMOB?
   
   If so, this may be an Apple bug in simulator.
   
   <a href="https://discussions.apple.com/thread/3819439?start=0&tstart=0" rel="nofollow" target="_blank">https://discussions.apple.com/thread/3819439?start=0&tstart=0</a>
   <a href="http://pastebin.com/jqfPcA8g" rel="nofollow" target="_blank">http://pastebin.com/jqfPcA8g</a>
   <a href="http://www.openradar.me/10555404" rel="nofollow" target="_blank">http://www.openradar.me/10555404</a>
   </li>
<li>Neeraj Gupta 2012-08-17

   @Nikhil - Please confirm if the customer encounters this issue with the simulator or the device. This is an Apple bug if it occurs only on simulator.</li>
<li>Sabil Rahim 2012-08-20

   It seems like the recording works fine on both simulator and on device . Though the test case is wrong, when trying to playback the recorded file they are trying to create a media sound file by passing  <code>sound</code> property the recorded file. The sound property doesnot exist in our platform and instead <code>url</code> property should be used. try using the following code .
   
   <code><pre>
   //At line 178
   sound = Titanium.Media.createSound({url:file});
   </pre></code> 
   
   Tested on:
   Xcode 4.4
   iOS Sim . 4.3 and 5.0
   device : iPhone 4S running 5.1
   TiSDK : 2.2.0(master||commit:f51fd8cafaa84541470d1687c0e1aa9620289c8c) as on 08.20.2012
   
   Marking ticket as invalid.</li>
<li>Lee Morris 2017-03-09

   Closing ticket as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-10481.json">JSON Source</a></p>