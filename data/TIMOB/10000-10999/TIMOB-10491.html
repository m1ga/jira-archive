---
title: "[TIMOB-10491] iOS: Changes to how iOS does require in 2.2 have broken require "
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-12-21T05:25:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-17 Core, Release 3.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>core, module_require, qe-review, qe-testadded, regression</td></tr>
<tr><th>Reporter</th><td>Russell McMahon</td></tr>
<tr><th>Assignee</th><td>Max Stepanov</td></tr>
<tr><th>Created</th><td>2012-08-17T19:00:27.000+0000</td></tr>
<tr><th>Updated</th><td>2012-12-21T05:25:09.000+0000</td></tr>
</table>

<h3>Description</h3>

When running Alloy on iOS 2.2.0 master the alloy.js commonjs module can not be found. It is required in as require('alloy') other modules are loading okay. The path to alloy.js is Resources/alloy.js there is also a folder alloy.

<h3>Comments</h3>

<ol>
<li>Tony Lukasavage 2012-08-21

   Here's a minimal test case that is *NOT* alloy specific. The name alloy is used for the modules and it uses a similar structure, but this is pure Titanium code. These following three files do not require Alloy to show the following error:
   
   {quote}
   [ERROR] Script Error = Couldn't find module: alloy
   2012-08-21 19:05:31.125 testRequireBug[28934:1a70b] *** Terminating app due to uncaught exception of class '__NSCFString'
   terminate called throwing an exception
   [INFO] Application has exited from Simulator
   {quote}
   
   <h4>Test Case</h4>
   
   <h4>app.js</h4>
   
   <code><pre>
   require('alloy').getController('index');
   </pre></code>
   
   <h4>alloy.js</h4>
   
   <code><pre>
   exports.getController = function(name, args) {
       return new (require("alloy/controllers/" + name))(args); 
   }
   </pre></code>
   
   <h4>alloy/controllers/index.js</h4>
   
   <code><pre>
   var Alloy = require('alloy'); // commenting this line avoids the error
   module.exports = function Controller() {};
   </pre></code></li>
<li>Tony Lukasavage 2012-08-21

   It is also worth nothing that Alloy works fine with the lastest TiSDK 2.2.0 with Android and Mobileweb. Alloy actually worked with iOS on 2.2.0 up until about a week or two ago.</li>
<li>Russell McMahon 2012-08-21

   Looking at the code with Blain it appears that perhaps the commonjs spec may not have been followed as intended in the latest iOS code. Please see #4, #5 below as it talks about top level modules:
   
   CommonJS 1.1 Spec - Module Identifiers
   1) A module identifier is a String of "terms" delimited by forward slashes.
   2) A term must be a camelCase identifier, ".", or "..".
   3) Module identifiers may not have file-name extensions like ".js".
   4) Module identifiers may be "relative" or "top-level". A module identifier is "relative" if the first term is "." or "..".
   5) Top-level identifiers are resolved off the conceptual module name space root.
   6) Relative identifiers are resolved relative to the identifier of the module in which "require" is written and called.</li>
<li>Max Stepanov 2012-08-22

   PR pending <a href="https://github.com/appcelerator/titanium_mobile/pull/2806" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2806</a></li>
<li>Blain Hamon 2012-08-23

   Pull merged.</li>
<li>Satyam Sekhri 2012-08-28

   No error shown when tested by creating a titanium app and module named alloy
   Verified on:
   Titanium Studio: 2.1.2.201208201549
   Titanium SDK: 2.2.0.v20120827143312
   iPhone Simulator (v5.1)</li>
</ol>


<p><a href="/TIMOB/TIMOB-10491.json">JSON Source</a></p>