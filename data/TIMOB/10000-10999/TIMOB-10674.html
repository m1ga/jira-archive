---
title: "[TIMOB-10674] Tooling: Add a Finalize Hook into the plugin build script"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-09-04T21:29:30.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.1, Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.0.0, Sprint 2012-18 Core, 2012 Sprint 18</td></tr>
<tr><th>Components</th><td>Tooling</td></tr>
<tr><th>Labels</th><td>core, qe-port</td></tr>
<tr><th>Reporter</th><td>Alan Leard</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2012-08-27T13:23:31.000+0000</td></tr>
<tr><th>Updated</th><td>2012-11-19T09:48:33.000+0000</td></tr>
</table>

<h3>Description</h3>

Add a "finalize" hook to the plug-in build script so that a plug-in gets a chance to cleanup in case a plug-in build exits before post-build hook is invoked.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-10674_30918/my.plugin-0.1.zip">my.plugin-0.1.zip</td></td><td>2012-08-30T17:45:33.000+0000</td><td>905</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2012-08-30

   <h4>Testing Notes</h4>
   
   * Download the attached zip file, put it in the Titanium root dir (e.g., /Library/Application Support/Titanium in OSX), and unzip it.
   
   * Verify that Titanium/plugins/my.plugin exists.
   
   * Create a new Titanium Mobile app in Titanium Studio.
   
   * It doesn't matter what's in app.js.
   
   * Edit the tiapp.xml to include reference to the plugin:
   
   <code><pre>
   &lt;plugins&gt;
     &lt;plugin version="0.1"&gt;my.plugin&lt;/plugin&gt;
   &lt;/plugins&gt;
   </pre></code>
   
   * Build the app to Android Emulator.  Watch the console to see that at the end of the build there is an INFO message indicating that the my.plugin finalize function has run.
   
   * Build the app to Android Device.  Again look for that message.
   
   * Build the app to iPhone Simulator.  After it launches, exit the simulator, check for the finalizer INFO message.
   
   * Build the app to iPhone device, and watch for the finalizer INFO message.
   
   <h4>Verify the finalize runs on failures too</h4>
   
   <h4>iPhone</h4>
   
   * I can't find a code path after the plugins are loaded in iPhone builder.py (circa line 1103) for which I can make a suggestion how to break the build easily.  So _manually_ edit iphone/builder.py in the unzipped SDK folder and add <code>raise NameError("Hi There")</code> right inside the <code>try</code> block that is circa line 1116. In case builder.py changes significantly by the time you run these tests, I mean the <code>try</code> block whose first executable statement is <code>os.chdir(iphone_dir)</code>.
   
   * Run the app to iPhone Simulator.
   
   * It should fail and you should still see the message that the plugin's finalize method is running.
   
   <h4>Android</h4>
   
   * Create a file in the app's Resources/ folder named <code>_test.js</code> (note the leading underscore).  Just put a line of Javascript in it, like maybe <code>Ti.API.info("blah");</code>.
   
   * Run the app to Android Emulator.
   
   * The build will fail (files starting with underscores are not allowed) but the plugin's finalize method should still show that it's running.</li>
<li>Bill Dawson 2012-08-30

   Pull request ready:
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/2858" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2858</a></li>
<li>Satyam Sekhri 2012-11-19

   Verified on:
   Titanium Studio: 3.0.0.201211131839
   Titanium SDK:3.0.0.v20121113170203</li>
</ol>


<p><a href="/TIMOB/TIMOB-10674.json">JSON Source</a></p>