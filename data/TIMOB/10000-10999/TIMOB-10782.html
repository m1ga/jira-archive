---
title: "[TIMOB-10782] iOS: Native Haversine formula for calculating distances inside Ti.Geolocation and Ti.Database"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>api</td></tr>
<tr><th>Reporter</th><td>Ygor Lemos</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2012-08-22T16:32:39.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T20:03:33.000+0000</td></tr>
</table>

<h3>Description</h3>

Implement a native Haversine function in ObjC or Java for better performance, allowing developers willing to implement Geolocation with distance calculations (which most do) usage to a more efficient and fast Haversine implementation.

We could map against something like:

<code><pre>
Ti.Geolocation.haversine({lat1: xxx, long1:xxx, lat2: xxx, long2: xxx, unit: 'metric'})
</pre></code>


for calculating the distance between two points in the sphere.

There are implementation examples of the Haversine formula here:

<a href="http://www.movable-type.co.uk/scripts/latlong.html" rel="nofollow" target="_blank">http://www.movable-type.co.uk/scripts/latlong.html</a>

on the wikipedia there are examples in several computer languages:

<a href="http://en.wikipedia.org/wiki/Haversine_formula" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Haversine_formula</a>


Also, there is a formula called Vincentys which is way more precise (millimetric precision) but also consumes more CPU due to the fact that it considers the real shape of the earth while Haversine considers the earth as a regular sphere (thus having an acceptable error margin).

we could also made something like *Ti.Geolocation.vincenty()* for more precise stuff.

Follows Vincenty's Formula explanations:

<a href="http://www.movable-type.co.uk/scripts/latlong-vincenty.html" rel="nofollow" target="_blank">http://www.movable-type.co.uk/scripts/latlong-vincenty.html</a>
<a href="http://en.wikipedia.org/wiki/Vincenty%27s_formulae" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Vincenty%27s_formulae</a>


------


Apart all of that we should really have a native SQL haversine formula for users that store latitude and longitude data in SQLite Databases.


So we could make queries like:

*SELECT * FROM Locations ORDER BY distance(Latitude, Longitude, 51.503357, -0.1199)*


There are ways of implementing custom functions inside the SQLite database, at least on ObjC, thus allowing for Geodesic queries inside the DB...

Take a look at this Obj-C + SQLite implementation:

<a href="http://www.thismuchiknow.co.uk/?p=71" rel="nofollow" target="_blank">http://www.thismuchiknow.co.uk/?p=71</a>




<h3>Comments</h3>

<ol>
<li>Ygor Lemos 2012-08-25

   More on the SQLite native functions:
   <a href="http://souptonuts.sourceforge.net/readme_sqlite_tutorial.html" rel="nofollow" target="_blank">http://souptonuts.sourceforge.net/readme_sqlite_tutorial.html</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-10782.json">JSON Source</a></p>