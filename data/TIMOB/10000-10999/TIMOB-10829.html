---
title: "[TIMOB-10829] Android: Case of infinite loop"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 2.1.2, Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>api, exalture</td></tr>
<tr><th>Reporter</th><td>Ivan Skugor</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2012-08-24T07:24:02.000+0000</td></tr>
<tr><th>Updated</th><td>2018-07-11T20:58:34.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>The problem</h4>


Well, I don't know how to explain the problem, or what precisely is causing it ... so it's the best if I just jump to example. :D


<h4>Test case</h4>


<code><pre>
var i = 0;

var win = {
    backgroundColor: '#000',
    __TiElement: null,
    __getTiElement: function() {
        if (!this.__TiElement) {
            this.__TiElement = Ti.UI.createWindow(this);
        }
        return this.__TiElement;
    },
    open: function() {
        Ti.API.info(i++);
        this.__getTiElement().open();
    }
};

win.open();
</pre></code>


Run this example, and you should get infinite loop (see in DDMS, i goes from 0 to infinity).



As I said, I'm not sure what's causing the problem, but it seems that "this" value is somehow set to wrong value (TiUIWindow because "win" and that causes infinite loop).


The problem can be solved if non-enumerable properties are used (by using "Object.defineProperty").


The issue does not exist on iOS.

<h3>Comments</h3>

<ol>
<li>jithinpv 2013-03-18

   infinite loop exists
   
   Issue reproduces with
   
   Titanium Studio, build: 3.0.1.201212181159
   Titanium SDK version: 3.1.0 (03/11/13 15:43 0c88429)
   Titanium SDK version: 3.0.2 (02/07/13 16:46 a4def81)
   Device: Samsung galaxy s duos Android version: 4.0.4
   
   jithinpv</li>
<li>Sunila 2013-04-03

   By giving 'this' to the createWindow, the execution context is set to 'this' which is the 'win'. so calling 'open' on the __TiElement actually calls the win.open. The behavior can be reproduced in a standalone javascript by replacing Ti.UI.createWindow(this) with 'new Object(this)' and replacing Ti.API.info with 'alert'.</li>
<li>Ivan Skugor 2013-04-03

   Hi Sunila.
   
   
   That is not the same thing. "win.open" is different function from "TiWindow.open" (at least it should be). Your explanation of the cause of infinite loop could be right, but the problem still exists (that is, it should not happen). The same thing works on iOS - how come? ;)</li>
<li>Bryan Hughes 2013-04-08

   In the above example, win.open() does NOT set the this binding to the open window, or global object, or module object (if one exists). The this binding is set to the object "win", just as you would expect. At least that is what should happen according to the ECMAScript 5 spec.
   
   This is definitely a bug in Android. I'm reopening it. If whoever works on this bug doesn't understand the details of how the this pointer is set in a function call, then come talk to me. FWIW the way that the this pointer is set in JavaScript calls is somewhat simple and _completely_ not what you would expect it to be.</li>
<li>Sunila 2013-05-07

   Looks like a JS implementation bug.</li>
<li>Christopher Williams 2018-05-11

   Man is this an oldie. Anyhow, I believe this is because Android is applying <code>this</code> to the window proxy it generates (like it applies any supplied properties, not as the context to execute under) - therefore what happens is that the window instance has it's <code>open</code> property (the native one we supply to actually open a window) replaced by the wrapper (<code>win</code> object here) <code>open</code> function. So calling open() on the window proxy is going to result in an infinite loop.
   
   This actually relates to TIMOB-5818 in that I believe this is a result of Android and iOS having different property attributes on that open method. iOS defines The open method as not being writable which is why the wrapper can't overwrite the native method.
   
   Android gives this for the property descriptor:
   <code><pre>
   open = {
     "writable": true,
     "enumerable": true,
     "configurable": true
   }
   </pre></code>
   
   While iOS gives:
   <code><pre>
   open = {
     "writable": false,
     "enumerable": false,
     "configurable": true
   }
   </pre></code>
   (And will return that for made up properties on proxies that don't actually exist!)</li>
</ol>


<p><a href="/TIMOB/TIMOB-10829.json">JSON Source</a></p>