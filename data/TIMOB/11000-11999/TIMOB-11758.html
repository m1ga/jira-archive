---
title: "[TIMOB-11758] Android: HTTPClient: the payload for the callbacks ondatastream and onsendstream is incorrectly set on Rhino"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-11-16T11:09:12.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.0.0, Release 3.1.0, 2012 Sprint 23 API, 2012 Sprint 23</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>regression</td></tr>
<tr><th>Reporter</th><td>Ping Wang</td></tr>
<tr><th>Assignee</th><td>Ping Wang</td></tr>
<tr><th>Created</th><td>2012-11-14T00:01:51.000+0000</td></tr>
<tr><th>Updated</th><td>2012-12-05T17:52:53.000+0000</td></tr>
</table>

<h3>Description</h3>

This is a regression. This does not happen on 2.1.3.GA.
Failed case 1:
<code><pre>
var xhr = Titanium.Network.createHTTPClient();

xhr.onreadystatechange = function(e) {
	Ti.API.info("************************** xhr.onreadystatechange: this.readyState = " + this.readyState);
}

xhr.ondatastream = function(e) {
	Ti.API.info("^^^^^^^^^^^^^^^^^^^^^^^^^^ xhr.ondatastream = " + e.progress);
}

xhr.open('GET','<a href="http://www.appcelerator.com/assets/The_iPad_App_Wave.pdf" rel="nofollow" target="_blank">http://www.appcelerator.com/assets/The_iPad_App_Wave.pdf</a>');
xhr.send();

</pre></code>
Failed case 2:
<code><pre>
var xhr = Titanium.Network.createHTTPClient();

xhr.onreadystatechange = function(e) {
	Ti.API.info("************************** xhr.onreadystatechange: this.readyState = " + this.readyState);
}

xhr.onsendstream = function(e) {
	Ti.API.info("-------------------------- xhr.onsendstream = " + e.progress);
}

xhr.open('POST', '<a href="https://twitpic.com/api/uploadAndPost" rel="nofollow" target="_blank">https://twitpic.com/api/uploadAndPost</a>');

var buffer = Ti.createBuffer({
	length : 1024 * 10
}).toBlob();

xhr.send({
	data : buffer,
	username : 'fgsandford1000',
	password : 'sanford1000',
	message : 'check me out'
});
</pre></code>
Actual result:
The log shows:
<code><pre>
I/TiAPI   (11891): ^^^^^^^^^^^^^^^^^^^^^^^^^^ xhr.ondatastream = undefined
</pre></code>
or
<code><pre>
I/TiAPI   (11891): -------------------------- xhr.onsendstream = undefined
</pre></code>
Expected result:
The log shows the numerical progress for datastream / sendstream.

<h3>Comments</h3>

<ol>
<li>Ping Wang 2012-11-15

   This regression is caused by [PR #2687](<a href="https://github.com/appcelerator/titanium_mobile/pull/2687)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2687)</a> .</li>
<li>Ping Wang 2012-11-15

   PR <a href="https://github.com/appcelerator/titanium_mobile/pull/3430" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/3430</a>
   Steps for FR:
   1. Run the above two test cases on both rhino and v8. Should see the value of e.progress in the log.
   2. Run Anvil -> network_httpclient on both rhino and v8. All the tests (including callbackTestForGETMethod and callbackTestForPOSTMethod) should pass.</li>
<li>Ping Wang 2012-11-27

   3_0_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/3474" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/3474</a></li>
<li>Bill Dawson 2012-11-28

   Bill is reviewing the 3_0_X PR.</li>
<li>Natalie Huynh 2012-12-05

   Tested with 3.0.0.20121204144658 on Droid 1 2.2.3 with Rhino</li>
</ol>


<p><a href="/TIMOB/TIMOB-11758.json">JSON Source</a></p>