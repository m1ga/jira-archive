---
title: "[TIMOB-12234] BlackBerry: Implement important Titanium.Geolocation functionality"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-05-25T05:12:08.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.3.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 10 BB, Release 3.3.0, Release 3.4.0</td></tr>
<tr><th>Components</th><td>BlackBerry</td></tr>
<tr><th>Labels</th><td>notable, qe-3.3.0, qe-closed-3.2.0, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Russell McMahon</td></tr>
<tr><th>Assignee</th><td>Pedro Enrique</td></tr>
<tr><th>Created</th><td>2013-01-07T13:18:54.000+0000</td></tr>
<tr><th>Updated</th><td>2014-05-30T17:05:12.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Acceptance Tests</h4>

<h4>Location event</h4>
<code><pre>
var win = Ti.UI.createWindow({
	layout: 'vertical'
});

if (!Ti.Geolocation.locationServicesEnabled) {
	alert('Please enable location services.');
}

function onLocation(e) {
    coordLabels[0].text = 'lat: ' + e.coords.latitude;
    coordLabels[1].text = 'long: ' + e.coords.longitude;
}

var geoEnabled = false;
function toggleGeo() {
	geoEnabled = !geoEnabled;
	geoEnabled ? Ti.Geolocation.addEventListener('location', onLocation)
		   : Ti.Geolocation.removeEventListener('location', onLocation);
}

var toggleButton = Ti.UI.createButton({
	title: 'Toggle Geolocation'
});
toggleButton.addEventListener('click', toggleGeo);
win.add(toggleButton);

var coordLabels = ['lat', 'long'].map(function(text) {
	var label = Ti.UI.createLabel({
		text: text,
		width: Ti.UI.FILL
	});
	win.add(label);
	return label;
});

win.open();
</pre></code>

Verify when you click the toggle button your current position is displayed and updated as you move.
Clicking the toggle again should turn off updates. Repeat a few times to verify it switches on/off.

<h4>Heading event</h4>
<code><pre>
var win = Ti.UI.createWindow({
	layout: 'vertical'
});

var headingLabel = Ti.UI.createLabel({
	text: 'heading = ',
	width: Ti.UI.FILL
});
win.add(headingLabel);

var accuracyLabel = Ti.UI.createLabel({
	text: 'accuracy = ',
	width: Ti.UI.FILL
});
win.add(accuracyLabel);

function onHeading(e) {
	headingLabel.text = 'heading = ' + e.heading.magneticHeading;
	accuracyLabel.text = 'accuracy = ' + e.heading.accuracy;
}

var compassEnabled = false;
function toggleCompass() {
	compassEnabled = !compassEnabled;
	compassEnabled ? Ti.Geolocation.addEventListener('heading', onHeading)
	               : Ti.Geolocation.removeEventListener('heading', onHeading);
}

var toggleButton = Ti.UI.createButton({
	title: 'Toggle Compass'
});
toggleButton.addEventListener('click', toggleCompass);
win.add(toggleButton);

win.open();
</pre></code>

Verify clicking the toggle button starts displaying compass heading values.
Try rotating the phone to verify the degrees changes. Click the toggle again
to verify the compass events stop.


<h3>Comments</h3>

<ol>
<li>Josh Roesslein 2013-05-09

   Created pull request [#36](<a href="https://github.com/appcelerator/titanium_mobile_blackberry/pull/36)." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_blackberry/pull/36).</a></li>
<li>Olga Romero 2013-12-10

   Tested with:
   Appcelerator Studio, build: 3.2.0.201312081316
   Titanium SDK, build: 3.2.0.v20131209110113
   CLI 3.2.0-beta
   BlackBerry Z10 10.1.0.2019
   
   <h4>To test</h4>
   add to tiapp.xml
   <code><pre>
   &lt;blackberry&gt;
       	&lt;permissions&gt;
       &lt;permission&gt;access_internet&lt;/permission&gt;
       &lt;permission&gt;access_location_services&lt;/permission&gt;
   		&lt;/permissions&gt;
       &lt;/blackberry&gt;
   </pre></code>
   
   
   </li>
<li>Olga Romero 2014-05-23

   <h4>To test</h4>
   Run the code below and click the toggle geolocation button 
   <a href="http://pastie.org/private/vnc7cbbs0vg1ziwqdof6tq" rel="nofollow" target="_blank">http://pastie.org/private/vnc7cbbs0vg1ziwqdof6tq</a>
   
   <h4>Environment</h4>
    Appcelerator Studio, build: 3.3.0.201405161313 
   Titanium SDK, build: 3.3.0.v20140523120121 
   Node.JS Version: v0.10.13 
   NPM Version: 1.3.2 
   acs@1.0.14 
   alloy@1.4.0-alpha4 
   npm@1.3.2 
   titanium@3.3.0-alpha5 
   titanium-code-processor@1.1.1
   Device: BB Z10 (10.2.1)
   
   <h4>the error</h4>
   <code><pre>
   [ERROR] trace = TypeError: Cannot read property 'latitude' of undefined
   [ERROR]     at [object Object].onLocation (app.js:18:45)
   [ERROR] line = 18
   </pre></code></li>
<li>Pedro Enrique 2014-05-25

   PR for master: <a href="https://github.com/appcelerator/titanium_mobile_blackberry/pull/246" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_blackberry/pull/246</a>
   PR for 3.3.X <a href="https://github.com/appcelerator/titanium_mobile_blackberry/pull/247" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_blackberry/pull/247</a></li>
<li>Olga Romero 2014-05-30

   Tested with
   Mac osx 10.9.3 Mavericks
   Appcelerator Studio, build: 3.3.0.201405271647
   Titanium SDK, build: 3.3.0.v20140528144113 
   Node.JS Version: v0.10.13 
   NPM Version: 1.3.2 
   acs@1.0.14 
   alloy@1.4.0-beta 
   npm@1.3.2 
   titanium@3.3.0-beta 
   titanium-code-processor@1.1.1
   Device: BB Z10 (10.2.1)
   
   Verified clicking the toggle button starts displaying compass heading values.
   Rotated the phone to verify the degrees changes. Clicked the toggle again
   to verify the compass events stop.
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-12234.json">JSON Source</a></p>