---
title: "[TIMOB-12307] Android: Refactor MenuItemProxy"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-01-18T17:34:25.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.0.2, Release 3.1.0, 2013 Sprint 02 API, 2013 Sprint 02</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>api, module_android, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Hieu Pham</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2013-01-16T15:33:53.000+0000</td></tr>
<tr><th>Updated</th><td>2013-01-24T05:49:23.000+0000</td></tr>
</table>

<h3>Description</h3>

Starting from API 11, menuItem methods must be run from the main thread, otherwise a Java exception will occur. MenuItemProxy needs to be refactor to address this issue.

Testing code: 
<code><pre>

var win1 = Ti.UI.createWindow({
    backgroundColor: 'blue',
    fullscreen: false
});
var tab1 = Ti.UI.createTab({
    window: win1,
    title: 'Tab 1'
});

var win2 = Ti.UI.createWindow({
    backgroundColor: 'yellow'
});
var tab2 = Ti.UI.createTab({
    window: win2,
    title: 'Tab 2'
});

var tabGroup = Ti.UI.createTabGroup({
	activity: {
        onCreateOptionsMenu: function(e) {
            var menu = e.menu;
            var menuItem = menu.add({
                title : "Item 1",
                itemId: 1
            });
            var menuItem2 = menu.add({
                title : "Item 2",
                itemId: 2
            });
            menuItem.addEventListener("click", function(e) {
                Ti.API.info("I was clicked");
            });
        },
        
        onPrepareOptionsMenu: function(e) {
        	var menu = e.menu;
        	if (tab1.active) {
        		menu.findItem(1).setVisible(false);
        		var menuItem2 = menu.findItem(2);
        		menuItem2.setVisible(true);
        		Ti.API.info("item2 is checked: " + menuItem2.isChecked());
        		Ti.API.info("item2 is enabled: " + menuItem2.isEnabled());
        	
        	}
        	
        	if (tab2.active) {
        	    var menuItem = menu.findItem(1);
        		menuItem.setVisible(true);
        		Ti.API.info("item1 is checked: " + menuItem.isChecked());
        		Ti.API.info("item1 is enabled: " + menuItem.isEnabled());
        		menu.findItem(2).setVisible(false);
        	}
        }
    }
});
  
tabGroup.addTab(tab1);
tabGroup.addTab(tab2);
tabGroup.open();

</pre></code>

1. Run app.js
2. Click on menu/optionMenu button: you should see Item 2 in tab1 and Item 1 in tab2. You should also see "is checked" and "is enabled" in logcat.

<h3>Comments</h3>

<ol>
<li>Ping Wang 2013-01-18

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/3619" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/3619</a>
   3_0_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/3740" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/3740</a></li>
<li>Anshu Mittal 2013-01-24

   Tested with: 
   SDK:3.1.0.v20130123144204,3.0.2.v20130123192623
   Studio:3.0.1.201212181159
   Device: Android Nexus7(v 4.1)</li>
</ol>


<p><a href="/TIMOB/TIMOB-12307.json">JSON Source</a></p>