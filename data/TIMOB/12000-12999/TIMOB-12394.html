---
title: "[TIMOB-12394] Mobile Web: Ti.Blob does not do Base64 encoding/decoding as specified in the docs"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2013-03-18T18:40:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>MobileWeb</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Yaroslav Pidstryhach</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2012-11-26T14:03:45.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-19T12:42:39.000+0000</td></tr>
</table>

<h3>Description</h3>

The Titanium documentation [implies](<a href="http://docs.appcelerator.com/titanium/2.1/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/2.1/#</a>!/api/Titanium.Utils-method-base64encode) that Mobile Web Blobs store their data in the Base64 form:

{quote}On Mobile Web, if obj is a [Titanium.Blob] containing binary data,  then obj is returned unmodified because the binary blob is already base64 encoded.{quote}

However, the current implementation of Ti.Blob on Mobile Web does not seem to apply Base64 encoding/decoding. Also, Titanium.Network.HTTPClient returns unencoded blobs (with raw binary data). 

A short code example follows. Expected behavior: 'xhr.responseData' is Base64-encoded. Actual behavior: 'xhr.responseData' is not Base64-encoded.

<code><pre>    var xhr = Titanium.Network.createHTTPClient();
     
    xhr.onload = function()
    {
        var blob = xhr.responseData;  // should be Base64-encoded, but isn't
         
        // Loading image from blob to an image view will fail, because "blob" is not Base64-encoded
        // imageView1.image = blob;
    };
     
    downloadButton.addEventListener('click',function() {
        xhr.open('GET','/images/a-logo.png');
        xhr.file = Ti.Filesystem.applicationDataDirectory + 'a-logo.png';
        xhr.send();
    });</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-12394_35070/HttpClient.zip">HttpClient.zip</td></td><td>2013-01-23T14:39:18.000+0000</td><td>3693756</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bryan Hughes 2013-01-17

   Can you attach a test case?</li>
<li>Eduard Serdyuk 2013-01-18

   This example checks Blob<code>s properties: responseData, file, nativePath
   
   Expected behavior:'responseData' will be Base64-encoded,'file' and 'nativePath' will not be undefined.
   
   Actual behavior: 'responseData' is not Base64-encoded, 'file' and 'nativePath' are undefined.
   
   &lt;code&gt;&lt;pre&gt;
   var xhr = Titanium.Network.createHTTPClient();
   	
   	xhr.onload = function()
   	{
   		var blob = xhr.responseData;
   		
   		Ti.API.info('Blob with Base64-encoded data:'+blob);
   		
   		//Load image from blob to ImageView1
   		imageView1.image = blob;
   		
   		//Check properties 'file' and 'nativePath' of Blob
   		//Properties 'file' and 'nativePath' aren</code>t set in current HttpClient 
   		if (!!blob.file) {
   			
   			Ti.API.info('File name:'+blob.nativePath);
   			
   			//load data from file to ImageView2
   			imageView2.image = blob.file.read();	
   		} else {
   			Ti.API.info("Property 'file' is missing");
   		}
   		
   	};
   	
   	downloadButton.addEventListener('click',function() {
   		xhr.open('GET','/images/a-logo.png');
   		xhr.file = Ti.Filesystem.applicationDataDirectory + 'a-logo.png';
   		xhr.send();
   	});
   </pre></code></li>
<li>Bryan Hughes 2013-01-21

   Your test case is incomplete. imageView1 and imageView2 are never defined or created. Please attach a complete test case that I can run without modification</li>
<li>Eduard Serdyuk 2013-01-21

   See attachments : ImageLoader1.zip
   </li>
<li>Bryan Hughes 2013-01-22

   The attached test case does not work in iOS. HTTPClient cannot connect because there is no server to connect to. The test case must work in iOS (and Android) so I can compare with Mobile Web.</li>
<li>Eduard Serdyuk 2013-01-23

   Attached is an improved demo for this bug. The pre-fix and post-fix behavior was verified on:
   
   - Mobile Web in MacOS (10.8.2, Safari);
   - Android 4.0.4 device;
   - Android 2.3 emulator;
   - iOS 6 simulator.
   
   Please refer to the comments in the app.js source code file for more info.</li>
<li>Bryan Hughes 2013-01-23

   For reference, we always add a link to the PR in the JIRA ticket. Please make sure to do so in the future.
   
   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/3693" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/3693</a></li>
<li>Bryan Hughes 2013-01-23

   The attached test case forks for mobile web vs iphone. That makes the comparison invalid. You need to remove all forks so that the exact same code runs on both platforms.</li>
<li>Yaroslav Pidstryhach 2013-01-23

   The fork is inevitable:
   
   <h4>Browsers will generally not open (via XMLHttpRequest) remote files from a domain that's different from the domain hosting the application. So we cannot use a public URL, and must supply a local image URL (unless you host the MW app on the public server as well).</h4>
   
   <h4>On the other hand, there's no way to use a local image URL on an Apple device (with an URL that would also work in Mobile Web).</h4>
   
   That's why we supply different URLs for different platforms. Note that the difference does not affect the functionality we're proposing to fix (Blob encoding and missing properties).</li>
<li>Bryan Hughes 2013-01-23

    You can open remote files that have CORS enabled in MW</li>
<li>Yaroslav Pidstryhach 2013-01-24

    Thanks. The sample is now updated as you requested. I cannot attach it, though, because I lack the permissions on the new location (TIMOB). I will contact you via email.</li>
<li>Bryan Hughes 2013-01-24

    In your sample app you have the following line: 
    <code><pre>
    Ti.API.info('Blob with Base64-encoded data:'+blob);
    </pre></code>
    In iOS this gives the following output:
    <code><pre>
    [INFO] Blob with Base64-encoded data:[object TiBlob]
    </pre></code>
    I'm not sure why the toString() method isn't doing something more interesting on iOS (bug perhaps?), but it nonetheless means we can't compare results. You'll need to find another way to demonstrate the parity issue.</li>
<li>Yaroslav Pidstryhach 2013-01-28

    In the pull request you commented: 
    
    "I dug into this issue a little more, and, in short, the wrong thing was fixed. HTTPClient works just fine, and Blob mostly works just fine (there are some issues with toString, but that is unrelated to this issue). The bug is in ImageView. We don't base64 encode blobs anymore, so imageview needs to be updated to base64 encode the data from blobs."
    
    Then it looks like documentation for base64encode should be updated, because it implies that blobs are always base64 encoded.</li>
<li>Bryan Hughes 2013-01-28

    Yeah, that couldn't hurt, although to be honest it shouldn't matter that much because Blob is supposed to be a black box, and it doesn't matter to users how it's implemented.</li>
<li>Daniel Sefton 2013-03-18

    Hi Bryan/Yaroslav, what are the next steps for this issue? Is this still a docs problem, or will a new pull request need to be made? Cheers.</li>
<li>Bryan Hughes 2013-03-18

    Duplicate of TIMOB-12416</li>
</ol>


<p><a href="/TIMOB/TIMOB-12394.json">JSON Source</a></p>