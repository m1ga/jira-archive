---
title: "[TIMOB-12405] Android: Titanium object modules shown retained (Memory Analyzer Tool)"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2013-02-14T22:13:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.0.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 04 Core, 2013 Sprint 04</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, module</td></tr>
<tr><th>Reporter</th><td>jordi domenech</td></tr>
<tr><th>Assignee</th><td>Allen Yeung</td></tr>
<tr><th>Created</th><td>2013-01-21T12:11:09.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-21T22:42:09.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi,

These are the steps to reproduce the problem:

1. Open Titanium Studio 
2. Create a new app w/ the Single Window app template
3. Project OS target: only Android checkbox, and no cloud settings. 
Name and id, whatever.
SDK 3.0.0.GA (check others possibilites in environment field)
4. Once created, open tiapp and replace 'android' node with this:
<code><pre> 
    &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
        &lt;manifest&gt;
            &lt;application android:debuggable="true"/&gt;
        &lt;/manifest&gt;
    &lt;/android&gt;
</pre></code>
(this let us trace memory with MAT when deoployed to real device)
5. Clean & run the app in the emulator / device (although no matter what you do as we'll see the same behaviour).
6. Once deployed, change to DDMS perspective.
7. In devices list, highlight our (device and) app process.
8. Click the 'Update HEAP' button.
9. Now run - quit (back button) - run X times.
10. In Heap tab, click "Cause GC" button a few times until you see memory indicators stable.
11. Click "Dump HPROF file" button, and get object Histogram with MAT.
12. Search for Class Name regex typing 'Module'. 

Now see X objects of each Titanium module; you can go deeper:

13. Right click on any of the Histogram lines > List objects > with incoming references
14. Right click on any item from list_objects > Path to GC Roots > Exclude all phantom/weak/soft etc. references

Then you'll see only one Native Stack GC Root, which I guess the memory is retained inside 'JNI land'.

I've tried this with ALL the environment variables I've specified in this ticket enviroment field, with almost all possible combinations, and always get the same result. I've also attached screenshots and even tried this with a very very simple app! (<a href="https://gist.github.com/4585261)" rel="nofollow" target="_blank">https://gist.github.com/4585261)</a>

There's more: it also happens with custom modules. Actually, while I was developing my GCM module I realized that 'something' memory related was happening. Just a few lines: the module has a method (registerForPushNotifications) which has a js object as an argument, and its properties are function callbacks... in Java land those callbacks are really KrollCallback, as you may guess. When the method is executed, the callbacks are assigned to instance KrollCallback private properties. When the module has been integrated into an existing app, it worked as expected BUT after some tests something really weird happened: callbacks were fired, but the logic inside reported a wrong state (e.g. logging out a counter variable shown wrong values). After tons of tests, I made the KrollCallback properties static, and it 'solved' the problem.
I'm not one of those who always think that it's fault of the underlying framework / SDK, so 1st thing I thought was I was doing some bad memory management, retaining whatever. No way... I commented everything until make the module useless, doing nothing... and even without making a single require of the module in JS land, MAT shown X Module objects. 
I also thought that it really wasn't a bug, just some MAT understandable memory thing... but definitely the wrong behaviour with my module solved making static properties made me think the opposite.

Finally (and I don't know if it has something to do) I've also attached a screenshot of logcat output with mysterious messages: 
01-21 10:43:09.467: W/TiApplication(2479): (KrollRuntimeThread) [312,312] Registering module with name already in use.

If this is not a bug, I'll really appreciate a technical explanation of what is happening, why MAT is reporting X instances of Ti / custmo modules. But, if it IS a bug, IMHO must be considered a serious bug, and I really hope it'll be solved very soon.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-12405_34920/Screen Shot 2013-01-21 at 12.05.36.png">Screen Shot 2013-01-21 at 12.05.36.png</td></td><td>2013-01-21T12:11:10.000+0000</td><td>109117</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-12405_34921/Screen Shot 2013-01-21 at 12.05.55.png">Screen Shot 2013-01-21 at 12.05.55.png</td></td><td>2013-01-21T12:11:10.000+0000</td><td>70968</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-12405_34922/Screen Shot 2013-01-21 at 12.06.04.png">Screen Shot 2013-01-21 at 12.06.04.png</td></td><td>2013-01-21T12:11:10.000+0000</td><td>40768</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-12405_34923/Screen Shot 2013-01-21 at 12.22.11.png">Screen Shot 2013-01-21 at 12.22.11.png</td></td><td>2013-01-21T12:11:10.000+0000</td><td>143811</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Allen Yeung 2013-02-14

   This bug was resolved as a result of TIMOB-12289 & TIMOB-12286.</li>
<li>Lee Morris 2017-03-21

   Closing ticket as duplicate with reference to the above comments.</li>
</ol>


<p><a href="/TIMOB/TIMOB-12405.json">JSON Source</a></p>