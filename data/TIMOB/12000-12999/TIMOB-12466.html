---
title: "[TIMOB-12466] iOS: SECURITY_ERR: DOM Exception 18 on iOS 5.1 when upgrading app with WebView that opens local database"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios, opendatabase, webview</td></tr>
<tr><th>Reporter</th><td>Justin Toth</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2013-01-18T06:53:28.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T20:03:51.000+0000</td></tr>
</table>

<h3>Description</h3>

Summary of issue:

If you build a simple Titanium mobile application that contains a WebView which has in it javascript that opens a local database, the first time you install it to an iOS 5.1 device it will open the database correctly. However, if you then upgrade the app on the device (it can still be the exact same version/build), it will error when opening the local database:

SECURITY_ERR: DOM Exception 18

Steps to reproduce:

1. Add the app.js and database.html files below to the root of Resources.
2. Install app to iOS 5.1 device (Run > iOS Device in Ti Studio).
3. Open app, it will say "db opened".
4. Upgrade app on iOS 5.1 device (Run > iOS Device in Ti Studio).
5. Open app, it will say "db opening failed: Error: SECURITY_ERR: DOM Exception 18".

Here is the code to reproduce:

app.js:

<code><pre>
var win = Ti.UI.createWindow({});
var webView = Ti.UI.createWebView({
	top : 0, right : 0, bottom : 0, left : 0, url: 'database.html'
});
win.add(webView);
win.open();
</pre></code>

database.html:

<code><pre>
&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
	&lt;head&gt;
    	&lt;title&gt;db test&lt;/title&gt;
    	&lt;script&gt;
    		window.onload = function () {
    			var dbConn;
    			try {
    				dbConn = openDatabase('test', '0.1', 'test database', 5 * 1024 * 1024);
    				alert('db opened');
    			} catch (e) {
    				alert('db opening failed: ' + e.toString());
    			}
    		};
    	&lt;/script&gt;	
    &lt;/head&gt;
    &lt;body&gt;
    	db test
    &lt;/body&gt;
&lt;/html&gt;
</pre></code>

This issue seems to be the same as Apache Cordova has had and fixed, maybe you can learn something from how they fixed it...

<a href="https://issues.apache.org/jira/browse/CB-347" rel="nofollow" target="_blank">https://issues.apache.org/jira/browse/CB-347</a>

This is a serious issue for my company because we have a Sencha Touch app that is integrated into our Titanium app "hub" within a webview, so basically we can't support iOS 5 devices without a fix for this.

<h3>Comments</h3>

<ol>
<li>Justin Toth 2013-01-28

   We created a native iOS module that fixes the bug, using the same approach that Cordova implemented. It is very straightforward, I suggest that you guys add this to the standard Titanium WebView ASAP. Source code can be found at the link below:
   
   <a href="https://bitbucket.org/justintoth/titanium_modules/src/3fa1d1c3f8befbf077145eb8657c87a8b274a7a4/webview/iphone/Classes/TiWebviewModule.m?at=master" rel="nofollow" target="_blank">https://bitbucket.org/justintoth/titanium_modules/src/3fa1d1c3f8befbf077145eb8657c87a8b274a7a4/webview/iphone/Classes/TiWebviewModule.m?at=master</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-12466.json">JSON Source</a></p>