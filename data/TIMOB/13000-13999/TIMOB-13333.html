---
title: "[TIMOB-13333] iOS: setting view property cause "Collection <CALayerArray: 0x645dfc0> was mutated while being enumerated.‚Äù"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>layer, proxy, thread, view</td></tr>
<tr><th>Reporter</th><td>Martin Guillon</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2012-10-24T09:08:32.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T20:04:22.000+0000</td></tr>
</table>

<h3>Description</h3>

My app is doing pretty fast animations. Especially depending on user interaction, views can be very quickly animated, modified (visibility, opacity).
Recently i have been facing a lot of crash:
<code><pre>
Collection <CALayerArray: 0x645dfc0> was mutated while being enumerated.
</pre></code>
I have been trying to to the depth of that bug. This what i have found.
I post as an image the callstack in xcode.

What i can say is that the bug is appearing when processing a
<code><pre>
view.visible = true
</pre></code>
in my script.

What i think is happening is that we try to change the hidden property of a layer while modifying the layers stack (insertSubview in TiViewProxy).

I have also been looking on the web for this one and i have found a post related to that
<a href="http://stackoverflow.com/questions/1711700/iphone-ui-addsubview-causing-concurrency-exception" rel="nofollow" target="_blank">http://stackoverflow.com/questions/1711700/iphone-ui-addsubview-causing-concurrency-exception</a>

I have been trying to create a simple example of this without success. And i cant post the code of my app.

Will still try to find a test case.
Yet i think we already have enough information to understand that bug, and so start working onit.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-13333_32929/Screen Shot 2012-10-24 at 11.03.39 AM.png">Screen Shot 2012-10-24 at 11.03.39 AM.png</td></td><td>2012-10-24T09:08:32.000+0000</td><td>90790</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Martin Guillon 2012-10-24

   So i keep on working on this one. This is what i have now.
   What is happening is that [TiUIView::setVisible_](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiUIView.m#L561)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiUIView.m#L561)</a>
   is called while  that view in is parent in [TiViewProxy::insertSubview](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiViewProxy.m#L2121)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiViewProxy.m#L2121)</a>
   I have tried using @synchronized without success. I need help on this.
   </li>
<li>Ingo Muschenetz 2012-11-28

   Martin, can you please confirm this also happens on 3.0.0?</li>
<li>Martin Guillon 2012-11-30

   i can confirm it WASN'T happening in 3.0.0, at least at githash 484f237</li>
<li>Ingo Muschenetz 2013-03-15

   Try setting opacity to 0 instead and see if that solves the issue for now.</li>
<li>Martin Guillon 2013-03-18

   Actually i think i fixed this in my branch. Will have to look through the code to find the solution :s
   
   EDIT: also i cant use opacity = 0. i actually use a combination of opacity and visibility. They dont have the same meaning</li>
</ol>


<p><a href="/TIMOB/TIMOB-13333.json">JSON Source</a></p>