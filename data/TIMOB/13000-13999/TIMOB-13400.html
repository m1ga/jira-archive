---
title: "[TIMOB-13400] BlackBerry: Titanium.Network.HTTPClient invalid url when using encodeURIComponent()"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-04-10T22:09:59.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 08 BB, 2013 Sprint 08, Release 3.2.0</td></tr>
<tr><th>Components</th><td>BlackBerry</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Matthias Kroeger</td></tr>
<tr><th>Assignee</th><td>Josh Roesslein</td></tr>
<tr><th>Created</th><td>2013-02-26T17:05:32.000+0000</td></tr>
<tr><th>Updated</th><td>2013-11-14T00:29:38.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
For reading Google RSS feeds it is required to encode the second url part.
With iOS this is working as expected, with BlackBerry not.

I did some logging using Wireshark an it looks like that during GET the already encoded url gets encoded once more.
See logs below.

<h4>actual behavior</h4>
wrong encoding during GET

<h4>expected behavior</h4>
correct encoding

<h4>Test case (app.js)</h4>
<code><pre>
var win = Ti.UI.createWindow({
    backgroundColor : 'white',
    layout : 'vertical'
});

function reloadFeed(url) {

    Ti.API.info('---> url ' + url);

    var xhr = Ti.Network.createHTTPClient({
        onload : function(e) {
            Ti.API.info('---> xhr onload');
            Ti.API.info('---> xhr status=' + this.status);
            Ti.API.info('---> xhr responseText=' + this.responseText);

            var response = JSON.parse(this.responseText);

            for (var i = 0, j = response.responseData.feed.entries.length; i < j; i++) {
                Ti.API.info('---> xhr responseText Title ' + i + ' =' + response.responseData.feed.entries[i].title);
                Ti.API.info('---> xhr responseText Link ' + i + ' =' + response.responseData.feed.entries[i].link);
                //Ti.API.info('---> xhr responseText publishedDate ' + i + ' =' + response.responseData.feed.entries[i].publishedDate);
            };

        },
        onsendstream : function(e) {
            Ti.API.info('---> xhr onsendstream');
        },
        onreadystatechange : function(e) {
            Ti.API.info('---> xhr onreadystatechange readyState=' + this.readyState);
        },
        onerror : function(e) {
            Ti.API.info('---> xhr onerror ' + e.error);
        }
    });
    // xhr.autoEncodeUrl = false; // << don't help
    xhr.open('GET', url);
    xhr.send();
}

button = Ti.UI.createButton({
    title : 'reload feed',
    bottom : 0,
    height : '10%',
    width : Ti.UI.FILL // << don't work with BlackBerry
});
button.addEventListener("click", function(e) {
    //var urlAjax = '<a href="http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=callBack&q=" rel="nofollow" target="_blank">http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=callBack&q=</a>';
    var urlAjax = '<a href="http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q=" rel="nofollow" target="_blank">http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q=</a>';
    var urlFeed = '<a href="http://news.google.com/news?ned=us&topic=t&output=rss" rel="nofollow" target="_blank">http://news.google.com/news?ned=us&topic=t&output=rss</a>';
    // << this url part has to be encoded

    urlFeed = encodeURIComponent(urlFeed);
    Ti.API.info('---> encoded urlFeed=' + urlFeed);

    reloadFeed(urlAjax + urlFeed);

});

win.add(button);

win.open();
</pre></code>

<h4>Logs</h4>

<h4>BlackBerry Titanium App log</h4>
<code><pre>
[INFO] ---> url <a href="http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q=http%3A%2F%2Fnews.google.com%2Fnews%3Fned%3Dus%26topic%3Dt%26output%3Drss" rel="nofollow" target="_blank">http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q=http%3A%2F%2Fnews.google.com%2Fnews%3Fned%3Dus%26topic%3Dt%26output%3Drss</a>
[INFO] ---> xhr onreadystatechange readyState=1
[INFO] ---> xhr onreadystatechange readyState=3
[INFO] ---> xhr onreadystatechange readyState=4
[INFO] ---> xhr onload
[INFO] ---> xhr status=undefined
[INFO] ---> xhr responseText={"responseData": null, "responseDetails": "The specified feed URL is invalid", "responseStatus": 400}
SyntaxError: Unexpected end of input
</pre></code>

<h4>iOS Titanium App log</h4>
<code><pre>
[INFO] :   ---> encoded urlFeed=http%3A%2F%2Fnews.google.com%2Fnews%3Fned%3Dus%26topic%3Dt%26output%3Drss
[INFO] :   ---> url <a href="http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q=http%3A%2F%2Fnews.google.com%2Fnews%3Fned%3Dus%26topic%3Dt%26output%3Drss" rel="nofollow" target="_blank">http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q=http%3A%2F%2Fnews.google.com%2Fnews%3Fned%3Dus%26topic%3Dt%26output%3Drss</a>
[INFO] :   ---> xhr onreadystatechange readyState=1
[INFO] :   ---> xhr onreadystatechange readyState=2
[INFO] :   ---> xhr onreadystatechange readyState=3
[INFO] :   ---> xhr onreadystatechange readyState=4
[INFO] :   ---> xhr onload
[INFO] :   ---> xhr status=200
[INFO] :   ---> xhr responseText={"responseData": {"feed":{"feedUrl":"<a href="http://news.google.com/news?ned" rel="nofollow" target="_blank">http://news.google.com/news?ned</a>\u003dus\u0026topic\u003dt\u0026output\u003drss","title":"Sci/Tech - Google News","link":"<a href="http://news.google.com/news?ned" rel="nofollow" target="_blank">http://news.google.com/news?ned</a>\u003dus\u0026amp;hl\u003den\u0026amp;topic\u003dt","author":"","description":"Google News","type":"rss20","entries":[{"title":"Google switches on Google+ sign-ins, in-app posting - CNET","link":"<a href="http://news.google.com/news/url?sa" rel="nofollow" target="_blank">http://news.google.com/news/url?sa</a>\u003dt\u0026fd\u003dR\u0026usg\u003dAFQjCNF_NsAUYYOMNGi85B_CJLUDYpCp8A\u0026url\u003d<a href="http://news.cnet.com/8301-10812_3-57571255/google-switches-on-google-sign-ins-in-app-posting/" rel="nofollow" target="_blank">http://news.cnet.com/8301-10812_3-57571255/google-switches-on-google-sign-ins-in-app-posting/</a>","author":"","publishedDate":"Tue, 26 Feb 2013 08:09:18 <<more text here>> "responseDetails": null, "responseStatus": 200}
[INFO] :   ---> xhr responseText Title 0 =Google switches on Google+ sign-ins, in-app posting - CNET
[INFO] :   ---> xhr responseText Link 0 =<a href="http://news.google.com/news/url?sa=t&fd=R&usg=AFQjCNF_NsAUYYOMNGi85B_CJLUDYpCp8A&url=http://news.cnet.com/8301-10812_3-57571255/google-switches-on-google-sign-ins-in-app-posting/" rel="nofollow" target="_blank">http://news.google.com/news/url?sa=t&fd=R&usg=AFQjCNF_NsAUYYOMNGi85B_CJLUDYpCp8A&url=http://news.cnet.com/8301-10812_3-57571255/google-switches-on-google-sign-ins-in-app-posting/</a>
[INFO] :   ---> xhr responseText Title 1 =Pluto's smallest moon may be named 'Vulcan' - Financial Express
[INFO] :   ---> xhr responseText Link 1 =<a href="http://news.google.com/news/url?sa=t&fd=R&usg=AFQjCNGTAtW-D76E5l1yU5fOMPh-8_Jpzg&url=http://www.financialexpress.com/news/plutos-smallest-moon-may-be-named-vulcan/1080092" rel="nofollow" target="_blank">http://news.google.com/news/url?sa=t&fd=R&usg=AFQjCNGTAtW-D76E5l1yU5fOMPh-8_Jpzg&url=http://www.financialexpress.com/news/plutos-smallest-moon-may-be-named-vulcan/1080092</a>
[INFO] :   ---> xhr responseText Title 2 =Samsung announces new Galaxy smartphone launch - The Guardian
[INFO] :   ---> xhr responseText Link 2 =<a href="http://news.google.com/news/url?sa=t&fd=R&usg=AFQjCNHvMVry7ufpmDzieZ9CiQOtboljTQ&url=http://www.guardian.co.uk/technology/2013/feb/25/samsung-announces-new-galaxy-smartphone-launch" rel="nofollow" target="_blank">http://news.google.com/news/url?sa=t&fd=R&usg=AFQjCNHvMVry7ufpmDzieZ9CiQOtboljTQ&url=http://www.guardian.co.uk/technology/2013/feb/25/samsung-announces-new-galaxy-smartphone-launch</a>
â€¦.<<more lines here>>
</pre></code>

<h4>BlackBerry Wireshark log</h4>
<code><pre>
GET /ajax/services/feed/load?v=1.0&num=10&q=http%253A%252F%252Fnews.google.com%252Fnews%253Fned%253Dus%2526topic%253Dt%2526output%253Drss HTTP/1.1
Connection: Keep-Alive
Accept-Encoding: gzip
Accept-Language: en-US,*
User-Agent: Mozilla/5.0
Host: ajax.googleapis.com

HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: Fri, 01 Jan 1990 00:00:00 GMT
Date: Tue, 26 Feb 2013 16:31:12 GMT
Content-Type: text/javascript; charset=utf-8
X-Embedded-Status: 400
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Server: GSE
Transfer-Encoding: chunked

65
{"responseData": null, "responseDetails": "The specified feed URL is invalid", "responseStatus": 400}
0
</pre></code>

<h4>iOS Wireshark log</h4>
<code><pre>
GET /ajax/services/feed/load?v=1.0&num=10&q=http%3A%2F%2Fnews.google.com%2Fnews%3Fned%3Dus%26topic%3Dt%26output%3Drss HTTP/1.1
Host: ajax.googleapis.com
Accept-Encoding: gzip
User-Agent: Appcelerator Titanium/3.1.0.v20130223030327 (iPhone Simulator/6.1; iPhone OS; en_US;)
Connection: close
X-Requested-With: XMLHttpRequest

HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: Fri, 01 Jan 1990 00:00:00 GMT
Date: Tue, 26 Feb 2013 16:26:40 GMT
Content-Type: text/javascript; charset=utf-8
X-Backend-Content-Length: 34403
X-Embedded-Status: 200
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Server: GSE
Connection: close

{"responseData": {"feed":{"feedUrl":"<a href="http://news.google.com/news?ned" rel="nofollow" target="_blank">http://news.google.com/news?ned</a>\u003dus\u0026topic\u003dt\u0026output\u003drss","title":"Sci/Tech - Google News","link":"<a href="http://news.google.com/news?ned" rel="nofollow" target="_blank">http://news.google.com/news?ned</a>\u003dus\u0026amp;hl\u003den\u0026amp;topic\u003dt","author":"","description":"Google News","type":"rss20","entries":[{"title":"Samsung says it plans to double its tablet ... - CNET","link":"<a href="http://news.google.com/news/url?sa" rel="nofollow" target="_blank">http://news.google.com/news/url?sa</a>\u003dt\u0026fd\u003dR\u0026usg\u003dAFQjCNFTxcyFX4JUWi5bn6Xw1bzloIbgEQ\u0026url\u003d<a href="http://reviews.cnet.com/8301-13970_7-57571311-78/samsung-says-it-plans-to-double-its-tablet-sales-this-year/" rel="nofollow" target="_blank">http://reviews.cnet.com/8301-13970_7-57571311-78/samsung-says-it-plans-to-double-its-tablet-sales-this-year/</a>","author":"","publishedDate":"Tue, 26 Feb 2013 07:43:39 -0800","contentSnippet":"ZDNetSamsung says it plans to double its tablet ...CNETBut the company warned that smartphone sales growth would likely slow ...","content":"\u003ctable border\u003d\"0\" cellpadding\u003d\"2\" cellspacing\u003d\"7\" style\u003d\"vertical-align:top\"\u003e\u003ctr\u003e\u003ctd width\u003d\"80\" align\u003d\"center\" valign\u003d\"top\"\u003e\u003cfont style\u003d\"font-size:85%;font-family:arial,sans-serif\"\u003e\u003ca href\u003d\"<a href="http://news.google.com/news/url?sa" rel="nofollow" target="_blank">http://news.google.com/news/url?sa</a>\u003dt\u0026amp;fd\u003dR\u0026amp;usg\u003dAFQjCNHAOFvscT3U9dvTZFVctkdM5vCDtA\u0026amp;url\u003d<a href="http://www.zdnet.com/samsung-galaxy-s4-to-launch-on-14-" rel="nofollow" target="_blank">http://www.zdnet.com/samsung-galaxy-s4-to-launch-on-14-</a>
...
...
 "responseDetails": null, "responseStatus": 200}
</pre></code>

<h3>Comments</h3>

<ol>
<li>Matthias Kroeger 2013-02-27

   The % inside the encoded string gets encoded again to %25, I think.</li>
<li>Matthias Kroeger 2013-02-27

   This ticket has been assigned to Tony. 
   Is that correct for a BlackBerry ticket?
   
   Thanks,
   Matthias</li>
<li>Tony Lukasavage 2013-02-27

   Definitely not, probably more likely should be assigned to Russ McMahon. I'm not sure exactly how it would have been assigned to me.</li>
<li>Matthias Kroeger 2013-02-27

   Thanks Tony!</li>
<li>Josh Roesslein 2013-04-10

   Also found a bug with accessing the "responseText" multiple times.
   Duplicate accesses would return an empty string. Fixed.</li>
<li>Samuel Dowse 2013-11-14

   Verified fixed on:
   Mac OSX 10.9 Mavericks
   Titanium Studio, build: 3.2.0.201311122225
   Titanium SDK, build: 3.2.0.v20131113094843
   CLI: 3.2.0
   Alloy: 1.3.0
   BlackBerry Simulator: 10.2.0.1791
   
   Feed is obtained successfully and logged in the console as expected.
   No invalid URL is used when encoding.
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-13400.json">JSON Source</a></p>