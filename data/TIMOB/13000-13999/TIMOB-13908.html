---
title: "[TIMOB-13908] CLI: If the analytics config files in .titanium are not writable, the CLI crashes"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-06-05T20:55:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 12 JS, 2013 Sprint 12, Release 3.2.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>qe-closed-3.2.0</td></tr>
<tr><th>Reporter</th><td>Bryan Hughes</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2013-05-17T21:39:34.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-13T19:53:48.000+0000</td></tr>
</table>

<h3>Description</h3>

if ~/.titanium/analytics.json or ~/.titanium/analytics_session.json are not writable by the user that the node process is running under, the CLI crashes. In practice, these files are mode 644 by default (writable only by the owner), so running node as anything other than the user that installed the CLI will cause a crash. An easy way to replicate:

<code><pre>
sudo chown root:admin ~/.titanium/analytics.json ~/.titanium/analytics_session.json
</pre></code>

<h3>Comments</h3>

<ol>
<li>Bryan Hughes 2013-05-17

   PR: <a href="https://github.com/appcelerator/node-appc/pull/44" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/44</a>
   3_1_X: <a href="https://github.com/appcelerator/node-appc/pull/45" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/45</a></li>
<li>Eric Merriman  2013-05-29

   After setting permissions in the "easy to replicate" area of the description, I ran "ti sdk". This fails. I also tried "ti create" which failed as well, here is some output:
   
   <code><pre>
   
   emerrimanMBP:.titanium emerriman$ 
   fs.js:338
     return binding.open(pathModule._makeLong(path), stringToFlags(flags), mode);
                    ^
   Error: EACCES, permission denied '/Users/emerriman/.titanium/analytics_session.json'
       at Object.fs.openSync (fs.js:338:18)
       at Object.fs.writeFileSync (fs.js:756:15)
       at /usr/local/lib/node_modules/titanium/node_modules/node-appc/lib/analytics.js:140:7
       at async.parallel (/usr/local/lib/node_modules/titanium/node_modules/async/lib/async.js:476:17)
       at async.forEach (/usr/local/lib/node_modules/titanium/node_modules/async/lib/async.js:94:25)
       at async.parallel (/usr/local/lib/node_modules/titanium/node_modules/async/lib/async.js:473:21)
       at process.on.async.parallel.osinfo (/usr/local/lib/node_modules/titanium/node_modules/node-appc/lib/analytics.js:56:5)
       at module.exports.getOSInfo (/usr/local/lib/node_modules/titanium/node_modules/node-appc/lib/environ.js:215:4)
       at ChildProcess.exithandler (child_process.js:538:7)
       at ChildProcess.EventEmitter.emit (events.js:99:17)
   
   </pre></code>
   
   I am using CLI 3.1.1 alpha</li>
<li>Ingo Muschenetz 2013-05-30

   Not required for 3.1.1, since normal usage is not likely to uncover this bug. Moving to 3.2.0.</li>
<li>Chris Barber 2013-06-05

   To test:
   
   <code><pre>
   sudo chown root:admin ~/.titanium/analytics.json ~/.titanium/analytics_session.json ~/.titanium/config.json ~/.titanium/auth_session.json
   </pre></code>
   
   *Test analytics not working:*
   <code><pre>
   titanium sdk
   </pre></code>
   *Result:*
   You should not see an exception dump
   
   *Check analytics.json is not writable*
   <code><pre>
   titanium
   </pre></code>
   *Result:*
   <code><pre>
   <snip>
   Required file ~/.titanium/analytics.json is not writable.
   Please ensure the Titanium CLI has access to modify this file.
   <snip>
   </pre></code>
   
   *Reset analytics.json owner*
   <code><pre>
   sudo chown <code>whoami</code>:staff ~/.titanium/analytics.json
   </pre></code>
   
   *Check analytics_session.json is not writable*
   <code><pre>
   titanium
   </pre></code>
   *Result:*
   <code><pre>
   <snip>
   Required file ~/.titanium/analytics_session.json is not writable.
   Please ensure the Titanium CLI has access to modify this file.
   <snip>
   </pre></code>
   
   *Reset analytics_session.json owner*
   <code><pre>
   sudo chown <code>whoami</code>:staff ~/.titanium/analytics_session.json
   </pre></code>
   
   *Check warnings are off*
   <code><pre>
   titanium
   </pre></code>
   *Result:*
   No warning message since both analytics files are now writable.
   
   *Check config file is not writable*
   <code><pre>
   titanium config user.age 21
   </pre></code>
   *Result:*
   <code><pre>
   [ERROR] Unable to write config file /Users/chris/.titanium/config.json
   [ERROR] Please ensure the Titanium CLI has access to modify this file.
   </pre></code>
   
   *Reset config.json owner*
   <code><pre>
   sudo chown <code>whoami</code>:staff ~/.titanium/config.json
   </pre></code>
   
   *Check warnings are off*
   <code><pre>
   titanium config user.age 21
   </pre></code>
   *Result:*
   user.age saved
   
   *Verify again:*
   <code><pre>
   titanium config user.age
   </pre></code>
   *Result:*
   21
   
   *Check auth_session.json not writable*
   <code><pre>
   titanium logout
   </pre></code>
   *Result:*
   <code><pre>
   [ERROR] Session file "/Users/chris/.titanium/auth_session.json" is not writable
   [ERROR] Please ensure the Titanium CLI has access to modify this file.
   [ERROR] You are still logged in
   </pre></code>
   
   *Reset auth_session.json owner*
   <code><pre>
   sudo chown <code>whoami</code>:staff ~/.titanium/auth_session.json
   </pre></code>
   
   *Logout*
   <code><pre>
   titanium logout
   </pre></code>
   *Result:*
   Logged out successfully
   
   *Change auth_session.json owner to root*
   <code><pre>
   sudo chown root:admin ~/.titanium/auth_session.json
   </pre></code>
   
   *Login*
   <code><pre>
   titanium login
   </pre></code>
   *Result*
   <code><pre>
   [ERROR] Session file "/Users/chris/.titanium/auth_session.json" is not writable
   [ERROR] Please ensure the Titanium CLI has access to modify this file.
   [ERROR] You are currently logged out
   </pre></code>
   
   *Reset auth_session.json owner*
   <code><pre>
   sudo chown <code>whoami</code>:staff ~/.titanium/auth_session.json
   </pre></code>
   
   *Login*
   <code><pre>
   titanium login
   </pre></code>
   *Result:*
   Logged in successfully</li>
<li>Chris Barber 2013-06-05

   Node-appc master pull request: <a href="https://github.com/appcelerator/node-appc/pull/48" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/48</a>
   Titanium master pull request: <a href="https://github.com/appcelerator/titanium/pull/42" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium/pull/42</a></li>
<li>Bryan Hughes 2013-06-05

   Note: the exact errors/messages I got were slightly different at times that the test instructions indicated, but everything worked as I would expect it too (probably due to what analytics were queued up, if any).</li>
<li>Samuel Dowse 2013-12-13

   Verified fixed on:
   Mac OSX 10.9 Mavericks
   Titanium SDK, build: 3.2.0.v20131212122847
   CLI: 3.2.0-cr
   
   Ran testcases provided in comments. All worked as expected.
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-13908.json">JSON Source</a></p>