---
title: "[TIMOB-14024] Android: HttpClient does not redirect POST requests correctly (they become GET)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2013-06-24T16:51:22.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 13 API, 2013 Sprint 13</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Davide Cassenti</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2013-05-30T15:50:23.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-09T19:06:09.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description of the problem</h4>
When sending a request using POST, if the server returns a redirect, the next request is made using GET. Disabling autoRedirect also doesn't work, as the result status is 200 and not 3xx

<h4>Steps to reproduce</h4>
You need a server that returns a 3xx status (e.g. 302). In my server code, the page where you redirect will print out the method (get or post).

The Titanium code would be:

<code><pre>
var xhr = Ti.Network.createHTTPClient({
	onload: function(e) {
		alert(this.responseText);
	}
});

xhr.open('POST', URL_WITH_REDIRECT);
xhr.send();
</pre></code>

<h4>Server code sample (PHP)</h4>

page.php
<code><pre>
&lt;?php
header('Location: newpage.php',true,302);
exit;
</pre></code>

newpage.php
<code><pre>
&lt;?php
var_dump($_SERVER['REQUEST_METHOD']);
</pre></code>

<h3>Comments</h3>

<ol>
<li>Ping Wang 2013-06-17

   On Android, we use Apache HttpClient which handles all types of redirects automatically. The behavior that converts redirects of PUT/POST to GET is actually on purpose. Here is the [ticket](<a href="https://issues.apache.org/jira/browse/HTTPCLIENT-860)" rel="nofollow" target="_blank">https://issues.apache.org/jira/browse/HTTPCLIENT-860)</a> on Apache's JIRA website. From the comments in that ticket, we can see there is a history of debate on which behavior is correct/expected. Our current Android behavior follows the default Apache HttpClient behavior.</li>
<li>Davide Cassenti 2013-06-24

   The workaround is to run more calls, depending on the result of the first one. If the first call is a 30x, you need to read the header, and perform another call with the new url.
   
   The first call would be to the original url:
   
   <code><pre>
   xhr.open("POST", "FIRST_URL");
   xhr.autoRedirect = false;
   xhr.send();
   </pre></code>
   
   Then, need to read the headers in the 'onerror' callback (this is due to TIMOB-13930):
   
   <code><pre>
   onerror: function(e) {
       var headers = this.getAllResponseHeaders();
       headers = headers.split("\n");
   
       var newLocation = null;
       for (var h=0; h&lt;headers.length; h++) {
           if (headers[h].indexOf("Location") != -1) {
               newLocation = headers[h].substr(headers[h].indexOf(":")+1).trim();
               break;
           }
       }
   
       if (newLocation != null) {
           // perform the second call here
       }
   
   }
   </pre></code>
   
   Then need to perform a new xhr call to newLocation</li>
<li>Hieu Pham 2013-06-24

   Closing this ticket as invalid, since this is expected behavior.</li>
<li>Lee Morris 2017-03-09

   Closing ticket as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14024.json">JSON Source</a></p>