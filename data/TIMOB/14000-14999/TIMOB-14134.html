---
title: "[TIMOB-14134] Android: ANR during Imageview animation "
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2013-07-02T16:19:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.0, Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 14, 2013 Sprint 14 API</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>supportTeam</td></tr>
<tr><th>Reporter</th><td>Eduardo Gomez</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2013-06-06T00:25:52.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-03T22:08:59.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue</h4>
App is not responding if you press the Android power button 2-3 times, then you can reproduce the ANR. Sometimes even at first time pressing power button you can reproduce this issue.

<h4>Tested on</h4>
Samsung S3 - 4.1.2 , Sony Xperia U - 2.3.7 , HTC amaze - 2.3.4 , Droid Razr 2.3.5

<h4>Steps to reproduce</h4>
1. Run app 
2. Click "sync" button (there will be a HTTP call after got the response from the server)
3. Huge data will be inserted into local database.

He is trying to stop the animation and start it again while locking and unlocking the mobile screen. Like:

<code><pre>
var bc = Ti.Android.createBroadcastReceiver({
    onReceived: function() {
        // Animation remove
    }
});

Ti.Android.registerBroadcastReceiver(bc, [Ti.Android.ACTION_SCREEN_OFF]);
</pre></code>

It would also save the extra overhead of the app when the phone screen is locked since they have a requirement they have to use a custom indicator.

<h4>Reproduction sample</h4>
<code><pre>
Titanium.UI.setBackgroundColor('#000');
Ti.Database.install('indicator.sqlite', "indicator");
Ti.App.Properties.setBool('isLoading', false);
var win = Titanium.UI.createWindow({  
    backgroundColor:'#fff'
});
var wrappr,loaderView;

var inserRow = function(rowIndex){
	 var db = Ti.Database.open("indicator");
	 db.execute("INSERT OR REPLACE INTO demo (cid,coloumn1,coloumn2,coloumn3,coloumn4,coloumn5,coloumn6,coloumn7,coloumn8,coloumn9,coloumn10,coloumn11,coloumn12,coloumn13,coloumn14,coloumn15,coloumn16,coloumn17,coloumn18,coloumn19,coloumn20,coloumn21,coloumn22) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)", rowIndex, "coloumn1 - this sampele description text", "coloumn2 - this sampele description text", "coloumn3 - this sampele description text", "coloumn4 - this sampele description text", "coloumn5 - this sampele description text", "coloumn6 - this sampele description text", "coloumn7 - this sampele description text", "coloumn8 - this sampele description text", "coloumn9 - this sampele description text", "coloumn10 - this sampele description text", "coloumn11 - this sampele description text", "coloumn12 - this sampele description text", "coloumn13 - this sampele description text", "coloumn14 - this sampele description text", "coloumn15 - this sampele description text", "coloumn16 - this sampele description text", "coloumn17 - this sampele description text", "coloumn18 - this sampele description text", "coloumn19 - this sampele description text", "coloumn20 - this sampele description text", "coloumn21 - this sampele description text", "coloumn22 - this sampele description text");
	 db.close();
};

var deleteTable = function(){
	var db = Ti.Database.open("indicator");
	db.execute("delete from demo");
	db.close();
};

var addLoader = function(bgColor){
	var loaderView = Ti.UI.createView({
		height : Ti.UI.SIZE,
		top : 35
	});

	if(bgColor){
		loaderView.backgroundColor = bgColor;
	}

	var prefix = 'loadingSmall/';
    
    Ti.API.info("prefix = "+prefix);
	var loader = Ti.UI.createImageView({
		height : 50,
		width : 50,
		duration : 50,
		images : [prefix + 'loading01.png', prefix + 'loading02.png', prefix + 'loading03.png', prefix + 'loading04.png', prefix + 'loading05.png', prefix + 'loading06.png', prefix + 'loading07.png', prefix + 'loading08.png', prefix + 'loading09.png', prefix + 'loading10.png', prefix + 'loading11.png', prefix + 'loading12.png', prefix + 'loading13.png', prefix + 'loading14.png', prefix + 'loading15.png', prefix + 'loading16.png', prefix + 'loading17.png', prefix + 'loading18.png']
	});
	loaderView.add(loader);
	loader.start();

	return loaderView;
};

var loadingHolderView = new function () {
	this.loadingHolderView = null;

	this.getLoadingHolderView = function () {
		return this.loadingHolderView;
	};

	this.setLoadingHolderView = function (view) {
		this.loadingHolderView = view;
	};
};

var addLoading = function(){
     wrappr = Titanium.UI.createView({
        height: Ti.Platform.displayCaps.platformHeight,
        width: Ti.Platform.displayCaps.platformWidth,
        backgroundColor: '#000',
        opacity: 0.8
    });
    win.add(wrappr);
    
    var indView = Titanium.UI.createView({
        height : "150",
        width : Ti.UI.FILL,
        backgroundColor: '#000'
    });
    wrappr.add(indView);
    
    var tmpView = Titanium.UI.createView();
    indView.add(tmpView);

    var loadingImage = addLoader();
    tmpView.add(loadingImage);
    
	loadingHolderView.setLoadingHolderView(tmpView);

	var message = Titanium.UI.createLabel({ 
		top: 100,
	    text: 'Loading...',
	    color: '#fff',
	    width: Ti.UI.SIZE,
	    height: Ti.UI.SIZE,
	    font : {
			fontFamily:"Helvetica Nue",
			fontSize:14,
			fontWight:"bold"
		}
	});
	indView.add(message);
};

var removeLoading = function(){
	win.remove(wrappr);
}

// Create a Button.
var syncBtn = Ti.UI.createButton({
	title : 'Sync'
});

// Listen for click events.
syncBtn.addEventListener('click', function() {
	 addLoading();
	 Ti.App.Properties.setBool('isLoading', true);
	 var url = "<a href="http://www.appcelerator.com" rel="nofollow" target="_blank">http://www.appcelerator.com</a>";
	 var client = Ti.Network.createHTTPClient({
	     // function called when the response data is available
	     onload : function(e) {
	         Ti.API.info("Received text: " + this.responseText);
	         Ti.API.info("delete demo table");
	         deleteTable();
			 Ti.API.info("insert demo table");
	         for(var i = 1; i&lt;3500; i++){
	         	 Ti.API.info("row index = "+i);
	         	 inserRow(i);
			 }
			 removeLoading();
			 Ti.App.Properties.setBool('isLoading', false);
	     },
	     // function called when an error occurs, including a timeout
	     onerror : function(e) {
	     	 removeLoading();
	     	 Ti.App.Properties.setBool('isLoading', false);
	         Ti.API.debug(e.error);
	     },
	     timeout : 5000  // in milliseconds
	 });
	 // Prepare the connection.
	 client.open("GET", url);
	 // Send the request.
	 client.send();
});

win.add(syncBtn);


var bc = Ti.Android.createBroadcastReceiver({
    onReceived: function() {
        // Animation remove
		Ti.API.info('@@@Android Camed to resume, isLoading = '+Ti.App.Properties.getBool('isLoading'));  
		if(Ti.App.Properties.getBool('isLoading')){
			var lhv = loadingHolderView.getLoadingHolderView();
			Ti.API.info('@@@Android child len = '+lhv.children.length);
			if(lhv.children.length){
			    lhv.remove(lhv.children[0]);
			    var loadingImage = addLoader("green");
			    lhv.add(loadingImage);
		    }
		}
    }
});

Ti.Android.registerBroadcastReceiver(bc, [Ti.Android.ACTION_SCREEN_OFF]);

win.open();
</pre></code>

sqlite and loadingSmall assets were attached or can be downloaded here: <a href="https://github.com/karthi-anubavam/indicator-test" rel="nofollow" target="_blank">https://github.com/karthi-anubavam/indicator-test</a>

<h4>Stack trace</h4>
Eventually App is not responding, device logs have been attached.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-14134_39506/ANR_device_logs_2.3.5.txt">ANR_device_logs_2.3.5.txt</td></td><td>2013-06-06T00:25:52.000+0000</td><td>329126</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-14134_39508/indicator-test-master (1).zip">indicator-test-master (1).zip</td></td><td>2013-06-06T00:25:52.000+0000</td><td>2982607</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-14134_39507/log (2).txt">log (2).txt</td></td><td>2013-06-06T00:25:52.000+0000</td><td>234764</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Lee Morris 2017-03-03

   Closing as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14134.json">JSON Source</a></p>