---
title: "[TIMOB-14207] BlackBerry: Local WebView - Ti is undefined"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-12-18T00:16:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.1</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 13 BB, 2013 Sprint 13, Release 3.1.2, Release 3.2.0</td></tr>
<tr><th>Components</th><td>BlackBerry</td></tr>
<tr><th>Labels</th><td>Blackberry, events, qe-closed-3.2.0, qe-testadded, ti.app, webview</td></tr>
<tr><th>Reporter</th><td>Michael DeGiovanni</td></tr>
<tr><th>Assignee</th><td>Pedro Enrique</td></tr>
<tr><th>Created</th><td>2013-06-12T15:26:15.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-18T06:51:39.000+0000</td></tr>
</table>

<h3>Description</h3>

*Problem*
In a local webview any titanium functionality such as
<code><pre>Ti.API.info('hello world');</pre></code>
or more important than that
<code><pre>Ti.API.addEventListener/fireEvent</pre></code>
do not work.

I have also tried placing them in a timeout like mobile web but to no avail: Ti is always undefined.

*index.xml*
<code><pre>
&lt;Window class="container" id="home" platform="android,blackberry"&gt;
	&lt;WebView id="mainWebView" url="/www/index.html"  disableBounce="true"/&gt;
&lt;/Window&gt;
</pre></code>

*index.js*
<code><pre>
if (Ti.Platform.name === 'blackberry'){
    $.mainWebView.url = 'local:///assets/www/index.html';
}
</pre></code>

*index.html*
<code><pre>
&lt;html&gt;
&lt;head&gt;
	&lt;meta charset="utf-8"&gt;
	&lt;meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"&gt;

	&lt;title&gt;SomePage&lt;/title&gt;
	&lt;meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"&gt;
	
	
	&lt;link href="css/stylesheet.css" rel="stylesheet"&gt;
    
       &lt;!-- THE OFFENDING CODE SNIPPET --&gt;
	&lt;script type="text/javascript"&gt;
	    window.onload = function(){
	    	setTimeout(function(){
	    		alert(typeof(Ti));
	    		Ti.API.info('in timeout file');
	    		Ti.API.fireEvent('someEvent');
	    	},2000);	
	    };
		
	&lt;/script&gt;
	&lt;script data-main="js/main" src="js/libs/require.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-14207_41543/webview_test.zip">webview_test.zip</td></td><td>2013-08-12T22:22:30.000+0000</td><td>1306</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Russell McMahon 2013-06-13

   Can we get a snippet of offending code? Ti.API.info is available but I'm not sure what in web view means.</li>
<li>Michael DeGiovanni 2013-06-13

   index.xml has the following:
   
   <Window class="container" id="home" platform="android,blackberry">
   	<WebView id="mainWebView" url="/www/index.html"  disableBounce="true"/>
   </Window>
   
   since /www/index.html somehow in blackberry cannot be found for the webview's url, in index.js a condition is done checking the platform 
   
   if(Ti.Platform.name ==='blackberry'){
       $.mainWebView.url = 'local:///assets/www/index.html';
   }
   
   
   index.html has the following code:
   
   <html>
   <head>
   	<meta charset="utf-8">
   	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   
   	<title>SomePage</title>
   	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
   	
   	
   	<link href="css/stylesheet.css" rel="stylesheet">
       
          <!-- THE OFFENDING CODE SNIPPET -->
   	<script type="text/javascript">
   	    window.onload = function(){
   	    	setTimeout(function(){
   	    		alert(typeof(Ti));
   	    		Ti.API.info('in timeout file');
   	    		Ti.API.fireEvent('someEvent');
   	    	},2000);	
   	    };
   		
   	</script>
   	<script data-main="js/main" src="js/libs/require.js"></script>
   </head>
   <body>
   	
   </body>
   </html>
   </li>
<li>Michael DeGiovanni 2013-06-13

   looking at the blackberry documentation and the github Tiblackberry repository, I think this is still missing for two way interaction between the webview and the app on titanium.
   
   "You can interact with JavaScript executing on the page by using postMessage() and connecting to the messageReceived() signal. JavaScript can communicate back by using the "navigator.cascades.postMessage()" function and storing a message handler in the "navigator.cascades.onmessage" property." (<a href="http://developer.blackberry.com/cascades/reference/bb__cascades__webview.html)" rel="nofollow" target="_blank">http://developer.blackberry.com/cascades/reference/bb__cascades__webview.html)</a></li>
<li>Michael DeGiovanni 2013-06-13

   Based on the android binding.js, I've added the following gist that needs to be injected on a local webview: <a href="https://gist.github.com/anonymous/5772986" rel="nofollow" target="_blank">https://gist.github.com/anonymous/5772986</a> .Obviously the interface between the titanium app has to be added. Note that in that gist the logging part has been left our (in Android it is through the webviews addJavascriptInterface )</li>
<li>Pedro Enrique 2013-06-18

   Thanks Michael, I'm working on this. </li>
<li>Pedro Enrique 2013-06-19

   PR: <a href="https://github.com/appcelerator/titanium_mobile_blackberry/pull/111" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_blackberry/pull/111</a></li>
<li>Russell McMahon 2013-06-27

   Nice.</li>
<li>Michael DeGiovanni 2013-06-28

   thanks! </li>
<li>Pedro Enrique 2013-08-12

   Attached sample code</li>
<li>Lokesh Choudhary 2013-08-12

    Verified the fix & the fix works as expected.Thus closing.
    
    Environment:
    Appcel Studio : 3.1.2.201308082014
    Ti SDK : 3.1.2.v20130809141556
    Mac OSX : 10.8.4
    Alloy : 1.2.0-alpha6
    CLI - 3.1.2-alpha
    win 7 
    Win 8 
    Z10 BB simulator : 10.0.10.822
    Z10 device running 10.0.10.88
    
    Q10 Simulator : 10.1.0.1720
    Q10 Dev alpha C device running 10.1.0.138</li>
<li>Olga Romero 2013-12-17

    [~penrique] 
    Appcelerator Studio, build: 3.2.0.201312162210
    Titanium SDK, build: 3.2.0.v20131216191854
    CLI 3.2.0-cr3
    Alloy 1.3.0-cr2
    BBZ10 10.1.0
    
    Tested .zip and  webview header value "something else" does not change to "am changed again" as per code.</li>
<li>Pedro Enrique 2013-12-17

    Cause was due to a change in the Ti.App module.
    
    PR for master: <a href="https://github.com/appcelerator/titanium_mobile_blackberry/pull/199" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_blackberry/pull/199</a>
    PR for 3.2.x: <a href="https://github.com/appcelerator/titanium_mobile_blackberry/pull/200" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_blackberry/pull/200</a></li>
<li>Priya Agarwal 2013-12-18

    Tested Environment:
    
    Appcelerator Studio: 3.2.0.201312171913
    SDK:3.2.0.v20131217190633
    alloy: 1.3.0-cr2
    acs: 1.0.10
    npm: 1.3.2
    titanium: 3.2.0-cr3
    titanium-code-processor: 1.1.0-cr2
    OS: Mac OSX 10.9
    Blackberry Z10(v 10.0.10.261)
    
    
    Used with the sample code attached.
    
    Got the expected result as per code.
    
    1)Clicking on 'click here' button. Webview header with id header_2 changes its title as 'something else' and also button with having title 'fire event' also changes to 'something else'. Console also gets logged printed with "Hello World!"
    
    2)Then on clicking 'something else' title button. Again the Webview header with id header_2 changes its title as 'prop_1' 
    
    Hence closing the issue as working fine.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14207.json">JSON Source</a></p>