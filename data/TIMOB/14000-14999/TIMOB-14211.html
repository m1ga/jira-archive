---
title: "[TIMOB-14211] Android: Photo deleted on Xperia Arc (lt15i)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android</td></tr>
<tr><th>Reporter</th><td>Antoine Joulie</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2013-05-03T15:56:00.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T20:03:26.000+0000</td></tr>
</table>

<h3>Description</h3>

Desc : On an xperia arc, sometimes photos are not present into device and log show a FileNotFoundException on MediaModule#createDictForImage  (when calling TiBlob.blobFromFile). This does not all the time, but something like 1 time every 5 times.

Here is an app.js that reproduce the bug (notice that savePhotoToGallery is false)

*Test case*
<code><pre>
// app.js
//
function showCamera() {
    Ti.Media.showCamera({
        success:            function(e) {alert('image ok, width ' + e.media.width);},
        cancel:             function() {alert('cancel');},
        error:              function() {alert('error');},
        showControls:       true,       // show the controls in the bottom
        saveToPhotoGallery: false,      // true if you want to save the photo taken in the gallery
        autohide:           false,      // let the app decide when to close the camera
        allowImageEditing:  false       // ?
    });
}
// this sets the background color of the master UIView (when there are no windows/tab groups on it)
Titanium.UI.setBackgroundColor('#000');

//
// create base UI tab and root window
//
var win1 = Titanium.UI.createWindow({
    title:'Tab 1',
    backgroundColor:'#fff'
});

var button = Titanium.UI.createButton({
    color:'#999',
    title:'Click me',
    font:{fontSize:40,fontFamily:'Helvetica Neue'},
    textAlign:'center',
    width:'100',
});

button.addEventListener('click', function() {
    showCamera();
});

win1.add(button);

// open tab group
win1.open();

</pre></code>

Problem : On file MediaModule.java into onResult method, the cursor returns a image which is already saved into my application bucket. 

Then later in the code, function moveImage is called with the same value for source and destination, leading to the deletion of the image.

I quick fixed the problem by adding following code at the beginning of  method MediaModule#moveImage.

*MediaModule.java* 
<code><pre>
      if (source == dest) {
        Log.e(TAG, "source (" +source + ") eq to dest (" + dest + "). Not moving file", Log.DEBUG_MODE);
        return;
      }

</pre></code>

<h3>Comments</h3>

<ol>
<li>Lokesh Choudhary 2014-04-14

   Didn't have Xperia Arc device but tried on Xperia(st25i) running 2.3.7 & could not reproduce the issue. Ran an app created using the code above, 5-10 times, every time pic was taken successfully & I did not get any errors.
   
   Environment:
   Appc Studio : 3.2.3.201404111117
   Ti SDK : 3.2.3.v20140403105720
   Mac OSX : 10.8.5
   Alloy : 1.3.1	
   CLI - 3.2.3-alpha2
   Xperia running android 2.3.7</li>
</ol>


<p><a href="/TIMOB/TIMOB-14211.json">JSON Source</a></p>