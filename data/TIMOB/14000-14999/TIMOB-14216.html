---
title: "[TIMOB-14216] Android: setDisplayHomeAsUp doesn't work on a window with the navBarHidden property set to true"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, holo, navbarhidden, setDisplayHomeAsUp</td></tr>
<tr><th>Reporter</th><td>Romain Salles</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2013-05-21T15:50:22.000+0000</td></tr>
<tr><th>Updated</th><td>2016-06-30T04:37:01.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>The issue</h4>

It is not possible to call *setDisplayHomeAsUp* on the activity of a window with the *navBarHidden* property set to *true*. Otherwise, we get this error :

<code><pre>
05-21 15:36:54.035: E/TiApplication(21464): (main) [163,163] Sending event: exception on thread: main msg:java.lang.NullPointerException; Titanium 3.1.0,2013/04/15 18:46,57634ef
05-21 15:36:54.035: E/TiApplication(21464): java.lang.NullPointerException
05-21 15:36:54.035: E/TiApplication(21464): 	at org.appcelerator.titanium.proxy.ActionBarProxy.handlesetDisplayHomeAsUp(ActionBarProxy.java:178)
05-21 15:36:54.035: E/TiApplication(21464): 	at org.appcelerator.titanium.proxy.ActionBarProxy.handleMessage(ActionBarProxy.java:201)
05-21 15:36:54.035: E/TiApplication(21464): 	at android.os.Handler.dispatchMessage(Handler.java:95)
05-21 15:36:54.035: E/TiApplication(21464): 	at android.os.Looper.loop(Looper.java:137)
05-21 15:36:54.035: E/TiApplication(21464): 	at android.app.ActivityThread.main(ActivityThread.java:4507)
05-21 15:36:54.035: E/TiApplication(21464): 	at java.lang.reflect.Method.invokeNative(Native Method)
05-21 15:36:54.035: E/TiApplication(21464): 	at java.lang.reflect.Method.invoke(Method.java:511)
05-21 15:36:54.035: E/TiApplication(21464): 	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:790)
05-21 15:36:54.035: E/TiApplication(21464): 	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:557)
05-21 15:36:54.035: E/TiApplication(21464): 	at dalvik.system.NativeStart.main(Native Method)
05-21 15:36:54.045: E/AndroidRuntime(21464): FATAL EXCEPTION: main
</pre></code>

<h4>Code to reproduce</h4>

app.js :
<code><pre>
function openNewWindow() {
	var newWin = Ti.UI.createWindow({navBarHidden: true, backgroundColor: '#0F0'});

	newWin.addEventListener("open", function() {
		var newActionBar = this.activity.actionBar;
		if (newActionBar) {
			newActionBar.setDisplayHomeAsUp(true);
		}
	});

	newWin.open();
}

(function() {
	var win = Ti.UI.createWindow({backgroundColor: '#F00'});
	win.addEventListener("open", openNewWindow);

	win.open();
})();
</pre></code>

tiapp.xml :
<code><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
    &lt;id&gt;com.tab.test&lt;/id&gt;
    &lt;name&gt;TabTest&lt;/name&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;publisher&gt;johndoe&lt;/publisher&gt;
    &lt;url&gt;http://&lt;/url&gt;
    &lt;description&gt;not specified&lt;/description&gt;
    &lt;copyright&gt;not specified&lt;/copyright&gt;
    &lt;icon&gt;appicon.png&lt;/icon&gt;
    &lt;persistent-wifi&gt;false&lt;/persistent-wifi&gt;
    &lt;prerendered-icon&gt;false&lt;/prerendered-icon&gt;
    &lt;statusbar-style&gt;default&lt;/statusbar-style&gt;
    &lt;statusbar-hidden&gt;false&lt;/statusbar-hidden&gt;
    &lt;fullscreen&gt;false&lt;/fullscreen&gt;
    &lt;navbar-hidden&gt;false&lt;/navbar-hidden&gt;
    &lt;analytics&gt;false&lt;/analytics&gt;
    &lt;guid&gt;e96a483e-41b2-4212-b78a-910612e01548&lt;/guid&gt;
    &lt;property name="ti.ui.defaultunit" type="string"&gt;system&lt;/property&gt;
    &lt;iphone&gt;
        &lt;orientations device="iphone"&gt;
            &lt;orientation&gt;Ti.UI.PORTRAIT&lt;/orientation&gt;
        &lt;/orientations&gt;
        &lt;orientations device="ipad"&gt;
            &lt;orientation&gt;Ti.UI.PORTRAIT&lt;/orientation&gt;
            &lt;orientation&gt;Ti.UI.UPSIDE_PORTRAIT&lt;/orientation&gt;
            &lt;orientation&gt;Ti.UI.LANDSCAPE_LEFT&lt;/orientation&gt;
            &lt;orientation&gt;Ti.UI.LANDSCAPE_RIGHT&lt;/orientation&gt;
        &lt;/orientations&gt;
    &lt;/iphone&gt;
    &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
        &lt;tool-api-level&gt;17&lt;/tool-api-level&gt;
        &lt;manifest&gt;
            &lt;uses-sdk android:minSdkVersion="8"/&gt;
            &lt;!-- TI_MANIFEST --&gt;
            &lt;application android:debuggable="false"
                android:icon="@drawable/appicon" android:label="TabTest"
                android:name="TabtestApplication" android:theme="@android:style/Theme.Holo.Light"&gt;
                &lt;!-- TI_APPLICATION --&gt;
                &lt;activity
                    android:configChanges="keyboardHidden|orientation"
                    android:label="TabTest" android:name=".TabtestActivity"&gt;
                    &lt;intent-filter&gt;
                        &lt;action android:name="android.intent.action.MAIN"/&gt;
                        &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
                    &lt;/intent-filter&gt;
                &lt;/activity&gt;
                &lt;activity
                    android:configChanges="keyboardHidden|orientation" android:name="org.appcelerator.titanium.TiActivity"/&gt;
                &lt;activity
                    android:configChanges="keyboardHidden|orientation"
                    android:name="org.appcelerator.titanium.TiTranslucentActivity" android:theme="@android:style/Theme.Translucent"/&gt;
                &lt;activity
                    android:configChanges="keyboardHidden|orientation"
                    android:name="org.appcelerator.titanium.TiModalActivity" android:theme="@android:style/Theme.Translucent"/&gt;
                &lt;activity
                    android:configChanges="keyboardHidden|orientation" android:name="ti.modules.titanium.ui.TiTabActivity"/&gt;
            &lt;/application&gt;
        &lt;/manifest&gt;
    &lt;/android&gt;
    &lt;modules/&gt;
    &lt;deployment-targets&gt;
        &lt;target device="blackberry"&gt;false&lt;/target&gt;
        &lt;target device="android"&gt;true&lt;/target&gt;
        &lt;target device="ipad"&gt;false&lt;/target&gt;
        &lt;target device="iphone"&gt;false&lt;/target&gt;
        &lt;target device="mobileweb"&gt;false&lt;/target&gt;
    &lt;/deployment-targets&gt;
    &lt;sdk-version&gt;3.1.0.GA&lt;/sdk-version&gt;
&lt;/ti:app&gt;
</pre></code>


If we set navBarHidden to false, the app will work :

<code><pre>
	var newWin = Ti.UI.createWindow({navBarHidden: false, backgroundColor: '#0F0'});
</pre></code>

instead of

<code><pre>
	var newWin = Ti.UI.createWindow({navBarHidden: true, backgroundColor: '#0F0'});
</pre></code>

<h4>Devices used</h4>

This problem is only reproducible on devices using *Holo*.
I have tested on these devices :

- Samsung S2 (GT-I9100P), android 4.0.3 -> *crash* (supports Holo)
- Nexus S, android 4.1.2 -> *crash* (supports Holo)
- Samsung S3 (GT-I93000), android 4.1.2 -> *crash* (supports Holo)
- HTC Desire HD A9191, android 2.2 -> *ok* (does not supports Holo)
- Samsung GT-S5830, android 2.3.3 -> *ok* (does not support Holo)
- HTC Wildfire A3333, android 2.2.1 -> *ok* (does not support Holo)

<h3>Comments</h3>

<ol>
<li>Romain Salles 2013-05-21

   </li>
<li>Jonatan Lundin 2014-05-08

   Trying to set displayHomeAsUp will trigger the crash when the ActionBarProxy tries to access the underlying Activity's ActionBar. Checking for existence (like in the fix for TIMOB-14215) would fix this. 
   <a href="https://github.com/appcelerator/titanium_mobile/blob/3_2_X/android/titanium/src/java/org/appcelerator/titanium/proxy/ActionBarProxy.java#L323" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/3_2_X/android/titanium/src/java/org/appcelerator/titanium/proxy/ActionBarProxy.java#L323</a>
   
   Reading further along in the code though, it appears like the same issue can be triggered by trying to add an event listener/setOnHomeIconItemSelected-callback to the home button as well, if the onPropertyChanged()-method gets called directly on the main thread. 
   
   <a href="https://github.com/appcelerator/titanium_mobile/blob/3_2_X/android/titanium/src/java/org/appcelerator/titanium/proxy/ActionBarProxy.java#L337" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/3_2_X/android/titanium/src/java/org/appcelerator/titanium/proxy/ActionBarProxy.java#L337</a></li>
<li>Ingo Muschenetz 2014-05-08

   FYI</li>
</ol>


<p><a href="/TIMOB/TIMOB-14216.json">JSON Source</a></p>