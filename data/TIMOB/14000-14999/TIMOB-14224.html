---
title: "[TIMOB-14224] Android: xhr.abort() call makes all subsequent xhr calls fail completely"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-08-23T23:37:45.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 17, 2013 Sprint 17 API, Release 3.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>supportTeam</td></tr>
<tr><th>Reporter</th><td>Eduardo Gomez</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2013-06-13T21:26:19.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-14T20:24:44.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue</h4>
Once we call abort() method on xhr (which we need to cancel download), all the subsequent calls to xhr client are failing. The request is going to the server but from the server we are getting the below error:

<h4>stack trace</h4>
<code><pre>
06-13 16:18:22.125: W/ResponseProcessCookies(21195): Cookie rejected: "BasicClientCookie[version=0,name=ObFormLoginCookie,domain=sso.cisco.com,path=/autho/login/loginaction.html,expiry=null]". Illegal path attribute "/autho/login/loginaction.html". Path of origin: "/obrareq.cgi"
</pre></code>

- Thread
A similar discussion about how fix this: <a href="http://stackoverflow.com/questions/8279970/accept-all-cookies-via-httpclient" rel="nofollow" target="_blank">http://stackoverflow.com/questions/8279970/accept-all-cookies-via-httpclient</a>


<h3>Comments</h3>

<ol>
<li>Ingo Muschenetz 2013-06-13

   [~egomez] is it possible to extract out an example into a short code snippet showing the failure?</li>
<li>Vishal Duggal 2013-07-09

   Aborting the xhr request tears down the underlying TCP connection.
   
   If you actually see the response from the server after the abort you'll see the code for a Login Page (so the client needs to re-authenticate after abort).
   
   The server supports Basic Access Authentication, so setting a basic auth request header instead of the cookie information will work every time (even after abort)
   
   <code><pre>
   	var basic_authStr = 'Basic ' +Titanium.Utils.base64encode(USERNAME+':' + PASSWORD);
   	xhr.setRequestHeader("Authorization", basic_authStr);
   	xhr.open('GET', url);
   	xhr.send();
   </pre></code>
   
   Resolving this as not our bug</li>
<li>Eduardo Gomez 2013-07-15

   Please see feedback to points:
   
   <h4>Work arounds</h4>
   (1) Do a silent login after abort.
   
   <h4>Feedback:</h4>
   We cannot ask user to re-login after every abort.
   As per Cisco policy we should not store the user credential anywhere is app, so we cannot got for Basic authentication. Our Cisco framework gives us a Cookie and which we need re-use, for further server communication.
   
   (2) Don't abort. Just ignore the results.
   
   <h4>Feedback:</h4>
   This will slow the app, because even we are not downloading the content the data chunk will be downloading to the device.
   
   (3) The server seems to support basic authorization. We essentially changed the code in Search.js to send an Authorization Header instead of the ObSSOCookie to get it to work fine even after abort.
   
   <h4>Feedback:</h4>
   As mentioned in #1, we should not store user credentials, and we should use the cookies for further server communication.
   
   <h4>Customer's remarks</h4>
   "Please provide us a solution to use the cookies, for further communication. This mechanism  of Cookies is working fine with iOS implementation and working fine with our apps on iPhone and iPad."</li>
<li>Hieu Pham 2013-08-07

   master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/4549" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4549</a></li>
<li>Eduardo Gomez 2013-08-12

   Hi, I've tested out PR and works great.
   
   As I just wanted to make sure their app runs smoothly and without outstanding issues. I found the following outcome:
   
   <h4>Details</h4>
   User once logged in, attempts to get file "A". If he "aborts" current download the exception below is thrown. When he resumes (click "Download") then he won't be able to abort this file download over again (to be clear: the download will finalize successfully).
   
   <h4>Device stack trace   </h4>
   Razr Droid 2.3.5 on TiSDK 3.2 CI build
   <code><pre>
   08-11 20:38:34.076: W/DefaultHttpClient(4586): Error consuming content after an exception.
   08-11 20:38:34.076: W/DefaultHttpClient(4586): java.net.SocketException: Socket is closed
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl.checkOpen(OpenSSLSocketImpl.java:339)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl.access$100(OpenSSLSocketImpl.java:57)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl$SSLInputStream.read(OpenSSLSocketImpl.java:776)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.AbstractSessionInputBuffer.fillBuffer(AbstractSessionInputBuffer.java:103)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.AbstractSessionInputBuffer.read(AbstractSessionInputBuffer.java:134)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.ContentLengthInputStream.read(ContentLengthInputStream.java:174)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.ContentLengthInputStream.read(ContentLengthInputStream.java:188)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.ContentLengthInputStream.close(ContentLengthInputStream.java:121)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.entity.BasicHttpEntity.consumeContent(BasicHttpEntity.java:142)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.conn.BasicManagedEntity.consumeContent(BasicManagedEntity.java:114)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:662)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:637)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at ti.modules.titanium.network.TiHTTPClient$ClientRunnable.run(TiHTTPClient.java:1277)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at java.lang.Thread.run(Thread.java:1019)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): Error consuming content after an exception.
   08-11 20:38:34.076: W/DefaultHttpClient(4586): java.net.SocketException: Socket is closed
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl.checkOpen(OpenSSLSocketImpl.java:339)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl.access$100(OpenSSLSocketImpl.java:57)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl$SSLInputStream.read(OpenSSLSocketImpl.java:776)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.AbstractSessionInputBuffer.fillBuffer(AbstractSessionInputBuffer.java:103)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.AbstractSessionInputBuffer.read(AbstractSessionInputBuffer.java:134)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.ContentLengthInputStream.read(ContentLengthInputStream.java:174)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.ContentLengthInputStream.read(ContentLengthInputStream.java:188)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.io.ContentLengthInputStream.close(ContentLengthInputStream.java:121)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.entity.BasicHttpEntity.consumeContent(BasicHttpEntity.java:142)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.conn.BasicManagedEntity.consumeContent(BasicManagedEntity.java:114)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:662)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:637)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at ti.modules.titanium.network.TiHTTPClient$ClientRunnable.run(TiHTTPClient.java:1277)
   08-11 20:38:34.076: W/DefaultHttpClient(4586): 	at java.lang.Thread.run(Thread.java:1019)
   </pre></code>
   
   Once File "A" was downloaded successfully, user attempts to get File "B". Download progress starts off. User aborts. Exception below is thrown. If he resumes by clicking "Download" button they won't be able to abort anymore. But again the file "B" will be downloaded successfully: 
   
   <code><pre>
   08-11 20:47:24.561: D/TiHttpClient(4586): (TiHttpClient-24) [353743,546582] client is not valid, unable to clear expired and idle connections
   08-11 20:47:24.561: E/TiHttpClient(4586): (TiHttpClient-24) [0,546582] HTTP Error (java.lang.NullPointerException): java.lang.NullPointerException
   08-11 20:47:24.561: E/TiHttpClient(4586): java.lang.NullPointerException
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at ti.modules.titanium.network.TiHTTPClient$LocalResponseHandler.finishedReceivingEntityData(TiHTTPClient.java:376)
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at ti.modules.titanium.network.TiHTTPClient$LocalResponseHandler.handleResponse(TiHTTPClient.java:308)
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at ti.modules.titanium.network.TiHTTPClient$LocalResponseHandler.handleResponse(TiHTTPClient.java:216)
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:657)
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:637)
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at ti.modules.titanium.network.TiHTTPClient$ClientRunnable.run(TiHTTPClient.java:1277)
   08-11 20:47:24.561: E/TiHttpClient(4586): 	at java.lang.Thread.run(Thread.java:1019)
   08-11 20:47:27.162: I/TiAPI(4586):  onerror ----&gt;java.lang.NullPointerException
   </pre></code>
   
   <h4>Outcomes</h4>
   - From Android docs: <a href="http://developer.android.com/reference/org/apache/http/HttpEntity.html#consumeContent()" rel="nofollow" target="_blank">http://developer.android.com/reference/org/apache/http/HttpEntity.html#consumeContent()</a>
   <code><pre>
   This method is called to indicate that the content of this entity is no longer required. All entity implementations are expected to release all allocated resources as a result of this method invocation. Content streaming entities are also expected to dispose of the remaining content, if any. Wrapping entities should delegate this call to the wrapped entity. 
   This method is of particular importance for entities being received from a connection. The entity needs to be consumed completely in order to re-use the connection with keep-alive.
   </pre></code>
   
   Do they need to warn users Abort method would work only once? Are these entities throwing an exception when this method is called multiple times?
   
   If you need further clarity, or anymore info let me know, thanks.</li>
<li>Ping Wang 2013-08-23

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/4549" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4549</a></li>
<li>Lee Morris 2017-03-14

   Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14224.json">JSON Source</a></p>