---
title: "[TIMOB-14393] Android: JS proxies are prematurely cleaned up when dalvik gc is triggered "
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-06-01T22:58:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>supportTeam</td></tr>
<tr><th>Reporter</th><td>Allen Yeung</td></tr>
<tr><th>Assignee</th><td>Pedro Enrique</td></tr>
<tr><th>Created</th><td>2013-06-26T18:46:16.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-31T22:22:36.000+0000</td></tr>
</table>

<h3>Description</h3>



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-14393_46798/S4_logs.txt">S4_logs.txt</td></td><td>2014-03-22T00:16:21.000+0000</td><td>49042</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Yuri Goldfeld 2014-03-20

   This just hit us (SDK 3.2.0) and is rather horrendous and insidious, because it is not consistently reproducible and is difficult to diagnose (for us it manifests itself as a crash, but it's a native crash and thus is not caught by ACRA for example).  It also makes one extremely paranoid, because if one cannot count on the JavaScript scope pattern, then basically the app is a ticking time bomb.
   
   In our case the problem happened to be a View created in a closure in a CommonJS module, with the View (being a simple red border used for error display) added or removed to/from another view when an error is detected or not.  (Yes, now that we know the cause, we can work around it by using another technique, but like I said, what other semi-reproducible similar problems lurk?)  We only caught this after upgrading to SDK 3.2.0; not reported when we used 3.1.1; it might be due to something changing about GC itself (speculation).</li>
<li>Frank Apap 2014-04-29

   This causes major headaches for my app, lots of crash reports and no easy fix without a major refactoring.</li>
<li>Pedro Enrique 2015-05-29

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6887" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6887</a></li>
<li>Pedro Enrique 2015-06-01

   To test, use this code, run on emulator for consistent results
   <code><pre>
   function createView() {
   
   	var view = Ti.UI.createView({
   		backgroundColor: 'white'
   	});
   	var gc = Ti.UI.createButton({
   		top: '10dp',
   		title: "First, click here many time quickly (cause GC)",
   		color: 'black'
   	});
   	var btn = Ti.UI.createButton({
   		title: "Next, click here",
   		color: 'black'
   	});
   	view.add(btn);
   	view.add(gc);
   
   	// Label not attached to the view yet, but will be in the btn event listener
   	var label = Ti.UI.createLabel({
   		text: 'Hello World', bottom: '10dp',
   		color: 'black'
   	});
   
   	gc.addEventListener('click', function(){
   		Ti.API.info('Forcing GC...');
   		for (var i = 0; i &lt; 2000; i++) {
   			Ti.UI.createButton();
   		}
   		Ti.API.info('Done with GC...');
   	});
   	btn.addEventListener('click', function(){
   		view.add(label);
   	});
   
   	return view;
   }
    
    
   var win = Ti.UI.createWindow();
   var view = createView();
   win.add(view);
   win.open();
   </pre></code></li>
<li>Lee Morris 2017-03-31

   Closing ticket as fixed, if there are any problems, please file a new ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14393.json">JSON Source</a></p>