---
title: "[TIMOB-14540] Android: blob.imageAsResize causes java error"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-08-16T23:22:10.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.1, Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 17, 2013 Sprint 17 API, Release 3.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>mobilesdk, module_media, qe-testadded, titanium</td></tr>
<tr><th>Reporter</th><td>Ashish Nigam</td></tr>
<tr><th>Assignee</th><td>Ping Wang</td></tr>
<tr><th>Created</th><td>2013-07-12T13:16:39.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-19T12:44:08.000+0000</td></tr>
</table>

<h3>Description</h3>

*Problem*
When using the imageAsResized function on a blob it causes a java memory error when using a device which has a camera with 6 megapixels or more.

I used the code below on the Galaxy S3, and a lot of times it causes an error, sometimes it doesn't. When i set the camera to 3.2 megapixels for example the issue doesn't occur.

*Steps to reproduce*
1. Tap Open Camera
2. Take photo
3. Save photo
4. Repeat until Runtime Error appears (see attachment)

*Test case*
<code><pre>
var win1 = Titanium.UI.createWindow({
	title : 'cameratest',
	backgroundColor : '#fff'
});

var button = Titanium.UI.createButton({
	color : '#999',
	title : 'Open camera'
});

win1.add(button);

button.addEventListener("click", function(e) {
	Ti.Media.showCamera({
		mediaTypes : [Ti.Media.MEDIA_TYPE_PHOTO],
		success : function(e) {
			var width = e.media.width, height = e.media.height, scaleFactor = Math.sqrt((width * height ) / (1600 * 1200 ));

			if (scaleFactor &gt; 1) {
				width /= scaleFactor;
				height /= scaleFactor;

				var image = e.media.imageAsResized(width, height);
			}
		}
	});
});

win1.open();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Ping Wang 2013-07-29

   This OutOfMemoryError happens because the image size is too big and the GC does not kick in in time. We cannot control when the GC kicks in, so the developers need to take care of memory wisely.
   Sent PR <a href="https://github.com/appcelerator/titanium_mobile/pull/4509" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4509</a> to handle the error gracefully so the app won't crash any more.
   For FR, please run the above test case on Galaxy S3 and follow step 1-4 and should not see any crash.</li>
<li>Paras Mishra 2013-10-21

   App is running fine with no error, tried several times.
   
   Verified fix on:
   Device: Samsung S3, Android version: 4.1.1
   SDK: 3.2.0.v20131018154951
   CLI version : 3.2.0
   OS : MAC OSX 10.8.4
   Alloy : 1.2.2
   Appcelerator Studio, build: 3.2.0.201310181700
   XCode : 5</li>
</ol>


<p><a href="/TIMOB/TIMOB-14540.json">JSON Source</a></p>