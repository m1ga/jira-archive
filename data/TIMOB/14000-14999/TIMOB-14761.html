---
title: "[TIMOB-14761] Android: Ti.Map is unable to access getAnnotations() method"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-09-04T21:36:23.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 18, 2013 Sprint 18 API, Release 3.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, mapv2, parity</td></tr>
<tr><th>Reporter</th><td>Chris Golding</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2013-08-01T23:53:57.000+0000</td></tr>
<tr><th>Updated</th><td>2013-11-14T09:46:06.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
When I attempt to access annotations on a map view created by Ti.Map in Alloy I find that the annotations are undefined, however they are displayed on the map. I do not have this issue when creating the map using the traditional method.

I need to be able to get all the current annotations and loop through them, I have tried using the getAnnotations() method but no results are returned.

This issue does not exist with the map on iOS.

Below is the code to reproduce this issue.

<h4>alloy.js</h4>
<code><pre>
Alloy.Globals.Map = require('ti.map');
</pre></code>

<h4>index.xml</h4>
<code><pre>
&lt;Alloy&gt;
    &lt;Window&gt;
        &lt;!-- Use the Alloy.Globals.Map namespace to create a map module view --&gt;
        &lt;View id="mapview" ns="Alloy.Globals.Map" onClick="report" /&gt;
    &lt;/Window&gt;
&lt;/Alloy&gt;
</pre></code>

<h4>index.js</h4>
<code><pre>
function report(evt) {
    Ti.API.info("Annotation " + evt.title + " clicked, id: " + evt.annotation.myid);
}

// API calls to the map module need to use the Alloy.Globals.Map reference
var mountainView = Alloy.Globals.Map.createAnnotation({
    latitude:37.390749,
    longitude:-122.081651,
    title:"Appcelerator Headquarters",
    subtitle:'Mountain View, CA',
    pincolor:Alloy.Globals.Map.ANNOTATION_RED,
    myid:1 // Custom property to uniquely identify this annotation.
});

$.mapview.region = {latitude:33.74511, longitude:-84.38993,
                    latitudeDelta:0.01, longitudeDelta:0.01};
$.mapview.addAnnotations([mountainView]);

alert($.mapview.getAnnotations().length);
</pre></code>

<h3>Comments</h3>

<ol>
<li>Eduardo Gomez 2013-08-05

   <h4>Alloy app</h4>
   Surprisingly I couldn't use the Alloy global namespace (got a module not found error). Then reproduced the getAnnotations() issue on TiSDK 3.1.1.GA using controller shown below:
   
   <code><pre>
   &lt;Alloy&gt;
       &lt;Window&gt;
           &lt;!-- Use the Alloy.Globals.Map namespace to create a map module view --&gt;
           &lt;View id="mapview" ns="Ti.Map" onClick="report" /&gt;
       &lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   iOS reports "1" meanwhile Android returns "0".
   
   <h4>Titanium app</h4>
   On TiSDK 3.1.1.GA on iOS Simulator v6.1.2 returns "1" annotations, meanwhile Android just returns "0" annotations.
   
   If same method is tested by a Titanium simple sample length property is undefined.
   
   <h4>Device stack trace (Razr 2.3.5)</h4>
   <code><pre>
   08-05 15:22:19.579: E/TiExceptionHandler(12312): (main) [122,268] ----- Titanium Javascript Runtime Error -----
   08-05 15:22:19.579: E/TiExceptionHandler(12312): (main) [0,268] - In app.js:20,31
   08-05 15:22:19.579: E/TiExceptionHandler(12312): (main) [1,269] - Message: Uncaught TypeError: Cannot read property 'length' of undefined
   08-05 15:22:19.579: E/TiExceptionHandler(12312): (main) [0,269] - Source: alert(mapview.getAnnotations().length);
   </pre></code>
   
   <h4>Simple sample</h4>
   <code><pre>
   var win1 = Ti.UI.createWindow();
   
   var mapview = Ti.Map.createView();
   
   // API calls to the map module need to use the Alloy.Globals.Map reference
   var mountainView = Ti.Map.createAnnotation({
   	latitude : 37.390749,
   	longitude : -122.081651,
   	title : "Appcelerator Headquarters",
   	subtitle : 'Mountain View, CA',
   	pincolor : Ti.Map.ANNOTATION_RED,
   	myid : 1 // Custom property to uniquely identify this annotation.
   });
   
   mapview.region = {
   	latitude : 33.74511,
   	longitude : -84.38993,
   	latitudeDelta : 0.01,
   	longitudeDelta : 0.01
   };
   
   mapview.addAnnotations([mountainView]);
   
   alert(mapview.getAnnotations().length);
   win1.add(mapview);
   
   win1.open(); 
   </pre></code></li>
<li>Chris Golding 2013-08-05

   I did find a method to get the annotations on Android.  However you have to create the annotations prior to creating the view, and any annotations added after creating the view are not returned by getAnnotations().  This doesn't solve my issue since I am creating and deleting annotations on the fly.
   
   <code><pre>
   var MapModule = require('ti.map');
    
   var win = Ti.UI.createWindow({fullscreen: false, layout: "vertical"});
   
    
   var anno = MapModule.createAnnotation({
       latitude : -33.87365,
       longitude : 151.20689,
       title : "Drag Me",
       subtitle : "Sydney is quite chill",
       draggable : true
   });
   var anno2 = MapModule.createAnnotation({
       latitude : -33.86365,
       image : "applogo.png",
       longitude : 151.21689,
       title : "Drag Me 2",
       subtitle : "This is anno2",
       draggable : true
   });
   var anno3 = MapModule.createAnnotation({
       latitude : -33.85365,
       pincolor : MapModule.ANNOTATION_BLUE,
       longitude : 151.20689,
       title : "anno3",
       subtitle : "This is anno3",
       draggable : false
   });
    
   var map = MapModule.createView({
       enableZoomControls: false,
       mapType: MapModule.NORMAL_TYPE,
       animate: true,
       annotations: [anno, anno2, anno3],
       region: {latitude: -33.87365, longitude: 151.20689, latitudeDelta: 0.1, longitudeDelta: 0.1 } //Sydney
   });
    
   var anno4 = MapModule.createAnnotation({
       latitude : -34.85365,
       pincolor : MapModule.ANNOTATION_BLUE,
       longitude : 152.20689,
       title : "anno4",
       subtitle : "This is anno4",
       draggable : false
   });
   
   map.addAnnotation(anno4);
   
   win.add(map);
   win.open();
   
   alert(map.getAnnotations().length);
   </pre></code></li>
<li>Hieu Pham 2013-08-23

   master PR: <a href="https://github.com/appcelerator-modules/ti.map/pull/3" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/3</a>
   </li>
<li>Hieu Pham 2013-08-24

   Testing steps: 
   
   1. Run the classic titanium test case mentioned in the above comment. Should see an alert showing '4'.
   2. Run app.js from example/app.js inside the map module. Play around with 'Annotation Test' suite and make sure there are no regressions.
   3. Run this additional test case
   <code><pre>
   var MapModule = require('ti.map');
     
   var win = Ti.UI.createWindow({fullscreen: false, layout: "vertical"});
    
     
   var anno = MapModule.createAnnotation({
       latitude : -33.87365,
       longitude : 151.20689,
       title : "anno",
       subtitle : "Sydney is quite chill",
       draggable : true
   });
   var anno2 = MapModule.createAnnotation({
       latitude : -33.86365,
       image : "applogo.png",
       longitude : 151.21689,
       title : "anno2",
       subtitle : "This is anno2",
       draggable : true
   });
   var anno3 = MapModule.createAnnotation({
       latitude : -33.85365,
       pincolor : MapModule.ANNOTATION_BLUE,
       longitude : 151.20689,
       title : "anno3",
       subtitle : "This is anno3",
       draggable : false
   });
     
   var map = MapModule.createView({
       enableZoomControls: false,
       mapType: MapModule.NORMAL_TYPE,
       animate: true,
       //annotations: [anno, anno2, anno3],
       region: {latitude: -33.87365, longitude: 151.20689, latitudeDelta: 0.1, longitudeDelta: 0.1 } //Sydney
   });
     
   var anno4 = MapModule.createAnnotation({
       latitude : -34.85365,
       pincolor : MapModule.ANNOTATION_BLUE,
       longitude : 152.20689,
       title : "anno4",
       subtitle : "This is anno4",
       draggable : false
   });
   
   win.add(map);
   win.open();
   
   
   setTimeout (function() {
   
   map.addAnnotations([anno, anno2, anno4]);
   map.removeAllAnnotations();
   map.removeAnnotations(["anno4"]);
   map.removeAnnotation(anno);
   map.addAnnotations([anno, anno2]);
   
   Ti.API.info(JSON.stringify(map.getAnnotations()));
   alert((map.getAnnotations().length));
   }, 1000);
   </pre></code>
   You should see an alert printing '2', and logcat should have the content of those 2 annotations.
   4. Change line 61 in the above code to 100 (instead of 1000), also try to run the block without setTimeout. The result should be the same.
   </li>
<li>Priya Agarwal 2013-11-14

   Verified with test environment:
   
   Appcelerator Studio: 3.2.0.201311122338
   SDK:3.2.0.v20131113183932
   alloy: 1.3.0
   acs: 1.0.7
   npm: 1.3.2
   titanium: 3.2.0
   titanium-code-processor: 1.1.0
   Xcode:5.0.2
   Device: Google Nexus7(v4.3)
   OS: Mac OSX 10.9
   
   
   getAnnotation() working fine.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14761.json">JSON Source</a></p>