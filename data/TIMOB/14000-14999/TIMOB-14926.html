---
title: "[TIMOB-14926] iOS: Memory leak on window containing a Ti.UI.iPhone.NavigationGroup"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Resolved</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2017-04-09T21:53:48.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>leak, memory, navgroup, navigationgroup</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2013-08-02T07:02:15.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T20:04:07.000+0000</td></tr>
</table>

<h3>Description</h3>

When I'm not using a <code>Ti.UI.iPhone.NavigationGroup</code> in my main/root application window, there will be a time I need to close the <code>Ti.UI.Window</code> wrapping the navigation group. But when I do, Instruments show it's leaking.

Consider the following <code>app.js</code>:

<code><pre>
function onClose(e) {
  Ti.API.info('Closed: ' + e.source._id);
}

function closeNav() {
  container.close();
  // Uncomment for 2nd test-case: child.close();
}

var application = Ti.UI.createWindow({
  backgroundColor: 'red'
});
application.addEventListener('click', function () {
  container.open();
});

var container = Titanium.UI.createWindow({
  _id: 'container',
  backgroundColor: 'green',
});
container.addEventListener('close', onClose);

var child = Titanium.UI.createWindow({
  _id: 'child',
  backgroundColor: 'blue',
  title: 'Window'
});
child.addEventListener('click', closeNav);
child.addEventListener('close', onClose);

var nav = Titanium.UI.iPhone.createNavigationGroup({
  window: child
});

container.add(nav);
application.open();
</pre></code>

Now do the following:
<h4>Run the app.</h4>
<h4>Click the red application window to open the navigationgroup holding a blue window.</h4>
<h4>Click the blue window to close the window containing the navigationgroup.</h4>

The console will show the following after step 3:
<code><pre>
[INFO] Closed: container
</pre></code>

And instruments will report the following number of living <code>TiUIWindow</code>'s after:
<h4>Living: 1 (the application window)</h4>
<h4>Living: 3 (the application, container and child windows)</h4>
<h4>Living: 2 (the application and child window I guess)</h4>

Now, if you uncomment line 7 and follow the same steps the console will show:
<code><pre>
[INFO] Closed: container
[INFO] Closed: child
</pre></code>

But instruments will still report the same. So I guess, the child is kept hostage by some other native object?

I would expect that closing the container window should be enough to properly clean up, but even the following doesn't give different results:

<code><pre>
function closeNav() {
  container.close();
  container.removeEventListener('close', onClose);
  container = null;
  child.close();
  child.removeEventListener('close', onClose);
  child.removeEventListener('click', closeNav);
  child = null;
  nav = null;
}
</pre></code> 

<h3>Comments</h3>

<ol>
<li>Eduardo Gomez 2013-08-20

   Tested on 3.1.2.GA as well. Seeing UINavigationController not getting released (under Transitory column). Moved to main project to dig into this since docs says: "All [navigation groups](<a href="http://docs.appcelerator.com/titanium/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/latest/#</a>!/api/Titanium.UI.iPhone.NavigationGroup) must have at least one root window that cannot be removed." 
   </li>
<li>Hans Kn√∂chel 2017-04-09

   Not reproducible with <code>Ti.UI.iOS.NavigationWindow</code>.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14926.json">JSON Source</a></p>