---
title: "[TIMOB-14933] CLI: Builds where tiapp.xml sdk-version differs from selected SDK fail to properly fork in Windows"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-08-27T22:16:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.2</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 18 Core, 2013 Sprint 18, Release 3.2.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>qe-closed-3.2.0</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2013-08-21T20:05:11.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-04T18:34:04.000+0000</td></tr>
</table>

<h3>Description</h3>

The CLI tries to strip the first argument if it's the actual "node" executable before parsing the args. The problem is on Windows the node executable can sometimes contain the .exe and the following line of code fails:

<code><pre>
// cli.js (line 218)
args[0].slice(-4) === 'node' && args.shift();
</pre></code>

This line needs to look like this:

<code><pre>
args[0].replace(/\\/g, '/').split('/').pop() == process.execPath.replace(/\\/g, '/').split('/').pop().replace(/\.exe$/, '') && args.shift();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Chris Barber 2013-08-27

   To test:
   
   1) Find a Windows machine
   2) Install the Titanium CLI 3.1.2
   3) Download Titanium SDK 3.1.1.GA and 3.1.2.GA
   4) Set Titanium SDK 3.1.2.GA the selected SDK (ti sdk select 3.1.2.GA)
   5) Apply the PR fix to titanium/lib/cli.js
   6) Create an app and set the app's <sdk-version> to 3.1.1.GA
   7) Build the app (ti build -p mobileweb)</li>
<li>Chris Barber 2013-08-27

   Pull request: <a href="https://github.com/appcelerator/titanium/pull/54" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium/pull/54</a></li>
<li>Samuel Dowse 2013-12-04

   Verified fixed on:
   Windows 7
   Titanium Studio, build: 3.2.0.201311262027
   Titanium SDK, build: 3.2.0.v20131127194046
   CLI: 3.2.0-beta
   Alloy: 1.3.0-beta
   
   If tiapp.xml sdk differs from the selected sdk in CLI, then CLI will fork the correct SDK and build successfully.
   <code><pre>[INFO]  tiapp.xml <sdk-version> set to 3.2.0.v20131127194046, but current Titanium SDK set to 3.2.0.v20131203104847
   [INFO]  Forking correct SDK command: "C:\Program Files (x86)\nodejs\node.exe" "C:\Users\tester\AppData\Roaming\npm\node_modules\titanium\bin\titanium" "build" "--sdk" "3.2.0.v20131127194046" "--config-file" "C:\Users\tester\.titanium\config.json" "--
   platform" "mobileweb" "--project-dir" "C:\Users\tester\Documents\Titanium_Studio_Workspace\mobileweb" "--log-level" "trace" "--deploy-type" "development"</pre></code>
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-14933.json">JSON Source</a></p>