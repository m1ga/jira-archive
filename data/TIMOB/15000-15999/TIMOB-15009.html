---
title: "[TIMOB-15009] LiveView: cannot see Alloy.Globals in modules when using LiveView"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-09-25T22:45:13.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 20, 2013 Sprint 20 Tooling, Release 3.2.0</td></tr>
<tr><th>Components</th><td>LiveView</td></tr>
<tr><th>Labels</th><td>qe-closed-3.2.0</td></tr>
<tr><th>Reporter</th><td>Davide Cassenti</td></tr>
<tr><th>Assignee</th><td>Christian Sullivan</td></tr>
<tr><th>Created</th><td>2013-08-29T15:00:03.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-13T09:07:04.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
When using LiveView, the global variable Alloy.Globals is not defined in modules. Disabling LiveView would not throw the error.

<h4>Code to reproduce</h4>
Create an Alloy app with this code:

index.js
<code><pre>
var win = Ti.UI.createWindow({
    backgroundColor:'#ffffff'
});

Ti.API.info(Alloy.Globals.test);

var Test = require('test');
new Test();

win.open();
</pre></code>

lib/test.js
<code><pre>
function Test() {
	Ti.API.info(Alloy.Globals.test);
};

module.exports = Test;
</pre></code>

Add the global variable in alloy.js:

<code><pre>
Alloy.Globals.test = "TEST";
</pre></code>

<h4>Actual behavior</h4>
When running the app with LiveView on, the following error is thrown:

<code><pre>
[INFO] :   [LiveView] Error Evaluating app.js @ Line: 2
[ERROR] :  TypeError: 'undefined' is not an object (evaluating 'Alloy.Globals')
[ERROR] :  File: app.js
[ERROR] :  Line: 2
[ERROR] :  SourceId: 323744256
[ERROR] :  Backtrace:
[ERROR] :   #0 Controller() at :21
[ERROR] :  #1 () at :214
[ERROR] :  #2 anonymous() at :15
[ERROR] :  #3 () at file://localhost/Users/dcassenti/Library/Application%20Support/iPhone%20Simulator/6.1/Applications/4822E77B-90A1-4555-8E22-DA55E5976F16/DavideAlloyTestApp.app/app.js:628
[ERROR] :  #4 () at file://localhost/Users/dcassenti/Library/Application%20Support/iPhone%20Simulator/6.1/Applications/4822E77B-90A1-4555-8E22-DA55E5976F16/DavideAlloyTestApp.app/app.js:493
[ERROR] :  #5 () at file://localhost/Users/dcassenti/Library/Application%20Support/iPhone%20Simulator/6.1/Applications/4822E77B-90A1-4555-8E22-DA55E5976F16/DavideAlloyTestApp.app/app.js:460
[ERROR] :  #6 () at file://localhost/Users/dcassenti/Library/Application%20Support/iPhone%20Simulator/6.1/Applications/4822E77B-90A1-4555-8E22-DA55E5976F16/DavideAlloyTestApp.app/app.js:392
[ERROR] :  #7 () at file://localhost/Users/dcassenti/Library/Application%20Support/iPhone%20Simulator/6.1/Applications/4822E77B-90A1-4555-8E22-DA55E5976F16/DavideAlloyTestApp.app/app.js:663
</pre></code>

Without LiveView, the error is not shown. Note that in index.js the error is not thrown.

<h3>Comments</h3>

<ol>
<li>Michael Xia 2013-09-03

   Marking TIMOB-14903 a duplicate of this since this has a simpler reproducible case.
   </li>
<li>Christian Sullivan 2013-09-04

   I found an easy fix for this by removing all the <code>var</code>s from the variable declarations in the alloy generated app.js this allows for my original fix to work. 
   
   To test do the following:
   
   1. disable the alloy plugin so it doesn't overwrite you app.js
   2. In your app.js generated by alloy remove <code>var</code> everywhere you see it.
   3. Run <code><pre> $ ti build -p ios --liveview </pre></code>
   
   This should fix the error <code><pre>[ERROR] TypeError: 'undefined' is not an object (evaluating 'Alloy.Globals')</pre></code></li>
<li>Tony Lukasavage 2013-09-05

   As stated in a conversation with [~csullivan] offline, we should in theory be able to do that, but I don't think I'm comfortable doing so on a patch release of Alloy. Given that there are known (and likely unknown) disparities between how global scope is handled on our runtimes/platforms, there seems a high change for some sort of regression to result from this, if not many. I think a change like this should likely wait for a minor release of Alloy, namely 1.3.0. If this is a course of action that we all agree on, a ticket should be logged to ALOY covering all the particulars and I can look into implementing it. After that comes the real task, which will be the extensive testing that will have to be done to ensure that everything still behaves as expected.</li>
<li>Christian Sullivan 2013-09-05

   We might actually want to fix this via liveview so it also covers non alloy apps that rely on this same global scope feature/bug. I am looking into the fix now. I will have to make sure to only remove the var from local lexical scope vars</li>
<li>Christian Sullivan 2013-09-24

   [~mxia] or [~tlukasavage] here is the pr on master <a href="https://github.com/appcelerator/liveview/pull/58" rel="nofollow" target="_blank">https://github.com/appcelerator/liveview/pull/58</a> if one of you could please test to verify this does in fact solve the issue for you. I am unable to reproduce the above test case with this PR.</li>
<li>Michael Xia 2013-09-25

   Yes, I'll do the testing here.
   </li>
<li>Michael Xia 2013-09-25

   Local testing looks good. Merged the PR.
   </li>
<li>Priya Agarwal 2013-12-13

   Tested Environment:
   
   Appcelerator Studio: 3.2.0.201312121648
   SDK:3.2.0.v20131212122847
   alloy: 1.3.0-cr
   acs: 1.0.10
   npm: 1.3.2
   titanium: 3.2.0-cr3
   titanium-code-processor: 1.1.0-cr2
   Xcode:5.0.2
   OS: Mac OSX 10.9
   Device: iphone simulator(v7.0.3)
   
   Could see Alloy.Globals declared values in app.js while liveview enabled.
   Hence verified and closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15009.json">JSON Source</a></p>