---
title: "[TIMOB-15247] iOS: Ti.Blob.imageAsResized always returns a png image"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-04-16T18:21:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>blob, image, jpeg, parity, png</td></tr>
<tr><th>Reporter</th><td>Cedric Paternotte</td></tr>
<tr><th>Assignee</th><td>Vishal Duggal</td></tr>
<tr><th>Created</th><td>2013-07-05T16:05:43.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-31T22:22:06.000+0000</td></tr>
</table>

<h3>Description</h3>



<h3>Comments</h3>

<ol>
<li>Daniel Sefton 2013-07-12

   A simple test case would be nice :)</li>
<li>Cedric Paternotte 2013-07-12

   </li>
<li>Cedric Paternotte 2013-07-12

   Here is a workaround that works for me on iOS : use Ti.ImageFactory.compress to force jpeg format.
   This workaround requires the [ImageFactory](<a href="https://marketplace.appcelerator.com/apps/4973)" rel="nofollow" target="_blank">https://marketplace.appcelerator.com/apps/4973)</a> module ([github](<a href="https://github.com/appcelerator/titanium_modules/tree/master/imagefactory))." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_modules/tree/master/imagefactory)).</a>
   
   <code><pre>
   // read source image
   var sourceImage = Titanium.Filesystem.getFile(Titanium.Filesystem.resourcesDirectory, 'source.jpg').read();
   
   // resize it using core Ti.Blob.imageAsResized()
   var resizedImage = sourceImage.imageAsResized(160,120);
   
   // do this step if ios only 
   if (OS_IOS)
   {
     // choose desired compression level (from 0.0 to 1.0) 
     var compression_level = 0.75; 
   
     // load ImageFactory module
     var ImageFactory = require('ti.imagefactory');
     
     // convert image to jpeg
     resizedImage = ImageFactory.compress( resizedImage, compression_level );    
   }
   
   // create destination file
   var destFile = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, 'destination.jpg');
   
   // write resized image to destination file
   destFile.write(resizedImage);
   </pre></code></li>
<li>Mauro Parra-Miranda 2013-09-09

   This issue requires a Test Case. </li>
<li>Cedric Paternotte 2013-09-10

   Test case:
   
   <code><pre>
   var image = Titanium.Filesystem.getFile(Titanium.Filesystem.resourcesDirectory, 'srcImage.jpg').read();
   Ti.API.info("original image size:" + image.size);
   Ti.API.info("original image dimensions: " + image.width + 'x' + image.height);
   var newBlob1 = image.imageAsResized(160,120);
   Ti.API.info("test 1 image size:" + newBlob1.size);
   Ti.API.info("test 1 image dimensions: " + newBlob1.width + 'x' + newBlob1.height);
   
   var bgImage = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, 'test.jpg');
   
   bgImage.write(newBlob1);
   //
   // =&gt; Even though the output filename contains .jpg, it's a png file that is created (but named 'test.jpg')
   //
   // There's two ways to verify that it's a png file that has been created:
   // 1) the file is large (much larger than if it had been saved as jpeg)
   // 2) viewing the file with an "advanced" image viewer (like, for instance, IrfanView on Windows), one can check that the filetype is actually png rather than jpg
   //
   </pre></code></li>
<li>Giorgos Papadopoulos 2014-04-13

   Hi,
   
   I solved this issue.
   
   The problem lies in the UIImage+Resize.m
   
   When the image is resized in the 
   
   + (UIImage *)resizedImage:(CGSize)newSize
                   transform:(CGAffineTransform)transform
              drawTransposed:(BOOL)transpose
        interpolationQuality:(CGInterpolationQuality)quality 
   					image:(UIImage*)image 
   					hires:(BOOL)hires
   
   it is always assumed that the image has an alpha channel by passing kCGImageAlphaPremultipliedLast when the bitmap context is created. The passed image has first to be checked if it has an alpha channel or not and then create the bitmap context accordingly.
   
   Long story short: replace kCGImageAlphaPremultipliedLast with [UIImageAlpha hasAlpha:image] ? kCGImageAlphaPremultipliedLast : kCGImageAlphaNoneSkipFirst at line 49 of this file.
   
   Tested and works on Ti 3.2.2.GA, iOS 7.1, simualtor iPhone 3.5''</li>
<li>Paul Hamilton 2014-08-04

   Android seems to be returning a bitmap. "image/bitmap" mimetype. Can anything be done about this?</li>
<li>Ingo Muschenetz 2015-04-06

   Thank you all. Is anyone able to file a PR based on these findings? If so, we'd be happy to merge it in.</li>
<li>Joseph Sachs 2015-04-13

   I'm going to try out [~giorgos29cm]'s suggestion & will update my results.</li>
<li>Joseph Sachs 2015-04-15

    For me [~lulu]'s use of *ImageFactory* has been the best option. I did not see a difference on iOS with [~giorgos29cm] modification. Someone can double check.
    
    Result on *Android* - image.imageAsResized...):
    1- image Original size: undefined
       image Original dimensions: 3264x2448
    2- image size Resize :undefined
       image dimensions After Resize: 853x640
    3- image JPG image size: 58551 (very decent for a Camera Snapshot on a Samsung S3)
    
    On *iOS* (different Image with ImageFactory.compress(image.imageAsResized...), 0.75):
    1- image Original size: 1500000 
      image Original dimensions: 1500x1000
    2- image size Resize: 614400
       image dimensions After Resize: 640x960
    3- image JPG image size: 233242 </li>
<li>Tim Poulsen 2015-04-15

    Cedric's workaround has worked for me. I don't have the stats handy, but pre-workaround, resized images were around 2MB and I confirmed were PNG data in a blob otherwise identified as a JPG. Post-workaround, sizes are around 150KB w/JPG data in the blob. I have not tried Giorgos' modification.</li>
<li>Vishal Duggal 2015-04-15

    Pull pending
    master - <a href="https://github.com/appcelerator/titanium_mobile/pull/6783" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6783</a></li>
<li>Michael Gangolf 2015-06-29

    the PR above was merged 16 Apr, but with 4.0.0.GA I still have a png on iOS when just using imageAsResized</li>
<li>Lee Morris 2017-03-31

    Closing ticket as fixed, if there are any problems, please file a new ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15247.json">JSON Source</a></p>