---
title: "[TIMOB-15253] Android: singleTask launchMode with HeavyWeight window hangs after 1st launch"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-03-29T18:46:12.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.3</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, heavyweight, launchmode, merge-6.0.3, singletask</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2013-08-26T08:57:50.000+0000</td></tr>
<tr><th>Updated</th><td>2019-01-11T03:37:20.000+0000</td></tr>
</table>

<h3>Description</h3>

When launching your app with it's main activity set to <code>android:launchMode="singleTask"</code> and it's main window a HeavyWeight one, it will hang on the second and every following launch.

This bug blocks me from allowing users to open my app by using an URL scheme on a webpage or in a email message, send to them when they lost their password, received an invite to play a game etc.

<h4>Why use launchMode?</h4>

By default, when launching your app via another app, e.g. using an URL scheme in the browser, your apps main activity will be stacked onto the current app's task. If your app was already running in the background, you will have 2 instances of the app running.

Android has a  [launchMode](<a href="http://developer.android.com/guide/topics/manifest/activity-element.html#lmode)" rel="nofollow" target="_blank">http://developer.android.com/guide/topics/manifest/activity-element.html#lmode)</a> attribute that allows you to instruct the OS to always open the activity as the root of a new task, using <code>singleTask</code> as value.

This works fine, but not when the app's main window is HeavyWeight, for example a <code>Ti.UI.TabGroup</code> or a <code>Ti.UI.Window</code> with <code>modal:false</code>.

<h4>To reproduce</h4>

<h4>Create a new project: <code>titanium create -p android -n test</code></h4>
<h4>Build (only) to generate manifest: <code>titanium build -b -p android</code></h4>
<h4>Open the generated <code>build/android/AndroidManifest.xml</code> and copy the first <code><activity></code> tree to the <code>tiapp.xml</code> under <code>ti:app/android/manifest/application</code>. You will need to create the empty <code><manifest></code> and <code><application></code> elements yourself.</h4>
<h4>Add <code>android:launchMode="singleTask"</code> to the <code><activity></code> element and save <code>tiapp.xml</code>.</h4>
<h4>Build the app to the device: <code>titanium build -p android -T device</code></h4>
<h4>Open the updated <code>AndroidManifest.xml</code> to confirm the only effective change is the newly added attribute.</h4>
<h4>Seeing the app properly launched on the device, move it to the background by clicking the device's home button.</h4>
<h4>Lookup the app on the device and launch it again. You'll see a black screen with a titlebar (<code>test</code>) only.</h4>
<h4>Now replace the app's <code>app.js</code> with a lightweight window instead of the default heavyweight tabgroup:</h4>
    <code><pre>
    Ti.UI.createWindow({backgroundColor:'white'}).open();
    </pre></code>
<h4>Repeat steps 5-8 and this time, the app will properly launch.</h4>

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2013-08-26

   For a use case see my blog at: <a href="http://fokkezb.nl/2013/08/26/url-schemes-for-ios-and-android-1/" rel="nofollow" target="_blank">http://fokkezb.nl/2013/08/26/url-schemes-for-ios-and-android-1/</a></li>
<li>Fokke Zandbergen 2013-08-28

   Update: Even if the main application window is light, opening any heavy window will cause the app to hang on a black screen the next time you launch it from the app list.
   
   Please make this an urgent issue for 3.2 guys!</li>
<li>Fokke Zandbergen 2013-08-28

   Update: I think this is somehow related to the <code>ti.android.bug2373.finishfalseroot</code> (TIMOB-9285).
   
   I was working on a workaround that was binding the URL scheme to launch the app (which is the main use-case I need <code>singleTask</code> for) to a new activity/JS file like this:
   
   <code><pre>	<android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>">
   		<activities>
   			<activity url="incoming.js">
                   <intent-filter>
                       <action android:name="android.intent.action.VIEW"/>
                       <category android:name="android.intent.category.DEFAULT"/>
                       <category android:name="android.intent.category.BROWSABLE"/>
                       <data android:scheme="incoming"/>
                   </intent-filter>
   			</activity>
   		</activities>
   	</android>
   </pre></code>
   
   In the <code>incoming.js</code> I tried to launch the actual app by doing:
   
   <code><pre>
   var intent = Ti.Android.createIntent({
       action: Ti.Android.ACTION_MAIN,
       category: Ti.Android.CATEGORY_LAUNCHER,
       className: 'nl.fokkezb.test.scheme.TestActivity',
       packageName: 'nl.fokkezb.test.scheme'
   });
    
   Ti.Android.currentActivity.startActivity(intent);
   </pre></code>
   
   This actually worked, but showed the <code>An application restart is required</code> message. So I added the <code>ti.android.bug2373.finishfalseroot</code> property to my <code>tiapp.xml</code>. And guess what? I got the exact same behavior described in the test case of this ticket: a black screen of death.
   
   Hope this is of some help?</li>
<li>Fokke Zandbergen 2013-08-28

   [~ingo], any change we can have this fixed in 3.1.3?</li>
<li>Motiur Rahman 2013-09-16

   Hi,
   Could you please provide test case.
   Thanks,</li>
<li>Fokke Zandbergen 2013-09-16

   The description already includes the steps to reproduce, under *Why use lauchMode* I explain why this should be fixed and at <a href="http://fokkezb.nl/2013/08/26/url-schemes-for-ios-and-android-1/" rel="nofollow" target="_blank">http://fokkezb.nl/2013/08/26/url-schemes-for-ios-and-android-1/</a> I have a use case.
   
   What is it what you need more?</li>
<li>Fokke Zandbergen 2013-09-19

   Ugly workaround is to launch the app using the [intent-based URI](<a href="https://developers.google.com/chrome/mobile/docs/intents)" rel="nofollow" target="_blank">https://developers.google.com/chrome/mobile/docs/intents)</a> with the [FLAG_ACTIVITY_NEW_TASK](<a href="http://developer.android.com/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK)" rel="nofollow" target="_blank">http://developer.android.com/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK)</a> flag set:
   
   <code><pre>
   <a href="intent://#Intent;scheme=myscheme;package=my.package.name;launchFlags=268435456;end;">
   </pre></code></li>
<li>Romain 2013-10-12

   Same issue for us. Really annoying :(</li>
<li>Allen Yeung 2013-10-25

   Unfortunately, we can't support the singleTask mode with the current Titanium architecture.  When you background the app, and go back to it, the screen is black since the tab group activity gets destroyed.  The singletask mode seems to destroy all other activity in the task, besides the activity that is marked as single task.  This is a problem since we don't re-run the app.js code in this case (and we shouldn't since this is done as a part of the v8 runtime initialization).
   
   Fokke actually pointed out a workaround which I have tested and seems to work well.
   
   Inside the tiapp.xml of the 'singletask' app, you need to place the finishfalseroot flag.
   <code><pre>
   <property name="ti.android.bug2373.finishfalseroot" type="bool">true</property>
   </pre></code>
   
   In the other app that you want to launch the 'singletask' app, You need to do the following:
   
   <code><pre>
   var intent = Ti.Android.createIntent({
       action: Ti.Android.ACTION_MAIN,
       flags: Ti.Android.FLAG_ACTIVITY_NEW_TASK,
       category: Ti.Android.CATEGORY_LAUNCHER,
       className: "com.mytest.MytestActivity",
       packageName: "com.mytest"
   });
   Ti.Android.currentActivity.startActivity(intent);
   </pre></code>
    
   The key here is to use the FLAG_ACTIVITY_NEW_TASK flag when launching the app with the finishfalseroot set to true.
   
   We are actively working to make this a non-issue in the Ti.Next architecture.</li>
<li>Fokke Zandbergen 2013-10-27

    I hate seeing this postponed to TiNext, but I understand why it has too.
    
    To call the intent from an URL, you would have to attach a scheme to the activity and then use the <code>#Intent</code> anchor to add the same flag like this:
    
    <code><pre>intent://#Intent;package=com.myTest;scheme=myScheme;launchFlags=268435456;end;</pre></code>
    
    For more details check my blog: <a href="http://fokkezb.nl/2013/09/20/url-schemes-for-ios-and-android-2/" rel="nofollow" target="_blank">http://fokkezb.nl/2013/09/20/url-schemes-for-ios-and-android-2/</a></li>
<li>Brenton House 2015-06-08

    Is there a workaround for this that works in 4.0.x?  </li>
<li>josh rose 2015-07-23

    Would very much like to see this fixed!</li>
<li>Fokke Zandbergen 2015-09-25

    I think it would be good if we'd test and fix the underlying results developers want to achieve:
    
    * Be able to launch the app from an email/browser using a URL or other data scheme without creating a second instance off the app in the current activity stack if the app is already open in another.</li>
<li>Hieu Pham 2015-11-16

    Behavior is expected for "singleTask". So the Titanium flow is something like this:
    <code><pre>
    Root activity -> first window/tabgroup -> second window, so on
    </pre></code>
    When you assign the Root Activity as "singleTask" launch mode, your first launch would do:
    Root activity -> first window/tabgroup (it works as expected)
    However, when you hit the home button, all activities after the root will be destroyed, so when the app is relaunched, only the root activity is shown. This result in the black window, cause the splash screen is now gone.
    
    This used to work with Lightweight windows is because LW is actually a view on top of the Root Activity.
    
    
    </li>
<li>Hieu Pham 2015-11-19

    I did some research and I don't think "singleTask" is a viable solution to this problem. This is because all activities but the one assigned with "singleTask" are destroyed when the app is resume. Even if we can make it work, the app would have to restart every time you background/foreground, which is not what we want. We would need to investigate further for other solutions.</li>
<li>Fokke Zandbergen 2015-11-20

    It's a long a time ago but I think we started using singleTask because:
    
    {quote}
    By default, when launching your app via another app, e.g. using an URL scheme in the browser, your apps main activity will be stacked onto the current app's task. If your app was already running in the background, you will have 2 instances of the app running.
    {quote}
    
    So in the end the ticket is not about <code>singleTask</code> but about the question:
    
    _How to to open a Titanium via a custom URL *AND* prevent multiple instances *AND* without requiring launch flags with the URL_</li>
<li>Ganna Kozynenko 2016-01-20

    I am currently struggling with the same (branch.io request that I have my launcher as single task), and I added an OnResume function onto the main (launcher) activity, in which I re-read my index.... so far so good, that seems to work. 
    Anyone sees any problem with this approach?
    
    This comes very early in my alloy.js :
    
    <code><pre>
    if (OS_ANDROID)
    {
    	function resumeLauncher() {Alloy.createController('index',{});}
    	if (Ti.Android.currentActivity) {Ti.Android.currentActivity.setOnResume(resumeLauncher)}
    }
    </pre></code></li>
<li>Fokke Zandbergen 2016-01-22

    [~annakozy@direcciona.me] thanks for sharing that workaround!
    
    [~cng] if this works then it seems like when the app resumes in singleTask launchMode the existing activities (windows) are killed and [~annakozy@direcciona.me]'s code handles this by re-opening the index controller. Do you see any downsides? If not, then this might be documented as the official way to implement singleTask launchMode and we can support URL schemes on Android, jay!</li>
<li>Ganna Kozynenko 2016-01-22

    Yes, there is a problem, not so much with the workaround as with single task itself.  
    It indeed destroys all the activities above the one marked as single task, so maintaining the application state (other open windows) becomes a problem, including background audio. 
    
    Update: I did more testing. No, it does not actually destroy anything when put into background, even audio keeps playing, it's FOREGROUNDING that creates problems. If you foreground it from the list of activities (on my phone it appears by pressing and holding home button), nothing happens. However if you restart the activity from the icon again, then the child activities are destroyed/restarted</li>
<li>Fokke Zandbergen 2016-03-01

    I created TIMOB-20490 to talk about this from the user POV.</li>
<li>Ganna Kozynenko 2016-03-01

    I have read more about it, and to me it looks like a generic Android problem, not even really Appc-specific.... applies to any app where some activities are single task and others are not. 
    
    I am using my workaround which is kinda working, but I am not really sure where to move from there. 
    </li>
<li>Abdiel Aviles 2016-06-28

    I tried the workaround mentioned by [~annakozy@direcciona.me] and it works... but it makes my app unstable and crashes sporadically when resumed.
    
    Without the workaround, resuming the app from a URL scheme freezes on the Splash screen.
    
    I followed [~fokkezb] article on implementing URL schemes. Any further suggestions?</li>
<li>Ryan Gartin 2016-08-26

    I believe this bug is preventing full integration with Branch.io.</li>
<li>Ashraf Abu 2016-08-29

    What exactly is needed for Branch.io?</li>
<li>Ryan Gartin 2016-09-07

    </li>
<li>Ganna Kozynenko 2016-09-07

    In the first place, if you dont use singleTask, and you already have your application open, you will have two or more instances of your application open when you launch it from Branch link.
    
    As a user, you can see all those instances if you click that button to show the list of running apps on Android
    
    It is confusing for the user and I also dont know if it might be confusing for Branch statistics in some way</li>
<li>Ganna Kozynenko 2016-09-07

    Just for the record.
    
    I still keep re-reading index controller. 
    I did have to do some usual magic to make sure index.js knows it is being reopened (I send it a parameter in arguments like for any other controller), so that it does not add some listeners for the second time.
    
    It's been rather stable except for some not frequent cases when it STILL gets stuck at launcher. 
    But this looks like the app fails to register onResume function with the launcher activity (Ti.Android.currentActivity must be something else at the beginning of alloy.js in this case - it often happens when I launch the app from Ti.Studio, but it works ok in normal workflow). 
    
    Separating launcher in a separate variable could help with this (so I can always add onResume for launcher)
    
    But other than that and the typical bugs of duplicated Ti.App.addEventListener, I am fine</li>
<li>Ganna Kozynenko 2016-09-07

    Its been since mid-january that we've been rather integrated with Branch and using single task
    
    Its not perfect (in testing environment, I can recreate some less-than-perfect behaviors), but this does not seem to cause many user complaints</li>
<li>Ganna Kozynenko 2016-09-07

    Point is, I do not experience "sporadic crashes" documented earlier by someone when I am re-reading index controller, or any instability that cant be solved by usual measures of sorting things into "must only do on cold start" and "can do always" (the difference between those cases is easy to spot by passing a parameter into index, when you reopen it)</li>
<li>Ganna Kozynenko 2016-09-07

    As a matter of fact, if we teach appcelerator developers to treat index.js like any other window.... most of the problem with singleTask will go away.
    
    The problem is perhaps due to the programming style when people assume that index.js is only being read once and put a lot of unsafe stuff there (having listeners added and not removed, ignoring the usual cleanup etc.). 
    
    Everything that cant be safely repeated should probably be ideally in alloy.js</li>
<li>Gary Mathews 2017-01-12

    master: <a href="https://github.com/appcelerator/titanium_mobile/pull/8747" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8747</a></li>
<li>Lokesh Choudhary 2017-03-02

    Did a check with the PR & found an issue. Commented about it in the PR.
    Will continue to test after the issue has been looked at.</li>
<li>Creative 2017-03-02

    bump, i would appreciate this to be fixed soon since its an ongoing issue since 2013. I am too running into issues because I'm implementing push notifications and url schemes</li>
<li>Lokesh Choudhary 2017-03-10

    PR merged.
    Waiting for build to close the ticket.</li>
<li>Brian Knorr 2017-03-10

    If this fix is going in 6.0.3, when will 6.0.3 be released?  We just ran into this issue for one of AppC's big clients - we are the dev shop.  Should I open an enterprise support ticket or is this going out really soon?</li>
<li>Gary Mathews 2017-03-10

    6_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/8879" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8879</a></li>
<li>Hans Knöchel 2017-03-10

    </li>
<li>Lokesh Choudhary 2017-03-10

    Verified the fix with SDK 6.1.0.v20170309181051. 
    Waiting for 6.0.3 built to close the issue.</li>
<li>Lokesh Choudhary 2017-03-10

    Verified the fix with SDK 6.0.3.v20170310122139.
    Closing the ticket.</li>
<li>Michael Kazmier 2017-03-22

    Hi everyone,
    
    I recognize that this ticket is closed, but I am testing the functionality on 6.0.3.v20170322115949 and I still do not think this is working correctly.  Let me provide a quick example.  My app's main activity looks like this (from tiapp.xml):
    
    <activity android:name=".KudosoActivity" android:alwaysRetainTaskState="true" android:label="@string/app_name" android:theme="@style/Theme.Titanium" android:configChanges="keyboardHidden|orientation|screenSize" android:exported="true" android:alwaysRetainTaskState="true" android:launchmode="singleTask">
    
    com.kudoso.mobile.KudosoActivity
    
    Now, we have a service that runs that fires off a new intent with Extras when certain system events happen.  Using SDK 6.x and either singleTop or singleTask mode, we correctly launch our app now (that is win!) BUT we are still losing the intent information.  In our app, we log the new intent, and it is missing the extras, see here:
    
    [DEBUG] -----------------------------------  EVENT newintent -----------------------------------
    [DEBUG] NEW INTENT {"type":null,"packageName":"com.kudoso.mobile","className":"org.appcelerator.titanium.TiActivity","action":null,"flags":0,"data":null,"apiName":"Ti.Android.Intent","bubbleParent":true} WITH EXTRA: null
    
    What is important to note is the class name of the intent!  Our service fires off the intent as com.kudoso.mobile/com.kudoso.mobile.KudosoActivity but the app receives com.kudoso.mobile/org.appcelerator.titanium.TiActivity.
    
    Why???  I cannot seem to track this down in the SDK.</li>
<li>Caio Iglesias 2017-03-27

    I still see it hanging as soon as the android:launchMode="singleTask" flag is added, running on 6.0.3.GA.
    It works on the first launch only. If the app was already running and you try opening a link, it hangs.
    </li>
<li>Brian Knorr 2017-03-28

    We are seeing the same issue with it only working on first launch using 6.0.3.GA.  Please re-open this ticket.</li>
<li>Brian Knorr 2017-03-28

    Also I don't know if this makes a difference, but we are using Hyperloop as well.</li>
<li>Eric Merriman  2017-03-28

    Reopening to investigate field reports. </li>
<li>Gary Mathews 2017-03-29

    Updated documentation and intent filter guide as part of <a href="https://github.com/appcelerator/titanium_mobile/pull/8897" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8897</a></li>
<li>David Jones 2017-03-29

    I saw the documentation update in the most recent PR stating:
    
    "Defining launch modes using <code>android:launchMode</code> is not supported by Titanium Android.
    However, <code>singleTask</code> behaviour can be accomplished when using  [intent filters](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/Android_Intent_Filters)."
    
    If we are responding to a custom scheme link initiated from the user's browser - how can we specify a true 'singleTask' launch of our application? I did not find any corresponding information for this in the linked-to documentation on intent-filter.
    
    It works for us if our app is closed, but when our app is already open we get stuck at the splash screen.
    
    Note we have set this property as well, with no change in result:
    
    {noformat}
    <property name="intent-filter-new-task" type="bool">true</property>
    {noformat}
    </li>
<li>Abdiel Aviles 2017-03-29

    We have exactly the same situation as @jonesdhtx
    
    We currently have our schemes disabled for our Android users and enabled for our iOS users... not good at all.</li>
<li>Brian Knorr 2017-03-29

    I just saw that this issue was marked as resolved....what is the resolution for handling url schemes in Android?  Are you opening another ticket for this?  Do we need to open a new ticket?</li>
<li>Gary Mathews 2017-03-29

    [~jonesdhtx] What Titanium SDK version are you using? Could you provide example code to reproduce the issue?</li>
<li>David Jones 2017-03-29

    Using 6.0.3.GA
    
    Here is some example code for showing the app is not getting launched as a new task for 2nd/subsequent invocations.
    
    Referring to the code below:
    1) In initial state, app not running - In the phone browser click on the link in the test html page 
    2) App logs our custom message: "Launched as New Task" and opens successfully.
    3) Now leaving app open, return to the test html page, and click on the same link again
    4) App logs our custom message: "Launched as Resumed/Recycled Task" and the app ux shows only the splash screen
    
    Tiapp.xml is setup as:
    
    {noformat}
    <ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>">
        ...
        <property name="run-on-main-thread" type="bool">true</property>
        <property name="intent-filter-new-task" type="bool">true</property>
        ...
        <android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>">
            <manifest android:versionCode="16">
                <application android:hardwareAccelerated="true"
                    android:largeHeap="true" android:theme="@style/Theme.Titanium">
                    <activity android:name=".TestAppActivity" android:label="@string/app_name" android:theme="@style/Theme.Titanium" android:configChanges="keyboardHidden|orientation|screenSize" android:launchMode="singleTask">
                        <intent-filter>
                            <action android:name="android.intent.action.MAIN"/>
                            <category android:name="android.intent.category.LAUNCHER"/>
                        </intent-filter>
                        <intent-filter>
                            <action android:name="android.intent.action.VIEW"/>
                            <category android:name="android.intent.category.DEFAULT"/>
                            <category android:name="android.intent.category.BROWSABLE"/>
                            <data android:scheme="testapp" />
                        </intent-filter>
                    </activity>
                    <activity
                        android:configChanges="keyboardHidden|orientation"
                        android:hardwareAccelerated="true" android:name="io.card.payment.CardIOActivity"/>
                    <activity android:name="io.card.payment.DataEntryActivity"/>
                </application>
                <uses-permission android:name="android.permission.CAMERA"/>
                <uses-permission android:name="android.permission.VIBRATE"/>
                <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
                <uses-feature android:name="android.hardware.location.gps"/>
                <uses-feature android:name="android.hardware.camera" android:required="false"/>
                <uses-feature
                    android:name="android.hardware.camera.autofocus" android:required="false"/>
                <uses-feature android:name="android.hardware.camera.flash" android:required="false"/>
            </manifest>
        </android>
        ...
        <sdk-version>6.0.3.GA</sdk-version>
        <plugins>
            ...
            <plugin version="1.0">ti.alloy</plugin>
            <plugin>hyperloop</plugin>
            ...
        </plugins>
        ...
    </ti:app>
    
    {noformat}
    
    
    Code from our top-level alloy controller: app/controllers/index.js to let us know if app is being started as new task or not:
    {noformat}
    if(Alloy.Globals.hasBeenPreviouslyLaunched) {
        console.log('Launched as Resumed/Recycled Task')
    }
    else {
        console.log('Launched as New Task')
        Alloy.Globals.hasBeenPreviouslyLaunched = true;
    }
    {noformat}
    
    The html test page used to launch the app:
    
    {noformat}
    <a href="testapp://just-testing">Launch App</a>
    {noformat}
    </li>
<li>Abdiel Aviles 2017-03-29

    resolved?
    
    kudos to [~jonesdhtx]</li>
<li>Brian Knorr 2017-03-31

    Can we get this ticket re-opened now that we have the test case from David?  Our client has an enterprise support ticket that is tracking this jira issue, but if you decide to not reopen we will need to reference a new ticket.</li>
<li>Creative 2017-04-04

    request re-open. I cant seem to retrieve intent data now when resuming my app from background</li>
<li>Hans Knöchel 2017-04-04

    Please try <a href="https://github.com/appcelerator/titanium_mobile/pull/8897" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8897</a> (TIMOB-24316) for SDK Release 6.0.4.</li>
<li>Creative 2017-04-04

    i guess this has to be built from source? Anyone able to provide a .zip?</li>
<li>David Jones 2017-04-04

    Looks like @Gary Mathews has put together a newer PR for 6.0.4 that includes #8897 as well as a couple other related PR's:
    
    PR# 8910 (<a href="https://github.com/appcelerator/titanium_mobile/pull/8910)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8910)</a> which includes cherry-pick of #8894 #8897 #8908 addressing TIMOB-24497, TIMOB-24316, TIMOB-24527
    
    How can we get an sdk build w/ these changes incorporated (prior to 6.0.4 release) to verify these fixes addressed our problem?</li>
<li>Lokesh Choudhary 2017-04-04

    Everyone, please check this build below which is built for PR <a href="https://github.com/appcelerator/titanium_mobile/pull/8910" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8910</a> & let us know if this resolves your issue.
    
    Link: <a href="https://www.dropbox.com/s/lbc9tvzl8z7e34w/6.0.4.zip?dl=1" rel="nofollow" target="_blank">https://www.dropbox.com/s/lbc9tvzl8z7e34w/6.0.4.zip?dl=1</a>
    
    *NOTE* : Do not use this for any of your production apps as this build is not GA & might have bugs/issues.</li>
<li>David Jones 2017-04-05

    The #8910 PR build (<a href="https://www.dropbox.com/s/lbc9tvzl8z7e34w/6.0.4.zip?dl=1)" rel="nofollow" target="_blank">https://www.dropbox.com/s/lbc9tvzl8z7e34w/6.0.4.zip?dl=1)</a> is an improvement but the issue is not fully resolved.
    
    <h4>Before #8910 PR, I was getting this:</h4>
    1) From initial state with app not running - In the phone browser click on a link in a test html page 
          eg:  <a href="testapp://order/11112222">Launch App</a>
    2) Our app opens successfully and handles the link accordingly
    3) Now leaving app open, return to the test html page, and click on the same link again
    4) Our app ux hangs and shows only the splash screen <BROKE>
    
    <h4>Now with #8910 applied, I am getting this:</h4>
    1) From initial state with app not running - In the phone browser click on a link in a test html page 
          eg:  <a href="testapp://order/11112222">Launch App</a>
    2) Our app opens successfully and handles the link accordingly
    3) Now leaving app open, return to the test html page, and click on the same link again
    4) Our app now opens successfully and handles the link accordingly <WORKS NOW!>
    5) Repeat steps 3 and 4 any number of times and note it continues to work as expected
    6) Now still leaving app open - return to the test html page and click on a *different* link this time:
          eg:  <a href="testapp://order/33334444">Launch App</a>
    7) Our app ux now hangs and shows only the splash screen <BROKE>
    
    <h4>ALSO: I noticed that it will fail in the same way if the app is open before the initial link click:</h4>
    1) From initial state with app not running - start the app from the app launcher
    2) With the app launched and running normally, leave it open and then in the phone browser click on a link in a test html page 
          eg:  <a href="testapp://order/11112222">Launch App</a>
    3) Our app ux now hangs and shows only the splash screen <BROKE>
    </li>
<li>Hans Knöchel 2017-04-05

    Thanks for the feedback David, we are looking into it. But please use the <code>Preview</code> button on the left to check your comment before submitting. All watchers (62+) just received 11 mails regarding your edited comment. We are trying to keep the flow as clean as possible, thx.</li>
<li>Creative 2017-04-05

    I'm having issues with the test build of 6.0.4.GA too. I've created a post at <a href="https://github.com/appcelerator/titanium_mobile/pull/8910" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8910</a> (i dont know if this is the preferred location to post that)</li>
<li>Brian Knorr 2017-04-05

    Can we get this ticket re-opened so the axway support team doesn't update our enterprise support tickets as resolved?</li>
<li>Gary Mathews 2017-04-06

    [~jonesdhtx] I can't reproduce your problem, try this build: [6.0.4_20170406_ddc37c0.zip](<a href="https://www.dropbox.com/s/404tr0d1kv54o9w/6.0.4_20170406_ddc37c0.zip?dl=1)" rel="nofollow" target="_blank">https://www.dropbox.com/s/404tr0d1kv54o9w/6.0.4_20170406_ddc37c0.zip?dl=1)</a></li>
<li>David Jones 2017-04-07

    @Gary Mathews -  The 6.0.4_20170406_ddc37c0.zip build did not help the failing scenarios I encountered, and it also re-introduced the earlier problem I was having as well.  
    
    Since you are not able to reproduce the issue on your side - I will try to find some time to put together a full minimal project demonstrating the issues that I can zip up and attach to this ticket.</li>
<li>David Jones 2017-04-17

    @Gary Mathews - Here's a link to a sample project zip that demonstrates the problem: <a href="https://www.dropbox.com/s/5o4v1bayqlsr83t/SampleProject.zip?dl=0" rel="nofollow" target="_blank">https://www.dropbox.com/s/5o4v1bayqlsr83t/SampleProject.zip?dl=0</a>
    
    However, after playing around with it some more, I'm thinking the reason you weren't seeing the problem before might have to do with the use of back button vs home button (or task switcher).
    
    Here's a copy of the sample project readme w/ more details:
    
    <h4>SampleApp README</h4>
    
    This sample app demonstrates that under the scenario outlined below, the app is not getting launched as a new task on Android.
    
    Once the sample app is built and deployed to device, you can access the following web page to launch it:
    [<a href="https://obscure-beach-58781.herokuapp.com" rel="nofollow" target="_blank">https://obscure-beach-58781.herokuapp.com</a>]
    
    The above page simply contains the following 2 links for launching the app:
    
    <code><pre>
      <a href="sampleapp://order/11112222">Manage Order 11112222</a>
      <a href="sampleapp://order/33334444">Manage Order 33334444</a>
    </pre></code>
    
    One more note: As mentioned by another poster, there is another issue that is occuring when the app is closed and opened for first time.  When doing so we see a &quot;double&quot; launch effect where splash screen and initial screen seems to get displayed twice quickly upon launch.
    
    <h4>Failure Mode</h4>
    
    If you use the &quot;Task Switcher&quot; to switch between apps you see that the app is not started as a new task.
    Alternatively, if you press the home button to leave the app and reopen the browser from launch screen it will fail in the same way.
    
    * App closed
    * In browser, launch sample app w/ link to order 11112222:
       1: *_ App started as New Task _*
       2: Handling: sampleapp://order/11112222
    * Use the &quot;Task Switcher&quot; to go back to browser
    * Launch w/ link to order 11112222 again:
       1: *_ App started as Resumed/Recycled Task _*
       2: Handling: sampleapp://order/11112222
    * Use the &quot;Task Switcher&quot; to go back to browser
    * Launch w/ link to order 33334444:
       1: *_ App started as Resumed/Recycled Task _*
       2: Handling: sampleapp://order/33334444
    
    <h4>Success Mode</h4>
    
    However if you use the back button to switch between apps it is behaving as expected:
    
    * App closed
    * In browser, launch sample app w/ link to order 11112222:
       1: *_ App started as New Task _*
       2: Handling: sampleapp://order/11112222
    * Use the &quot;Back Button&quot; to go back to to browser
    * Launch w/ link to order 11112222 again:
       1: *_ App started as New Task _*
       2: Handling: sampleapp://order/11112222
    * Use the &quot;Back Button&quot; to go back to to browser
    * Launch w/ link to order 33334444:
       1: *_ App started as New Task _*
       2: Handling: sampleapp://order/33334444
    
    <h4>Notes:</h4>
    
    The key may be in the differences in back vs home button handling on android. There are multiple sources of info on this, here&#39;s a quick description grabbed from [<a href="http://stackoverflow.com/questions/34081835/difference-between-back-press-and-home-button-in-android" rel="nofollow" target="_blank">http://stackoverflow.com/questions/34081835/difference-between-back-press-and-home-button-in-android</a>]
    
    {quote}After you start an activity, if HOME key is pressed, then the current activity is stopped and its task goes into the background. The system retains the state of the activity - i.e. onSaveInstanceState will be called. If the user later resumes the task by selecting the launcher icon that began the task again, the task comes to the foreground and resumes the activity at the top of the stack.
    
    However, if BACK key is pressed, the current activity is popped from the stack and destroyed. The assmuption is the activity is done and will not be used again. So the system does not retain the activity&#39;s state - i.e. onSaveInstanceState will not be called.
    
    {quote}</li>
<li>Gary Mathews 2017-04-19

    [~djonesax] That is expected and usually preferred behaviour, [FLAG_ACTIVITY_NEW_TASK](<a href="https://developer.android.com/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK)" rel="nofollow" target="_blank">https://developer.android.com/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK)</a> states "_When using this flag, if a task is already running for the activity you are now starting, then a new activity will not be started; instead, the current task will simply be brought to the front of the screen with the state it was last in._".</li>
<li>David Jones 2017-04-19

    However - the current task is not simply being brought to front of the screen.  We are seeing that the our app is being "pseudo-restarted" when we get the second invocation. In other words: we see that our Alloy.Globals object is still intact via an explicit property we set when first launched , but yet a new instance of our application controller/view is being created and shown.
    
    </li>
<li>David Jones 2017-04-24

    Were you able to recreate the issue? Are you planning to address the issue on this ticket or should we create a new one?</li>
<li>Andrea Vitale 2017-07-06

    This is definitively not resolved for me.
    I'm on 6.1.1.GA and I added <code><property name="intent-filter-new-task" type="bool">true</property></code> inside my tiapp.xml:
    - launch the app
    - push it to the background using the home button
    - click on a link that can be handled by the app
    - the app tries to reopen itself but it crashes with the stacktrace reported below
    
    
    <code><pre>
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: FATAL EXCEPTION: main
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: Process: com.myapp, PID: 7451
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: java.lang.RuntimeException: Unable to start activity ComponentInfo{com.myapp/com.myapp}: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.Object org.appcelerator.kroll.KrollDict.get(java.lang.Object)' on a null object reference
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2416)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2476)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.ActivityThread.-wrap11(ActivityThread.java)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1344)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.os.Handler.dispatchMessage(Handler.java:102)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.os.Looper.loop(Looper.java:148)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.ActivityThread.main(ActivityThread.java:5417)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at java.lang.reflect.Method.invoke(Native Method)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:726)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:616)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: Caused by: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.Object org.appcelerator.kroll.KrollDict.get(java.lang.Object)' on a null object reference
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.kroll.KrollProxy.onPropertyChanged(KrollProxy.java:965)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.kroll.runtime.v8.V8Runtime.nativeRunModule(Native Method)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.kroll.runtime.v8.V8Runtime.doRunModule(V8Runtime.java:196)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.kroll.KrollRuntime.runModule(KrollRuntime.java:241)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.titanium.TiLaunchActivity.loadActivityScript(TiLaunchActivity.java:128)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.titanium.TiLaunchActivity.windowCreated(TiLaunchActivity.java:183)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.titanium.TiRootActivity.windowCreated(TiRootActivity.java:172)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.titanium.TiBaseActivity.onCreate(TiBaseActivity.java:676)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.titanium.TiLaunchActivity.onCreate(TiLaunchActivity.java:169)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at org.appcelerator.titanium.TiRootActivity.onCreate(TiRootActivity.java:161)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.Activity.performCreate(Activity.java:6237)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1107)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2369)
    07-06 19:46:35.953  7451  7451 E AndroidRuntime: 	... 9 more
    </pre></code>
    </li>
<li>Eric Merriman  2018-08-06

    Cleaning up older fixed issues. If this issue should not have been closed as fixed, please reopen.</li>
<li>Jake Dempsey 2018-12-19

    I am experiencing this same issue with 7.4.1GA.  If my app is not started and I launch it with a url scheme it launches.  If the app is already running and I launch it with a url scheme it freezes at the splash screen.  This issue seems to still be broken.</li>
<li>Joshua Quick 2019-01-11

    This "singleTask" behavior is not a bug and is by Google's design.
    
    When using launch mode "singleTask", the Android OS will automatically close all child activity windows when resuming your app. The splash screen is the root activity. So, the app is not hung. The child windows have been forcefully closed by the Android OS and Titanium does correctly fire their associated "close" events.
    
    As of Titanium 8.0.0, we're providing another option which doesn't involve "singleTask" (which I recommend that you don't use). In 8.0.0, we've completely refactored our intent handling so that an existing app instance will be resumed and the "newintent" event will be correctly fired when a new intent has been received. This way an Android app behaves a bit more like iOS, which is what everyone is after.
    
    Please see [TIMOB-26075] for more details.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15253.json">JSON Source</a></p>