---
title: "[TIMOB-15258] iOS: Facebook module throws "FBSession: should only be used from a single thread" error on reviving app with Facebook request URL"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-08-27T12:43:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Backlog</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>facebook, ios, mobilesdk</td></tr>
<tr><th>Reporter</th><td>Vladimir Tolstikov</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2013-09-10T10:13:33.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-27T17:53:09.000+0000</td></tr>
</table>

<h3>Description</h3>

Test case:
<h4>login into Facebook using your Titanium's app</h4>
<h4>kill it from Dock</h4>
<h4>try to open app with Facebook user-to-user request URL from your notifications section in Facebook or newsfeed story. It should be something like fb116843021780929://authorize?...</h4>
<h4>"FBSession: should only be used from a single thread" red screen appears</h4>

XCode console on a device says:
<code><pre>
Sep 10 12:40:08 iPhone Printpie[31305] &lt;Warning&gt;: *** Assertion failure in -[FBSession handleOpenURL:], /Volumes/Datums/CodeValhalla/Github/Mine/titanium_modules/facebook/mobile/ios/Classes/FBConnect/FBSession.m:426
Sep 10 12:40:08 iPhone Printpie[31305] &lt;Warning&gt;: [ERROR] Script Error FBSession: should only be used from a single thread
</pre></code>

Test application code is simple as a child's tear:
<code><pre>
var fb = require('facebook');
fb.appid = '116843021780929';

var win = Ti.UI.createWindow();

var loginButton = Ti.UI.createButton({
    title: 'Login'
});
loginButton.addEventListener('click', function(){fb.authorize();});
win.add(loginButton);

win.open();
</pre></code>

Don't forget to add into your Info.plist next string for Facebook URL chema support:
<code><pre>
	&lt;key&gt;CFBundleURLTypes&lt;/key&gt;
	&lt;array&gt;
		&lt;dict&gt;
			&lt;key&gt;CFBundleURLName&lt;/key&gt;
			&lt;string&gt;com.printpie.cleverbug&lt;/string&gt;
			&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;
			&lt;array&gt;
				&lt;string&gt;printpie&lt;/string&gt;
				&lt;string&gt;fb116843021780929&lt;/string&gt;
			&lt;/array&gt;
		&lt;/dict&gt;
	&lt;/array&gt;
</pre></code>

So:
<h4>run the app</h4>
<h4>click "Login" button</h4>
<h4>login into your Fb account</h4>
<h4>you will be bring back to the app</h4>
<h4>close simulator</h4>
<h4>open simulator stand-alone, without titanium</h4>
<h4>try next URL (it's similar as from Facebook native app or Safari's web-version of FB): </h4>
<code><pre>fb116843021780929://authorize?expires_in=3600&access_token=qkjKR42UQsewYckYagPhU2Avo4eLruAKH41Vd1u192UORNvhzGftEUi7sOK375opZCKzpK1ZCAyxkBH5je3BUG3E8Shp6mI8VmdXWU2dxrOe4oB7BoDPSAZDZD&target_url=http%3A%2F%2Fm.facebook.com%2Fapps%2Fcleverbug-printpie%3Ffb_source%3Dnotification%26request_ids%3D511072445602499%26ref%3Dnotif%26app_request_type%3Duser_to_user
</pre></code>
<h4>you will see "FBSession: should only be used from a single thread"</h4>

I saw many similar questions on Q&A section with no answers :(

P.S. sorry, no time to make a bundle with test application, but I hope I explained it above.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-15258_42342/screenshot_2013-09-10_14.10.26.png">screenshot_2013-09-10_14.10.26.png</td></td><td>2013-09-10T10:13:33.000+0000</td><td>40052</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Vladimir Tolstikov 2013-09-10

   Probably I know why it happens: old Ti.Facebook module still in SDK, and not requires initialization (with "require(..") right? Maybe that is a first thread which is capturing and handle openURL param.</li>
<li>Hans Kn√∂chel 2016-08-27

   This should not happen with Ti.Facebook 5.0.0 and later (e.g. 5.2.3 currently). Resolving for now, please leave your comments if you still see it.</li>
<li>Lee Morris 2017-03-27

   Closing ticket as fixed with reference to the above comments.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15258.json">JSON Source</a></p>