---
title: "[TIMOB-15307] CLI: support custom keystore when running on Android device"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-10-19T01:25:16.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 21, 2013 Sprint 21 Core, Release 3.2.0</td></tr>
<tr><th>Components</th><td>Android, CLI</td></tr>
<tr><th>Labels</th><td>androidbuild, ay-verified, cb-verified, module_CLI, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Ygor Lemos</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2013-09-22T04:51:59.000+0000</td></tr>
<tr><th>Updated</th><td>2013-11-20T18:42:21.000+0000</td></tr>
</table>

<h3>Description</h3>

From [~ygbr] in TISTUD-3669:

I think that the CLI also currently ignores a custom keystore when deploying directly to the device.

For instance, if I do something like:


<code><pre>
titanium build -p android -T device -L pinion -K /PATH-TO-MY/pinion.keystore -P *********
</pre></code>


theoretically the app should be signed with my keystore and them sent to the device for running.

BUT, taking a closer look at what the CLI is doing, you can see that the build script completely ignores the custom keystore parameters and signs the app with the default tidev keystore:


<code><pre>
[DEBUG] keytool -v -list -keystore "/Users/yg/Library/Application Support/Titanium/mobilesdk/osx/3.1.1.GA/android/dev_keystore" -storepass ******* -alias tidev
[DEBUG] jarsigner -sigalg MD5withRSA -digestalg SHA1 -storepass ******* -keystore "/Users/yg/Library/Application Support/Titanium/mobilesdk/osx/3.1.1.GA/android/dev_keystore" -signedjar /Users/yg/Developer/android/build/android/bin/app.apk /Users/yg/Developer/android/build/android/bin/app-unsigned.apk tidev
[DEBUG] /Applications/Android/sdk/tools/zipalign -v 4 /Users/yg/Developer/android/build/android/bin/app.apk /Users/yg/Developer/android/build/android/bin/app.apkz
</pre></code>


This is a GIANT pain, specially when you need to test stuff involving the new GMaps v2 and Facebook SSO authentication since they depend on the app being signed with your production keystore (although FB accepts many keys).

Is there a specific JIRA ticket for this? I know that this isn't exactly Studio but it is very related with this ticket and should also exist on the CLI since many developers like me use only the CLI...

<h3>Comments</h3>

<ol>
<li>Chris Barber 2013-10-05

   Pull request: <a href="https://github.com/appcelerator/titanium_mobile/pull/4760" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4760</a></li>
<li>Kyle Berezin 2013-10-05

   I just ran into this problem and I am on a pretty tight time crunch. I am not outputting to a device, but to a folder I made. The compilation goes without a hitch but the file never makes it to the folder, and on closer inspection is signed with a dev keystore rather than the one I specified.
   I would just manually sign "app-unsigned.apk" but the source files are not obfuscated. Is there any way to get around this issue?</li>
<li>Chris Barber 2013-10-05

   [~asor] You need to package your app for distribution. That will minify and encrypt the code as well as allow you to sign the app with whatever keystore you wish. If building from Studio, it's under the package icon menu. If building from the CLI, then use "ti build -p android -T dist-playstore".</li>
<li>Allen Yeung 2013-10-19

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/4781" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4781</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-15307.json">JSON Source</a></p>