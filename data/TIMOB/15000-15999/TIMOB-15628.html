---
title: "[TIMOB-15628] Android: i18n strings.xml lose the formatted=false attr after compiling"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-11-08T21:57:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 23, 2013 Sprint 23 Core, Release 3.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, androidbuild, module_android, qe-manualtest, qe-testadded, triage</td></tr>
<tr><th>Reporter</th><td>Dan Tamas</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2013-10-31T13:44:46.000+0000</td></tr>
<tr><th>Updated</th><td>2014-11-19T18:26:30.000+0000</td></tr>
</table>

<h3>Description</h3>

I need to use this version of the sdk as it fixes some big bugs, but the strings.xml don't seem to keep the attributes -  formatted="false" -  so the build will fail :(
<code><pre>
[ERROR] Failed to package application:
[ERROR]   
[ERROR] /Volumes/Work/clients/tobias_group_time/TEAMWIRE/gt/build/android/res/values/strings.xml:49: error: Multiple substitutions specified in non-positional format; did you mean to add the formatted="false" attribute?
[ERROR] /Volumes/Work/clients/tobias_group_time/TEAMWIRE/gt/build/android/res/values/strings.xml:49: error: Unexpected end tag string
[ERROR] /Volumes/Work/clients/tobias_group_time/TEAMWIRE/gt/build/android/res/values-de/strings.xml:19: error: Multiple substitutions specified in non-positional format; did you mean to add the formatted="false" attribute?
[ERROR] /Volumes/Work/clients/tobias_group_time/TEAMWIRE/gt/build/android/res/values-de/strings.xml:19: error: Unexpected end tag string
</pre></code>

<h3>Comments</h3>

<ol>
<li>Chris Barber 2013-10-31

   @Dan, do your strings contain a single quote? Can you send me a sample strings.xml file (preferably from the i18n folder)? Can you do this soon?</li>
<li>Dan Tamas 2013-11-01

   Another issue seems to be that the *values-de* folder is not being created.
   I cleaned the project and got this:
   <code><pre>
   [INFO]  Compiling localization files
   [DEBUG] Processing i18n file: de/strings.xml
   [DEBUG] Processing i18n file: en/strings.xml
   [DEBUG] Writing de strings =&gt; /Volumes/Work/clients/tobias_group_time/TEAMWIRE/gt/build/android/res/values-de/strings.xml
   
   fs.js:427
     return binding.open(pathModule._makeLong(path), stringToFlags(flags), mode);
                    ^
   Error: ENOENT, no such file or directory '/Volumes/Work/clients/tobias_group_time/TEAMWIRE/gt/build/android/res/values-de/strings.xml'
   
   </pre></code>
   
   </li>
<li>Dan Tamas 2013-11-01

   @Chris -  yes it does have a single quote.
   Please download the i18n folder from here (no idea how to attach it in Jira)
   
   <a href="https://www.dropbox.com/s/jh8t4al6xv6fhtb/i18n_dan_tamas.zip" rel="nofollow" target="_blank">https://www.dropbox.com/s/jh8t4al6xv6fhtb/i18n_dan_tamas.zip</a> 
   
   I cleaned all the ' in the files but it does the same.
   
   A hacky solution is to check in _build.js in generateI18N function if the string has some substitution parts and add formatted false to the node (inside the forEach loop)
   
   <code><pre>
       data[locale].strings[name].match(/%[s,d,i]/g) && node.setAttribute('formatted', 'false');
   </pre></code> 
   
   (I only test for s/d/i)
   
   </li>
<li>Stephen Feather 2013-11-01

   We experienced the ENOENT error when we tested 3.2.x two nights ago.
   Project still had the default en and ja language string files in place.
   Removed, project built just fine.  Just a reference point.</li>
<li>Dan Tamas 2013-11-01

   If I add after the first failed build the folder in place, and build without cleaning it will go through.</li>
<li>Dan Tamas 2013-11-01

   Medium ? :(</li>
<li>Dan Tamas 2013-11-01

   Thank you @Ingo :)</li>
<li>Chris Barber 2013-11-07

   [~rborn] I did some thinking and talked about it with the other guys and we have come to the conclusion to set formatted="false" on ALL strings in strings.xml. For strings that don't have a %, it should be fine. Then we don't have to do any funky regular expressions.
   
   We are not clear yet if this is going to cause other issues, specifically with older Android target SDKs, but I suppose we'll find out soon enough. :)</li>
<li>Chris Barber 2013-11-07

   Pull request: <a href="https://github.com/appcelerator/titanium_mobile/pull/4927" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4927</a></li>
<li>Dan Tamas 2013-11-08

    Not a bad idea, I guess :) 
    
    But what happens with the strings that have % ? In this case we would need to have '%%' to show the % char, and this might break the ios version - just throwing questions here, didn't test it.
    </li>
<li>Chris Barber 2013-11-08

    If a string has %, nothing happens. Nothing is formatted. You can have a bunch of % and it'll be fine. :)</li>
<li>Dan Tamas 2013-11-08

    Neh, ignore me, was thinking the wrong case (no formatting=false) but I have the perfect excuse: didn't drink my coffee yet :P</li>
<li>Samuel Dowse 2013-11-14

    Verified fixed on:
    Mac OSX 10.9 Mavericks
    Titanium Studio, build: 3.2.0.201311140700
    Titanium SDK, build: 3.2.0.v20131114120849
    CLI: 3.2.0
    Alloy: 1.3.0
    Android Emulator : 2.3.3, 4.4
    
    Localization file doesn't lose formatted=false attribute after compilation.
    i18n folder used from comments.
    Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15628.json">JSON Source</a></p>