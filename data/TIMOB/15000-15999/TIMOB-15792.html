---
title: "[TIMOB-15792] Android: uploading a large base64 encoded file with HTTPClient crashes due to memory error"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2014-07-31T21:03:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.4, Release 3.1.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Davide Cassenti</td></tr>
<tr><th>Assignee</th><td>Ping Wang</td></tr>
<tr><th>Created</th><td>2013-11-22T10:58:00.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-23T05:24:32.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
Trying to upload a big base64 string using an HTTPClient request fails due to memory error. The string has been generated using the code below, in order to avoid the memory error while encoding (see TIMOB-15594).

<h4>Code used to encode</h4>
<code><pre>
var stream = Ti.Filesystem.openStream(Ti.Filesystem.MODE_READ, SOME_FILE);
 
var buffer = Ti.createBuffer({
    length: 300 // must be multiple of 3
});
 
var converted = "";
var len = 0;
while((len = stream.read(buffer)) != -1) {
    buffer.length = len;
    converted += Ti.Utils.base64encode(buffer.toBlob());
    buffer.clear();
}
</pre></code>

<h4>Error log while sending the base64 string with HTTPClient</h4>
<code><pre>
11-21 11:19:16.986: E/dalvikvm-heap(30261): Out of memory on a 4782893-byte allocation.
11-21 11:19:16.986: I/dalvikvm(30261): "TiHttpClient-2" prio=1 tid=16 RUNNABLE
11-21 11:19:16.986: I/dalvikvm(30261):   | group="main" sCount=0 dsCount=0 obj=0x43a379a0 self=0x5e64a230
11-21 11:19:16.986: I/dalvikvm(30261):   | sysTid=2355 nice=19 sched=0/0 cgrp=apps/bg_non_interactive handle=1596774976
11-21 11:19:16.991: I/dalvikvm(30261):   | schedstat=( 215870373 20054584 25 ) utm=21 stm=0 core=3
11-21 11:19:16.991: I/dalvikvm(30261):   at java.nio.charset.Charsets.toUtf8Bytes(Native Method)
11-21 11:19:16.991: I/dalvikvm(30261):   at java.lang.String.getBytes(String.java:861)
11-21 11:19:16.991: I/dalvikvm(30261):   at java.lang.String.getBytes(String.java:845)
11-21 11:19:16.991: I/dalvikvm(30261):   at org.apache.http.entity.StringEntity.&lt;init&gt;(StringEntity.java:64)
11-21 11:19:16.991: I/dalvikvm(30261):   at ti.modules.titanium.network.TiHTTPClient.handleURLEncodedData(TiHTTPClient.java:1247)
11-21 11:19:16.991: I/dalvikvm(30261):   at ti.modules.titanium.network.TiHTTPClient.access$2000(TiHTTPClient.java:99)
11-21 11:19:16.991: I/dalvikvm(30261):   at ti.modules.titanium.network.TiHTTPClient$ClientRunnable.run(TiHTTPClient.java:1164)
11-21 11:19:16.991: I/dalvikvm(30261):   at java.lang.Thread.run(Thread.java:856)
11-21 11:19:16.991: E/TiHttpClient(30261): (TiHttpClient-2) [24623,676845] HTTP Error (java.lang.OutOfMemoryError): java.lang.OutOfMemoryError
11-21 11:19:16.991: E/TiHttpClient(30261): java.lang.OutOfMemoryError
11-21 11:19:16.991: E/TiHttpClient(30261):  at java.nio.charset.Charsets.toUtf8Bytes(Native Method)
11-21 11:19:16.991: E/TiHttpClient(30261):  at java.lang.String.getBytes(String.java:861)
11-21 11:19:16.991: E/TiHttpClient(30261):  at java.lang.String.getBytes(String.java:845)
11-21 11:19:16.991: E/TiHttpClient(30261):  at org.apache.http.entity.StringEntity.&lt;init&gt;(StringEntity.java:64)
11-21 11:19:16.991: E/TiHttpClient(30261):  at ti.modules.titanium.network.TiHTTPClient.handleURLEncodedData(TiHTTPClient.java:1247)
11-21 11:19:16.991: E/TiHttpClient(30261):  at ti.modules.titanium.network.TiHTTPClient.access$2000(TiHTTPClient.java:99)
11-21 11:19:16.991: E/TiHttpClient(30261):  at ti.modules.titanium.network.TiHTTPClient$ClientRunnable.run(TiHTTPClient.java:1164)
11-21 11:19:16.991: E/TiHttpClient(30261):  at java.lang.Thread.run(Thread.java:856)
11-21 11:19:16.991: I/TiHttpClient(30261): (TiHttpClient-2) [1,676846] Sending error java.lang.OutOfMemoryError
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-15792_44198/testfile_5MB">testfile_5MB</td></td><td>2013-11-26T11:42:05.000+0000</td><td>5242880</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ingo Muschenetz 2014-01-08

   I'm not able to find a maximum size hardcoded. My feeling is that it would either be limited by device memory or a server setting.</li>
<li>Sunila 2014-02-12

   This may be a duplicate of TIMOB-15594.</li>
<li>Lee Morris 2017-03-23

   Closing ticket as duplicate with reference to the linked issues above.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15792.json">JSON Source</a></p>