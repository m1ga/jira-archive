---
title: "[TIMOB-15818] CLI: Android: Incorrect JAVA_HOME passed into titanium_prep"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-11-26T00:56:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>2013 Sprint 24, 2013 Sprint 24 Core, Release 3.2.0</td></tr>
<tr><th>Components</th><td>Android, CLI</td></tr>
<tr><th>Labels</th><td>qe-closed-3.2.0, triage</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2013-11-25T22:30:54.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-19T02:19:29.000+0000</td></tr>
</table>

<h3>Description</h3>

When building for device in Linux (Ubuntu in this case), the build fails if JAVA_HOME is incorrect.

<code><pre>
...

[INFO]  Processing JavaScript files
[DEBUG] Copying and minifying /home/chris/Desktop/testapp/Resources/app.js =&gt; /home/chris/Desktop/testapp/build/android/assets/app.js
[INFO]  Encrypting JavaScript files: /home/chris/.titanium/mobilesdk/linux/3.2.0.v20131125103938/android/titanium_prep.linux64 "com.appcelerator.testapp" "/home/chris/Desktop/testapp/build/android/assets" "app.js" "_app_props_.json"
[ERROR] Failed to encrypt JavaScript files
[ERROR] Program launch failed. Unable to locate Java VM. Please set JAVA_HOME environment variable.
</pre></code>

JAVA_HOME is required for titanium_prep to run. If it's not set, then the CLI will try to autodetect the JAVA_HOME and pass that into titanium_prep. If JAVA_HOME is set and is invalid, titanium_prep will error.

This will require changes to both the Titanium SDK and node-appc.

*node-appc*
node-appc's jdk detection library needs to improve JAVA_HOME detection, specifically looking for <code>JAVA_HOME/lib/&lt;i386|amd64&gt;/&lt;client|server&gt;/libjvm.so</code> or <code>JAVA_HOME/jre/lib/&lt;i386|amd64&gt;/&lt;client|server&gt;</code>/libjvm.so. If these are not found, then it needs to add an issue JDK_INVALID_JAVA_HOME with description.

*Titanium SDK*
Android build needs to check if JDK_INVALID_JAVA_HOME is set and if so, fail.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2013-11-26

   Titanium Mobile pull request: <a href="https://github.com/appcelerator/titanium_mobile/pull/5024" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5024</a>
   node-appc pull request: <a href="https://github.com/appcelerator/node-appc/pull/70" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/70</a></li>
<li>Lokesh Choudhary 2013-12-17

   @Chris - I do not see any test instructions in this ticket. Can you please provide with some test steps.</li>
<li>Chris Barber 2013-12-17

   To test this, it's easiest to test on Windows since you can unset the JAVA_HOME and run "ti config java.home /path/to/jdk".</li>
<li>Samuel Dowse 2013-12-19

   Verified fixed on:
   Windows 7, 8 and 8.1
   CLI: 3.2.0-cr3
   Titanium SDK, build: 3.2.0.v20131812153242
   
   Followed test instruction from [~cbarber].
   Removed all instances of the java location from the environment variables.
   Running ti info -t jdk displayed no jdk was found.
   Set java.home in ti config and the java location was found.
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-15818.json">JSON Source</a></p>