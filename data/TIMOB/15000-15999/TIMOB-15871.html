---
title: "[TIMOB-15871] HTTPClient: setting autoRedirect off for 302s on Android calls onerror"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-08-29T00:18:08.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>alloy, android, error, httpclient, module_network, onerror, qe-manualtest, qe-testadded, redirect</td></tr>
<tr><th>Reporter</th><td>Adam Lynch</td></tr>
<tr><th>Assignee</th><td>Allen Yeung</td></tr>
<tr><th>Created</th><td>2013-11-13T11:35:53.000+0000</td></tr>
<tr><th>Updated</th><td>2014-10-14T23:20:44.000+0000</td></tr>
</table>

<h3>Description</h3>

If you set httpclient.autoRedirect to false and then send a GET which returns a 302 (or anything but a 200 I'm guessing), then onerror is called instead of onload.

1. 301, 302, etc. responses shouldn't be deemed an error, but if you're really set on that:
2. Make it consistent. On iOS, onload is called and on Android, onerror is called. Even if you don't, at least...
3. Give us all the information. Provide more than {error:'...'} to onerror. Give us the headers, the status, the responseText, responseData, etc. if they're there in the response.

This really reduces confidence in what you're doing and requires so much more testing.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-15871_50822/workaroundApp.js">workaroundApp.js</td></td><td>2014-08-27T22:34:00.000+0000</td><td>1725</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Mauro Parra-Miranda 2013-11-21

   Hello Adam! 
   
   Do you have any test case that shows this issue? 
   
   TIA!
   
   Best,
   
   Mauro </li>
<li>Mostafizur Rahman 2013-11-25

   Hello,
   
   We have tested this issue with my test code. I got this problem.  But we checked on iOS then its return success alert message. 
   
   <h4>Testing environment: </h4>
   
   OS: MAC OS X 10.8.5
    
   Ti SDK: 3.1.3 GA 
   Ti CLI: 3.2.0
   Android SDK 4.2.2 Device 
   Android SDK 4.0.3 in Emulator
   
   <h4>My test code </h4>
   <code><pre>
   var win1 = Titanium.UI.createWindow({
   	 
   });
   
   // Create a Button.
   var aButton = Ti.UI.createButton({
   	title : 'aButton',
   });
   
   // Listen for click events.
   aButton.addEventListener('click', function() {
   
   	var url = "<a href="http://www.example.com/redirect.php" rel="nofollow" target="_blank">http://www.example.com/redirect.php</a>";
   	var client = Ti.Network.createHTTPClient({
   		// function called when the response data is available
   		onload : function(e) {
   			Ti.API.info('e ' + JSON.stringify(e));
   			Ti.API.info("Received HEADERS_RECEIVED: " + this.HEADERS_RECEIVED);
   			Ti.API.info("Received status: " + this.status);
   			Ti.API.info("Received statusText: " + this.statusText);
   			Ti.API.info("Received responseText: " + this.responseText);
   
   			alert('success');
   		},
   		// function called when an error occurs, including a timeout
   		onerror : function(e) {
   			Ti.API.debug(e.error);
   			Ti.API.info("Received HEADERS_RECEIVED: " + this.HEADERS_RECEIVED);
   			Ti.API.info("Received status: " + this.status);
   			Ti.API.info("Received statusText: " + this.statusText);
   			Ti.API.info("Received responseText: " + this.responseText);
   
   			alert('error');
   		},
   		timeout : 5000, // in milliseconds
   		autoRedirect : false,
   		autoEncodeUrl : false,
   
   	});
   	// Prepare the connection.
   
   	client.open("GET", url);
   	// Send the request.
   	client.send();
   
   });
   
   // Add to the parent view.
   win1.add(aButton);
   
   win1.open();
   </pre></code>   
   
   <code><pre>
   <?php
   
   error_reporting(1);
   Header( "HTTP/1.1 301 Moved Permanently" );
   //Header( "Location: <a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>" );
   ?>
   </pre></code>
   
   <h4>Step to reproduces</h4>
   1.	Create a new project
   2.	Paste test code in app.js
   3.	Now run on android device/emulator 
   4.	Click on button its return error 
   
    
   
   Thanks
   </li>
<li>Israel 2014-05-23

   Hi I have exactly the same problem, but the problem occurs when the header code is 302 or 301 which are redirecting. 
   
   And android is only in the case of self-identification does not recover or cookie. Please any solution. 
   
   regards</li>
<li>Nick Milner 2014-08-12

   This is really a bit poor IMHO. Correctly responding to the http specification would seem to be the most basic requirement for any http implementation, especially in mobile. I just saw <a href="http://developer.appcelerator.com/question/176965/incorrect-status-returned-by-the-http-client-in-the-330-sdk" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/176965/incorrect-status-returned-by-the-http-client-in-the-330-sdk</a> and in the tests I describe there it seems Android is in a right mess. I was wondering why this is  a 'low' priority ?</li>
<li>Matthew Delmarter 2014-08-12

   Yes this should be an extremely high priority. Please fix asap - this bug has hosed critical features of my app.
   
   I can confirm that the above code sample also returns a "200" instead of a "301" when pointed to the URL of "<a href="http://google.co.nz" rel="nofollow" target="_blank">http://google.co.nz</a>" using the 3.3.0 SDK. Switching back to the 3.2.3 SDK fixed the issue. 
   
   I am using OS X Yosemite, with Xcode 5.1.1, iOS Simulator 7.1. Interesting that this ticket was created in a much older environment.
   
   This ticket is a likely duplicate of TC-4562 just added.</li>
<li>Ingo Muschenetz 2014-08-12

   The description of this ticket refers to "onerror" being called. Is that just the side effect of the wrong response code being returned? Note that this would not explain it working in 3.2.3 and not in 3.3.0. I'm not sure TC-4562 is a duplicate.</li>
<li>Ewan Harris 2014-08-26

   Issue can be reproduced on 3.2.3.GA and 3.3.0.GA.
   
   Due to TIMOB-17566 setting the autoRedirect in createHTTPClient() to false does not work and it defaults to true, therefore .status was always returning 200 instead of 302. This caused difficulties in being able to reproduce the issue and therefore the workaround of setting the properties via: 
   
   <code><pre>
   client.setAutoRedirect(false);
   client.setAutoEncodeUrl(false);
   </pre></code>
    was used. After using the workaround I was able to reproduce the issue using the workaroundApp.js I have attached to the ticket.
   
   Tested on:
   
   Mac OSX 10.9.4 
   Appcelerator Studio, build: 3.4.0.201408270900 
   Titanium SDK build: 3.3.0.GA, 3.2.3.GA 
   Titanium CLI, build: 3.3.0 
   Alloy: 1.3.1</li>
<li>Allen Yeung 2014-08-28

   <a href="https://github.com/appcelerator/titanium_mobile/pull/5997" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5997</a></li>
<li>Allen Yeung 2014-08-28

   Test case:
   
   <code><pre>
   var win1 = Titanium.UI.createWindow({
   
   });
   
   // Create a Button.
   var aButton = Ti.UI.createButton({
   	title : 'aButton',
   });
   
   // Listen for click events.
   aButton.addEventListener('click', function() {
   
   	var url = "<a href="http://httpbin.org/redirect/2" rel="nofollow" target="_blank">http://httpbin.org/redirect/2</a>";
   	var client = Ti.Network.createHTTPClient({
   		// function called when the response data is available
   		onload : function(e) {
   			Ti.API.debug('########################## ONLOAD');
   
   			Ti.API.info('e ' + JSON.stringify(e));
   			Ti.API.info("Received HEADERS_RECEIVED: " + this.HEADERS_RECEIVED);
   			Ti.API.info("Received status: " + this.status);
   			alert(this.status);
   			Ti.API.info("Received statusText: " + this.statusText);
   			Ti.API.info("Received responseText: " + this.responseText);
   
   			alert('success');
   		},
   		// function called when an error occurs, including a timeout
   		onerror : function(e) {
   			Ti.API.debug('########################## ERROR');
   
   			Ti.API.debug(e.error);
   			Ti.API.info("Received HEADERS_RECEIVED: " + this.HEADERS_RECEIVED);
   			Ti.API.info("Received status: " + this.status);
   			alert(this.status);
   			Ti.API.info("Received statusText: " + this.statusText);
   			Ti.API.info("Received responseText: " + this.responseText);
   
   			alert('error');
   		},
   		timeout : 5000, // in milliseconds*
   
   		autoRedirect : false,
   		autoEncodeUrl : false,
   
   	});
   
   	// Prepare the connection.
   	client.setAutoRedirect(false);
   	client.setAutoEncodeUrl(false);
   	client.open("GET", url);
   	// Send the request.
   	client.send();
   
   });
   
   // Add to the parent view.
   win1.add(aButton);
   
   win1.open(); 
   </pre></code></li>
<li>Lokesh Choudhary 2014-09-03

    Verified the fix.
    Onload is called instead of onerror.
    
    Closing
    
    The response for the test case above is:
    <code><pre>
    [INFO] :   e {"code":0,"source":{"location":"<a href="http://httpbin.org/redirect/2" rel="nofollow" target="_blank">http://httpbin.org/redirect/2</a>","status":302,"autoEncodeUrl":false,"timeout":5000,"domain":null,"responseText":"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\n<title>Redirecting...</title>\n<h1>Redirecting...</h1>\n<p>You should be redirected automatically to target URL: <a href=\"/redirect/1\">/redirect/1</a>.  If not click the link.","autoRedirect":false,"connectionType":"GET","validatesSecureCertificate":false,"statusText":"FOUND","password":null,"allResponseHeaders":"Access-Control-Allow-Credentials:true\nAccess-Control-Allow-Origin:*\nContent-Type:text/html; charset=utf-8\nDate:Wed, 03 Sep 2014 17:21:00 GMT\nLocation:/redirect/1\nServer:gunicorn/18.0\nContent-Length:229\nConnection:keep-alive\n","readyState":4,"responseXML":null,"responseData":{"file":null,"nativePath":null,"height":0,"length":229,"width":0,"mimeType":"text/html","apiName":"Ti.Blob","text":"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\n<title>Redirecting...</title>\n<h1>Redirecting...</h1>\n<p>You should be redirected automatically to target URL: <a href=\"/redirect/1\">/redirect/1</a>.  If not click the link.","type":2,"bubbleParent":true},"apiName":"Ti.Network.HTTPClient","username":null,"connected":false,"bubbleParent":true,"_events":{"disposehandle":{}}},"success":true}
    [INFO] :   Received HEADERS_RECEIVED: 2
    [INFO] :   Received status: 302
    [INFO] :   ALERT: (KrollRuntimeThread) [6,2604] 302
    [INFO] :   Received statusText: FOUND
    [INFO] :   Received responseText: <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
    [INFO] :   <title>Redirecting...</title>
    [INFO] :   <h1>Redirecting...</h1>
    [INFO] :   <p>You should be redirected automatically to target URL: <a href="/redirect/1">/redirect/1</a>.  If not click the link.
    [INFO] :   ALERT: (KrollRuntimeThread) [4,2608] success
    </pre></code>
    
    Environment:
    Appc Studio : 3.4.0.201408291834
    Ti SDK :   3.4.0.v20140829184521
    Mac OSX : 10.9.4
    Alloy : 1.5.0-dev
    CLI - 3.4.0-dev
    Code Processor: 1.1.1
    Nexus - android 4.2.2</li>
</ol>


<p><a href="/TIMOB/TIMOB-15871.json">JSON Source</a></p>