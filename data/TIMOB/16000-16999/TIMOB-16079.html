---
title: "[TIMOB-16079] Android: Incorrect e.itemIndex for ListView and SearchBar"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-08-20T00:58:36.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>module_listview, qe-manualtest</td></tr>
<tr><th>Reporter</th><td>Tim Fisher</td></tr>
<tr><th>Assignee</th><td>Sunila</td></tr>
<tr><th>Created</th><td>2013-12-18T08:58:25.000+0000</td></tr>
<tr><th>Updated</th><td>2014-08-22T16:04:37.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Steps to Reproduce</h4>
Create a SearchBar and ListView in Alloy, populate with searchable data. Enter search query in SearchBar and click top item. iOS returns the correct index of the clicked item, Android will return an index that is relative to the filtered list. i.e. the top item will always have an itemIndex of 0 on Android.

<h4>Actual Result</h4>
0

<h4>Expected Result</h4>
other than 0

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16079_44696/.log">.log</td></td><td>2013-12-18T08:58:30.000+0000</td><td>2893559</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16079_44697/diagnostic3273972563179129461.log">diagnostic3273972563179129461.log</td></td><td>2013-12-18T08:58:34.000+0000</td><td>19033</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ritu Agrawal 2013-12-22

   Thank you, Tim, for reporting this issue. I would appreciate if you can provide a simple test case to reproduce the issue as that would help us in troubleshoot the issue.</li>
<li>Ray Belisle 2014-01-02

   Here is an example that returns the correct item on iOS and shows the issue on Android.
   
   <code><pre>
   var win = Ti.UI.createWindow({backgroundColor: 'white', fullscreen: true});
   
   var search = Titanium.UI.createSearchBar({
       barColor:'#000', 
       showCancel:true,
       height:43,
       top:0,
   });
   search.addEventListener('cancel', function(){
       search.blur();
   });
   // for textSearch, use the change event to update the search value
   // search.addEventListener('change', function(e){
   //     listView.searchText = e.value;
   // });
   
   var listView = Ti.UI.createListView({searchView: search, caseInsensitiveSearch: true});
   // for textSearch, add the search bar or text field as a header view
   // var listView = Ti.UI.createListView({headerView: search, caseInsensitiveSearch: true});
   
   var listSection = Ti.UI.createListSection();
   var fruits = ['Papaya', 'Peach', 'Pear', 'Persimmon', 'Pineapple', 'Pluot', 'Pomegranate'];
   var data = [];
   for (var i = 0; i < fruits.length; i++) {
       data.push({
           properties: {title: fruits[i], searchableText: fruits[i]}
       });
   }
   listSection.setItems(data);
   
   listView.sections = [listSection];
   
   listView.addEventListener('itemclick', function(e){
       // Only respond to clicks on the label (rowtitle) or image (pic)
   var item = e.section.getItemAt(e.itemIndex);
   alert(item);
   });
   win.add(listView);
   win.open();
   </pre></code></li>
<li>Tim Fisher 2014-01-22

   Any idea when this will be fixed? I have an app going live at the end of Feb and this needs to be in.
   </li>
<li>Nguyen Bao Duy 2014-03-19

   Hi guys,
   I have an app need to release at the end of this March. Can you guys fix it earlier? Or can explain me the reason of this issue and I can play around with it. Thanks so much</li>
<li>Alessio Iacarelli 2014-03-19

   Hi All,
   
   Same issue here, is there any workaround available?
   
   Thank you very much!</li>
<li>Nguyen Bao Duy 2014-03-20

   I did some trick and it working for me, I tested and found"
   e.sectionIndex is right.
   e.itemIndex(wrong) is index of item in results list not original list.
   
   So we can use _.filter() to get results manually from original list and SearchText(_results) and item we need will be _results[e.itemIndex].
   
   Code:
   <code><pre>
   var section = $.container.sections[e.sectionIndex];
   
   if (OS_ANDROID) {
      var key = $.container.getSearchText();
      
      // get results manually
      var _results = _.filter(section.items, function (_item) {
         return _item.properties.searchableText.indexOf(key) !== -1;
      });
   
      // item we need
      item = _results[e.itemIndex];
   }
   </pre></code>
   </li>
<li>Ingo Muschenetz 2014-04-21

   Deferring to 3.4.0 to properly fix parity issue. Please let us know if the workaround does not work for you.</li>
<li>Mark Henderson 2014-05-21

   Can I please champion this parity bug to be fixed as the work around is a lot of extra code.
   
   For anyone not searching but filtering something like this will help:
   
   <code><pre>
   
   var section = listView.sections[e.sectionIndex];
   			var key = listView.getSearchText();
   		  	  	
   		   // get results manually - append itemIndex to e
   		   var item;
   		   if (key && key.length > 0) {
   			   for (var i=0; i < section.items.length; i++) {
   			   		if (section.items[i].properties.searchableText.toLowerCase().indexOf(key) !== -1) {
   						if (section.items[i].properties.itemId == e.itemId) {
   				   			item = section.items[i];
   				   			e.itemIndex = i;
   				   			break;
   				   		}	
   			   		}
   				};
   			} else {
   				for (var i=0; i < section.items.length; i++) {
   					if (section.items[i].properties.itemId == e.itemId) {
   						item = section.items[i];
   				   		e.itemIndex = i;
   					}
   				};
   				
   			}
   			
   			if (item && e.itemIndex) {
   				if (item.properties.accessoryType == Ti.UI.LIST_ACCESSORY_TYPE_CHECKMARK) {
   					item.properties.accessoryType = Ti.UI.LIST_ACCESSORY_TYPE_NONE;
   				} else {
   					item.properties.accessoryType = Ti.UI.LIST_ACCESSORY_TYPE_CHECKMARK;
   				}
   			   
   			   e.section.updateItemAt(e.itemIndex,item);
   			}
   </pre></code></li>
<li>Sunila 2014-06-03

   Modfied the code to store real index instead of the filtered index in the event data
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/5755" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5755</a></li>
<li>Lokesh Choudhary 2014-08-20

    Verified the fix.
    Android returns the right e.itemIndex & not just of the first item.
    
    Closing.
    
    Environment:
    Appc Studio : 3.4.0.201408180158
    Ti SDK :  3.4.0.v20140815142514
    Mac OSX : 10.8.5
    Alloy : 1.5.0-dev
    CLI - 3.4.0-dev
    Code Processor: 1.1.1
    Nexus 5 - android 4.4.4</li>
<li>Neville Dastur 2014-08-22

    Due for release in 3.4.0. REALLY!!!?
    
    This is quite a critical bug and I would ask for it to be part of a maintainance release please</li>
<li>Ingo Muschenetz 2014-08-22

    </li>
<li>Neville Dastur 2014-08-22

    Oh, okay. I saw the PR was 3 months old and having just released 3.3.0.GA I thought 3.4.0 was going to be a while off.</li>
</ol>


<p><a href="/TIMOB/TIMOB-16079.json">JSON Source</a></p>