---
title: "[TIMOB-16081] iOS: WebView firing 'beforeload' event by Ajax calls"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2014-02-20T22:28:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.1.2, Release 3.1.3, Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>supportTeam, webview</td></tr>
<tr><th>Reporter</th><td>Marco Cota</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2013-12-26T16:16:58.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-22T22:32:30.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue</h4>

When using the beforeload and load events event to execute an action (show a loader)  AJAX calls also fire the beforeload event but doesn't fire the load event.

Documentation mention that this event only if fire when loading local content, but on testing its being fired on remote content also.

<h4>Steps to Repro</h4>

1. Run sample code on iOS device or simulator

Expected Result:

When the html is loaded the red overlay should hide.

Actual Result:

The html loads and hides the red overlay but when the ajax is called the red overlay is shown again and no load event is fired so the overlay doen't hide blocking the webview content.


<h4>Sample Code</h4>

<code><pre>

var window = Ti.UI.createWindow({
	backgroundColor:"white"
});

var webview = Ti.UI.createWebView({
	url:'<a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a>'
});

var loader = Ti.UI.createView({
	width:'80%',
	height:'60%',
	backgroundColor:'red'
});

webview.addEventListener('beforeload',function(e){
	Ti.API.info("beforeload "+e.url);
	loader.show();
});

webview.addEventListener('load',function(e){
	Ti.API.info("load "+e.url);
	loader.hide();
});

webview.addEventListener('error',function(e){
	Ti.API.info("error "+e.url);
});

window.add(webview);
window.add(loader);
window.open();

</pre></code>

<h4>Console Log</h4>

iOS Simulator 

<code><pre>

[DEBUG] :  New scheme: &lt;NSMutableURLRequest: 0xde84c20&gt; { URL: <a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a> }
[INFO] :   beforeload <a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a>
[DEBUG] :  New scheme: &lt;NSMutableURLRequest: 0xdca4a10&gt; { URL: <a href="http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1</a> }
[INFO] :   beforeload <a href="http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1</a>
[INFO] :   load <a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a>
[DEBUG] :  New scheme: &lt;NSMutableURLRequest: 0x1388e9c0&gt; { URL: <a href="http://www.hdsupply.com/locations/app.asp?lat=37.3351212&lng=-122.03256229&rad=10&lob=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lat=37.3351212&lng=-122.03256229&rad=10&lob=WC&nobanner=1</a> }
[INFO] :   beforeload <a href="http://www.hdsupply.com/locations/app.asp?lat=37.3351212&lng=-122.03256229&rad=10&lob=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lat=37.3351212&lng=-122.03256229&rad=10&lob=WC&nobanner=1</a>
</pre></code>

iOS Device

<code><pre>

Dec 26 09:27:30 iCotaman webviewandroid[454] &lt;Warning&gt;: [DEBUG] New scheme: &lt;NSMutableURLRequest: 0x16659430&gt; { URL: <a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a> }
Dec 26 09:27:30 iCotaman webviewandroid[454] &lt;Warning&gt;: [INFO] beforeload <a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a>
Dec 26 09:27:30 iCotaman profiled[453] &lt;Notice&gt;: (Note ) profiled: Service stopping.
Dec 26 09:27:35 iCotaman webviewandroid[454] &lt;Warning&gt;: [DEBUG] New scheme: &lt;NSMutableURLRequest: 0x165a8aa0&gt; { URL: <a href="http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1</a> }
Dec 26 09:27:35 iCotaman webviewandroid[454] &lt;Warning&gt;: [INFO] beforeload <a href="http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lob=WC&source=WC&nobanner=1</a>
Dec 26 09:27:37 iCotaman webviewandroid[454] &lt;Warning&gt;: [INFO] load <a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a>
Dec 26 09:27:42 iCotaman webviewandroid[454] &lt;Warning&gt;: [DEBUG] New scheme: &lt;NSMutableURLRequest: 0x166f7ed0&gt; { URL: <a href="http://www.hdsupply.com/locations/app.asp?lat=19.35428288767054&lng=-99.12552894102328&rad=10&lob=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lat=19.35428288767054&lng=-99.12552894102328&rad=10&lob=WC&nobanner=1</a> }
Dec 26 09:27:42 iCotaman webviewandroid[454] &lt;Warning&gt;: [INFO] beforeload <a href="http://www.hdsupply.com/locations/app.asp?lat=19.35428288767054&lng=-99.12552894102328&rad=10&lob=WC&nobanner=1" rel="nofollow" target="_blank">http://www.hdsupply.com/locations/app.asp?lat=19.35428288767054&lng=-99.12552894102328&rad=10&lob=WC&nobanner=1</a>

</pre></code>

<h3>Comments</h3>

<ol>
<li>Pedro Enrique 2014-02-20

   We need more details on this. Where is this ajax called? Where do I need to click?</li>
<li>Pedro Enrique 2014-02-20

   You can also check what type of navigationType the beforeload event gives you and then show the view or do whatever needs to be done accordingly.
   
   <code><pre>
   webview.addEventListener('beforeload',function(e){
       Ti.API.info('navigationType: ' + e.navigationType);
   })
   </pre></code>
   
   <code><pre>
   Ti.UI.WEBVIEW_NAVIGATIONTYPE_LINK_CLICKED
   Ti.UI.WEBVIEW_NAVIGATIONTYPE_FORM_SUBMITTED
   Ti.UI.WEBVIEW_NAVIGATIONTYPE_BACK_FORWARD
   Ti.UI.WEBVIEW_NAVIGATIONTYPE_RELOAD
   Ti.UI.WEBVIEW_NAVIGATIONTYPE_FORM_RESUBMITTED
   Ti.UI.WEBVIEW_NAVIGATIONTYPE_OTHER
   </pre></code></li>
<li>Vishal Duggal 2014-02-20

   This is a side effect of the fixes TIMOB-3370 and the limitations of the UIWebViewDelegate interface on iOS
   
   The *beforeload* event is fired on webView:shouldStartLoadWithRequest:navigationType: delegate callback. 
   The *load* event is fired in the webViewDidFinishLoad: callback.
   
   While we have the URLRequest in the first delegate callback we have no such info in the second delegate callback. 
   
   The *beforeload* event fires with the url set to the url of the request in the callback.
   The *load* event fires with the url set to WebView.request.url property.
   
   We will not fire the *load* event if the WebView.request.url does not change (This is what TIMOB-3370 enforced).
   So you might see a lot more *beforeload* events on iOS than load events.
   
   iOS also returns the *navigationType* in the *beforeload* event. 
   If the navigationType is not *Titanium.UI.iOS.WEBVIEW_NAVIGATIONTYPE_OTHER* a *load* event is guaranteed. 
   
   So you might want to ignore all *beforeload* events where *navigationType* is *Titanium.UI.iOS.WEBVIEW_NAVIGATIONTYPE_OTHER*.
   </li>
<li>Vishal Duggal 2014-02-20

   Explanation of the load and beforeload events on iOS has been added. The problem the customer is facing can probably be solved by ignoring a few beforeload events. 
   
   Going to resolve this as needs more info.
   
   If the problem is not solved by the workaround above, please re-open with exact steps for reproduction.</li>
<li>Vishal Duggal 2014-02-20

   Try this code as workaround
   <code><pre>
   var window = Ti.UI.createWindow({
       backgroundColor:"white"
   });
    
   var webview = Ti.UI.createWebView({
       url:'<a href="http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations" rel="nofollow" target="_blank">http://mqa.qa-whitecap.ecom.hdsupply.com/webapp/wcs/stores/servlet/ContentDisplayView?catalogId=11101&langId=-1&storeId=11301&page=Store_Locations</a>'
   });
    
   var loader = Ti.UI.createActivityIndicator({
       message:'LOADING',
       backgroundColor:'black',
       color:'white',
       borderColor:'black',
       borderRadius:5,
       borderWidth:1
   });
   
   //Ensure first beforeload is processed. navigationType is other when setting url or data etc.
   var firstLoad = true;
    
   webview.addEventListener('beforeload',function(e){
       Ti.API.info("beforeload "+e.url);
       if (firstLoad || e.navigationType != Ti.UI.iOS.WEBVIEW_NAVIGATIONTYPE_OTHER) {
           firstLoad = false;
           Ti.API.info('*********LOAD******' + e.navigationType);
           loader.show();
       } else {
           Ti.API.info('*********NOLOAD******' + e.navigationType);
       }
   });
    
   webview.addEventListener('load',function(e){
       Ti.API.info("load "+e.url);
       loader.hide();
   });
    
   webview.addEventListener('error',function(e){
       Ti.API.info("error "+e.url);
       loader.hide();
   });
    
   window.add(webview);
   window.add(loader);
   window.open();
   </pre></code></li>
<li>Alvin Charles 2014-09-29

   @Vishal Duggal That worked fantastic for iOS. Is there any workaround for android also?</li>
<li>Lee Morris 2017-03-22

   Closing ticket due to the information that was requested not being provided.</li>
</ol>


<p><a href="/TIMOB/TIMOB-16081.json">JSON Source</a></p>