---
title: "[TIMOB-16326] Android: Animation with percentage behavior invert of iOS behavior"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-04-16T01:30:34.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>2014 Sprint 08, 2014 Sprint 08 SDK, Release 3.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>module_animation, qe-closed-3.3.0, qe-testadded, triage</td></tr>
<tr><th>Reporter</th><td>Keylo E.</td></tr>
<tr><th>Assignee</th><td>Sunila</td></tr>
<tr><th>Created</th><td>2014-01-27T20:52:56.000+0000</td></tr>
<tr><th>Updated</th><td>2014-07-27T00:52:41.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Updated Test Case</h4>

<code><pre>
var win = Titanium.UI.createWindow();

var view = Titanium.UI.createView({
  backgroundColor:'#fff',
  bottom : '80%',
  height : '10%'
});
win.add(view);

var anim = Titanium.UI.createAnimation({bottom:'5%', height:'95%'});

win.addEventListener('postlayout', function pl() {
this.removeEventListener('postlayout', pl);
setTimeout(function(){ view.animate(anim); }, 5000);
});

win.open();
</pre></code>

<h4>Original Test Case</h4>

For Android, Example:

<code><pre>
var win = Titanium.UI.createWindow();

var view = Titanium.UI.createView({
   bottom:'10%',
   height:'10%'
});
win.add(view);

var anim = Titanium.UI.createAnimation(  bottom:'40%',  height:'40%' );

var ready = false;
win.addEventListener('postlayout', function pl(){
    win.removeEventListener('postlayout', pl);
    ready = true;
});

function animIn(){
    if(ready){
        view.animate(anim);
    }
}

// alternate animIn() -----------------------

function animIn(){
    if(ready){
        view.setHeight(100)/ view.height = 100; // tried both
        view.animate(anim);
    }
}

// animIn() is called later in the project after postlayout.
</pre></code>

<h4>Actual Result</h4>
animation starts but does not complete.

Another problem I am encountering is that if I reset the view's values, as shown in 'alternate animIn()', the animation will fail whether percentages are used or not. 

I have replaced all percentages in the project's animations with instances like this, for '40%' .. (Ti.Platform.displayCaps.platformHeight * .4)

Unfortunately this method has proven to be unreliable as the platformHeight/width is returned incorrectly at times, noticed particularly during installation when device is at rest/sleep.


<h4>Expected Result</h4>
Animation should expand view to assigned height/width percentage and/or move to assigned top/bottom percentage.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-16326_45404/.log">.log</td></td><td>2014-01-27T20:53:00.000+0000</td><td>440038</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-16326_45405/diagnostic1170399753915506377.log">diagnostic1170399753915506377.log</td></td><td>2014-01-27T20:53:03.000+0000</td><td>15337</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-16326_45464/screenshot-1.jpg">screenshot-1.jpg</td></td><td>2014-01-29T17:26:25.000+0000</td><td>39091</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-16326_45465/screenshot-2.jpg">screenshot-2.jpg</td></td><td>2014-01-29T17:28:27.000+0000</td><td>36772</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Keylo E. 2014-01-27

   the above createAnimation() also has a duration value</li>
<li>Keylo E. 2014-01-28

   Android Version 4.2.2
   </li>
<li>Ritu Agrawal 2014-01-28

   I have been unable to run the provided code on iOS and Android platforms. I fixed few issues but I still don't see an animation on the screen. Can you please double check the test code and make sure that it can run as it is on Android platform?</li>
<li>Keylo E. 2014-01-28

   this is just an example. I would have to pull pieces of larger parts from actual project but occurs in all instances in all files that I have included a createAnimation, which equates to about 10 different times. Are you copying and pasting this?</li>
<li>Keylo E. 2014-01-28

   will try to do so. re-writing the entire project's animation is sapping time.</li>
<li>Ritu Agrawal 2014-01-28

   We understand but it would be great if you can provide us a complete test case as that helps us to troubleshoot these issues faster and making sure that we are resolving the same issue that you are encountering.</li>
<li>Keylo E. 2014-01-28

   Are you copying and pasting this?
   If so I assume you are calling the animation somewhere, and obviously opening the window.
   </li>
<li>Ritu Agrawal 2014-01-28

   I copied the provided code, fixed a couple of syntax errors and opened the window but did not see the animation.</li>
<li>Keylo E. 2014-01-28

   Revised, tested, copied and pasted. iOS works as expected, Android 4.2.2 seems to invert.
   
   var win = Titanium.UI.createWindow();
   
   var view = Titanium.UI.createView({
   	backgroundColor:'#fff',
   	bottom : '80%',
   	height : '10%'
   });
   win.add(view);
   
   var anim = Titanium.UI.createAnimation({bottom:'5%', height:'95%'});
   
   win.addEventListener('postlayout', function pl() {
   	this.removeEventListener('postlayout', pl);
   	setTimeout(function(){
   		view.animate(anim);
   	}, 5000);
   });
   
   win.open();</li>
<li>Ritu Agrawal 2014-01-28

    Moving this ticket to engineering as I can reproduce this issue with Android Galaxy Nexus device. Android animation is invert of iOS animation. 
    
    It appears to be a regression with 3.2.0 release as the behavior is similar to iOS platform with 3.1.3 release. There is another issue with 3.1.3 release though (view animated on splash screen) but that is most likely unrelated to this ticket.</li>
<li>Keylo E. 2014-01-28

    This example should simply place a white box atop the screen without animation and fails on Android.
    
    
    var h = Ti.Platform.displayCaps.platformHeight;
    
    var win = Titanium.UI.createWindow();
    
    var view = Titanium.UI.createView({
    	backgroundColor:'#fff',
    	bottom : (h * .5), // 300 works
    	height : (h * .9) // 1000 works
    });
    win.add(view);
    
    // var anim = Titanium.UI.createAnimation({bottom:0});
    
    win.addEventListener('postlayout', function pl() {
    	this.removeEventListener('postlayout', pl);
    	setTimeout(function(){
    		// view.bottom = (h * .8);
    		// view.animate(anim);
    	}, 10000);
    });
    
    win.open();
    </li>
<li>Keylo E. 2014-01-28

    my tests are showing that the Ti.Platform.displayCaps.platformHeight returns 1920, yet if I place the view's bottom at 900 it is off the screen, at 500 it is near the top. 1920 is correct.</li>
<li>Sunila 2014-01-29

    I tried with latest master in Google Nexus and Galaxy note and seems working. See the attached images.</li>
<li>Sunila 2014-01-29

    Before animation</li>
<li>Sunila 2014-01-29

    After animation</li>
<li>Keylo E. 2014-01-29

    still same on samsung-SGH-1537</li>
<li>Ritu Agrawal 2014-02-02

    [~sunila] Have you compared the behavior on iOS and Android platforms? You should be able to see the behavior difference more clearly.</li>
<li>Keylo E. 2014-02-12

    No update?</li>
<li>Sunila 2014-02-20

    I ran the the updated test case and I get the results as shown in the attachment.
    Yes, when I run in the IOS, I get the inverse but to me, Android behavior looks correct.
    Here is the text from the documentation (for default layout, ie composite)
    
    height & bottom specified	Child positioned bottom units from parent's bottom, using specified height.
    
    Here the specified height is 10% initially and the bottom is 80%, so the view with height 10% is shown with top 10% and bottom 80%. After the animation the height is 95% and bottom is 5% which means that the view should be drawn with 95% height with a 5% gap at the bottom.</li>
<li>Keylo E. 2014-02-20

    iOS works, Android on samsung-SGH-1537 (Galaxy S4 Active) does not. 
    Not sure if you were confused or simply switched your test cases in your report. I'll attach my compared results from today. 
    
    Simple test case shows difference.
    
    var h = Ti.Platform.displayCaps.platformHeight;
    var win = Titanium.UI.createWindow();
    var view = Titanium.UI.createView({
    	backgroundColor : '#fff',
    	bottom : (h * .2),
    	height : (h * .9)
    });
    win.add(view);
    win.open();
    
    iOS = working
    !<a href="http://pbrd.co/1fDuVaa" rel="nofollow" target="_blank">http://pbrd.co/1fDuVaa</a>!
    <a href="http://pbrd.co/1fDuVaa" rel="nofollow" target="_blank">http://pbrd.co/1fDuVaa</a>
    
    S4 Active = Not working
    !<a href="http://pbrd.co/1fDvEbd" rel="nofollow" target="_blank">http://pbrd.co/1fDvEbd</a>!
    <a href="http://pbrd.co/1fDvEbd" rel="nofollow" target="_blank">http://pbrd.co/1fDvEbd</a>
    
    Is this open to debate for some reason? Ritu Agrawal has confirmed my results. 
    Has caused a two month stall because I am not able to accommodate animation on the newest model from the most popular manufacturer. Seems rather important to me. </li>
<li>Sunila 2014-02-27

    Make sure that the new height and width(if changed as part of the animation) is used when calculating the left or top for animation.
    
    <a href="https://github.com/appcelerator/titanium_mobile/pull/5393" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5393</a></li>
<li>Sunila 2014-02-27

    I was trying with pre-honeycomb version and didn't see the problem. I was able to reproduce it with my Nexus and have submitted the fix. 
    Regarding the platformHeight bug, I couldn't reproduce the issue.</li>
<li>Deepti Pandey 2014-05-05

    Verified as FIXED using :
    Mac :10.9.2
    Appcelerator Studio, build: 3.3.0.201405011408
    SDK - 3.3.0.v20140502133323
    acs-1.0.14
    alloy-1.4.0-dev
    npm-1.3.2
    titanium-3.3.0-dev
    titanium-code-processor-1.1.1
    Xcode :5.1.1
    Devices used: Nexus 5 (4.4.2) , iPhone 5s (7.1.1)
    The new height and width(if changed as part of the animation) is used when calculating the left or top for animation.
    Hence closing as FIXED.</li>
</ol>


<p><a href="/TIMOB/TIMOB-16326.json">JSON Source</a></p>