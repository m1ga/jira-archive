---
title: "[TIMOB-16380] iOS: HTTPClient on iOS will not POST as multipart/form-data (but Android does)"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Done</td></tr>
<tr><th>Resolution Date</th><td>2016-03-07T19:15:25.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>look1</td></tr>
<tr><th>Reporter</th><td>James Hardwick</td></tr>
<tr><th>Assignee</th><td>Pedro Enrique</td></tr>
<tr><th>Created</th><td>2014-02-03T23:05:50.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-06T17:34:43.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Steps to Reproduce</h4>
Using the exact example given in the Titanium docs at <a href="http://docs.appcelerator.com/titanium/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/latest/#</a>!/guide/File_Uploads_and_Downloads I am unable to successfully transmit a file on iOS, but it *DOES* work fine on Android. 

Inspecting further, the POST request's Content-Type is not getting set properly to 'multipart/form-data' when sent from iOS, but instead is sent as 'application/x-www-form-urlencoded'. The property containing the supposed file will exist, but is merely a string representing the file path (as it exists on the mobile device). 

I've tried manually setting the Content-Type between opening the connection and sending the data, but it appears to be ignored. 

<h4>Actual Result</h4>
Content Type: application/x-www-form-urlencoded; charset=utf-8

<h4>Expected Result</h4>
Content Type: multipart/form-data

<h3>Comments</h3>

<ol>
<li>James Hardwick 2014-02-03

   I wonder if this is perhaps more of a bug with the underlying method of setting request headers, as no matter what I set, it seems to be getting ignored on iOS, but again, everything is working as expected on Android. </li>
<li>James Hardwick 2014-02-03

   Possibly related to TIMOB-13163</li>
<li>James Hardwick 2014-02-04

   To clarify this after a bit more playing around, I'm experiencing this (on iOS) when attempting to use HTTPClient.send() with a File instead of a Blob as part of the data sent. It seems to happen if I'm sending either *just* a File, or a File as a property on a Dictionary/JS Object, ala
   <code><pre>
   HTTPClient.send(someFile)
   </pre></code>
   as well as
   <code><pre>
   HTTPClient.send({myfile: someFile})
   </pre></code>
   
   If I instead do something such as 
   <code><pre>
   HTTPClient.send({myfile: someFile.read()})
   </pre></code>
   THEN this works as expected on iOS.</li>
<li>James Hardwick 2014-02-04

   <a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiNetworkHTTPClientProxy.m#L544" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiNetworkHTTPClientProxy.m#L544</a>
   
   …appears to only handle the case of a TiBlob, but not a TiFile, hence what I described above. So the parameter types described for the "data" property in the docs (<a href="http://docs.appcelerator.com/titanium/3.0/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/3.0/#</a>!/api/Titanium.Network.HTTPClient-method-send) isn't accurate.</li>
<li>Ritu Agrawal 2014-02-05

   Moving this ticket to engineering based on the detailed analysis from the reporter. Looking at the SDK code, either the code needs to handle File type or documentation needs to be updated. I have not looked at Android code.</li>
<li>Rey Bumalay 2014-02-10

   I wonder when this will be implemented or at least a temporary workaround to fix this because updating several data with file upload which is optional gets boundary error message. Thanks</li>
<li>Pedro Enrique 2014-06-03

   This was fixed with the HTTPClient refactor for 3.2.3
   The headers for the sample in the documentation are these:
   <code><pre>
   "Content-Length" = 2886522;
   "Content-Type" = "multipart/form-data; charset=utf-8; boundary=0xTibOuNdArY_1401790519";
   </pre></code></li>
<li>Jérôme Brunel 2014-06-13

   Hello,
   
   I just made a POST request and sent a JavaScript object to the send method and here is what I see on WireShark:
   The content type is: Content-Type: application/x-www-form-urlencoded; charset=utf-8
   The data sent is: firstname=John&phone=555555555&lastname=Smith&email=johnsmith@doe.com
   
   When I make a Ti.API.info on the JavaScript object right before I send it, I get this printed:
   [INFO] :   {
   [INFO] :       email = "johnsmith@doe.com";
   [INFO] :       firstname = John;
   [INFO] :       lastname = Doe;
   [INFO] :       phone = 555555555;
   [INFO] :   }
   
   From what I can see on this JIRA, it should have been fixed with the 3.2.3 refactor, but I use the 3.2.3 and this is not fixed at all.
   
   Jérome</li>
<li>Eric Merriman  2018-08-06

   Closed as completed. If this is in error, please reopen.</li>
</ol>


<p><a href="/TIMOB/TIMOB-16380.json">JSON Source</a></p>