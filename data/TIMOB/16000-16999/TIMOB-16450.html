---
title: "[TIMOB-16450] Android: imageAsResized is leaking memory"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-09-16T20:51:13.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>SupportTeam</td></tr>
<tr><th>Reporter</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2014-02-12T00:48:49.000+0000</td></tr>
<tr><th>Updated</th><td>2015-10-15T18:16:46.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem Description</h4>
When using the imageAsResize function in blob, it will start eventually to fail with a warning message about no more memory available. 

<h4>Test Code</h4>
<code><pre>
  var count = 0;
 
var win = Ti.UI.createWindow({
    backgroundImage : 'b1.png',
    layout : 'vertical'
});
var closeBtn = Ti.UI.createButton({
    title : 'close',
    top : '44dp',
});
var resizeBtn = Ti.UI.createButton({
    title : 'resize: ' + count,
    top : '20dp',
});
var imageView = Ti.UI.createImageView({
    width : '200dp',
    height : '200dp',
});
 
//--
win.add(closeBtn);
win.add(resizeBtn);
win.add(imageView);
 
//--
 
resizeBtn.addEventListener('click', function() {
    var f = Ti.Filesystem.getFile('b1.jpg');
    var blob = f.read();
    f = null;
    win.remove(imageView);
    imageView.view = null;
    imageView = null; 
    imageView = Ti.UI.createImageView({
    width : '200dp',
    height : '200dp',
	});
    imageView.image = blob.imageAsResized(960, 960);
    blob = null;
    win.add(imageView);
    count++;
    resizeBtn.title = 'resize: ' + count;
});
closeBtn.addEventListener('click', function() {
    win.close();
});
 
win.open();
</pre></code>

<h4>Attachments </h4>
Check the attachments for b1.jpg

<h4>Steps to reproduce</h4>
1. Create mobile project (classic titanium)
2. Copy-Paste the code from the testcase into app.js
3. Copy bg1.jpg into Resources directory
4. Deploy into device
5. Click in resize until the image doesn't appear anymore.

<h4>Extra info</h4>
when the image doesn't appear anymore, you will see a message in the console saying:

<code><pre>

[ERROR] :  TiBlob: (KrollRuntimeThread) [3227,231234] Unable to resize the image. Not enough memory: null
[ERROR] :  TiBlob: java.lang.OutOfMemoryError
[ERROR] :  TiBlob: 	at android.graphics.Bitmap.nativeCreate(Native Method)
[ERROR] :  TiBlob: 	at android.graphics.Bitmap.createBitmap(Bitmap.java:809)
[ERROR] :  TiBlob: 	at android.graphics.Bitmap.createBitmap(Bitmap.java:786)
[ERROR] :  TiBlob: 	at android.graphics.Bitmap.createBitmap(Bitmap.java:718)
[ERROR] :  TiBlob: 	at android.graphics.Bitmap.createScaledBitmap(Bitmap.java:594)
[ERROR] :  TiBlob: 	at org.appcelerator.titanium.TiBlob.imageAsResized(TiBlob.java:543)
[ERROR] :  TiBlob: 	at org.appcelerator.kroll.runtime.v8.V8Object.nativeFireEvent(Native Method)
[ERROR] :  TiBlob: 	at org.appcelerator.kroll.runtime.v8.V8Object.fireEvent(V8Object.java:64)
[ERROR] :  TiBlob: 	at org.appcelerator.kroll.KrollProxy.doFireEvent(KrollProxy.java:884)
[ERROR] :  TiBlob: 	at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1107)
[ERROR] :  TiBlob: 	at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:327)
[ERROR] :  TiBlob: 	at android.os.Handler.dispatchMessage(Handler.java:98)
[ERROR] :  TiBlob: 	at android.os.Looper.loop(Looper.java:136)
[ERROR] :  TiBlob: 	at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:112)
[INFO] :   I/dalvikvm-heap: Grow heap (frag case) to 182.277MB for 1474561
</pre></code> 

<h4>Q&A Link</h4>
<a href="http://developer.appcelerator.com/question/162431/android-memory-leaks" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/162431/android-memory-leaks</a>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16450_45831/b1.jpg">b1.jpg</td></td><td>2014-02-12T00:48:49.000+0000</td><td>2037092</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Samuel East 2015-08-13

   I am also having this problem and news...</li>
<li>Ashraf Abu 2015-09-16

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7197" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7197</a>
   
   In addition to <code>imageAsResized</code>, <code>imageAsThumbnail</code>, <code>imageWithAlpha</code>, <code>imageWithRoundedCorner</code> and <code>imageWithTransparentBorder</code> were also fixed to the memory from growing too large.
   
   Test code as above. Please test with other images and the other methods as well. The b1.jpg is quite large in general, hence for the other methods that do not resize, use a smaller image to test Alpha, Rounded Corner and TransparentBorder.</li>
<li>Tim Poulsen 2015-09-17

   I'm glad this is fixed. It would be nice if you guys would implement support for <code>camera.getParameters.setPictureSize()</code> in the native camera module to help with memory problems like this. I created a module for this because the Titanium camera module resulted in too many memory errors. See <a href="https://github.com/skypanther/picatsize" rel="nofollow" target="_blank">https://github.com/skypanther/picatsize</a> -- which is essentially TiCamera with a few modifications. Feel free to use whatever you want from it.</li>
<li>Ashraf Abu 2015-09-17

   [~timpoulsen] Thanks. I'll try to take a look into your code.</li>
<li>Lokesh Choudhary 2015-10-15

   Verified the fix.
   1.Tested the <code>imageAsResized</code> & <code>imageAsThumbnail</code> with the attached image which is around 1.9MB.
   2.Tested the imageWithAlpha<code>, </code>imageWithRoundedCorner<code> and </code>imageWithTransparentBorder` with a smaller image as these don't resize.
   
   Did not see any out of memory errors in any case with the fix.
   
   Closing.
   
   Environment:
   Appc Studio : 4.3.1.201509302304
   Ti SDK :   5.1.0.v20151014101225
   Ti CLI : 5.0.5
   Alloy : 1.7.16
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.1-1
   Appc CLI : 5.1.0-38
   Node: v0.10.37
   Android 4.2.2</li>
</ol>


<p><a href="/TIMOB/TIMOB-16450.json">JSON Source</a></p>