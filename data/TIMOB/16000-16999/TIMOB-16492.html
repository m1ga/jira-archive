---
title: "[TIMOB-16492] Android: Not able to capture intent data from a Notification created from Background service"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-03-19T19:51:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.1</td></tr>
<tr><th>Fix Version/s</th><td>2014 Sprint 06, 2014 Sprint 06 SDK, Release 3.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>module_android, qe-closed-3.3.0, qe-manualtest, supportTeam</td></tr>
<tr><th>Reporter</th><td>JÃ¶rgen Buder</td></tr>
<tr><th>Assignee</th><td>Sunila</td></tr>
<tr><th>Created</th><td>2014-02-18T15:03:34.000+0000</td></tr>
<tr><th>Updated</th><td>2014-08-05T23:24:30.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue description</h4>
I am using a simple background service to create a notification. The notification intent has extra data to it, and is then fired. The notification is displayed in the status bar. I pull down the bar and my app is opened/resumed. I try to read the intent data, but it appears as if the app is not resuming and even if I try to get both resume(d) and or the open on the activity I am not able to read any intent data added from the background service.

Please note that even if the service is registered again at next start the notification should still be possible to catch. I have read all things I can get, but I have not found any instruction on how to capture the notification intent data. All guides stop where it has appeared in the status bar, even den android dev ones. 

<h4>Test outcomes</h4>
- Data intent is only retrieved when you get it through android service resource: "app/lib/background_locationservice_android.js"

<code><pre>
//DISPLAYS ALERT BOX ("TEST2")
var service = Ti.Android.currentService;
if (service) {
	var intent = service.getIntent();
	var teststring = intent.getStringExtra("message");
	alert(teststring);

	service.addEventListener("taskremoved", function() {
		Ti.Android.NotificationManager.cancelAll();
		Ti.Android.stopService(intent);
	});
}
</pre></code>

However you can't get intent data either in app/alloy.js or controllers/index.js

<h4>Steps to reproduce</h4>
<h4>Get and run stripped down version on Android device.</h4>
<h4>Wait until a notification get trigger.</h4>
<h4>Quit app then click at notification at the statusBar. </h4>
<h4>Monitor Logs. Depending where was getStringExtra set will be the outcome.</h4>

Sample: <a href="https://www.dropbox.com/s/wow58vtprsiktu3/Arkiv_TestCase.zip" rel="nofollow" target="_blank">https://www.dropbox.com/s/wow58vtprsiktu3/Arkiv_TestCase.zip</a>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-16492_45992/Arkiv.zip">Arkiv.zip</td></td><td>2014-02-18T15:03:34.000+0000</td><td>5903193</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sunila 2014-02-24

   Exposed a new method to expose root activity. Only the intent as part of the launched activity will have the extra data. 
   Right now after a window is opened, there is no method to access the root activity.
   
   Existing code should work if 'Ti.Android.currentActivity' is called before window is opened. Something like
   
   <code><pre>
   var activity = Ti.Android.currentActivity;
   var intent = activity.getIntent();
   Ti.API.info('interval = '+intent.getIntExtra('interval',0)+' message='+intent.getStringExtra('message'));
   </pre></code>
   
   or use the new API 'getRootActivity' inside 'open' to get the data
   
   Something like 
   
   <code><pre>
   var rootActivity = Ti.Android.getRootActivity();
   var rootIntent = rootActivity.getIntent();
   Ti.API.info('RootIntent message='+rootIntent.getStringExtra('message'));
   </pre></code>
   
   PR
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/5368" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5368</a>
   </li>
<li>Sunila 2014-03-19

   New pull request based on latest master.
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/5493" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5493</a>
   
   Usage
   var rootIntent = Ti.App.Android.launchIntent;
   Ti.API.info('RootIntent message='+rootIntent.getStringExtra('message'));</li>
<li>Vishal Duggal 2014-03-19

   Test Code
   <code><pre>
   var launchIntent = Ti.Android.currentActivity.intent; 
   
   var checkInWindow = false;
   var testMessage = launchIntent.getStringExtra("message");
   if(testMessage != null) {
   	checkInWindow = true;
   }
   
   var win = Ti.UI.createWindow({
   	backgroundClor:'white',
   	exitOnClose:true
   });
   
   if(checkInWindow == true) {
   	
   	var l1 = Ti.UI.createLabel({top:50,text:testMessage});
   	var l2 = Ti.UI.createLabel({bottom:50,text:''});
   	var l3 = Ti.UI.createLabel({text: 'VALUES MUST BE SAME'});
   	
   	win.add(l1);
   	win.add(l2);
   	win.add(l3);
   	
   	win.addEventListener('open',function(e){
   		l2.text = Ti.App.Android.launchIntent.getStringExtra("message");
   	});
   	
   } else {
   	var btn = Ti.UI.createButton({title:'CREATE PENDING INTENT'});
   	win.add(btn);
   	btn.addEventListener('click',function(e){
   		Ti.API.info('BUTTON CLICK');
   
   		var intent = Ti.Android.createIntent({
   		    flags : Ti.Android.FLAG_ACTIVITY_CLEAR_TOP | Ti.Android.FLAG_ACTIVITY_NEW_TASK,
   		    // our application app id activity class. Replace as required
   		    className : 'com.appcelerator.titaniumtest.TitaniumtestActivity'
   		});
   		intent.putExtra('message', "This is test string");
   		intent.addCategory(Ti.Android.CATEGORY_LAUNCHER);
   		Ti.API.info('Created intent');
   		// Create a PendingIntent to tie together the Activity and Intent
   		var pending = Titanium.Android.createPendingIntent({
   		    intent: intent,
   		    flags: Titanium.Android.FLAG_UPDATE_CURRENT
   		});
   		Ti.API.info('Created pending intent');
   		// Create the notification
   		var notification = Titanium.Android.createNotification({
   		    // icon is passed as an Android resource ID -- see Ti.App.Android.R.
   		    //icon: 'images/ic_search.png',
   		    contentTitle: 'Test Intent',
   		    contentText : 'Click to return to the application.',
   		    contentIntent: pending
   		});
   		Ti.API.info('Created notification');
   		// Send the notification.
   		Titanium.Android.NotificationManager.notify(1, notification);
   		Ti.API.info('notification sent');
   		
   		setTimeout(function(){
   			win.activity.finish();
   		},200);
   		
   	});
   }
   
   win.open();
   </pre></code></li>
<li>Paras Mishra 2014-04-28

   Intent data is successfully captured from a Notification created from Background service, tested using the test code by  Vishal Duggal.
   Intent message is displayed on app screen when clicking the notification in the notification bar.
   
   Verified the fix on:
   Device : Google Nexus 4,  Android Version: 4.1.1
   SDK: 3.3.0.v20140425191906
   CLI version : 3.3.0-dev
   OS : MAC OSX 10.9.2
   Alloy:  1.4.0-dev
   ACS: 1.0.14
   npm:1.3.2
   Appcelerator Studio, build: 3.3.0.201404251359
   titanium-code-processor: 1.1.1-alpha
   XCode : 5.1.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-16492.json">JSON Source</a></p>