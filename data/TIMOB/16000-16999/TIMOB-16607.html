---
title: "[TIMOB-16607] Android: WebView not loading local RGraph library javascript files"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2014-10-13T21:58:19.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.2.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>ipass1, webview</td></tr>
<tr><th>Reporter</th><td>Joanna Zolopa</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2014-03-05T11:59:24.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-06T17:37:05.000+0000</td></tr>
</table>

<h3>Description</h3>

I am using web view in my alloy application to render charts using RGraph HTML5 library. My code works perfectly fine on iOS. Unfortunately on Android I keep getting an error indicating that RGraph library files haven't been loaded:

[INFO] :   I/TiWebChromeClient.console: (main) [1259542,1259713] Uncaught ReferenceError: RGraph is not defined (app:///barchart.html)

I have attached the HTML file & function from my controller code that can be used to reproduce the issue.

RGraph library can be downloaded from here :
<a href="http://www.rgraph.net/download" rel="nofollow" target="_blank">http://www.rgraph.net/download</a>  

I changed the extensions of all js files in the library to .jsf to stop Titanium from compiling them. And this is the structure of my folders in the project

app/assets/android/libraries  {here I've put RGraph library js files}
app/assets/android/barchart.html  {html file to be displayed; attached}

Similar for iOS.
The rest of the project follow the common structure of alloy project.

Please don't hesitate to contact me if you have any questions.


Here is the js code that I'm using:

<code><pre>
function showGraph() {
	
var resFolderPath = Ti.Filesystem.getResourcesDirectory() + '/';
	//Graph View creation
   var graphWebView = Ti.UI.createWebView({
        url: resFolderPath+ 'barchart.html',
        left: 100
    });

//To stop graph from scrolling
graphWebView.addEventListener('touchmove',function(e) {
    	return false;
});
	

	var win_height = Ti.Platform.displayCaps.platformHeight * 0.7;
    var win_width = Ti.Platform.displayCaps.platformWidth;
    
	
	var win = Ti.UI.createWindow({
		backgroundColor : '#40000000'
	});
 
    var view = Ti.UI.createView({
        backgroundColor: '#F2F2F2',
        bottom: -win_height,
        width : win_width,
        height : win_height
    });
	
	var closeButton = Titanium.UI.createButton({
   		title: 'Close',
   		top: 10,
   		left: 10,
   		height: 50
	});
		closeButton.addEventListener('click',function(e)
	{ win.close(); });
	

	var chartTitle = Titanium.UI.createLabel({
		text: "Chart Test",
		right: 10,
		textAlign: Ti.UI.TEXT_ALIGNMENT_RIGHT,
		top: 10,
		zIndex: 1
		
		
	});

	view.add(chartTitle);
	view.add(closeButton);
	view.add(graphWebView);
	
 	win.add(view);
 	
	if(OS_ANDROID) {
		win.open({ modal: true, navbarHidden: true });
	}
	else {
		win.open();
	}
}
</pre></code>

Here is the HTML that I'm trying to display:

<code><pre>
<head>
    <link rel="stylesheet" href="demos.css" type="text/css" media="screen" />
    <script type="text/javascript" src="/libraries/RGraph.common.core.jsf" ></script>
    <script type="text/javascript" src="/libraries/RGraph.common.dynamic.jsf" ></script>
    <script type="text/javascript" src="/libraries/RGraph.common.tooltips.jsf" ></script>
    <script type="text/javascript" src="/libraries/RGraph.common.effects.jsf" ></script>
    <script type="text/javascript" src="/libraries/RGraph.bar.jsf" ></script>
    <script type="text/javascript" src="/libraries/jquery.min.jsf" ></script>
    <title>A basic bar chart</title> 
</head>
<body>

<canvas style="text-align: center" id="cvs" width="850" height="400" >[No canvas support]</canvas>

<script>

var labels = ["One", "Two", "Three", "Four"];
                
               var combinedArrays = [[3,4],[2,3],[1,2],[1,4]];
       
            var bar = new RGraph.Bar('cvs', combinedArrays)
            	.Set('labels', labels)
            	.Set('hmargin', 50)
            	.Set('colors', ['Gradient(white:grey)', 'Gradient(black:white)'])
            	.Set('ylabels', false)
            	.Set('background.grid.vlines', false)
        	RGraph.Effects.Bar.Grow(bar);
</script>
</body>
</html>
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16607_46414/barchart.html">barchart.html</td></td><td>2014-03-06T08:24:18.000+0000</td><td>1255</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16607_46374/showChartFunction.rtf">showChartFunction.rtf</td></td><td>2014-03-05T11:59:24.000+0000</td><td>2010</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16607_46524/TestApp.zip">TestApp.zip</td></td><td>2014-03-10T19:59:41.000+0000</td><td>6651273</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-16607_46540/TestApp2.zip">TestApp2.zip</td></td><td>2014-03-11T05:34:47.000+0000</td><td>8162049</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joanna Zolopa 2014-03-06

   Corrected version ( previous html one got packaged in additional layer of html while saving)</li>
<li>Ritu Agrawal 2014-03-10

   [~joanna_z] I tried to follow the exact same steps provided by you to reproduce the issue but the whole application is throwing so many errors. Would it be possible for you to zip your project and attach to this ticket so that I can try and reproduce your problem?</li>
<li>Joanna Zolopa 2014-03-10

   Hi Ritu,
   I've extracted the web view bit from my app that should help you to reproduce the problem. I hope it helps.
   
   Kind regards,
   Joanna</li>
<li>Ritu Agrawal 2014-03-11

   Moving this ticket to engineering as I can reproduce this issue with the attached test case (use modified test TestApp2.zip file). Same application works fine on iOS platform but not on Android. It may something to do how resources paths are calculated for different platforms.</li>
<li>Joanna Zolopa 2014-03-19

   Hi,
   Could you provide me with any rough estimate of when possibly this issue can be looked at? I am nearing the completion of an application development and its outcome will highly contribute towards a decision of Appcelerator usefulness for our organisation. I just need to know if it's an issue or just a problem with the way I implemented it. 
   
   I would be grateful for any response on this one.
   
   Kind regards,
   Joanna</li>
<li>Ingo Muschenetz 2014-03-19

   I'm curious if this has to do with the changing of the .js -> .jsf file extension. Do you have to change them, even in development mode?</li>
<li>Ingo Muschenetz 2014-03-19

   [~joanna_z] One comment: If you renamed the WebView js files to jsf, then that may not work unless you explicitly set the type="application/javascript" in the <script> tag.</li>
<li>Joanna Zolopa 2014-03-20

   Hi Ingo,
   Thank you for your comments.
   The reason for renaming the files was to stop Titanium from pre-processing them - that was a tip that I found on appcelerator discussion board. I used the script type="text/javascript" and type="application/javascript" but it doesn't seem to make a difference :( 
   I've tried also setting back the file extensions to "js" but the javascript files are still not loaded while executed on android.
   
   Regards,
   Joanna</li>
<li>Joanna Zolopa 2014-03-20

   By the way: I don't think the problem is related to the specific library that I am using as I also tried creating a new file called test.js and trying to refer to it from the barchart.html, but I encountered the very same problem… 
   
    </li>
<li>Chris Barber 2014-03-28

    Bug confirmed in 3.3.0. -This is a regression. It worked in 3.2.0.GA and broke in 3.2.1.GA. We're investigating the cause. Stay tuned!-
    
    The root problem is Android does NOT properly load HTML files that begin with "app://" (i.e. the resource directory). Additionally Android does not properly load JavaScript files from the HTML file unless it's a relative URL.
    
    I'm reassigning this to the Android team.</li>
<li>Chris Barber 2014-03-30

    To get the attached example Alloy app to properly load RGraph, you must load "/barchart.html" and you must reference all of the HTML file's JavaScript files as "libraries/<name of library.js". As long as you're using 3.2.x, you do NOT need to rename your WebView JavaScript file's extension to ".jsf". You may leave them as ".js". As long as a ".js" file is referenced from an HTML file, it will not be treated as a Titanium JavaScript file.</li>
<li>Lokesh Choudhary 2014-04-22

    I could reproduce the issue & I could not see the local Rgraph in the webview. Used the attached app to reproduce.
    
    Environment:
    Appc Studio : 3.2.3.201404162038
    Ti SDK : 3.2.3.v20140417114627
    Mac OSX : 10.8.5
    Alloy : 1.3.1	
    CLI - 3.2.3-beta2
    Nexus 5 - android 4.4.2</li>
<li>Ingo Muschenetz 2014-08-14

    3.4.0 is moved forward, and 3.5.0 is taking its place in the calendar.</li>
<li>Hieu Pham 2014-09-18

    The local files referenced in the webview's html page is relative to the location of that html file. For instance, if I have 
    <code><pre>
    var webview = Ti.UI.createWebView({
    	url: "/balances/test.html", //this means that test.html is located in Resources/balances/test.html
    	height: Ti.UI.FILL,
    	width: Ti.UI.FILL,
    	backgroundColor: "green"
    });
    </pre></code>
    
    and in test.html, I have 
    
    <code><pre>
     <script type="text/javascript" src="apptest.js" ></script>   //   "/apptest.js" won't work for Android.
    </pre></code>
    
    apptest.js must be located in Resources/balances/
    
    For some reason native Android isn't accepting the first "/". So first make sure your files locations and paths are relative, and second omit the first "/" in your path. This should work with both Android and iOS. Another quick example to show this:
    
    test.html in Resources/ , apptest.js in Resources/folder1
    
    <code><pre>
    <script type="text/javascript" src="folder1/apptest.js" ></script>   //works in both Android and iOS
    <script type="text/javascript" src="/folder1/apptest.js" ></script>  //does not work in Android
    </pre></code>
    </li>
<li>Tim Richardson 2014-10-08

    Opening a webview on Android with a local PDF file:
    
    Titanium.UI.createWebView({ url :'directory/test.pdf' })
    
    Is not working. The application is looking to:
    
    file:///android_asset/Resources/alloy/controllers/directory/test.pdf, instead of file:///android_asset/Resources/directory/test.pdf</li>
<li>Chris Barber 2014-10-08

    [~timrichardson] In Alloy apps, I think your going to need to use the url <code>../../../directory/test.pdf</code>.
    
    The problem is actually the WebView on Android. We specify a served root and then the WebView takes care of all resource URL resolution and in many scenarios it doesn't do it properly. :(</li>
<li>Tim Richardson 2014-10-08

    [~cbarber] Thanks for the feedback mate. I've since discovered that displaying a PDF in an Android webview isn't supported anyway. You can use google docs to display it but it's not particularly reliable, so I'll need to take a different approach!</li>
<li>Chris Barber 2014-10-08

    [~timrichardson] Well, if you're feeling 1 part bored and 2 parts crazy, you can try using PDF.js in a WebView! <a href="https://mozilla.github.io/pdf.js/" rel="nofollow" target="_blank">https://mozilla.github.io/pdf.js/</a></li>
<li>Eric Merriman  2018-08-06

    Closing as invalid. If incorrect, please reopen.</li>
</ol>


<p><a href="/TIMOB/TIMOB-16607.json">JSON Source</a></p>