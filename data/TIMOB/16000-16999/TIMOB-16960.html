---
title: "[TIMOB-16960] CLI: Rearchitect to analytics to allow atomic events and only one process to send payload"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-05-15T01:08:10.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>2014 Sprint 10, 2014 Sprint 10 Tooling, Release 3.3.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2014-05-14T22:22:01.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-12T23:46:47.000+0000</td></tr>
</table>

<h3>Description</h3>

Whenever an analytics event is generated, it is persisted to disk until the event has successfully been sent to the server. The problem is that all events are written to the same json file. This will cause issues when more than one analytics process is being run at the same time.

So we solve this by writing events to separate files as well as creating a pid file that only allows one process to send analytics at a time.

FYI, these changes take place in node-appc.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2014-05-15

   node-appc master pull request: <a href="https://github.com/appcelerator/node-appc/pull/89" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/89</a>
   
   To test, create and build an app and make sure the ~/events directory was created and that it is empty (meaning all of the events have been sent).</li>
<li>Olga Romero 2014-06-12

   Tested with [~cbarber] and verified only one process is sent to payload. The events folder is empty.
   Environment:
   Mac osx 10.9.3 Mavericks
   Appcelerator Studio, build: 3.3.0.201406111156
   Titanium SDK, build: 3.3.0.v20140611084912 
   Node.JS Version: v0.10.13 
   NPM Version: 1.3.2 
   acs@1.0.14 
   alloy@1.4.0-rc 
   npm@1.3.2 
   titanium@3.3.0-rc 
   titanium-code-processor@1.1.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-16960.json">JSON Source</a></p>