---
title: "[TIMOB-17046] CLI: Analytics fails to send if event data greater than 8KB"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-06-20T21:36:28.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.3.0, Release 3.4.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>module_cli, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2014-05-30T05:16:21.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-27T20:59:25.000+0000</td></tr>
</table>

<h3>Description</h3>

With the introduction of TIMOB-16617, we can now collect Titanium API usage, however the data generated is greater than 8KB which is causing issues when forking the analytics send process.

The Titanium CLI needs to move the sending of analytics from the <code>process.on('exit')</code> event to a callback that is fired after the command finishes.

We also need to rework node-appc's analytics library so that the parent process writes the analytics events to disk, then forks the analytics send process with the minimal amount of data.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2014-05-30

   node-appc master pull request: <a href="https://github.com/appcelerator/node-appc/pull/93" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/93</a>
   
   Titanium CLI master pull request: <a href="https://github.com/appcelerator/titanium/pull/139" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium/pull/139</a>
   Titanium CLI 3_3_X pull request: <a href="https://github.com/appcelerator/titanium/pull/140" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium/pull/140</a>
   
   To test, *you MUST build a Titanium SDK that has TIMOB-16617*, then build an app for various platforms:
   
   <code><pre>
   ti build -p android --build-only --config {cli:{analytics:{debug:true}}}
   ti build -p ios --build-only --config {cli:{analytics:{debug:true}}}
   ti build -p mobileweb --build-only --config {cli:{analytics:{debug:true}}}
   </pre></code></li>
<li>Tim Poulsen 2014-06-18

   Analytics are sent, but:
   
   <code>ti config</code> no longer shows the cli.sendAPIUsage variable initially, though once you set it with <code>ti config cli.sendAPIUsage true</code>  you see the variable with <code>ti config</code>
   
   <code>ti config</code> never exits, nor does <code>ti sdk select</code> or <code>ti build</code> You have to press Ctrl-C to break out. It doesn't matter if you add additional arguments (like doing <code>ti config cli.sendAPIUsage true</code> you still have to Ctrl-C out). 
   
   Adding --config \{cli:\{analytics: \{debug:true}}} doesn't seem to do anything. With or without it, I had to add the console.log(payload) statement to analytics.js as described in the earlier comment to see any analytics output. </li>
<li>Chris Barber 2014-06-18

   [~skypanther] As with all Titanium CLI config options, if the config option does not explicitly exist, then the default is used.
   
   Just to be clear, you need to running the Titanium CLI from git with my changes and then put the node-appc from git (plus my changes) in the Titanium CLI's node_modules directory and make sure the npm dependencies are installed:
   
   <code><pre>
   git clone git@github.com:appcelerator/node-appc.git
   cd node-appc
   git checkout --track origin/timob-17046
   npm install
   
   cd ..
   
   git clone git@github.com:appcelerator/titanium.git
   cd titanium
   git checkout --track origin/timob-17046_3_3_X
   npm install
   rm -rf node_modules/node-appc
   cp -r ../node-appc node_modules/
   sudo npm link
   </pre></code>
   
   Now you should be able to run the CLI and the analytics will be sent correctly.</li>
<li>Chris Barber 2014-06-19

   So generate larger than 8KB of data, you must use a TiSDK that includes the PR from TIMOB-16617 and do a production/dist build.</li>
<li>Tim Poulsen 2014-06-20

   Works as described</li>
<li>Samuel Dowse 2014-06-27

   Verified on:
   Mac OSX 10.9.3
   Appcelerator Studio, build: 3.3.0.201406231625
   Titanium SDK, build: 3.3.0.v20140627094114
   Titanium CLI, build: 3.3.0-rc3
   Alloy: 1.4.0-rc2
   
   Used KitchenSink to generate and send large Analytic data.
   Data sent successfully.
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-17046.json">JSON Source</a></p>