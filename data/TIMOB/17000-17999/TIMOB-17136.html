---
title: "[TIMOB-17136] iOS: Passing null value to the callback on HTTPClient causes exception to be thrown on iOS "
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-06-13T20:20:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.3.0, Release 3.4.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>qe-3.3.0, regression</td></tr>
<tr><th>Reporter</th><td>Federico Casali</td></tr>
<tr><th>Assignee</th><td>Pedro Enrique</td></tr>
<tr><th>Created</th><td>2014-06-10T20:56:06.000+0000</td></tr>
<tr><th>Updated</th><td>2014-07-24T20:53:49.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
Using the latest TiSDK 3.3.X, Sync Server client is presenting issues when trying to login or sync.
Using TiSDK 3.2.3.GA works as expected, so is a regression.

<h4>Steps to reproduce</h4>
Grab Sample code here: <a href="https://github.com/appcelerator/titanium_mobile_tests_internal/tree/master/SyncServer/Sample_CombinedDev2013" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_tests_internal/tree/master/SyncServer/Sample_CombinedDev2013</a>
Module available in repo: <a href="https://github.com/appcelerator-modules/appcelerator.syncserver.client" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/appcelerator.syncserver.client</a>

Note: the updated sample code comes from the BasicSync sample code included in the module example folder with the following modifications: 
In app.js, change credentials to:
		<code><pre>
		var credentials = {
		"user": "admin@eagentmobile2013.onmicrosoft.com",
	    "password": "Combined1"
		};	
		</pre></code>
In syncConfig.js, the following code is used:
		<code><pre>
		{
	"connectors": {
		"msDynamicsCrm1.0": {
			"apis": {
				"login": "/api/1.0/msDynamicsCrm1.0/login",
				"logout": "/api/1.0/msDynamicsCrm1.0/logout",
				"verifysession": "/api/1.0/msDynamicsCrm1.0/verifysession",
				"update-details": "/api/1.0/msDynamicsCrm1.0/update-details",
				"get-details": "/api/1.0/msDynamicsCrm1.0/get-details"
			},
			"appId": "combined-dev-2013",
			"serverAddress": "<a href="http://e80189ea2413d9bb303c7095fc2bde12af543e0f.dev.ace.appcelerator.com" rel="nofollow" target="_blank">http://e80189ea2413d9bb303c7095fc2bde12af543e0f.dev.ace.appcelerator.com</a>",
			"databaseName": "DBTEST",
			"retryAttempts": 1,
			"autoResume": true,
			"models": [{
				"modelName": "contact",
				"idAttribute": "contactid",
				"syncOptions": {
					"queryName": "PowerName",
					"queryParameters": {
						"statecode": 0
					}
				}
			}]
		}
	}
}
		</pre></code>

<h4>iOS</h4>
1. Build and run on device or simulator

2. Click on Login
Result: Application Error screen is displayed with "Invalid type passed to function at appcelerator.syncserver.client" error message. See "screenshot_iOS.png" attached and attached log "log_iOS_login.txt".
Looking at the logs it seems that the login process is actually performed successfully. However, an Application Error is shown.

3. Click on Sync
Result: Application Error screen is displayed with "Invalid type passed to function at appcelerator.syncserver.client" error message. See "screenshot_iOS.png" attached and attached log "log_iOS_sync.txt".
Looking at the logs it seems that the login and sync processes are actually performed successfully. However, an Application Error is shown.


<h4>Android</h4>
5. Build/run on device or on simulator

6. Click on Login
Result: no error is displayed on screen. However, the logs are displaying a failure authenticating. See attached "log_Android_login.txt"
In particular:
<code><pre>
I/TiAPI   ( 1489):  Login Progress: {
I/TiAPI   ( 1489):   "errorCode": -15001,
I/TiAPI   ( 1489):   "message": "Unexpected token \u001f",
I/TiAPI   ( 1489):   "method": "sendRequest",
I/TiAPI   ( 1489):   "state": "loginFailed"
I/TiAPI   ( 1489): }
</pre></code>

7. Click on Sync
Result: no error is displayed on screen. However, the logs are displaying a failure authenticating and syncing. See attached "log_Android_sync.txt"
In particular:
<code><pre>
D/skia    ( 1489): --- SkImageDecoder::Factory returned null
W/System.err( 1489): java.lang.NullPointerException
W/System.err( 1489): 	at ti.modules.titanium.network.TiHTTPClient.getResponseHeader(TiHTTPClient.java:772)
W/System.err( 1489): 	at ti.modules.titanium.network.HTTPClientProxy.getResponseHeader(HTTPClientProxy.java:93)
W/System.err( 1489): 	at org.appcelerator.kroll.runtime.v8.V8Object.nativeCallProperty(Native Method)
W/System.err( 1489): 	at org.appcelerator.kroll.runtime.v8.V8Object.callProperty(V8Object.java:69)
W/System.err( 1489): 	at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1121)
W/System.err( 1489): 	at android.os.Handler.dispatchMessage(Handler.java:95)
W/System.err( 1489): 	at android.os.Looper.loop(Looper.java:137)
W/System.err( 1489): 	at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:112)
E/V8Exception( 1489): Exception occurred at appcelerator.syncserver.client:16: Uncaught Error: Java Exception occurred
I/TiAPI   ( 1489):  Sync Progress: {
I/TiAPI   ( 1489):   "errorCode": -15001,
I/TiAPI   ( 1489):   "message": "Unexpected token \u001f",
I/TiAPI   ( 1489):   "method": "sendRequest",
I/TiAPI   ( 1489):   "state": "loginFailed"
I/TiAPI   ( 1489): }
D/TiAPI   ( 1489):  &lt;progress&gt; : {"errorCode":-15001,"message":"Unexpected token \u001f","method":"sendRequest","state":"loginFailed"}
I/TiAPI   ( 1489):  Sync Progress: {
I/TiAPI   ( 1489):   "errorCode": -15001,
I/TiAPI   ( 1489):   "message": "Unexpected token \u001f",
I/TiAPI   ( 1489):   "method": "sendRequest",
I/TiAPI   ( 1489):   "state": "syncFailed"
I/TiAPI   ( 1489): }
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17136_49884/authentication_error.txt">authentication_error.txt</td></td><td>2014-07-18T21:13:06.000+0000</td><td>6663</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17136_48815/log_Android_login.txt">log_Android_login.txt</td></td><td>2014-06-10T20:56:06.000+0000</td><td>2016</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17136_48816/log_Android_sync.txt">log_Android_sync.txt</td></td><td>2014-06-10T20:56:06.000+0000</td><td>3895</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17136_48817/log_iOS_login.txt">log_iOS_login.txt</td></td><td>2014-06-10T20:56:06.000+0000</td><td>3388</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17136_48818/log_iOS_sync.txt">log_iOS_sync.txt</td></td><td>2014-06-10T20:56:06.000+0000</td><td>6088</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17136_48819/screenshot_iOS.png">screenshot_iOS.png</td></td><td>2014-06-10T20:56:06.000+0000</td><td>53154</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Neeraj Gupta 2014-06-11

   This is most likely a regression introduced with 3.3.0 SDK as just switching the Titanium SDK in tiapp.xml from 3.3.0 to 3.2.3 made the entire flow work.</li>
<li>Ingo Muschenetz 2014-06-11

   [~penrique], can you please take a look?</li>
<li>Sabil Rahim 2014-06-11

   Fix for iOS issue : <a href="https://github.com/appcelerator/titanium_mobile/pull/5791" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5791</a></li>
<li>Hieu Pham 2014-06-12

   </li>
<li>Sabil Rahim 2014-06-13

   3_3_X : <a href="https://github.com/appcelerator/titanium_mobile/pull/5798" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5798</a></li>
<li>Wilson Luu 2014-07-18

   After running the above sample app with the sync server module on both iOS and Android, I *do not* see the "Invalid type" error for iOS and I *do not* see the NullPointerException on Android. 
   
   *However*, after using different credentials to authenticate (from this ticket and from Jon), I still get authentication failure from the server (see authentication_error.txt).
   
   Tested on:
   
   Appcelerator Studio, build: 3.3.0.201407111535
   SDK build: 3.3.0.GA
   CLI: 3.3.0
   Alloy: 1.4.0
   Xcode: 5.1.1
   Devices: Nexus 5 (4.4), iphone 5 (7.1)
   </li>
<li>Neeraj Gupta 2014-07-19

   [~wluu] I see your update here but no change to the ticket status. Since you did not reopen this ticket, did you open another ticket to track your reported issue?</li>
<li>Wilson Luu 2014-07-24

   Closing ticket as fixed now. After getting the correct credentials and server url from Radamantis, I was able to verify that the "Invalid type" error for iOS does not appear and the NullPointerException does not appear on Android after properly authenticating.
   
   Tested on: 
   
   Appcelerator Studio, build: 3.3.0.201407111535
   SDK build: 3.3.0.GA
   CLI: 3.3.0
   Alloy: 1.4.0
   Xcode: 5.1.1
   Devices: Nexus 5 (4.4), iphone 5 (7.1.1)</li>
</ol>


<p><a href="/TIMOB/TIMOB-17136.json">JSON Source</a></p>