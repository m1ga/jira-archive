---
title: "[TIMOB-17142] Android: ListView crashes after using .replaceSectionAt() several times"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2014-09-12T17:24:33.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.2, Release 3.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, parity</td></tr>
<tr><th>Reporter</th><td>W. Blaine Price</td></tr>
<tr><th>Assignee</th><td>Ping Wang</td></tr>
<tr><th>Created</th><td>2014-06-09T19:31:11.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-22T23:09:36.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue description</h4>
I'm building an amortisation calculator as part of a financial calculator app.  

Since amortization tables are fairly lengthy, I'm using a ListView with two different versions of the ListView data to simulate a list expansion effect.  On itemclick, .replaceSectionAt() is called to replace a section of the summarized list with data from another object.  Any open section is replaced again with the summarized version.  

This is working flawlessly on iOS, but crashes after several clicks on Android 4.4.2.  Testing on older Android versions causes an immediate crash.  The console returns the error:

<code><pre>
[INFO] :   libc: Fatal signal 11 (SIGSEGV) at 0x00000014 (code=1), thread 1334 (KrollRuntimeThr)
</pre></code>

The error can be replicated by clicking on "Show more" in the app several times on an Android device.

Alloy Sample: <a href="https://www.dropbox.com/s/hdsudc0mkiw1fzr/list-view-crash-app.zip" rel="nofollow" target="_blank">https://www.dropbox.com/s/hdsudc0mkiw1fzr/list-view-crash-app.zip</a>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17142_48902/Case2067.zip">Case2067.zip</td></td><td>2014-06-12T19:45:33.000+0000</td><td>4070392</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17142_48895/timob17142.zip">timob17142.zip</td></td><td>2014-06-12T18:55:04.000+0000</td><td>3293556</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ingo Muschenetz 2014-06-12

   [~skypanther] Note last comment. Probably worth taking a quick look.</li>
<li>Tim Poulsen 2014-06-12

   Updated Classic project attached</li>
<li>Tim Poulsen 2014-06-12

   This is not an Alloy issue. First, the customer's project uses Alloy for only the outermost app structure. The ListView is created and manipulated using Classic-style code.
   
   Second, I could not get the Case2067.zip app to run on either iOS or Android. So, I re-created a Classic version from the customer's Alloy version. See the timob17142.zip file attached. It runs as expected on iOS. On Android, it crashes with the error as described in this ticket. 
   
   Errors like "Fatal signal 11 (SIGSEGV) at 0x00000014" usually indicate something is attempting to access an object that doesn't exist or the app is out of memory.</li>
<li>Eduardo Gomez 2014-06-12

   Thanks for sharing your findings, Tim. 
   
   Updated 'Case2067.zip'. The only difference is "underscore" module usage. Although when its removed the application runs a bit longer, then Fatal signal 11 is thrown.
   
   On my testing, while profiling allocations I did notice the memory consumption is too high (nearly 85% is used) on both Classic and Alloy. </li>
<li>Hieu Pham 2014-06-17

   master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/5807" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5807</a></li>
<li>Lokesh Choudhary 2014-08-27

   Tested the attached app timob17142.zip with the SDK having the fix & I still see the error:
   <code><pre>
   [INFO] :   libc: Fatal signal 11 (SIGSEGV) at 0x0000000c (code=1), thread 8248 (KrollRuntimeThr)
   </pre></code>
   
   Environment:
   Appc Studio : 3.4.0.201408270900
   Ti SDK :   3.4.0.v20140826143313
   Mac OSX : 10.9.4
   Alloy : 1.5.0-dev
   CLI - 3.4.0-dev
   Code Processor: 1.1.1
   Android 4.4.4</li>
<li>Eric Merriman  2014-08-28

   Reopening based on Lokesh's comment.</li>
<li>Ping Wang 2014-09-12

   The root reason for this issue is the same as TIMOB-14393. 
   
   In the project "timob17142.zip", "sectionsAftBk" which is an array of ListSection is not attached to the window. When there is a memory pressure, those ListSection might be get cleaned up by GC. That's why the app crashes. 
   
   There is a workaround. If you want those ListSection to be kept while the window is open, you can set it as the window property
   <code><pre>
   index.data = sectionsAftBk;
   </pre></code></li>
<li>W. Blaine Price 2014-10-20

   Hi Ping,
   
   I was able to use your workaround to solve my problem.  Thanks for your help!
   
   Blaine</li>
<li>Lee Morris 2017-03-22

    Closing ticket as duplicate as the relevant ticket is linked above.</li>
</ol>


<p><a href="/TIMOB/TIMOB-17142.json">JSON Source</a></p>