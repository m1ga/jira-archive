---
title: "[TIMOB-17227] CLI: Passing empty option value, building the project returns Error"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-08-29T08:09:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>cli, ft, qe-3.3.0, usability</td></tr>
<tr><th>Reporter</th><td>Olga Romero</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2014-06-26T23:40:15.000+0000</td></tr>
<tr><th>Updated</th><td>2014-09-14T20:13:46.000+0000</td></tr>
</table>

<h3>Description</h3>

<code><pre>
 -d, --project-dir <value>   the directory containing the project  [default: .]
</pre></code>
When running 
<code><pre>
ti build -d
</pre></code>
the output in the console is:
<code><pre>
[ERROR] TypeError: Arguments to path.join must be strings
    at path.js:360:15
    at Array.filter (native)
    at exports.join (path.js:358:36)
    at conf.options.appc.util.mix.project-dir.callback (/Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/cli/commands/build.js:101:52)
    at Context.<anonymous> (/usr/local/lib/node_modules/titanium/lib/context.js:597:31)
    at Array.forEach (native)
    at Context.setArg (/usr/local/lib/node_modules/titanium/lib/context.js:576:35)
    at Context.<anonymous> (/usr/local/lib/node_modules/titanium/lib/context.js:675:9)
    at Context.parse (/usr/local/lib/node_modules/titanium/lib/context.js:772:6)
    at processConf (/usr/local/lib/node_modules/titanium/lib/context.js:364:21)
---------------------------------------------
    at run (/Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/node_modules/node-appc/lib/subprocess.js:59:8)
    at /Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/iphone/cli/lib/detect.js:415:9
    at /Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/node_modules/async/lib/async.js:511:21
    at /Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/node_modules/async/lib/async.js:227:13
    at /Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/node_modules/async/lib/async.js:111:13
    at Array.forEach (native)
    at _each (/Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/node_modules/async/lib/async.js:32:24)
    at async.each (/Users/oromero/Library/Application Support/Titanium/mobilesdk/osx/3.3.0.v20140626144112/node_modules/async/lib/async.js:110:9)
</pre></code>

<h3>Comments</h3>

<ol>
<li>Chris Barber 2014-08-21

   [~fmiao] You are correct, <code>\-d</code> should display the same error as <code>\-\-project\-dir</code>.
   
   The problem stems from <code>context.js</code>, but that's because of a feature, not a bug. The CLI supports flags and options. Flags are in the format <code>\-\-flag\-name</code> and when encountered, the CLI treats this as <code>\-\-flag\-name true</code>. Options are in the format <code>\-\-option\-name somevalue</code>. Because the CLI parser doesn't know of something is a flag or option, it treats them as flags. That means if you specify <code>\-\-option\-name</code> without a subsequent value, it will set the option value to <code>true</code>. This herein lies the problem. This is by design.
   
   So, while this isn't great, we have a solution. For every option, we simply need to check if the value is a boolean. All option values should be strings even if it is a number or boolean string. So, "hello world", "123", "true" are all valid option values. The option callbacks and validators will need to properly parse the values from the string format.
   
   As an example, here's what you need to do:
   
   <code><pre>
   'some-option': {
       validate: function (value, callback) {
           if (typeof value === 'boolean') {
               return callback(true);
           }
           callback(null, value);
       }
   }
   </pre></code>
   
   For a real world example, look at the options in the iOS build script: <a href="https://github.com/appcelerator/titanium_mobile/blame/master/iphone/cli/commands/_build.js#L349-L351." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blame/master/iphone/cli/commands/_build.js#L349-L351.</a>
   
   You can see I added a bunch of them in this commit: <a href="https://github.com/appcelerator/titanium_mobile/commit/5ed0879a77d98cfcce35404a6be098d378224fd3." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/5ed0879a77d98cfcce35404a6be098d378224fd3.</a> You just need to find the remaining options that are missing this, add them, and test.</li>
<li>Chris Barber 2014-08-22

   [~fmiao] On a Mac, if you do <code>\-\-</code>, it automatically turns it into an "mdash". Since an mdash is not a dash, and probably is accidental, we treat <code>\-\-</code> and mdashes the same.</li>
<li>Feon Sua Xin Miao 2014-08-25

   PR Master: <a href="https://github.com/appcelerator/titanium_mobile/pull/5983" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5983</a>
   
   Functional Test:
   1. Create an app:
   <code><pre> 
   ti create -t app -d . -n true -u http:// --id com.timob.test
   </pre></code>
   2. Build the app:
   <code><pre>
   ti build -d 
   //or
   ti build --project-dir
   </pre></code>
   Following error message should be shown:
   <code><pre>
   [ERROR] Invalid project directory "" because tiapp.xml not found
   </pre></code>
   3. Build the app again by passing a value to the option
   <code><pre>
   // In this case the project happened to be name 'true'
   ti build -d true
   // or
   ti build --project-dir true
   </pre></code>
   The build process should run without error.</li>
<li>Ewan Harris 2014-09-02

   Verified fix on:
   
   Mac OSX 10.9.4
   Appcelerator Studio, build: 3.4.0.201408291834
   Titanium SDK build: 3.4.0.v20140829184521 
   Titanium CLI, build: 3.4.0-dev
   Alloy: 1.5.0-dev
   
   
   Created a new app and attempted to build using the ti build -project-dir command, after asking for the platform to target it showed the error as expected. I then built and passed in a value and the build process ran without error. The same is shown with the ti build -d command</li>
</ol>


<p><a href="/TIMOB/TIMOB-17227.json">JSON Source</a></p>