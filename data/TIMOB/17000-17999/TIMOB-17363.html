---
title: "[TIMOB-17363] Android: Add "Ti.UI.MaskedImage" support"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-05-17T10:26:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, android-l, demo_app, maskedimage</td></tr>
<tr><th>Reporter</th><td>Ingo Muschenetz</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2014-07-22T16:26:31.000+0000</td></tr>
<tr><th>Updated</th><td>2018-06-27T13:39:11.000+0000</td></tr>
</table>

<h3>Description</h3>

*Original Request:*
As of Android 5.0 (aka: Android L) you can define bitmaps as an alpha mask and tint them using a color resource. You create these assets only once and color each instance to match your theme. This is done via a Java <code>Drawable</code> class' <code>setTint()</code>, <code>setTintList()</code>, and <code>setTintMode()</code> method.
<a href="https://developer.android.com/reference/android/graphics/drawable/Drawable.html#setTint(int)" rel="nofollow" target="_blank">https://developer.android.com/reference/android/graphics/drawable/Drawable.html#setTint(int)</a>

*Proposed Solution:*
This should be implemented via our existing <code>Ti.UI.MaskedImage</code> feature which is currently iOS only. This way we have parity between platforms.
<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.MaskedImage

The concept is exactly the same. You apply a color or image to a grayscaled mask and specify the PorterDuff compositing mode.
<a href="https://developer.android.com/reference/android/graphics/PorterDuff.Mode.html" rel="nofollow" target="_blank">https://developer.android.com/reference/android/graphics/PorterDuff.Mode.html</a>

Instead of using Android 5.0's tinting APIs, we should use Android's <code>Drawable</code> and <code>Canvas</code> classes instead which support tinting/masking in all Android OS versions. _(The new tinting methods are there out of convenience for a pre-existing feature.)_

*Note:*
This feature would also provide an alternate solution for developers who want to display an ImageView with rounded borders. Since rounded borders have known hardware acceleration bugs on Google's end, an alternative solution is to use a MaskedImage with a circular mask instead. This is how it's usually done by native Android developers anyways.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65091/MaskedImageTest.zip">MaskedImageTest.zip</td></td><td>2018-04-28T04:29:26.000+0000</td><td>101730</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65093/MaskedImageTest-Android.png">MaskedImageTest-Android.png</td></td><td>2018-04-28T04:55:52.000+0000</td><td>184767</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65092/MaskedImageTest-iOS.png">MaskedImageTest-iOS.png</td></td><td>2018-04-28T04:46:21.000+0000</td><td>70508</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65099/Screenshot1.png">Screenshot1.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>398009</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65100/Screenshot2.png">Screenshot2.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>465803</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65101/Screenshot3.png">Screenshot3.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>388504</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65102/Screenshot4.png">Screenshot4.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>174490</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65103/Screenshot5.png">Screenshot5.png</td></td><td>2018-04-30T22:52:00.000+0000</td><td>420857</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65104/Screenshot6.png">Screenshot6.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>505431</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65105/Screenshot7.png">Screenshot7.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>402294</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-17363_65106/Screenshot8.png">Screenshot8.png</td></td><td>2018-04-30T22:51:59.000+0000</td><td>203860</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2018-04-07

   Android L's (aka: Android 5.0) drawable tinting is mostly intended as an image masking feature. We don't need to use its new tinting methods. Masking can be done on all Android OS versions via...
   <a href="https://developer.android.com/reference/android/graphics/PorterDuff.Mode.html" rel="nofollow" target="_blank">https://developer.android.com/reference/android/graphics/PorterDuff.Mode.html</a>
   
   I think this should be implement via Titanium's existing <code>Ti.UI.MaskedImage</code>, which is currently iOS only.
   <a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.MaskedImage
   
   Side Note:
   Our <code>Ti.UI.Button</code> already supports a <code>tintColor</code> property. So, a button which uses a grayscaled <code>backgroundImage</code> with a <code>tintColor</code> already supports this feature.</li>
<li>Joshua Quick 2018-04-18

   Also note that Android's Java "Drawable" class does not support using a ColorFilter and Tint at the same time. Calling <code>Drawable.setColorFilter()</code> disables tint and vice-versa...
   [Drawable.html#setColorFilter()](<a href="https://developer.android.com/reference/android/graphics/drawable/Drawable.html#setColorFilter(int" rel="nofollow" target="_blank">https://developer.android.com/reference/android/graphics/drawable/Drawable.html#setColorFilter(int</a>,%20android.graphics.PorterDuff.Mode))
   [Drawable.html#setTint()](<a href="https://developer.android.com/reference/android/graphics/drawable/Drawable.html#setTint(int))" rel="nofollow" target="_blank">https://developer.android.com/reference/android/graphics/drawable/Drawable.html#setTint(int))</a>
   
   On Android, Titanium's "tintColor" feature is implemented via the Java <code>Drawable.setColorFilter()</code> API. So, like I said above, we already support this feature, but we need to avoid Google's new tinting APIs since they conflict with their color-filter APIs. Implementing MaskedImage support is still the way to go.</li>
<li>Joshua Quick 2018-04-26

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10013" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10013</a></li>
<li>Joshua Quick 2018-04-28

   Added Titanium test project:  [^MaskedImageTest.zip] 
   
   Note:
   The zip's images "MaskCamera.png" and "MaskCircleLock.png" came from the Android SDK. All other contained images were made by Axway (I created all other mask PNGs).</li>
<li>Josh Longton 2018-06-27

   *Closing ticket.*
   The feature is present in SDK:
   
   {noformat}
   7.3.0.v20180626174550
   {noformat}</li>
</ol>


<p><a href="/TIMOB/TIMOB-17363.json">JSON Source</a></p>