---
title: "[TIMOB-17612] Titanium Android: HTTPClient doesn't decompress gzipped data for error responses"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-01-07T19:26:40.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>decompression, httpclient, module_network, parity, qe-manualtest, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Stephen Woodford</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2014-09-03T18:43:36.000+0000</td></tr>
<tr><th>Updated</th><td>2015-01-07T19:26:40.000+0000</td></tr>
</table>

<h3>Description</h3>

Gzipped data isn't decompressed if the response status code is >=400 (<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L273-L275)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L273-L275)</a>

Whereas for response status codes <400, the response is properly decompressed.
(<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L285)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L285)</a>

<h3>Comments</h3>

<ol>
<li>Stephen Woodford 2014-09-03

   Forgot to mention, iOS properly decompresses data in error responses, so this is a parity issue as well.</li>
<li>Shannon Hicks 2014-10-03

   Took *FOREVER* to track this down. To hopefully help others with some google bait... The dump I get when I hit this bug:
   
   <code><pre>
   [ERROR] :  V8Exception: Exception occurred at undefined:1: Uncaught SyntaxError: Unexpected token 
   [ERROR] :  XMLModule: (KrollRuntimeThread) [19,11721] Error parsing XML
   ......
   [ERROR] :  TiHttpClient: 	at android.os.Looper.loop(Looper.java:136)
   [ERROR] :  TiHttpClient: 	at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:112)
   </pre></code>
   
   Also, the raw response:
   
   </li>
<li>Fokke Zandbergen 2014-10-04

   I have the same issue. The bug seems to be introduced in 3.3.0 with the new HTTPClient.</li>
<li>Shannon Hicks 2014-10-04

   I was able to reproduce the bug in 3.2.1 and 3.1.2.</li>
<li>Nikolai Derzhak 2014-10-13

   [~iotashan] Can you please attach raw code and probably log as file ? That black diamonds with questions marks kills email notifications in JIRA too ) .
   
   So I had to remove them.</li>
<li>Ashraf Abu 2015-01-05

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6530" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6530</a>
   
   Test App:
   <code><pre>
   var url = "<a href="https://api.stackexchange.com/2.2/answers?order=desc&sort=activity&site=stackoverflo2w" rel="nofollow" target="_blank">https://api.stackexchange.com/2.2/answers?order=desc&sort=activity&site=stackoverflo2w</a>";
    var client = Ti.Network.createHTTPClient({
        // function called when the response data is available
        onload : function(e) {
            Ti.API.info("Received text: " + this.responseText);
            alert('success');
            
        },
        // function called when an error occurs, including a timeout
        onerror : function(e) {
            Ti.API.debug(e.error);
             alert('error ' + this.responseText);
   
        },
        timeout : 5000  // in milliseconds
    });
    // Prepare the connection.
    client.open("GET", url);
    // Send the request.
    client.send();
   </pre></code></li>
<li>Lokesh Choudhary 2015-01-07

   Verified the fix. The gzip data gets decompressed as expected.
   
   Closing.
   
   Environment:
   Appc Studio : 3.4.1.201410281743
   Ti SDK : 3.6.0.v20150106160923
   CLI : 3.4.1
   Alloy : 1.5.1 GA
   Code Processor : 1.1.1
   MAC Yosemite : 10.10</li>
</ol>


<p><a href="/TIMOB/TIMOB-17612.json">JSON Source</a></p>