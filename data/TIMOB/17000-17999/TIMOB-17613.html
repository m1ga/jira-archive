---
title: "[TIMOB-17613] Unable to execute javascript code using evalJS on Android with SDK 3.3.0.GA"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-09-15T17:37:10.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>3.3.0, Android, Titanium, evalJS, module_android, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Ivo</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2014-09-03T15:57:15.000+0000</td></tr>
<tr><th>Updated</th><td>2014-11-20T15:50:52.000+0000</td></tr>
</table>

<h3>Description</h3>



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-17613_50952/Screen Shot 2014-09-03 at 5.08.00 PM.png">Screen Shot 2014-09-03 at 5.08.00 PM.png</td></td><td>2014-09-03T15:57:16.000+0000</td><td>236063</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Urban Gerber 2014-09-04

   We have this issue in our enterprise app, relying on evaluating js functions embedded in remote html pages rendered in a WebView. We use this as kind of event mechanism, for the app to take control on certain user actions done on the remote web site.
   
   I have tested Ivo's sample on a real device, Samsung Galaxy Note 10.1.
   Works on SDK 3.2.3, does not work on SDK 3.3.0!
   
   This is a blocking issue for us, cannot upgrade the SDK. 
   Please fix in the next SDK.
   Thanks</li>
<li>Ingo Muschenetz 2014-09-04

   From TIMOB-15896, is it possible for you to try adding the annotation and see if that fixes the issue for you? It would require you to build a custom SDK, but it would help speed up resolution.</li>
<li>Ivo 2014-09-05

   After doing some investigation on the changes done on this file 
   <a href="https://github.com/appcelerator/titanium_mobile/blob/3_3_X/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebViewBinding.java#L153" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/3_3_X/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebViewBinding.java#L153</a>
   We believe that we have located the problem, which according us is not related to missing annotation in the code (note that annotation is already present, and according to the Android documentation this has effect only on API >= 17).
   Instead, we think that the problem is introduced by newly added code, which does some pattern matching before evaluating the Javascript expression. The conslusion was made by comparing the same file from 3.2.X and 3.3.X (copy the contents of both files in some diff tool). 
   After reverting this code, and building the Titanium SDK from scratch, it seems that the issue is resolved. However, we believe that this code was put there for some reason, thus removing it is not the best idea. 
   We would be very gratefull if you fix the problem with the pattern/matcher and provide the fix in the next SDK release. </li>
<li>Ingo Muschenetz 2014-09-05

   Thank you! That's very helpful.</li>
<li>Ingo Muschenetz 2014-09-05

   The original test case (from TIMOB-10837):
   
   <code><pre>
   webView.addEventListener('load', function() {
       webView.evalJS('var a="test";document.body.innerHTML=a'); // doesn't works
       //webView.evalJS('document.body.innerHTML="test"'); // works
   });
   </pre></code>
   
   Seems we need to add a few more cases to make sure we evaluate them correctly. I'm assuming we can simplify the example above. Is it just because it's a self-invoking function?</li>
<li>Ingo Muschenetz 2014-09-05

   Marking as for 3.4.0 unless we come up with a suitable workaround.</li>
<li>Hieu Pham 2014-09-07

   master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6026" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6026</a>
   3.4.X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6027" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6027</a></li>
<li>Lokesh Choudhary 2014-09-12

   Verified the fix.
   After running the code in the description we now get :
   <code><pre>
   [INFO] :   ALERT: (KrollRuntimeThread) [456,456] {f1:1,f2:2}}
   </pre></code>
   which is expected behaviour & shows the execution of javascript code using evalJS.
   
   Closing.
   
   Environment:
   Appc Studio : 3.4.0.201409112242
   Ti SDK :  3.4.0.v20140912084114 
   Mac OSX : 10.9.4
   Alloy : 1.5.0-rc
   CLI - 3.4.0-rc2
   Code Processor: 1.1.1
   Genymotion Emulator - android 4.1.1</li>
<li>grebulon 2014-11-20

   This happens again on 3.4.1GA on Lollipop.
   On Android 4.4.2 it's all fine.</li>
<li>grebulon 2014-11-20

    Please ignore my previous comment. It was premature.</li>
</ol>


<p><a href="/TIMOB/TIMOB-17613.json">JSON Source</a></p>