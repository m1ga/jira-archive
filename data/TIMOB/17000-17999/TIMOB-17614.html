---
title: "[TIMOB-17614] Android: Facebook-Login-Callback needs JSON.parse (parity)"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 3.3.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>TCSupport, android, facebook, login</td></tr>
<tr><th>Reporter</th><td>Hans Kn√∂chel</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2014-08-17T11:56:55.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T20:04:00.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem Description</h4>
I recently discovered an issue on Android when logging into Facebook to use the user-data like name & id. Therefor the login callback returns a "data" object, which needs to be parsed manually on Android, but in iOS you don't need to do anything extra. 
 
<h4>Steps to reproduce</h4>

- Create a simple project.
- Update app.js with:
<code><pre> 
var fb = require("facebook");
var win = Ti.UI.createWindow({backgroundColor: "#fff"});
var btn = Ti.UI.createButton({title: "Facebook-Login"});
 
btn.addEventListener("click", doLogin);
fb.addEventListener("login", debugLogin);
 
function doLogin() {
    fb.appid = "***************";
    fb.permissions = ["publish_stream"];
    fb.forceDialogAuth = false;
    fb.authorize();
}
 
function debugLogin(e) {
    Ti.API.info(JSON.stringify(e.data));
    alert(e.data.name); // Doesn't work for android
    // var t =JSON.parse(e.data); // Does work for android.
    // alert(t.name); // Does work for android.
}

win.add(btn);
win.open();
</pre></code>

- Add facebook module in tiapp.xml
- Run on android device


<h4>Extra info</h4>
The difference in the callbacks are here. 
iOS: <a href="https://gist.github.com/hansknoechel/9e63d4b683bd72cc29bd" rel="nofollow" target="_blank">https://gist.github.com/hansknoechel/9e63d4b683bd72cc29bd</a>
Android: <a href="https://gist.github.com/hansknoechel/f0f3280fda26f98d52c0" rel="nofollow" target="_blank">https://gist.github.com/hansknoechel/f0f3280fda26f98d52c0</a>

The bug was also discussed 2 years ago in the Q&A: <a href="https://developer.appcelerator.com/question/135341/titaniumfacebook-login-callback---cant-access-user-data-on-android-device" rel="nofollow" target="_blank">https://developer.appcelerator.com/question/135341/titaniumfacebook-login-callback---cant-access-user-data-on-android-device</a>

<h4>Workaround</h4>
The bug can be "fixed" by using a conditional statement like:
<code><pre>
var data = (OS_ANDROID) ? JSON.parse(e.data) : e.data;
</pre></code>
But a consistent behaviour is clearly the better way.

<h3>Comments</h3>

<p>No comments</p>

<p><a href="/TIMOB/TIMOB-17614.json">JSON Source</a></p>