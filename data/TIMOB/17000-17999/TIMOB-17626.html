---
title: "[TIMOB-17626] Ti.Media.saveToPhotoGallery() saves pictures without file extension on Android"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-05-21T02:12:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>TCSupport</td></tr>
<tr><th>Reporter</th><td>François Mériaux</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2014-07-29T13:09:33.000+0000</td></tr>
<tr><th>Updated</th><td>2015-06-09T21:51:29.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem Description</h4>
On Android, *Ti.Media.saveToPhotoGallery()* saves a file or a blob without any file extension, which makes it impossible for the photo gallery to recognize the file.

The issue can be reproduced with the following code, with the picture test.jpg being stored in project/app/assets. Note that in this example, I use *Ti.Media.saveToPhotoGallery* with a blob but I get exactly the same result with a file.

<code><pre>

var file = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, "/test.jpg");
Ti.Media.saveToPhotoGallery(file.read(), {
	success: function() {
		alert('success');
	},
	error: function() {
		alert('error');
	}
});
</pre></code>

I receive a success, but the image is saved without extension and I get this message in the console:

D/MediaScannerReceiver(25405): action: android.intent.action.MEDIA_SCANNER_SCAN_FILE path: /storage/emulated/0/Pictures/TestApp/tia636479782jpeg

<h4>Steps to Reproduce:</h4>
1. Create a Classic project.
2. Paste this code in app.js file.
3. Paste a photo to the resources folder named test.jpg.
4. Run this code with the testing environment.

<h4>Test Code:</h4>
<code><pre>
var win = Titanium.UI.createWindow({
	backgroundColor : "#000",
});

var photo = Ti.UI.createButton({
	title : 'Save Photo',
	height : Ti.UI.SIZE,
	width : Ti.UI.SIZE,
	top : 20,
	color : "#fff"

});

win.add(photo);

// Listen for click events.
photo.addEventListener('click', function() {
	file = Ti.Filesystem.getFile(Titanium.Filesystem.resourcesDirectory, "test.jpg");
	alert(file.nativePath);
	Ti.Media.saveToPhotoGallery(file.read(), {
		success : function() {
			alert('success');
		},
		error : function() {
			alert('error');
		}
	});

});

win.open();

</pre></code>


<h3>Comments</h3>

<ol>
<li>François Mériaux 2014-08-01

   Can anyone reproduce this issue?</li>
<li>Michael Gangolf 2014-09-05

   confirmed on a Nexus 4 (4.4.4), SDK 3.3.0
   
   09-05 18:05:50.721: D/MediaScannerReceiver(32662): action: android.intent.action.MEDIA_SCANNER_SCAN_FILE path: /storage/emulated/0/Pictures/testapp/tia333724776png
   
   When I look inside the folder the file is really saved without the dot (tia333724776png)</li>
<li>jithinpv 2014-09-19

   Issue reproduces
   
   Titanium SDK version 3.4.0 master, 3.3.0.GA
   Titanium Studio, build: 3.3.0.201407100905
   Titanium Command-Line Interface
   CLI version 3.3.0, 
   Android device : Motorola Moto G, Android version : 4.4.4</li>
<li>LUIS VIERA 2015-01-20

   Issue reproduces
   
   Titanium SDK version 3.4.0.
   Android device: Nexus 5, Android version: 5.0.1
   
   
   This issue happening when I use:
   .
   .
   CASE 1: 
   photo.addEventListener('click', function() {
   	file = Ti.Filesystem.getFile(Titanium.Filesystem.tempDirectory, "test.jpg");
   	alert(file.nativePath);
   	Ti.Media.saveToPhotoGallery(file.read(), {
   .
   .
   .
   
   However, if I put a image on assets/android/images/, then, I make for example
   
   .
   .
   CASE 2:
   	var imagen_prueba = Ti.UI.createImageView({
   		image : '/images/bandera.jpg',
   		width : "300dp",
   		height : "300dp"
   	});
   
           Ti.Media.saveToPhotoGallery(imagen_prueba.toBlob(), {
   .
   .
   .
   
   
   Using this way, work perfect!.
   
   </li>
<li>LUIS VIERA 2015-01-21

   I solved the issue the following way:
   
   var imagen_prueba = Ti.UI.createImageView({
   	image : "/images/bandera.jpg",
   	width : "50dp",
   	height : "50dp",
   	top : "0dp",
   	zIndex : 2,
   	left : "0dp"
   });
   
   var imagen_view = Ti.UI.createView({
   	width : "300dp",
   	height : "300dp",
   	backgroundColor : "RED",
   	zIndex : 1
   });
   
   imagen_view.add(imagen_prueba);
   $.contenedor.add(imagen_view);
   
   $.accion.addEventListener('click', function() {
   
   	var blob = imagen_view.toImage();
   
   	var file = Titanium.Filesystem.getFile(Titanium.Filesystem.tempDirectory, "imagen.jpg");
   
   	if (file.write(blob.media)) {
   
   		var image_tmp = Ti.UI.createImageView({
   			image: file.nativePath,
   			height: "300dp",
   			width: "300dp"
   		});
   
   		Ti.Media.saveToPhotoGallery(image_tmp.toBlob(), {
   			success : function(e) {
   				Ti.API.info("listo, revisa!");
   			},
   			error : function() {
   				Ti.API.info("Ocurrio un error!");
   			}
   		});
   
   	} else {
   		alert("No se guardo la imagen");
   		Ti.API.info("No se guardo la imagen");
   	}
   
   });
   
   $.index.open();
   
   
   .
   .
   .
   
   After to save the image I create a object image and then I make image_tmp.toBlob(), with this, the result is something like that:
   
   .....tia333724776.png :) !!!!
   
   
   Thanks, I wanted to shared with you.
   
   Good luck!</li>
<li>Andrew Tokmakoff 2015-01-25

   MediaModule uses TiMimeTypeHelper to get the mimetype of the image.  This in turn uses android.webkit.MimeTypeMap which returns the extension minus the preceding ".".
   
   <a href="http://developer.android.com/reference/android/webkit/MimeTypeMap.html" rel="nofollow" target="_blank">http://developer.android.com/reference/android/webkit/MimeTypeMap.html</a>
   
   So, the fix is to adjust the call to TiMimeTypeHelper such that the returned value has the "." prefixed.
   
   line 372 
   changes from
   					extension = TiMimeTypeHelper.getFileExtensionFromMimeType(mimetype, ".jpg");
   
   to become:
   
   					extension = "." + TiMimeTypeHelper.getFileExtensionFromMimeType(mimetype, "jpg");
   
   This works for me.
   
   </li>
<li>Ashraf Abu 2015-05-20

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6862" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6862</a></li>
<li>Ashraf Abu 2015-05-21

   PR reviewed and functionally tested. Merged.</li>
<li>Lokesh Choudhary 2015-06-09

   Verified the fix.
   
   The picture is saved with an extension.
   
   Closing.
   
   Environment:
   Appc Studio :  4.1.0.201505071004
   Ti SDK :  4.1.0.v20150605164428
   Ti CLI : 4.0.1
   Alloy : 1.6.0
   MAC Yosemite : 10.10.3
   Appc npm : 4.0.0
   Appc CLI : 4.0.2-rc2
   Node: v0.10.37
   Device - Android 5.0.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-17626.json">JSON Source</a></p>