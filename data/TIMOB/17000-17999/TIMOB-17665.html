---
title: "[TIMOB-17665] iOS8: userLocation is not displayed when using ti.map module"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-09-30T21:04:08.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.4.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.4.0, Release 3.5.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios8, module_map, parity, qe-3.4.0, usability</td></tr>
<tr><th>Reporter</th><td>Olga Romero</td></tr>
<tr><th>Assignee</th><td>Jon Alter</td></tr>
<tr><th>Created</th><td>2014-09-09T21:09:50.000+0000</td></tr>
<tr><th>Updated</th><td>2014-11-21T20:28:52.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>To reproduce</h4>
1. Run the sample code, make sure to add ti.map module to tiapp.xml
<code><pre>
var MapModule = require('ti.map');

var window = Ti.UI.createWindow({
	backgroundColor : 'white'
});

Titanium.UI.setBackgroundColor('#000');

window.title = 'Test';
window.backgroundColor = '#000';
window.exitOnClose = true;

window.add(MapModule.createView({
	userLocation : true
}));

window.open(); 
</pre></code>
<h4>Actual result</h4>
No permission to use the user current location, no pin to display it.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-17665_51093/ios7.png">ios7.png</td></td><td>2014-09-09T21:09:50.000+0000</td><td>444990</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-17665_51094/ios8.png">ios8.png</td></td><td>2014-09-09T21:09:50.000+0000</td><td>460235</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-17665_51237/ti.map-iphone-2.0.3.zip">ti.map-iphone-2.0.3.zip</td></td><td>2014-09-13T19:42:42.000+0000</td><td>727690</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ingo Muschenetz 2014-09-12

   I think this is best for you to review.</li>
<li>Ingo Muschenetz 2014-09-12

   [~vduggal] to act as reviewer.</li>
<li>Pedro Enrique 2014-09-13

   PR for master: <a href="https://github.com/appcelerator-modules/ti.map/pull/48" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/48</a>
   PR for stable: <a href="https://github.com/appcelerator-modules/ti.map/pull/49" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/49</a></li>
<li>Ingo Muschenetz 2014-09-13

   Since code is accepted, can we get a PR to merge this into the SDK?</li>
<li>Pedro Enrique 2014-09-14

   PR for titanium_mobile with updated module.zip:
   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/6074" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6074</a>
   3_4_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/6080" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6080</a></li>
<li>Jon Alter 2014-09-15

   Zip PR master: <a href="https://github.com/appcelerator-modules/ti.map/pull/50" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/50</a>
   Zip PR stable: <a href="https://github.com/appcelerator-modules/ti.map/pull/51" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/51</a></li>
<li>Olga Romero 2014-09-15

   Open the tiapp.xml in the ios / plist / dict section add the below:
   <code><pre>
   &lt;ios&gt;
          &lt;plist&gt;
              &lt;dict&gt;
                  &lt;key&gt;NSLocationAlwaysUsageDescription&lt;/key&gt;
                  &lt;string&gt;Optional description here, can be empty&lt;/string&gt;
              &lt;/dict&gt;
          &lt;/plist&gt;
      &lt;/ios&gt;
   </pre></code>
   Tested and verified the fix with
   Mac osx 10.9.4 Maverics
   Appcelerator Studio, build: 3.4.0.201409131030
   Titanium SDK, build: 3.4.0.v20140915103316
   acs@1.0.16
   alloy 1.5.0-rc2
   install@0.1.7
   npm@1.4.23
   sudo@1.0.3
   titanium 3.4.0-rc3
   titanium-code-processor@1.1.1
   Xcode6
   Device: iPhone 5S iOS8
   </li>
<li>Travis Crist 2014-09-20

   Has this issue been tested with the NSLocationWhenInUseUsageDescription plist key? When I use that key the users location is still not showing up on the map. I get the prompt but the location is not shown on the map. 
   <code><pre>
   &lt;ios&gt;
      &lt;plist&gt;
          &lt;dict&gt;
              &lt;key&gt;NSLocationWhenInUseUsageDescription&lt;/key&gt;
              &lt;string&gt;Optional description here, can be empty&lt;/string&gt;
          &lt;/dict&gt;
      &lt;/plist&gt;
   &lt;/ios&gt;
   </pre></code>
   </li>
<li>Travis Crist 2014-09-22

   Found a solution to this where when using NSLocationWhenInUseUsageDescription the users location would not show up on the map. Please see the commit: <a href="https://github.com/TravisCrist/ti.map/commit/e0e8066195d11cf0f13a4843f1d3ed61ebb84cd4" rel="nofollow" target="_blank">https://github.com/TravisCrist/ti.map/commit/e0e8066195d11cf0f13a4843f1d3ed61ebb84cd4</a> for the fix. It requires a change to the map module. I am unsure how to make a PR with just that commit. </li>
<li>Marco Cota 2014-09-22

    Running some test based on Travis comment i have verified the issue with SDK 3.4.0.RC2 and Ti.Map module 2.0.3, when the NSLocationWhenInUseUsageDescription plist key is used the permission is correctly prompted and we can correctly retrieve the user location with Ti.Geolocation.getCurrentPosition but the map displayed in the app is not showing the blue marker for the user location, if we use the NSLocationAlwaysUsageDescription plist key the user location is correctly shown with the blue marker in the map
    
    tiSDK 3.4.0.RC2
    tiMap 2.0.3
    Xcode 6
    iPhone 5s iOS 8
    
    <h4>Test Code</h4>
    <code><pre>
    var MapModule = require('ti.map');
     
    var window = Ti.UI.createWindow({
        backgroundColor : 'white'
    });
     
    var mapview = MapModule.createView({
        userLocation : true
    });
    window.add(mapview);
    
    setTimeout(function(){
    	Ti.Geolocation.getCurrentPosition( function(e) {
      if (!e.success || e.error) {
        alert('error ' + JSON.stringify(e.error));
        return;
      }
      alert(e.coords.latitude + ' ' + e.coords.longitude);
      var region = {
        latitude: e.coords.latitude,
        longitude: e.coords.longitude,
        animate:true,
        latitudeDelta:0.05,
        longitudeDelta:0.05
      };
      mapview.setLocation(region);
    });
    },5000);
    
    window.open(); 
    </pre></code>
    
    tiApp.xml
    <code><pre>
    &lt;ios&gt;
       &lt;plist&gt;
           &lt;dict&gt;
                   &lt;key&gt;NSLocationWhenInUseUsageDescription&lt;/key&gt;
                   &lt;string&gt;Optional description here, can be empty&lt;/string&gt;
           &lt;/dict&gt;
        &lt;/plist&gt;
    &lt;/ios&gt;
    </pre></code></li>
<li>Jon Alter 2014-09-22

    master PR: <a href="https://github.com/appcelerator-modules/ti.map/pull/53" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/53</a>
    stable PR: <a href="https://github.com/appcelerator-modules/ti.map/pull/54" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.map/pull/54</a>
    
    Thank you [~tcrist]!</li>
<li>Jon Alter 2014-09-22

    TiSDK PRs
    3_4_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6150" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6150</a>
    master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6151" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6151</a></li>
<li>Olga Romero 2014-09-23

    Tested and verified the userLocation is displayed when using ti.map module.
    The environment tested:
    Mac osx 10.9.5 Mavericks
    Appcelerator Studio, build: 3.4.0.201409161950
    Titanium SDK, build: 3.4.0.v20140922135716
    acs@1.0.16
    alloy 1.5.0-rc2
    install@0.1.7
    npm@1.4.23
    sudo@1.0.3
    titanium 3.4.0-rc4
    titanium-code-processor@1.1.1
    Xcode6.0.1 (6A317)
    Devices:
    iPhone6 iOS 8
    iPhone6+ iOS8
    
    Closing as fixed.
    </li>
</ol>


<p><a href="/TIMOB/TIMOB-17665.json">JSON Source</a></p>