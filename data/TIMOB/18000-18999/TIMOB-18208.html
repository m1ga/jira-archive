---
title: "[TIMOB-18208] Writing a plugin that links to JavaScriptCore.framework produces a naming clash"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-02-18T18:03:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>appstore</td></tr>
<tr><th>Reporter</th><td>Peter Steinberger</td></tr>
<tr><th>Assignee</th><td>Jon Alter</td></tr>
<tr><th>Created</th><td>2014-12-14T15:31:49.000+0000</td></tr>
<tr><th>Updated</th><td>2015-03-26T20:08:58.000+0000</td></tr>
</table>

<h3>Description</h3>

The Titanium framework uses a custom version of JavaScriptCore. If an app links to Apple's JavaScriptCore.framework that was introduce in iOS 7, Apple's App Store validator fails because it detects calls to WTFReportBacktrace and WTFReportFatalError which both are referenced inside libTiCore.a.

Attached various disassembly that shows the calls.

Apple most likely created a special rule so existing Titanium projects are not automatically rejected, but disables that rule if newer frameworks such as JavaScriptCore are used. Now we have an experimental version of our PSPDFKit plugin that works in the App Store, but we really need JSCore to have all of our features - we don't want to provide our customers with a crippled version just because of a naming clash in the Titanium framework.

The proper solution here would be to rename/prefix the internal Webkit-methods.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53948/com.example.test-iphone-1.0.0.zip">com.example.test-iphone-1.0.0.zip</td></td><td>2015-02-02T21:45:37.000+0000</td><td>213872</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53949/Screen Shot 2015-01-26 at 1.45.35 PM.png">Screen Shot 2015-01-26 at 1.45.35 PM.png</td></td><td>2015-02-02T21:49:08.000+0000</td><td>73138</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53199/unnamed.png">unnamed.png</td></td><td>2014-12-14T15:31:49.000+0000</td><td>57773</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53200/unnamed-3.png">unnamed-3.png</td></td><td>2014-12-14T15:31:49.000+0000</td><td>304670</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53201/unnamed-4.png">unnamed-4.png</td></td><td>2014-12-14T15:31:49.000+0000</td><td>774649</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53202/unnamed-5.png">unnamed-5.png</td></td><td>2014-12-14T15:31:49.000+0000</td><td>203553</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-18208_53203/unnamed-6.png">unnamed-6.png</td></td><td>2014-12-14T15:31:49.000+0000</td><td>717986</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ingo Muschenetz 2014-12-16

   [~steipete] You had mentioned you "surgically remov[ed] all parts that interact with Apples JavaScriptCore framework." Could you elaborate a bit on how you did that? Also, to confirm, you _can't_ use the version of JSCore that we ship--you need to use Apple's version? </li>
<li>Peter Steinberger 2014-12-16

   Thanks for looking into this.
   
   For the current workaround I added <code>#if !defined(PSPDF_SKIP_JSCORE) || !PSPDF_SKIP_JSCORE</code> around all headers/implementations that access code interacting with JavaScriptCore, built a custom binary and then linked that binary to our Titanium Plugin (<a href="https://github.com/PSPDFKit/PSPDFKit-Titanium)" rel="nofollow" target="_blank">https://github.com/PSPDFKit/PSPDFKit-Titanium)</a>
   
   We have a closed source framework and an open source Titanium Plugin that uses this closed source binary. Using the Titanium JavaScriptCore would be really hard, we would need to change the structure and built a separate binary that links to Appcelerator's JSCore (and giving up the open source plugin). That wouldn't be a feasible solution. 
   
   Also, your version most likely differs from Apple's version, creating a whole new set of Titanium-specific bugs or different behaviors.</li>
<li>Ingo Muschenetz 2014-12-16

   Hi Peter, we are using in 3.5.0 the tagged version 538.11.1 directly from the WebKit repo (the 3.4.1 version is an earlier version). Either way, there should not be any Titanium-specific bugs.
   
   However, I do see how you would be reluctant to build a Titanium-specific version because it would alter your build process. Are you using the Objective C or C-based API to JSCore?</li>
<li>Peter Steinberger 2014-12-16

   We're using the Objective-C based API. Our main focus is on the PSPDFKit binary, which has no reference to Titanium. People take that closed source binary and use it to build our Titanium wrapper.
   
   Using your JSCore version would mean adding conditionals; a new set of tests; adding two more sets of binaries (since we already have a version with OpenSSL and one without; so now we'd have 4 different combinations). That's not feasible; if we have to choose we'd probably phase out Titanium support then (but I'd rather see this fixed in your platform - we won't be the last who will have a huge code base using all kind of frameworks including JavaScriptCore + a tiny wrapper to make it usable in Titanium.)
   
   What would be the downsides if you renaming the two symbols in question?</li>
<li>Peter Steinberger 2015-01-23

   I noticed you started working on this - what direction are you going with fixing this?
   As we're working on our 4.2 release this would be good to know (including a time frame for the fix)</li>
<li>Ingo Muschenetz 2015-01-27

   For the first version we are planning on doing additional name mangling. It may be that for the very first release we have a drop-in replacement for our for TiCore that affected customers can use.
   
   Longer-term we plan on allowing for the usage of the built-in JSCore which would eliminate that.</li>
<li>Jon Alter 2015-02-02

   PRs
   TiJSCore: <a href="https://github.com/appcelerator/tijscore/pull/28" rel="nofollow" target="_blank">https://github.com/appcelerator/tijscore/pull/28</a>
   tidebugger: <a href="https://github.com/appcelerator/titanium_debugger/pull/30" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_debugger/pull/30</a>
   titanium_mobile (updating debugger lib)(master): <a href="https://github.com/appcelerator/titanium_mobile/pull/6613" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6613</a>
   Need to update the built TiJSCore lib once these are merged </li>
<li>Jon Alter 2015-02-02

   <h4>Updating Your SDK</h4>
   TiSDK 3.5.0.GA can be updated to include this fix by downloading and updating the [libTiCore.a](<a href="https://dl.dropboxusercontent.com/u/7540194/TitaniumLibs/libTiCore.a)" rel="nofollow" target="_blank">https://dl.dropboxusercontent.com/u/7540194/TitaniumLibs/libTiCore.a)</a> and [libti_ios_debugger.a](<a href="https://dl.dropboxusercontent.com/u/7540194/TitaniumLibs/libti_ios_debugger.a)" rel="nofollow" target="_blank">https://dl.dropboxusercontent.com/u/7540194/TitaniumLibs/libti_ios_debugger.a)</a> libraries.
   Once downloaded, place these libraries in the *iphone* folder of your titanium sdk (overwriting the old libraries).
   
   <h4>Testing instructions </h4>
   These steps are to be done after updating the titanium mobile sdk via the instructions above.
   1. download and install the attached module "com.example.test-iphone-1.0.0.zip"
   2. Create an app and include the module that you just installed in the tiapp.xml
   3. Package the app for production
   4. In the Xcode Organizer validate the app
   5. The validation should pass
   
   When the same process is followed before the update, the following error was displayed when validating the app.
   !Screen Shot 2015-01-26 at 1.45.35 PM.png!</li>
<li>Ingo Muschenetz 2015-02-02

   [~steipete] Would you be able to try updating your SDK as [~jalter] mentions and see if that addresses the issue?</li>
<li>Pedro Enrique 2015-02-13

    New PR agains titanium_mobile master <a href="https://github.com/appcelerator/titanium_mobile/pull/6642" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6642</a></li>
<li>Ewan Harris 2015-03-26

    Verified fix using:
    
    Mac OSX 10.10.2
    Titanium SDK build: 4.0.0.v20150325201813
    Titanium CLI, build: 4.0.0-alpha
    Alloy: 1.6.0-alpha
    Xcode 6.2
    
    
    Created a new app added the module and then packaged in Xcode, no errors were given when packaging.
    
    Closing ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-18208.json">JSON Source</a></p>