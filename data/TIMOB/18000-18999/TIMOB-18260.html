---
title: "[TIMOB-18260] iOS: Removing a ListView while SearchBar has focus results in crash"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-12-19T07:56:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.4.1, Release 3.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.5.0, Release 4.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>listview, popover, qe-3.5.0, searchbar</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Vishal Duggal</td></tr>
<tr><th>Created</th><td>2014-12-18T10:41:30.000+0000</td></tr>
<tr><th>Updated</th><td>2015-08-10T21:55:04.000+0000</td></tr>
</table>

<h3>Description</h3>

A popover that has a SearchBar attached to a ListView will crash if it hides will the SearchBar still has focus.

Same goes for when the ListView is removed from its parent view while the SearchBar has focus, so that seems to be the actual problem.

The crashlog is attached.

<h4>Test case #1</h4>

1. Install an app with the following code on an iPad (crashes on iOS Simulator as well, but doesn't show crashlog)
2. Tap the button
3. Tap the searchbar to focus
4. Tap outside the popover to hide it
5. App crashes after a second or so

<code><pre>
var w = Ti.UI.createWindow({
  backgroundColor: 'white'
});

var b = Ti.UI.createButton({
  title: 'Click'
});

b.addEventListener('click', function() {

  var cw = Ti.UI.createWindow({
    width: 300,
    height: 300
  });

  var lv = Ti.UI.createListView({
    searchView: Ti.UI.createSearchBar()
  });

  cw.add(lv);

  var p = Ti.UI.iPad.createPopover({
    width: 300,
    height: 300,
    contentView: cw
  });

  p.show({
    view: b
  });

});

w.add(b);
w.open();
</pre></code>

<h4>Test case #2</h4>

1. Install an app with the following code on an iOS device (crashes on iOS Simulator as well, but doesn't show crashlog)
2. Tap the searchbar to focus
3. Tap the button to remove the ListView
4. App crashes after a second or so

<code><pre>
var w = Ti.UI.createWindow({
  backgroundColor: 'white'
});

var lv = Ti.UI.createListView({
  top: 100,
  searchView: Ti.UI.createSearchBar()
});

var b = Ti.UI.createButton({
  top: 30,
  title: 'Click me after focussing on search field'
});

b.addEventListener('click', function() {
  w.remove(lv);
});

w.add(b);
w.add(lv);

w.open();
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-18260_53290/popsearch.crash">popsearch.crash</td></td><td>2014-12-18T10:41:30.000+0000</td><td>40547</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Vishal Duggal 2014-12-19

   Combined test case
   <code><pre>
   var win = Ti.UI.createWindow({
     backgroundColor: 'white'
   });
   var navWin = Titanium.UI.iOS.createNavigationWindow({
      window: win
   });
   var b1 = Ti.UI.createButton({title:'TEST1', top:60});
   win.add(b1);
   b1.addEventListener('click',function(){
       var w = Ti.UI.createWindow({backgroundColor:'white'})
       var lv = Ti.UI.createListView({
         top: 100,
         searchView: Ti.UI.createSearchBar()
       });
       var b = Ti.UI.createButton({
         top: 30,
         title: 'Click me after focussing on search field'
       });
       b.addEventListener('click', function() {
         w.remove(lv);
       });
       w.add(b);
       w.add(lv);
       navWin.openWindow(w, {animated:true});
   });
   if(Ti.Platform.osname == 'ipad'){
       var b2 = Ti.UI.createButton({title:'TEST2', top:120});
       win.add(b2);
       b2.addEventListener('click',function(){
           var w = Ti.UI.createWindow({
             backgroundColor: 'white'
           });
           var b = Ti.UI.createButton({
             title: 'Click'
           });
           b.addEventListener('click', function() {
             var cw = Ti.UI.createWindow({
               width: 300,
               height: 300
             });
             var lv = Ti.UI.createListView({
               searchView: Ti.UI.createSearchBar()
             });
             cw.add(lv);
             var p = Ti.UI.iPad.createPopover({
               width: 300,
               height: 300,
               contentView: cw
             });
             p.show({
               view: b
             });
           });
           w.add(b);
           navWin.openWindow(w, {animated:true});
       });
   }
   navWin.open();
   </pre></code></li>
<li>Vishal Duggal 2014-12-19

   Pulls pending
   master - <a href="https://github.com/appcelerator/titanium_mobile/pull/6513" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6513</a>
   3_5_X - <a href="https://github.com/appcelerator/titanium_mobile/pull/6514" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6514</a></li>
<li>Ingo Muschenetz 2014-12-19

   Please review this one.</li>
<li>Chee Kiat Ng 2014-12-19

   CR and FT passed. Merged PRs.</li>
<li>Fokke Zandbergen 2014-12-19

   Thanks for the super quick fix guys.
   
   Just patched my 3.5.0.Beta and it works indeed.</li>
<li>Eric Wieber 2014-12-30

   Verified fixed using:
   
   Titanium SDK 3.5.0.v20141222103320
   Studio 3.4.1.201410281743 
   Xcode 6.1.1
   
   On: 
   iPad mini, iOS 8.1
   iPhone 6, iOS 8.2b3
   iPhone 4S Sim, iOS 8.1</li>
<li>Fokke Zandbergen 2015-01-08

   [~ingo] [~ewieber] I can still reproduce it with the code following and the next steps/environment
   
   1. Tap the button to open the popover
   2. Tap the searchbar and enter "odd"
   3. Hide the soft keyboard using the dedicated button on the soft keyboard
   4. App crashes
   
   Titanium SDK 3.5.0.v20141222103320
   CLI 3.4.1
   Xcode 6.1.1
   iPad MD788NF/A (Air), iOS 8.1.2
   
   I've found that it only happens if the number of items filtered is less then needed to fill the few height of the listview. If you increase the number of items to 50 you won't be able to replicate.
   
   <code><pre>
   var w = Ti.UI.createWindow({
     backgroundColor: 'white'
   });
   
   var b = Ti.UI.createButton({
     title: 'Click Me'
   });
   
   b.addEventListener('click', function() {
   
     var cw = Ti.UI.createWindow({
       width: 300
     });
   
     var items = [];
   
     for (var i = 1, oe; i &lt;= 20; i++) {
       oe = (i % 2 === 0) ? 'even' : 'odd';
       items.push({
         properties: {
           title: 'Row #' + i + ' (' + oe + ')',
           searchableText: oe
         }
       });
     }
   
     var lv = Ti.UI.createListView({
       searchView: Ti.UI.createSearchBar(),
       sections: [Ti.UI.createListSection({
         items: items
       })]
     });
   
     cw.add(lv);
   
     var p = Ti.UI.iPad.createPopover({
       contentView: cw
     });
   
     p.show({
       view: b
     });
   });
   
   w.add(b);
   w.open();
   </pre></code></li>
<li>Fokke Zandbergen 2015-01-08

   Don't know what happend to the code above. Here it is:
   
   <code><pre>
   var w = Ti.UI.createWindow({
     backgroundColor: 'white'
   });
   
   var b = Ti.UI.createButton({
     title: 'Click Me'
   });
   
   b.addEventListener('click', function() {
   
     var cw = Ti.UI.createWindow({
       width: 300
     });
   
     var items = [];
   
     for (var i = 1, oe; i &lt;= 20; i++) {
       oe = (i % 2 === 0) ? 'even' : 'odd';
       items.push({
         properties: {
           title: 'Row #' + i + ' (' + oe + ')',
           searchableText: oe
         }
       });
     }
   
     var lv = Ti.UI.createListView({
       searchView: Ti.UI.createSearchBar(),
       sections: [Ti.UI.createListSection({
         items: items
       })]
     });
   
     cw.add(lv);
   
     var p = Ti.UI.iPad.createPopover({
       contentView: cw
     });
   
     p.show({
       view: b
     });
   });
   
   w.add(b);
   w.open();
   </pre></code></li>
<li>Fokke Zandbergen 2015-01-08

   Ah... shows OK after refresh.</li>
<li>Eric Wieber 2015-01-08

    </li>
</ol>


<p><a href="/TIMOB/TIMOB-18260.json">JSON Source</a></p>