---
title: "[TIMOB-18624] iOS Map Kit pinchangedragstate Event not firing after enabling Test services"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2015-11-09T19:20:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Eduardo Gomez</td></tr>
<tr><th>Assignee</th><td>Chee Kiat Ng</td></tr>
<tr><th>Created</th><td>2015-02-27T17:15:43.000+0000</td></tr>
<tr><th>Updated</th><td>2015-11-09T19:20:24.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue Description</h4>
Using pins on a map (Ti.Map) an event wired up to the PinChangeDragState event. When we enable either the test service or the performance services built in to Appcelerator Studio, the event no longer fires. If the client disables those services, the event fires again as expected. 

<h4>Expected Behaviour</h4>
pinchangedragstate - event fires when the pin's drag state changes 

<h4>Actual Behaviour</h4>
pinchangedragstate - event no longer fires

<h4>Module Combos </h4>
From our tests these are the different outcomes when Services were enabled:
- With APM/SOASTA event not fired
- With SOASTA events not fired
- With APM event is fired

<h4>Sample Code</h4>
As example, get following map code to interact with it and notice outputs information to the console when each event fires:
<a href="http://docs.appcelerator.com/titanium/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/titanium/latest/#</a>!/guide/iOS_Map_Kit-section-37540542_iOSMapKit-EventHandling

<code><pre>

var win = Titanium.UI.createWindow({
	backgroundColor : 'white',
	layout : "vertical"
});

var MapModule = require('ti.map');

var mapContainer = Titanium.UI.createView({
	top : 5,
	width : Ti.UI.FILL,
	height : Ti.UI.FILL
});
var appc = MapModule.createAnnotation({
	latitude : 37.389569,
	longitude : -122.050212,
	title : 'Appcelerator HQ',
	subtitle : 'Mountain View, CA',
	pincolor : MapModule.ANNOTATION_GREEN,
	draggable : true
});
var mapview = MapModule.createView({
	mapType : MapModule.HYBRID_TYPE,
	region : {
		latitude : 37.389569,
		longitude : -122.050212,
		latitudeDelta : 0.2,
		longitudeDelta : 0.2
	},
	annotations : [appc]
});
mapview.addEventListener('pinchangedragstate', function(e) {
	Ti.API.info(e.type);
	var state = '';
	switch (e.newState) {
	case MapModule.ANNOTATION_DRAG_STATE_END:
		state = "ANNOTATION_DRAG_STATE_END";
		break;
	case MapModule.ANNOTATION_DRAG_STATE_START:
		state = "ANNOTATION_DRAG_STATE_START";
		break;
	default :
		state = "unknown state: " + e.newState;
		break;
	}
	Ti.API.info(JSON.stringify(state));
	Ti.API.info(JSON.stringify(e.newState));
});
mapview.addEventListener('click', function(e) {
	Ti.API.info(e.type);
	Ti.API.info(JSON.stringify(e.clicksource));
});
mapview.addEventListener('regionchanged', function(e) {
	Ti.API.info(e.type);
	Ti.API.info(e.latitude + "," + e.longitude);
});

mapContainer.add(mapview);
win.add(mapContainer);

win.open();
</pre></code>

<h4>App running with no services</h4>
<code><pre>
[INFO] :   click
[INFO] :   "pin"
[INFO] :   complete
[INFO] :   click
[INFO] :   null
[INFO] :   pinchangedragstate
[INFO] :   "ANNOTATION_DRAG_STATE_START"
[INFO] :   pinchangedragstate
[INFO] :   "unknown state: 2"
[INFO] :   pinchangedragstate
[INFO] :   "ANNOTATION_DRAG_STATE_END"
[INFO] :   pinchangedragstate
[INFO] :   "unknown state: 0"
[INFO] :   click
[INFO] :   "pin"
</pre></code>

<h4>This is soasta/apm</h4>
<code><pre>
[INFO] :   regionchanged
[INFO] :   37.38956832885742,-122.05020904541016
[INFO] :   complete
[INFO] :   complete
[INFO] :   complete
[INFO] :   complete
[INFO] :   complete
[INFO] :   click
[INFO] :   "pin"
[INFO] :   click
[INFO] :   null
[INFO] :   click
[INFO] :   "pin"
</pre></code>


<h3>Comments</h3>

<ol>
<li>Eduardo Gomez 2015-02-27

   <h4>SOASTA CSM Request #1455</h4>
   iOS Map Kit pinchangedragstate Event not firing after enabling Test services
   <a href="https://soasta.zendesk.com/requests/1455" rel="nofollow" target="_blank">https://soasta.zendesk.com/requests/1455</a></li>
<li>Hans Kn√∂chel 2015-11-09

   [~egomez]: We fixed some drag and drop issues on Ti.Map a few months ago, can you verify that?</li>
<li>Eduardo Gomez 2015-11-09

   [~hansknoechel] I have not had any issues lately thus this should not be an issue anymore. Assuming SOASTA version affected the Ti.Map events that does not seem to occur with latest either. Feel free to resolve as applicable. Thanks for the heads up. </li>
</ol>


<p><a href="/TIMOB/TIMOB-18624.json">JSON Source</a></p>