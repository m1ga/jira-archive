---
title: "[TIMOB-18724] Windows::HTTPClient crashes on firing onreadystatechange after being GCed"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-03-25T09:58:42.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2015-03-20T15:01:56.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-16T22:25:21.000+0000</td></tr>
</table>

<h3>Description</h3>

When running the mocha tests, I'm seeing some bad behavior from HTTPclient. We fire off requests in tests and continue on and eventually in a a later test (typically the layout suite) we'll get an error stemming from the HTTPClient firing an onreadystatechange callback:

<code><pre>
Unhandled exception at 0x6B83D4C6 (HAL.dll) in NMocha.exe: 0xC0000005: Access violation reading location 0xDDDDDDDD.
</pre></code>

It's in HTTPClient::onreadystatechange in Titaniumkit, where it's testing if the callback is a function. The issue is likely because we've long moved on from the test where the httpclient was generated - I'm thinking maybe it was GCed and we didn't properly cancel and clean up in our destructor.

The request was continuing in an async chain. My best guess is that we need to cancel all outstanding requests when the Windows impl desturctor hits, and null out the callback objects up in the TitaniumKit destructor?

<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2015-03-23

   <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/181" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/181</a></li>
<li>Christopher Williams 2015-03-23

   Still seeing this locally when running the full mocha tests suite.</li>
<li>Lee Morris 2017-03-16

   Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-18724.json">JSON Source</a></p>