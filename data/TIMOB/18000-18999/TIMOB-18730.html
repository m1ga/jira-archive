---
title: "[TIMOB-18730] iOS8: DocumentViewer: Unbalanced calls to begin/end appearance transitions for QLRemotePreviewContentController"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-05-14T17:38:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.0.0, Release 4.1.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>triage</td></tr>
<tr><th>Reporter</th><td>Eduardo Gomez</td></tr>
<tr><th>Assignee</th><td>Vishal Duggal</td></tr>
<tr><th>Created</th><td>2015-03-23T22:18:06.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-16T21:49:25.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue Description</h4>
We get the following message when loading a pdf in the DocumentViewer component: "Unbalanced calls to begin/end appearance transitions for <QLRemotePreviewContentController: 0x173d4e00>". Getting this message is sometimes associated with the app freezing but generally app goes okay anyway. 

<h4>Sample Code</h4>
<code><pre>
var doc = "<a href="http://www.legis.state.ak.us/basis/iphonepages/IPV3get_documents.asp?session=29&docid=3324&minname=Agenda%5FLBA%5F17Mar15%5FLocation+Change%2Epdf" rel="nofollow" target="_blank">http://www.legis.state.ak.us/basis/iphonepages/IPV3get_documents.asp?session=29&docid=3324&minname=Agenda%5FLBA%5F17Mar15%5FLocation+Change%2Epdf</a>";
var win = Ti.UI.createWindow();
win.open();
var file = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, 'document.pdf'),
    client = Ti.Network.createHTTPClient({
	onload : function() {
		// Open a doc viewer.
		var docViewer = Ti.UI.iOS.createDocumentViewer({
			url : file.nativePath
		});
		docViewer.show({
			animated : true
		});
	},
	onerror : function(e) {
		alert('Error: ' + e);
	}
});
client.open('GET', doc);
client.file = file;
client.send(); 
</pre></code>

<h4>Console Output</h4>
<code><pre>
-- Start simulator log -------------------------------------------------------
[INFO]  Application started
[DEBUG] Reading stylesheet from: /Users/egomez/Library/Developer/CoreSimulator/Devices/D2DD3F81-EDBF-4C3B-A975-A41501FF3702/data/Containers/Bundle/Application/AE4C1686-4155-44A9-A3F5-AF463281A0F4/TableViewRepro.app/stylesheet.plist
[DEBUG] 2015-03-23 16:01:38.614 TableViewRepro[10909:330239] You've implemented -[<UIApplicationDelegate> application:performFetchWithCompletionHandler:], but you still need to add "fetch" to the list of your supported UIBackgroundModes in your Info.plist.
[DEBUG] 2015-03-23 16:01:38.615 TableViewRepro[10909:330239] You've implemented -[<UIApplicationDelegate> application:didReceiveRemoteNotification:fetchCompletionHandler:], but you still need to add "remote-notification" to the list of your supported UIBackgroundModes in your Info.plist.
[INFO]  TableViewRepro/1.0 (4.0.0.944c821)
[DEBUG] Loading: /Users/egomez/Library/Developer/CoreSimulator/Devices/D2DD3F81-EDBF-4C3B-A975-A41501FF3702/data/Containers/Bundle/Application/AE4C1686-4155-44A9-A3F5-AF463281A0F4/TableViewRepro.app/app.js, Resource: app_js
[DEBUG] Application booted in 415.318012 ms
[DEBUG] 2015-03-23 16:01:40.414 TableViewRepro[10909:330239] Unbalanced calls to begin/end appearance transitions for <QLRemotePreviewContentController: 0x7fe105059000>.
</pre></code>

<h3>Comments</h3>

<ol>
<li>Sebastian Klaus 2015-04-23

   I'm geting this error too on iPhone 6 with 8.3 and SDK 3.5.1.GA
   
   Opening a PDF works random. And sometimes it crashes with this error.
   
   Hope, this will be fixed soon.</li>
<li>Vishal Duggal 2015-05-12

   This might very much be an Apple bug.
   Essentially the View controller that is presenting the Document Viewer is in the process of disappearing while the preview is coming up. This is root cause of the warning about Unbalanced calls to begin/end appearance transitions. Not much we can do about it.
   
   Unrelated to this there are a couple of bugs in the Document Viewer. Test case here
   <code><pre>
   var doc = "<a href="http://www.legis.state.ak.us/basis/iphonepages/IPV3get_documents.asp?session=29&docid=3324&minname=Agenda%5FLBA%5F17Mar15%5FLocation+Change%2Epdf" rel="nofollow" target="_blank">http://www.legis.state.ak.us/basis/iphonepages/IPV3get_documents.asp?session=29&docid=3324&minname=Agenda%5FLBA%5F17Mar15%5FLocation+Change%2Epdf</a>";
   var win = Ti.UI.createWindow({backgroundColor:'blue'});
   var win2 = Ti.UI.createWindow({backgroundColor:'yellow'});
   var file = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, 'document.pdf');
   
   var client = Ti.Network.createHTTPClient({
   	onload : function() {
   		// Open a doc viewer.
   		var docViewer = Ti.UI.iOS.createDocumentViewer({
   			url : file.nativePath
   		});
   		docViewer.show({
   			animated : true
   		});
   	},
   	onerror : function(e) {
   		alert('Error: ' + e);
   	}
   });
   
   var presentViewer = true;
   
   function presentDocument(){
   	if(presentViewer) {
   		presentViewer = false;
   		client.open('GET', doc);
   		client.file = file;
   		client.send(); 
   	} else {
   		win2.close();
   	}
   }
   
   win2.addEventListener('focus',function(){
   	presentDocument();
   })
   
   win.addEventListener('focus',function(){
   	if(presentViewer) {
   		win2.open({modal:true});
   	}
   });
   win.open();
   </pre></code>  </li>
<li>Vishal Duggal 2015-05-12

   Pulls pending
   master - <a href="https://github.com/appcelerator/titanium_mobile/pull/6839" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6839</a>
   4_0_X - <a href="https://github.com/appcelerator/titanium_mobile/pull/6840" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6840</a></li>
<li>Sebastian Klaus 2015-05-12

   I solved it with a timeout of 300 ms</li>
<li>Lee Morris 2017-03-16

   Closing ticket as the issue has been fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-18730.json">JSON Source</a></p>