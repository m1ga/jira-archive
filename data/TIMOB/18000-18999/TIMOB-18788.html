---
title: "[TIMOB-18788] Android: evalJS(\"document.height\") returns undefined on Android 4.4.4"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Not Our Bug</td></tr>
<tr><th>Resolution Date</th><td>2015-06-16T02:15:13.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.5.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, evaljs, webview</td></tr>
<tr><th>Reporter</th><td>David IAV</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2014-07-22T12:09:10.000+0000</td></tr>
<tr><th>Updated</th><td>2015-06-19T22:10:55.000+0000</td></tr>
</table>

<h3>Description</h3>

Quering a webview to get the height of the content using webview.evalJS("document.height") works fine on Android 4.4.2 (tested on HTC One) and lower devices, but Android 4.4.4 devices (tested on the Nexus 5 and 7) returns undefined instead of the height of the content. Sample code:

{noformat}
body.addEventListener('load', function(e) {
	var h = body.evalJS("document.height");
	Ti.API.info("Content height: " + h); // returns height on  < 4.4.2, undefined on 4.4.4
}
{noformat}


<h3>Comments</h3>

<ol>
<li>Shuo Liang 2014-08-01

   Ok. No problem.
   
   Test case is following:
   
   <code><pre>
   var win = Ti.UI.createWindow();
   
   var webview = Ti.UI.createWebView({
       url: '<a href="http://www.google.com" rel="nofollow" target="_blank">http://www.google.com</a>'
   });
   win.add(webview);
    
   webview.addEventListener('load',function(e) {
       var l = webview.evalJS("document.height"); 
       Ti.API.info("Context Length " + l);
   });
   
   win.open();
   </pre></code></li>
<li>Kai De Sutter 2014-11-17

   Hi,
   
   I had the very same issue, but as a fix, instead of relying on document.height I now use the following which seems to work perfectly:
   <code><pre>
   var _height = _html_view.evalJS("Math.max(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight);");
   Hope this helps!
   </pre></code>
   Kai</li>
<li>Ashraf Abu 2015-06-11

   I think [~kaiiserni] is correct.
   
   I'm just looking around and it seems like for Mozilla [<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/height" rel="nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/Document/height</a>] which is following the HTML5 specification standard:
   {quote}
   Note: Starting in Gecko 6.0, document.height is no longer supported. Instead use document.body.clientHeight. See element.clientHeight.
   {quote}
   And for Android, [<a href="https://developer.android.com/guide/webapps/migrating.html" rel="nofollow" target="_blank">https://developer.android.com/guide/webapps/migrating.html</a>] the WebView was changed on Android 4.4 onwards to Chromium. This is possibly why this behavior changed from Android 4.4.4 onwards.
   {quote}
   This change upgrades WebView performance and standards support for HTML5, CSS3, and JavaScript to match the latest web browsers
   {quote}
   
   Therefore, I believe the best answer would be [~kaiiserni]'s answer (thanks for your comment!), which is to use:
   <code><pre>
   var _height = _html_view.evalJS("Math.max(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight);");
   </pre></code>
   
   You shouldn't be using 'document.height'.
   
   I believe this should be the answer and the ticket can be resolved as Invalid.
   
   [~mrahman] Would this be okay for you?</li>
<li>Ashraf Abu 2015-06-15

   If there's nothing else, I'll close this ticket tomorrow.</li>
</ol>


<p><a href="/TIMOB/TIMOB-18788.json">JSON Source</a></p>