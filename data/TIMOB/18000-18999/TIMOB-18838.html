---
title: "[TIMOB-18838] ACS Photo uploads fail with 500 error"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-05-08T18:27:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 4.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.0.0, Release 4.1.0</td></tr>
<tr><th>Components</th><td>TiAPI</td></tr>
<tr><th>Labels</th><td>acs, photo, regression, upload</td></tr>
<tr><th>Reporter</th><td>Sebastian Klaus</td></tr>
<tr><th>Assignee</th><td>Vishal Duggal</td></tr>
<tr><th>Created</th><td>2015-04-15T12:52:01.000+0000</td></tr>
<tr><th>Updated</th><td>2015-05-16T18:42:16.000+0000</td></tr>
</table>

<h3>Description</h3>

Photos returned a 500

<code><pre>
[INFO] [iphone, 8.1, undefined] {
    "success": false,
    "error": true,
    "code": 500,
    "message": "Internal server error. The Appcelerator Cloud Services Team has just been notified of this problem."
}
</pre></code>

Please have a look at it.

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2015-04-15

   Could you include the parameters/URL used for this return to happen? And does it always reproduce?
   
   CC [~mgadiya]</li>
<li>Sebastian Klaus 2015-04-15

   I can confirm, that this only happens compiled with 4.0.0.Beta2. SDK 3.5.1.GA works as expected.
   
   This ist my code:
   
   <code><pre>
   Cloud.onsendstream = function (e) {
       progressBar.value = e.progress;
   };
   
   Cloud.Photos.create({
       photo: image,
       'photo_sync_sizes[]': 'square_75',
       'photo_sync_sizes[]': 'small_240',
       'photo_sync_sizes[]': 'medium_500'
   }, function (e) {
       Cloud.onsendstream = Cloud.ondatastream = null;
       Ti.App.indicator.hide();
       if (e.success) {
           var photo = e.photos[0];
           self.fireEvent('upload.image.success', {
               url: photo.urls.original
           });
       } else {
           console.log(e);
           self.fireEvent('upload.image.error', {});
       }
   });
   </pre></code>
   
   Working environment:
   <code><pre>
   Operating System
     Name                        = Mac OS X
     Version                     = 10.10.3
     Architecture                = 64bit
     # CPUs                      = 8
     Memory                      = 17179869184
   
   Node.js
     Node.js Version             = 0.10.38
     npm Version                 = 1.4.28
   
   Titanium CLI
     CLI Version                 = 3.4.2
   
   Titanium SDK
     SDK Version                 = 3.5.1.GA
     SDK Path                    = /Volumes/Data/Users/sebastian/Library/Application Support/Titanium/mobilesdk/osx/3.5.1.GA
     Target Platform             = iphone
   </pre></code>
   
   Using latest ti.cloud 3.2.8</li>
<li>Sebastian Klaus 2015-04-16

   [~fokkezb] can you reproduce this?</li>
<li>Fokke Zandbergen 2015-04-16

   I will let that up to [~rtlechuga] if you don't mind ;)</li>
<li>Sebastian Klaus 2015-04-16

   Of course :-)
   Thank you</li>
<li>Shuo Liang 2015-04-17

   Problem can be reproduced on SDK 4.0.0 Bate2, and works well on SDK 3.5.1 as customer mentioned.
   
   Test Case:
   <code><pre>
   var win = Ti.UI.createWindow({
   	backgroundColor:"white"
   });
   
   var Cloud = require("ti.cloud");
   
   Cloud.Users.login({
       login: &lt;email&gt;,
       password: &lt;password&gt;
   }, function (e) {
       if (e.success) {
           var user = e.users[0];
           Ti.API.info('Success:\n' +
               'id: ' + user.id + '\n' +
               'sessionId: ' + Cloud.sessionId + '\n' +
               'first name: ' + user.first_name + '\n' +
               'last name: ' + user.last_name);
           upload();
       } else {
           alert('Error:\n' +
               ((e.error && e.message) || JSON.stringify(e)));
       }
   });
   
   function upload(e) {
   	Cloud.Photos.create({
       	photo: Titanium.Filesystem.getFile('1.jpg')
   	}, function (e) {
       	if (e.success) {
           	var photo = e.photos[0];
           	Ti.API.info('Success:\n' +
               	'id: ' + photo.id + '\n' +
               	'filename: ' + photo.filename + '\n' +
               	'size: ' + photo.size,
               	'updated_at: ' + photo.updated_at);
       	} else {
           	Ti.API.info('Error:\n' + JSON.stringify(e));
       	}
   	});
   }
   
   
   win.open();
   </pre></code>
   
   Also I tried Curl command with REST API, It works well.
   <code><pre>
   Appc-MBP:~ shuoliang$ curl -b cookies.txt -c cookies.txt  -F "file=@1.jpg" "<a href="https://api.cloud.appcelerator.com/v1/photos/create.json?ey=8uupo7jRs0vwJP6qCDPvzckmmtNNnZE3&pretty_json=true" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/photos/create.json?ey=8uupo7jRs0vwJP6qCDPvzckmmtNNnZE3&pretty_json=true</a>"
   {
     "meta": {
       "code": 200,
       "status": "ok",
       "method_name": "createPhoto"
     },
     "response": {
       "photos": [
         {
           "id": "55305d95da00eeadda00094c",
           "filename": "1.jpg",
           "size": 75005,
           "md5": "d30e5da6d6aef073e7b06b980f40090c",
           "created_at": "2015-04-17T01:10:45+0000",
           "updated_at": "2015-04-17T01:10:45+0000",
           "processed": false,
           "content_type": "image/jpeg",
           "user_id": "55305794442599bbd8c525cc"
         }
       ]
     }
   }
   </pre></code>
   
   So I believe this is the problem from SDK. </li>
<li>Sebastian Klaus 2015-04-18

   Any news for that? I think this is really urgent for all developer who are using ACS</li>
<li>Ingo Muschenetz 2015-04-18

   Thank you for the bump. We will fix.</li>
<li>Eric Wieber 2015-05-07

   I am able to reproduce this today, using:
   
   MacOS 10.10.3
   Studio 4.0.0.201505070727
   Ti SDK 4.0.0.v20150507131012
   Appc NPM 0.3.55
   Appc CLI 0.2.280
   Ti CLI 4.0.0-beta8
   Alloy 1.6.0-beta4
   Node v0.10.37</li>
<li>Mukesh Gadiya 2015-05-07

    [~wkong] , [~ewieber] ran into similar problem and I looked up the logs on api node and this is showed up:
    
    <code><pre>
    Started POST "/v1/photos/create.json?key=nLu8hACXPzfMdRPDBNP23ENDkfcqiqZ4&_session_id=PSx4ZylgHMBwO7ZI4_9ZzLLN_-Y" for 38.110.144.252 at 2015-05-07 21:24:20 +0000
    MONGODB (0.9ms) acs_api['action_dispatch_session_mongoid_store_sessions'].find({:_id=&gt;"PSx4ZylgHMBwO7ZI4_9ZzLLN_-Y"}).limit(-1)
    
    NoMethodError (undefined method <code>rewind' for #&lt;String:0x0000000b8a3198&gt;):
      config/initializers/SessionCookieMiddelware.rb:52:in </code>call'
    
    </pre></code>
    
    I think we may have possible ACS issue here. </li>
<li>Alex Bernier 2015-05-08

    I'm seeing this issue uploading photos to a destination other than ACS, only in the 4.0.0.x Ti SDK on iOS. Works on Android. I don't think this is an ACS issue. Looking into it more now. First error I see is:
    
    <code><pre>
    Error when matching URL mapping [/(*)/(*)?/(*)?(.(*))?]:Invalid media type "charset="utf-8"": does not contain '/'
    </pre></code></li>
<li>Vishal Duggal 2015-05-08

    Pulls pending
    
    APSHTTPClient - <a href="https://github.com/appcelerator/APSHTTPClient/pull/24" rel="nofollow" target="_blank">https://github.com/appcelerator/APSHTTPClient/pull/24</a>
    
    Titanium Mobile
    master - <a href="https://github.com/appcelerator/titanium_mobile/pull/6828" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6828</a>
    4_0_X - <a href="https://github.com/appcelerator/titanium_mobile/pull/6829" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6829</a></li>
<li>Alex Bernier 2015-05-08

    Booyah. Thank you, All!</li>
<li>Ewan Harris 2015-05-16

    Verified using:
    
    Mac OSX 10.10.3
    Titanium SDK build:  4.0.0.v20150515213410
    Appc CLI (NPM): 0.3.56
    Appc CLI (Registry): 0.2.287
    
    Using the code attached by Shuo, when uploading a photo to ACS the upload is now successful.
    
    Closing ticket</li>
</ol>


<p><a href="/TIMOB/TIMOB-18838.json">JSON Source</a></p>