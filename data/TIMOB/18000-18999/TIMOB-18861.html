---
title: "[TIMOB-18861] SSL certificate validation fails on university.appcelerator.com on Android"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-04-29T22:49:29.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.0.0, Release 4.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Chris Bowley</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2015-04-10T16:43:30.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-16T22:48:37.000+0000</td></tr>
</table>

<h3>Description</h3>

The Android mobile app for Appcelerator University cannot connect to the API due to an SSL certificate validation failure. The error message suggests the server certificate is for *.cloudapp-enterprise.appcelerator.com:

<code><pre>
HTTP Error (javax.net.ssl.SSLException): hostname in certificate didn't match: &lt;university.appcelerator.com&gt; != &lt;*.cloudapp-enterprise.appcelerator.com&gt; OR &lt;*.cloudapp-enterprise.appcelerator.com&gt; OR &lt;cloudapp-enterprise.appcelerator.com&gt;
</pre></code>

If I do a cURL, the SSL certificate is for *.appcelerator.com:

<code><pre>
curl -v -s -H "Authorization: Basic VGswNHhoMjdNeGlCTEdWMHU3MlVkUlBDZzNYNHd0WmI6" <a href="https://university.appcelerator.com/api/app/config" rel="nofollow" target="_blank">https://university.appcelerator.com/api/app/config</a> 1&gt; /dev/null 
* Hostname was NOT found in DNS cache
*   Trying 54.244.121.15...
* Connected to university.appcelerator.com (54.244.121.15) port 443 (#0)
* TLS 1.2 connection using TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
* Server certificate: *.appcelerator.com
* Server certificate: Go Daddy Secure Certificate Authority - G2
* Server certificate: Go Daddy Root Certificate Authority - G2
&gt; GET /api/app/config HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: university.appcelerator.com
&gt; Accept: */*
&gt; Authorization: Basic VGswNHhoMjdNeGlCTEdWMHU3MlVkUlBDZzNYNHd0WmI6
&gt; 
&lt; HTTP/1.1 200 OK
&lt; X-Powered-By: Appcelerator Node.ACS
&lt; X-Response-time: 8ms
* Server Appcelerator Arrow/0.3.167 is not blacklisted
&lt; server: Appcelerator Arrow/0.3.167
&lt; request-id: fdea4777-3ec4-4552-a782-a66992bb724c
&lt; content-type: application/json
&lt; content-length: 129
&lt; date: Fri, 10 Apr 2015 16:42:11 GMT
&lt; connection: close
&lt; 
{ [data not shown]
* Closing connection 0
</pre></code>

Here's the ACS details for the published Appcelerator University Arrow app:

<code><pre>
App name: AppU
 -- Created by: rblalock@appcelerator.com
 -- URL: <a href="https://0df0b36af43e31f224953e4d270bcb256b86677c.cloudapp-enterprise.appcelerator.com" rel="nofollow" target="_blank">https://0df0b36af43e31f224953e4d270bcb256b86677c.cloudapp-enterprise.appcelerator.com</a>
 -- DOMAIN: university.appcelerator.com
 -- Created at: Sat Mar 21 2015 03:55:30 GMT+0000 (GMT)
 -- Node Version: 0.10.22
 -- Server Size: Large
 -- Maximum allowed number of servers: 5
 -- Desired minimum number of servers: 3
 -- Current number of deployed servers: 3
 -- Auto scale-up enabled: true
 -- Maximum queued requests per server: 50
 -- Auto scale-down enabled: true
 -- Active version: 1.0.11
 -- Published at: Thu Apr 09 2015 02:41:16 GMT+0100 (BST)
 -- Status: Active
 -- Servers: 
    No. 1	ID: 551c756413a34aafa5f90281	Status: Deployed
    No. 2	ID: 551c757813a34aafa5f90285	Status: Deployed
    No. 3	ID: 551c75c713a34aafa5f90295	Status: Deployed
</pre></code>

<h3>Comments</h3>

<ol>
<li>Michael Goff 2015-04-10

   [~cbowley] is this running on an Android simulator or phone? Which Android version and phone model?
   
   We occasionally see issues with older Android versions when handling SSL certificates.</li>
<li>Chris Bowley 2015-04-10

   [~mgoff] this is on device. I have the same error on:
   
   Nexus 5, Android 5.0
   Galaxy Tab 10.1 2. Android 4.2.2
   
   Built using Ti 3.5.1.
   
   Do we even serve a *.cloudapp-enterprise.appcelerator.com certificate?</li>
<li>Chris Bowley 2015-04-11

   I get the same error if I try to access the Studio dashboard Arrow app API from Android:
   
   Equivalent cURL command:
   
   <code><pre>
   curl -v -s -H "Authorization: Basic TldmTmg1N1d3b3d5blNvRW9kVDM0cVM1c1VMYmU0Mmg6" <a href="https://appc-studio.appcelerator.com/api/appu/library" rel="nofollow" target="_blank">https://appc-studio.appcelerator.com/api/appu/library</a>
   </pre></code>
   
   Error when requested from Android:
   
   <code><pre>
   HTTP Error (javax.net.ssl.SSLException): hostname in certificate didn't match: 
   &lt;appc-studio.appcelerator.com&gt; != &lt;*.cloudapp-enterprise.appcelerator.com&gt; 
   OR &lt;*.cloudapp-enterprise.appcelerator.com&gt; 
   OR &lt;cloudapp-enterprise.appcelerator.com&gt;
   </pre></code></li>
<li>Fokke Zandbergen 2015-04-11

   I've had these kind of errors on Android apps before. I then learned that Android is very picky about the right order of the SSL certificate chain. You can find a lot about that on Google: <a href="https://www.google.nl/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=order+of+certificates+chain+android" rel="nofollow" target="_blank">https://www.google.nl/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=order+of+certificates+chain+android</a></li>
<li>Chris Bowley 2015-04-11

   Thanks [~fokkezb]. Here's the results I get for university.appcelerator.com: <a href="https://www.ssllabs.com/ssltest/analyze.html?d=university.appcelerator.com&s=54.244.121.14&hideResults=on." rel="nofollow" target="_blank">https://www.ssllabs.com/ssltest/analyze.html?d=university.appcelerator.com&s=54.244.121.14&hideResults=on.</a> No reference to *.cloudapp-enterprise.appcelerator.com.</li>
<li>Chris Bowley 2015-04-11

   If I make the request using the original URL, I get the *.cloudapp-enterprise.appcelerator.com certificate. Which means Android is resolving the CNAME URL?
   
   <code><pre>
   curl -v -s -H "Authorization: Basic TldmTmg1N1d3b3d5blNvRW9kVDM0cVM1c1VMYmU0Mmg6" <a href="https://c968c356eab0ac3c3a3bb8759ff6acc7eebc70a0.cloudapp-enterprise.appcelerator.com/api/appu/library" rel="nofollow" target="_blank">https://c968c356eab0ac3c3a3bb8759ff6acc7eebc70a0.cloudapp-enterprise.appcelerator.com/api/appu/library</a>
   * Hostname was NOT found in DNS cache
   *   Trying 54.244.121.14...
   * Connected to c968c356eab0ac3c3a3bb8759ff6acc7eebc70a0.cloudapp-enterprise.appcelerator.com (54.244.121.14) port 443 (#0)
   * TLS 1.2 connection using TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
   * Server certificate: *.cloudapp-enterprise.appcelerator.com
   * Server certificate: Go Daddy Secure Certificate Authority - G2
   * Server certificate: Go Daddy Root Certificate Authority - G2
   &gt; GET /api/appu/library HTTP/1.1
   &gt; User-Agent: curl/7.37.1
   &gt; Host: c968c356eab0ac3c3a3bb8759ff6acc7eebc70a0.cloudapp-enterprise.appcelerator.com
   &gt; Accept: */*
   &gt; Authorization: Basic TldmTmg1N1d3b3d5blNvRW9kVDM0cVM1c1VMYmU0Mmg6
   &gt; 
   &lt; HTTP/1.1 200 OK
   &lt; X-Powered-By: Appcelerator Node.ACS
   &lt; X-Response-time: 175ms
   * Server Appcelerator Arrow/0.3.167 is not blacklisted
   &lt; server: Appcelerator Arrow/0.3.167
   &lt; request-id: d272786f-31e7-4685-9fcd-84c53d6bd430
   &lt; content-type: application/json
   &lt; content-length: 33610
   &lt; date: Sat, 11 Apr 2015 12:30:54 GMT
   &lt; connection: close
   </pre></code></li>
<li>Michael Goff 2015-04-24

   [~cbowley] [~ingo] One potential cause of the mismatch only from Android (when browsers and iOS are working fine) could be how it handles virtual hosting. From <a href="https://developer.android.com/training/articles/security-ssl.html:" rel="nofollow" target="_blank">https://developer.android.com/training/articles/security-ssl.html:</a>
   
   {quote}
   Fortunately, HttpsURLConnection supports SNI since Android 2.3. Unfortunately, Apache HTTP Client does not, which is one of the many reasons we discourage its use. One workaround if you need to support Android 2.2 (and older) or Apache HTTP Client is to set up an alternative virtual host on a unique port so that it's unambiguous which server certificate to return.
   {quote}
   
   Which one do we use? Our HAProxy load balancer in Node.ACS utilizes SNI to choose the right SSL certificate to return.</li>
<li>Ingo Muschenetz 2015-04-24

   We specifically had to make a change for this WRT to building apps and the security server. Also see TIMOB-17948. It sounds like we should bump up the priority there.</li>
<li>Michael Goff 2015-04-24

   SNI support is absolutely required for Ti apps to access Arrow Cloud (Node.ACS) apps.</li>
<li>Ingo Muschenetz 2015-04-24

    Well, ack. [~hpham] and [~emerriman], let's discuss today.</li>
<li>Michael Goff 2015-04-24

    [~hpham] this seems to be an issue for Arrow apps which add their own SSL certificates and CNAME. Try the same Android code with university.appcelerator.com as the URL. Or I could add a SSL cert and CNAME to the app you just published to try and recreate the issue.</li>
<li>Hieu Pham 2015-04-24

    Mike, I just tried this:
    <code><pre>
    var xhr = Ti.Network.createHTTPClient({
        onload: function onLoad() {
            alert("Loaded: " + this.status + ": " + this.responseText);
        },
        onerror: function onError() {
            alert("Errored: " + this.status + ": " + this.responseText);
        }
    });
    
    xhr.open("GET","<a href="https://university.appcelerator.com" rel="nofollow" target="_blank">https://university.appcelerator.com</a>");
    //var authstr = 'Basic ' + Ti.Utils.base64encode('VGswNHhoMjdNeGlCTEdWMHU3MlVkUlBDZzNYNHd0WmI6:');
    //xhr.setRequestHeader("Authorization", authstr);
    xhr.send();
    </pre></code>
    
    I get code 200. Works fine for me.</li>
<li>Michael Goff 2015-04-24

    [~ingo], I configured a CNAME for [~hpham]'s Arrow app which uses the same SSL cert as university.appcelerator.com, and he was not able to produce the problem with 4.0.0.RC. How do you wish to proceed? Run the same test with Ti 3.5.1 that Chris used? Or be content that it works on 4.0?
    
    <code><pre>
    var xhr = Ti.Network.createHTTPClient({
        onload: function onLoad() {
            alert("Loaded: " + this.status + ": " + this.responseText);
        },
        onerror: function onError() {
            alert("Errored: " + this.status + ": " + this.responseText);
        }
    });
    
    xhr.open("GET","<a href="https://devops-4514.appcelerator.com/" rel="nofollow" target="_blank">https://devops-4514.appcelerator.com/</a>");
    //var authstr = 'Basic ' + Ti.Utils.base64encode('VGswNHhoMjdNeGlCTEdWMHU3MlVkUlBDZzNYNHd0WmI6:');
    //xhr.setRequestHeader("Authorization", authstr);
    xhr.send();
    </pre></code>
    
    <code><pre>
    $ acs list
    ACS: Appcelerator Cloud Services Command-Line Interface, version 1.0.23
    Copyright (c) 2012-2015, Appcelerator, Inc.  All Rights Reserved.
    
    Admin Hostname: <a href="https://admin.cloudapp-enterprise.appcelerator.com" rel="nofollow" target="_blank">https://admin.cloudapp-enterprise.appcelerator.com</a>
    
    Organization: ChaosMonkey (100006264)
    ============
    Points:
     -- Quota: 45
     -- Used: 1
    
    App name: TestArrow
     -- Created by: hpham@appcelerator.com
     -- URL: <a href="https://586f26424b0714864876ac62d861a5fe70b83624.cloudapp-enterprise.appcelerator.com" rel="nofollow" target="_blank">https://586f26424b0714864876ac62d861a5fe70b83624.cloudapp-enterprise.appcelerator.com</a>
     -- DOMAIN: devops-4514.appcelerator.com
     -- Created at: Fri Apr 24 2015 11:42:45 GMT-0700 (PDT)
     -- Node Version: 0.10.22
     -- Server Size: Dev
     -- Maximum allowed number of servers: 1
     -- Desired minimum number of servers: 1
     -- Current number of deployed servers: 1
     -- Active version: 1.0.0
     -- Published at: Fri Apr 24 2015 13:03:52 GMT-0700 (PDT)
     -- Status: Active
     -- Servers:
        No. 1	ID: 5539092013a34aafa5fe484d	Status: Deployed
    
    $ dig +short devops-4514.appcelerator.com
    586f26424b0714864876ac62d861a5fe70b83624.cloudapp-enterprise.appcelerator.com.
    ec2-54-244-121-15.us-west-2.compute.amazonaws.com.
    54.244.121.15
    </pre></code></li>
<li>Ingo Muschenetz 2015-04-24

    [~cbowley] can you please take a look at [~hpham]'s code above and see what the difference might be?</li>
<li>Chris Bowley 2015-04-27

    [~hpham] [~mgoff] [~imuschenetz@appcelerator.com] by default the SSL certificate is not validated in development. You need to add
    
    <code><pre>
    xhr.validatesSecureCertificate = true;
    </pre></code>
    
    before the xhr.open() call. This is true by default in production.</li>
<li>Hieu Pham 2015-04-27

    Testing code
    <code><pre>
    var xhr = Ti.Network.createHTTPClient({
        onload: function onLoad() {
            alert("Loaded: " + this.status + ": " + this.responseText);
        },
        onerror: function onError() {
            alert("Errored: " + this.status + ": " + this.responseText);
        }
    });
    xhr.validatesSecureCertificate = true;
    xhr.open("GET","<a href="https://devops-4514.appcelerator.com/" rel="nofollow" target="_blank">https://devops-4514.appcelerator.com/</a>");
    xhr.send();
    </pre></code>
    
    1. Run and make sure you get code 200</li>
<li>Hieu Pham 2015-04-28

    I was able to reproduce this on Eclipse, Appcelerator Studio works fine for some reason. I added support for SNI here: 
    <a href="https://github.com/appcelerator/titanium_mobile/pull/6807" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6807</a></li>
<li>Lee Morris 2017-03-16

    Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-18861.json">JSON Source</a></p>