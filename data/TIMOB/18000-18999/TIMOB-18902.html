---
title: "[TIMOB-18902] HTTPClient: unable set content-type as json for multipart post request using Httpclient"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-08-07T19:12:16.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 3.5.1, Release 4.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 4.1.1, Release 5.0.0</td></tr>
<tr><th>Components</th><td>Android, iOS</td></tr>
<tr><th>Labels</th><td>header, httpclient, mutipart</td></tr>
<tr><th>Reporter</th><td>Shuo Liang</td></tr>
<tr><th>Assignee</th><td>Chee Kiat Ng</td></tr>
<tr><th>Created</th><td>2015-05-13T14:13:28.000+0000</td></tr>
<tr><th>Updated</th><td>2016-08-18T08:06:40.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description:</h4>
HTTP request sends post to a Salesforce.com REST api that is expecting a multipart request with content-type set clearly for each of the parts, like the following:
{quote}
POST /services/data/v33.0/chatter/feed-elements HTTP/1.1 
Authorization: OAuth 00DRR0000000N0g!... 
User-Agent: Jakarta Commons-HttpClient/3.0.1 
Host: instance_name 
Content-Length: 845 
Content-Type: multipart/form-data; boundary=boundary 
Accept: application/json 

--boundary 
Content-Disposition: form-data; name="json" 
Content-Type: application/json; charset=UTF-8 

{ 
"somejson":"data" 
} 

--boundary 
Content-Disposition: form-data; name="feedElementFileUpload"; filename="receipt.pdf" 
Content-Type: application/octet-stream; charset=ISO-8859-1 

filecontent 
{quote}

If we set xhr.setRequestHeader("enctype", "multipart/form-data"), This is fine for the file part, as Titanium is doing the magic. However, for the json part, Titanium will not set it and hence caused parsing errors for the post request. How can we support that?

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-18902_56163/testServer.js">testServer.js</td></td><td>2015-07-15T04:39:20.000+0000</td><td>223</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Eddie Wu 2015-05-16

   Hi is there a fix plan or ETA? Many thanks.</li>
<li>Chee Kiat Ng 2015-07-03

   [~sliang], Just to check before we investigate further, in the sample code, it should be an array as a parameter in 
   <code><pre>
   xhr.send(array)
   </pre></code>
    right?
   
   <h4>It should be:</h4>
   <code><pre>
   xhr.send([data2send]);
   </pre></code></li>
<li>Eddie Wu 2015-07-03

   @Chee Kiat Ng, not exactly - according to the document - <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Network.HTTPClient-method-send
   
   
   <code><pre>
   Parameters
   data : Object/String/Titanium.Filesystem.File/Titanium.Blob (optional)
   Data to send with a POST request.
   </pre></code>
   </li>
<li>Ashraf Abu 2015-07-15

   Android PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/6976" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6976</a>
   
   Node JS server code [^testServer.js] also attached here. For testing instructions, check PR in Github.</li>
<li>Ashraf Abu 2015-07-15

   [~hpham] Could you review the above PR? </li>
<li>Ashraf Abu 2015-07-22

   Reopening issue as iOS is not completed yet. [~cng] Android PR has been merged.</li>
<li>Chee Kiat Ng 2015-07-29

   iOS PRs done:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/6991" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/6991</a>
   <a href="https://github.com/appcelerator/APSHTTPClient/pull/27" rel="nofollow" target="_blank">https://github.com/appcelerator/APSHTTPClient/pull/27</a></li>
<li>Chee Kiat Ng 2015-08-04

   PRs updated again, so that change is only applied to content-type for multipart post. The rest of the behavior remains the same.</li>
<li>Ashraf Abu 2015-08-06

   Android Backport to 4_1_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/7009" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7009</a>
   [~hpham] For your review.</li>
<li>Chee Kiat Ng 2015-08-06

    iOS backport to 4_1_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/7010" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7010</a>
    [~pec1985], For your review and merge.</li>
<li>Chee Kiat Ng 2015-08-13

    all outstanding PRs merged.</li>
<li>Eric Wieber 2015-08-25

    Verified fixed, using:
    
    MacOS 10.11 (15A263e)
    Studio 5.0.0.201508181557
    Ti SDK 4.1.1.v20150816214206
    Appc NPM 4.2.0-1
    Appc CLI 4.1.3-6
    Ti CLI 4.0.1
    Alloy 1.6.2
    Arrow 1.2.38
    Xcode 6.4 (6E35b)
    Node v0.10.37
    Java 1.7.0_45
    preproduction
    
    Successfully get expected JSON return from sample code on Android and iOS</li>
</ol>


<p><a href="/TIMOB/TIMOB-18902.json">JSON Source</a></p>