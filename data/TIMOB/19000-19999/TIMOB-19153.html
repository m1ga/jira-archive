---
title: "[TIMOB-19153] Windows: CLI errors with Error: Callback was already called when building to emulator with production deploytype"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-07-29T23:41:02.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.0.0</td></tr>
<tr><th>Components</th><td>CLI, Windows</td></tr>
<tr><th>Labels</th><td>qe-4.1.0</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2015-07-03T00:46:38.000+0000</td></tr>
<tr><th>Updated</th><td>2015-08-20T23:01:29.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

When building for an emulator with a deploytype of production the build will error out with the below

<code><pre>
C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\node_modules\longjohn\dist\longjohn.js:1
95
        throw e;
              ^
Error: Callback was already called.
    at WindowsBuilder.<anonymous> (C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\node_
modules\async\lib\async.js:22:31)
    at CLI._fireHookCallback (C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\lib\hook.j
s:269:12)
    at C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\lib\hook.js:248:10
    at C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\node_modules\async\lib\async.js:2
32:13
    at C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\node_modules\async\lib\async.js:1
42:25
    at C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\node_modules\async\lib\async.js:2
29:17
    at C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\node_modules\async\lib\async.js:5
56:34
    at C:\Users\Windo_000\.appcelerator\install\4.1.0-0\package\node_modules\appc-cli-titanium\node_modules\titanium\lib\hook.js:239:9
    at EventEmitter.<anonymous> (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\windows\cli\hooks\wp-run.js:244:9)
---------------------------------------------
    at installApp (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\windows\cli\hooks\wp-run.js:218:8)
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\windows\cli\hooks\wp-run.js:286:7
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:551:21
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:227:13
    at iterate (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:134:13)
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:145:25
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:229:17
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:556:34
---------------------------------------------
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\windows\cli\hooks\wp-run.js:265:8
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:551:21
    at C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:227:13
    at iterate (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:134:13)
    at async.eachSeries (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:150:9)
    at _asyncMap (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:226:9)
    at Object.mapSeries (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:216:23)
    at async.series (C:\ProgramData\Titanium\mobilesdk\win32\4.1.0.v20150702140313\node_modules\async\lib\async.js:549:19)
</pre></code>

<h4>Steps to reproduce</h4>

1. Build a project using <code>appc run -p windows -T wp-emulator -D production</code>

<h4>Actual result</h4>

The CLI will error with the above

<h4>Expected result</h4>

The CLI should not error

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2015-07-27

   <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/390" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/390</a></li>
<li>Kota Iguchi 2015-07-28

   I had experienced following error during <code>ti build</code> for development deployment after merging PR#390. Reverted the changes.
   
   <code><pre>
   [ERROR] Failed to start emulator "8-1-1"
   [ERROR] Connection failed because of invalid command-line arguments.
   </pre></code></li>
<li>Christopher Williams 2015-07-29

   <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/396" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/396</a></li>
<li>Lokesh Choudhary 2015-08-20

   Verified the fix.
   We don't see any errors & the appc builds successfully to emulator with deploytype production.
   
   Closing.
   
   Environment:
   Appc Studio:  5.0.0.v20150819140421
   Ti SDK: 5.0.0.v20150820100424
   Ti CLI: 4.1.4
   Alloy: 1.6.2
   Windows: 8.1 Enterprise 64-bit
   APPC NPM: 4.2.0-1
   APPC CLI: 5.0.0-8
   Node : v0.10.37
   Device: Nokia Lumia 928 - Windows Phone 8.1
   Windows emulator : 8.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-19153.json">JSON Source</a></p>