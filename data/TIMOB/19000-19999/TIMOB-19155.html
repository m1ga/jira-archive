---
title: "[TIMOB-19155] LiveView: Breaks when app.js contains named self execution function"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-05-19T15:18:43.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 4.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>LiveView</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2015-07-03T06:44:09.000+0000</td></tr>
<tr><th>Updated</th><td>2020-05-19T15:18:43.000+0000</td></tr>
</table>

<h3>Description</h3>

When the (compiled) <code>app.js</code> contains a named self executing function (e.g. to protect global scope) LiveView will break.

<h4>Example</h4>

<code><pre>
(function hello() {
  Ti.UI.createWindow({
    backgroundColor: 'green'
  }).open();
})();
</pre></code>

<h4>Error</h4>

<code><pre>
[INFO]  [LiveView] Error Evaluating app @ Line: 1
[ERROR] SyntaxError: Unexpected identifier 'hello'
[ERROR] File: app
[ERROR] Line: 1
[ERROR] SourceId: &lt;null&gt;
[ERROR] Backtrace:
[ERROR]  undefined
</pre></code>

<h4>Cause</h4>
I tracked this back to LiveView's <code>fileserver.js</code> where it bind all global variables in <code>app.js</code> to <code>Global._globalCtx</code>:
<a href="https://github.com/appcelerator/liveview/blob/master/lib/fserver.js#L298-L312" rel="nofollow" target="_blank">https://github.com/appcelerator/liveview/blob/master/lib/fserver.js#L298-L312</a>

Before this part everything is OK, but after the code will end up as:

<code><pre>
   nction hello() {
  Ti.UI.createWindow({
    backgroundColor: 'green'
  }).open();
})();
</pre></code>

<h4>Solution</h4>
As the comment in the LiveView code says there IS a better way to do this. An example could be [how I did this](<a href="https://github.com/FokkeZB/ti-proxy/commit/147aa34eccb383cf33ef9df11677d3be766b4abb)" rel="nofollow" target="_blank">https://github.com/FokkeZB/ti-proxy/commit/147aa34eccb383cf33ef9df11677d3be766b4abb)</a> for [ti-proxy](<a href="https://github.com/FokkeZB/ti-proxy)" rel="nofollow" target="_blank">https://github.com/FokkeZB/ti-proxy)</a>, the client-side transformer that [appc-liveviewer-app](<a href="https://github.com/appcelerator/appc-liveviewer-app/)" rel="nofollow" target="_blank">https://github.com/appcelerator/appc-liveviewer-app/)</a> uses.

We should consider using ti-proxy for LiveViewer as well, it already has more features then LiveViewer does, like serving new/changed assets, cleaning up events etc.

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2020-05-19

   I can no longer reproduce this on SDK 9.0.1.GA, we removed the munging of code we use to do via a regex in favour of operating on the AST via babel so I imagine that this got fixed with that</li>
</ol>


<p><a href="/TIMOB/TIMOB-19155.json">JSON Source</a></p>