---
title: "[TIMOB-19328] Android: broadcast receiver always executed twice for one broadcast"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shawn Lan</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2015-07-31T02:25:14.000+0000</td></tr>
<tr><th>Updated</th><td>2015-11-13T02:46:09.000+0000</td></tr>
</table>

<h3>Description</h3>

It was working fine. Recently I found this bug, but not sure starting which SDK version the problem existed.

Create a default Alloy project with the following:

index.xml
<code><pre>
&lt;Alloy&gt;
	&lt;Window class="container" onClose="doClose" /&gt;
&lt;/Alloy&gt;
</pre></code>

index.js
<code><pre>
function doClose() {
	Ti.Android.unregisterBroadcastReceiver(bc);
}

$.index.open();

var onReceived = function(e) {
	Ti.API.info("received!");
};
var bc = Ti.Android.createBroadcastReceiver({
	onReceived : onReceived
});
Ti.Android.registerBroadcastReceiver(bc, ["android.intent.action.PHONE_STATE"]);
</pre></code>

tiapp.xml (use the following for the android section)
<code><pre>
   &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
    	&lt;manifest&gt;
            &lt;uses-permission android:name="android.permission.READ_PHONE_STATE"/&gt;
    	&lt;/manifest&gt;
    &lt;/android&gt;
</pre></code>

After launching the app, call to the cellphone and see the onReceived function executed twice for one broadcast.

<h3>Comments</h3>

<ol>
<li>Hieu Pham 2015-08-25

   This isn't a bug. The phone_state broadcast supposed to fire every time the phone's state changes: <a href="http://developer.android.com/reference/android/telephony/TelephonyManager.html#ACTION_PHONE_STATE_CHANGED" rel="nofollow" target="_blank">http://developer.android.com/reference/android/telephony/TelephonyManager.html#ACTION_PHONE_STATE_CHANGED</a>
   
   So if you are receiving a phone call, there are multiple phone states (i.e, CALL_STATE_IDLE, CALL_STATE_OFFHOOK, and CALL_STATE_RINGING). I've also tested with android.intent.action.AIRPLANE_MODE, and it works as expected (only fired once)</li>
<li>Shawn Lan 2015-08-25

   For each phone state the receiver is called twice!! The bug seems to only happen with phone state. Please test using the test case under the specified environment.
   
   Please re-open this case or I'll need to create another case.</li>
<li>Chee Kiat Ng 2015-11-12

   Please use the sample code to regenerate the issue. 
   
   index.xml
   <code><pre>
   &lt;Alloy&gt;
   
   	&lt;Window class="container" onClose="doClose" /&gt;
   
   &lt;/Alloy&gt;
   </pre></code>
   index.js
   <code><pre>
   function doClose() {
   
   	Ti.Android.unregisterBroadcastReceiver(bc);
   
   }
   
    
   
   $.index.open();
   
    
   
   var onReceived = function(e) {
   
   	Ti.API.info("received!");
   
   };
   
   var bc = Ti.Android.createBroadcastReceiver({
   
   	onReceived : onReceived
   
   });
   
   Ti.Android.registerBroadcastReceiver(bc, ["android.intent.action.PHONE_STATE"]);
   </pre></code>
   tiapp.xml (use the following for the android section)
   <code><pre>
      &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
   
       	&lt;manifest&gt;
   
               &lt;uses-permission android:name="android.permission.READ_PHONE_STATE"/&gt;
   
       	&lt;/manifest&gt;
   
       &lt;/android&gt;
   </pre></code>
   
   Let's have one more look at this.
   </li>
<li>Chee Kiat Ng 2015-11-12

   Sorry just realised the sample code commented above is exactly the same as ticket description. </li>
<li>Ashraf Abu 2015-11-12

   Tested this with an Emulator with Android 5.1.0 using the above code.
   Simulated an inbound call by running the following commands based on <a href="http://developer.android.com/tools/devices/emulator.html#telephony" rel="nofollow" target="_blank">http://developer.android.com/tools/devices/emulator.html#telephony</a>
   
   1) <code>telnet localhost 5554</code>
   2) <code>gsm call 1111</code>
   
   Broadcast receiver executed once when Picking up phone call.
   Broadcast receiver executed once more when phone call ended and went back to app.
   
   Unable to reproduce broadcast receiver executing twice.</li>
<li>Shawn Lan 2015-11-12

   Have you tested on a device? I tested it on my HTC One M7. Call pickup executes twice the receiver. Call end executes twice the receiver as well.</li>
<li>Ashraf Abu 2015-11-13

   [~shawnlan] May I know which Android version HTC One M7 is running?</li>
<li>Shawn Lan 2015-11-13

   5.0.2</li>
<li>Ashraf Abu 2015-11-13

   Thanks. I'll try to test on something similar to that.</li>
</ol>


<p><a href="/TIMOB/TIMOB-19328.json">JSON Source</a></p>