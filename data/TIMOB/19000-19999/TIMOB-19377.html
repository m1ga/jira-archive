---
title: "[TIMOB-19377] Android Lollipop - Preferences Activity no longer has action bar"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-08-31T02:06:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shawn Lan</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2015-07-31T19:21:37.000+0000</td></tr>
<tr><th>Updated</th><td>2015-09-03T18:22:55.000+0000</td></tr>
</table>

<h3>Description</h3>

Upgraded my app to SDK 4.0.0+. I noticed that the preferences activity no longer has the action bar (title bar). In previous version it does.

Create a default Alloy project with the following:

index.xml
<code><pre>
<Alloy>
	<Window />
</Alloy>
</pre></code>

index.js
<code><pre>
$.index.open();
Ti.UI.Android.openPreferences();
</pre></code>

preferences.xml
<code><pre>
<?xml version="1.0" encoding="utf-8"?>
<PreferenceScreen xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>" android:title="TITLE">
    <CheckBoxPreference
        android:key="key1"
        android:title="this is key 1"
        android:summary="key 1 summary"
        android:defaultValue="false" />
    <CheckBoxPreference
        android:key="key2"
        android:title="this is key 2"
        android:summary="key 2 summary"
        android:defaultValue="false" />
</PreferenceScreen>
</pre></code>

<h3>Comments</h3>

<ol>
<li>Ashraf Abu 2015-08-19

   For those who want to test this with classic app.js:-
   
   <code><pre>
   var win = Ti.UI.createWindow({backgroundColor: 'white'});
   var button = Ti.UI.createButton({
     title:    'Click to Open Preferences'
   });
   button.addEventListener('click', function() {
     Ti.UI.Android.openPreferences();
   });
   win.add(button);
   win.open();
   </pre></code></li>
<li>Ashraf Abu 2015-08-19

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7045" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7045</a>
   
   Run test steps with code above and an XML file as mention in original comment.
   
   Please run tests on both Android Lollipop and a version below Android Lollipop.</li>
<li>Ashraf Abu 2015-08-20

   Workaround if you want to implement this now:
   If you need to use it now, take a look at <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/Android_Themes-section-34636181_AndroidThemes-OverrideanActivityTheme
   
   All you need to do is implement a theme for TiPreferencesActivity class. One for a "values" and another for "values-v21". Take a look at the PR <a href="https://github.com/appcelerator/titanium_mobile/pull/7045/files" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7045/files</a> if you want to implement it this way.</li>
<li>Shawn Lan 2015-08-20

   I already assign it a theme with action bar, but the issue persists on Lollipop.
   
   <code><pre>
   <activity
                       android:configChanges="keyboardHidden|orientation|screenSize"
                       android:name="ti.modules.titanium.ui.android.TiPreferencesActivity"
                       android:screenOrientation="portrait" android:theme="@style/Theme.AppCompat.Light"/>
   </pre></code></li>
<li>Ashraf Abu 2015-08-20

   [~shawnlan] You would need 2 Themes. Theme.AppCompat for anything less than Lollipop and Theme.Material for Lollipop and above.
   
   Theme.AppCompat does not provide an action bar on Lollipop. Theme.Material does.</li>
<li>Shawn Lan 2015-08-20

   Theme.AppCompat does provide action bar. Please take a look at Android's doc and [here](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/guide/Android_Themes-section-34636181_AndroidThemes-MaterialTheme)
   
   All my activities use Theme.AppCompat. They all show an action bar, except the preferences activity. Test it yourself.</li>
<li>Ashraf Abu 2015-08-21

   [~shawnlan], you are almost there. Here's what you need to do exactly:-
   
   We are going to use a new theme for the activity. The theme will be different based on what version of android we are using. In the tiapp.xml write this:-
   <code><pre>
       <android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>">
           <manifest>
               <application>
               		<activity android:name="ti.modules.titanium.ui.android.TiPreferencesActivity" android:configChanges="screenSize"
   						android:theme="@style/Theme.TiPreferences" />
   	     </application>
           </manifest>
       </android>
   </pre></code>
   
   Then, we need to create a folder in these path, <code>/platform/android/res/values</code> and <code>/platform/android/res/values-v21</code>
   
   In  <code>/platform/android/res/values-v21</code>, put this file: <a href="https://github.com/ashcoding/titanium_mobile/blob/TIMOB-19377/android/modules/ui/res/values-v21/styles.xml" rel="nofollow" target="_blank">https://github.com/ashcoding/titanium_mobile/blob/TIMOB-19377/android/modules/ui/res/values-v21/styles.xml</a>
   
   In '/platform/android/res/values', put this file: <a href="https://github.com/ashcoding/titanium_mobile/blob/TIMOB-19377/android/modules/ui/res/values/styles.xml" rel="nofollow" target="_blank">https://github.com/ashcoding/titanium_mobile/blob/TIMOB-19377/android/modules/ui/res/values/styles.xml</a>
   
   I also made a repo here: <a href="https://github.com/ashcoding/TIMOB-19377_Example" rel="nofollow" target="_blank">https://github.com/ashcoding/TIMOB-19377_Example</a> that you can take a look.
   
   On the logic behind this:-
   Appcompat only adds an action bar to activities that derive from ActionBarActivity. PreferenceActivity does not subclass ActionBarActivity. 
   
   This should work. :)</li>
<li>Shawn Lan 2015-08-21

   Your workaround only works in Lollipop. On Android 4 and below it is still not showing action bar.
   
   Maybe you need to switch to preferencefragment?</li>
<li>Ashraf Abu 2015-08-24

   [~shawnlan] That might be a good idea to switch to a preferencefragment.
   
   Anyway, there was a missing style for v14. <a href="https://github.com/ashcoding/TIMOB-19377_Example/tree/master/platform/android/res/values-v14" rel="nofollow" target="_blank">https://github.com/ashcoding/TIMOB-19377_Example/tree/master/platform/android/res/values-v14</a> 
   I have updated the code. It should now have the actionbar for below lollipop. Feel free to style it more. :)
   
   Let me know if it solves this for you for now.</li>
<li>Shawn Lan 2015-08-24

    Yes it works for now, but since my app use AppCompat everywhere else, the preference activity with Theme.Holo does look different. Still prefer this to be fixed so that I can use just AppCompat, not only for look consistency but also that I don't need to have these extra style. Thanks.</li>
<li>Ashraf Abu 2015-08-25

    [~shawnlan] You could actually customise the theme to make it look like how you want it. And that includes making it look similar to how AppCompat does it.
    Here's how, <a href="https://developer.android.com/training/basics/actionbar/styling.html" rel="nofollow" target="_blank">https://developer.android.com/training/basics/actionbar/styling.html</a>
    
    For reference, I updated the v14 style folder, <a href="https://github.com/ashcoding/TIMOB-19377_Example/blob/master/platform/android/res/values-v14/styles.xml" rel="nofollow" target="_blank">https://github.com/ashcoding/TIMOB-19377_Example/blob/master/platform/android/res/values-v14/styles.xml</a> 
    
    Hope this helps.</li>
<li>Ashraf Abu 2015-08-25

    PR for fix: <a href="https://github.com/appcelerator/titanium_mobile/pull/7045" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7045</a></li>
<li>Shawn Lan 2015-08-25

    1. The window just looks similar to, but not exactly the same as how AppCompat does it.
    
    2. The child elements (checkboxes, on/off buttons, etc.) still look inconsistent.
    
    It's too much work to style everything and make them look like AppCompat. Your solution can be a temporary workaround, but shouldn't be a permanent fix.
    
    Thanks.</li>
<li>Ashraf Abu 2015-08-26

    [~shawnlan] Understand what you mean. Got it. </li>
<li>Ashraf Abu 2015-08-31

    </li>
<li>Lokesh Choudhary 2015-09-03

    </li>
</ol>


<p><a href="/TIMOB/TIMOB-19377.json">JSON Source</a></p>