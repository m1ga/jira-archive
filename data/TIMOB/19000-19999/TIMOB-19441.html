---
title: "[TIMOB-19441] useractivitywillsave does not fire before continuing on other device"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2015-09-03T08:09:30.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.0.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>handoff</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2015-08-31T15:03:55.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-20T21:42:36.000+0000</td></tr>
</table>

<h3>Description</h3>

The [Ti 5.0 sample app](<a href="https://github.com/appcelerator-developer-relations/appc-sample-ti500)" rel="nofollow" target="_blank">https://github.com/appcelerator-developer-relations/appc-sample-ti500)</a> will show that the <code>useractivitywillsave</code> event only fires when you call <code>becomeCurrent()</code>. It does not fire before/when you continue the activity on another device, like the [docs](<a href="https://appcelerator.github.io/appc-docs/latest/#" rel="nofollow" target="_blank">https://appcelerator.github.io/appc-docs/latest/#</a>!/api/Titanium.App.iOS.UserActivity-property-needsSave) say it will when you set <code>needSave</code> to <code>true</code>. This leaves you with no way to update the activity before the other devices takes over.

<h3>Comments</h3>

<ol>
<li>Fokke Zandbergen 2015-09-02

   I ran some tests that showed that <code>useractivitywillsave</code> will fire when:
   
   * You call <code>becomeCurrent()</code> on an activity.
   * Before the current activity is sent for continuation on another devices ([as Apple says](<a href="https://developer.apple.com/library/prerelease/ios/documentation/Foundation/Reference/NSUserActivity_Class/#//apple_ref/occ/instp/NSUserActivity/needsSave))" rel="nofollow" target="_blank">https://developer.apple.com/library/prerelease/ios/documentation/Foundation/Reference/NSUserActivity_Class/#//apple_ref/occ/instp/NSUserActivity/needsSave))</a> but *only* if since that activity became current you have made a change (updated <code>userInfo</code>) to it.
   
   This is weird, since you'd expect the event would give you the chance to (only then) update the activity with e.g. the current text of the email you were composing. If you have to update the activity in order for the event to fire, then what is there left to do when it gets called?</li>
<li>Fokke Zandbergen 2015-09-02

   From Apple's [Handoff Programming Guide: Best Practices](<a href="https://developer.apple.com/library/mac/documentation/UserExperience/Conceptual/Handoff/AdoptingHandoff/AdoptingHandoff.html#//apple_ref/doc/uid/TP40014338-CH2-SW14):" rel="nofollow" target="_blank">https://developer.apple.com/library/mac/documentation/UserExperience/Conceptual/Handoff/AdoptingHandoff/AdoptingHandoff.html#//apple_ref/doc/uid/TP40014338-CH2-SW14):</a>
   
   {quote}To update the activity object’s userInfo dictionary efficiently, configure its delegate and set its needsSave property to YES whenever the userInfo needs updating. At appropriate times, Handoff invokes the delegate’s userActivityWillSave: callback, and the delegate can update the activity state.{quote}
   
   [This StackOverflow answer](<a href="http://stackoverflow.com/a/26792196/4626813)" rel="nofollow" target="_blank">http://stackoverflow.com/a/26792196/4626813)</a> has a sample that demonstrates this:
   
   <code><pre>
   - (NSUserActivity *)customUserActivity 
   {
       if (!_customUserActivity) {
           _customUserActivity = [[NSUserActivity alloc] initWithActivityType:@"com.company.app.edit"];
           _customUserActivity.title = @"Editing in app";
           _customUserActivity.delegate = self;
       }
   
       return _customUserActivity;
   }
   
   - (void)textViewDidBeginEditing:(UITextView *)textView 
   {
       [self.customUserActivity becomeCurrent];
   }
   
   - (void)textViewDidChange:(UITextView *)textView 
   {
       self.customUserActivity.needsSave = YES;
   }
   
   - (BOOL)textViewShouldEndEditing:(UITextView *)textView 
   {
       [self.customUserActivity invalidate];
   
       return YES;
   }
   
   - (void)userActivityWillSave:(NSUserActivity *)userActivity 
   {
       [userActivity addUserInfoEntriesFromDictionary:@{ @"editText" : self.textView.text }];
   }
   </pre></code>
   
   So it seems we (and Apple:)) should update our guide/reference to make clear that you need to call <code>needsSave</code> every time you have a change and then update the activity with the actual change when asked via the <code>useractivitywillsave</code> event.</li>
<li>Chee Kiat Ng 2015-09-03

   Thanks Fokke. closing as invalid and will open a tidoc ticket.</li>
<li>Lee Morris 2017-03-20

   Closing ticket as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-19441.json">JSON Source</a></p>