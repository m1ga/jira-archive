---
title: "[TIMOB-19505] Ti.Network.HTTPClient Default addition of Appcelerator User-Agent header can impact success of network calls"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2016-07-21T01:44:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>TiAPI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Bert Grantges</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2015-09-13T07:07:13.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-23T22:30:01.000+0000</td></tr>
</table>

<h3>Description</h3>

On Android and iOS the addition of the default User-Agent string for each http network request is impacting the expected response of the network request.

The code that is causing the issue:
<a href="https://github.com/appcelerator/titanium_mobile/blob/4_1_X/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L943" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/4_1_X/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L943</a>

The issue seems to be that the protected endpoint is validating against known UserAgents and returning an error response if it is not an approved UserAgent string. Trying to set the user agent with Ti.Network.HTTPClient.setRequestHeader appends the header, but does not remove the default header.


<h3>Comments</h3>

<ol>
<li>Bert Grantges 2015-09-13

   Here is the like code on iOS that is causing the issue.
   
   <a href="https://github.com/appcelerator/titanium_mobile/blob/4_1_X/iphone/Classes/TiNetworkHTTPClientProxy.m#L50" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/4_1_X/iphone/Classes/TiNetworkHTTPClientProxy.m#L50</a>
   </li>
<li>Ingo Muschenetz 2015-09-14

   From the docs: <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Network.HTTPClient, an "HTTP client object that (mostly) implements the XMLHttpRequest specification."
   
   From the XMLHttpRequest specification, values are appended: <a href="http://www.w3.org/TR/XMLHttpRequest/#the-setrequestheader()-method" rel="nofollow" target="_blank">http://www.w3.org/TR/XMLHttpRequest/#the-setrequestheader()-method</a>
   
   I don't know why the endpoint can't check for the new user agent. However, if we HAVE to overwrite the existing value, we need a new method to allow that.
   </li>
<li>Chee Kiat Ng 2015-09-15

   Agreed with Ingo. we are appending the values since it's the industry standard so there's no reason why it's failing. 
   However, without introducing a new method, you can try this.
   <code><pre>
   request.setRequestHeader('User-Agent', null); //this deletes any existing value
   request.setRequestHeader('User-Agent', 'yourNewAgent');
   </pre></code></li>
<li>Ingo Muschenetz 2015-09-28

   Please confirm this works as expected. If so we will resolve as "Won't Fix"</li>
<li>Ygor Lemos 2016-07-20

   @Ingo
   
   The workaround proposed by @Chee works for overriding the User-Agent.
   
   Can we assume this is future-proof on Ti SDK 5.X and 6.X ?
   
   
   </li>
<li>Ingo Muschenetz 2016-07-20

   [~cng] ^^ fixing reference. Can you comment on the future-proofness of this?</li>
<li>Chee Kiat Ng 2016-07-21

   Yes. it's future proof.</li>
<li>Lee Morris 2017-03-23

   Closing ticket as Won't Fix with reference to the above comments.</li>
</ol>


<p><a href="/TIMOB/TIMOB-19505.json">JSON Source</a></p>