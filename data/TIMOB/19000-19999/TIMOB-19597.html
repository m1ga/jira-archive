---
title: "[TIMOB-19597] Android: Add previewRect (height, width) to camera callback"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-02-02T08:22:18.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 4.1.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, camera, module_media, qe-manualtest, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Michael Gangolf</td></tr>
<tr><th>Assignee</th><td>Srikanth Sombhatla</td></tr>
<tr><th>Created</th><td>2015-09-17T16:32:42.000+0000</td></tr>
<tr><th>Updated</th><td>2016-02-04T02:00:56.000+0000</td></tr>
</table>

<h3>Description</h3>



<h3>Comments</h3>

<ol>
<li>Michael Gangolf 2015-09-17

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7201" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7201</a></li>
<li>Srikanth Sombhatla 2015-11-06

   With this PR, user can get the preview size and can use it to size the captured image accordingly.</li>
<li>Lokesh Choudhary 2016-01-21

   Reopening as no previewRect is seen in the logs but only cropRect:
   <code><pre>
   [INFO] :   [SAMSUNG-SGH-I747] # SUCCESS : {"height":2448,"width":3264,"cropRect":{"height":2448,"y":0,"width":3264,"x":0},"code":0,"media":{"file":{"hidden":false,"nativePath":"file:///data/data/com.app.testme/app_appdata/tia1453413346146.jpg","writable":true,"executable":false,"parent":{"hidden":false,"nativePath":"file:///data/data/com.app.testme/app_appdata","writable":true,"executable":false,"parent":{"hidden":false,"nativePath":"file:///data/data/com.app.testme","writable":true,"executable":false,"parent":{"hidden":false,"nativePath":"file:///data/data","writable":false,"executable":false,"parent":{"hidden":false,"nativePath":"file:///data","writable":false,"executable":false,"parent":{"hidden":false,"nativePath":"file:///","writable":false,"executable":false,"parent":null,"readonly":true,"directoryListing":["sdcard","persist","storage","efs","config","cache","acct","vendor","d","etc","data_3","data_2","data_1","mnt_1","tombstones","firmware","mnt","ueventd.rc","ueventd.qcom.rc","system","sys","sepolicy_version","sepolicy","seapp_contexts","sbin","publiccert.pem","property_contexts","proc","initlogo.rle","init.usb.rc","init.trace.rc","init.target.rc","init.selinux_restore_set.sh","init.selinux_restore.sh","init.selinux_bootanim_stopped.sh","init.ril.sh","init.ril.rc","init.rc","init.qcom.usb.sh","init.qcom.usb.rc","init.qcom.syspart_fixup.sh","init.qcom.sh","init.qcom.rc","init.qcom.early_boot.sh","init.qcom.class_core.sh","init.environ.rc","init.container.rc","init.carrier.rc","init","fstab.qcom","file_contexts","default.prop","data","root","dev"],"size":0,"apiName":"Ti.Proxy","name":"","symbolicLink":false,"bubbleParent":true},"readonly":false,"directoryListing":[],"size":4096,"apiName":"Ti.Proxy","name":"data","symbolicLink":false,"bubbleParent":true},"readonly":false,"directoryListing":[],"size":12288,"apiName":"Ti.Proxy","name":"data","symbolicLink":false,"bubbleParent":true},"readonly":false,"directoryListing":["lib","cache","databases","shared_prefs","app_appdata"],"size":4096,"apiName":"Ti.Proxy","name":"com.app.testme","symbolicLink":false,"bubbleParent":true},"readonly":false,"directoryListing":[".tilicense","tia1453412750901.jpg","tia1453413346146.jpg"],"size":4096,"apiName":"Ti.Proxy","name":"app_appdata","symbolicLink":false,"bubbleParent":true},"readonly":false,"directoryListing":[],"size":1795672,"apiName":"Ti.Proxy","name":"tia1453413346146.jpg","symbolicLink":false,"bubbleParent":true},"nativePath":"file:///data/data/com.app.testme/app_appdata/tia1453413346146.jpg","height":2448,"length":1795672,"width":3264,"mimeType":"image/jpeg","apiName":"Ti.Blob","text":null,"type":1,"bubbleParent":true},"success":true,"mediaType":"public.image","y":0,"x":0}
   </pre></code>
   
   Environment:
   Appc Studio : 4.5.0.201601210853
   Ti SDK :  5.2.0.v20160114021251
   Ti CLI : 5.0.6
   Alloy : 1.7.33
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.3-1
   Appc CLI : 5.2.0-231
   Node: v0.12.27
   Nexus 6P - Android 6.0
   Galaxy S3 - Android 4.4.2</li>
<li>Srikanth Sombhatla 2016-01-28

   [~lchoudhary] Looks like the PR is intended when showCamera is used with overlay and <code>takePicture</code> is called.
   -[~michael] please provide a complete working app.js. -</li>
<li>Srikanth Sombhatla 2016-01-28

   [~lchoudhary] You can use this app.js
   
   <code><pre>
       var self = Ti.UI.createWindow();
       var cameraOverlay = Titanium.UI.createView({
       	backgroundColor: '#FF00FFAA'
       });
     
       var cameraOverlayButton = Titanium.UI.createImageView({
           bottom: 100,
           image: '/appcelerator_small.png',
       });
       cameraOverlay.add(cameraOverlayButton);
     
       cameraOverlay.addEventListener('click', function(e){
       	Ti.API.info("taking pic");
           Ti.Media.takePicture();
       });
     
       self.addEventListener("postlayout", postlayoutHandler);
       function postlayoutHandler(e) {
           self.removeEventListener("postlayout", postlayoutHandler);
           Titanium.Media.showCamera({
               overlay: cameraOverlay,
               showControls: false,
               success: function(e) {
                     Ti.API.info('# SUCCESS : '+ JSON.stringify(e));
               },
               cancel: function(e) {
                     Ti.API.info('# CANCEL : '+e.error);
                  
               },
               error: function(e) {
                     Ti.API.info('# ERROR : '+ e.code +' : '+ e.error);
                  
               },
               mediaTypes:Ti.Media.MEDIA_TYPE_PHOTO,
           });
       }
       self.open();
   </pre></code>
   
   Also there is a dependency on TIMOB-19769 which will crash when camera overlay is used. 
   
   </li>
<li>Michael Gangolf 2016-01-28

   Thanks for the example! It only works when takePicture() is called (so not with the basic camera controls). The other callback should be here <a href="https://github.com/ashcoding/titanium_mobile/blob/da0ba48a38b07142e53a99ca1af7023ee727af5f/android/modules/media/src/java/ti/modules/titanium/media/MediaModule.java#L952" rel="nofollow" target="_blank">https://github.com/ashcoding/titanium_mobile/blob/da0ba48a38b07142e53a99ca1af7023ee727af5f/android/modules/media/src/java/ti/modules/titanium/media/MediaModule.java#L952</a> but I need to see how I get the getOptimalPreviewSize() value there</li>
<li>Srikanth Sombhatla 2016-02-01

   [~michael] previewRect makes sense when used with overlay, because native camera control is not used when a overlay is provided in <code>showCamera</code>. -In such case the <code>previewRect</code> should be {-1, -1} as with <code>cropRect</code>.- The same should be updated in docs. 
   Can you update the PR accordingly ?
   
   -It can be updated here <a href="https://github.com/ashcoding/titanium_mobile/blob/da0ba48a38b07142e53a99ca1af7023ee727af5f/android/modules/media/src/java/ti/modules/titanium/media/MediaModule.java#L917-" rel="nofollow" target="_blank">https://github.com/ashcoding/titanium_mobile/blob/da0ba48a38b07142e53a99ca1af7023ee727af5f/android/modules/media/src/java/ti/modules/titanium/media/MediaModule.java#L917-</a></li>
<li>Michael Gangolf 2016-02-01

   Sure I'll do that! Thanks for the hint. Will update the PR  in the next days</li>
<li>Michael Gangolf 2016-02-01

   output of showCamera without camera overlay will not have previewRect
   
   <code><pre>
   Titanium.Media.showCamera({
           success: function(e) {
               Ti.API.info('# SUCCESS : ' + JSON.stringify(e));
           },
           mediaTypes: Ti.Media.MEDIA_TYPE_PHOTO
       });
   </pre></code>
   
   
   <code><pre>
   {
     "y": 0,
     "x": 0,
     "height": 3264,
     "width": 1836,
     "media": {
       "file": {...},
       "nativePath": "file:///data/data/com.miga.test/app_appdata/tia1453756826134.jpg",
       "height": 3264,
       "length": 1857467,
       "width": 1836,
       "mimeType": "image/jpeg",
       "apiName": "Ti.Blob",
       "text": null,
       "type": 1,
       "bubbleParent": true
     },
     "mediaType": "public.image",
     "code": 0,
     "cropRect": {
       "height": 3264,
       "width": 1836,
       "y": 0,
       "x": 0
     },
     "success": true
   }
   </pre></code>
   
   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7660" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7660</a></li>
<li>Srikanth Sombhatla 2016-02-02

    Updates to documentation
    5_2_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7665" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7665</a>
    master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7666" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7666</a></li>
<li>Ashraf Abu 2016-02-02

    5_2_X (7665) and Master (7666) PR for documentation merged. </li>
<li>Michael Gangolf 2016-02-02

    Should I leave it like it is now (undefined if its not used). Or should I create a correct PR with -1?</li>
<li>Srikanth Sombhatla 2016-02-02

    [~michael] You can leave it like that. We just added the documentation changes. Thanks for the effort!</li>
<li>Srikanth Sombhatla 2016-02-03

    [~lchoudhary] Sorry for the confusion. We made that behaviour inline with other properties such that it is undefined when not present. 
    To recap <code>previewRect</code> is present when camera overlay is used. Other cases it is undefined. </li>
<li>Lokesh Choudhary 2016-02-04

    Verified the addition of previewRect(height,width). 
    We see previewRect in the logs only when camera overlay is used.
    
    Closing.
    
    Environment:
    Appc Studio : 4.5.0.201601262138
    Ti SDK :  5.2.0.v20160203093451
    Ti CLI : 5.0.6
    Alloy : 1.7.33
    MAC Yosemite : 10.10.5
    Appc NPM : 4.2.3-2
    Appc CLI : 5.2.0-242
    Node: 4.2.2
    Nexus 6P - Android 6.0</li>
</ol>


<p><a href="/TIMOB/TIMOB-19597.json">JSON Source</a></p>