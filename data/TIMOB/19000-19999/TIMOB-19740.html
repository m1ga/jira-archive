---
title: "[TIMOB-19740] xcdatamodel file not included when building application"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 4.1.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>Community, engArch</td></tr>
<tr><th>Reporter</th><td>Jim Villa</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2015-10-14T12:38:00.000+0000</td></tr>
<tr><th>Updated</th><td>2019-12-13T17:28:28.000+0000</td></tr>
</table>

<h3>Description</h3>

I am having an issue with a module I built. The iOS native module contains a xcdatamodel file which is a database for storing data, this file is not being built with app but if I copy the file to the app after it is built in xcode everything works and file is recognized in app. The problem is when I rebuild it removes the file again, or when I submit to apple store. I know you dont support core data but I just need to know how to include this file in the build process.  Provide me with an email address and I can share my dropbox account with the app and module if needed.

<h3>Comments</h3>

<ol>
<li>Motiur Rahman 2015-10-16

   Hi [~jamesavilla]
   Could you please show me a simple sample code that reproduces the issue? Not your full application.</li>
<li>Jim Villa 2015-10-16

   Please create a new project in appcelerator studio.  When you run that new app I need the Xcode project that is built when ran to include the .xcdatamodel file that I sent you previously in the root of the Xcode project.</li>
<li>Jim Villa 2015-11-06

   Could you please provide a full update on the status of the issue, I haven't received any feedback for a few weeks now.</li>
<li>Pedro Enrique 2015-11-09

   [~jamesavilla], take a look at [this guide](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/iOS_Module_Project-section-43288810_iOSModuleProject-BundleModuleAssets)</li>
<li>Jim Villa 2015-11-10

   @Pedro Enrique I have already tried that.  The xcdatamodel file does not get carried over to the built application.  Please add the file to your assets folder then build your application and you will see the file does not get built with the application.</li>
<li>Chris Barber 2015-12-02

   [~jamesavilla] We don't have support for adding files to the Xcode project yet. I can see Titanium supporting this someday.
   
   In the meantime, you'll need to make a CLI hook. Start by creating a directory in your module project called "hooks". Create a .js file in that hooks folder and add the following:
   
   <code><pre>
   'use strict';
   
   /** The plugin's identifier */
   exports.id = 'com.example.hook';
   
   /** The Titanium CLI version that this hook is compatible with */
   exports.cliVersion = '&gt;=3.2';
   
   /**
    * Initialize the hook.
    *
    * @param {Object} logger - The logger instance
    * @param {Object} config - The CLI config object
    * @param {CLI} cli - The CLI instance
    * @param {Object} appc - The node-appc library
    */
   exports.init = function init(logger, config, cli, appc) {
   	cli.on('build.ios.xcodeproject', function (data, callback) {
   		console.log(data.args[0]);
   		callback();
   	});
   };
   </pre></code>
   
   <code>data.args\[0\]</code> will be a JavaScript object containing the Xcode project. You can add file references, groups, and files to build phases to this object. When you're done, call <code>callback()</code> and the Xcode project will be written to disk.
   
   I should point out that we don't support this. You can get it to work, but it's not for the faint of heart. You will need to understand the Xcode project file format and the Xcode NPM module (<a href="https://www.npmjs.com/package/xcode)." rel="nofollow" target="_blank">https://www.npmjs.com/package/xcode).</a> This is not straight forward. Just to add a single file, you'll need to add 2-5 entries in various sections of the Xcode project. If you miss one, it won't work.
   
   Hope this helps.</li>
<li>Diego Freniche 2018-02-22

   Just had to fix this. 
   
   <h4>Problem was:</h4>
   - I have an Alloy project, with an extension. 
   - Inside the extension there's a Core Data Model "file" <code>xcmodeld</code>
   - That <code>xcmodeld</code> is correctly copied to the generated Xcode project
   - The <code>xcmodeld</code> is NOT added to the Compile Sources Build Phase of the Share Extension target. Instead you'll see an empty row
   
   <h4>Fix for the problem</h4>
   
   - adding the <code>xcmodeld</code> to the target
   
   <h4>How I did this</h4>
   
   1. Add a plugin definition to your <code>tiapp.xml</code>
   
   <code><pre>
   &lt;!-- Plugins --&gt;
       &lt;plugins&gt;
           &lt;plugin version="1.0"&gt;ti.alloy&lt;/plugin&gt;
   
           &lt;plugin version="0.1"&gt;core-data-fix&lt;/plugin&gt;
         
       &lt;/plugins&gt;
   </pre></code>
   
   2. the idea is that using that plugin we're going to manually add the missing reference to our target
   3. create a plugin in your project with this structure:
   
   {noformat}
   
   plugins/core-data-fix
   └── 0.1
       └── hooks
           ├── fix-core-data.js
           └── fix-core-data.rb
   {noformat}
   
   You should have the plugins directory with alloy inside.
   
   4. Your fix-core-data.js file is a hook that will launch before the Xcode project starts building. Should contain something like:
   
   
   <code><pre>
   
   // This hooks to the event "build.ios.xcodeproject". When building the generated Xcode project we need to add a reference
   // to the Core Data model file inside the Share extension. This is done inside the Ruby script:
   // plugins/core-data-fix/0.1/hooks/fix-core-data.rb
   
   exports.init = function (logger, config, cli, nodeappc) {
       cli.on("build.ios.xcodeproject", function (data, callback) {
           var child_process = require('child_process');
   
           // exec: spawns a shell.
           child_process.exec('plugins/core-data-fix/0.1/hooks/fix-core-data.rb', function(error, stdout, stderr){
               console.log(stdout);
               console.log(error);
           });
   
           callback();
       });
   };
   </pre></code>
   
   5. To fix our target I'll use xcodeproj, which is part of CocoaPods. So install CocoaPods if you don't have them already.
   
   
   <code><pre>
   
   #!/usr/bin/env ruby
   
   <h4>Problem: the extension Projects-Share contains a Core Data Model file that's not correctly added</h4>
   <h4>to the generated project's extension target.</h4>
   <h4>The Model Core Data file is correctly copied inside the generated Alloy Xcode project</h4>
   <h4>This ruby script adds the Model file to the extension target </h4>
   <h4>Dependencies: xcodeproj gem, which comes bundled with Cocoapods</h4>
   
   require 'pathname'
   require 'xcodeproj'
   
   class String
       # colorization
       def colorize(color_code)
         "\e[#{color_code}m#{self}\e[0m"
       end
     
       def red
         colorize(31)
       end
     
       def green
         colorize(32)
       end
     
       def yellow
         colorize(33)
       end
     
       def blue
         colorize(34)
       end
     
       def pink
         colorize(35)
       end
     
       def light_blue
         colorize(36)
       end
     end
   
   
   path_to_core_data_model =  "extensions/Projects-Share/Projects-Share/Categories/Core\ Data/Model.xcdatamodeld/"
   
   puts "************************ BEGIN SCRIPT **********************************".light_blue
   puts path_to_core_data_model.blue
   puts "************************* END SCRIPT ***********************************".light_blue
   
   path_to_project = 'build/iphone/Projects.xcodeproj/'
   
   puts path_to_project
   
   
   project = Xcodeproj::Project.open(path_to_project)
   puts project
   
   target = project.targets.first
   
   project.targets.each do |t|
       if t.name == "Projects-Share"
           target = t
           break
       end
   end
   puts target
   
   group = project["Extensions"]["Projects-Share"]["Projects-Share"]["Categories"]["Core Data"]
   
   puts group
   model = group.new_reference('Model.xcdatamodeld')
   
   target.add_file_references([model])
   project.save
   </pre></code>
   
   That's all!
   
   
   <h4>Environment:</h4>
   
   - SDK 7.0.2.GA
   - Xcode 9.2
   - macOS 10.13.3 High Sierra
   - cocoa pods 1.4.0</li>
</ol>


<p><a href="/TIMOB/TIMOB-19740.json">JSON Source</a></p>