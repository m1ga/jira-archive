---
title: "[TIMOB-19817] Android: HTTPClient multipart header error"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-10-28T21:28:00.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.0.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.1.0, Release 5.0.3, Release 5.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android</td></tr>
<tr><th>Reporter</th><td>grebulon</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2015-10-12T13:19:24.000+0000</td></tr>
<tr><th>Updated</th><td>2015-10-29T22:26:23.000+0000</td></tr>
</table>

<h3>Description</h3>

The following code (upload a blob to the server), creates malformed http header:
{noformat}
var xhr = Titanium.Network.createHTTPClient();
xhr.onload = function() {...};
xhr.open('POST',serverUrl');
xhr.send({file:aBlob,name:'something'});
{noformat}
This creates the request:
{noformat}
POST /api/1/upload/ HTTP/1.1
Accept-Encoding: identity
X-Titanium-Id: 12345678-2222-4444-8888-111111111111
Content-Type: multipart/form-data; boundary=j7D5qBH3i-pbXOzjDHVJNdQRhPBvF-Q0PUmVjZe
...
Content-Length: 56789

--j7D5qBH3i-pbXOzjDHVJNdQRhPBvF-Q0PUmVjZe
Content-Disposition: form-data; name="file""; filename="tixhr1851009574.png"
Content-Type: image/png
Content-Transfer-Encoding: binary
...
{noformat}
Note the double quotes for the name part:
Content-Disposition: form-data; name=*"file""*; filename="tixhr1851009574.png"

I've traced the bug to <code>TiHTTPClient.java</code> at <code>addFilePart(String name, ContentBody contentBody)</code>. The extra " comes when appending the filename argument.

<h3>Comments</h3>

<ol>
<li>Ashraf Abu 2015-10-28

   Master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7358" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7358</a>
   5_1_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7360" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7360</a>
   5_0_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7361" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7361</a></li>
<li>Ashraf Abu 2015-10-28

   Testing steps to ensure all is okay:-
   <code><pre>
   Titanium.UI.setBackgroundColor('#000');
    
   var win = Titanium.UI.createWindow({  
       title:'TIMOB',
       backgroundColor:'#fff'
   });
    
    
   var button = Ti.UI.createButton({title: "Press Button",
   								top: 200});
    
   button.addEventListener("click", function(e) {
   	var xhr = Ti.Network.createHTTPClient({
           onload: function(e) {
               alert("Received: Status = " + this.status + ", Value = " + this.responseText);
               Ti.API.info("Received: Status = " + this.status + ", Value = " + this.responseText);
           },
           onerror: function(e) {
               alert("Error: Status = " + this.status + ", Value = " + this.responseText, " error:" + e.error);
           }
       });
    
    	var args = {
    		name: 'testName',
    		file: Ti.Filesystem.getFile("mytestfile.txt")
    	};
    
       xhr.open("POST", "<a href="http://httpbin.org/post" rel="nofollow" target="_blank">http://httpbin.org/post</a>");
       xhr.send(args);
   });
    
   win.add(button);
    
   win.open();
   </pre></code></li>
<li>Ashraf Abu 2015-10-28

   Thanks [~buddyguards] for tracing this.</li>
<li>Lokesh Choudhary 2015-10-29

   Verified the fix.
   No HTTP multipart header error seen.
   
   Closing.
   
   
   Environment:
   Appc Studio : 4.4.0.201510290507
   Ti SDK :  5.1.0.v20151028190028 ,  5.2.0.v20151029134437, 5.0.3.v20151028143139
   Ti CLI : 5.0.5
   Alloy : 1.7.18
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.1-6
   Appc CLI : 5.1.0-38
   Node: v0.10.37
   samsung Galaxy S4 - Android 4.4.4</li>
</ol>


<p><a href="/TIMOB/TIMOB-19817.json">JSON Source</a></p>