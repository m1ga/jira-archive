---
title: "[TIMOB-19861] Alloy Collection - Dealing two or more collections at the same time causes memory leak"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shawn Lan</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2015-08-28T19:26:52.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T19:55:45.000+0000</td></tr>
</table>

<h3>Description</h3>

Create a default Alloy project with the following:

index.js
<code><pre>
Alloy.createCollection("samplea").fetch();
Alloy.createCollection("sampleb").fetch();
$.index.open();
</pre></code>

index.xml
<code><pre>
&lt;Alloy&gt;
	&lt;Window /&gt;
&lt;/Alloy&gt;
</pre></code>

models/samplea.js
<code><pre>
exports.definition = {
	config: {
		"columns": {
			"id":"INTEGER"
		},
		"adapter": {
			"type": "sql",
			"collection_name": "sampleas",
			"idAttribute":"id"
		}
	},

	extendModel : function(Model) {
		_.extend(Model.prototype, {
		});

		return Model;
	},

	extendCollection : function(Collection) {
		_.extend(Collection.prototype, {
		});

		return Collection;
	}
};
</pre></code>

models/sampleb.js
<code><pre>
exports.definition = {
	config: {
		"columns": {
			"id":"INTEGER"
		},
		"adapter": {
			"type": "sql",
			"collection_name": "samplebs",
			"idAttribute":"id"
		}
	},

	extendModel : function(Model) {
		_.extend(Model.prototype, {
		});

		return Model;
	},

	extendCollection : function(Collection) {
		_.extend(Collection.prototype, {
		});

		return Collection;
	}
};
</pre></code>

Using xCode instrument "Leaks" to monitor the app. Soon after launching the app, there appear several leaked objects.

<h3>Comments</h3>

<ol>
<li>Shawn Lan 2015-08-29

   I've done more testings. It doesn't need to be two different collections. The following produces the same result:
   <code><pre>
   Alloy.createCollection("samplea").fetch();
   Alloy.createCollection("samplea").fetch();
   </pre></code>
   
   However, if the second fetch() is run long after the first fetch(), there is no leaked object:
   <code><pre>
   Alloy.createCollection("samplea").fetch();
   setTimeout(function(){Alloy.createCollection("sampleb").fetch();},3600000);
   </pre></code></li>
<li>Sharif AbuDarda 2015-11-04

   Hello, This is still a bug in the latest releases. I tested with Studio 4.3.3.201510212245. Ti SDK 5.0.2.GA and iOS 9.1. The memory leak occurs. I also tried [~shawnlan] test with two similar collections. The result still the same. Thanks.</li>
</ol>


<p><a href="/TIMOB/TIMOB-19861.json">JSON Source</a></p>