---
title: "[TIMOB-19887] Android 6.0: Issues with getting contacts info on android 6.0"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-11-12T19:37:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>qe-5.1.0</td></tr>
<tr><th>Reporter</th><td>Lokesh Choudhary</td></tr>
<tr><th>Assignee</th><td>Chee Kiat Ng</td></tr>
<tr><th>Created</th><td>2015-11-06T19:41:59.000+0000</td></tr>
<tr><th>Updated</th><td>2016-05-27T22:46:42.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description:</h4>
1. There are various issues while you try to get contacts info from android 6.0:

*Case 1*: Run the code below on android 6.0 device which has contacts:
<code><pre>
var win = Ti.UI.createWindow();
win.addEventListener("open", function(e) {
    if (Ti.Contacts.hasContactsPermissions()) {
       display();
    } else {
       Ti.Contacts.requestContactsPermissions(function(e) {
           if (e.success === true) {
              display();         
           } else {
              alert("Access denied, error: " + e.error);
           }
       });
    }
});


function display(){
	var singleValue = [
	  'recordId', 'firstName', 'middleName', 'lastName', 'fullName', 'prefix', 'suffix', 
	  'nickname', 'firstPhonetic', 'middlePhonetic', 'lastPhonetic', 'organization', 
	  'jobTitle', 'department', 'note', 'birthday', 'created', 'modified', 'kind'
	];
	var multiValue = [
	  'email', 'address', 'phone', 'instantMessage', 'relatedNames', 'date', 'url'
	];
	var people = Ti.Contacts.getAllPeople(3);
	Ti.API.info('Total contacts: ' + people.length);
	for (var i=0, ilen=people.length; i&lt;ilen; i++){
	  Ti.API.info('---------------------');
	  var person = people[i];
	  for (var j=0, jlen=singleValue.length; j&lt;jlen; j++){
	    Ti.API.info(singleValue[j] + ': ' + person[singleValue[j]]);
	  }
	  for (var j=0, jlen=multiValue.length; j&lt;jlen; j++){
	    Ti.API.info(multiValue[j] + ': ' + JSON.stringify(person[multiValue[j]]));
	  }
	}
}
win.open();
</pre></code>
2. Let the app launch.
3. Grant permissions to access contacts.

<h4>Actual Result:</h4>
1. We get runtime error "Can't read property length of null".
2. This works fine on android 5.1.1.
3. In logcat I see these logs:
<code><pre>
11-06 11:25:22.326: W/TiCommonContactsApi(11772): (KrollRuntimeThread) [231,231] Contact permissions are missing
11-06 11:25:22.327: W/TiCommonContactsApi(11772): (KrollRuntimeThread) [1,232] Contact permissions are missing
11-06 11:25:22.331: I/ActivityManager(864): START u0 {act=android.content.pm.action.REQUEST_PERMISSIONS pkg=com.google.android.packageinstaller cmp=com.google.android.packageinstaller/com.android.packageinstaller.permission.ui.GrantPermissionsActivity (has extras)} from uid 10135 on display 0
11-06 11:25:22.461: I/Keyboard.Facilitator(1922): onFinishInput()
11-06 11:25:22.480: I/ActivityManager(864): Displayed com.google.android.packageinstaller/com.android.packageinstaller.permission.ui.GrantPermissionsActivity: +113ms (total +2s311ms)
11-06 11:25:23.469: W/TypeConverter(11772): jsObjectToJavaKrollDict returning null.
11-06 11:25:23.471: W/TiCommonContactsApi(11772): (KrollRuntimeThread) [1144,1376] Contact permissions are missing
11-06 11:25:23.471: E/TiContacts5(11772): (KrollRuntimeThread) [0,1376] Contacts permissions missing
11-06 11:25:23.471: D/audio_hw_primary(378): out_set_parameters: enter: usecase(1: low-latency-playback) kvpairs: routing=2
11-06 11:25:23.473: I/TiAPI(11772):  ---------------------
</pre></code>
The issue might be that even after granting permissions in reality the permissions are not really granted.

*Case 2*: Run the code below on android 6.0 device which has contacts:
<code><pre>
var win = Ti.UI.createWindow();
win.addEventListener("open", function(e) {
    if (Ti.Contacts.hasContactsPermissions()) {
       display();
    } else {
       Ti.Contacts.requestContactsPermissions(function(e) {
           if (e.success === true) {
              display();         
           } else {
              alert("Access denied, error: " + e.error);
           }
       });
    }
});


function display(){
	var btn = Ti.UI.createButton({
	       title: 'contacts'
	});
	
	btn.addEventListener('click', function() {
	    Ti.Contacts.showContacts({
	        selectedPerson: function(e) {
	
	            Ti.API.info('FullName of Selected' + e.person.fullName);
	            Ti.API.info('Organization of Selected' + e.person.organization);
	            Ti.API.info('Phone of Selected' + e.person.phone);
	            Ti.API.info('Email of Selected' + e.person.email);
	            Ti.API.info('Address of Selected' + e.person.address);
	            Ti.API.info('Phone of Selected' + e.person.phone);
	            Ti.API.info('NickName of Selected' + e.person.nickname);
	            Ti.API.info('Website of Selected' + e.person.url);
	            Ti.API.info('Related Names of Selected' + e.person.relatedNames);
	            Ti.API.info('Notes of Selected' + e.person.note);
	            //alert('FullName of Selected ' + e.person.fullName);
	
	        }
	    });
	});
	
	win.add(btn);
}
win.open();
</pre></code>
2. Let the app launch.
3. Grant permissions to access contacts.

<h4>Actual Result:</h4>
1. We get runtime error "Can't read property fullName of null" & so on for other properties as well.
2. This works fine on android 5.1.1.
3. In logcat I see:
<code><pre>
11-06 11:33:54.157: W/TiCommonContactsApi(12143): (main) [2506,7641] Contact permissions are missing
11-06 11:33:54.192: E/TiExceptionHandler(12143): (main) [35,7676] ----- Titanium Javascript Runtime Error -----
11-06 11:33:54.193: E/TiExceptionHandler(12143): (main) [1,7677] - In app.js:26,59
11-06 11:33:54.193: E/TiExceptionHandler(12143): (main) [0,7677] - Message: Uncaught TypeError: Cannot read property 'fullName' of null
11-06 11:33:54.193: E/TiExceptionHandler(12143): (main) [0,7677] - Source: 	            Ti.API.info('FullName of Selected' + e.person.fullName);
11-06 11:33:54.223: E/V8Exception(12143): Exception occurred at app.js:26: Uncaught TypeError: Cannot read property 'fullName' of null
</pre></code>
This also shows the permissions granting is sketchy.

<h4>Expected Results:</h4>
1. We should be able to read contacts & all the properties of contact on android 6.0 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-19887_57276/Screenshot_20151106-113702.png">Screenshot_20151106-113702.png</td></td><td>2015-11-06T19:41:38.000+0000</td><td>104603</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Lokesh Choudhary 2015-11-12

   This issue got fixed with TIMOB-19885.
   Closing.
   
   Environment:
   Appc Studio : 4.4.0.201511101919
   Ti SDK :  5.1.0.v20151111182050
   Ti CLI : 5.0.5
   Alloy : 1.7.24
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.1
   Appc CLI : 5.1.0-52
   Node: v0.10.37
   Nexus 6 - Android 6.0</li>
</ol>


<p><a href="/TIMOB/TIMOB-19887.json">JSON Source</a></p>