---
title: "[TIMOB-2050] Android: POST with file/blob parameter will cause issue with rails"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:57:55.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, httpclient, xhr</td></tr>
<tr><th>Reporter</th><td>Jeff Haynie</td></tr>
<tr><th>Assignee</th><td>Jeff Haynie</td></tr>
<tr><th>Created</th><td>2011-04-15T03:09:03.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:57:55.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Seems like Ruby on Rails doesn't like a Content-Type header
along side a form-data multipart. It will attempt to convert normal
form/data key/value pairs into a File Attachment (containing the
value) instead.</p>
<p>In iPhone, this Content-Type header is not present and it works
fine. So, for normal fields, we should be suppressing this header
field to have the same behavior as iOS. Removing this field causes
it to work OK.</p></div>

<h3>Comments</h3>

<ol>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/410b2dea89339e948cec2626e1c93822ed556048"
   title=
   "Changeset [410b2dea89339e948cec2626e1c93822ed556048]">[410b2dea89339e948cec2626e1c93822ed556048]</a>)
   [<a href="/projects/32238/tickets/2050" title=
   "Ticket #2050">#2050</a> state:fixed-in-qa] fixed android issue
   related to POST with Content-Type for a plain form/data field
   <a href=
   "<a href="http://github.com/appcelerator/titanium_mobile/commit/410b2dea89339e948cec2626e1c93822ed556048" rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/410b2dea89339e948cec2626e1c93822ed556048</a>">
   <a href="http://github.com/appcelerator/titanium_mobile/commit/410b2dea89339..." rel="nofollow" target="_blank">http://github.com/appcelerator/titanium_mobile/commit/410b2dea89339...</a></a></p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>How can Thomas reproduce this to move it to a resolved
   state?</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>the easiest way is to:</p>
   <ul>
   <li>
   <p>build a simple RoR app that will print out the values of the
   incoming post fields. the non-file fields should be text</p>
   </li>
   <li>
   <p>post a mixed POST with both a file and key/value pairs</p>
   </li>
   </ul></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>Thomas, I can also share the customer client code if you'd
   like.</p></div></li>
<li>kevinwhinnery 2011-04-15

   <div><p>I verified that this works on 1.5.0, Android 2.2 and 2.1. Here's
   my Rails controller code:</p>
   <pre>
   <code class=
   "ruby">class UploadController &lt; ApplicationController
     def doit
       render :text =&gt; "got #{params[:file]} and also #{params[:hello]}, request:\n#{request}"
     end
   end</code>
   </pre>
   <p>And the Titanium code:<br></p>
   <pre>
   <code class=
   "javascript">var xhr = Titanium.Network.createHTTPClient();
   var f = Titanium.Filesystem.getFile(Titanium.Filesystem.resourcesDirectory, 'KS_nav_ui.png');<br>
   <br>
   
   
   <br>
   xhr.onerror = function(e) {<br>
   <br>
   
   
   </code>
   </pre>
   <pre>
   <code class=
   "javascript"><code>Ti.API.info('IN ERROR ' + e.error);</code></code>
   </pre>
   <pre>
   
   
   <br>
   };
   xhr.onload = function(e) {
   
   </pre>
   <pre>
   <code>Ti.API.info('IN ONLOAD ' + this.responseText);</code>
   </pre>
   <pre>
   
   
   <br>
   };
   // open the client
   xhr.open('POST','<a href=
   "<a href="http://10.0.1.91:3000/upload/doit" rel="nofollow" target="_blank">http://10.0.1.91:3000/upload/doit</a>')"><a href="http://10.0.1.91:3000/upload/doit" rel="nofollow" target="_blank">http://10.0.1.91:3000/upload/doit</a>')</a>;
   
   <br>
   // send the data
   xhr.send({image:f,hello:'hello world!',password:'sanford1000',message:'check me out'});
   </pre></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>closing due to Kevins awesomeness</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2050.json">JSON Source</a></p>