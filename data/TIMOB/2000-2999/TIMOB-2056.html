---
title: "[TIMOB-2056] Android: Second launch of app keeps Facebook session logged in but FB Connect dialog shows empty"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2011-04-15T03:09:12.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Backlog</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, facebook</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:09:10.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-02T19:25:40.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>app.js:</p>
<pre>
<code class="javascript">/*global Ti, Titanium, alert, JSON */
Titanium.UI.setBackgroundColor('#000');
var win = Titanium.UI.createWindow({  
    title:'Test',
    backgroundColor:'#fff',
    exitOnClose: true
});

var fbButton = Titanium.Facebook.createLoginButton({
    'style':'wide',
    'apikey':'9494e611f2a93b8d7bfcdfa8cefdaf9f',
    'sessionProxy':'<a href="http://api.appcelerator.net/p/fbconnect/" rel="nofollow" target="_blank">http://api.appcelerator.net/p/fbconnect/</a>',
    bottom:10
});
win.add(fbButton);

var status = Ti.UI.createButton({
    title:'Publish Status', width:200, height:40, top:60
});
win.add(status);

status.addEventListener('click', function()
{
    if (!Titanium.Facebook.isLoggedIn())
    {
        Ti.UI.createAlertDialog({title:'Facebook', message:'Login before publishing to your stream'}).show();
        return;
    }

    Titanium.Facebook.publishStream("Set your status",null,null,function(r)
    {
        if (r.success)
        {
            Ti.UI.createAlertDialog({title:'Facebook', message:'Your status was published'}).show();
        }
        else
        {
            Ti.UI.createAlertDialog({title:'Facebook', message:'You canceled, or there was an error'}).show();
        }
    });
    
});

win.open();</code>
</pre>
<h2>Steps to reproduce:</h2>
<ul>
<li>
<p>Launch this app.js.</p>
</li>
<li>
<p>Use the "Connect with Facebook" button to login to Facebook.</p>
</li>
<li>
<p>After you have successfully logged in, go back to Ti Developer
and re-launch the application. (You don't need to click the
"Publish Status" button at all in this round.</p>
</li>
<li>
<p>When the application re-launches, you should see that you are
still logged into Facebook (the blue Facebook button will say
"logout" instead of "Connect with Facebook" -- i.e., you are still
logged in.)</p>
</li>
<li>
<p>Now click the "Publish Status" button. An empty Facebook Connect
view will show up instead of the expected view which should show
you fields in which to type and submit your status.</p>
</li>
</ul></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2056_18092/2056_1_4_x.diff">2056_1_4_x.diff</td></td><td>2011-04-15T03:09:11.000+0000</td><td>3993</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>Attached .diff to help with logging. Haven't committed any of
   this yet.</p></div></li>
<li>Leo Acevedo 2011-04-15

   <div><p>I could overcome this problem by erasing the activity cookies in
   FacebookModule.executeLogin.I also unsave the session so that if
   another user will log in, it will be asked for credentials.</p>
   <p>CookieSyncManager.createInstance(activity);<br>
   CookieSyncManager csm = CookieSyncManager.getInstance();<br>
   CookieManager cm = CookieManager.getInstance();<br>
   cm.removeAllCookie();<br>
   csm.sync();<br>
   session.unsave(activity);</p>
   <p>After this I still had a FileNotFoundException when loading
   <a href=
   "<a href="https://graph.facebook.com/me?var=val&amp" rel="nofollow" target="_blank">https://graph.facebook.com/me?var=val&amp</a>;...&amp;method=me"><a href="https://graph.facebook.com/me?var=val&amp" rel="nofollow" target="_blank">https://graph.facebook.com/me?var=val&amp</a>;amp;...&amp;amp;method=me</a>.
   It worked for me after commenting out the following line on
   FBRequest.java (method callWithAnyData() )</p>
   <p>mParams.put("method", mMethod);</p>
   <p>Hope this may be of help</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>With the Titanium 1.6.0 changes to the facebook module, the
   equivalent code for the above test case would now be:</p>
   <pre>
   <code class="javascript">Titanium.UI.setBackgroundColor('#000');
   Ti.Facebook.appid = "YOUR FACEBOOK APP ID";
   var win = Titanium.UI.createWindow({  
       title:'Test',
       backgroundColor:'#fff',
       exitOnClose: true
   });
   
   var fbButton = Titanium.Facebook.createLoginButton({
       'style':'wide',
       bottom:10
   });
   win.add(fbButton);
   
   var status = Ti.UI.createButton({
       title:'Publish Status', width:200, height:40, top:60
   });
   win.add(status);
   
   status.addEventListener('click', function()
   {
       if (!Titanium.Facebook.loggedIn)
       {
           Ti.UI.createAlertDialog({title:'Facebook', message:'Login before publishing to your stream'}).show();
           return;
       }
       Ti.Facebook.dialog("feed", {},function(){});
   });
   
   win.open();</code>
   </pre>
   <p>I cannot re-create the failcase with the new Facebook module, so
   I'll mark this as "invalid" (though it was not originally invalid)
   to close it.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>@Leo Acevedo: regarding destroying FB sessions, you might be
   interested in the approached described in <a href=
   "/projects/32238/tickets/3025" title="Ticket #3025">#3025</a>.</p></div></li>
<li>Leo Acevedo 2011-04-15

   <div><p>@Bill Dawson: indeed, it would have been great to know this in
   advance, thanks a lot :)</p></div></li>
<li>Lee Morris 2017-03-02

   Closed as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-2056.json">JSON Source</a></p>