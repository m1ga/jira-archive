---
title: "[TIMOB-2147] Android: PRAGMA and non-SELECT statements return null from Ti.Database.DB.execute() instead of ResultSet"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:58:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, database, db, defect, patch, pragma, resultset, sqlite</td></tr>
<tr><th>Reporter</th><td>Brion Vibber</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T03:11:51.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:58:14.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>I'm attempting to upgrade a database table from a prior revision
of my app by checking if fields are present on a table. To do this,
I'm using SQLite's PRAGMA statement:</p>
<pre>
<code class="sql">  PRAGMA table_info(account)</code>
</pre>
<p>On iOS w/ current git-master code this works fine, as well as
directly hitting databases with 'sqlite3'. However on Android,
DB.execute() returns null instead of a ResultSet object, so I
cannot access any of the returned data.</p>
<p>This appears to be because the Android TiDatabaseProxy.java
assumes that only SELECT statements can ever return data:</p>
<pre>
<code class=
"java">if(sql.trim().toLowerCase().startsWith("select")) {
    c = db.rawQuery(sql, newArgs);
    if (c != null) {
        rs = new TiResultSetProxy(getTiContext(), c);
        if (rs.isValidRow()) {
            rs.next(); // Position on first row if we have data.
        }
    } else {
        rs = new TiResultSetProxy(getTiContext(), null); // because iPhone does it this way.
    }
} else {
    if (args != null) {
        db.execSQL(sql, args);
    } else {
        db.execSQL(sql);
    }
}</code>
</pre>
<p>The iPhone implementation on the other hand doesn't make any
such assumption, and ships every query through the same code paths.
If the result info from the DB has no columns, then it returns null
instead of a ResultSet.</p></div>

<h3>Comments</h3>

<ol>
<li>Brion Vibber 2011-04-15

   <div><p>Quick fix which seems to work for me so far, but I'm not 100%
   sure on it:</p>
   <p><a href=
   "<a href="http://github.com/brion/titanium_mobile/commits/2147" rel="nofollow" target="_blank">http://github.com/brion/titanium_mobile/commits/2147</a>"><a href="http://github.com/brion/titanium_mobile/commits/2147" rel="nofollow" target="_blank">http://github.com/brion/titanium_mobile/commits/2147</a></a><br>
   <a href=
   "<a href="http://github.com/brion/titanium_mobile/commit/8d3251fca69e10df6a96a2a9ae513159494d17c3" rel="nofollow" target="_blank">http://github.com/brion/titanium_mobile/commit/8d3251fca69e10df6a96a2a9ae513159494d17c3</a>">
   <a href="http://github.com/brion/titanium_mobile/commit/8d3251fca69e10df6a96..." rel="nofollow" target="_blank">http://github.com/brion/titanium_mobile/commit/8d3251fca69e10df6a96...</a></a></p></div></li>
<li>skypanther 2011-04-15

   <div><p>I've encountered the same issue. I'm afraid I don't know how to
   try out your proposed fix, so I'll have to wait till it's
   released.</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/17b01d60fe9c3c8a8b4055c376ba3625e8dc3d29"
   title=
   "Changeset [17b01d60fe9c3c8a8b4055c376ba3625e8dc3d29]">[17b01d60fe9c3c8a8b4055c376ba3625e8dc3d29]</a>)
   [<a href="/projects/32238/tickets/2147" title=
   "Ticket #2147">#2147</a> state:fixed-in-qa] test:
   drillbit/tests/tidb/tidb.js#test_database_lh_2147. This one took
   quite awhile because you can't just switch out execSql for rawSql.
   After suffering with it for a few hours I remember that raw doesn't
   do transactions, therefore if you made sure the database was
   deleted before starting, the database would get created, but the
   Test table would not. If you happened to have another database
   around with the same table you'd get a false positive because the
   drop table would fail too. So the compromise is detect select and
   pragma queries and use rawSql otherwise use exec. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/17b01d60fe9c3c8a8b4055c376ba3625e8dc3d29" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/17b01d60fe9c3c8a8b4055c376ba3625e8dc3d29</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/17b01d60fe9c..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/17b01d60fe9c...</a></a></p></div></li>
<li>Matt Schmulen 2011-04-15

   <div><p>Resolved Titanium SDK version: 1.5.0 (12/03/10 10:38 33c2058),
   Android 1.6/2.1 Emulators, Drillbit.</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2147.json">JSON Source</a></p>