---
title: "[TIMOB-2150] Android, parse problem with URLs that contain @ in username "
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:58:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0 M03</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, xhr</td></tr>
<tr><th>Reporter</th><td>Bryan Jackson</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T03:11:59.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:58:14.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>When sending a request to XHR to the following URL:</p>
<p><a href=
"<a href="http://mike@demandocat.com:testing@api.lafitness.com/Services/Private.svc/GetCustomer" rel="nofollow" target="_blank">http://mike@demandocat.com:testing@api.lafitness.com/Services/Private.svc/GetCustomer</a>">
<a href="http://mike@demandocat.com:testing@api.lafitness.com/Services/Priva..." rel="nofollow" target="_blank">http://mike@demandocat.com:testing@api.lafitness.com/Services/Priva...</a></a></p>
<p>The request is directed to demandocat.com instead of
api.lafitness.com.</p>
<p>Some sort of issue exists parsing URLs that contain
username/passwords when they contain the @ char.</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2150_18116/after.png">after.png</td></td><td>2011-04-15T03:12:00.000+0000</td><td>54839</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2150_18115/before.png">before.png</td></td><td>2011-04-15T03:12:00.000+0000</td><td>45264</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/805f7249f4257f55c5b1a8691b13ef59669c0b84"
   title=
   "Changeset [805f7249f4257f55c5b1a8691b13ef59669c0b84]">[805f7249f4257f55c5b1a8691b13ef59669c0b84]</a>)
   [<a href="/projects/32238/tickets/2150" title=
   "Ticket #2150">#2150</a> state:fixed-in-qa] Handle @ signs in the
   username portion of the authority part of a URI. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/805f7249f4257f55c5b1a8691b13ef59669c0b84" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/805f7249f4257f55c5b1a8691b13ef59669c0b84</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/805f7249f425..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/805f7249f425...</a></a></p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>This was a "fun" one: not even the native Android Uri class
   seemed to handle this properly, whereas falling back to the Java
   URL class seems to work. Maybe if Bryan is listening, he could try
   this out with our latest build? If you use our <a href=
   "<a href="http://builds.appcelerator.com.s3.amazonaws.com/index.html" rel="nofollow" target="_blank">http://builds.appcelerator.com.s3.amazonaws.com/index.html</a>">continuous
   build server</a>, be sure to choose a build on the master branch,
   dated Nov 28 or later.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>To Appcelerator QA:</p>
   <p>We don't expose any APIs to look at the "final" url, host,
   user-authentication info, etc., so this is hard to test unless you
   use a protocol analyzer (or setup your own host server ;) ).</p>
   <p>Here's an example of me using Wireshark in before and after
   scenarios, to show the difference.</p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>... and here's a test app.js to use for it:</p>
   <pre>
   <code class="javascript">Titanium.UI.setBackgroundColor('#000');
   var URL = '<a href="http://mike@demandocat.com:testing@api.lafitness.com/Services/Private.svc/GetCustomer" rel="nofollow" target="_blank">http://mike@demandocat.com:testing@api.lafitness.com/Services/Private.svc/GetCustomer</a>';
   
   var xhr = Ti.Network.createHTTPClient();
   
   xhr.onerror = function(e) {
       Ti.API.info('XHR onerror running with message "' + e.error + '", HTTP response code  ' + xhr.status + '. If the status is "401", that is actually a good thing, as it probably means the request (which contains bogus user/password) indeed went to api.lafitness.com, as desired.  But only a protocol analyzer can confirm this.');
   };
   xhr.onload = function(e) {
       Ti.API.info('XHR onload running. HTTP response code=' + xhr.status + '. This is suspicious, as it suggests the request did not really go to api.lafitness.com, from where we would expect to get a 401, which should cause XHR onerror to run.  But only a protocol analyzer can verify what really happened.');
   };
   
   xhr.open('GET', URL);
   xhr.send();</code>
   </pre></div></li>
<li>David Pratt 2011-04-15

   <div><p>How dowes this impact <a href="/projects/32238/tickets/2149"
   title="Ticket #2149">#2149</a>? I don't understand priority.
   <a href="/projects/32238/tickets/2149" title=
   "Ticket #2149">#2149</a> given low priority while <a href=
   "/projects/32238/tickets/2150" title="Ticket #2150">#2150</a> high
   priority for same issue on two platforms</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>The iPhone team has not prioritized the issue. Our fixing of
   <a href="/projects/32238/tickets/2149" title=
   "Ticket #2149">#2149</a> has no impact positive or negative on the
   iOS issue.</p></div></li>
<li>David Pratt 2011-04-15

   <div><p>Hi. The priority on the ticket is set to Low on the ticket. Am
   finding the httpclient in iOS for most part unusable and in a
   deteriorating state. Not quite sure where to go with this as months
   are going by. I can send and receive json but in only the most
   basic way and it is virtually useless for my apps since
   authentication and transport are handicapped by issues that are
   stacking up (as long as seven months)</p>
   <p>Standard authentication schemes, setting request headers,
   getting response headers and this passing credentials in url are
   basic things you need to get done in a client lib. Despite setting
   up a decent generic method for handling http, it is not my code but
   the client that is broken, regresses and remains this way. To
   summarize the issues in iOS:</p>
   <ul>
   <li>you cannot set user and password due to this specific issue
   <a href="/projects/32238/tickets/2149" title=
   "Ticket #2149">#2149</a> Oct</li>
   <li>problem with this in callbacks for XHR issue <a href=
   "/projects/32238/tickets/519" title="Ticket #519">#519</a> since
   Mar</li>
   <li>problems with header parsing and responseData in onerror
   handler issue <a href="/projects/32238/tickets/1502" title=
   "Ticket #1502">#1502</a> Aug and workaround no longer works on
   trunk</li>
   <li>setRequestHeaders are broken again on nightly 1.5.0 that I
   obtained yesterday. This has been an ongoing regression <a href=
   "/projects/32238/tickets/1983" title="Ticket #1983">#1983</a> and
   prior to that</li>
   <li>my JSON data is now generating parse errors from recent nightly
   build since and assuming response data is XML. And why wouldn't it
   - you are unable to set an Accept header or Content-Type header so
   the client is no longer aware it is getting JSON. So the parser
   still parses but emits an error. From all indications, this began
   showing up approximately two weeks ago. Folks have been discussing
   in Q &amp; A but looks like they gave up.</li>
   </ul>
   <p>A common thing to want to do with titianium is to interact with
   a web service and has become increasingly frustrating since even
   basic authentication cannot be accomplished without setting
   authorization headers or passing credentials in a url, and JSON
   cannot be transported without errors in or in a secure way. I am
   sure you can get a sense that this is impossible to work with.</p>
   <p>Can you advise whether you employ any unit testing on your side
   to see such things before they are reported? This is second time
   round for discussing headers for me and there is no doubt others
   are not finding lighthouse to report the trouble. I believe this is
   at least a second or third regression setting request headers.</p>
   <p>If these things cannot be fixed, perhaps replacing with
   something better is a reasonable option. I have attached a link for
   a reliable general purpose http and REST lib used in many
   successful iPhone projects and which includes unit tests. Please
   forward this to someone on the iPhone team to examine for potential
   wrapping. If things do not improve, I will be looking to wrap some
   of this generic functionality.</p>
   <p><a href=
   "<a href="http://allseeing-i.com/ASIHTTPRequest/" rel="nofollow" target="_blank">http://allseeing-i.com/ASIHTTPRequest/</a>"><a href="http://allseeing-i.com/ASIHTTPRequest/" rel="nofollow" target="_blank">http://allseeing-i.com/ASIHTTPRequest/</a></a></p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>@fairwinds this is not a forum and polluting the tickets with
   information unrelated to the ticket doesn't help at all. Please
   move your comments over to the iPhone ticket and make sure they
   apply to that ticket. This is an android only ticket. Thank
   you.</p></div></li>
<li>David Pratt 2011-04-15

   <div><p>You are right of course - however the point is that tickets have
   been filed and some are now up to 7 months old. I will write
   another for requestHeaders since this is another regression of this
   issue. Not sure whether anyone there understands the impact the
   issues are having as a whole. The client is seriously crippled at
   this point. Where should this be communicated as each ticket on its
   own does not consider the scope of the issues that have left the
   client in a virtually unusable state for application
   development.</p></div></li>
<li>Matt Schmulen 2011-04-15

    <div><p>Pass Titanium SDK version: 1.5.0 (12/01/10 09:30 ac7cfd8),
    Android Sim 1.6. 2.1, custom app</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2150.json">JSON Source</a></p>