---
title: "[TIMOB-2344] Android: Crash when hiding Switch"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:58:50.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.5.0 M02</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, android_refactor, defect, regression</td></tr>
<tr><th>Reporter</th><td>Nathaniel McCallum</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T03:17:15.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:58:50.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><pre>
<code class="javascript">var win = Ti.UI.createWindow({
    top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'black'
});

var data = [];
var row = Ti.UI.createTableViewRow({title: "Test Row", hasChild: true});
data.push(row);

var tbl = Ti.UI.createTableView({
    data: data,
    top: 100, left: 0
});
win.add(tbl);

var menu = Ti.UI.Android.OptionMenu.createMenu();
var editBtn = Ti.UI.createButton({
    title: 'Edit',
    top: 0, left: 0
});

editBtn.addEventListener('click', function() {      
    for (var i in tbl.data) {
        for (var j=0 ; j &lt; tbl.data[i].rowCount ; j++) {
            var row = tbl.data[i].rowAtIndex(j);
            if (!row.cb) {
                row.cb = Ti.UI.createSwitch({
                    visible: !row.hasChild,
                    style: Ti.UI.Android.SWITCH_STYLE_CHECKBOX,
                    right: -5, // Negate the built-in pad
                });
                row.add(row.cb);
            }
            
            row.hasChild   = !row.hasChild;
            row.cb.visible = !row.cb.visible;
        }
    }
    tbl.data = tbl.data;
});
win.add(editBtn);
win.open();</code>
</pre>
<p>Click the menu button once, everything toggles as expected.
Click it a second time, crash.</p>
<p>W/KrollConverter( 3298): (kroll$3) [3470,11710] Unhandled type
conversion: value: [object TiUITableViewSection] type:
ti.modules.titanium.ui.TableViewSectionProxy, invocation:
[setProperty UI.TableView.data
ti.modules.titanium.ui.TableViewProxyBindingGen$2@48360280]<br>
F/dalvikvm( 3298): Exception!!! threadid=1: thread exiting with
uncaught exception (group=0x4001d940)</p></div>

<h3>Comments</h3>

<ol>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/22eaec7f7d8c46231e08308258450575a5add5b9"
   title=
   "Changeset [22eaec7f7d8c46231e08308258450575a5add5b9]">[22eaec7f7d8c46231e08308258450575a5add5b9]</a>)
   Switch now acts more intelligently when it's "style" attribute is
   changed. Don't recreate row proxy views if the convertedView is the
   same as the item's existing view. Remove / cleanup stale views from
   the row proxy view when setRowData is called. added a test for
   toggling hasChild / row proxy child views [<a href=
   "/projects/32238/tickets/2344" title="Ticket #2344">#2344</a>
   state:fixed-in-qa] <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/22eaec7f7d8c46231e08308258450575a5add5b9" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/22eaec7f7d8c46231e08308258450575a5add5b9</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/22eaec7f7d8c..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/22eaec7f7d8c...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/e18980e31ba5c0e061da3ababd711467471bffeb"
   title=
   "Changeset [e18980e31ba5c0e061da3ababd711467471bffeb]">[e18980e31ba5c0e061da3ababd711467471bffeb]</a>)
   pre-seed a relatively large number of row types so we can avoid
   calling setAdapter to tell the ListView about new row types (which
   causes all kinds of memory / model havoc). added a new
   forceCreateView in TiViewProxy to simply assign the internal view
   reference to a new instance, rather than forcefully tearing down
   the existing view. this fixes the className redrawing bug when the
   ListView recycler shuffles reused view instances [<a href=
   "/projects/32238/tickets/1971" title="Ticket #1971">#1971</a>
   state:fixed-in-qa] [<a href="/projects/32238/tickets/2377" title=
   "Ticket #2377">#2377</a> state:fixed-in-qa] [<a href=
   "/projects/32238/tickets/2344" title="Ticket #2344">#2344</a>]
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/e18980e31ba5c0e061da3ababd711467471bffeb" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e18980e31ba5c0e061da3ababd711467471bffeb</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/e18980e31ba5..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e18980e31ba5...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>Titanium SDK version: 1.5.0 (12/03/10 09:29 33c2058) g2 (2.2)
   sim (2.1)</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2344.json">JSON Source</a></p>