---
title: "[TIMOB-2408] iOS: Application crashes when typing HTML special characters on TextArea"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Needs more info</td></tr>
<tr><th>Resolution Date</th><td>2012-07-26T12:14:12.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.6.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Guilherme Chapiewski</td></tr>
<tr><th>Assignee</th><td>Neeraj Gupta</td></tr>
<tr><th>Created</th><td>2011-04-15T03:18:54.000+0000</td></tr>
<tr><th>Updated</th><td>2012-07-26T21:58:46.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>When I type HTML special chars on a TeaxArea, my application
crashes.</p>
<p>While monitoring the 'change' event, I noticed that Titanium is
trying to replace (at least in the logs) the HTML entities for
characters, which may be causing the error.</p>
<p>Here is the stack trace including my textarea logs:</p>
<hr>
<p><a href="/projects/32238/changesets/DEBUG" title=
"Changeset [DEBUG]">[DEBUG]</a> text is: &amp; <a href=
"/projects/32238/changesets/DEBUG" title=
"Changeset [DEBUG]">[DEBUG]</a> text is: &amp;l <a href=
"/projects/32238/changesets/DEBUG" title=
"Changeset [DEBUG]">[DEBUG]</a> text is: &amp;lt <a href=
"/projects/32238/changesets/DEBUG" title=
"Changeset [DEBUG]">[DEBUG]</a> text is: &lt; <a href=
"/projects/32238/changesets/DEBUG" title=
"Changeset [DEBUG]">[DEBUG]</a> text is: &lt; <a href=
"/projects/32238/changesets/ERROR" title=
"Changeset [ERROR]">[ERROR]</a> The application has crashed with an
unhandled exception. Stack trace: 0 CoreFoundation 0x03774b7c
<strong>exceptionPreprocess + 156<br>
1 libobjc.A.dylib 0x038c440e objc_exception_throw + 47<br>
2 CoreFoundation 0x0372d238 +[NSException raise:format:arguments:]
+ 136<br>
3 CoreFoundation 0x0372d1aa +[NSException raise:format:] + 58<br>
4 Foundation 0x005a3e00 mutateError + 218<br>
5 Foundation 0x005e5592 -[NSString
stringByReplacingCharactersInRange:withString:] + 164<br>
6 MemeiPad 0x00065237 -[TiUITextArea
textView:shouldChangeTextInRange:replacementText:] + 81<br>
7 UIKit 0x008a6074 -[UITextView
keyboardInput:shouldInsertText:isMarkedText:] + 143<br>
8 UIKit 0x008eca7b -[UIKeyboardImpl callShouldInsertText:] +
148<br>
9 UIKit 0x008f4137 -[UIKeyboardImpl addInputString:fromVariantKey:]
+ 107<br>
10 UIKit 0x008f64f8 -[UIKeyboardImpl handleKeyEvent:] + 1918<br>
11 UIKit 0x007c4e5d -[UIApplication handleEvent:withNewEvent:] +
4631<br>
12 UIKit 0x007bcb3c -[UIApplication sendEvent:] + 71<br>
13 UIKit 0x007c19bf _UIApplicationHandleEvent + 7672<br>
14 GraphicsServices 0x0535c822 PurpleEventCallback + 1550<br>
15 CoreFoundation 0x03755ff4</strong>
CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION <strong>+
52<br>
16 CoreFoundation 0x036b6807</strong> CFRunLoopDoSource1 + 215<br>
17 CoreFoundation 0x036b3a93 <strong>CFRunLoopRun + 979<br>
18 CoreFoundation 0x036b3350 CFRunLoopRunSpecific + 208<br>
19 CoreFoundation 0x036b3271 CFRunLoopRunInMode + 97<br>
20 GraphicsServices 0x0535b00c GSEventRunModal + 217<br>
21 GraphicsServices 0x0535b0d1 GSEventRun + 115<br>
22 UIKit 0x007c5af2 UIApplicationMain + 1160<br>
23 MemeiPad 0x00002e9a main + 362<br>
24 MemeiPad 0x00002571 start + 53<br>
2010-11-23 14:54:28.934 MemeiPad[35235:207]</strong>
<em>Terminating app due to uncaught exception 'NSRangeException',
reason: '</em> -[NSCFString replaceCharactersInRange:withString:]:
Range or index out of bounds'<br>
*** Call stack at first throw: ( 0 CoreFoundation 0x03774b99
exceptionPreprocess + 185<br>
1 libobjc.A.dylib 0x038c440e objc_exception_throw + 47<br>
2 CoreFoundation 0x0372d238 +[NSException raise:format:arguments:]
+ 136<br>
3 CoreFoundation 0x0372d1aa +[NSException raise:format:] + 58<br>
4 Foundation 0x005a3e00 mutateError + 218<br>
5 Foundation 0x005e5592 -[NSString
stringByReplacingCharactersInRange:withString:] + 164<br>
6 MemeiPad 0x00065237 -[TiUITextArea
textView:shouldChangeTextInRange:replacementText:] + 81<br>
7 UIKit 0x008a6074 -[UITextView
keyboardInput:shouldInsertText:isMarkedText:] + 143<br>
8 UIKit 0x008eca7b -[UIKeyboardImpl callShouldInsertText:] +
148<br>
9 UIKit 0x008f4137 -[UIKeyboardImpl addInputString:fromVariantKey:]
+ 107<br>
10 UIKit 0x008f64f8 -[UIKeyboardImpl handleKeyEvent:] + 1918<br>
11 UIKit 0x007c4e5d -[UIApplication handleEvent:withNewEvent:] +
4631<br>
12 UIKit 0x007bcb3c -[UIApplication sendEvent:] + 71<br>
13 UIKit 0x007c19bf _UIApplicationHandleEvent + 7672<br>
14 GraphicsServices 0x0535c822 PurpleEventCallback + 1550<br>
15 CoreFoundation 0x03755ff4
<strong>CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION</strong>
+ 52<br>
16 CoreFoundation 0x036b6807 <strong>CFRunLoopDoSource1 + 215<br>
17 CoreFoundation 0x036b3a93</strong> CFRunLoopRun + 979<br>
18 CoreFoundation 0x036b3350 CFRunLoopRunSpecific + 208<br>
19 CoreFoundation 0x036b3271 CFRunLoopRunInMode + 97<br>
20 GraphicsServices 0x0535b00c GSEventRunModal + 217<br>
21 GraphicsServices 0x0535b0d1 GSEventRun + 115<br>
22 UIKit 0x007c5af2 UIApplicationMain + 1160<br>
23 MemeiPad 0x00002e9a main + 362<br>
24 MemeiPad 0x00002571 start + 53<br>
) terminate called after throwing an instance of 'NSException'</p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2408_18144/logs.txt">logs.txt</td></td><td>2011-04-15T03:18:55.000+0000</td><td>3641</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Guilherme Chapiewski 2011-04-15

   <div><p>Added logs as an attachment as well.</p></div></li>
<li>Guilherme Chapiewski 2011-04-15

   <div><p>The bug stopped happening after removing the replace on
   'shouldChangeTextInRange' (TiUITextArea.m, line 136).</p>
   <p>Was:</p>
   <p>NSString *curText = [[tv text]
   stringByReplacingCharactersInRange:range withString:text];</p>
   <p>Changed to:</p>
   <p>NSString *curText = text;</p></div></li>
<li>Dawson Toth 2011-04-15

   <div><p>I have been able to reproduce this bug, but it only seems to
   happen when you also have invalid and valid HTML entities in your
   text area already.</p>
   <h1>Sample Code</h1>
   <p>Attached.</p>
   <h1>Tested On</h1>
   <p>BROKEN on iPhone Simulator 4.2</p>
   <h2>Associated Helpdesk Ticket</h2>
   <p><a href=
   "<a href="http://developer.appcelerator.com/helpdesk/view/64241" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/64241</a>"><a href="http://developer.appcelerator.com/helpdesk/view/64241" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/64241</a></a></p></div></li>
<li>Stephen Tramer 2012-07-26

   <h4>Does not include complete & valid test case.</h4>
   
   When this is resolved the ticket may be reopened.</li>
</ol>


<p><a href="/TIMOB/TIMOB-2408.json">JSON Source</a></p>