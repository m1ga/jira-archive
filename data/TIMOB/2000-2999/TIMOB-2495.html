---
title: "[TIMOB-2495] Android: Temp files created by TiHTTPClient"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-11-05T13:39:16.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-26, Release 1.7.2, Release 1.8.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Marshall Culpepper</td></tr>
<tr><th>Created</th><td>2011-04-15T03:21:15.000+0000</td></tr>
<tr><th>Updated</th><td>2011-11-05T13:39:16.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>We should ...</p>
<ul>
<li>Not use the sdcard root, and use the app's sdcard folder
instead</li>
<li>delete by pattern on boot</li>
</ul></div>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>assigned to don for mileston</p></div></li>
<li>Alan Leard 2011-04-15

   <div><p>HD Ticket Reference: <a href=
   "<a href="http://developer.appcelerator.com/helpdesk/view/76351" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/76351</a>"><a href="http://developer.appcelerator.com/helpdesk/view/76351" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/76351</a></a></p></div></li>
<li>Jon Alter 2011-05-31

   The temp files are also not being deleted. 
   
   To see the filesystem of the emulator: In terminal run 'adb -e shell' to get into the emulator filesystem. As mentioned above, the temp files are in the root of the sdcard.
   
   Can replicate in Kitchen Sink "Platform>XHR>File Download>Large File Download"
   
   Step 1: launch Kitchen Sink
   Step 2: In terminal run 'adb -e shell' to get into the emulator filesystem
   Step 3: 'cd sdcard' to get to the root of the sdcard
   Step 4: 'ls -l' in the root of the sdcard to see the contents
   Step 5: in Kitchen Sink "Platform>XHR>File Download>Large File Download"
   Step 6: 'ls -l' in the root of the sdcard to see the *tmp file created
   
   <h4>Tested With</h4>
   TiSDK 1.6.2, Android Emulator 2.2
   
   <h4>Associated Helpdesk Ticket</h4>
   <a href="http://appc.me/a/APP-646476" rel="nofollow" target="_blank">http://appc.me/a/APP-646476</a>
   
   <h4>Workaround</h4>
   <code><pre>
   xhr.onload = function () {
   	var response = xhr.responseText;
   	var nativePath = xhr.responseData.nativePath;
   	var tmpFile = Ti.Filesystem.getFile(nativePath);
   	tmpFile.deleteFile();
   };
   </pre></code></li>
<li>Pedro Enrique 2011-06-09

   <h4>Another HD Ticket</h4>
   We have another customer asking for this to be fixed:
   <a href="http://support.appcelerator.com/tickets/APP-697425/homepage" rel="nofollow" target="_blank">http://support.appcelerator.com/tickets/APP-697425/homepage</a>
   </li>
<li>Bill Dawson 2011-06-27

   That test is really sensitive to timing issues since drillbit kills the app when the test is finished, and that could be before 5 seconds have elapsed, particularly when running on device, which is so quick. I wasn't ever able to get it to delete a file in the cache using drillbit on device.  Trying emulator to see if the slower environment gets me a test run that lasts longer than 5 seconds.
   
   ... yeah that worked.</li>
<li>Marshall Culpepper 2011-06-29

   New repro sequence to account for new changes:
   
   Create an app with this code in app.js:
   <code><pre>
   
   var win = Ti.UI.createWindow({
   	backgroundColor: "white",
   	top: 0, left: 0, right: 0, bottom: 0
   });
   var doDownload = Ti.UI.createButton({
   	title: "download"
   });
   win.add(doDownload);
   doDownload.addEventListener("click", function(e) {
   	var xhr = Ti.Network.createHTTPClient();
   	xhr.onload = function() {
   		Ti.API.info("finished downloading file");
   	};
   	
   	xhr.open('GET','<a href="http://www.appcelerator.com/download-win32" rel="nofollow" target="_blank">http://www.appcelerator.com/download-win32</a>');
   	xhr.send();
   });
   win.open();
   </pre></code>
   
   Run the app, click "download", and wait for the "finished downloading file" message in logcat, then close it. Make sure a temporary file exists:
   
   <code><pre>
   $ adb shell ls /mnt/sdcard/Android/data/&lt;app_id&gt;/cache/_tmp
   </pre></code>
   
   Now, re-open the app and wait 5 or so seconds. You should see a message like this:
   
   <code><pre>
   06-29 13:29:28.674: INFO/TiTempFileHelper(8938): (pool-3-thread-1) [4579,4579] Deleting temporary file /mnt/sdcard/Android/data/com.arcaner.sandbox2/cache/_tmp/tihttp1913818548tmp
   </pre></code>
   
   Double check that it was deleted by running the same adb command as above</li>
<li>Don Thorp 2011-06-30

   merge on 1.8.0. cherry-pick into 1.7.2</li>
<li>Natalie Huynh 2011-07-06

   Tested with Nexus S 2.3.4 and Nexus One 2.2.2 with 1.7.2.v20110630161836</li>
<li>Don Thorp 2011-11-05

   Fixing labels.</li>
</ol>


<p><a href="/TIMOB/TIMOB-2495.json">JSON Source</a></p>