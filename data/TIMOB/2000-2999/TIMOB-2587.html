---
title: "[TIMOB-2587] Android: Support setting true URIs for EXTRA_STREAM"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T01:59:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.6.0 M05</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, feature, intent, release-1.6.0</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:23:39.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T01:59:32.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Our <code>IntentProxy.getData</code> is implemented by returning
<code>Intent.getDataString</code> ("The same as getData(), but
returns the URI as an encoded String" [android docs]). This means
we can't then take that information and pass it back into a new
intent's EXTRA_STREAM field. (EXTRA_STREAM: "A content: URI holding
a stream of data associated with the Intent, used with ACTION_SEND
to supply the data being sent.").<br></p>
<p>This, in turn, means we can't use our new intents and such to do
something like the following:</p>
<ul>
<li>Start the sound recorder activity and get the Uri to the
recorded sound file back.</li>
<li>Pass that uri to a picker for ACTION_SEND (so as to send the
audio file to somebody.)</li>
</ul>
<p>For example, if you try the attached win.js and select the Gmail
app as the sending mechanism, Gmail crashes with</p>
<pre>
<code>W/Bundle  (30615): Key android.intent.extra.STREAM expected Parcelable but value was a java.lang.String.  The default value &lt;null&gt; was returned.
W/Bundle  (30615): Attempt to cast generated internal exception:
W/Bundle  (30615): java.lang.ClassCastException: java.lang.String</code>
</pre></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2587_18169/win.js">win.js</td></td><td>2011-04-15T03:23:40.000+0000</td><td>2143</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>@Marshall, in <code>IntentProxy.putExtra</code> we could check
   if <code>key == Intent.EXTRA_STREAM &amp;&amp; (value instanceof
   String)</code> and then set it to a URI. But maybe we need a
   less-hacky, more general solution? (I haven't looked at all
   <code>EXTRA</code>s to see if others of them expect "non-primitive"
   data types.)</p>
   <p>You can assign back to me after answer.</p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>The formatting of my commit got messed up, here's the commit
   that fixed this:<br>
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/f4d42cf4d2e1ca7bbf3a7ca2e987e27c778191e7" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/f4d42cf4d2e1ca7bbf3a7ca2e987e27c778191e7</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/f4d42cf4d2e1..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/f4d42cf4d2e1...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>test used to verify this:</p>
   <pre>
   <code class="javascript">
   var win = Ti.UI.createWindow({
       backgroundColor: 'white'
   });
   
   // const value grabbed from
   // <a href="http://developer.android.com/reference/android/provider/MediaStore.Audio.Media.html#RECORD_SOUND_ACTION" rel="nofollow" target="_blank">http://developer.android.com/reference/android/provider/MediaStore.Audio.Media.html#RECORD_SOUND_ACTION</a>
   var RECORD_SOUND_ACTION = "android.provider.MediaStore.RECORD_SOUND";
   var soundUri = null; // Will be set as a result of recording action.
   
   var recordButton = Titanium.UI.createButton({
       top: 10, left: 10, right: 10, height: 35, title: "Record Audio"
   });
   var labelResultCaption = Titanium.UI.createLabel({
       top: 50, left: 10, right: 10, height: 35, visible: false, color: 'yellow'
   });
   var labelResult = Titanium.UI.createLabel({
       top: 90, left: 10, right: 10, height: 35, visible: false,
       backgroundColor: 'white', color: 'black',
       verticalAlign: 'top'
   });
   
   var sendButton = Titanium.UI.createButton({
       top: 130, left: 10, right: 10, height: 35, 
       title: "Share Recorded Audio", visible: false
   });
   sendButton.addEventListener('click', function(){
       var intent = Titanium.Android.createIntent({
           action: Titanium.Android.ACTION_SEND,
           type: 'application/octet-stream'
       });
       intent.putExtraUri(Titanium.Android.EXTRA_STREAM, soundUri);
       var chooserIntent = Titanium.Android.createIntentChooser(intent, 'Send Sound via');
       Titanium.Android.currentActivity.startActivity(chooserIntent);
   });
   
   recordButton.addEventListener('click', function() {
       var intent = Titanium.Android.createIntent({ action: RECORD_SOUND_ACTION });
       Titanium.Android.currentActivity.startActivityForResult(intent, function(e) {
           if (e.error) {
               labelResultCaption.text = 'Error: ' + e.error;
               labelResultCaption.visible = true;
           } else {
               if (e.resultCode === Titanium.Android.RESULT_OK) {
                   labelResultCaption.text = 'Audio Captured.  Path to audio:';
                   soundUri = e.intent.data;
                   labelResult.text = soundUri;
                   labelResultCaption.visible = true;
                   labelResult.visible = true;
                   sendButton.visible = true;
               } else {
                   labelResultCaption.text = 'Canceled/Error? Result code: ' + e.resultCode;
                   labelResultCaption.visible = true;
               }
           }
       });
   });
   
   win.add(recordButton);
   win.add(labelResultCaption);
   win.add(labelResult);
   win.add(sendButton);
   win.open();</code>
   </pre></div></li>
<li>Opie Cyrus 2011-04-15

   <div><p>verified on droid2 2.2</p></div></li>
<li>Andre Carregal 2011-04-15

   <div><p>Could you extend the test example in order to create a new file
   with the recorded audio? How would soundUri be used in this
   case?</p></div></li>
<li>Dawson Toth 2011-04-15

   <div><p>Andre Carregal, check out this gist for an example of how to
   save the response to a file. It works on videos, but the exact same
   thing can be applied to sound recording as well. What you want is
   towards the end of the gist:</p>
   <p><a href=
   "<a href="https://gist.github.com/832488" rel="nofollow" target="_blank">https://gist.github.com/832488</a>"><a href="https://gist.github.com/832488" rel="nofollow" target="_blank">https://gist.github.com/832488</a></a></p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2587.json">JSON Source</a></p>