---
title: "[TIMOB-2762] Android Ent Defect: Can't Add Menu to currentActivity In app.js"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T02:00:01.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.6.0 M06</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, enterprise, release-1.6.0, reported-1.6.0, rplist</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Don Thorp</td></tr>
<tr><th>Created</th><td>2011-04-15T03:28:53.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T02:00:01.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><h1>Problem</h1>
<p>In the app.js,
"Titanium.Android.currentActivity.onCreateOptionsMenu = ..." does
nothing. Launching the app and pressing the menu button results in
no menu popping up.</p>
<h1>Workaround</h1>
<p>Open a window with a URL set, and the nav bar hidden, modal
true, or fullscreen true. In that JavaScript context, you can then
properly set the menu.</p>
<h1>Sample Code</h1>
<p>The following code, placed alone in an app.js, demonstrates the
problem. Launch the app and press the hardware Menu button to see
that nothing pops up.</p>
<pre>
<code class="javascript">// add a menu.
Titanium.Android.currentActivity.onCreateOptionsMenu = function (e) {
    var menuItem = e.menu.add({ title: 'Window ' + i });
    menuItem.setIcon('KS_nav_ui.png');
    menuItem.addEventListener('click', function (e) {
        alert('Clicked!');
    });
};
// add some stuff to the window
var win = Titanium.UI.createWindow({
    title: 'Window One',
    backgroundColor: '#fff'
});
win.add(Titanium.UI.createLabel({
    color: '#999',
    text: 'I am Window One',
    font: { fontSize: 20, fontFamily: 'Helvetica Neue' },
    textAlign: 'center',
    width: 'auto'
}));
win.open();</code>
</pre>
<h1>My Guess at The Problem</h1>
<p>Perhaps Titanium.Android.currentActivity is not getting set in
app.js.</p>
<h2>Associated Helpdesk Ticket</h2>
<p>Andreas Sandberg, an enterprise client, reported this issue.</p></div>

<h3>Comments</h3>

<ol>
<li>Don Thorp 2011-04-15

   <div><p>May not get schedule in as there is a simple workaround.</p></div></li>
<li>Andreas sandberg 2011-04-15

   <div><p>Hey Don, the workaround mentioned above does work but since we
   have a fairly large code base already from our iphone
   implementation it means that we have to register and fire global
   events through Ti.App for the window opened with the menu
   deceleration and the global context. About 95% of our code lives in
   the global context and a large amount of data is shared between our
   tabs which can also contain about four different views per tab,
   each with a different menu need.</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>Andreas. Thanks for the heads up. I try to get this in as soon
   as I can. Fixing the title adding the enterprise tag as well.</p></div></li>
<li>Andreas sandberg 2011-04-15

   <div><p>Many thanks Don. I took a look at TiRootActivity to see what was
   happening with onCreateOptionsMenu compared to how the
   TiBaseActivity class is implemented. Looks like TiRootActivity acts
   as a boot loader of sort and is not tied into the global context.
   Since our app uses a tab group I noticed that there was a
   TiTabActivity class that was an actual activity and tried to again
   implement the onCreateOptionsMenu method but no bueno. Thanks
   again!</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>Sample code has a bug. This may be used for testing.</p>
   <pre>
   <code class="javascript">// add a menu.
   Titanium.Android.currentActivity.onCreateOptionsMenu = function (e) {
       var menuItem = e.menu.add({ title: 'Window One' });
       menuItem.setIcon('KS_nav_ui.png');
       menuItem.addEventListener('click', function (e) {
           alert('Clicked!');
       });
   };
   // add some stuff to the window
   var win = Titanium.UI.createWindow({
       title: 'Window One',
       backgroundColor: '#fff'
   });
   win.add(Titanium.UI.createLabel({
       color: '#999',
       text: 'I am Window One',
       font: { fontSize: 20, fontFamily: 'Helvetica Neue' },
       textAlign: 'center',
       width: 'auto'
   }));
   win.open();</code>
   </pre></div></li>
<li>Don Thorp 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/98b3a942bdee20383295b7e0aec14dcd9fe786c0"
   title=
   "Changeset [98b3a942bdee20383295b7e0aec14dcd9fe786c0]">[98b3a942bdee20383295b7e0aec14dcd9fe786c0]</a>)
   [<a href="/projects/32238/tickets/2762" title=
   "Ticket #2762">#2762</a> state:fixed-in-qa] refactored menu code
   into TiMenuSupport. Cleaned up a build error <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/98b3a942bdee20383295b7e0aec14dcd9fe786c0" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/98b3a942bdee20383295b7e0aec14dcd9fe786c0</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/98b3a942bdee..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/98b3a942bdee...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>verified w/ Nexus S 2.3.2</p></div></li>
<li>Don Thorp 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/a9eb1f6ede81d708cb0e8360c86483f6cd4839a4"
   title=
   "Changeset [a9eb1f6ede81d708cb0e8360c86483f6cd4839a4]">[a9eb1f6ede81d708cb0e8360c86483f6cd4839a4]</a>)
   [<a href="/projects/32238/tickets/2762" title=
   "Ticket #2762">#2762</a>] removed old menu support code that wasn't
   being used <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/a9eb1f6ede81d708cb0e8360c86483f6cd4839a4" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a9eb1f6ede81d708cb0e8360c86483f6cd4839a4</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/a9eb1f6ede81..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a9eb1f6ede81...</a></a></p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2762.json">JSON Source</a></p>