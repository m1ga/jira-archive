---
title: "[TIMOB-2792] iOS: Facebook permissions return false positives"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-08-27T12:56:11.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.6.0</td></tr>
<tr><th>Fix Version/s</th><td>Backlog</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>defect, facebook, ios, reported-1.6.0, rplist</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2011-04-15T03:29:41.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-20T16:59:32.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><h1>Problem</h1>
<p>If a user clicks "Don't Allow" when an app asks for additional
information, evt.success and hasPermission will still return "true"
for this permission, when they should return false. This false
positive only occurs in iOS, in my testing.</p>
<h1>Sample Code Demonstrating Problem</h1>
<p>The following sample code demonstrates the problem.</p>
<p>Use the following steps to reproduce in sample code:<br>
1. Click "Connect with Facebook"<br>
2. Sign in<br>
3. Click "Don't Allow"</p>
<pre>
<code class="javascript">/**
* Function that logs the user into Facebook, and makes sure they have
* granted us the "user_checkins" permission.
*/
function checkIfUserIsLoggedIntoFacebook() {
    // if user hasn't logged in yet, don't do anything
    // (they need to click the "Connect with Facebook" button)
    if (Titanium.Facebook.isLoggedIn() === false) {
    }
    // if the user hasn't given us the permissions we want, request them.
    else if (!Titanium.Facebook.hasPermission("user_checkins")) {
        Titanium.Facebook.requestPermission("user_checkins", function (evt) {
            if (evt.success) {
                alert('Permission GRANTED');
            } else {
                alert("Permission DENIED");
            }
        });
    }
    // otherwise, we should be good to go
    else {
        alert('Permission ALREADY GRANTED');
    }
}

/**
* Add a login event listener so we can check if we have all the permissions
* we want.
*/
Titanium.Facebook.addEventListener('login', function (evt) {
    if (evt.success) {
        checkIfUserIsLoggedIntoFacebook();
    }
});

// create our window
var win = Ti.UI.createWindow({ backgroundColor: '#fff' });
win.add(Ti.Facebook.createLoginButton({
    apikey: '645bf1d897d1fa8dc93ed45bc37edc04',
    secret: '49d146f85b8429438262380b85f2ebac',
    style: 'wide'
}));
win.open();</code>
</pre>
<h1>Tested On</h1>
<p>Tested on CI build 1.6.0 from January 8th, 2010.<br>
BROKEN on iPhone Simulator, 4.2<br>
WORKS on Android Simulator APIs 2.2</p>
<h2>Associated Helpdesk Ticket</h2>
<p><a href=
"<a href="http://developer.appcelerator.com/helpdesk/view/63481" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/63481</a>"><a href="http://developer.appcelerator.com/helpdesk/view/63481" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/63481</a></a></p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2792_18215/facebookrequestpermissionlog.rtf">facebookrequestpermissionlog.rtf</td></td><td>2011-04-15T03:29:42.000+0000</td><td>3481</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-2792_18216/fbconnect_perm.patch">fbconnect_perm.patch</td></td><td>2011-04-15T03:29:42.000+0000</td><td>640</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Jesus H. Christ 2011-04-15

   <div><p>The easy fix for this (short of ripping out and replacing the
   Facebook module with new code, which is ideal) is to change one
   line in the FBConnect/FBDialog.m (line 391 in Mobile SDK
   1.5.1).</p>
   <p>The line should change FROM:<br></p>
   <pre>
   <code>if ([url.resourceSpecifier isEqualToString:@"cancel"]) {</code>
   </pre>
   <p>TO:<br></p>
   <pre>
   <code>if ([[url.resourceSpecifier substringToIndex:6] isEqualToString:@"cancel"]) {</code>
   </pre>
   <p>Attached is a patch file that accomplishes that. Again, ideally,
   the new FBConnect module gets put in place which also includes new
   permissions and proper resposes to their new API. The current REST
   API is being deprecated.</p></div></li>
<li>Anthony Roldan 2011-04-15

   <div><p>Having this broken also affects
   Titanium.Facebook.requestPermission, and causes it to not pop up a
   dialog if a user previously declined it.</p>
   <p>Jesus H. Christ's patch above fixes that too, though! Thanks,
   Jesus.</p></div></li>
<li>Blain Hamon 2011-10-14

   Researching. By the way, isLoggedIn is not and was never a valid function on iOS. Use the property Titanium.Facebook.loggedIn as shown in Kitchen Sink. Similarly, there is no hasPermission, only permissions.</li>
<li>Hans Kn√∂chel 2016-08-27

   Fixed with Ti.Facebook 5.0.0 and later.</li>
<li>Lee Morris 2017-03-20

   Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-2792.json">JSON Source</a></p>