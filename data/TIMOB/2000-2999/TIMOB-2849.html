---
title: "[TIMOB-2849] Android: Set-Cookie Response Headers Only Returns Max of One Cookie"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-01-04T10:33:06.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.5.1, Release 1.6.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-39, Release 1.7.4, Release 1.8.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>enterprise, module_network, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Allen Yeung</td></tr>
<tr><th>Created</th><td>2011-04-15T03:31:06.000+0000</td></tr>
<tr><th>Updated</th><td>2014-03-13T17:45:14.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><h1>Problem</h1>
<p>On Android, the "Set-Cookie" response header from a
Ti.Network.HTTPClient will only return a max of one cookie, even if
more than one cookie is set.</p>
<p>For example, iPhone correctly returns the following:</p>
<pre>
<code class=
"javascript">this.getResponseHeader('Set-Cookie') == 'CookieName1=CookieValue1; path=/, CookieName2=CookieValue2; path=/';</code>
</pre>
<p>But Android returns the following, neglecting the second
value:</p>
<pre>
<code class=
"javascript">this.getResponseHeader('Set-Cookie') == 'CookieName1=CookieValue1; path=/';</code>
</pre>
<h1>Expected Behavior</h1>
<p>A comma delimited string of name=value; path=/ cookie strings
should be returned, just like on iPhone.</p>
<h1>Tested On</h1>
<p>Tested with Titanium Mobile SDK 1.5.1 and 1.6.0 (01/06/11).<br>
FAILED on Android Device Samsung Epic 2.1<br>
PASSED on iPhone Simulator</p>
<h1>Sample Code</h1>
<p>The sample code hits a public page I have created. The "Get or
Set Cookies" button makes a request to the page, and the page will
either a) echo the cookies we sent or b) if we didn't send cookies,
send us two cookies. "Clear Cookies" asks the server to expire the
cookies.</p>
<pre>
<code class=
"javascript">var win = Titanium.UI.createWindow({ backgroundColor:'#fff' });
var testServer = '<a href="http://appc.me/Test/Cookies/" rel="nofollow" target="_blank">http://appc.me/Test/Cookies/</a>';

/**
 * Create a text area to show responses from the server.
 */
var response = Titanium.UI.createTextArea({
    left: 0, right: 0, top: 0, bottom: 30,
    value: 'Click a button below, and the response from the server will show up here!'
});
win.add(response);

/**
 * Create a button that will hit a page on a test server that echoes any cookies we send it, or sends us two cookies.
 */
var getOrSetCookies = Titanium.UI.createButton({ title : 'Get or Set Cookies', left: 0, bottom: 0, width: 150, height: 30 });
getOrSetCookies.addEventListener('click', function(e) {
    var xhr = Ti.Network.createHTTPClient();
    xhr.onload = function(e) {
        response.value = this.responseText
                + '\n\nthis.getResponseHeader(\'Set-Cookie\'): '
                + this.getResponseHeader('Set-Cookie');
    };
    xhr.open('GET', testServer + '?count=2&amp;clear=false');
    xhr.send();
});
win.add(getOrSetCookies);

/**
 * Create a button that will clear the cookies on the server (set them to expire). It will tell us how many were cleared.
 */
var clearCookies = Titanium.UI.createButton({ title : 'Clear Cookies', right: 0, bottom: 0, width: 150, height: 30 });
clearCookies.addEventListener('click', function(e) {
    var xhr = Ti.Network.createHTTPClient();
    xhr.onload = function(e) {
        response.value = this.responseText
                + '\n\nthis.getResponseHeader(\'Set-Cookie\'): '
                + this.getResponseHeader('Set-Cookie');
    };
    xhr.open('GET', testServer + '?count=2&amp;clear=true');
    xhr.send();
});
win.add(clearCookies);

win.open();</code>
</pre>
<h1>Log from Device</h1>
<p>Attached is the output from adb -d logcat. Doesn't have terribly
useful information...</p>
<h2>Associated Helpdesk Ticket</h2>
<p><a href=
"<a href="http://developer.appcelerator.com/helpdesk/view/58531" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/58531</a>"><a href="http://developer.appcelerator.com/helpdesk/view/58531" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/58531</a></a></p></div>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-2849_18228/cookieslogcat.rtf">cookieslogcat.rtf</td></td><td>2011-04-15T03:31:07.000+0000</td><td>3297</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Don Thorp 2011-04-15

   <div><p>bumping the priority for next scheduling round.</p></div></li>
<li>Miguel Vizcaino 2011-06-29

   
   <code><pre>
   var win = Titanium.UI.createWindow({
   	backgroundColor:'white'
   });
   var view = Ti.UI.createView({
   	backgroundColor:'blue',
   	top:10,
   	bottom:10,
   	right:10,
   	left:10
   });
   
   var button = Titanium.UI.createButton({
      title: 'Click',
      top:230
   });
   
   button.addEventListener('click',function(e)
   {
   	var url = '<a href="http://developer.appcelerator.com" rel="nofollow" target="_blank">http://developer.appcelerator.com</a>';
   	var xhr = Ti.Network.createHTTPClient();
   	xhr.onload = function(e) {
   		alert(this.getResponseHeader('Set-Cookie'));
   	};
   	xhr.open('GET', url);
   	xhr.setRequestHeader('Cookie', null);
   	xhr.send();
   });
   view.add(button);
   win.add(view);
   win.open();
   </pre></code> 
   
   
   <h4>Associated Helpdesk Ticket</h4>
   <a href="http://support.appcelerator.com/tickets/APP-937711" rel="nofollow" target="_blank">http://support.appcelerator.com/tickets/APP-937711</a>
   
   <h4>Customer Priority needs to be increased.</h4></li>
<li>Anirudh Nagesh 2011-07-08

   <h4>Associated helpdesk ticket.</h4>
   appc.me/c/APP-937711
   This is very critical for one of the customers.</li>
<li>Dawson Toth 2011-07-14

   Bumped priority up, per email from Kincy. An enterprise client is waiting on this, and there isn't a workaround that I've been able to come up with. Can I provide more info on this, or is there anything I can do to help?</li>
<li>Dawson Toth 2011-07-14

   Updated sample code to point to a working server.</li>
<li>Natalie Huynh 2011-08-25

   Tested with 1.8.0.v20110819142548
   Motorola Xoom 3.2
   Nexus One 2.2.2
   Clear Cookies show: Set 0 cookies to expire a year ago
   iPhone 4.3.4
   iPad2 4.3.2
   Clear Cookies show: Set 2 cookies to expire a year ago with the cookies and expire date</li>
<li>Alan Vaghti 2011-08-26

   Tested with same SDK as Natalie and got the same Android message (Clear Cookies show: Set 0 cookies to expire a year ago) with an Galaxy Tab 10.1 running 3.1.</li>
<li>Michael Pettiford 2012-01-04

   Reopening/closing to add/remove labels</li>
<li>jithinpv 2013-11-25

   Anvil test case added.
   PR link:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/5011" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5011</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-2849.json">JSON Source</a></p>