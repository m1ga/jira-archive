---
title: "[TIMOB-2990] Android: Window / Activity lifecycle events don't fire"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T02:00:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.6.0 M08</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>activity, android, defect, lifecycle, release-1.6.0, reported-1.6.0</td></tr>
<tr><th>Reporter</th><td>Marshall Culpepper</td></tr>
<tr><th>Assignee</th><td>Marshall Culpepper</td></tr>
<tr><th>Created</th><td>2011-04-15T03:34:15.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T02:00:37.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>Our current activity lifecycle events aren't being fired for
activities created from a heavy weight Ti.UI.Window. JS Activities
seem to work because their lifecycle seems to be the right order,
specifically:</p>
<pre>
<code class="java">
// pseudo code
public void onCreate() {
  createLayout();
  initCurrentActivity(this);
  runScript();
  fireEvent("create");
}</code>
</pre>
<p>The heavy weight window lifecycle however looks more like:</p>
<pre>
<code class="java">
// pseudo code
public TiUIWindow() {
  startActivity();
}
public void onActivityCreated() {
  // script isn't even executed until after onCreate()
  initCurrentActivity(this);
  runScript();
}</code>
</pre>
<p>This is affecting a lot of our new sensor and sound API
refactors that depend on pause/resume to work for correct
add/remove event listener behavior.</p></div>

<h3>Comments</h3>

<ol>
<li>martijn189 2011-04-15

   <div><p>Is this really fixed?, i downloaded the Continuous Build of Feb
   2 2011 15:24 ra02f7db3 but i still have this issue. what does
   "Release 1.6.0 M08" mean?</p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/43ae52cacc38f22b4efa292d5ef27272560125ad"
   title=
   "Changeset [43ae52cacc38f22b4efa292d5ef27272560125ad]">[43ae52cacc38f22b4efa292d5ef27272560125ad]</a>)
   initial refactor of TiRootActivity as a TiBaseActivity, implement
   better activity lifecycle support for all TiBaseActivities
   [<a href="/projects/32238/tickets/2990" title=
   "Ticket #2990">#2990</a>]<br>
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/43ae52cacc38f22b4efa292d5ef27272560125ad" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/43ae52cacc38f22b4efa292d5ef27272560125ad</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/43ae52cacc38..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/43ae52cacc38...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/89ac3987ed38a4896f6147f4f416ccb4632f8332"
   title=
   "Changeset [89ac3987ed38a4896f6147f4f416ccb4632f8332]">[89ac3987ed38a4896f6147f4f416ccb4632f8332]</a>)
   TiJSActivity and TiRootActivity now subclass a common
   TiLaunchActivity. "launch" activities have the distinction of being
   entry points into the application either via standard user launch,
   or from some other Intent. implemented a small internal message
   queue for launch activities so window.open() doesn't block the
   activity. Activities event listeners should now always receive
   their lifecycle events synchronously: create, restart, start,
   resume, pause, stop, destroy. [<a href=
   "/projects/32238/tickets/2990" title="Ticket #2990">#2990</a>
   state:fixed-in-qa] <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/89ac3987ed38a4896f6147f4f416ccb4632f8332" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/89ac3987ed38a4896f6147f4f416ccb4632f8332</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/89ac3987ed38..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/89ac3987ed38...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/76647275afd7304f48ea8535b55a3db9e1e1f666"
   title=
   "Changeset [76647275afd7304f48ea8535b55a3db9e1e1f666]">[76647275afd7304f48ea8535b55a3db9e1e1f666]</a>)
   moved all async / blocking callbacks to a new message queue
   implementation that allows single loop iteration and provides
   better "dispatch while blocking" behavior, fixing the vast majority
   of our deadlock issues. Kitchensink is now running mostly well on
   top of these changes. Changed setTimeout/setInterval to use handler
   messages instead of timer threads for better consistency. Added an
   intermediary TiActivityWindows class between launched internal
   activities and TiUIWindow for better inline notification and
   reaction to Activity onCreate(). fixed the weird activity indicator
   as widget code in kitchensink for Android. [<a href=
   "/projects/32238/tickets/2990" title="Ticket #2990">#2990</a>]
   [<a href="/projects/32238/tickets/2924" title=
   "Ticket #2924">#2924</a>] <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/76647275afd7304f48ea8535b55a3db9e1e1f666" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/76647275afd7304f48ea8535b55a3db9e1e1f666</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/76647275afd7..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/76647275afd7...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/7996c46a2312321e35135cdc403e0ff87eafb62a"
   title=
   "Changeset [7996c46a2312321e35135cdc403e0ff87eafb62a]">[7996c46a2312321e35135cdc403e0ff87eafb62a]</a>)
   several fixes for the new lifecycle support / message queue: async
   events are now fired only using Handler, as it's safe (and
   expected) for them to fire after the script is finished loading.
   TiVideoActivity now uses one less thread and doesn't block when
   it's handling creation arguments. new Handler based timers are now
   cancelling correctly, and activity indicators no longer use two
   separate async messages for displaying (only one is needed to sync
   w/ main thread). fixed a bug where changing the title of a
   TiUIWindow always changed it for the previous window. [<a href=
   "/projects/32238/tickets/2990" title="Ticket #2990">#2990</a>]
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/7996c46a2312321e35135cdc403e0ff87eafb62a" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/7996c46a2312321e35135cdc403e0ff87eafb62a</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/7996c46a2312..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/7996c46a2312...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/2649bb83a437f122f97c4e96671ece9b04abfae0"
   title=
   "Changeset [2649bb83a437f122f97c4e96671ece9b04abfae0]">[2649bb83a437f122f97c4e96671ece9b04abfae0]</a>)
   retrieve the activity's current proxy if it was already created
   before querying a non-Activity window. [<a href=
   "/projects/32238/tickets/2990" title="Ticket #2990">#2990</a>]
   <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/2649bb83a437f122f97c4e96671ece9b04abfae0" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/2649bb83a437f122f97c4e96671ece9b04abfae0</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/2649bb83a437..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/2649bb83a437...</a></a></p></div></li>
<li>Marshall Culpepper 2011-04-15

   <div><p>This was my test case, it has instructions in the label</p>
   <pre>
   <code class="javascript">
   var win = Ti.UI.createWindow({
       backgroundColor: "white",
       layout: "vertical"
   });
   var activity = Ti.Android.currentActivity;
   
   var instructions = Ti.UI.createLabel({
       text: "initial launch should fire create, start, resume\npressing \"home\" should fire pause, stop\nrelaunching should fire restart, start, resume. pressing \"back\" should fire pause, stop, destroy\ncheck log for destroy event"
   });
   win.add(instructions);
   
   var events = ["create", "restart", "start", "resume", "pause", "stop", "destroy"];
   var rows = {};
   var data = [];
   events.forEach(function(event) {
       if (event != "destroy") {
           // we won't be able to see destroy events in UI, check the log
           rows[event] = Ti.UI.createTableViewRow({
               title: event + " fired : false",
               color: "red",
               font: { fontSize: 16 }
           });
           data.push(rows[event]);
       }
       Ti.API.debug("adding activity " + event + " listener");
       activity.addEventListener(event, function(e) {
           Ti.API.debug("[LH-2990] event fired: " + event);
           if (event != "destroy") {
               rows[event].color = "green";
               rows[event].title = event + " fired: true"
           }
       });
   });
   
   var table = Ti.UI.createTableView({
       data: data,
       top: 5, bottom: 0, left: 0, right: 0
   });
   win.add(table);
   
   win.open();</code>
   </pre></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p><a href="/projects/32238/changesets/INFO" title=
   "Changeset [INFO]">[INFO]</a> Titanium SDK version: 1.6.0 (02/08/11
   20:55 bd9d124...) galaxy tab (2.2.2) G1 (1.6) Nexus S (2.3) sim
   2.1</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-2990.json">JSON Source</a></p>