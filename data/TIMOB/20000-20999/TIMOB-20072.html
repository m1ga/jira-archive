---
title: "[TIMOB-20072] iOS: Ti.Media.saveToPhotoGallery does not call back for unsupported mime types"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-11-30T02:30:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.1.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2015-11-28T06:45:46.000+0000</td></tr>
<tr><th>Updated</th><td>2016-01-15T16:34:34.000+0000</td></tr>
</table>

<h3>Description</h3>

If you pass a File or Blob of unsupported extension/mimeType to <code>Ti.Media.saveToPhotoGallery()</code> neither of the [two callbacks](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Media-method-saveToPhotoGallery) is called and no error is logged.

This is because [the code](<a href="https://github.com/appcelerator/titanium_mobile/blob/55f45d09fd30d63e7218954658a35e86335bf29d/iphone/Classes/MediaModule.m#L776-L838)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/55f45d09fd30d63e7218954658a35e86335bf29d/iphone/Classes/MediaModule.m#L776-L838)</a> only calls the error callback when it is passed no File or Blob and not when the File or Blob is of unsupported extension/format.

*Steps*

1. Create a default project (that has <code>KS_nav_ui.png</code> in <code>Resources</code>).
2. Run with the sample code and confirm it works.
3. Switch the two <code>var file</code> lines.
4. Run again and confirm neither <code>success</code> nor <code>error</code> is called back and no error is showing in logs either.

<code><pre>
var win = Ti.UI.createWindow({  
    backgroundColor: '#fff'
});

var btn = Ti.UI.createButton({
	title: 'Click Me'
});

btn.addEventListener('click', function() {
	var file = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, 'KS_nav_ui.png');
	// var file = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, 'app.js');

	if (!file.exists()) {
		alert('File does not exist');
		return;
	}

	Ti.Media.saveToPhotoGallery(file.read(), {
		success: function(e) {
			alert('Success: ' + JSON.stringify(e));
		},
		error: function(e) {
			alert('Error: ' + JSON.stringify(e));
		}
	});
});

win.add(btn);
win.open();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2015-11-30

   Added the else-case of the mime check, corrected the miss-spelling in the error messages.
   
   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7510" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7510</a>
   Demo: See demo code above
   Screen: <a href="http://abload.de/img/simulatorscreenshot29ujsza.png" rel="nofollow" target="_blank">http://abload.de/img/simulatorscreenshot29ujsza.png</a></li>
<li>Chee Kiat Ng 2015-11-30

   CR and FT passed. PR Merged.</li>
<li>Fokke Zandbergen 2015-11-30

   Thanks for the quick fix [~hansknoechel]. I noticed one more _invalid mimeType else_ missing after [line 849](<a href="https://github.com/hansemannn/titanium_mobile/blob/3258a9c9634420c3ff3f0ba32d2c8885cc44fa10/iphone/Classes/MediaModule.m#L846-L849)." rel="nofollow" target="_blank">https://github.com/hansemannn/titanium_mobile/blob/3258a9c9634420c3ff3f0ba32d2c8885cc44fa10/iphone/Classes/MediaModule.m#L846-L849).</a></li>
<li>Eric Wieber 2016-01-15

   Verified fixed, using:
   
   MacOS 10.11.2 (15C50)
   Studio 4.4.0.201511241829
   Ti SDK 5.2.0.v20160114021251
   Appc NPM 4.2.2
   Appc CLI 5.2.0-224
   Xcode 7.2 (7C68)
   Node v0.12.7
   Java 1.7.0_80
   
   Error messages now appear for unsupported mime types in saveToPhotoGallery(). Used a modified version of the supplied test case to include more blobs and file types/extensions.</li>
</ol>


<p><a href="/TIMOB/TIMOB-20072.json">JSON Source</a></p>