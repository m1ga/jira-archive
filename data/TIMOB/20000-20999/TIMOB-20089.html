---
title: "[TIMOB-20089] Android: setting a view layout to null crashes the app"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-12-03T02:58:59.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>View, android, crash, layout</td></tr>
<tr><th>Reporter</th><td>Xavier Lacot</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2015-12-02T11:36:19.000+0000</td></tr>
<tr><th>Updated</th><td>2016-01-21T01:55:53.000+0000</td></tr>
</table>

<h3>Description</h3>

When setting a view's layout to "null", the app completely crashes:

<code><pre>
[ERROR] TiApplication: (main) [396,396] Sending event: exception on thread: main msg:java.lang.RuntimeException: Unable to start activity ComponentInfo{com.jolicode.testview/org.appcelerator.titanium.TiActivity}: java.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference; Titanium 5.0.2,2015/09/30 12:07,92c2265
[ERROR] TiApplication: java.lang.RuntimeException: Unable to start activity ComponentInfo{com.jolicode.testview/org.appcelerator.titanium.TiActivity}: java.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference
[ERROR] TiApplication: 	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2325)
[ERROR] TiApplication: 	at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2387)
[ERROR] TiApplication: 	at android.app.ActivityThread.access$800(ActivityThread.java:151)
[ERROR] TiApplication: 	at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1303)
[ERROR] TiApplication: 	at android.os.Handler.dispatchMessage(Handler.java:102)
[ERROR] TiApplication: 	at android.os.Looper.loop(Looper.java:135)
[ERROR] TiApplication: 	at android.app.ActivityThread.main(ActivityThread.java:5254)
[ERROR] TiApplication: 	at java.lang.reflect.Method.invoke(Native Method)
[ERROR] TiApplication: 	at java.lang.reflect.Method.invoke(Method.java:372)
[ERROR] TiApplication: 	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:903)
[ERROR] TiApplication: 	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:698)
[ERROR] TiApplication: Caused by: java.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference
[ERROR] TiApplication: 	at ti.modules.titanium.ui.widget.TiView.<init>(TiView.java:25)
[ERROR] TiApplication: 	at ti.modules.titanium.ui.ViewProxy.createView(ViewProxy.java:33)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.handleGetView(TiViewProxy.java:485)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.getOrCreateView(TiViewProxy.java:471)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.realizeViews(TiViewProxy.java:509)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.handleGetView(TiViewProxy.java:493)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.getOrCreateView(TiViewProxy.java:471)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.handleAdd(TiViewProxy.java:672)
[ERROR] TiApplication: 	at org.appcelerator.titanium.proxy.TiViewProxy.add(TiViewProxy.java:566)
[ERROR] TiApplication: 	at ti.modules.titanium.ui.WindowProxy.windowCreated(WindowProxy.java:237)
[ERROR] TiApplication: 	at org.appcelerator.titanium.TiActivityWindows.windowCreated(TiActivityWindows.java:33)
[ERROR] TiApplication: 	at org.appcelerator.titanium.TiBaseActivity.windowCreated(TiBaseActivity.java:458)
[ERROR] TiApplication: 	at org.appcelerator.titanium.TiBaseActivity.onCreate(TiBaseActivity.java:551)
[ERROR] TiApplication: 	at org.appcelerator.titanium.TiActivity.onCreate(TiActivity.java:18)
[ERROR] TiApplication: 	at android.app.Activity.performCreate(Activity.java:5990)
[ERROR] TiApplication: 	at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1106)
[ERROR] TiApplication: 	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2278)
[ERROR] TiApplication: 	... 10 more
</pre></code>

Steps to reproduce:

 * create a new Alloy application
 * app/controllers/index.js : 
<code><pre>
$.index.open();
</pre></code>
 * app/views/index.xml : 
<code><pre>
<Alloy>
    <Window>
	<View id="main" class="horizontal oh-shit">
            <View id="firstChild"></View>
        </View>
    </Window>
</Alloy>
</pre></code>
 * app/styles/index.tss : 
<code><pre>
'.horizontal': {
    layout: 'horizontal'
}

'.oh-shit': {
    layout: null
}
</pre></code>
 * compile and run the app, it crashes at startup on android

Reason: The [TiView class constructor](<a href="https://github.com/appcelerator/titanium_mobile/blob/bc85170157d3bebc5de1d61a9fe6e34bce84a8c9/android/modules/ui/src/java/ti/modules/titanium/ui/widget/TiView.java#L23)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/bc85170157d3bebc5de1d61a9fe6e34bce84a8c9/android/modules/ui/src/java/ti/modules/titanium/ui/widget/TiView.java#L23)</a> does not correctly check that the layout property is not null, and it crashes on line 25 when calling <code>equals()</code>.

Expected behavior: The app should not crash and the view should have the default layout (<code>LayoutArrangement.DEFAULT</code>)

<h3>Comments</h3>

<ol>
<li>Xavier Lacot 2015-12-02

   A pull request to fix this problem has been submitted in <a href="https://github.com/appcelerator/titanium_mobile/pull/7529" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7529</a></li>
<li>Tim Poulsen 2015-12-02

   I'm curious (but obviously too lazy to test) whether setting layout to <code>undefined</code> rather than <code>null</code> also causes the crash. This is how I generally handle resetting properties to their default / unset states. I hope Appc will merge your PR.</li>
<li>Ashraf Abu 2015-12-03

   Classic App.js test code:-
   <code><pre>
   var win = Ti.UI.createWindow();
    
   var view = Ti.UI.createView({
   	layout: null
   });
     
   win.add(view);
   win.open();
   </pre></code></li>
<li>Ashraf Abu 2015-12-03

   PR <a href="https://github.com/appcelerator/titanium_mobile/pull/7529" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7529</a> reviewed and merged.
   </li>
<li>Lokesh Choudhary 2016-01-21

   Verified the fix.
   
   Setting the layout property of the view to null does not crash the app/
   
   Closing.
   
   Environment:
   Appc Studio : 4.5.0.201601131150
   Ti SDK :  5.2.0.v20160114021251
   Ti CLI : 5.0.5
   Alloy : 1.7.26
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.3-1
   Appc CLI : 5.2.0-231
   Node: v0.12.27
   Nexus 6P - Android 6.0 </li>
</ol>


<p><a href="/TIMOB/TIMOB-20089.json">JSON Source</a></p>