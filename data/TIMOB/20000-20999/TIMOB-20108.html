---
title: "[TIMOB-20108] App sometimes crashes on resume"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2015-12-08T02:53:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, crash</td></tr>
<tr><th>Reporter</th><td>Collin Price</td></tr>
<tr><th>Assignee</th><td>Ashraf Abu</td></tr>
<tr><th>Created</th><td>2015-12-03T21:49:33.000+0000</td></tr>
<tr><th>Updated</th><td>2016-02-05T00:15:35.000+0000</td></tr>
</table>

<h3>Description</h3>

We have found that *sometimes* on the Android platform when a user resumes out app it crashes immediately. To the user it looks like they click on the app icon and there is a black flash and they have to click the app icon again to launch it. I have attached a log from Critterism.

From our testing and the logs it looks like it occurs when the app is backgrounded for a couple hours.

After investigating the crash log it looks like the crash occurs in the "TiBaseActivity" class. The  method "callOrientationChangedListener" is passed a null Activity object and the method fails to check for null before calling "activity.getWindowManager()".

The null activity is coming from TiApplication.getAppRootOrCurrentActivity(). I have not been able to determine a case there TiApplication.getAppRootOrCurrentActivity() should ever return null.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-20108_57671/crash.log">crash.log</td></td><td>2015-12-03T21:45:40.000+0000</td><td>11332</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Collin Price 2015-12-03

   I have tested the SDK using a build that checks for null before performing the action in the callOrientationChangedListener method and this appears to have fixed the issue. This issue is hard to reproduce though.
   
   [PR](<a href="https://github.com/appcelerator/titanium_mobile/pull/7543)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7543)</a> sent.</li>
<li>Ashraf Abu 2015-12-04

   [~CollinPrice] Thanks for the fix.
   
   How exactly do I reproduce or test this crash out?</li>
<li>Collin Price 2015-12-04

   One problem we have is that we cannot reliably recreate the crash. We have rarely seen the crash occur in person but we can see the stack trace from the crash logs in Critterism.
   
   If you actually look in TiBaseActivity class you can see that its crashing in a place that is abstracted away in the Titanium SDK. Anyone using a Window object on Android might get this type of crash too.</li>
<li>Ashraf Abu 2015-12-08

   [~CollinPrice] We can probably get this reviewed and merged.</li>
<li>Ashraf Abu 2015-12-08

   The code changes are in the <code>callOrientationChangedListener </code> method. To ensure no regressions, test with this:-
   <code><pre>
   var win = Ti.UI.createWindow({
   });
   
   win.open();
   
   Ti.Gesture.addEventListener('orientationchange', function (event) {
   
       Ti.API.info('orientationchanged!');
   
   });
   </pre></code>
   
   and this:-
   <code><pre>
   var win = Ti.UI.createWindow({
   });
   
   win.open();
   </pre></code>
   
   Rotate the devices and ensure no crashes.</li>
<li>Ashraf Abu 2015-12-08

   PR merged.</li>
<li>Collin Price 2015-12-08

   Thanks for accepting the PR. I know this was a weird one.</li>
<li>Ashraf Abu 2015-12-09

   (y)</li>
<li>Lokesh Choudhary 2016-02-05

   Verified the fix.
   
   Kept the app in the background for 2 hrs & then resumed it, no crash seen.
   
   Closing.
   
   Environment:
   Appc Studio : 4.5.0.201601262138
   Ti SDK :  5.2.0.v20160204140025
   Ti CLI : 5.0.6
   Alloy : 1.7.33
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.3-2
   Appc CLI : 5.2.0-242
   Node: 4.2.2
   Nexus 6P - Android 6.0
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-20108.json">JSON Source</a></p>