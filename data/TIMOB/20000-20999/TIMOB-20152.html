---
title: "[TIMOB-20152] iOS: Contacts.getPeopleWithName not returning multi-value fields correctly"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2016-02-16T06:34:10.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.1.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>qe-5.1.2</td></tr>
<tr><th>Reporter</th><td>Harry Bryant</td></tr>
<tr><th>Assignee</th><td>Srikanth Sombhatla</td></tr>
<tr><th>Created</th><td>2015-12-17T01:33:18.000+0000</td></tr>
<tr><th>Updated</th><td>2016-02-16T06:34:15.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description:</h4>
Whilst working on an automated test for <code>Ti.Contacts.Person</code> properties, an issue was found when attempting to retrieve the properties using <code>Ti.Contacts.getPeopleWithName</code>. fields with single string values were returned as intended, however fields with arrays such as <code>email</code> do not return the correct value (i.e. <code>[object Object]</code> or an error with be thrown using the following code: <code>Ti.API.info("person: " + person.email.home[0]);</code> ) 

However, a workaround to this issue is to use the method <code>Ti.Contacts.getPersonByIdentifier</code> , which correctly returns fields with array values. 

Confirmed that this is *not* a regression.

<h4>Steps to reproduce: </h4>
1. Create a new Classic project.
2. use demo code: 
<code><pre>
var win1 = Titanium.UI.createWindow({  
    title:'Tab 1',
    backgroundColor:'#fff'
});

var saveID = "";

var Ncook = new Object();
Ncook.firstName = "Nathaniel";
Ncook.lastName = "Cook";
Ncook.middleName = "John";
Ncook.nickname = "Fish";
Ncook.prefix = "Mr";
Ncook.suffix = "III";
Ncook.firstPhonetic = "N";
Ncook.middlePhonetic = "T";
Ncook.lastPhonetic = "A";
Ncook.organization = "appcelerator";
Ncook.department = "Cloud";
Ncook.jobTitle = "QE";
Ncook.note = "You gotta risk it, to get the biscuit";
Ncook.email = {
       home : [
           'myGmail',
          'myHotmail'
       ],
      work : [
          'myWorkemail'
       ]
   	};
// Ncook.address = "";
// Ncook.phone = "";
// Ncook.instantMessage = "";
// Ncook.relatedNames = "";
// Ncook.date = "";
// Ncook.url = "";

var singleValue = [
  'firstName', 'lastName', 'middleName', 'nickname', 'prefix', 'suffix', 'firstPhonetic', 'middlePhonetic', 'lastPhonetic', 'organization','department', 'jobTitle', 'note'
];

var multiValue = [
'email', 'address', 'phone', 'instantMessage', 'relatedNames', 'date', 'url'
];

newNathan = Ti.UI.createButton({
	title: "New Nathan",
	top: '20%'
});

newNathan.addEventListener('click', function(){
	
	var newCook = Ti.Contacts.createPerson(Ncook);
	// saveID = newCook.getIdentifier();
	// Ti.API.info(saveID);
});


button2 = Ti.UI.createButton({
	title: "Compare Nathan",
	top: '40%'
});


button2.addEventListener('click', function(){
	

 var people = Ti.Contacts.getPeopleWithName("Nathaniel");

// var people = Ti.Contacts.getPersonByIdentifier(saveID);
Ti.API.info('Total contacts: ' + people.length);

var person = people[0];  
// var person = people;

Ti.API.info("Ncook: " + Ncook.email.home[0]);
 Ti.API.info("person: " + person.email);
//Ti.API.info("person: " + person.email.home[0]);
  Ti.API.info("person: " + person.lastName);
Ti.API.info("-----------------------------------------");
 for (var j=0, jlen=singleValue.length; j&lt;jlen; j++){
 	
 if(Ncook[singleValue[j]] == person[singleValue[j]] && Ncook[singleValue[j]] != null) {
 Ti.API.info(singleValue[j] + ': ' + 'Success!');	
 } else {
 	
 	Ti.API.info('No Match');
 }}
 
 for (var i=0, jlen=multiValue.length; i&lt;jlen; i++){
 	
 if(Ncook[multiValue[i]] == person[multiValue[i]] && Ncook[multiValue[i]] != null) {
 Ti.API.info(multiValue[i] + ': ' + 'Success!');	
 } else {
 	
 	Ti.API.info('No Match');
 }}
 
 });

win1.add(button2);
win1.add(newNathan);
win1.open();
</pre></code>
3. Build to device.
4. launch app and click "New Nathan" followed by "Compare Nathan"
5. In the console, "Ncook" should return the appropriate email value, "person" will not.

<h4>Result:</h4>
calling fields with array values using <code>Ti.Contacts.GetPeopleWithName</code> will not return the appropriate values.

<h4>Expected Result:</h4>
calling fields with array values using <code>Ti.Contacts.GetPeopleWithName</code> will return the appropriate values.


<h3>Comments</h3>

<ol>
<li>Chee Kiat Ng 2015-12-17

   reminder to check for parity with android and windows.</li>
<li>Srikanth Sombhatla 2015-12-17

   [~htbryant]
   
   The person objects returned by <code>Ti.Contacts.GetPeopleWithName</code> are not JSON objects. So a subscripting like 
   <code>person[multiValue[ i ]]</code> will not work. This should be accessed as <code>person.email</code> or <code>person.phone</code> etc.
   
   Also can you provide the test case which is working with <code>Ti.Contacts.getPersonByIdentifier</code></li>
<li>Harry Bryant 2015-12-17

   [~ssombhatla] 
   
   I have also tested that way as well, if you refer to line 76 - 79 of the test code, I have created prints to logs of specific property values - <code>Ncook</code> being the original object, and <code>person</code> being the object retrieved from contacts with <code>getPeopleWithName</code> that was created with <code>Ti.Contacts.getPeopleWithName("Nathaniel")</code> . 
   
   If you check the console above the loop output, you should find that <code>Ti.API.info("person: " + person.email)</code> is not returning what is expected. 
   
   The test case for <code>Ti.Contacts.getPersonByIdentifier</code> requires the same steps as the above, with the following code: 
   <code><pre>
   var win1 = Titanium.UI.createWindow({  
       title:'Tab 1',
       backgroundColor:'#fff'
   });
   
   var saveID = "";
   
   var Ncook = new Object();
   Ncook.firstName = "Nathaniel";
   Ncook.lastName = "Cook";
   Ncook.middleName = "John";
   Ncook.nickname = "Fish";
   Ncook.prefix = "Mr";
   Ncook.suffix = "III";
   Ncook.firstPhonetic = "N";
   Ncook.middlePhonetic = "T";
   Ncook.lastPhonetic = "A";
   Ncook.organization = "appcelerator";
   Ncook.department = "Cloud";
   Ncook.jobTitle = "QE";
   Ncook.note = "You gotta risk it, to get the biscuit";
   Ncook.email = {
          home : [
              'myGmail',
             'myHotmail'
          ],
         work : [
             'myWorkemail'
          ]
      	};
   // Ncook.address = "";
   // Ncook.phone = "";
   // Ncook.instantMessage = "";
   // Ncook.relatedNames = "";
   // Ncook.date = "";
   // Ncook.url = "";
   
   var singleValue = [
     'firstName', 'lastName', 'middleName', 'nickname', 'prefix', 'suffix', 'firstPhonetic', 'middlePhonetic', 'lastPhonetic', 'organization','department', 'jobTitle', 'note'
   ];
   
   var multiValue = [
   'email', 'address', 'phone', 'instantMessage', 'relatedNames', 'date', 'url'
   ];
   
   newNathan = Ti.UI.createButton({
   	title: "New Nathan",
   	top: '20%'
   });
   
   newNathan.addEventListener('click', function(){
   	
   	var newCook = Ti.Contacts.createPerson(Ncook);
   	saveID = newCook.getIdentifier();
   	Ti.API.info(saveID);
   });
   
   
   button2 = Ti.UI.createButton({
   	title: "Compare Nathan",
   	top: '40%'
   });
   
   
   button2.addEventListener('click', function(){
   	
   
    // var people = Ti.Contacts.getPeopleWithName("Nathaniel");
   
   var people = Ti.Contacts.getPersonByIdentifier(saveID);
   Ti.API.info('Total contacts: ' + people.length);
   
   // var person = people[0];  
   var person = people;
   
   Ti.API.info("Ncook: " + Ncook.email.home[0]);
    Ti.API.info("person: " + person.email.home[0]);
     Ti.API.info("person: " + person.lastName);
   Ti.API.info("-----------------------------------------");
    for (var j=0, jlen=singleValue.length; j&lt;jlen; j++){
    	
    if(Ncook[singleValue[j]] == person[singleValue[j]] && Ncook[singleValue[j]] != null) {
    Ti.API.info(singleValue[j] + ': ' + 'Success!');	
    } else {
    	
    	Ti.API.info('No Match');
    }}
    
    for (var i=0, jlen=multiValue.length; i&lt;jlen; i++){
    	
    if(Ncook[multiValue[i]] == person[multiValue[i]] && Ncook[multiValue[i]] != null) {
    Ti.API.info(multiValue[i] + ': ' + 'Success!');	
    } else {
    	
    	Ti.API.info('No Match');
    }}
    
    });
   
   win1.add(button2);
   win1.add(newNathan);
   win1.open();
   </pre></code>
   
   *To be run on a iOS 9 device*
   
   In regards to the console statements printing <code>person.email.home[0])</code> , should it not be able to retrieve the appropriate data with the method <code>Ti.Contacts.GetPeopleWithName</code> , as it does with <code>Ti.Contacts.getPersonByIdentifier</code> ? Let me know if you any more queries.</li>
<li>Lokesh Choudhary 2015-12-17

   I checked on android with the code above & I see that <code>email</code> returns <code>[object object]</code> which in code is accessed as <code>person.email</code>
   
   Environment:
   Appc Studio : 4.4.0.201511241829
   Ti SDK :  5.1.2.v20151215104446
   Ti CLI : 5.0.5
   Alloy : 1.7.26
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.2
   Appc CLI : 5.1.0
   Node: v0.12.27
   Samsung Galaxy S4 - Android 5.0.1
   </li>
<li>Srikanth Sombhatla 2015-12-21

   [~htbryant]
   
   Thanks for providing additional info. I observe that the original app.js file is wrongly using <code>Ti.API.info("person: " + person.email)</code> at line 70. But the app.js with <code>Ti.Contacts.getPersonByIdentifier</code> is correctly using <code>Ti.API.info("person: " + person.email.home[0])</code>. 
   
   Since <code>person.email</code> returns JSON it prints [object Object]. Or you can try <code>Ti.API.info("person: " + JSON.stringify(person.email))</code> to see the complete JSON structure. 
   
   </li>
<li>Harry Bryant 2015-12-21

   [~ssombhatla] 
   
   Thanks for the clarification, found the issue was with the contacts in the device, and was due to user error. Using <code>JSON.stringify(person.email))</code> revealed that. closing ticket as invalid. </li>
</ol>


<p><a href="/TIMOB/TIMOB-20152.json">JSON Source</a></p>