---
title: "[TIMOB-20337] Parity: enabling run-on-main-thread"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-03-29T16:21:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.4.0</td></tr>
<tr><th>Components</th><td>Tooling</td></tr>
<tr><th>Labels</th><td>notable, qe-5.4.0</td></tr>
<tr><th>Reporter</th><td>Chee Kiat Ng</td></tr>
<tr><th>Assignee</th><td>Chee Kiat Ng</td></tr>
<tr><th>Created</th><td>2016-02-04T07:03:24.000+0000</td></tr>
<tr><th>Updated</th><td>2016-07-19T23:52:52.000+0000</td></tr>
</table>

<h3>Description</h3>

Both iOS and Android enables run-on-main-thread in tiapp.xml
However, the properties are placed in different locations.
We should modify iOS to be in parity with the current implementation for Android (moving it out of the <iOS> section.
See related ticket.

<h3>Comments</h3>

<ol>
<li>Chee Kiat Ng 2016-02-17

   <h4>Steps to test</h4>
   1. *appc new*
   2. in tiapp.xml, instead of putting <run-on-main-thread> under <ios> section, put it at the same level and set it to *false*
   3. *appc run -p ios*
   4. inside build folder, open the Xcode project
   5. Look in <code>Other Sources -> defines.h</code> 
   6. in tiapp.xml, set <run-on-main-thread> property to *true*
   7. Repeat 3-5
   8. in tiapp.xml, remove <run-on-main-thread> property
   9. Repeat 3-5
   
   <h4>Expected Result</h4>
   5. You will see *#define TI_USE_KROLL_THREAD* implying it is not running under main thread
   7. You will *not* see *#define TI_USE_KROLL_THREAD* implying it is running under main thread
   9. You will see *#define TI_USE_KROLL_THREAD* implying it is not running under main thread by default</li>
<li>Chee Kiat Ng 2016-02-17

   PR here: <a href="https://github.com/appcelerator/titanium_mobile/pull/7747" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7747</a></li>
<li>Chee Kiat Ng 2016-03-23

   While working on hyper loop, i realised that i made the mistake. There's still no parity between android and ios.
   on android, this is how you enable main thread:
   *<property name="run-on-main-thread" type="boolean">true</property>*
   whereas the one I implemented on iOS, it is
   *<run-on-main-thread>true</run-on-main-thread>*
   
   So before I change this again, [~cbarber], [~cwilliams] any objections for me to finalise on
   *<property name="run-on-main-thread" type="boolean">true</property>*
   for both platforms? </li>
<li>Chris Barber 2016-03-23

   As I've said before, we really should have an alternative way to specify settings in the tiapp.xml that are not bundled with the app. I proposed adding a new <code><setting></code> tag. However, I think this doesn't go far enough. We need to introduce something similar to build configurations in Xcode so that you can twiddle properties/settings per deploy type (dev/test/prod) which is similar to Xcode's debug/release. I proposed build profiles, but that solution may need to be refreshed.
   
   In short, it doesn't really matter what you choose to do today because it's going to change in the future.</li>
<li>Christopher Williams 2016-03-23

   [~cng] I think the property tag is fine for parity sake. As far as what [~cb1kenobi] is talking about, I think that's related to build-time only settings, whereas for this particular property, Android *needs* it at runtime inside the app to change it's behavior regarding where to run the kroll thread.</li>
<li>Chee Kiat Ng 2016-03-24

   I realised that when assigning a property type, it has to be 'bool' and not 'boolean' according to
   <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/tiapp.xml_and_timodule.xml_Reference-section-29004921_tiapp.xmlandtimodule.xmlReference-app_properties
   
   PR here that addresses this parity using 'bool', but [~cwilliams] can you check to see on Android if we should be using 'bool' or 'boolean'?
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/7878" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7878</a></li>
<li>Chee Kiat Ng 2016-03-28

   ok it's verified. It's supposed to be 'bool'.
   </li>
<li>Chee Kiat Ng 2016-03-28

   PR ready to be reviewed: <a href="https://github.com/appcelerator/titanium_mobile/pull/7878" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7878</a>
   
   <h4>Steps to test</h4>
   1. *appc new*
   2. in tiapp.xml, instead of putting <run-on-main-thread> under <ios> section, use *<property name="run-on-main-thread" type="bool">false</property>* at root
   3. *appc run -p ios*
   4. inside build folder, open the Xcode project
   5. Look in <code>Other Sources -> defines.h</code> 
   6. in tiapp.xml, use *<property name="run-on-main-thread" type="bool">true</property>*
   7. Repeat 3-5
   8. in tiapp.xml, remove *<property name="run-on-main-thread" type="bool">true</property>*
   9. Repeat 3-5
   
   <h4>Expected Result</h4>
   5. You will see *#define TI_USE_KROLL_THREAD* implying it is not running under main thread
   7. You will *not* see *#define TI_USE_KROLL_THREAD* implying it is running under main thread
   9. You will see *#define TI_USE_KROLL_THREAD* implying it is not running under main thread by default</li>
<li>Feon Sua Xin Miao 2016-03-29

   PR merged.</li>
<li>Chee Kiat Ng 2016-03-31

    [~bimmel] notable for 5.4.0</li>
<li>Josh Longton 2016-07-19

    Verified as fixed.
    Tested on:
     Mac OSX El Capitan 10.11.6
    Studio: 4.7.0.201607130543
     Ti SDK: 5.4.0.v20160713141635
     Xcode 7.3.1 
     Appc NPM: 4.2.7
    Appc CLI: 5.4.0-33 
    Node v4.4.4 
    * Closing Ticket*</li>
</ol>


<p><a href="/TIMOB/TIMOB-20337.json">JSON Source</a></p>