---
title: "[TIMOB-20356] Android Marshmallow is not showing geolocation request alert"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2016-02-12T03:14:39.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.1.2, Release 5.1.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>Android, geolocation, notable</td></tr>
<tr><th>Reporter</th><td> Ricardo Ramirez</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2016-02-05T17:14:05.000+0000</td></tr>
<tr><th>Updated</th><td>2017-06-02T19:24:33.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue Description</h4>
Trying to get user location on a device with Marshmallow on Android, the Marshmallow OS should show the geolocation request as described as follows - <a href="http://developer.android.com/training/permissions/requesting.html" rel="nofollow" target="_blank">http://developer.android.com/training/permissions/requesting.html</a>

<h4>Steps to Replicate</h4>
<h4>Create a new classic mobile default project </h4>
<h4>Paste the next code: </h4>
<code><pre>
// this sets the background color of the master UIView (when there are no windows/tab groups on it)
Titanium.UI.setBackgroundColor('#000');

var win = Titanium.UI.createWindow({  
    title:'Geolocation on Marshallow',
    backgroundColor:'#fff'
});

var label = Titanium.UI.createLabel({
	color: '#000',
	text: 'Tap Me',
	textAlign: 'center',
	left: 0,
	top: 0,
	width: Ti.UI.FILL,
	height: Ti.UI.FILL
});

Titanium.Geolocation.purpose = 'Get Current Location';

label.addEventListener('click', function (event) {
	Ti.API.error('Calling Ti.Geolocation.getCurrentPosition');
	if (Ti.Geolocation.locationServicesEnabled) {
		Ti.Geolocation.getCurrentPosition(function (event) {
			Ti.API.error('Ti.Geolocation.getCurrentPosition Callback Success: ' + event.success);
			/*
	    	Ti.UI.createAlertDialog({                                                                                                                                                                                                                                
	      		title: 'Geolocation',
	      		message: 'Success: ' + event.success,
	      		ok: 'OK'
	    	}).show();
	    	*/
	    	
			if (event.error) {
	            Ti.API.error('Error: ' + event.error);
	        } else {
	            Ti.API.info(event.coords);
	        }
	    });    
	}else{
		alert("location services not enabled");
	}    
});

win.add(label);
win.open();

</pre></code>
<h4>Run on Android Marshmallow device</h4>
<h4>Marshmallow geolocation request OS should work as described here: <a href="http://developer.android.com/training/permissions/requesting.html" rel="nofollow" target="_blank">http://developer.android.com/training/permissions/requesting.html</a></h4>

<h3>Comments</h3>

<ol>
<li>Lokesh Choudhary 2016-02-08

   If geolocation permissions are not granted on android 6.0.1 I get an alert <code>location services not enabled</code> which is the right behaviour.
   I am able to see geolocation results on Marshmellow (6.0.1) & SDK 5.1.2.GA
   My logs:
   <code><pre>
   [ERROR] :  Calling Ti.Geolocation.getCurrentPosition
   [ERROR] :  Ti.Geolocation.getCurrentPosition Callback Success: true
   [INFO] :   {"altitude":0,"speed":0,"longitude":-121.9131316,"heading":0,"latitude":37.3678666,"timestamp":1454975067563,"altitudeAccuracy":null,"accuracy":50}
   </pre></code>
   
   NOTE: You might want to do <code>JSON.Stringify</code> the <code>event.coords</code>
   <code><pre>
   Ti.API.info(JSON.stringify(event.coords));
   </pre></code>
   or else it will show <code>[Object Object]</code>
   
   
   Environment:
   Appc Studio : 4.5.0.201602070910
   Ti SDK :  5.1.2.GA
   Ti CLI : 5.0.6
   Alloy : 1.7.33
   MAC Yosemite : 10.10.5
   Appc NPM : 4.2.3-2
   Appc CLI : 5.2.0-249
   Node: 4.2.2
   Nexus 6P - Android 6.0.1</li>
<li> Ricardo Ramirez 2016-02-08

   Cool !, the request alert is showing ? </li>
<li>Lokesh Choudhary 2016-02-09

   [~rramirez], What do you mean by request alert ?
   When I tap <code>Tap Me</code> label & if location permissions are not unable I get alert <code>location services not enabled</code>. The code in the description does not ask for permissions just checks for them.</li>
<li> Ricardo Ramirez 2016-02-09

   This is the expected behavior with the request alert: 
   
    <a href="http://developer.android.com/training/permissions/requesting.html" rel="nofollow" target="_blank">http://developer.android.com/training/permissions/requesting.html</a> 
   </li>
<li>Lokesh Choudhary 2016-02-09

   [~rramirez], the white colored alert asking requesting for permission will only be seen if you request it. 
   If you want to see it then do this :
   <code><pre>
   label.addEventListener('click', function (event) {
   	Ti.API.error('Calling Ti.Geolocation.getCurrentPosition');
   	if (Ti.Geolocation.locationServicesEnabled) {
   		Ti.Geolocation.getCurrentPosition(function (event) {
   			Ti.API.error('Ti.Geolocation.getCurrentPosition Callback Success: ' + event.success);
   			/*
   	    	Ti.UI.createAlertDialog({                                                                                                                                                                                                                                
   	      		title: 'Geolocation',
   	      		message: 'Success: ' + event.success,
   	      		ok: 'OK'
   	    	}).show();
   	    	*/
   	    	
   			if (event.error) {
   	            Ti.API.error('Error: ' + event.error);
   	        } else {
   	            Ti.API.info(JSON.stringify(event.coords));
   	        }
   	    });    
   	}else{
   		Ti.Geolocation.requestLocationPermissions();
   	}    
   });
   </pre></code>
   </li>
<li> Ricardo Ramirez 2016-02-11

   Ok, now I understand, the Android request alert is not automatically prompted if you try to get the position and you don't have the permissions so you need to use the requestLocationPermissions method to show the alert, authorize the permissions and try again to get the position.  
   
   Thanks ! </li>
<li>Chee Kiat Ng 2016-02-12

   [~bimmel] This may need to be clearer in docs.</li>
<li>(deactived) Brian Immel 2016-02-12

   Added the following statement to <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Geolocation-method-requestLocationPermissions
   "If the user asks for permissions or tries to get unauthorized location information, then the app should call the request method to show the permission settings."
   
   I will publish this updated yml file next week when I push the next set of release notes.</li>
<li>Lee Morris 2017-06-02

   Closing ticket with reference to the above comments.</li>
</ol>


<p><a href="/TIMOB/TIMOB-20356.json">JSON Source</a></p>