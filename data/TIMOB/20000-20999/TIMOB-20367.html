---
title: "[TIMOB-20367] Android: TiHTTPClient leaking files when response > 512K"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-05-17T07:10:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android</td></tr>
<tr><th>Reporter</th><td>grebulon</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2016-02-04T11:51:14.000+0000</td></tr>
<tr><th>Updated</th><td>2018-07-02T21:56:59.000+0000</td></tr>
</table>

<h3>Description</h3>

The problem begins in *TiHTTPClient.java*, <code>handleEntityData()</code>.

If the response size > 512K (<code>totalSize &gt; maxBufferSize</code>) it calls <code>createFileResponseData(true)</code> and a temporary data file is created (<code>outFile = TiFileFactory.createDataFile("tihttp", "tmp")</code>).

This file is never deleted and remains in the appdata directory.

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2016-02-08

   Hello, Can you provide a full test code and steps to reproduce the issue that you are having? We will try to regenerate the issue in out environment. Please be more descriptive as possible Also please provide the full environment info in where you are generating the issue. Thanks.</li>
<li>grebulon 2016-02-08

   I don't know how to reproduce this, it happens occasionally. I can see the problem just by looking at the code.</li>
<li>Rene Pot 2017-01-19

   Having the same issue. I've got my hands on a device that has been using my app since October. There was 100mb of http client responses in there. A couple every day (even though there are many more requests done by the user/app/phone).
   
   The line of code that is creating the files is here: <a href="https://github.com/appcelerator/titanium_mobile/blob/64534e425e303fdb17834a10faf98101da440d3e/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L283" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/64534e425e303fdb17834a10faf98101da440d3e/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L283</a>
   
   I can (almost) confirm it happens > 512k. But there is 1 file that is 16kb on the device. All the others are bigger.
   
   I could imagine it having to do with the excludeFromCleanup line but I'm not familiar enough with the code to be able to conclude/confirm that
   
   <a href="https://github.com/appcelerator/titanium_mobile/blob/64534e425e303fdb17834a10faf98101da440d3e/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L271" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/64534e425e303fdb17834a10faf98101da440d3e/android/modules/network/src/java/ti/modules/titanium/network/TiHTTPClient.java#L271</a></li>
<li>Sergey Volkov 2018-05-16

   </li>
<li>grebulon 2018-05-16

   This ticket was opened over 2 years ago. They don't care.
   I'm deleting these files when the app first starts so they don't add up.</li>
<li>Sergey Volkov 2018-05-16

   <a href="https://github.com/appcelerator/titanium_mobile/pull/10055" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10055</a></li>
<li>Hans Kn√∂chel 2018-05-17

   PR merged, thanks [~s.volkov]! The patch can be applied locally today if required.</li>
<li>Samir Mohammed 2018-07-02

   *Closing ticket*. Fix verified in SDK Version <code>7.3.0.v20180628132121</code>
   
   *FR passed (Test Steps)* 
   <h4>Created an application with the following code </h4>
   <code><pre>
   const win = Ti.UI.createWindow({ backgroundColor: 'gray' }),
       client = Ti.Network.createHTTPClient({
           onload: (e) =&gt; {
               const isTemp = e.source.responseData.nativePath.includes('cache/_tmp') !== -1;
               alert(<code>path: ${e.source.responseData.nativePath}\n\nisTemp: ${isTemp}</code>);
           },
           onerror: (e) =&gt; {
               Ti.API.error(e.error);
           },
           timeout: 3000
       });
   #R
   
   client.open('GET', '<a href="https://www.nasa.gov/sites/default/files/thumbnails/image/sun_0.jpg" rel="nofollow" target="_blank">https://www.nasa.gov/sites/default/files/thumbnails/image/sun_0.jpg</a>');
   client.send();
   
   win.open();
   </pre></code>
   <h4>Ran the program</h4>
   <h4>Able to see HTTP responses save in "temp storage" instead of 'app-data://'.</h4>
   
   *Test environment*
   <code><pre>
   APPC Studio: 5.0.0.201712081732
   APPC CLI: 7.0.4
   Pixel XL (8.1.0)
   Operating System Name: Mac OS High Sierra
   Operating System Version: 10.13
   Node.js Version: 8.9.1
   Xcode 9.2
   </pre></code>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-20367.json">JSON Source</a></p>