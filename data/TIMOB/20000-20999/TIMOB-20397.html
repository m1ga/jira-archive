---
title: "[TIMOB-20397] iOS: Main-Thread: Proxies become nil if not created with pageContext"
---
<table>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Done</td></tr>
<tr><th>Resolution Date</th><td>2016-08-04T02:52:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.4.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios, mainthread</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-02-13T13:31:08.000+0000</td></tr>
<tr><th>Updated</th><td>2016-08-04T02:52:07.000+0000</td></tr>
</table>

<h3>Description</h3>

This issue occurs in several cases when we want to use a proxy (like TiBlob and TiUILivePhoto) and running on main-thread. The usual warning is <code>\[WARN\] Creating \[object TiBlob\] in a different context than the calling function.</code>. Example:
<code><pre>
Ti.Media.openPhotoGallery({
    mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO],
    success: function(e) {
      Ti.API.warn(e.mediaType);
      Ti.API.warn(e.media);
    }
  });

var win = Ti.UI.createWindow({backgroundColor: "#fff"});
win.open();
</pre></code>

It is caused because we create a blob using <code>TiBlob *media = \[\[\[TiBlob alloc\] initWithImage:resultImage\]\];</code> instead of using the page context:
<code><pre>
TiBlob *media = [[[TiBlob alloc\] _initWithPageContext:[self pageContext]] autorelease];
[media setImage:resultImage];
</pre></code>

This issue effects TIMOB-19666 and possibly many other proxies that have not been tested, yet. We need to make sure that the proxies are created properly and write unit tests to ensure their integrity.

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-03-11

   [~penrique] ping! As far as I understood, we need to init all proxies with <code>initWithPageContext</code>, otherwise it's causing the warning <code>Creating \[object &lt;TheProxy&gt;\] in a different context than the calling function</code>. So should we search all matching inits and migrate them, or is there a smarter solution that could do that automatically? And why does the warning occur only on the main thread?</li>
<li>Hans Knöchel 2016-03-15

   Related to TIMOB-20396, but we should still replace all <code>\[\[TiBlob alloc] initWithXXXX]]</code> occurrences with a proper page context initialization.</li>
<li>Hans Knöchel 2016-03-16

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/7854" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7854</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-20397.json">JSON Source</a></p>