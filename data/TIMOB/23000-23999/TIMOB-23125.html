---
title: "[TIMOB-23125] Windows: getting photo from gallery fails"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-06-28T03:45:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.2.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.4.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>gallery, image, media, qe-5.4.0</td></tr>
<tr><th>Reporter</th><td>Zakhar Zhuravlev</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2016-03-24T14:24:04.000+0000</td></tr>
<tr><th>Updated</th><td>2016-06-28T17:08:07.000+0000</td></tr>
</table>

<h3>Description</h3>

It's affected 5.2.0

Error code: -1;
Error message: 'Failed to load content from file'

*index.js:*
<code><pre>
function onTest() {
	Titanium.Media.openPhotoGallery({
 		mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO],
		success: function(e) {
			$.imageView.image = e.media;
		},
		error: function(error) {			
			Titanium.UI.createAlertDialog({
				title: error.code,
				message: error.error,
				ok: 'ok'
			}).show();
		}
	});
}

$.win.open();
</pre></code>

*index.xml:*
{noformat}
<Alloy>
    <Window id='win' backgroundColor="green" layout='vertical'>
		 <Button top='10dp' backgroundColor="blue" title='Test' onClick="onTest" />
		 <View width='300dp' height='150dp' backgroundColor='yellow' top='30dp' onClick='onImageClick' >
		 	<ImageView id='imageView' width='Ti.UI.FILL' height='Ti.UI.FILL' />
		 </View>
    </Window>
</Alloy>
{noformat}

<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2016-03-31

   There are two issues related to this. One is you needed to configure <code>picturesLibrary</code> capability in <code>tiapp.xml</code> to enable permission to access Windows photo library. The other issue is TIMOB-23115, because of that <code>ImageView</code> doesn't accept <code>Blob</code>. So this issue actually depends on TIMOB-23115. Also we'll need to update the document so we can find appropriate configuration easily.
   
   <code><pre>
   &lt;windows&gt;
     &lt;manifest&gt;
       &lt;Capabilities&gt;
         &lt;Capability Name="internetClient" /&gt; &lt;!-- in case you need Internet connection --&gt;
         &lt;Capability Name="picturesLibrary" /&gt;&lt;!-- This line is required to request access to the photo library --&gt;
       &lt;/Capabilities&gt;
     &lt;/manifest&gt;
   &lt;/windows&gt;
   </pre></code></li>
<li>Kota Iguchi 2016-04-01

   Confirmed that latest CI build (5.4.0.v20160331110910) fixes the issue. You can checkout latest build via <code>ti sdk install -b master -d</code>. Note that you'll need to set <code>picturesLibrary</code> to your <code>tiapp.xml</code> to get access to Windows pictures library like blow.
   
   <code><pre>
   &lt;windows&gt;
     &lt;manifest&gt;
       &lt;Capabilities&gt;
         &lt;Capability Name="internetClient" /&gt; &lt;!-- in case you need Internet connection --&gt;
         &lt;Capability Name="picturesLibrary" /&gt;&lt;!-- This line is required to request access to the photo library --&gt;
       &lt;/Capabilities&gt;
     &lt;/manifest&gt;
   &lt;/windows&gt;
   </pre></code></li>
<li>Josh Longton 2016-06-13

   I am still able to reproduce this issue using:
   
   *Device:* Windows Phone 10.0
   *Node.js Version:* 4.4.4
   *npm Version:* 4.2.7-2
   *Titanium SDK:* 5.4.0.v20160608165242
   *Appcelerator CLI Version:*  5.4.0-15
   *Appcelerator Studio:* 4.6.0.201605201934
   
   I have added the code below the the TiApp and used the demo code in the comments above:
   
   <code><pre>
       &lt;windows&gt;
           &lt;manifest&gt;
               &lt;Capabilities&gt;
                   &lt;Capability Name="internetClient"/&gt;
                   &lt;!-- in case you need Internet connection --&gt;
                   &lt;Capability Name="picturesLibrary"/&gt;
                   &lt;!-- This line is required to request access to the photo library --&gt;
               &lt;/Capabilities&gt;
           &lt;/manifest&gt;
       &lt;/windows&gt;
   </pre></code>
   
   
   *Reopening ticket*</li>
<li>Kota Iguchi 2016-06-14

   Turns out it's a regression.
   
   5_4_X: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/742" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/742</a>
   master: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/743" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/743</a></li>
<li>Christopher Williams 2016-06-17

   Sounds like Ewan was able to confirm the fix, so I merged the fixes to 5_4_X and master.</li>
<li>Josh Longton 2016-06-27

   I am still able to reproduce this issue application crashes or just shows a black screen using:
   
   *Device:* Windows Phone 10.0, 8.1
   *Node.js Version:* 4.4.4
   *npm Version:* 4.2.7-2
   *Titanium SDK:* 5.4.0.v20160627120037
   *Appcelerator CLI Version:*  5.4.0-18
   *Appcelerator Studio:* 4.7.0.201606150733 
   
   *App.js*
   <code><pre>
   var window = Ti.UI.createWindow({
       exitOnClose: true,
   });
   var viewParent = Ti.UI.createView({
       width: '60%',
       height: '41%',
       top: '1%'
   });
   
   var imageTaken = Ti.UI.createImageView({
       width: Ti.UI.FILL,
       height: Ti.UI.FILL,
   });
   
   var cameraImage = Ti.UI.createButton({
       title: "Choose Photos",
       bottom: '0%',
       height: '20%',
       font: {
           fontSize: 15,
           fontWeight: "bold"
       },
       width: Ti.UI.FILL,
   });
   
   viewParent.add(imageTaken);
   viewParent.add(cameraImage);
   window.add(viewParent);
   
   cameraImage.addEventListener('click', function (e) {
   
       Ti.Media.openPhotoGallery({
           autoHide: true,
           mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO],
           success: function (e) {
               if (e.mediaType === Ti.Media.MEDIA_TYPE_PHOTO) {
                   imageTaken.image = e.media;
                   Ti.API.info(JSON.stringify(e));
                   Ti.API.info(imageTaken.image);
               }
           },
           cancel: function () {
           },
           error: function (err) {
               Ti.API.error(err);
           }
       });
   
   });
   window.open();
   </pre></code>
   
   *Added to the Tiapp.xml*
   <code><pre>
       &lt;windows&gt;
           &lt;manifest&gt;
               &lt;Capabilities&gt;
                   &lt;Capability Name="internetClient"/&gt;
                   &lt;!-- in case you need Internet connection --&gt;
                   &lt;Capability Name="picturesLibrary"/&gt;
                   &lt;!-- This line is required to request access to the photo library --&gt;
               &lt;/Capabilities&gt;
           &lt;/manifest&gt;
       &lt;/windows&gt;
   </pre></code>
   
   
   
   *Reopening*</li>
<li>Kota Iguchi 2016-06-28

   [~jlongton] I was able to reproduce the crash, and it turns out it was because of <code>JSON.stringify</code> against <code>Blob</code>.
   
   When I remove <code>JSON.stringify</code> from <code>success</code> callback, it went through well for me. Can you try following?
   
   <code><pre>
           success: function (e) {
               if (e.mediaType === Ti.Media.MEDIA_TYPE_PHOTO) {
                   imageTaken.image = e.media;
               }
           },
   </pre></code>
   
   So if that's the case, it is because of <code>Blob</code>, not because of <code>Ti.Media.openPhotoGallery</code>. I would resolve this ticket, and create new ticket for Blob: TIMOB-23568</li>
<li>Josh Longton 2016-06-28

   Verified as fixed.
   Tested on:
   Microsoft Lumia 640 (8.1)
   Microsoft Lumia 640 (10)
   Windows 10 Pro
   Studio: 4.7.0.201606150733
   Ti SDK: 5.4.0.v20160627224205
   Appc NPM: 4.2.7-2
   App CLI: 5.4.0-20
   Node v4.4.4
   *Closing Ticket.*</li>
</ol>


<p><a href="/TIMOB/TIMOB-23125.json">JSON Source</a></p>