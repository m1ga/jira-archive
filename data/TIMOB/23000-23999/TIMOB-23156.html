---
title: "[TIMOB-23156] Windows: Automatically add required Capabilities to Manifest based on API usage"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-09-07T14:54:26.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2016-04-06T06:22:05.000+0000</td></tr>
<tr><th>Updated</th><td>2016-10-21T14:27:07.000+0000</td></tr>
</table>

<h3>Description</h3>

With TIMOB-18995 the user can now define Capabilities, as explained in [this guide](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/tiapp.xml_and_timodule.xml_Reference-section-29004921_tiapp.xmlandtimodule.xmlReference-Windows-specificsection).

Just like we do for most of Android and iOS it would be great if we would automatically add the required Capabilities based on API usage. So if you use <code>Ti.Media.showCamera</code> in your code, it would automatically add the _microphone_ and _webcam_ Capabilities.

<h4>Test Case</h4>

<code><pre>
var win = Ti.UI.createWindow({ backgroundColor: 'black' }),
    lbl = Ti.UI.createLabel({ top: '5%', left: 5, color: 'white' }),
    btn_a = Ti.UI.createButton({ top: '25%',color: 'white', title: 'showCamera()' }),
    btn_b = Ti.UI.createButton({ top: '35%', color: 'white', title: 'openPhotoGallery()' });

Ti.Geolocation.getCurrentPosition(function (data) {
    if (data.success) {
        lbl.text += 'getCurrentPosition()' + data.coords.latitude + ',' + data.coords.longitude;
    }
});
btn_a.addEventListener('click', function () {
    Titanium.Media.showCamera({});
});
btn_b.addEventListener('click', function () {
    Titanium.Media.openPhotoGallery({mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO]});
});

win.add(lbl);
win.add(btn_a);
win.add(btn_b);
win.open();
</pre></code>

And then build it

<code><pre>
appc ti build -p windows --wp-sdk 10.0 --target wp-device
</pre></code>

<h4>Expected</h4>

PROJECT_ROOT/build/windows/win10.ARM/Package.appxmanifest

<code><pre>
&lt;Capability Name="internetClient" /&gt;
&lt;uap:Capability Name="picturesLibrary" /&gt;
&lt;DeviceCapability Name="location" /&gt;
&lt;DeviceCapability Name="microphone" /&gt;
&lt;DeviceCapability Name="webcam" /&gt;
</pre></code>

<h3>Comments</h3>

<ol>
<li>Gary Mathews 2016-07-04

   master: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/761" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/761</a></li>
<li>Ewan Harris 2016-09-05

   Reopening ticket:
   
   OS: Windows 10 Pro
   Appc core: 6.0.0-38
   Appc NPM: 4.2.8-6
   Ti SDK: 6.0.0.v20160904203840
   
   When the last file parsed does not contain any api usage that needs a capability then the appxmanifest will not contain all the required capabilities
   
   <h4>Steps to reproduce</h4>
   
   <h4>Create a file called z.js in your apps resources folder and paste the following <code>var win = Ti.UI.createWindow({ backgroundColor: 'black' });</code></h4>
   <h4>Paste the test case from above into your app.js</h4>
   <h4>Build the project using <code>appc run -p windows -T wp-device --wp-sdk 10.0 --build-only</code></h4>
   <h4>Open the appxmanifest file in build\windows\win10.ARM</h4>
   <h4>Rename the file to a.js</h4>
   <h4>Build the project using <code>appc run -p windows -T wp-device --wp-sdk 10.0 --build-only</code></h4>
   <h4>Open the appxmanifest file in build\windows\win10.ARM</h4>
   
   <h4>Actual result</h4>
   
   At step 4 the capabilities section in the appxmanifest file matches the below
   <code><pre>
   &lt;Capabilities&gt;
       &lt;Capability Name="internetClient" /&gt;
     &lt;/Capabilities&gt;
   </pre></code>
   
   At step 7 the capabilities section in the appxmanifest file matches the below 
   
   <code><pre>
    &lt;Capabilities&gt;
       &lt;Capability Name="internetClient" /&gt;
       &lt;uap:Capability Name="picturesLibrary" /&gt;
       &lt;DeviceCapability Name="location" /&gt;
       &lt;DeviceCapability Name="microphone" /&gt;
       &lt;DeviceCapability Name="webcam" /&gt;
     &lt;/Capabilities&gt;
   </pre></code>
   
   <h4>Expected result</h4>
   
   In both cases the capabilities section in the appxmanifest file should be the same as the below
   
   <code><pre>
    &lt;Capabilities&gt;
       &lt;Capability Name="internetClient" /&gt;
       &lt;uap:Capability Name="picturesLibrary" /&gt;
       &lt;DeviceCapability Name="location" /&gt;
       &lt;DeviceCapability Name="microphone" /&gt;
       &lt;DeviceCapability Name="webcam" /&gt;
     &lt;/Capabilities&gt;
   </pre></code></li>
<li>Gary Mathews 2016-09-06

   master: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/853" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/853</a>
   6_0_X: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/854" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/854</a></li>
<li>Kota Iguchi 2016-09-07

   Merged, will resolve this as Fixed once Jenkins 6_0_X build passes it.</li>
<li>Ewan Harris 2016-10-21

   Verified using:
   
   OS: Microsoft Windows 10 Pro 10.0.14393
   Appc core: 6.0.0-63
   Appc NPM: 4.2.8-9
   Ti SDK: 6.1.0.v20161020155633
   Appc Studio: 4.8.0.201610171310
   
   Capabilities are now generated based off API usage in an app. Build process will merge user defined capabilities from the tiapp.xml with generated ones allowing cases like TIMOB-23981 to be worked around easily. Example from previous comment now works.
   
   Closing ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23156.json">JSON Source</a></p>