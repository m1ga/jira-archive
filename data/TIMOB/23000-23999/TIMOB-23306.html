---
title: "[TIMOB-23306] Include auto-focus-camera in UIRequiredDeviceCapabilities to fix focus issues on some iPhone/SDK combinations"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS, Tooling</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Tim Poulsen (ACV)</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2016-05-03T13:51:40.000+0000</td></tr>
<tr><th>Updated</th><td>2016-06-30T12:41:38.000+0000</td></tr>
</table>

<h3>Description</h3>

I know you hate tickets like this...I can't provide a reproduceable test case. But I'm going to file it anyway so that it's documented for someone else who might encounter the same issue.

I’ve been struggling with camera focus issues on iOS. In our app, focus on some iPhones is fixed at 15-20 cm. But I can’t reproduce it outside our app. You can try with the attached, which mimics our app's use of the camera. On affected devices, it doesn't matter whether you use the full-screen camera or the camera with an overlay like our app uses. And, it's not consistent to device type...some iPhone 6's are affected, others are not for example. But on those devices affected, the issue is constant. On my iPhone 5, the camera is always fixed focus with our app (though works fine in other apps, native camera app, etc.).

Adding <code>auto-focus-camera</code> to the UIRequiredDeviceCapabilities in tiapp.xml seems to have fixed it. I would assume that that key is added automatically to the plist whenever you use the camera. But, maybe not?

<code><pre>
&lt;key&gt;UIRequiredDeviceCapabilities&lt;/key&gt;
&lt;array&gt;
  &lt;string&gt;auto-focus-camera&lt;/string&gt;
  &lt;string&gt;front-facing-camera&lt;/string&gt;
  &lt;string&gt;camera-flash&lt;/string&gt;
  ...
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-23306_59128/app.js">app.js</td></td><td>2016-05-03T13:49:22.000+0000</td><td>2767</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Tim Poulsen (ACV) 2016-05-03

   BTW, this problem started happening sometime around the switch to the 5.x line of SDKs. We didn't have this problem in the past. I don't have record of an exact date/release when the problem appeared.</li>
<li>Sharif AbuDarda 2016-05-03

   Hello,
   
   The issue is fixed when "auto-focus-camera" is defined in "<key>UIRequiredDeviceCapabilities</key>" in tiapp.xml. For referance see <a href="https://developer.apple.com/library/ios/qa/qa1397/_index.html" rel="nofollow" target="_blank">https://developer.apple.com/library/ios/qa/qa1397/_index.html</a>
   
   regards,
   Sharif.
   
   </li>
<li>Tim Poulsen (ACV) 2016-05-03

   I'm not sure why you would resolve this as "Fixed" when you have done nothing. I filed this as a bug because: a) <code>auto-focus-camera</code> should be added to the plist automatically when you use the camera, but it is apparently not. And b) if developers need to add that key, it should be documented, which it is not. So, either this is an SDK bug (key not added when it should be) or a docs bug (it's not documented that developers need to add it).</li>
<li>Sharif AbuDarda 2016-05-03

   Hello, 
   
   The issue here is camera won't focus on some of the devices (random devices, all of are iphone 6 and up), as the reporter mentioned . The issue started in SDK 5.x and up. To avoid that issue you need to define "auto-focus-camera" key in "UIRequiredDeviceCapabilities" in tiapp.xml. But this should automatically be added in there when camera is used. And if that's not the case, the solution should be added to the docs for developers to follow. 
   
   Thanks,
   Sharif.
   
   
   
   </li>
<li>Tim Poulsen (ACV) 2016-05-03

   It should be documented in the _Appcelerator Ti.Camera_ documentation that this is required. In most cases, Titanium developers do not need to specify device capabilities (or Android uses-permission settings) because these are typically handled by the Titanium build scripts. The fact that this required device capability is not handled automatically, and not documented is a *Titanium bug*</li>
<li>Chris Barber 2016-05-04

   We need to punt this to Titanium 6. The iOS build currently writes the Info.plist before it copies and analyzes the JavaScript files, so that means it doesn't know which Titanium APIs are even being used until much later in the build. I'm not confident that we can simply move the writing of the Info.plist after the resources have been processed without introducing other issues. Given we have a workaround today whereby users can just set the UIRequiredDeviceCapabilities in tiapp.xml, I believe this can wait until Titanium 6.</li>
<li>Tim Poulsen (ACV) 2016-05-04

   That's fine by me</li>
<li>Fokke Zandbergen 2016-05-05

   [~cbarber] makes sense. I've created TIDOC-2516 to request it to be added to docs in the meanwhile.</li>
<li>Tim Poulsen (ACV) 2016-05-12

   I just tried submitting my app update with the new auto-focus-camera device capability and was blocked. 
   
   _The app's Info.plist can't contain values for the UIRequiredDeviceCapabilities key that would prevent this app from opening on any iOS device that was supported by previous versions. For more information, see Understanding the UIRequiredDeviceCapabilities Key._
   
   So, any fix you might do needs to be for only new apps not existing ones. </li>
<li>Fokke Zandbergen 2016-05-13

    Wow, that makes this even more critical if only when you first publish the app you can set this capability.</li>
<li>Tim Poulsen (ACV) 2016-05-13

    Since I can't add the plist tag, I would love to hear other options for fixing the focus issues we're seeing. </li>
<li>Fokke Zandbergen 2016-05-15

    I'm reading up on this issue which is actively discussed by Xcode iOS developers as well:
    
    * <a href="http://stackoverflow.com/questions/28107124/the-apps-info-plist-cant-contain-values-for-the-uirequireddevicecapabilities-k/32940562" rel="nofollow" target="_blank">http://stackoverflow.com/questions/28107124/the-apps-info-plist-cant-contain-values-for-the-uirequireddevicecapabilities-k/32940562</a>
    * <a href="https://devforums.apple.com/message/1137785#1137785" rel="nofollow" target="_blank">https://devforums.apple.com/message/1137785#1137785</a>
    * <a href="http://oleb.net/blog/2011/12/uirequireddevicecapabilities-cannot-be-changed-in-app-updates/" rel="nofollow" target="_blank">http://oleb.net/blog/2011/12/uirequireddevicecapabilities-cannot-be-changed-in-app-updates/</a>
    
    The following quote from Apple might be hint on a possible workaround:
    
    {quote}Engineering has determined that this issue behaves as intended based on the following information: Developers can add restrictions to UIRequiredDeviceCapabilities on app updates provided any device that is dropped cannot support the min os version specified.{quote}
    
    You could try to add the key but also increase the [min-ios-ver](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/tiapp.xml_and_timodule.xml_Reference-section-29004921_tiapp.xmlandtimodule.xmlReference-min-ios-ver) and hope that the device(s) that don't support the capability will also not support the minimum iOS version, which should allow you to add the key still.</li>
<li>Tim Poulsen (ACV) 2016-06-30

    Not including this capability has permanent and damaging consequences for iOS app developers. If you publish your app without understanding that you have to manually add this flag, you're stuck. You will be permanently incapable of fixing the blurry photos your users will take without switching app IDs / app names (i.e. publishing a new app).
    
    Given that Titanium is supposed to make app publishing easier, not more difficult for developers, I don't see how you can put off fixing this issue. At minimum, there should be a huge warn message in the build logs, maybe even a dialog in Studio that is shown if the developer uses the Ti.Camera module without setting the UIRequiredDeviceCapabilities flag. </li>
</ol>


<p><a href="/TIMOB/TIMOB-23306.json">JSON Source</a></p>