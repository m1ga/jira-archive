---
title: "[TIMOB-23314] Windows: CLI should find JDK like Studio does"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2020-02-06T06:06:26.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.3.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Tooling, Windows</td></tr>
<tr><th>Labels</th><td>cb-tooling</td></tr>
<tr><th>Reporter</th><td>Fokke Zandbergen</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2016-05-04T14:19:58.000+0000</td></tr>
<tr><th>Updated</th><td>2020-02-06T06:06:26.000+0000</td></tr>
</table>

<h3>Description</h3>

When I build a Windows app from Studio it works fine, but when I build the same app via CLI it fails with:

<code><pre>
[ERROR] Failed to encrypt JavaScript files
[ERROR] Program launch failed. Unable to locate Java VM. Please set JAVA_HOME environment variable.
</pre></code>

Which originates from:
<a href="https://github.com/appcelerator/titanium_prep/blob/247eaecf56160dce4273a8fd64977b83da671f06/android/launcher/main.jdk16.c#L139" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_prep/blob/247eaecf56160dce4273a8fd64977b83da671f06/android/launcher/main.jdk16.c#L139</a>

Of course I could set <code>JAVA_HOME</code> but if Studio manages to find Java (and apparently pass it on to the CLI) then why can't the CLI?

IMHO the CLI should be able to do anything Studio can. Even better: Studio should not do anything the CLI so that Studio is as light as it can be and relies on CLI.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2016-05-04

   I suppose we could look in the Windows Registry to find it. I wonder if that's what Studio does.</li>
<li>Chris Barber 2016-05-04

   I'm not 100% certain, but either Studio gets the JDK info from Eclipse or it queries the Windows Registry.
   
   Titanium 6 will be using jdklib which I had already added Windows Registry checks (<a href="https://github.com/appcelerator/jdklib/blob/master/src/index.js#L297-L327)" rel="nofollow" target="_blank">https://github.com/appcelerator/jdklib/blob/master/src/index.js#L297-L327)</a>, so already jdklib is better than the JDK detection code in node-appc.
   
   This ticket will resolved as fixed when Titanium 6 ships.</li>
<li>Fokke Zandbergen 2016-05-05

   Awesome [~cbarber]! And then we should rip out the logic from Studio asap.</li>
<li>Chris Barber 2017-08-09

   Currently, Titanium SDK uses the JDK detection code in <code>node-appc</code>. This code has been cleaned up and copied into <a href="https://github.com/appcelerator/jdklib." rel="nofollow" target="_blank">https://github.com/appcelerator/jdklib.</a> The new code supports searching the Windows Registry for the path. <code>jdklib</code> is not ready for primetime and isn't designed to be dropped into the current Titanium SDK. Once <code>jdklib</code> is ready and integrated into the Titanium build, then we can resolve this ticket.</li>
<li>Chris Barber 2020-02-06

   The JDK detection code in node-appc has been moved into [jdklib](<a href="https://github.com/appcelerator/jdklib)" rel="nofollow" target="_blank">https://github.com/appcelerator/jdklib)</a> and has been updated to check the Windows Registry.
   
   At this point, we should not update node-appc. It's legacy. I don't think we should replace node-appc's JDK detection with jdklib. It's not a drop in replacement.
   
   It makes the most sense to spend the time towards utilizing jdklib in the new build pipeline.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23314.json">JSON Source</a></p>