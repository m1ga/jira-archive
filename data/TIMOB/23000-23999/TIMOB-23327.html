---
title: "[TIMOB-23327] iOS: Webview request send out beforeload event is excuted on Webview (Parity)"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-01-10T09:46:04.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.4.0, Release 5.2.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.0</td></tr>
<tr><th>Components</th><td>Android, iOS</td></tr>
<tr><th>Labels</th><td>Citi, supportTeam</td></tr>
<tr><th>Reporter</th><td>Mostafizur Rahman</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2016-05-05T14:07:17.000+0000</td></tr>
<tr><th>Updated</th><td>2017-01-10T22:17:33.000+0000</td></tr>
</table>

<h3>Description</h3>

*Scenario:*
Customer's want to prevent  any unauthorized request. In newly developed features we can block URL by adding blacklistedURLs property. But its only helpful if we have URL list but if we don't have any predefined URL then it will not helpful. 

If stopLoading() stop loading content then customer need like stop request function which is stop sending request.  

Just load any HTML url in webview and call the webview.stoploading in beforeload event of webview. Customer has blocked the "terms of use" and "privacy policy" links in "beforeload" event of the web view. The webView stops loading but the link is traced in Proxy.

*Test code:* 

<code><pre>
var win = Ti.UI.createWindow({
    backgroundColor : 'black',
    layout : 'vertical'
});

var webview = Titanium.UI.createWebView({url:'<a href="https://en.m.wikipedia.org/wiki/Main_Page" rel="nofollow" target="_blank">https://en.m.wikipedia.org/wiki/Main_Page</a>'});

webview.addEventListener('beforeload', function(e){
	Ti.API.info("beforeload = e.url=" + e.url);
	if(e.url.indexOf('wikimediafoundation.org/wiki/Terms_of_Use') &gt; -1){
		webview.stopLoading();
		Ti.API.info("Inside TERMS OF USE");
	} else if (e.url.indexOf('wikimediafoundation.org/wiki/Privacy_policy') &gt; -1){
		webview.stopLoading();
		Ti.API.info("Inside privacy policy");
	}
});
webview.addEventListener('load', function(e){
	Ti.API.info("load = e.url=" + e.url);
	
});

win.add(webview);

win.open(); 
</pre></code>


*Test steps:*

    Run test code in classic project
    Click on "terms of use" and "privacy policy" links and see the requests on proxy.

*Expected Behavior :*
Webview.stoploading should have prevented the request for the link clicked.

*Actual Behavior :*
By clicking on "terms of use" and "privacy policy" links, requests are sent out on proxy(by the IP address)


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-23327_59174/Capture.PNG">Capture.PNG</td></td><td>2016-05-10T10:52:43.000+0000</td><td>95826</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-23327_59175/screen_using_blacklistedurl.png">screen_using_blacklistedurl.png</td></td><td>2016-05-10T10:52:39.000+0000</td><td>231869</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ashraf Abu 2016-05-10

   Just want to check, this is for iOS, correct?</li>
<li>Chee Kiat Ng 2016-05-11

   [~apetkov] Once Ash and the rest determine the approach, can you work on this fix?</li>
<li>Ajith Rohini 2016-05-13

   Had the call with client (Rajeev & Koushik) with Ash and Angel from our end and we came to the agreement that we will have the feature ready buy next Wednesday May18th</li>
<li>Angel Petkov 2016-05-24

   Hello, the ticket for IOS is in progress now we've had feedback off the customers, they seem to be happy with the android implementation. The iOS feature should be finished by the end of this week, I apologize for the delay as I've been out the office and we have also been waiting on feedback of the Android implementation which seems to have gone smoothly. Again the iOS feature should be out shortly (end of this week) Thank you! </li>
<li>Angel Petkov 2016-05-25

   Introduced onStopBlackListUrl
   * PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8019" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8019</a>
   * Custom Build: <a href="https://www.dropbox.com/s/v3ol1q4tddumzhs/mobilesdk-5.4.0-osx.zip?dl=0" rel="nofollow" target="_blank">https://www.dropbox.com/s/v3ol1q4tddumzhs/mobilesdk-5.4.0-osx.zip?dl=0</a>
   
   _*Steps to Test:*_
   Click the 9 or iOS library link. 
   
   _*Expected Result:*_
   Nothing should open and the event should be triggered with the event data loged. 
   
   Demo Code:
   <code><pre>
   
   var win = Ti.UI.createWindow({
       backgroundColor : 'black',
       layout : 'vertical'
   });
   var webview = Titanium.UI.createWebView({
       blacklistedURLs :'IOS',
       url : '<a href="https://developer.apple.com/library/" rel="nofollow" target="_blank">https://developer.apple.com/library/</a>'
   });
    
   webview.addEventListener('load', function(e) {
       Ti.API.warn("load = e.url=" + e.url);
   });
    
   webview.addEventListener('onStopBlacklistedUrl', function(e) {
           Ti.API.info(e);
   });
   
   win.add(webview);
   win.open();
   </pre></code></li>
<li>Angel Petkov 2016-05-27

   [~morahman] Yes, my mistake I was testing the flush of the array in the demo-code and forgot to remove it before adding it to Jira. My apologizes, could you test again thank you! </li>
<li>Motiur Rahman 2016-05-27

   [~apetkov] , [~arohini], Now it works with the updated test case.
   
   Thanks.</li>
<li>Ajith Rohini 2016-05-27

   Thanks [~morahman] !!</li>
<li>Ajith Rohini 2016-05-30

   [~morahman], Client reported that its still not working. Did you test it with the build from the link below?
   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8019" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8019</a>
   Custom Build: <a href="https://www.dropbox.com/s/v3ol1q4tddumzhs/mobilesdk-5.4.0-osx.zip?dl=0" rel="nofollow" target="_blank">https://www.dropbox.com/s/v3ol1q4tddumzhs/mobilesdk-5.4.0-osx.zip?dl=0</a></li>
<li>Jong Eun Lee 2016-06-08

    How about using <code>stopBlackListUrl</code> as event name instead of <code>onStopBlackListUrl</code>?
    If <code>onStopBlackListUrl</code>, the xml has <code>onOnStopBlacklistedUrl </code> name.
    <code><pre>
    &lt;WebView id="webView" onOnStopBlacklistedUrl="onBlack"&gt;&lt;/WebView&gt;
    </pre></code>
    
    <code>onOn</code> dosn't look good.</li>
<li>Angel Petkov 2016-06-08

    [~yomybaby] Hello I appreciate the feedback and agree completely that it should be called stopBlackListUrl however this ticket  is just for the iOS feature. I cannot rename it within this PR as the customBuild is already being used for testing by the customers. Once this feature is merged we will create a new ticket and rename the event for both iOS and Android.</li>
<li>Ajith Rohini 2016-06-23

    [~apetkov], Any update on the fix for this issue ?</li>
<li>Jong Eun Lee 2016-08-23

    Any news? :)</li>
<li>Jong Eun Lee 2016-09-16

    I hope that this iOS code will be merged soon. 
    Please :)
    Because Android has this feature already in 5.4.0.GA.
    </li>
<li>Jong Eun Lee 2016-12-23

    this property for Android was included 5.4.0!
    Not yet on iOS.
    @apetkov Is there any reason? :)</li>
<li>Vijay Singh 2017-01-09

    [~hansknoechel] PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8732" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8732</a>
    
    Test code -
    
    <code><pre>
    var win = Ti.UI.createWindow({
        backgroundColor : 'black',
        layout : 'vertical'
    });
    var webview = Titanium.UI.createWebView({
        url : '<a href="https://developer.apple.com/library/" rel="nofollow" target="_blank">https://developer.apple.com/library/</a>'
    });
     
     webview.setBlacklistedURLs(['library']);
     
    webview.addEventListener('load', function(e) {
        Ti.API.warn("load = e.url=" + e.url);
    });
     
    webview.addEventListener('onStopBlacklistedUrl', function(e) {
            Ti.API.info(e);
    });
     
    win.add(webview);
    win.open();
    </pre></code></li>
<li>Samir Mohammed 2017-01-10

    Verified improvement with the test case provided by [~vijaysingh] application was no longer displaying the blacklisted URL. 
    
    *Environment*
    <code><pre>
    Appcelerator Command-Line Interface, version 6.1.0
    iphone 6 plus (ios 9.3.4)
    Operating System Name: Mac OS X El Capitan
    Operating System Version: 10.11.6
    Node.js Version: 4.6.0
    npm: 4.2.8
    Titanium SDK Version: 6.1.0.v20170110133045
    Xcode: 8.2
    Appcelerator Studio: 4.8.1.201612050850
    </pre></code>
    </li>
</ol>


<p><a href="/TIMOB/TIMOB-23327.json">JSON Source</a></p>