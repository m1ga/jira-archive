---
title: "[TIMOB-23381] Parity: Titanium CommonJS modules require'd differently than NodeJS require spec"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-06-10T08:09:15.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Components</th><td>Android, iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2016-05-16T16:57:54.000+0000</td></tr>
<tr><th>Updated</th><td>2018-11-16T15:41:04.000+0000</td></tr>
</table>

<h3>Description</h3>

We have a long-standing issue with how Titanium CommonJS modules are require'd.

One would assume they'd follow typical NodeJS conventions with requires, so when you do:
<code><pre>
require('module.id');
</pre></code>

I would expect that it should attempt to load up <code>modules/commonjs/module.id/&lt;version&gt;</code> as a directory as per TIMOB-23382

Instead, our Android and iOS implementation looks for <code>modules/commonjs/module.id/&lt;version&gt;/module.id.js</code>, and ignore any package.json, index.js, or index.json in that directory.


<h3>Comments</h3>

<ol>
<li>Chee Kiat Ng 2016-06-10

   </li>
<li>Brenton House 2016-07-19

   [~cwilliams] [~cng] How will this handle widgets that have other npm dependencies?  Currently, if a widget has dependencies in the npm package, Alloy doesn't include the node_modules folder.  Should I create a ticket for this or is this going to be handled by the new nodejs module resolution that [~cwilliams] has been working on?  Thanks!</li>
<li>Christopher Williams 2016-07-19

   [~brentonhouse] This shouldn't really affect widgets in any particular way, so if there's a bug now, please file it. This basically changes Titanium commonjs modules to not be a single JS files, but an entire directory that will get packaged into the app - and you can now use package.json/index.js/index.json, and not have to ensure you have all your JS crammed into a single file whose name matches the module id.</li>
<li>Brenton House 2016-07-19

   Currently widgets can be distributed via npm (<a href="http://www.appcelerator.com/blog/2016/05/distributing-alloy-widgets-via-npm/)." rel="nofollow" target="_blank">http://www.appcelerator.com/blog/2016/05/distributing-alloy-widgets-via-npm/).</a>  Say my widget has a dependency on lodash.  If I use the nodejs way of doing things and make it a dependency, it installs it to the node_modules folder of the widget, but when Alloy imports the widget at compile-time, it doesn't bring in the node_modules folder.</li>
<li>Lokesh Choudhary 2016-08-15

   Verified the fix.
   
   Used the same test code in TIMOB-23382.
   Closing.
   
   Environment:
   Appc Studio : 4.7.0.201607250649
   Ti SDK :  6.0.0.v20160814220332
   Ti CLI : 5.0.9
   Alloy : 1.9.1
   MAC El Capitan : 10.11.6
   Appc NPM : 4.2.7
   Appc CLI : 6.0.0-24
   Node: 4.4.4
   Nexus 6 - Android 6.0.1
   iOS simulator: Iphone 6s 9.3</li>
</ol>


<p><a href="/TIMOB/TIMOB-23381.json">JSON Source</a></p>