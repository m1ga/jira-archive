---
title: "[TIMOB-23403] iOS: Debug exception when calling moment.locale(Ti.Locale.currentLocale)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2019-11-14T16:25:49.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>defect, iOS</td></tr>
<tr><th>Reporter</th><td>Christy Thomas</td></tr>
<tr><th>Assignee</th><td>Angel Petkov</td></tr>
<tr><th>Created</th><td>2016-05-12T13:54:32.000+0000</td></tr>
<tr><th>Updated</th><td>2019-11-14T16:25:49.000+0000</td></tr>
</table>

<h3>Description</h3>

This is the line of code the exception is happening and name variable is "en-US", but we also use french as well and is the reason why we are calling moment.locale.
            require("alloy/moment/lang/" + name);

<code><pre>
Thread [kroll$1] (Suspended (exception at line 134 in moment.js))	
	loadLocale(name) [moment.js:134]	
	locale_locales__getLocale(key) [moment.js:163]	
	locale_locales__getSetGlobalLocale(key, values) [moment.js:142]	
	Controller() [index.js:43]	
	createController(name, args) [alloy.js:232]	
	[Top-level script] [app.js:3]	
</pre></code>

In Run mode this works fine and our date displays correctly for the locale.  The example doesn't display date, but out app does.

I have attached example code to demonstrate this issue.  Run the app in Debug mode.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-23403_59196/AlloyTestProjectMoment.zip">AlloyTestProjectMoment.zip</td></td><td>2016-05-12T13:53:26.000+0000</td><td>8203637</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Angel Petkov 2016-05-31

   [~cthomas] Hello, thank you for reporting the issue. It's currently being looked in to, for the time being you can use Titanium.Locale to get the currentLocal and language, which should return the same values.  
   
   <code><pre>
   Ti.API.info(Ti.Locale.currentLocale)
   </pre></code></li>
<li>Francois van Lille 2016-09-23

   I've found that it isn't worth the bother of trying to use the built-in distribution of moment if your app's distribution is likely to be in multiple locales and you won't have i18n translations onboard for all those locales. Instead, just head over to momentjs.com, download moment-with-locales.js and require it instead of the "alloy/moment" version...
   
   So in practice, I do the following in alloy.js:
   
   <code><pre>
   // in the require statement below "moment-with-locales" refers to app/lib/moment-with-locales.js, which I renamed from the moment-with-locales.min.js file downloaded from momentjs.com
   Alloy.Globals.Moment = require("moment-with-locales");
   Alloy.Globals.Moment.locale(Ti.Locale.currentLocale);
   </pre></code>
   
   And when I need to use it, simply use
   
   <code><pre>
   Alloy.Globals.Moment(oSomeDate).fromNow()
   </pre></code>
   
   or whatever...</li>
<li>Alan Hutton 2019-11-14

   Unable to reproduce the issue.
   
   Axway Appcelerator Studio, build: 5.1.4.201909061933Â 
   macOS : 10.15
   Node.js Version : 8.9.1
   npm Version : 5.5.1
   Appcelerator CLI : 7.1.1
   Titanium CLI
   CLI Version : 5.2.1
   node-appc Version : 0.2.49
   Titanium SDKs : 8.2.1.GA</li>
</ol>


<p><a href="/TIMOB/TIMOB-23403.json">JSON Source</a></p>