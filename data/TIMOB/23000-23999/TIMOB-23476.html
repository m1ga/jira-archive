---
title: "[TIMOB-23476] Android: constants are writable"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-06-27T17:17:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2016-06-03T19:01:06.000+0000</td></tr>
<tr><th>Updated</th><td>2016-08-12T22:58:02.000+0000</td></tr>
</table>

<h3>Description</h3>

Constants in Android are able to be "overwritten". Things like Ti.App.EVENT_ACCESSIBILITY_ANNOUNCEMENT should be truly constant and the user shouldn't be able to overwrite the value or delete the property.

Currently you can "overwrite" the value:

<code><pre>
Ti.API.info('original value: ' + Ti.App.EVENT_ACCESSIBILITY_ANNOUNCEMENT);
Ti.App.EVENT_ACCESSIBILITY_ANNOUNCEMENT = 'my very own made-up value';
Ti.API.info('modified value: ' + Ti.App.EVENT_ACCESSIBILITY_ANNOUNCEMENT);
</pre></code>'

I think the underlying cause here is actually different than TIMOB-23475. I Believe this is because we hang 'constants' on the prototype of the proxy (i.e. <code>Object.getPrototypeOf(Ti.App);</code>) while the global object living at <code>Ti.App</code> is an instance. So what's happening looks to be "property shadowing" where we're actually adding a new <code>EVENT_ACCESSIBILITY_ANNOUNCEMENT</code> property with our own value onto the instance of <code>Ti.App</code> that lives in the global namespace at <code>Ti.App</code>. This instance property "shadows" the original constant declared on the prototype.

To prove my point, calling Object.getPrototypeOf(Ti.App) gives:
<code><pre>
{"Properties":{"apiName":"Ti.App.Properties","bubbleParent":true},"Android":{"bubbleParent":true,"launchIntent":{"action":null,"bubbleParent":true,"packageName":"dfg.df","data":null,"type":null,"apiName":"Ti.Android.Intent","className":"dfg.df.ExampleActivity","flags":268435456},"appVersionCode":1,"appVersionName":"1.0","apiName":"Ti.App.Android","R":{"bubbleParent":true,"apiName":"Ti.Android.R"}},"EVENT_ACCESSIBILITY_ANNOUNCEMENT":"accessibilityannouncement","EVENT_ACCESSIBILITY_CHANGED":"accessibilitychanged"}
</pre></code>
You can clearly see the constants there.

It makes sense to hang the constants at the "prototype" level since they're supposed to be "class-level/static" constants and we shouldn't need to have every instance hold a copy. However, it looks like we're not preventing shadowing properly (even though it appears we're setting the constant property attributes to ReadOnly|DontDelete).

See <a href="https://github.com/getify/You-Dont-Know-JS/issues/91" rel="nofollow" target="_blank">https://github.com/getify/You-Dont-Know-JS/issues/91</a> for discussion on cases where there seems to be prevented shadowing.

One possible solution may be to do an Object.seal() on all our proxies after they're set up. This marks all properties as DontDelete and prevents new properties from being added.

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2016-06-03

   Note that our V8 version is way out of date, and using the latest V8 may help bring us the behavior described in that link whereby a non-writable property on the prototype prevents shadowing on instances?</li>
<li>Christopher Williams 2016-06-03

   Just tested using the new V8 locally and can confirm that this _does_ fix the behavior for shadowing constants marked as read-only on the prototype. So, once TIMOB-23310 is merged, this will be fixed as well.</li>
<li>Lokesh Choudhary 2016-08-12

   Verified the fix.
   
   Constants do not get overwritten anymore.
   Closing.
   
   Environment:
   Appc Studio : 4.7.0.201607250649
   Ti SDK :  6.0.0.v20160811221444
   Ti CLI : 5.0.9
   Alloy : 1.9.1
   MAC El Capitan : 10.11.6
   Appc NPM : 4.2.7
   Appc CLI : 6.0.0-24
   Node: 4.4.4
   Nexus 5 - Android 6.0.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-23476.json">JSON Source</a></p>