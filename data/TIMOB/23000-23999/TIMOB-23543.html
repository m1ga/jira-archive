---
title: "[TIMOB-23543] TiAPI: require implementation uses incorrect __filename values"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-07-20T13:47:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Components</th><td>Android, iOS, Windows</td></tr>
<tr><th>Labels</th><td>breaking-change, parity</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2016-06-20T16:09:41.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-31T22:15:31.000+0000</td></tr>
</table>

<h3>Description</h3>

Our require implementation uses different values for __filename than what may be expected from an implementation like NodeJS. Additionally, our values differ between platforms.

On Windows, we get the base name of the file ('filename'). On iOS and Android we get the filename with no path info ('filename.js').

To match Node, we should be giving the absolute path to the resolved file ('/path/to/filename.js').

<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2016-06-27

   Windows: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/750" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/750</a></li>
<li>Kota Iguchi 2016-06-28

   Let me clear on the <code>__filename</code> spec for Windows: 
   Does that need to be "Windows full path" or "path from application directory"? What I mean here is:
   
   Let say we have
   
   <code><pre>
   app.js
     - hello/
       - index.js
   </pre></code>
   
   * Windows full path = <code>C:\Data\SharedData\PhoneTools\AppxLayouts\xxx\hello\index.js</code>
   * Path for the application directory = <code>/hello/index.js</code>
   
   [My current PR](<a href="https://github.com/appcelerator/titanium_mobile_windows/pull/750)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/750)</a> implements __filename from path for the application directory.</li>
<li>Christopher Williams 2016-06-28

   [~kota] Your implementation is correct. The __filename path is supposed to be the resolved absolute path, but I think on mobile OSes like we deal with, we effectively want it as "absolute" from the app root, not the underlying OS path with scheme. To the user the app root is typically their Resources folder (in terms of how they refer to files), we really want the resolved path from that as root.</li>
<li>Christopher Williams 2016-06-28

   This is resolved fro Windows, but still need fixes from Android and iOS for parity.</li>
<li>Hans Kn√∂chel 2016-07-01

   iOS PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8098" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8098</a>
   
   My test-case:
   <code><pre>
   app.js
     - tmp/
       - sub/
           - index.js
   </pre></code>
   Old <code>__filename</code>: <code>index.js</code> <-- Only filename
   New <code>__filename</code>: <code>/tmp/sub/index.js</code> <-- Concatenation of the relative path from <code>Resources</code> plus the filename
   </li>
<li>Christopher Williams 2016-07-01

   Hans' PR fixed the behavior for iOS. Just Android left.</li>
<li>Ashraf Abu 2016-07-04

   Is there any hint or location that I should be looking at for this in Android? I'm looking and found this portion <a href="https://github.com/appcelerator/titanium_mobile/blob/415bd6c66dcc55b1a59a59574f3babd3c3a84ede/android/runtime/common/src/js/kroll.js#L119-L121" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/415bd6c66dcc55b1a59a59574f3babd3c3a84ede/android/runtime/common/src/js/kroll.js#L119-L121</a>
   I'm trying to see what's needed to be done to get this to work in Android.</li>
<li>Christopher Williams 2016-07-06

   [~msamah] That is one possible location, but I think the fix is likely inside <a href="https://github.com/appcelerator/titanium_mobile/blob/415bd6c66dcc55b1a59a59574f3babd3c3a84ede/android/runtime/common/src/js/module.js" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/415bd6c66dcc55b1a59a59574f3babd3c3a84ede/android/runtime/common/src/js/module.js</a>
   
   I haven't looked close enough to see where we need to change the value for filename (in _runScript()? in load()?). It'd be good to test what we do report for Android locally to see what exactly needs to change (maybe it just needs a leading slash?). It appeared to only report the last path segment to me, but maybe it was reporting the full path on Android, just missing the leading slash?</li>
<li>Christopher Williams 2016-07-18

   Working on Android version...</li>
<li>Christopher Williams 2016-07-18

    <a href="https://github.com/appcelerator/titanium_mobile/pull/8141" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8141</a></li>
<li>Ashraf Abu 2016-08-04

    Testing steps is mentioned in the PR using the test scripts. 
    Refer to <a href="https://github.com/appcelerator/titanium_mobile/pull/8141" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8141</a></li>
<li>Lee Morris 2017-03-31

    Closing ticket as fixed, if there are any problems, please file a new ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23543.json">JSON Source</a></p>