---
title: "[TIMOB-23655] Windows: Implement Ti.Geolocation.requestLocationPermissions/hasLocationPermissions methods to match iOS and Android behaviour"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-10-11T12:42:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.4.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>parity, qe-5.4.0</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2016-07-19T17:41:41.000+0000</td></tr>
<tr><th>Updated</th><td>2016-10-13T14:17:17.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

As part of TIMOB-19479 the Gelocation permissions was rewritten to be consistent across iOS and Android and use Ti.Geolocation.hasPermissions. Windows currently uses a different way to request permissions that can be seen in TIMOB-23389, however it should move to match iOS and Android. A code sample can be found below and a real world example found [in Geocoder](<a href="https://github.com/appcelerator-developer-relations/appc-sample-geocoder/blob/stable/app/lib/permissions.js#L59)" rel="nofollow" target="_blank">https://github.com/appcelerator-developer-relations/appc-sample-geocoder/blob/stable/app/lib/permissions.js#L59)</a>

<code><pre>
Ti.Geolocation.preferredProvider = "gps";
    function locationCallback(e) {
        if (!e.success || e.error) {
            alert("error:" + JSON.stringify(e.error));
            return;
        }
        Ti.API.info(JSON.stringify(e));
        var longitude = e.coords.longitude;
        var latitude = e.coords.latitude;
    };
    if (Ti.Geolocation.hasLocationPermissions(Ti.Geolocation.AUTHORIZATION_ALWAYS)) {
        alert("Access already granted!");
        Titanium.Geolocation.addEventListener("location", locationCallback);
    } else {
                Ti.Geolocation.requestLocationPermissions(Ti.Geolocation.AUTHORIZATION_ALWAYS, function(e) {
          if (e.success === true) {
                            alert("Access now granted!");
              Titanium.Geolocation.addEventListener("location", locationCallback);
          } else {
              console.log("Access denied, error: " + e.error);
          }
      });
    }
</pre></code>

Additionally to this Ti.Geolocation.hasLocationPermissions should also be implemented to allow a user to check if permissions have already been granted

<h4>Steps to reproduce</h4>

<h4>Run the code above on Windows Platform <code>appc run -p windows </code></h4>

<h4>Actual result</h4>

You should be prompted to allow location

<h4>Expected result</h4>

The app will throw an error as the methods are not implemented

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-23655_59928/request.png">request.png</td></td><td>2016-07-27T12:43:42.000+0000</td><td>28053</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Gary Mathews 2016-07-26

   master: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/789" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/789</a></li>
<li>Ewan Harris 2016-10-05

   Reopening ticket:
   
   OS: Microsoft Windows 10 Pro 10.0.14393
   Appc core: 6.0.0-56
   Appc NPM: 4.2.8-7
   Ti SDK: 6.0.0.v20161004202820
   Appc Studio: 4.8.0.201609292239
   Lumia 550 10.0
   
   When I'm using the code in the description I get the following
   
   * On first launch I am prompted to allow the app to access my location. It looks like my callback that is passed to <code>requestLocationPermissions</code> is called immediately rather than when I allow/reject access as I would expect. When I click yes or no on the prompt my app then crashes
   * On subsequent launches my app crashes on launch
   
   I see similar behavior when using the example in the PR. I have tried manually adding the location capability myself but this does not fix the issue</li>
<li>Kota Iguchi 2016-10-11

   I was able to reproduce it. I saw callback is fired twice (before & after the prompt) and then crashed. Started looking into it.</li>
<li>Kota Iguchi 2016-10-11

   6_0_X:  <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/878" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/878</a>
   master: <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/879" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/879</a>
   </li>
<li>Ewan Harris 2016-10-13

   Verified using:
   
   OS: Microsoft Windows 10 Pro 10.0.14393
   Appc core: 6.0.0-58
   Appc NPM: 4.2.8-7
   Ti SDK: 6.0.0.v20161012201942
   Appc Studio: 4.8.0.201610060953
   Lumia 550 10.0
   
   Both pieces of example code now work as expected and [geocoder](<a href="https://github.com/appcelerator-developer-relations/appc-sample-geocoder)" rel="nofollow" target="_blank">https://github.com/appcelerator-developer-relations/appc-sample-geocoder)</a> also works as expected
   
   Closing ticket</li>
</ol>


<p><a href="/TIMOB/TIMOB-23655.json">JSON Source</a></p>