---
title: "[TIMOB-23668] iOS: Hyperloop - Differential build not working"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Hyperloop, iOS, Tooling</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Chee Kiat Ng</td></tr>
<tr><th>Assignee</th><td>Jan Vennemann</td></tr>
<tr><th>Created</th><td>2016-07-21T08:24:43.000+0000</td></tr>
<tr><th>Updated</th><td>2017-08-09T15:57:02.000+0000</td></tr>
</table>

<h3>Description</h3>

It looks like differential build is not working when hyperloop is used.

<h4>Steps to reproduce</h4>
1. Create a simple app with hyperloop enabled
2. appc run -p ios
3. change app.js
4. appc run -p ios

<h4>Expected Result</h4>
trace will show "Skipping Xcodebuild"

<h4>Actual Result</h4>
trace shows "invoking xcodebuild" " Forcing rebuild: Xcode project has changed since last build"

<h3>Comments</h3>

<ol>
<li>Jan Vennemann 2016-07-28

   What's happening here is that before Hyperloop kicks in, there is a step during the build that triggers the creation of a new Xcode project (Not sure yet where exactly this happens). Hyperloop then changes the project and adds the required files. On subsequent builds this happens over and over again and Hyperloop always starts altering a fresh Xcode project, thus forcing a rebuild.</li>
<li>Chee Kiat Ng 2016-07-28

   [~cbarber] any advice on this?
   [~jvennemann] I thought Hyperloop has a check to see if new metabase needs to be generated. If it determines that metabase generation can be skipped, can't we assume that we can skip hyperloop changing the Xcode project and adding required files?</li>
<li>Chris Barber 2016-07-28

   If Hyperloop is going to modify the generated Xcode project, it should do it during the <code>build.ios.xcodeproject</code> hook.</li>
<li>Jan Vennemann 2016-08-02

   Just for the record, here is a summary about my findings regarding this issue. Hyperloop only uses the <code>build.ios.xcodeproject</code> hook to store the Xcode project data. The actual changes to the project are made during the <code>build.pre.build</code> hook. So the normal Titanium iOS builder has no idea of the changes Hyperloop made and overwrites the Xcode project without any Hyperloop generated files included on the next build.
   
   I thought about changing the order when Hyperloop generates its metabase but it relies on the <code>build.ios.copyResource</code> hook to detect if any relevant files were required and only then triggers a metabase generation. And this hook happens after <code>build.ios.xcodeproject</code> so it would require some (major?) refactoring to the whole hyperloop metabase workflow. If at all viable (how do we get the js files before the copyResource hook?).
   
   Also our current strategy to decide if we need to invoke a build with xcode is quite trivial. Xcode project file changed? Rebuild! Assuming we can fix the differential build issue, another one would arise. If we use custom Swift or Objective-C code and would change something there, neither the sdk or hyperloop would trigger a rebuild simply because the file is already in the xcode project. => file monitor or something like that is needed.</li>
<li>Chris Barber 2016-08-02

   So what changed? This used to work, albeit not great. Because Allow does not support differential builds, the iOS build was always recompiling, but I personally made the Hyperloop CLI plugin support differential builds.
   
   You may need to do your file operations during the <code>build.ios.xcodeproject</code> hook, which is not ideal. I don't want more file I/O that we need. If we're VERY careful, we could write the Xcode project later in the build, possibly after the resources have been copied, but we must call xcodebuild "clean" because we use schemes now and we don't nuke the derived data like we used to.</li>
<li>Hans Kn√∂chel 2017-03-14

   [~jvennemann] status on this? Didn't see this bug for a long time and it's scheduled for 6.1.0.</li>
<li>Jan Vennemann 2017-03-14

   This is still happening. The CLI writes the Xcode project, then Hyperloop adds stuff which CLI isn't aware of. On the next build the CLI will replace the Xcode project again without any Hyperloop related changes, forcing constant rebuilds. I can spend time on this as soon as i got the Android AAR stuff sorted out.</li>
<li>Chris Barber 2017-03-14

   Hyperloop should be making changes to the Xcode project during the <code>build.ios.xcodeproject</code> hook.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23668.json">JSON Source</a></p>