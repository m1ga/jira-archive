---
title: "[TIMOB-23747] iOS: Handoff crashes from iOS9 to iOS8"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-08-09T23:54:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.4.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.5.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>handoff, qe-5.4.0, qe-5.5.0</td></tr>
<tr><th>Reporter</th><td>Harry Bryant</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-08-08T21:41:37.000+0000</td></tr>
<tr><th>Updated</th><td>2016-08-16T20:27:02.000+0000</td></tr>
</table>

<h3>Description</h3>

*This is NOT a Regression.*
When using the handoff feature between iOS devices, it was found that a titanium app crashes when handing off from an iOS9 device -> iOS8 device. See below:

Handing off from <code>iOS9Device1</code> to <code>iOS9Device2</code>:
*iOS9Device1:* Activity moved to a different device.
*iOS9Device2:* continueactivity was fired.
*Logs:* <code>{color:#d04437}[ERROR] :  UIAlertController is up and showing an alert. ABORTING showing of modal controller{color}</code>

Handing off from <code>iOS9Device</code> to <code>iOS8Device</code>:
*iOS9Device:* Activity moved to a different device.
*iOS8Device:* {color:#d04437}App crashes. {color}
*Xcode Logs:* 
<code><pre>
Aug  4 15:31:23 Spam kernel[0] &lt;Notice&gt;: xpcproxy[1079] Container: /private/var/mobile/Containers/Data/Application/326B7AB3-16DB-4C33-94A6-B8BC41EF6A71 (sandbox)
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;: SOASTA TouchTest Build : 8244.160
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;: SOASTA TouchTest initializing...
Aug  4 15:31:23 Spam locationd[60] &lt;Notice&gt;: Gesture EnabledForTopCLient: 0, EnabledInDaemonSettings: 0
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;: Process delegate TiApp(o) : TiHost : NSObject
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;:   added ctDidFinishLaunchingWithOptions
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;:   watching application:didFinishLaunchingWithOptions: : success
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;:   added ctOpenURL
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;:   watching openURL : success
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;: SOASTA TouchTest initialized in 103 msec (#51)
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Error&gt;: assertion failed: 12D508: libxpc.dylib + 71792 [3C982BC2-5B46-305A-9A09-3C3D15332820]: 0x7d
Aug  4 15:31:23 Spam Unknown[1079] &lt;Error&gt;: 
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;: [DEBUG] Reading stylesheet from: /private/var/mobile/Containers/Bundle/Application/9A54667A-1524-4020-B04D-7E23BBB19F46/SamusTheBold.app/stylesheet.plist
Aug  4 15:31:23 Spam SamusTheBold[1079] &lt;Warning&gt;: [INFO] SamusTheBold/1.0 (5.4.0.16921ce)
Aug  4 15:31:23 Spam sharingd[59] &lt;Notice&gt;: 15:31:23.340 : Requesting Handoff payload
Aug  4 15:31:23 Spam sharingd[59] &lt;Notice&gt;: 15:31:23.643 : Received a new Handoff advertisement from "SAMWISE"
Aug  4 15:31:23 Spam sharingd[59] &lt;Warning&gt;: [Warning] No delegate was registered that could handle protobuf BC060AC5-021F-4A2D-883F-5FDA9A177137
Aug  4 15:31:23 Spam sharingd[59] &lt;Warning&gt;: [Warning] No delegate was registered that could handle protobuf BC060AC5-021F-4A2D-883F-5FDA9A177137
Aug  4 15:31:23 Spam sharingd[59] &lt;Notice&gt;: 15:31:23.719 : Received requested Handoff payload from "SAMWISE" ((null))
Aug  4 15:31:23 Spam ReportCrash[1080] &lt;Error&gt;: task_set_exception_ports(B07, 400, D03, 0, 0) failed with error (4: (os/kern) invalid argument)
Aug  4 15:31:23 Spam ReportCrash[1080] &lt;Notice&gt;: ReportCrash acting against PID 1079
Aug  4 15:31:23 Spam ReportCrash[1080] &lt;Notice&gt;: Formulating crash report for process SamusTheBold[1079]
Aug  4 15:31:23 Spam SpringBoard[53] &lt;Warning&gt;: BSXPCMessage received error for message: Connection invalid
Aug  4 15:31:23 Spam mediaserverd[22] &lt;Notice&gt;: '' com.appc.SamusTheBold(pid = 1079) setting DiscoveryMode = DiscoveryMode_None, currentDiscoveryMode = DiscoveryMode_None
Aug  4 15:31:23 Spam com.apple.xpc.launchd[1] (UIKitApplication:com.appc.SamusTheBold[0xbad1][1079]) &lt;Notice&gt;: Service exited due to signal: Segmentation fault: 11
Aug  4 15:31:23 Spam SpringBoard[53] &lt;Warning&gt;: [MPUSystemMediaControls] Updating supported commands for now playing application.
Aug  4 15:31:23 Spam SpringBoard[53] &lt;Warning&gt;: [MPUSystemMediaControls] Updating supported commands for now playing application.
Aug  4 15:31:23 Spam mediaserverd[22] &lt;Notice&gt;: 'FigPlayer - 29' (pid = 29) setting DiscoveryMode = DiscoveryMode_None, currentDiscoveryMode = DiscoveryMode_None
Aug  4 15:31:23 Spam ReportCrash[1080] &lt;Notice&gt;: Saved report to /var/mobile/Library/Logs/CrashReporter/SamusTheBold_2016-08-04-153123_Spam.ips
Aug  4 15:31:23 Spam SpringBoard[53] &lt;Warning&gt;: Application 'UIKitApplication:com.appc.SamusTheBold[0xbad1]' crashed.
Aug  4 15:31:23 Spam assertiond[63] &lt;Warning&gt;: pid_suspend failed for &lt;BKNewProcess: 0x154e16170; com.appc.SamusTheBold; pid: 1079; hostpid: -1&gt;: Unknown error: -1, Unknown error: -1
Aug  4 15:31:23 Spam assertiond[63] &lt;Warning&gt;: Could not set priority of &lt;BKNewProcess: 0x154e16170; com.appc.SamusTheBold; pid: 1079; hostpid: -1&gt; to 2, priority: No such process
Aug  4 15:31:23 Spam assertiond[63] &lt;Warning&gt;: Could not set priority of &lt;BKNewProcess: 0x154e16170; com.appc.SamusTheBold; pid: 1079; hostpid: -1&gt; to 4096, priority: No such process
Aug  4 15:31:23 Spam SpringBoard[53] &lt;Warning&gt;: Unable to deliver -[UIRemoteApplication showTopMostMiniAlertWithSynchronizationPort:] message to port 0: (ipc/send) invalid destination port
Aug  4 15:31:23 Spam sharingd[59] &lt;Notice&gt;: 15:31:23.896 : Stopping Handoff scanning
</pre></code>

Handing off from <code>iOS8Device</code> to <code>iOS9Device</code>:
*iOS8Device:* Activity moved to a different device.
*iOS9Device:* continueactivity was fired.

<h4>TEST CODE:</h4>
<code><pre>
Ti.API.info("Creating activity...");
var win = Ti.UI.createWindow();
win.add(Ti.UI.createLabel({text: "Check logs",color: "white"}))
var activity =  Ti.App.iOS.createUserActivity({
    activityType:'com.foo.message',
    title:'Handoff Messenger',
    userInfo:{
        msg: 'Tag! You\'re it!'
    }
});
 
 
//if(!activity.isSupported()){
//    alert('activity is not supported');
//} else {
	Ti.API.info("Activity is supported...");
    activity.becomeCurrent();
//}
 
activity.addEventListener('useractivitywascontinued', function(e) {
    alert('Activity moved to a different device.');
});
 
Ti.App.iOS.addEventListener('continueactivity', function(e){
    alert("continueactivity was fired");
    if (e.activityType === 'com.foo.message' && e.userInfo.msg) {
        Ti.API.info(e.userInfo.msg);
    }
});
 
win.open();
 
/** -- tiapp.xml --
 
&lt;ios&gt;
	&lt;plist&gt;
		&lt;dict&gt;
		&lt;key&gt;NSUserActivityTypes&lt;/key&gt;
		&lt;array&gt;
			&lt;string&gt;com.foo.message&lt;/string&gt;
			&lt;string&gt;com.foo.bar&lt;/string&gt;
		&lt;/array&gt;
		&lt;/dict&gt;
	&lt;/plist&gt;
&lt;/ios&gt;
 
**/
</pre></code>



<h4>Steps to Reproduce</h4>
1. Ensure that both iOS8 / iOS9 devices are:
- Logged into the same iCloud account.
- Connected to the same WiFi Network.
- Bluetooth enabled.

2. Create a classic mobile application.
3. Apply the above test code to the app.js file.
4. Run the app to both devices.
5. Launch the app on the iOS9 device.
6. Launch the app through Handoff on the iOS8 device either by:
- Swiping up from the app icon present on the lock screen.
- Double tapping the home button and selecting the app.

<h4>Actual Result</h4>

App crashes with no error.

<h4>Expected Result</h4>

App should handoff from the iOS9 device to the iOS8 device successfully.

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-08-09

   Alright, I guess the following is causing the error:
   <code><pre>
       if( [userActivity.activityType isEqualToString:CSSearchableItemActionType]){
           if([userActivity userInfo] !=nil){
               [dict setObject:[[userActivity userInfo] objectForKey:CSSearchableItemActivityIdentifier] forKey:@"searchableItemActivityIdentifier"];
           }
       }
   
   </pre></code>
   because <code>isEqualToString:CSSearchableItemActionType</code> is an iOS 9 API. That also explains, why it works from iOS 8 to iOS 9 but not the other way around. Will wrap it properly to be ignored on iOS < 9. Good catch!
   
   Additional infos:
   - Caused by [this PR](<a href="https://github.com/appcelerator/titanium_mobile/pull/7081)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/7081)</a>
   - Inside the core since the 5.0.0 release
   - Adjusted the demo-code to log the second debug. That was causing the alert-warning, because the previous alert was already presented.</li>
<li>Hans Knöchel 2016-08-09

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/8201" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8201</a>
   PR (6_0_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/8202" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8202</a>
   
   Please do a full FT using an iOS 8 and iOS 9 QE-device, thanks!</li>
<li>Hans Knöchel 2016-08-14

   PR (5_5_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/8223" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8223</a></li>
<li>Harry Bryant 2016-08-16

   Verified as fixed, Handoff no longer crashes when switching from an iOS9 device to an iOS8 device.
   
   Tested On:
   iPhone 6S (9.3.4, 8.2) Device 
   Mac OSX El Capitan 10.11.6
   Ti SDK: 5.5.0.v20160816120242
   Appc Studio: 4.7.0.201607250649
   Appc NPM: 4.2.7	
   App CLI: 6.0.0-25
   Xcode 8.0 beta 6 (8S193k)
   Node v4.4.7
   
   *Closing ticket.*</li>
</ol>


<p><a href="/TIMOB/TIMOB-23747.json">JSON Source</a></p>