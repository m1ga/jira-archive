---
title: "[TIMOB-23828] iOS10: Support new CSSearchQuery APIs"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-08-29T07:32:19.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.5.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios10, qe-5.5.0, searchquery</td></tr>
<tr><th>Reporter</th><td>Eric Wieber</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-08-25T21:31:00.000+0000</td></tr>
<tr><th>Updated</th><td>2017-01-23T18:49:56.000+0000</td></tr>
</table>

<h3>Description</h3>

In <a href="https://developer.apple.com/reference/corespotlight/cssearchquery" rel="nofollow" target="_blank">https://developer.apple.com/reference/corespotlight/cssearchquery</a>, iOS 10 offers new API's for the CoreSpotlight framework. In detail, these are new attributes for the CSSearchQuery to query an attribute set by it's attribute name. 

Proposed API:
<code><pre>
// The search-query
var searchQuery = Ti.App.iOS.createSearchQuery({
    queryString: "Searchable*",
    attributes: ["title", "displayName", "keywords", "contentType"]
});

// The event to be called when a new batch of items is found
searchQuery.addEventListener("founditems", function(e) {
    // Get found items with e.items
});

// The event to be called when the search-query completes
searchQuery.addEventListener("completed", function(e) {
    // Loop through your found items and access the searchable-item attribute-set
});

// Start the search-query (or use searchQuery.cancel()) to abort it
searchQuery.start();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-08-26

   Looks easy to expose and we can do that right next to the existing <code>[Ti.App.iOS.SearchableAttributeSet](<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.App.iOS.SearchableItemAttributeSet)</code> etc. -I will propose an API for it later today, probably on the <code>Ti.App.iOS.SearchQuery</code> namespace :-)- See the proposed API above.</li>
<li>Hans Knöchel 2016-08-27

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/8276" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8276</a>
   PR (6_0_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/8280" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8280</a>
   PR (5_5_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/8281" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8281</a>
   
   Demo:
   <code><pre>
   var win = Ti.UI.createWindow({
       backgroundColor: "#fff"
   });
   var btn = Ti.UI.createButton({
       title: "Start search-query"
   });
   
   var searchItems = [];
   var itemAttr = Ti.App.iOS.createSearchableItemAttributeSet({
       itemContentType: Ti.App.iOS.UTTYPE_IMAGE,
       title: "Titanium Core Spotlight Tutorial"
   });
   
   itemAttr.contentDescription = "Tech Example \nOn: " + String.formatDate(new Date(), "short");
   itemAttr.keywords = ["Mobile", "Appcelerator", "Titanium"];
   itemAttr.displayName = "Hello world";
   
   var item = Ti.App.iOS.createSearchableItem({
       uniqueIdentifier: "my-id",
       domainIdentifier: "com.mydomain",
       attributeSet: itemAttr
   });
   searchItems.push(item);
   
   var indexer = Ti.App.iOS.createSearchableIndex();
   
   indexer.addToDefaultSearchableIndex(searchItems, function(e) {
       if (e.success) {
           Ti.API.info("Press the home button and now search for your keywords");
       } else {
           alert("Errored: " + JSON.stringify(e.error));
       }
   });
   
   btn.addEventListener("click", function() {
       // An array of found Ti.App.iOS.SearchableItem's
       var allItems = [];
   
       // The search-query
       var searchQuery = Ti.App.iOS.createSearchQuery({
           queryString: 'title == "Titanium*"',
           attributes: ["title", "displayName", "keywords", "contentType"]
       });
   
       // The event to be called when a new batch of items is found
       searchQuery.addEventListener("founditems", function(e) {
           for (var i = 0; i < e.items.length; i++) {
               allItems.push(e.items[i]);
           }
       });
   
       // The event to be called when the search-query completes
       searchQuery.addEventListener("completed", function(e) {
           if (!e.success) {
               alert(e.error);
           }
   
           for (var i = 0; i < allItems.length; i++) {
               var attributeSet = allItems[i].attributeSet
               var foundTitle = attributeSet.title
               var foundDisplayName = attributeSet.displayName
   
               Ti.API.info("title: " + foundTitle + ", displayName: " + foundDisplayName);
           }
       });
   
       // Start the search-query (or use searchQuery.cancel()) to abort it
       searchQuery.start();
   });
   
   win.add(btn);
   win.open();
   </pre></code></li>
<li>Chee Kiat Ng 2016-08-29

   CR and FT passed! PRs merged! </li>
<li>Eric Wieber 2016-08-29

   Verified implemented, using:
   
   MacOS 10.12 (16A239m)
   Studio 4.7.1.201608190732
   Ti SDK 5.5.0.v20160829003224
   Appc NPM 4.2.7
   Appc CLI 5.5.0-5
   Xcode 8.0 (8S201h)
   
   Able to search for and properly return indexed app content. Tested using the sample code provided and modified versions of it. Searches return the correct information when searching through zero, one, or several apps who's content has been indexed previously.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23828.json">JSON Source</a></p>