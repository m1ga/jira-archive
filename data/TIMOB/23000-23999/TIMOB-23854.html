---
title: "[TIMOB-23854] Hyperloop: iOS - Support creating of Run Script phases"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-12-02T15:08:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>hyperloop 1.2.7</td></tr>
<tr><th>Fix Version/s</th><td>Hyperloop 2.2.0</td></tr>
<tr><th>Components</th><td>Hyperloop</td></tr>
<tr><th>Labels</th><td>hyperloop, ios</td></tr>
<tr><th>Reporter</th><td>Rodolfo Perottoni</td></tr>
<tr><th>Assignee</th><td>Jan Vennemann</td></tr>
<tr><th>Created</th><td>2016-09-01T00:29:39.000+0000</td></tr>
<tr><th>Updated</th><td>2017-10-19T18:16:31.000+0000</td></tr>
</table>

<h3>Description</h3>

Some native iOS libs / frameworks require the developer to call certain scripts during the build phase (see image attached). This could be done in the *appc.js* file:

<code><pre>
hyperloop: {
  ios: {
    xcodebuild: {
      scripts: [{
        name: 'My script phase',
        shellScript: '${APPC_PROJECT_DIR}/src/script.sh'
      }]
    }
  }
}
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-23854_60175/Screen Shot 2016-09-01 at 10.23.37 AM.png">Screen Shot 2016-09-01 at 10.23.37 AM.png</td></td><td>2016-09-01T00:23:54.000+0000</td><td>19069</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-09-01

   We can think about that. But you can actually do it today already using the Titanium plugin-hooks. Summarized, we have different hooks in our CLI that you can hook into (like we already do with our Hyperloop CLI that sits in <code>plugins/hyperloop</code>. So you could be notified when certain build phases are reached and inject your own scripts there (e.g. run shell-scripts using node-commands). 
   
   Please check out how Hyperloop makes it and go from there for now. We schedule it anyway, might be a good appc.js addition. Thanks!</li>
<li>Rodolfo Perottoni 2016-09-01

   Cool, I'll give it a go.</li>
<li>Hans Knöchel 2016-09-02

   Here is how it's mapped in the .pbxproj file:
   <code><pre>
   3AC54DA81D7A4392007D9994 /* ShellScript */ = {
   	isa = PBXShellScriptBuildPhase;
   	buildActionMask = 2147483647;
   	files = (
   	);
   	inputPaths = (
   		"$(SRCROOT)/myfile",
   	);
   	outputPaths = (
   		"$(DERIVED_FILE_DIR)/myfile",
   	);
   	runOnlyForDeploymentPostprocessing = 0;
   	shellPath = /bin/sh;
   	shellScript = test;
   };
   </pre></code>
   
   as well as the reference of the ID in the <code>buildPhases</code> list.</li>
<li>Hans Knöchel 2016-10-09

   [This page](<a href="http://www.monobjc.net/xcode-project-file-format.html)" rel="nofollow" target="_blank">http://www.monobjc.net/xcode-project-file-format.html)</a> has a good summary, see the "PBXShellScriptBuildPhase" paragraph.</li>
<li>Hans Knöchel 2016-10-27

   [~rdperottoni] Updated your proposal regarding the structure to have a more native data-structure. Where should we place scripts? Is <code>src/scripts/</code> cool?</li>
<li>Jan Vennemann 2016-11-29

   PR (master): <a href="https://github.com/appcelerator/hyperloop.next/pull/104" rel="nofollow" target="_blank">https://github.com/appcelerator/hyperloop.next/pull/104</a>
   PR (2_0_X): <a href="https://github.com/appcelerator/hyperloop.next/pull/105" rel="nofollow" target="_blank">https://github.com/appcelerator/hyperloop.next/pull/105</a>
   
   Usually I'm all in for convention over configuration but i felt the automatic mapping of a script name to a file in a folder we define is not quite fitting here. Instead, I introduced the env variable <code>$&#123;APPC_PROJECT_DIR&#125;</code> which points to the app's project directory. This is closer to the native behavior in Xcode where <code>$&#123;SRCROOT&#125;</code> is used by default, which points to the Xcode project directory.
   
   The minimum configuration to add a Run Script phase:
   <code><pre>
   hyperloop: {
     ios: {
       xcodebuild: {
         scripts: [{
           name: 'My script phase',
           shellScript: '${APPC_PROJECT_DIR}/src/script.sh'
         }]
       }
     }
   }
   </pre></code>
   
   All other options are optional and default to the following:
   * <code>shellPath</code>: <code>'/bin/sh'</code>
   * <code>runOnlyWhenInstalling</code>: <code>false</code>. I adopted the description from within Xcode for this field which is more clear than the <code>runOnlyForDeploymentPostprocessing</code> used inside the pbproj file
   * <code>inputPaths</code>: <code>[]</code>
   * <code>outputPaths</code>: <code>[]</code>
   * <code>showEnvVarsInLog</code>: <code>false</code></li>
<li>Hans Knöchel 2016-11-29

   Thanks for the input Jan. I get where you are coming from, but I'd really like to prevent the env-variable in there. First, because all Hyperloop-related assets should be stored in <code>src/</code> (which I still don't really like, since we already have <code>app/assets</code> (Alloy) and <code>/Resources</code> (Classic), and second, because it adds another level of confusion, because using <code>APPC_SRCROOT</code>, I'd guess to be in <code>/src</code> already. So either we normalize the names of it to match more existing ones (see the ones in _build.js), or get rid of them in there completely. </li>
<li>Eric Wieber 2017-10-19

   Verified. Able to run scripts and inline shell commands in the appc.js. Run script phases correctly execute and show in the logs.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23854.json">JSON Source</a></p>