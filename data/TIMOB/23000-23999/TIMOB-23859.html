---
title: "[TIMOB-23859] App created with 6.0.0 SDK & with hyperloop references fails to build with 5.5.0 SDK with error \"You cannot use the Hyperloop compiler with a version of Titanium older than 6.0.0\""
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-09-12T17:10:54.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.5.0, hyperloop 1.2.7</td></tr>
<tr><th>Components</th><td>Android, Hyperloop, Tooling</td></tr>
<tr><th>Labels</th><td>qe-6.0.0</td></tr>
<tr><th>Reporter</th><td>Lokesh Choudhary</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2016-09-02T01:01:26.000+0000</td></tr>
<tr><th>Updated</th><td>2016-09-14T22:00:14.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Steps to reproduce:</h4>
1. Create a default app with hyperloop enabled using SDK 6.0.0. (App will get created with hyperloop module 2.0.0).
2. Now, change the SDK to 5.5.0 in the tiapp.xml, the hyperloop module to 1.2.6 & aca to 1.0.0.
3. Make sure you have references for hyperloop in the app.js e.g <code>var View = require('android.view.View');</code>
4. Build the app for android device/emulator.

<h4>Actual Result:</h4>
1. The app fails to build with error:
<code><pre>
[ERROR] :  You cannot use the Hyperloop compiler with a version of Titanium older than 6.0.0
[ERROR] :  Set the value of &lt;sdk-version&gt; to a newer version in tiapp.xml.
[ERROR] :  For example:
[ERROR] :  	&lt;sdk-version&gt;6.0.0.GA&lt;/sdk-version&gt;
</pre></code>

2. My modules in tiapp.xml:
<code><pre>
        &lt;module platform="iphone" version="1.0"&gt;com.soasta.touchtest&lt;/module&gt;
        &lt;module platform="android" version="1.0"&gt;com.soasta.touchtest&lt;/module&gt;
        &lt;module platform="iphone" version="2.0.0"&gt;hyperloop&lt;/module&gt;
        &lt;module platform="android" version="1.2.6"&gt;hyperloop&lt;/module&gt;
        &lt;module platform="iphone"&gt;com.appcelerator.aca&lt;/module&gt;
        &lt;module platform="android" version="1.0.0"&gt;com.appcelerator.aca&lt;/module&gt;
        &lt;module platform="commonjs"&gt;ti.cloud&lt;/module&gt;
</pre></code>

<h4>Expected Results:</h4>
1. The app should build fine with 5.5.0 SDK & hyperloop 1.2.6, even if the app is created using SDK 6.0.0. 

<h3>Comments</h3>

<ol>
<li>Chee Kiat Ng 2016-09-02

   ya this is a problem because the hyperloop module contains both a plugin and a module. For every new version of hyperloop module installed, the new plugin always overwrite the previous one. [~fmiao] I like to ask, I have seen for plugins like soasta, it actually maintains versions in the plugins folder. I wonder if this is applicable to the hyperloop module whereby we maintain multiple versions of the plugin as well, and use the appropriate one for every corresponding version? If this is doable, we should get this into 5.5.0.GA, hyperloop 1.2.7.</li>
<li>Feon Sua Xin Miao 2016-09-02

   [~cng] If we can bundle hyperloop plugin like this in the zip: <code>plugins/hyperloop/&lt;version&gt;/</code>, that should prevent the plugin being overwritten when CLI extracts it.</li>
<li>Chee Kiat Ng 2016-09-05

   [~fmiao] Then it's probably a good idea to implement this asap while we have only released 1 version of hyperloop then. Do you think you can implement this please?</li>
<li>Feon Sua Xin Miao 2016-09-06

   [~cng], I was under the impressing that this is going to be handled when you are creating the zip file that contains both hyperloop module and plugin. </li>
<li>Hans Knöchel 2016-09-06

   Here is what I came up with so far. Add the following lines before <code>echo "Creating combined zip with iOS and Android"</code>:
   <code><pre>
   <h4>Move to version-based directory and clean-up old files</h4>
   mkdir plugins/hyperloop/1.2.7
   cp -r plugins/hyperloop/!(1.2.7) plugins/hyperloop/1.2.7
   rm -rf plugins/hyperloop/!(1.2.7)
   </pre></code>
   
   It basically creates a new directory "1.2.7", copied everything except itself into it and removes the old files from the old location afterwards. It works when used in the terminal, but using it in the shell-script and with the <code>$VERSION</code> variable does not seem to work. If we can figure that out, it shouldn't make any problems. [~fmiao] Can you confirm that having <code>plugins/hyperloop/&lt;version&gt;/</code> will be detected by the CLI properly?</li>
<li>Feon Sua Xin Miao 2016-09-07

   [~hans123], I'm not sure how will the hyperloop plugin be called during project build, as far as I'm aware, putting the plugin in a version directory will work for appc cli.</li>
<li>Chee Kiat Ng 2016-09-07

   PR here: <a href="https://github.com/appcelerator/hyperloop.next/pull/70" rel="nofollow" target="_blank">https://github.com/appcelerator/hyperloop.next/pull/70</a>
   One big issue with this is that it will only work if you do <code>&lt;plugin version="1.2.7"&gt;hyperloop&lt;plugin&gt;</code>
   If you don't set a version, CLI will use "latest". But the problem is, CLI thinks that the content in the root folder (formally 1.2.6 since it didn't do this versioning stuff), it uses that instead.
   [~fmiao] Any idea what we can do about CLI's priority in finding the latest version? Let me know if it's something we can change on the CLI side, then I'll set the min sdk requirement on this 1.2.7 module to 5.5.0.</li>
<li>Chee Kiat Ng 2016-09-07

   compiled binary for testing here: <a href="https://github.com/appcelerator/hyperloop.next/releases/tag/1.2.7-beta.2" rel="nofollow" target="_blank">https://github.com/appcelerator/hyperloop.next/releases/tag/1.2.7-beta.2</a>
   
   Plus I'm having difficulty building hyperloop 2.0.0 fr Ti SDK 6.0.0 (due to android) but not urgent at this moment. will look into it later tomorrow.</li>
<li>Hans Knöchel 2016-09-07

   [~cng], [~fmiao] Can we ensure that all new versions of Hyperloop will automatically get the version-tag in the tiapp.xml when installing Hyperloop?</li>
<li>Chee Kiat Ng 2016-09-07

    Ok something strange happening here. I had it working earlier today but it's no longer working now. 
    I have been testing with hyperloop-examples and I had tiapp.xml <code>&lt;plugin version="1.2.7"&gt;hyperloop&lt;/plugin&gt;</code>
    if you look at the trace:
    <code><pre>
    [INFO] :   Found Titanium plugin id=hyperloop version=1.2.7 
    </pre></code>
    That is correct but further down the trace:
    <code><pre>
    [TRACE] :  [Hyperloop] running /Users/kiat/Library/Application Support/Titanium/plugins/hyperloop/node_modules/hyperloop-metabase/bin/metabase with -i /Users/kiat/titaniumModules/hyperloop-examples/build/hyperloop/ios/metabase-7.1-iphonesimulator-bfa58c933e7311ecbbb692308ba0316a.h -o /Users/kiat/titaniumModules/hyperloop-examples/build/hyperloop/ios/metabase-7.1-iphonesimulator-bfa58c933e7311ecbbb692308ba0316a.json -sim-sdk-path /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator9.3.sdk -min-ios-ver 7.1 -pretty
    </pre></code>
    it should be running <code>/Users/kiat/Library/Application Support/Titanium/plugins/hyperloop/1.2.7/node_modules/hyperloop-metabase/bin/metabase</code> instead of <code>/Users/kiat/Library/Application Support/Titanium/plugins/hyperloop/node_modules/hyperloop-metabase/bin/metabase</code>
    Not sure what went wrong.
    
    *Important thing to note*: This is tested with 1.2.6 installed prior. That means, there's already 1.2.6 plugin in the root folder (without a version folder). So this will happen to people who installed 1.2.6 before installing 1.2.7.</li>
<li>Feon Sua Xin Miao 2016-09-07

    <a href="https://github.com/appcelerator/node-appc/blob/master/lib/tiplugin.js#L278-L290" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/blob/master/lib/tiplugin.js#L278-L290</a>, looks like if there are plugin files in the root folder, plugin in detection will not loop through the versions.
    
    I think we should also re-package hyperloop@1.2.6 tarballs to include the version folder, and also put a note to inform developers that they should remove the hyperloop plugins folder so the next time hyperloop module installation kicks in, the plugin will be in the version folder.
    </li>
<li>Chee Kiat Ng 2016-09-08

    Master PR here for hyperloop versioning: <a href="https://github.com/appcelerator/hyperloop.next/pull/71" rel="nofollow" target="_blank">https://github.com/appcelerator/hyperloop.next/pull/71</a> [~jvennemann]</li>
<li>Jan Vennemann 2016-09-08

    Changes to the build script approved and merged for both 1.2.x and master branch.</li>
<li>Chris Barber 2016-09-08

    TiSDK master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8327" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8327</a>
    TiSDK 6_0_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8328" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8328</a>
    TiSDK 5_5_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8329" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8329</a></li>
<li>Chee Kiat Ng 2016-09-09

    <h4>How to test for 5.5.0</h4>
    Use the latest environment on preproduction for 5_5_X, and test the following scenarios whereby someone previously on 5.4.0.GA just updated to 5.5.0.
    - *Create a brand new app after upgrade*
    <h4>appc new --classic</h4>
    <h4>appc run -p ios -I 10.0</h4>
    <h4>App should build and run normally. Also to check in <code>Library/Application Support/Titanium/plugins/hyperloop</code> if there's both <code>1.2.6</code> and <code>1.2.7</code> folders, with no other files in the root.</h4>
    - *Changing the sdk in tiapp.xml and running a pre-existing hyperloop-enabled app*
    <h4>Using hyperloop-examples, in tiapp.xml, change the sdk-version to the version that contains this fix, and make sure that plugin and module of hyperloop has no specific version number assigned.</h4>
    <h4>appc run -p ios -I 10.0</h4>
    <h4>App should build and run normally. Also to check in <code>Library/Application Support/Titanium/plugins/hyperloop</code> if there's both <code>1.2.6</code> and <code>1.2.7</code> folders, with no other files in the root.</h4>
    
    <h4>Something to note for multiple Xcode installations and Hyperloop</h4>
    If you have multiple Xcode installations, and you use the <code>-I</code> flag in appc cli, make sure that the Active Xcode is consistent with that flag. 
    - <code>sudo xcode-select --switch /Applications/Xcode8.app</code> and <code>appc run -p ios -I 10.0</code>
    - <code>sudo xcode-select --switch /Applications/Xcode731.app</code> and <code>appc run -p ios -I 9.3</code>
    will work well with Hyperloop.
    And if you switch between Xcodes, make sure to clean the project.</li>
<li>Chee Kiat Ng 2016-09-09

    CR and FT passed. PRs merged. 
    However, to test this properly, this new ticket has to be addressed: CLI-1101</li>
<li>Lokesh Choudhary 2016-09-14

    Verified the fix. We get version folders for both hyperloop plugin & module.
    
    FYI, when you have an app created with 6.0.0 SDK with hyperloop enabled & want to build it with 5.5.0.GA SDK with 1.2.7 hyperloop module you got to manually select the 1.2.7 plugin in the tiapp.xml.
    <code><pre>
     &lt;plugins&gt;
            &lt;plugin version="1.2.7"&gt;hyperloop&lt;/plugin&gt;
    &lt;/plugins&gt;
    </pre></code>
    
    Closing.
    
    Environment:
    Appc Studio : 4.8.0.201609061702
    Ti SDK :  6.0.0.v20160913184210 , 5.5.0.GA
    Ti CLI : 5.0.9
    Alloy : 1.9.1
    MAC El Capitan : 10.11.6
    Appc NPM : 4.2.8-6
    Appc CLI : 6.0.0-38
    Node: 4.4.4
    Nexus 6 - Android 6.0.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-23859.json">JSON Source</a></p>