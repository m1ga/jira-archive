---
title: "[TIMOB-23864] CLI: Build process does not exit if using an incompatible module based on apiversion"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-09-19T17:12:02.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0, node-appc 0.2.37</td></tr>
<tr><th>Components</th><td>Android, CLI, Tooling</td></tr>
<tr><th>Labels</th><td>qe-6.0.0</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Feon Sua Xin Miao</td></tr>
<tr><th>Created</th><td>2016-09-05T10:02:09.000+0000</td></tr>
<tr><th>Updated</th><td>2016-09-19T18:33:20.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

When building using a 6.0.0 SDK and an old module that is incompatible with this SDK i.e the apiversion of the module is 2 the build process will not error out on the module check and the app will build and attempt to launch on device, but will not open.

*Notes*

The inverse of the situation does not happen as the CLI only enforces the minsdk value from the manifest and not the apiversion

<h4>Steps to reproduce</h4>
 *These steps assume you have the same versions on your machine, correct as needed*
<h4>Edit the tiapp.xml modules section to include the following <code><module platform="android" version="2.3.10">ti.map</module></code></h4>
<h4>Include ti.map in your project by adding <code>var map = require('ti.map')</code></h4>
<h4>Ensure you are building with a 6.0.0 SDK</h4>
<h4>Build the project using <code>appc run -p android -T device</code></h4>

<h4>Actual result</h4>

The project will build successfully, the app will attempt to launch on device but fail

<h4>Expected result</h4>

As the module is incompatible with 6.0.0, the build process should fail

<h3>Comments</h3>

<ol>
<li>Chris Barber 2016-09-07

   node-appc PR: <a href="https://github.com/appcelerator/node-appc/pull/118" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/118</a></li>
<li>Feon Sua Xin Miao 2016-09-07

   Master: <a href="https://github.com/appcelerator/titanium_mobile/pull/8325" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8325</a>
   6_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/8324" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8324</a>
   </li>
<li>Lokesh Choudhary 2016-09-15

   [~fmiao], I get the debug log <code><pre> [DEBUG] Found incompatible Titanium module id=ti.map version=2.3.10 platform=android deploy-type=test
   </pre></code>if an incompatible module is used. But should we use more vocal log like warn/error.
   
   Also, I get this error, Not sure where this comes from:
   <code><pre>[ERROR] :  Could not find all required Titanium Modules:
   [ERROR] :     id: ti.map	 version: 2.3.10	 platform: android	 deploy-type: test</pre></code>
   This defeats the purpose of showing the debug log.
   
   Full log:
   <code><pre>
   [DEBUG] :  Looking for Titanium module id=ti.map version=2.3.10 platform=android deploy-type=test
   [DEBUG] :  Found incompatible Titanium module id=ti.map version=2.3.10 platform=android deploy-type=test
   [DEBUG] :  Module ti.map has apiversion=2, but the selected SDK supports module apiversion=3 on platform=android
   [WARN] :   Could not find a valid Titanium module id=ti.map version=2.3.10 platform=android deploy-type=test
   [ERROR] :  Could not find all required Titanium Modules:
   [ERROR] :     id: ti.map	 version: 2.3.10	 platform: android	 deploy-type: test
   </pre></code></li>
<li>Chris Barber 2016-09-15

   So, all that we need to do is edit <code>builder.js</code> and in <code>validateTiModules()</code>, add the <code>api-version</code> to the error output.
   
   First we need to do:
   
   <code><pre>
   var moduleAPIVersion = ti.manifest.moduleAPIVersion && ti.manifest.moduleAPIVersion[platformName];
   </pre></code>
   
   Then add the following to the missing and incompatible module list <code>console.log()</code> calls:
   
   <code><pre>
   (moduleAPIVersion ? '\t api-version: ' + moduleAPIVersion : '')
   </pre></code></li>
<li>Feon Sua Xin Miao 2016-09-15

   The error output is from [modules.missing.length](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/node_modules/titanium-sdk/lib/builder.js#L355)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/node_modules/titanium-sdk/lib/builder.js#L355)</a>, although under this case it should go into [modules.incompatible.length](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/node_modules/titanium-sdk/lib/builder.js#L364)." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/node_modules/titanium-sdk/lib/builder.js#L364).</a></li>
<li>Chris Barber 2016-09-15

   [~fmiao] You did put it under incompatible modules. :)
   
   <a href="https://github.com/appcelerator/node-appc/blob/dfd8dc5cab6f4978c9d4d5da85a8fd1b9ef1a79a/lib/timodule.js#L304" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/blob/dfd8dc5cab6f4978c9d4d5da85a8fd1b9ef1a79a/lib/timodule.js#L304</a></li>
<li>Feon Sua Xin Miao 2016-09-19

   Fixed node-appc@0.2.38. 
   
   Build should fail with following message:
   <code><pre>
   [ERROR] :  Found incompatible Titanium Modules:
   [ERROR] :     id: hyperloop	 version: 1.2.7	 platform: android	 min sdk: 5.4.0
   </pre></code></li>
<li>Lokesh Choudhary 2016-09-19

   Verified the fix.
   
   Closing.
   
   Environment:
   Appc Studio : 4.8.0.201609101003
   Ti SDK :  6.0.0.v20160919100523
   Ti CLI : 5.0.9
   Alloy : 1.9.1
   MAC El Capitan : 10.11.6
   Appc NPM : 4.2.8-6
   Appc CLI : 6.0.0-46
   Node: 4.4.4
   Nexus 6 - Android 6.0.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-23864.json">JSON Source</a></p>