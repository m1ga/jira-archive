---
title: "[TIMOB-23904] iOS10: Button listener takes two taps before responding for Facebook login"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-09-17T11:49:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 5.5.1, facebook 5.2.7</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>qe-5.5.0</td></tr>
<tr><th>Reporter</th><td>Eric Merriman </td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-09-14T20:58:00.000+0000</td></tr>
<tr><th>Updated</th><td>2016-09-22T21:51:02.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description:</h4>
While testing a fix for TIMOB-23890, I noticed that the button for login required two presses before I was presented with the Facebook login. Sample code is here:
<code><pre>
var fb = require("facebook");
 
// Facebook Stuff
fb.initialize();
 
 
var win = Ti.UI.createWindow();
 
var fbloginbutton = Ti.UI.createButton({
    title: "Login with Facebook"
});
 
fbloginbutton.addEventListener("click", function() {
    fb.authorize();
});
 
win.add(fbloginbutton);
 
var lbl = Ti.UI.createLabel({
    color: "red",
    text: fb.loggedIn
});

win.open();
</pre></code>

<h4>Steps to reproduce:</h4>
1) Create a new classic mobile project
2) Attach the Facebook module
3) Paste the sample code into app.js
4) Install and launch
5) Press the "Login with Facebook" button

<h4>Result:</h4>
Nothing happens - Until you press the button again.

<h4>Expected Result:</h4>
The Facebook login process begins

<h3>Comments</h3>

<ol>
<li>Chee Kiat Ng 2016-09-14

   [~hansknoechel] as you have mentioned to me before, is this related to another ticket?</li>
<li>Hans Knöchel 2016-09-14

   Well, I guess it's because our <code>Ti.UI.Button</code> reacts different to a click-event than other UI-components do. It's more a general behavior than specific to our ti.facebook module. If you feel that we want to change this behavior, I'd do some native comparisons.</li>
<li>Ygor Lemos 2016-09-14

   I have been able to reproduce this on my app. Sometimes just tapping another Ti.Button on our login flow makes the Ti.Button for facebook login work.
   
   This makes fb.authorize() unusable for login (specially when you block the UI with a loader for preventing multiple taps on the fb login button).
   
   fb.authorize() is the only way to have custom facebook login buttons.
   
   Also, this is very hard (at least for us) to reproduce on the simulator as the button that calls the authorize method seems to always work, but on the device itself we've managed to reproduce it every time.</li>
<li>Ygor Lemos 2016-09-14

   As a temp-fix/jerry-rig I've tried to add a setTimeout calling the fb.authorize() method again after 500 ms.
   
   This works for all the times in which I needed to tap the button again for login but sometimes when authorize() works at first call, it opens a second SFSafariViewController with the facebook login flow and mess up the login flow and callbacks on the app since I'm invoking authorize() 2 times.
   
   This is not a viable solution at all but may help you in debugging.
   
   Also I have noticed that after a successful facebook login on the app, the button always works normally if I logout and login again without killing the app.
   The issue returns if I logout and manually kill the app.
   
   For now we are unblocking the UI (removing a full screen loader after the user tap the Facebook login for the first time) so the user can tap again at his own will if the SFSafariViewController doesn't appear (which is far from optimal).</li>
<li>Ygor Lemos 2016-09-16

   @Hans can we increase the priority of this issue? Is it being discussed for 6.0.0 ? Thanks.</li>
<li>Hans Knöchel 2016-09-16

   Yes, I will investigate it in the upcoming sprint. I'm still wondering why that could be an issue. Is this also happening on iOS < 9? And how about older ti.facebook versions? I need as many environments as possible.</li>
<li>Hans Knöchel 2016-09-16

   Just reproduced it, it's a valid issue! [~cng] Might even be considered for 5.5.1
   
   *EDIT*: Found [this Stackoverflow post](<a href="http://stackoverflow.com/questions/39532132/blank-page-while-logging-in-with-facebook-sdk-on-ios-10)" rel="nofollow" target="_blank">http://stackoverflow.com/questions/39532132/blank-page-while-logging-in-with-facebook-sdk-on-ios-10)</a> that has the exact same issue. So I guess the Safari-Dialog tries to pop up "too early" and since <code>fromViewController</code> is <code>nil</code> in our case, it doesn't get called. [~ygbr] Can I send you a custom build that you verify? Guess I have something.</li>
<li>Ygor Lemos 2016-09-16

   @Hans sure, I can test it now.
   
   ps: I don't know why, but I can't mention anybody on appc Jira...</li>
<li>Hans Knöchel 2016-09-16

   PR: <a href="https://github.com/appcelerator-modules/ti.facebook/pull/68" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.facebook/pull/68</a>
   
   I will also cherry-pick the changes from [Kiat's PR](<a href="https://github.com/appcelerator-modules/ti.facebook/pull/67)" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.facebook/pull/67)</a> for adjusted docs.
   
   [~ygbr] Please try [facebook-iphone-5.2.7.zip](<a href="https://www.dropbox.com/s/aj3diy7zxlx60z6/facebook-iphone-5.2.7.zip?dl=0)" rel="nofollow" target="_blank">https://www.dropbox.com/s/aj3diy7zxlx60z6/facebook-iphone-5.2.7.zip?dl=0)</a>, thanks!
   
   </li>
<li>Chee Kiat Ng 2016-09-17

    CR and FT passed. PR merged. 
    Can we have the back ports please.</li>
<li>Hans Knöchel 2016-09-17

    PR (titanium_mobile):
    master: <a href="https://github.com/appcelerator/titanium_mobile/pull/8390" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8390</a>
    6_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/8391" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8391</a>
    5_5_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/8392" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8392</a></li>
<li>Lokesh Choudhary 2016-09-22

    Verified the fix.
    
    The button listener now responds after the first click for facebook login.
    Closing.
    
    Environment:
    Appc Studio : 4.8.0.201609191928
    Ti SDK :  6.1.0.v20160922115612, 6.0.0.v20160922115636, 5.5.1.v20160921190109 
    Ti CLI : 5.0.9
    Alloy : 1.9.1
    MAC El Capitan : 10.11.6
    Appc NPM : 4.2.7
    Appc CLI : 5.5.0
    Node: 4.4.4
    Iphone 6 : IOS 10
    Iphone simulator 7 plus : IOS 10
    Iphone 6 : IOS 9.3.5
    Facebook module : 5.2.7</li>
</ol>


<p><a href="/TIMOB/TIMOB-23904.json">JSON Source</a></p>