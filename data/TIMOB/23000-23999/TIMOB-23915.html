---
title: "[TIMOB-23915] Hyperloop - iOS: Touch event properties and methods are undefined"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2017-02-08T11:25:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Hyperloop, iOS</td></tr>
<tr><th>Labels</th><td>Hyperloop</td></tr>
<tr><th>Reporter</th><td>Brian García</td></tr>
<tr><th>Assignee</th><td>Jan Vennemann</td></tr>
<tr><th>Created</th><td>2016-09-16T09:05:33.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-24T18:35:47.000+0000</td></tr>
</table>

<h3>Description</h3>

Trying to get lastPoint touched in screen return 
<code><pre>
JS exception encountered calling callback: undefined is not a function (evaluating 'UITouch.prototype.locationInView($.win)')
</pre></code>

code to reproduce: 

it assumes there is a win defined in xml. 

<code><pre>
var UIView = require('UIKit/UIView');
var DrawView = Hyperloop.defineClass('DrawView', 'UIView');

DrawView.addMethod({
    selector : 'touchesBegan:withEvent:',
    instance : true,
    arguments : ['NSSet', 'UIEvent'],
    callback : function(touches, event) {
        var touch = touches.anyObject();
        var lastPoint = touch.locationInView($.win);
        console.log(lastPoint);
    }
});

var drawSurface = DrawView.alloc().initWithFrame(50, 0, 350, 350);
drawSurface.backgroundColor = UIColor.yellowColor();
$.win.add(drawSurface);

</pre></code>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-09-16

   You are passing a Ti.UI.Window to a native API, that won't work:
   <code><pre>
   touch.locationInView($.win);
   </pre></code>
   Instead, you may try to cast it to a UIView, using <code>UIView.cast($.win)</code></li>
<li>Brian García 2016-09-16

   Same result with casting:
   
   
   <code><pre>
   JS exception encountered calling callback: undefined is not a function (evaluating 'touch.locationInView(UIView.cast($.win))')
   </pre></code>
   </li>
<li>Hans Knöchel 2016-09-16

   Then I guess <code>touch</code> is already null before. Try:
   <code><pre>
   var touch = touches.allObjects[0];
   </pre></code>
   instead.</li>
<li>Brian García 2016-09-17

   touch returns a valid object:
   
   
   <code><pre>
   <UITouch: 0x7872dc10> phase: Began tap count: 1 window: <UIWindow: 0x789316c0; frame = (0 0; 320 480); gestureRecognizers = <NSArray: 0x78932280>; layer = <UIWindowLayer: 0x7892e9c0>> view: <DrawView: 0x7869b370; frame = (0 0; 320 480); layer = <CALayer: 0x7869a430>> location in window: {149.5, 225.5} previous location in window: {149.5, 225.5} location in view: {149.5, 225.5} previous location in view: {149.5, 225.5}
   </pre></code>
   
   any way  touches.allObjects[0]; returns null
   
   
   </li>
<li>Hans Knöchel 2016-09-17

   Ok, so it's really only about the <code>locationInView</code> method then. I also noticed that the log of the object returns <code>location in view: {149.5, 225.5}</code> so at least something is there. I will move to TIMOB for further investigations.
   
   Please also attach your generated metabase from <code>build/hyperloop/ios</code>, thx!</li>
<li>Hans Knöchel 2016-12-12

   Hey Brian, out of interest: When you include a Foundation class (e.g. <code>require('Foundation/NSURL')</code>), does that fix the issue? It might be related to a different issue of the same type. Thx!</li>
<li>Brian García 2016-12-13

   Hi Hans, 
   
   I tried what you suggested but with no success, it still failling with the same error. 
   
   I've just seen that you need the metabase, here is the gist (if you need a downloadable file let me know)[<a href="https://gist.github.com/Brianggalvez/1697f824da98bd1a6c002b848a79d49d" rel="nofollow" target="_blank">https://gist.github.com/Brianggalvez/1697f824da98bd1a6c002b848a79d49d</a>]</li>
<li>Jan Vennemann 2017-02-08

   I discovered a similar behavior when testing for TIMOB-24242. The <code>NSSet</code> will be populated with <code>NSTouch</code> objects on the native side. Somehow Hyperloop fails to properly wrap those objects when retrieving them from the <code>NSSet</code>, preventing any property access or method calls. I opened TIMOB-24383 to keep track of the root issue.</li>
<li>Hans Knöchel 2017-02-08

   Resolving as <code>Duplicate</code> to keep track in the root-ticket. Thx!</li>
<li>Lee Morris 2017-03-24

    Closing ticket as duplicate with reference to the linked issues.</li>
</ol>


<p><a href="/TIMOB/TIMOB-23915.json">JSON Source</a></p>