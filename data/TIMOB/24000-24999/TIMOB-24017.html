---
title: "[TIMOB-24017] iOS: Add support for headers to the log server"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-10-13T10:21:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Components</th><td>iOS, Tooling</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Chris Barber</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2016-10-11T23:19:51.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-20T17:11:06.000+0000</td></tr>
</table>

<h3>Description</h3>

When a client connects to the log server in the iOS app, it would helpful for the server to immediately respond with information about the app including the app id, version, environment (sim/device), and deploy type.

The format can be simple and basically mimic how HTTP works. When a new connection is accepted, it would immediately write:

<code><pre>
id: com.foo.bar
name: Testapp
version: 1.0.0
deploy-type: development
titanium-sdk: 6.0.0

</pre></code>

The client will interpret all lines prior to <code>\n\n</code> to be a header. Subsequent lines are to be interpreted as log lines.

We need this feature so that a client can validate it has connected to the correct log server. It's possible for two different apps to listen on the same work and a client may think it's connecting to one app's log server when in fact it's connecting to another app's log server.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2016-10-13

   Published ioslib@1.0.2
   PR: <a href="https://github.com/appcelerator/ioslib/pull/50" rel="nofollow" target="_blank">https://github.com/appcelerator/ioslib/pull/50</a></li>
<li>Chris Barber 2016-10-13

   TiSDK master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8503" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8503</a>
   TiSDK 6_0_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8504" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8504</a>
   
   To test:
   
   <h4>Create an app called "testapp1"</h4>
   <h4>Add <code>&lt;log-server-port&gt;12345&lt;/log-server-port&gt;</code> in the <code>&lt;ios&gt;</code> section of the tiapp.xml</h4>
   <h4>Build app for device</h4>
   <h4>LEAVE CLI, SIM, & APP RUNNING!</h4>
   <h4>Open 2nd terminal</h4>
   <h4>Create an app called "testapp2"</h4>
   <h4>Add <code>&lt;log-server-port&gt;12345&lt;/log-server-port&gt;</code> in the <code>&lt;ios&gt;</code> section of the tiapp.xml</h4>
   <h4>Build app for device</h4>
   
   NOTE: The app ids must be different.
   
   It should error when the CLI tries to 2nd app tries to connect to the 2nd app's log server.</li>
<li>Chee Kiat Ng 2016-10-13

   I used the test step after scons'ing the PR from 6_0_X. doesn't error out, still logging independently of each other.
   [~hansknoechel] if you have time test it out too?</li>
<li>Chris Barber 2016-10-13

   OK, so this is probably impossible to test with the simulator because my code is too smart. If you look at the build log output for the first app, it will select the port 12345. However, if you look at the build log output for the 2nd app, it will say a different port than 12345. Why is this you might ask? The build starts a local Node.js server to make sure that the port is available since the iOS Simulator shares ports with the local machine.
   
   For device builds, we can't tell if a port is available unless we try connecting to it. We could test the port, but this is not foolproof. If testapp1 is not running when testapp2 is building, but testapp1 is launched while testapp2 is being installed, then you'll still run into the problem that this ticket attempts to solve.
   
   So, if you do the above steps for a device build, it should show the error for the 2nd app.</li>
<li>Chee Kiat Ng 2016-10-13

   Great work! APPROVED!</li>
<li>Lee Morris 2017-03-20

   Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24017.json">JSON Source</a></p>