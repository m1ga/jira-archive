---
title: "[TIMOB-24140] iOS: Ti.Media.audioSessionCategory not working with Ti.Media.Sound"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-11-28T22:14:58.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>audiosessioncategory, background, ios, qe-6.0.1, sound</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-11-11T17:05:52.000+0000</td></tr>
<tr><th>Updated</th><td>2019-11-26T19:59:46.000+0000</td></tr>
</table>

<h3>Description</h3>

Thanks to [~designbymind], he reported an issue via mail that indicates a problem with our <code>Ti.Media.AUDIO_SESSION_CATEGORY_*</code> constants. As of TIMOB-23925, we wrapped our Ti.Media constants and in [this line](<a href="https://github.com/appcelerator/titanium_mobile/pull/8456/files#diff-e19e566138e39044280d74cfee0d3b4eR217)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8456/files#diff-e19e566138e39044280d74cfee0d3b4eR217)</a>, I wrapped it to only be compiled when the <code>Ti.Media.AudioPlayer</code> API is defined. But as it turns out, you can also use them for the <code>Ti.Media.Sound</code> API, so we just need to add that statement as well.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-24140_60690/test_file.mp3">test_file.mp3</td></td><td>2016-11-11T19:12:20.000+0000</td><td>1430174</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-11-11

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/8600" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8600</a>
   PR (6_0_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/8601" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8601</a>
   
   Test-case 1:
   <code><pre>
   var win = Ti.UI.createWindow({
       backgroundColor: "#fff"
   });
   
   var btn = Ti.UI.createButton({
       title: "Print AUDIO_SESSION_CATEGORY_AMBIENT"
   });
   
   btn.addEventListener("click", function() {
       // Create a Ti.Sound instance so the constant gets compiled
       var sound = Ti.Media.createSound();
   
       // Should print "AVAudioSessionCategoryAmbient"
       Ti.API.info(Ti.Media.AUDIO_SESSION_CATEGORY_AMBIENT);
   });
   
   win.add(btn);
   win.open();
   </pre></code>
   
   Test-case 2:
   <code><pre>
    Ti.Media.setAudioSessionCategory(Ti.Media.AUDIO_SESSION_CATEGORY_AMBIENT);
   
   // --- returns undefined on device ---
   // --- returns AudioSessionCategoryAVAudioSessionCategoryAmbient on simulator ---
   Ti.API.info("AudioSessionCategory: " + Ti.Media.getAudioSessionCategory());
   
   var window = Ti.UI.createWindow();
   
   var playSoundButton = Ti.UI.createButton({
       title: "Play Sound"
   });
   
   // --- Sound object creation will stop music player (Spotify/Apply Music) upon [initial] app
   var sound = Ti.Media.createSound({
       url: "test_file.mp3",
       volume: 1,
       preload: false
   });
   
   playSoundButton.addEventListener("click", function() {
       // --- Playing the sound will also stop music player (same as sound creation)
       sound.play();
   });
   
   window.add(playSoundButton);
   window.open();
   </pre></code></li>
<li>Harry Bryant 2016-11-24

   Tested the various audioSessionCategory constants available, and found the following results:
   
   <h4>Ti.Media.AUDIO_SESSION_CATEGORY_AMBIENT:</h4>
   _Also used for for 'play along' style applications, such a virtual piano that a user plays over iPod audio._
   
   *RESULT:*
   - Spotify Music does not pause when app is opened or when Sound is played. (/)
   - AudioSessionCategory: AVAudioSessionCategoryAmbient (/)
   
   <h4>Ti.Media.AUDIO_SESSION_CATEGORY_RECORD:</h4>
   _Session mode for recording audio; it silences playback audio._
   
   - Spotify Music is paused when app is opened. (/)
   - Sound does not play. (/)
   - AudioSessionCategory: AVAudioSessionCategoryRecord (/)
   
   <h4>Ti.Media.AUDIO_SESSION_CATEGORY_SOLO_AMBIENT:</h4>
   _When you use this category, audio from built-in applications, such as the iPod, is silenced. Your audio is silenced when the Ring/Silent switch is set to silent or when the screen locks._
   
   *RESULT:* 
   Spotify Music pauses when App is opened or when Sound is played. (/)
   Audio is silenced when the Ring/Silent switch is set to Silent. (/)
   Audio is silenced when screen is locked. (/)
   AudioSessionCategory: AVAudioSessionCategorySoloAmbient (/)
   
   <h4>Ti.Media.AUDIO_SESSION_CATEGORY_PLAYBACK:</h4>
   _When using this mode, your application audio continues with the Ring/Silent switch set to silent or when the screen locks. This property normally disallows mixing iPod audio with application audio._
   
   *RESULT:*
   Spotify Music pauses when App is opened or when sound is played. (/)
   Playback audio continues when device’s Ring/Silent switch is set to Silent. (/)
   Playback is silenced when screen is locked (x)
   Playback is silenced when app is backgrounded. (x)
   AudioSessionCategory: AVAudioSessionCategoryPlayback (/)
   
   *Reopening this issue* as <code>Ti.Media.AUDIO_SESSION_CATEGORY_PLAYBACK</code> does not meet the expected behaviour as described in the documentation.
   
   Tested On:
   iPhone 6 Plus 10.1.1 Device
   iPhone 5S 9.3.5 Device
   Mac OS Sierra (10.12.1)
   Ti SDK: 6.0.1.v20161121005220
   Appc Studio: 4.8.0.201611121409
   Appc NPM: 4.2.8
   App CLI: 6.0.0
   Xcode 8.1
   Node v4.4.7
   
   *EDIT:* After further investigation it was found that in order to allow background audio for iOS, the following needs to be specified in the <plist> of the tiapp.xml:
   <code><pre>
                   &lt;key&gt;UIBackgroundModes&lt;/key&gt;
               	&lt;array&gt;
               		&lt;string&gt;audio&lt;/string&gt;
               	&lt;/array&gt;
   </pre></code>
   
   It does not seem that this instruction is present in our documentation for Ti.Media.Sound or Ti.Media.AudioPlayer.
    
   </li>
<li>Marian Kucharcik 2019-11-26

   Hi guys,
   I'm experiencing problems with background audio playing on iOS13.2.3 - on older versions(13.1 and 12.x.x) it was fine and working. Now, I can anything but when my app minimizes, audio stops(the goal is to start playing after local notification is received). Phone makes 0.5seconds sound and then it's silence. When I maximize app(go foreground), music plays(it seems that notification starts player to play, but no sound is comming from speaker when in background, after going foreground player plays not from start, but continues...)
   Can you please look at it? I tried AUDIO_SESSION_CATEGORY_PLAYBACK and AUDIO_SESSION_CATEGORY_AMBIENT, but no change... 
   Thanks</li>
</ol>


<p><a href="/TIMOB/TIMOB-24140.json">JSON Source</a></p>