---
title: "[TIMOB-24148] iOS: CommonJS modules/Library code cannot share names with native classes"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-11-29T15:23:07.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>qe-6.0.0</td></tr>
<tr><th>Reporter</th><td>Eric Wieber</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-11-15T18:08:28.000+0000</td></tr>
<tr><th>Updated</th><td>2016-11-30T18:12:50.000+0000</td></tr>
</table>

<h3>Description</h3>

Creating a commonJS module or using library code files that share a name with internal native classes throws an error.

<code><pre>
[ERROR] :  Script Error {
[ERROR] :  column = 24;
[ERROR] :  line = 12;
[ERROR] :  message = "undefined is not a function (evaluating 'util.test()')";
[ERROR] :  sourceURL = "file:///Users/Eric/Library/Developer/CoreSimulator/Devices/83A39029-8DC3-4231-90FA-C9394BF09F69/data/Containers/Bundle/Application/CF7DEB2C-4872-4B44-A119-48F7201E8CC8/checkit.app/alloy/controllers/index.js";
[ERROR] :  stack = "doClick@file:///Users/Eric/Library/Developer/CoreSimulator/Devices/83A39029-8DC3-4231-90FA-C9394BF09F69/data/Containers/Bundle/Application/CF7DEB2C-4872-4B44-A119-48F7201E8CC8/checkit.app/alloy/controllers/index.js:12:24";
[ERROR] :  }
</pre></code>

*Steps to reproduce issue*
1. Create a new project
2. Add a js file to the app/lib folder that has the name of an internal native class (utils.js, for example)
3. Populate the file with an exported function
4. Require the module in the index.js and call the exported function

*Expected Results*
The exported function is called without issue

*Actual Results*
The above error is thrown

*Code*
For the default Alloy project, change the <code>index.js</code> to:
<code><pre>
var foo = require('utils');
function doClick(e) {
    alert(foo.test());
}

$.index.open();
</pre></code>

Then create a file called <code>app/lib/utils.js</code> (Alloy) or <code>Resources/utils.js</code> (Classic) and populate it with:
<code><pre>
exports.test = function() {
    return "I WAS CALLED";
};
</pre></code>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-11-15

   As a side-note: You are actually able to use something like <code>var md5 = require('utils').md5HexDigest('mystr');</code> instead of <code>var md5 = Ti.Utils.md5HexDigest('mystr');</code> which is pretty amazing and more "NodeJS'sh". 
   
   But for the solution, we will now throw an error-log when the user tries to use the exact same name as one of the top moduels (UI, Utils, Filesystem, Calendar, ...) so they either prefix it correctly (e.g. <code>require('./utils')</code>, <code>require('./filesystem')</code>, ...) or rename it to something that does not collide. PR coming later today.</li>
<li>Hans Knöchel 2016-11-16

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/8608" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8608</a>
   PR (6_0_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/8609" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8609</a></li>
<li>Hans Knöchel 2016-11-16

   [~cwilliams] Thinking about a proper unit-test, we could check if the local commonJS module fails and the native Ti method succeeds. </li>
<li>Christopher Williams 2016-11-29

   Fixes pushed to
   master: <a href="https://github.com/appcelerator/titanium_mobile/commit/9c564ab384ee3ea3c4e70a9d697eadf56fda0707" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/9c564ab384ee3ea3c4e70a9d697eadf56fda0707</a>
   6_0_X: <a href="https://github.com/appcelerator/titanium_mobile/commit/a6667488f527e09b10acadea90162c4bc6eb9d22" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/a6667488f527e09b10acadea90162c4bc6eb9d22</a></li>
<li>Christopher Williams 2016-11-29

   Note that there is no real "fix" here, but instead we now detect when there's a name clash using the old style un-prefixed requires, such as <code>require('utils');</code>
   
   In that scenario where there's a clash between a native API/module and a JS file we will spit ou  along warning to the logs stating that there was a collision and the native module/API was loaded in preference to the JS file, and if you intended to address the JS file you need to change the require to use a prefix such as <code>require('./utils')</code> or <code>require('/utils')</code></li>
<li>Eric Wieber 2016-11-30

   Verified "fixed" using:
   
   MacOS 10.12 (16A323)
   Studio 4.8.0.201611121409
   Ti SDK 6.0.1.v20161130023500
   Appc NPM 4.2.8
   Appc CLI 6.0.0
   Alloy 1.9.4
   Xcode 8.1 (8B62)
   
   As Chris stated, the fix here is to display a warning message to use <code>./&lt;module&gt;</code> or <code>/&lt;module&gt;</code> in order to use a CommonJS/library code with a naming conflict. This message is displayed when a conflict is detected and modifying the code, as described, will run without error.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24148.json">JSON Source</a></p>