---
title: "[TIMOB-24209] Android: <WebView> with link to video does not play after upgrade to TiSDK 6.0.0 (Regression)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-01-20T17:32:53.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>Alloy, WebView, android, qe-6.0.1</td></tr>
<tr><th>Reporter</th><td>John Dalsgaard</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2016-12-11T17:56:16.000+0000</td></tr>
<tr><th>Updated</th><td>2017-01-20T17:33:03.000+0000</td></tr>
</table>

<h3>Description</h3>

After upgrading to TiSDK 6.0.0 videos in a webview did not show any more. I have discussed the matter with Hans and have created this ticket with the findings.

My original code looks like this:

*video.xml*

<code><pre>
&lt;Alloy&gt;
    &lt;View class="formRow" id="row"&gt;
        &lt;Label id="title"&gt;&lt;/Label&gt;
        &lt;WebView id="player"&gt;&lt;/WebView&gt;
    &lt;/View&gt;
&lt;/Alloy&gt;
</pre></code>

*video.js*

<code><pre>
var args = arguments[0] || {};
const html="&lt;html&gt;&lt;body&gt;&lt;iframe src='{1}' width='320' height='240' frameborder='0' webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;";

if(args.title && args.url){
	$.title.text = args.title;
	$.player.html = require('utils/util').format(html, args.url);
}
</pre></code>

where the _format(..)_ method in _utils/util_ is a simple method:

<code><pre>
function format(pattern, a1, a2, a3, a4, a5){
	// Replace 'place holders' like {1} with a1 etc.
	if(pattern){
		return pattern.replace('{1}',a1 || '').replace('{2}',a2 || '').replace('{3}',a3 || '').replace('{4}',a4 || '').replace('{5}',a5 || '');
	}
	return '';
}
</pre></code>

.... and I call the _video_ controller like this:

*videos.js*

<code><pre>
var videos = [];
videos.push({title:'Introduktion til menu-funktionen', url:'<a href="https://player.vimeo.com/video/151036965" rel="nofollow" target="_blank">https://player.vimeo.com/video/151036965</a>'});
videos.push({title:'Sådan registrerer du en fisketur mens du fisker', url:'<a href="https://player.vimeo.com/video/151039720" rel="nofollow" target="_blank">https://player.vimeo.com/video/151039720</a>'});
videos.push({title:'Sådan indtaster du en overstået fisketur', url:'<a href="https://player.vimeo.com/video/151040599" rel="nofollow" target="_blank">https://player.vimeo.com/video/151040599</a>'});
videos.push({title:'Sådan får du overblik over dine fisketure og fangster via "Min side"', url:'<a href="https://player.vimeo.com/video/151041650" rel="nofollow" target="_blank">https://player.vimeo.com/video/151041650</a>'});
videos.push({title:'Sådan får du overblik over egne fisketure, fangster og statistik', url:'<a href="https://player.vimeo.com/video/151042851" rel="nofollow" target="_blank">https://player.vimeo.com/video/151042851</a>'});
videos.push({title:'Sådan redigerer du en fangst - hemmelig, pral og facebook', url:'<a href="https://player.vimeo.com/video/151043670" rel="nofollow" target="_blank">https://player.vimeo.com/video/151043670</a>'});
videos.push({title:'Find fredningsbælterne', url:'<a href="https://player.vimeo.com/video/194496467" rel="nofollow" target="_blank">https://player.vimeo.com/video/194496467</a>'});

setTimeout(function(){
	_.each(videos, function(v){
	    $.videoList.add(Alloy.createController('video', v).getView());
	});
}, 200);
</pre></code>

... where videoList is inside a scrollview like this:

*videos.xml*

<code><pre>
&lt;Alloy&gt;
    &lt;View id="mainView"&gt;
        &lt;Require src="topbar" id="label_title"&gt;&lt;/Require&gt;
        &lt;ScrollView id="form"&gt;
            &lt;View class="formRow"&gt;
                &lt;Label id="label_videos" /&gt;
            &lt;/View&gt;
            &lt;View class="formRow"&gt;
                &lt;Label id="label_videos_guide" /&gt;
            &lt;/View&gt;
            &lt;View class="separatorRow" top="20"&gt;
                &lt;View class="separatorTopBorder"/&gt;
            &lt;/View&gt;
            &lt;View id="videoList"&gt;&lt;/View&gt;
            &lt;View class="separatorRow" top="20"&gt;
                &lt;View class="separatorTopBorder"/&gt;
            &lt;/View&gt;
            &lt;View class="formRowFiller"&gt;&lt;/View&gt;
         &lt;/ScrollView&gt;
    &lt;/View&gt;
&lt;/Alloy&gt;
</pre></code>

That all worked fine up to TiSDK 5.5 - but upgrading to TiSDK 6.0.0 broke it. It still worked on iOS but on Android the webview was simply not loaded. The title was visible - but nothing after that (per video).

After the discussion with Hans I first tried to do the webview in js-only code. That worked for Android - but for iOS I could not start the video. I tried to set the zIndex to 1000 and set touchEnabled to true (though it is default) on the webview - but still couldn't start the video by pressing on the "play" button. Nothing happened.

So I ended up implementing the previous model for iOS and the js-only for Android. Like this:

*video.js*

<code><pre>
var args = arguments[0] || {};
const html="&lt;html&gt;&lt;body&gt;&lt;iframe src='{1}' width='320' height='240' frameborder='0' webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;";

if(args.title && args.url){
	$.title.text = args.title;
	// APP.log.trace("Adding video: " + args.title);
	if(OS_ANDROID){
		var webView = Ti.UI.createWebView({
		    html: require('utils/util').format(html,args.url),
		    height:Ti.UI.SIZE,
		    backgroundColor:'transparent'
		});
		$.row.add(webView);
	}else{
		$.player.html = require('utils/util').format(html, args.url);
	}
}
</pre></code>

*video.xml*

<code><pre>
&lt;Alloy&gt;
    &lt;View class="formRow" id="row"&gt;
    	&lt;Label id="title"&gt;&lt;/Label&gt;
        &lt;WebView id="player" platform="ios"&gt;&lt;/WebView&gt;
    &lt;/View&gt;
&lt;/Alloy&gt;
</pre></code>

And that seems to work as expected :-)

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-12-11

   As a side-note, I feel like this could be related to TIMOB-24208 (Android / WebView / Alloy / 6.0.0 regression).</li>
<li>John Dalsgaard 2016-12-12

   Another observation: On Android 4.4.2 (device - a Samsung Galaxy S3 Neo) the video does not start on first press on the play button. I need to pause it and then press the start button again - and then it plays....
   
   This is also new behaviour.</li>
<li>Gary Mathews 2016-12-13

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/8681" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8681</a>
   6_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/8682" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8682</a></li>
<li>Josh Longton 2016-12-15

   Verified as fixed, A webview with a video link now plays correctly.
   Tested on:
   
   {noformat}
   macOS Sierra 10.12.1
   Nexus 5X (6.0.1)
   Nexus 6p (7.0)
   android emulator (4.4.2, 6.0)
   Ti SDK: 6.0.1.v20161214184817
   Appc NPM: 4.2.8
   App CLI: 6.0.0
   Node v4.6.0
   {noformat}
   
   *Closing Ticket.*</li>
<li>Eric Merriman  2017-01-20

   Reopening to add version and to allow back port.</li>
<li>Eric Merriman  2017-01-20

   Reopened in error, closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24209.json">JSON Source</a></p>