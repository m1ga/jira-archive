---
title: "[TIMOB-24259] iOS: Multiple Webviews with same local URL does not inject Titanium XHR bridge properly"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-12-28T19:57:26.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>community, ios, local, notable, webview</td></tr>
<tr><th>Reporter</th><td>Flavio De Stefano</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2016-12-24T11:46:26.000+0000</td></tr>
<tr><th>Updated</th><td>2017-01-20T22:32:56.000+0000</td></tr>
</table>

<h3>Description</h3>

Yes, I know that this is an extreme case, but it happened to us (me and @Jei).

When you try to load multiple (1+) webviews at the same time with *same local URL*, the listeners provided by the XHR bridge (ti-injection) works *only for the first one instantiated*.

I debugged for hours, and finally realized why this happens.

The _LocalProtocolHandler_ class implemented in the Webview communication receives only the first URL to load; and this causes only one injection *with the same Ti.pageToken*.

In this screenshot you can see that the generated pageToken is the same:

!<a href="https://cl.ly/3H393n3C2a2D/Screen%20Shot%202016-12-24%20at%2012.29.07.png" rel="nofollow" target="_blank">https://cl.ly/3H393n3C2a2D/Screen%20Shot%202016-12-24%20at%2012.29.07.png</a>!

The solution would be to inject a new header that has a unique counter thats incremented every time a new local URL is set.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-24259_61301/file.html">file.html</td></td><td>2017-01-20T19:47:11.000+0000</td><td>369</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2016-12-28

   Community PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8712" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8712</a>
   
   Test-Case:
   <code><pre>
   var w = Ti.UI.createWindow();
   var i = 0;
    
   var a1 = Ti.UI.createWebView({ url: "file.html", borderColor: "#000", borderWidth: 1, left: 0, top: 0, width: "50%", height: "50%" });
   var a2 = Ti.UI.createWebView({ url: "file.html", borderColor: "#000", borderWidth: 1, right: 0, top: 0, width: "50%", height: "50%" });
   var a3 = Ti.UI.createWebView({ url: "file.html", borderColor: "#000", borderWidth: 1, left: 0, bottom: 0, width: "50%", height: "50%" });
   var a4 = Ti.UI.createWebView({ url: "file.html", borderColor: "#000", borderWidth: 1, right: 0, bottom: 0, width: "50%", height: "50%" });
    
   w.add(a1);
   w.add(a2);
   w.add(a3);
   w.add(a4);
    
   function onLoad() {
       // should be "FEFIFO-4" after the first load and "FEFIFO-5" after clicking the first web view
       Ti.App.fireEvent('test', { text: 'FEFIFO-' + (++i) }); 
   }
   
   function reload(e) {
       e.source.reload();
   } 
    
   a1.addEventListener('load', onLoad);
   a2.addEventListener('load', onLoad);
   a3.addEventListener('load', onLoad);
   a4.addEventListener('load', onLoad);
   
   a1.addEventListener('click', reload);
   a2.addEventListener('click', reload);
   a3.addEventListener('click', reload);
   a4.addEventListener('click', reload);
    
   w.open();
   </pre></code></li>
<li>Lee Morris 2017-01-20

   Using the sample code above with the attached HTML file I verified that the page token was unique for each instance of the web view and that all event listeners fired on all web views. 
   Tested on;
   iPhone 7 (10.2) and Simulator (10.2)
   MacOS 10.11.6 (15G31)
   Studio 4.8.1.201612050850
   Ti SDK 6.1.0.v20170118152304
   Appc NPM 4.2.8
   Appc CLI 6.1.0
   Ti CLI 5.0.11
   Alloy 1.9.5
   Arrow 1.10.1
   Xcode 8.2 (8C38)
   Node v4.6.0
   Java 1.7.0_80</li>
</ol>


<p><a href="/TIMOB/TIMOB-24259.json">JSON Source</a></p>