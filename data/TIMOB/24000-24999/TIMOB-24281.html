---
title: "[TIMOB-24281] iOS: Titanium.Media.openMusicLibrary returns empty items on iOS 10 and 9"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2017-01-20T22:40:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.0, Release 6.0.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shuo Liang</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2017-01-06T00:52:25.000+0000</td></tr>
<tr><th>Updated</th><td>2017-01-20T22:40:17.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Reproduce</h4>
1. Create a new projects
2. Add iOS 10 permissions onto your plist on tiapp.xml.
3. Execute this function below: 
<code><pre>
		Titanium.Media.openMusicLibrary({
			allowMultipleSelections : false,
			mediaTypes : Titanium.Media.MUSIC_MEDIA_TYPE_MUSIC|Titanium.Media.MUSIC_MEDIA_TYPE_ANY_AUDIO,
			success : function(event) {
				// called when media returned from the MusicLibrary
				console.log("Results: " + JSON.stringify(event));
			},
			cancel : function() {
				alert("Aborting ");
			},
			error : function(error) {
				// called when there's an error
				var a = Titanium.UI.createAlertDialog({
					title : 'Music Library'
				});
				if (error.code == Titanium.Media.NO_MUSIC_PLAYER) {
					a.setMessage('Please run this test on device.');
				} else {
					a.setMessage('Unexpected error: ' + error.code);
				}
				a.show();
			}
		});
</pre></code>
4. Log the MusicLibraryResponseType on success
5. Launch the app on device only!

<h4>Expected Result</h4>
The 'items' attribute will be populated with data. 

<h4>Actual Result</h4>
The 'items' attribute will be an empty dictionary.
Like: 
<code><pre>
{"items":[{}],"source":{},"types":1,"code":0,"success":true,"type":"success","representative":{}}
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-24281_61184/tiapp (1).xml">tiapp (1).xml</td></td><td>2017-01-06T00:52:24.000+0000</td><td>8288</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2017-01-06

   So it works on master (6.1.0) for me, need to perform 6.0.1.GA device tests. But <code>event.items.length</code> returns 1 for me, the items are just not stringified in the console. I'll get back soon. 
   
   *EDIT*: Tested with 6.0.1.GA as well, using all kind of configurations (including the one linked here in the tiapp.xml). The items are returned, you can check it by grabbing the title:
   <code><pre>
   
   var win = Ti.UI.createWindow({
       backgroundColor: '#fff'
   });
   
   var btn = Ti.UI.createButton({
       title: 'Trigger'
   });
   
   btn.addEventListener('click', function() {
       if (Ti.Media.hasMusicLibraryPermissions()) {
           openMusicLibrary();
       } else {
           Ti.Media.requestMusicLibraryPermissions(function(e) {
               if (!e.success) {
                   alert("No permissions!");
                   return;
               }
               openMusicLibrary();
           })
       }
   });
   
   win.add(btn);
   win.open();
   
   function openMusicLibrary() {
       Ti.Media.openMusicLibrary({
   		allowMultipleSelections : true,
   		mediaTypes : Titanium.Media.MUSIC_MEDIA_TYPE_MUSIC | Titanium.Media.MUSIC_MEDIA_TYPE_ANY_AUDIO,
   		success : function(event) {
   			// called when media returned from the MusicLibrary
                           console.log(event.items[0]);
                           console.log(event.items[0].title);
   		},
   		cancel : function() {
   			alert("Aborting ");
   		},
   		error : function(error) {
   			// called when there's an error
   			var a = Titanium.UI.createAlertDialog({
   				title : 'Music Library'
   			});
   			if (error.code == Titanium.Media.NO_MUSIC_PLAYER) {
   				a.setMessage('Please run this test on device.');
   			} else {
   				a.setMessage('Unexpected error: ' + error.code);
   			}
   			a.show();
   		}
   	});
   }
   </pre></code>
   It was just the log that didn't log all the properties of the media item, which is expected because it is an array of objects. So either iterate over the object keys or just check the [Ti.Media.openMusicLibrary|docs.appcelerator.com/platform/latest/#!/api/Titanium.Media-method-openMusicLibrary] docs. </li>
<li>Abir Mukherjee 2017-01-20

   Tested with:
   NPM Version: 2.15.9
   Node Version: 4.5.0
   Mac OS: 10.12.1
   Appc CLI: 6.1.0
   Appc CLI NPM: 4.2.8
   Titanium SDK version: 6.1.0.v20170120115404
   Appcelerator Studio, build: 4.8.1.201612050850
   Xcode 8.2
   iOS Device: 10
   
   I tested this on an iOS 10 Device, and found that when I selected a song, the object type and the title are printed in the console. I tried this on 2 different songs and saw this in the console:
   <code><pre>
   [INFO] :   [object TiMediaItem]
   [INFO] :   Holocene
   [INFO] :   [object TiMediaItem]
   [INFO] :   The Miracle (Of Joey Ramone)
   </pre></code>
   
   The output shows that demo code works as expected.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24281.json">JSON Source</a></p>