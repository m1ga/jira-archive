---
title: "[TIMOB-24345] iOS: Today Extensions cannot access App Group UserDefaults or DirectoryForSuite"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2017-01-26T22:59:03.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Lawrence Wilson</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2017-01-25T14:08:38.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-24T17:44:09.000+0000</td></tr>
</table>

<h3>Description</h3>

On trying to implement a Today Extension and share data, i have set up an App Group and tried using Ti.App.iOS.UserDefaults, Ti.Filesystem.directoryForSuite & Ti.Wormhole all of which failed.

I setup an empty XCode project called <code>Amy Today</code> with a Today Extension target called <code>Amy Reminders</code>. Having changed the target capabilities for the App Group accordingly, a <code>Amy Today.entitlements</code> file was created.

I included the extensions using the following in the <code>TiApp.xml</code>:


<code><pre>
&lt;extensions&gt;
    &lt;extension projectPath="extensions/Amy Today/Amy Today.xcodeproj"&gt;
        &lt;target name="Amy Reminders"&gt;
            &lt;provisioning-profiles&gt;
                &lt;device/&gt;
                &lt;dist-appstore/&gt;
                &lt;dist-adhoc/&gt;
            &lt;/provisioning-profiles&gt;
        &lt;/target&gt;
    &lt;/extension&gt;
&lt;/extensions&gt;
</pre></code>

I ran the project and tested and discovered the data was being written to the appropriate App Group folder/plist correctly from the app but could not be read by the Today Extension.

On further investigation I realised that a new <code>Amy Reminders.entitlements</code> file was being created in a new folder within the build folder and this was being included in the built project not the actual entitlements file (see attached picture - red was the one included in the project, green is the one that should have been included.)

I delved into the <code>6.0.1.GA/iphone/cli/commands/_build.js</code> file and discovered on line <code>3434</code> the variable <code>entFile</code> contained <code>Amy Reminders/Amy Reminders.entitlement</code> which meant the following lines that join <code>entFile</code> with <code>targetName</code> was creating this new file.

This new file did not contain the key <code>com.apple.security.application-groups</code> which meant the Today Extension did not have the appropriate security entitlements to read the shared data.

I removed the targetName from the <code>path.join</code> as follows:
<code><pre>
extBuildSettings.CODE_SIGN_ENTITLEMENTS = '"' + path.join(ext.relPath, entFile) + '"';
targetInfo.entitlementsFile = path.join(this.buildDir, ext.relPath, entFile);
</pre></code>

and the Today Extension had the correct entitlements and could read the shared data. I'm not sure if the above fix is correct as I have not tested it with Watch Extensions.

Hope the above helps in the investigation on fixing this problem.



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-24345_61320/Amy entitlements.png">Amy entitlements.png</td></td><td>2017-01-25T14:00:04.000+0000</td><td>147370</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Chris Barber 2017-01-26

   Titanium supports defining App Groups in the <code>tiapp.xml</code>. You set them by adding them to the <code>&lt;ios&gt;</code> section of the tiapp.xml like the following.
   
   <code><pre>
   &lt;ios&gt;
       &lt;capabilities&gt;
           &lt;app-groups&gt;
               &lt;group&gt;group.com.appc.foo&lt;/group&gt;
               &lt;group&gt;group.com.appc.bar&lt;/group&gt;
           &lt;/app-groups&gt;
       &lt;/capabilities&gt;
   &lt;/ios&gt;
   </pre></code>
   
   These groups are baked into the <code>Entitlements.plist</code> files.
   
   It's worth noting that App Groups are the only capability that is currently supported.</li>
<li>Lawrence Wilson 2017-01-26

   So that can be used instead of creating an Entitlements.plist file in the project?
   
   Might be an idea to update the documentation then as its not stated - <a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/guide/tiapp.xml_and_timodule.xml_Reference
   
   Would these entitlements be included in Today Extension projects?</li>
<li>Chris Barber 2017-01-26

   [~lawrence.wilson@abannan.com] Correct, you don't need to muck with <code>Entitlements.plist</code> files, at least for app groups. Yes, the docs should be updated to include the <code>&lt;capabilities&gt;</code> section. Honestly, I thought it was.
   
   I'm not familiar with "today extensions", so I'm going to guess sure.</li>
<li>Chris Barber 2017-01-26

   I created TIDOC-2732 to document the use of the <code>&lt;capabilities&gt;</code> section in the tiapp.xml.
   
   As for this ticket, I'm going to resolve this ticket as invalid. If the <code>&lt;capabilities&gt;</code> doesn't solve the problem, then reopen this ticket with some details and I'd be happy to investigate.</li>
<li>Lee Morris 2017-03-24

   Closing ticket as invalid with reference to the above comments.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24345.json">JSON Source</a></p>