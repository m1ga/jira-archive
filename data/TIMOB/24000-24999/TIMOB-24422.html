---
title: "[TIMOB-24422] Windows: Deployment fails with "violates pattern constraint of bms-resource""
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-01-30T12:05:00.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.1, Release 8.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2017-02-22T16:25:42.000+0000</td></tr>
<tr><th>Updated</th><td>2019-01-30T17:24:53.000+0000</td></tr>
</table>

<h3>Description</h3>

When attempting to install a Titanium app onto a Windows Phone 10 emulator (specifically Mobile Emulator 10.0.14393.0 WVGA 4 inch 512MB), the process fails when trying to install the library dependency:

<code><pre>
[INFO]  Installing dependency: Microsoft.VCLibs.x86.14.00.appx
[INFO]  Project built successfully in 1m 15s 438ms

[ERROR] Failed to install app (code 2147943860): Windows App Deployment Tool
Version 10.0.0.0
Copyright (c) Microsoft Corporation. All rights reserved.

Opening connection to device at '169.254.199.16'.

Installing app...
Disconnecting.

0x80131500 - Failed to install or update package: Unspecified error

'Microsoft Platform Extensions' violates pattern constraint of '\bms-resource:.{1,256}'.

0x80131505 - Unspecified error

'Microsoft Platform Extensions' violates pattern constraint of '\bms-resource:.{1,256}'.

0x800705B4 - Unspecified error

'Microsoft Platform Extensions' violates pattern constraint of '\bms-resource:.{1,256}'.
</pre></code>

*Steps to reproduce;*
<h4>Create a new alloy application <code>appc new</code></h4>
<h4>Build to device <code>appc run -p windows -T wp-device</code></h4>

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2017-02-22

   Note the version number of the Windows SDK/Phone: 10.0.14393.0
   
   I think this may be a new issue specifically for this version of the SDK. If I install he app manually with winappdeploycmd.exe that works fine. I think we typically attempt to install the dependency manually ourselves before the app, and the new tooling lets you specify the dependency to install or automagically picks it up. We may just need to roll back to letting the winappdeploycmd do that?</li>
<li>Kota Iguchi 2017-02-23

   <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/958" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/958</a></li>
<li>Kota Iguchi 2017-02-23

   Even after we skip installing dependencies, Jenkins still has errors with this: [PR-958/1/pipeline/42](<a href="https://jenkins.appcelerator.org/blue/organizations/jenkins/appcelerator%2Ftitanium_mobile_windows/detail/PR-958/1/pipeline/42)" rel="nofollow" target="_blank">https://jenkins.appcelerator.org/blue/organizations/jenkins/appcelerator%2Ftitanium_mobile_windows/detail/PR-958/1/pipeline/42)</a>
   
   <code><pre>
   [ERROR] :  Failed to install app (code 2147943860): Windows App Deployment Tool
   Version 10.0.0.0
   Copyright (c) Microsoft Corporation. All rights reserved.
   Opening connection to device at '169.254.227.193'.
   Installing app...
   Disconnecting.
   0x80131500 - Failed to install or update package: Unspecified error
   'Microsoft Platform Extensions' violates pattern constraint of '\bms-resource:.{1,256}'.
   0x80131505 - Unspecified error
   'Microsoft Platform Extensions' violates pattern constraint of '\bms-resource:.{1,256}'.
   0x800705B4 - Unspecified error
   'Microsoft Platform Extensions' violates pattern constraint of '\bms-resource:.{1,256}'.
   </pre></code>
   
   [~cwilliams] I find [this thread](<a href="https://social.msdn.microsoft.com/Forums/en-US/afb81643-e84e-4df9-9533-b68d2d603cfe/uwpunable-to-deploy-uwp-app-with-winappdeploycmd-getting-error-microsoft-platform-extensions?forum=wpdevelop)" rel="nofollow" target="_blank">https://social.msdn.microsoft.com/Forums/en-US/afb81643-e84e-4df9-9533-b68d2d603cfe/uwpunable-to-deploy-uwp-app-with-winappdeploycmd-getting-error-microsoft-platform-extensions?forum=wpdevelop)</a>, maybe we could try this?
   
   {quote}
   I faced that problem when deploying by real IP address.
   After I checked the device IP by "winappdeploycmd devices" it shows 127.0.0.1 as a IP address of your phone. Then used winappdeploycmd -ip 127.0.0.1 .... and it installed without that error. 
   {quote}
   
   <code><pre>
   winappdeploycmd -ip 127.0.0.1
   </pre></code>
   </li>
<li>Kota Iguchi 2017-03-21

   I believe [~cwilliams] already resolved this, original issue was emulator didn't properly pair the device and now it's working. Resolving this as "Won't Do". </li>
<li>Christopher Williams 2017-04-26

   [~kota] So I am *still* seeing this on our build machine, specifically on trying to get our windowslib library built and tested. The "TestApp10.0" we use in the unit tests there is failing to install the app intermittently on the Windows 10 emulator. I'm going off of hints like this <a href="http://stackoverflow.com/questions/29991693/cant-deploy-universal-app-to-phone-with-windows-10-mobile-tech-preview" rel="nofollow" target="_blank">http://stackoverflow.com/questions/29991693/cant-deploy-universal-app-to-phone-with-windows-10-mobile-tech-preview</a> where I think we need to update the appxmanifest to specify different dependencies. I think we may need to add the .NET.CoreRuntime dependency ourselves? Still working on it here: <a href="https://jenkins.appcelerator.org/job/cli/job/windowslib/job/PR-67/" rel="nofollow" target="_blank">https://jenkins.appcelerator.org/job/cli/job/windowslib/job/PR-67/</a></li>
<li>Christopher Williams 2017-04-28

   Finally found the source of the issue. The windowslib emulator.stop method works fine for Windows 8.1 emulators, but was not really stopping Windows 10 emulators (as verified in the Hyper-V manager). I have hacked it to use Stop-VM with the -TurnOff flag for now, but I need to do some more work to sniff OS version to determine if the Stop-VM powershell cmd is available (it is on Windows 10, but not stock Windows 8.1).</li>
<li>Christopher Williams 2017-05-02

   And, tracking down another issue that can contribute. I believe not only were we not properly shutting down emulators for Windows 10, but we're experiencing a timing issue on Windows 10 emulators using windowslib.emulator.install. I *think* that the unit test we have exposes that if you try to install an app to a Windows 10 emulator that isn't running, the windowslib code will "connect" to launch the emulator and then try to install the app, and I don't think it's waiting long enough for the install portion. We likely need to add some code to wait for the emulator to transition state after the connect call and before the install (but only for emulators!)</li>
<li>Kota Iguchi 2017-05-04

   I have faced similar issue on Windows 10 Mobile device on the latest 6.1.x build (6.1.0.v20170502132103).
   
   For me, skipping installing dependencies solves this issue on my device. (Added <code>--installDependencies</code> flag)
   Would you try this [~cwilliams]?
   <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/958" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/958</a>
   </li>
<li>Kota Iguchi 2017-05-04

   TIMOB-24656 (<code>--skipInstallDependencies</code>)
   
   This only intends to fix for the deployment issue described in the ticket.</li>
<li>Kota Iguchi 2017-05-05

    [~cwilliams] Regarding the timeout issue, do you mean [this config](<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/master/cli/hooks/wp-run.js#L205)?" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/master/cli/hooks/wp-run.js#L205)?</a> It's set to 60 sec, but I guess it's too short because it usually takes 100 sec on my laptop (Surface Pro 3) to launch/install app on the emulator. (BTW I don't know why are we using the "windows.log.timeout" for the configuration key...(?)(?))</li>
<li>Christopher Williams 2017-05-09

    [~kota] I'm specifically running into this issue when running windowsill's unit tests on a Windows 10 build box in our CI build. It seems that the unit test that calls windowslib.emulator.install to both start the emulator and install the test app is seeing this specific error pretty much 100% of the time.
    
    I attempted to add some code between the wptool.connect call that launches the emulator and the app install that polled the emulator status to verify it is "Running", but that seems to state it's running immediately and doesn't avoid the issue. I'm wondering if this is simply because the default checkpoint already has a debug app installed in it? (But then why do the other tests that call launch and then install the app after work nearly 100% of the time without this issue?).
    </li>
<li>Gary Mathews 2017-07-27

    I'm also seeing this issue consistently when deploying to my Windows 10 device. I haven't found a workaround yet.</li>
<li>Ewan Harris 2017-07-27

    [~gmathews] You've been using VS2017 right? It has a newer VCLibs dep see TIMOB-24934
    </li>
<li>Gary Mathews 2017-07-27

    [~eharris] Using <code>--skipInstallDependencies</code> didn't resolve the issue</li>
<li>Kota Iguchi 2018-07-26

    [~gmathews] Is this still the issue for you? Could you try latest release (such as 7.2.0.GA)?</li>
<li>Kota Iguchi 2019-01-29

    I am able to reproduce this on 8.0.0 especially for an alloy app with hyperloop enabled. Interestingly I saw sometimes app is actually installed to the device even when Windows Deployment Tools errors out with this "unspecified error"...Increasing timeout & specifying <code>--skipInstallDependencies</code> didn't help.</li>
<li>Kota Iguchi 2019-01-29

    Merged to titanium_mobile master & 8_0_X
    
    Should be available in [nightly build](<a href="https://builds.appcelerator.com/#8_0_X)" rel="nofollow" target="_blank">https://builds.appcelerator.com/#8_0_X)</a>
    
    <code>appc ti sdk install --branch 8_0_X 8.0.0.v20190129074948</code></li>
<li>Kota Iguchi 2019-01-29

    Related PR: <a href="https://github.com/appcelerator/windowslib/pull/87" rel="nofollow" target="_blank">https://github.com/appcelerator/windowslib/pull/87</a></li>
<li>Josh Longton 2019-01-30

    *Closing Ticket*
    
    The fix can be found it SDK;
    
    {noformat}
    8.0.0.v20190129200738
    {noformat}
    </li>
<li>Christopher Williams 2019-01-30

    So my best guess here is that the VCLibs dependency is the one getting flagged as an issue here, since that app manifest contains a publisher name of "Microsoft Platform Extensions".
    
    I can't see anything wrong with that package itself personally, and I doubt MS would ship a busted app for VCLibs.
    
    So my best stab in the dark at solving this is that we're not properly setting up the dependencies. In fact, I see we do not add VCLibs to the appxmanifest of the user app as a PackageDependency(<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/master/templates/build/Package.win10.appxmanifest.in.ejs#L27)." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/master/templates/build/Package.win10.appxmanifest.in.ejs#L27).</a> This link seems most relevant: <a href="https://developercommunity.visualstudio.com/content/problem/233202/microsoftnetnativeframework20-0x80073cf3.html" rel="nofollow" target="_blank">https://developercommunity.visualstudio.com/content/problem/233202/microsoftnetnativeframework20-0x80073cf3.html</a>
    
    So a first attempt to fix this would likely be to add to the template the dependency:
    <code><pre>
    &lt;PackageDependency Name="Microsoft.VCLibs.140.00" MinVersion="10.0.10042.0" Publisher="CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US" /&gt;
    </pre></code>
    
    The second guess is that we should not try and install the dependencies manually ourselves in the build, but just install our apps and I assume it'll pick up the dependencies properly on it's own. (<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/master/cli/hooks/wp-run.js#L194-L333)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/master/cli/hooks/wp-run.js#L194-L333)</a> I guess the quick way to test that theory is to add the dependency in the template above and then build with the <code>--skipInstallDependencies</code> flag</li>
</ol>


<p><a href="/TIMOB/TIMOB-24422.json">JSON Source</a></p>