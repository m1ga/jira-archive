---
title: "[TIMOB-24424] Calculating of height of label without adding to parent view"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Rainer Schleevoigt</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2017-02-21T15:49:45.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T19:55:15.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi,

Task: module for measurement (getHeight) of TiUILabel without adding to a parent.

I found <code>TiUIView createView(Activity activity)</code> will called after adding to parent view. 

In a Kroll.method of proxy I call:
<code><pre>
private float handleCalculateHeight() {
	TiUILabel textView = new TiUILabel(this);
	int widthMeasureSpec = View.MeasureSpec.makeMeasureSpec(300,View.MeasureSpec.AT_MOST);
	int heightMeasureSpec = View.MeasureSpec.makeMeasureSpec(0,View.MeasureSpec.UNSPECIFIED);
	textView.getNativeView().measure(widthMeasureSpec, heightMeasureSpec);
	float h = textView.getNativeView().getMeasuredHeight();
	Log.d(LCAT, "HEIGHT=" + h);
	return h;
}
</pre></code>

The result is always 81.0. I think the (JS) options will not proceeded. Any ideas?


<h3>Comments</h3>

<ol>
<li>Rainer Schleevoigt 2017-02-22

   I figured the secret i the first paramter of this line:
   <code><pre>
   tv.measure(View.MeasureSpec.makeMeasureSpec(???,MeasureSpec.EXACTLY),View.MeasureSpec.makeMeasureSpec(0,View.MeasureSpec.UNSPECIFIED));
   </pre></code>
   Any hints?</li>
<li>Rainer Schleevoigt 2017-02-22

   Solved:
   ==========
   @Kroll.method
   	public final float calculateHeight() {
   		float height = 0f;
   		if (TiApplication.isUIThread()) {
   			Log.d(LCAT, "calculateHeight in UIthread");
   			height = handleCalculateHeight();
   		} else {
   			TiMessenger.sendBlockingMainMessage(new Handler(TiMessenger
   					.getMainMessenger().getLooper(), new Handler.Callback() {
   				public boolean handleMessage(Message msg) {
   					AsyncResult result = (AsyncResult) msg.obj;
   					result.setResult(handleCalculateHeight());
   					return true;
   				}
   			}).obtainMessage(0), null);
   		}
   		return height;
   	}
   
   	private float handleCalculateHeight() {
   		TiUILabel textView = new TiUILabel(this);
   		textView.processProperties(opts); // don't forget ;-)
   		TextView tv = (TextView) textView.getNativeView();
   		int specWidth = View.MeasureSpec.makeMeasureSpec(0,
   				View.MeasureSpec.UNSPECIFIED);
   		int specHeight = View.MeasureSpec.makeMeasureSpec(0,
   				View.MeasureSpec.UNSPECIFIED);
   		tv.setVisibility(View.VISIBLE);
   		tv.measure(specWidth, specHeight);
   		return tv.getMeasuredHeight();
   	}
   ====
   Simple add this snippet in the end of LabelProxy.java and with the new method the user can get the calculated height of label.</li>
<li>Sharif AbuDarda 2017-02-22

   Please create a PR of your request. </li>
<li>Rainer Schleevoigt 2017-02-22

   Is there a receipt/howto? A clone is on my machine â€¦</li>
</ol>


<p><a href="/TIMOB/TIMOB-24424.json">JSON Source</a></p>