---
title: "[TIMOB-24435] Windows Module: Receive C++ callback from JS "
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2017-03-22T01:18:11.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td> Ricardo Ramirez</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2017-02-27T22:55:22.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-22T01:18:11.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Issue Description</h4>

Customer need a way to receive a function (callback) from Javascript in the C++ code by looking at the code in TitaniumKit.

Formerly, in Kroll, this would be done by doing something like:

(Assuming this is an android module)
HashMap args = args;
KrollFunction someFunction = (KrollFunction) args.get("someFunction");
[...]
someFunction.call(KrollObject, KrollDict);

So Would it be possible you provide an example on this if is possible? 



<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2017-02-28

   Yes it's possible, you can find examples in TitaniumKit because callback pattern has been used a lot in Titanium API.
   
   I think easiest way to fire callback is leveraging <code>addEventListener</code>. For instance [Ti.Gesture](<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/master/Source/Sensors/src/Gesture.cpp#L28)." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/master/Source/Sensors/src/Gesture.cpp#L28).</a>
   
   So let say you are listening <code>somethingfired</code> event. In this case you can add listener in JavaScript
   
   <code><pre>
   var YOUR_MODULE = require('YOUR_MODULE'), 
         your_module = new YOUR_MODULE();
   your_module.addEventListener('somethingfired', function(e) {
      Ti.API.info(e.type + ' my_number:' + e.my_number);
   });
   </pre></code>
   
   You can fire this callback from the module by executing <code>fireEvent</code> like below.
   
   <code><pre>
   TITANIUM_FUNCTION(YourModule, doTheMyNumberEvent)
   {
       const auto ctx = get_context();
       auto e = ctx.CreateObject();
       e.SetProperty("my_number", ctx.CreateNumber(12345));
       fireEvent("somethingfired", e);
   }
   </pre></code>
   
   There is another way to do the callback, by calling <code>JSObject</code> as a function directly. This is basic functionality within [HAL](<a href="https://github.com/appcelerator/HAL)" rel="nofollow" target="_blank">https://github.com/appcelerator/HAL)</a> framework.
   
   <code><pre>
   var YOUR_MODULE = require('YOUR_MODULE'), 
         your_module = new YOUR_MODULE();
   your_module.doTheCallbackImmediately(function(str) {
      Ti.API.info(str);
   });
   </pre></code>
   
   <code><pre>
   TITANIUM_FUNCTION(YourModule, doTheCallbackImmediately)
   {
   	ENSURE_OBJECT_AT_INDEX(my_callback, 0);
   
          const std::vector&lt;JSValue&gt; args { get_context().CreateString("TEST") };
   	my_callback(args, get_object());
   	return get_context().CreateUndefined();
   }
   </pre></code>
   
   Example: <a href="https://github.com/appcelerator/HAL/blob/master/examples/Widget.cpp#L277" rel="nofollow" target="_blank">https://github.com/appcelerator/HAL/blob/master/examples/Widget.cpp#L277</a></li>
<li> Ricardo Ramirez 2017-02-28

   Thank you Kota ! </li>
<li>Kota Iguchi 2017-03-22

   Closing this for now, this is implemented by HAL framework.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24435.json">JSON Source</a></p>