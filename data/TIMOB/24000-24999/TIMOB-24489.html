---
title: "[TIMOB-24489] iOS: Ti.TouchID - Callback error with Ti.Network.createHTTPClient"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-04-12T09:44:53.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>6.0.1, httpclient, sdk, touchid</td></tr>
<tr><th>Reporter</th><td>Clément Blanco</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2017-03-16T13:50:48.000+0000</td></tr>
<tr><th>Updated</th><td>2017-05-16T16:40:20.000+0000</td></tr>
</table>

<h3>Description</h3>

This doesn't seem to work:
<code><pre>
var touchId = require("ti.touchid");
touchId.authenticate({
    reason: "Place your finger on the home button to login",
    callback: function(e) {
        if (e.success === true) {
            // Success
        } else {
            // Cancel
        }
    }
});
</pre></code>


But this works:
<code><pre>
var touchId = require("ti.touchid");
touchId.authenticate({
    reason: "Place your finger on the home button to login",
    callback: function(e) {
        if (e.success === true) {
            // if you don't do this, Ti.Network fails later if it's
            // called from an event running in this callback
            setTimeout(function() {
                    // Success
            },0);
        } else {
            // Cancel
        }
    }
});
</pre></code>

If you don’t use the timeout 0:

- on simulator *it’s fine* (with our without liveview)
- on device with liveview *it’s fine*
- on device without liveview *it fails*

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2017-03-16

   Please attach a full use-case that also includes the failing HTTPClient call. Use [httpbin](<a href="https://httpbin.org/)" rel="nofollow" target="_blank">https://httpbin.org/)</a> to call a demo-API.</li>
<li>Clément Blanco 2017-03-16

   <code><pre>
   var touchId = Ti.require("ti.touchid");
   touchId.authenticate({
       reason: "Place your finger on the home button to login",
       callback: function(e) {
           if (e.success === true) {
               var http = Ti.Network.createHTTPClient({
                   onload : function(e) {
                       Ti.API.info("Received text: " + this.responseText);
                       alert('success');
                   },
                   onerror : function(e) {
                       Ti.API.debug(e.error);
                       alert('error');
                   },
                   timeout : 5000
               });
               client.setRequestHeader("Accept", "application/json");
               client.open("GET", "<a href="http://httpbin.org/get" rel="nofollow" target="_blank">http://httpbin.org/get</a>");
               client.send();
           } else {
               // Cancel
           }
       }
   });
   </pre></code>
   </li>
<li>Hans Knöchel 2017-03-18

   Thanks! What's interesting is that if you use the main-thread instead of the kroll-thread, it works just fine. I'm also wondering if this used to work before and if other Ti-namespaces API's like Ti.Media or Ti.Geolocation have the same behavior. </li>
<li>Hans Knöchel 2017-03-26

   PR: <a href="https://github.com/appcelerator-modules/ti.touchid/pull/30" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.touchid/pull/30</a>
   
   Packaged module: <a href="https://github.com/appcelerator-modules/ti.touchid/releases/tag/ios-2.1.2" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.touchid/releases/tag/ios-2.1.2</a>
   
   Test-case (test with both kroll- and main-thread):
   <code><pre>
   var touchId = require("ti.touchid");
   
   var win = Ti.UI.createWindow({
       backgroundColor: '#fff'
   });
   
   var btn = Ti.UI.createButton({
       title: 'Trigger'
   });
   
   btn.addEventListener('click', function() {
       touchId.authenticate({
           reason: "Place your finger on the home button to login",
           callback: function(e) {
               if (e.success === true) {
                   var http = Ti.Network.createHTTPClient({
                       onload: function(e) {
                           Ti.API.info("Received text: " + this.responseText);
                           alert('success');
                       },
                       onerror: function(e) {
                           Ti.API.debug(e.error);
                           alert('error');
                       },
                       timeout: 5000
                   });
                   http.setRequestHeader("Accept", "application/json");
                   http.open("GET", "<a href="http://httpbin.org/get" rel="nofollow" target="_blank">http://httpbin.org/get</a>");
                   http.send();
               } else {
                   // Ignore case
               }
           }
       });
   });
   
   win.add(btn);
   win.open();
   </pre></code></li>
<li>Clément Blanco 2017-04-03

   I've tried 2.1.2, this problem seems to have been solved but <code>touchId.authenticate()</code> seems to always return the following, no matter what:
   
   <code><pre>
   {
       "type": "callback",
       "success": true,
       "source": {}
   }
   </pre></code>
   
   Should I raise a different ticket?</li>
<li>Hans Knöchel 2017-04-06

   Please note that iOS 10.2 (\?), the user response is cached after a few recurring authorizations. You can force to show the dialog again by calling <code>invalidate()</code> in the success handling. But this behavior was the same before and did not change.</li>
<li>Clément Blanco 2017-04-06

   Ok good to know. I'll try again with 2.1.2.</li>
<li>Hans Knöchel 2017-04-11

   [~clement] Did you test it?</li>
<li>Clément Blanco 2017-04-12

   Seems okay now with <code>invalidate()</code>.
   
   Can this be added to the <code>readme.md</code> on the github repo and/or in the official documentation?</li>
<li>Hans Knöchel 2017-04-12

    Thanks! Done so in [this commit](<a href="https://github.com/appcelerator-modules/ti.touchid/commit/7586d447982426843a1cab0dffcc8bd51791afe5)." rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.touchid/commit/7586d447982426843a1cab0dffcc8bd51791afe5).</a> Also see [this discussion](<a href="http://stackoverflow.com/questions/38379125/touchid-activatetouchwithresponse-returns-success-without-requesting-fingerprint)" rel="nofollow" target="_blank">http://stackoverflow.com/questions/38379125/touchid-activatetouchwithresponse-returns-success-without-requesting-fingerprint)</a> in the native world and this Apple note
    {quote}
    The duration for which Touch ID authentication reuse is allowable. If the device was successfully authenticated using Touch ID within the specified time interval, then authentication for the receiver succeeds automatically, without prompting the user for Touch ID. The default value is 0, meaning that Touch ID authentication cannot be reused. The maximum allowable duration for Touch ID authentication reuse is specified by the LATouchIDAuthenticationMaximumAllowableReuseDuration constant. You cannot specify a longer duration by setting this property to a value greater than this constant.
    {quote}
    To restrict the reuse of an instance to a specific time, specify the <code>allowableReuseDuration</code> property in Titanium.</li>
<li>Eric Wieber 2017-05-16

    Verified fixed, using:
    MacOS 10.12 (16A323)
    Studio 4.8.1.201612050850
    Ti SDK 6.0.4.GA
    Appc NPM 4.2.9
    Appc CLI 6.2.1
    Alloy 1.9.11
    Xcode 8.3.2 (8E2002)
    
    No longer encounter error when using createHTTPClient and authenticate is returning correct values. Tested using provided samples codes and with additional projects from other touchID ticket tests.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24489.json">JSON Source</a></p>