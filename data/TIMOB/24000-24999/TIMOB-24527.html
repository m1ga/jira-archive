---
title: "[TIMOB-24527] Android: Intents using FLAG_ACTIVITY_NEW_DOCUMENT can cause issues with KrollRuntime"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-04-21T22:36:26.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.0.4</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Gary Mathews</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2017-03-23T14:35:48.000+0000</td></tr>
<tr><th>Updated</th><td>2017-04-21T23:46:23.000+0000</td></tr>
</table>

<h3>Description</h3>

Some applications specify the <code>FLAG_ACTIVITY_NEW_DOCUMENT</code> flag when launching applications (Gmail). This can cause event listeners to be overridden and fired in the incorrect activity instance.

*TEST CASE*
*tiapp.xml*
<code><pre>
&lt;android ...&gt;
    ...
   &lt;manifest ...&gt;
       ...
        &lt;intent-filter&gt;
            &lt;action android:name="android.intent.action.VIEW" /&gt;
            &lt;category android:name="android.intent.category.DEFAULT" /&gt;
            &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
            &lt;data android:scheme="http" /&gt;
            &lt;data android:scheme="https" /&gt;
            &lt;data android:host="www.android.com" /&gt;
        &lt;/intent-filter&gt;
        ...
    &lt;/manifest&gt;
&lt;/android&gt;
</pre></code>

*app.js*
<code><pre>
var win = Ti.UI.createWindow({
        layout: 'vertical'
    }),
    bar = Ti.UI.createView({
        layout: 'horizontal',
        width: Ti.UI.FILL,
        height: Ti.UI.SIZE
    })
    currentData = Ti.UI.createButton({
        title: 'CURRENT DATA',
        left: 0
    }),
    clear = Ti.UI.createButton({
        title: 'CLEAR',
        right: 0
    }),
    scrollView = Ti.UI.createScrollView({
        layout: 'vertical',
        height: Ti.UI.FILL,
        backgroundColor: 'white'
    });

// show current data
currentData.addEventListener('click', function (e) {
    alert(Ti.Android.currentActivity.getIntent().data);
});

// clear intent log
clear.addEventListener('click', function (e) {
    scrollView.removeAllChildren();
});

// launch intent
scrollView.add(Ti.UI.createLabel({
    top: 10,
    color: 'black',
    text: 'LAUNCH INTENT ' + JSON.stringify(Ti.Android.currentActivity.getIntent()) + ' WITH DATA: ' + Ti.Android.currentActivity.getIntent().data
}));

bar.add(currentData);
bar.add(clear);
win.add(bar);
win.add(scrollView);
win.open();
</pre></code>

1. Launch app via a link in Gmail: <code>www.android.com/0</code>
2. Press 'CURRENT DATA', should display <code>www.android.com/0</code>
3. Open recent apps menu and resume Gmail
4. Launch app via link in Gmail: <code>www.android.com/1</code>
5. Press 'CURRENT DATA', should display <code>www.android.com/1</code>
6. Open recent apps menu and resume Gmail
7. Launch app via a link in Gmail: <code>www.android.com/0</code>
8. Press 'CURRENT DATA', should display <code>www.android.com/0</code> but does not

<h3>Comments</h3>

<ol>
<li>Gary Mathews 2017-03-24

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/8908" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8908</a></li>
<li>Gary Mathews 2017-03-28

   6_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/8910" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8910</a></li>
<li>Lokesh Choudhary 2017-04-21

   FR Done. 
   Merged 6.0.4 PR waiting for build from CI to close.</li>
<li>Lokesh Choudhary 2017-04-21

   Verified the fix in 6.0.4.v20170421153428.
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24527.json">JSON Source</a></p>