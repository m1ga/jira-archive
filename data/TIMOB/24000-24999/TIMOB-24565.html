---
title: "[TIMOB-24565] iOS CLI: Improve the way dist-appstore build works"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-04-14T21:38:17.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>cli, ios, titanium, xcode8.3</td></tr>
<tr><th>Reporter</th><td>Uriel Lizama</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2017-04-07T14:20:56.000+0000</td></tr>
<tr><th>Updated</th><td>2017-05-09T23:04:31.000+0000</td></tr>
</table>

<h3>Description</h3>

First some background. I created [TiFastlane](<a href="https://github.com/ulizama/TiFastlane)" rel="nofollow" target="_blank">https://github.com/ulizama/TiFastlane)</a> as a way to be able to use [Fastlane](<a href="https://fastlane.tools/)" rel="nofollow" target="_blank">https://fastlane.tools/)</a> with Titanium development. To be able to use Fastlane when archiving a build it needs to be into an .ipa archive, the way I used to do that is by a small hack, using <code>dist-adhoc</code> with an App Store profile. This worked until XCode 8.3 in which the Legacy API was disabled.

This puts me in the current situation to which I need some assistance.

The way I'm looking to solve it is to:
<h4>Create the .archive: <code>appc run -p ios -T dist-appstore</code></h4>
<h4>Use the XCode exporter to export the archive into an ipa <code>xcodebuild -exportArchive -archivePath "~/Library/Developer/Xcode/Archives/2017-04-06/My App 2017-04-06 10-24-57.xcarchive" -exportPath "./dist" -exportOptionsPlist "./build/iphone/Info.plist"</code></h4>

I tested this manually and it works, but there are some issues I'm encountering to be able to have this work as real CLI option.

*Missing method export option in the plist*

The plist generated by the CLI is missing the method, which then has xcodebuild fail when doing the export because it defaults to development so the code signing is wrong. To fix this the correct method needs to be present in the plist:
<code><pre>
&lt;key&gt;method&lt;/key&gt;
&lt;string&gt;app-store&lt;/string&gt;
</pre></code>

This issue doesn't happen on 6.0.1.GA, only in the latest version.

*XCode Archiver Launch*

The other issue is that when the <code>dist-appstore</code> build finishes, it automatically tries to launch the XCode archive manager. This makes it necessary to have an extra human intervention in the step, which breaks the whole automatic process.

It would be great if we could have a way to override that feature, so that when the build finishes it doesn't do anything else.


I'm more than willing to help out in doing changes or tests on the CLI to achieve this, but this is my first time hacking the Ti CLI so I'm a bit lost on what goes where.

Aside from these fixes, it might be worth it to add a <code>--export-ipa</code> option on the build process so that the CLI automatically does the second step of calling the exporter so we end up with an ipa ready to use for the App Store.



<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2017-04-10

   For the missing method, couldn't you just add it in [here](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/cli/commands/_build.js#L3781)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/cli/commands/_build.js#L3781)</a> by checking the deployment-target and do something like <code>plist.method = "app-store"</code> (or what ever target is selected).
   
   For the Archiver launch, does <code>--build-only</code> not work? Thanks!</li>
<li>Uriel Lizama 2017-04-10

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/8954" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8954</a></li>
<li>Chris Barber 2017-04-14

   6_1_X backport: <a href="https://github.com/appcelerator/titanium_mobile/pull/8966" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8966</a></li>
<li>Abir Mukherjee 2017-05-09

   Node Version: 6.10.1
   NPM Version: 3.10.10
   Mac OS: 10.12.4
   Appc CLI: 6.2.0
   Appc CLI NPM: 4.2.9
   Titanium SDK version: 6.1.0.v20170509114242
   Appcelerator Studio, build: 4.8.1.201612050850
   Xcode 8.3.2
   
   Tested with the above environment. I first created an app, and built to the app-store with 
   <code><pre>
   appc run -p ios -T dist-appstore
   </pre></code>
   XCode launched and opened the archive manager. I then tried:
   <code><pre>
   appc run -p ios -T dist-appstore --output-dir ~/Desktop
   </pre></code>
   In this case a .ipa file was created on the Desktop, and XCode did not launch. This is expected behavior.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24565.json">JSON Source</a></p>