---
title: "[TIMOB-24591] Use package-lock.json instead of checking in node_modules"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-07-20T22:56:11.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.2.0</td></tr>
<tr><th>Components</th><td>Android, CLI, iOS, Tooling</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2017-04-18T15:55:45.000+0000</td></tr>
<tr><th>Updated</th><td>2017-08-29T22:54:40.000+0000</td></tr>
</table>

<h3>Description</h3>

We've long checked in our node_modules folder when we update our npm dependencies. I believe we've done so to avoid npm dependency resolution issues?

If so, we could move to using yarn and lock file to ensure the full tree of dependency versions matches on everyone's systems and builds - and avoid bloating the hell out of our repo size and history.

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2017-04-18

   One potential hangup is that we have a special 'titanium-sdk' module which actually only lives in the SDK repo, and has never been moved out to it's own package/repo. I've opened a PR to address that here: <a href="https://github.com/appcelerator/titanium_mobile/pull/8974" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8974</a>
   </li>
<li>Chris Barber 2017-04-18

   I'm fine with using Yarn, but now everybody MUST use Yarn. Just so everybody understands, Yarn should be installed via the recommended methods and NPM isn't one of them.
   
   Every developer will need to routinely run <code>yarn upgrade</code> after pulling the latest from git. We should document this in the readme and an email to all active committers would be appropriate.
   
   Also, I've seen the <code>yarn.lock</code> file be updated after doing <code>yarn upgrade</code>. The updated <code>yarn.lock</code> will be updated with any newly resolved versions, so we should probably instruct to use <code>yarn upgrade \-\-frozen\-lockfile</code>.</li>
<li>Christopher Williams 2017-04-19

   [~cb1kenobi] Is there a particular reason we'd need to regularly run <code>yarn upgrade</code> after checkouts? Doesn't that make yarn attempt to upgrade all packages to the latest version within the semversion specs (and as a result also update <code>yarn.lock</code>)? Wouldn't we instead want devs to run <code>yarn install</code> to grab the matching dependencies from the lock file when it's been updated?
   
   I would assume we'd prefer to run <code>yarn upgrade</code> as a way to update our existing dependencies to the latest as a step near fork/release time just so we're not falling behind (and that we'd have to test/validate the upgrades). In other words, upgrade would be an intentional step in a PR that was tested/reviewed and would be meant to update the lock file.</li>
<li>Chris Barber 2017-04-19

   I've only been running <code>yarn upgrade</code> as habit from running <code>npm upgrade</code>. If <code>yarn install</code> does the trick, then that's cool.
   
   Everyone will need to run <code>yarn install</code> after pulling the latest from whichever branch just in case the <code>yarn.lock</code> file changed. This will require an internet connection. These 2 reasons are why <code>node_modules</code> is in the <code>titanium_mobile</code> repo. I guarantee you someone will not remember to run <code>yarn install</code> and complain things aren't working all because of an out of date dependency.</li>
<li>Chris Barber 2017-04-20

   Just to confirm, you are correct, we should run <code>yarn install</code>, not <code>yarn upgrade</code>.</li>
<li>Christopher Williams 2017-06-02

   So, npm 5 just came out. Basically eliminates the need to use yarn and yarn.lock. Ugh, re-purposing this ticket to move to npm5 and package-lock.json file.</li>
<li>Abir Mukherjee 2017-08-29

   PR was merged. Closing ticket as changes are seen in the latest SDK's</li>
</ol>


<p><a href="/TIMOB/TIMOB-24591.json">JSON Source</a></p>