---
title: "[TIMOB-24681] Android: AVD detection fails if matching SDK is not installed"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-05-16T17:13:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.1.0, Release 6.0.4</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Jan Vennemann</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2017-05-11T22:23:37.000+0000</td></tr>
<tr><th>Updated</th><td>2017-05-16T18:43:51.000+0000</td></tr>
</table>

<h3>Description</h3>

*Steps to reproduce the behavior*
1. Create an AVD in Android Studio via _Tools > Android > AVD Manager_ without the matching SDK being installed, e.g. AVD with Android 5.1 but no SDK 22 installed. This will download the required Google APIs System Image but not the SDK.
2. Try to run an app on that emulator with <code>appc run -p android -C &lt;emulator-id&gt; -l trace</code>

*Actual behavior*
The build crashes with the following error:
<code><pre>
2017-05-11T14:00:12.722Z | ERROR  | Cannot read property 'name' of undefined
2017-05-11T14:00:12.722Z | TRACE  | TypeError: Cannot read property 'name' of undefined
    at /Users/jvennemann/Library/Application Support/Titanium/mobilesdk/osx/6.1.0.v20170510131349/node_modules/node-titanium-sdk/lib/android.js:671:23
</pre></code>

*Expected behavior*
The build succeeds and the app launches on the specified AVD.

*Additional notes*
This also breaks <code>appc info</code> with the unhelpful error:
<code><pre>
2017-05-11T22:19:03.961Z | ERROR  | Error: titanium exited with exit code 1. re-run with -l trace to get detailed output
    at ChildProcess.&lt;anonymous&gt; (/Users/jvennemann/.appcelerator/install/6.2.0/package/lib/commands/info.js:45:23)
</pre></code>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2017-05-12

   [~cbarber] It's the one we talked about last week. May include a match-validation of AVD -> SDK-Level, so it breaks earlier and informs the user about the issue.</li>
<li>Jan Vennemann 2017-05-12

   Should it really break? I would say building the app with SDK 23 and then running it on an AVD with API Level 22 to test how it works should be a valid use case. Why would i want to install the SDK if i only need the AVD to see how my app works on that specific API level.</li>
<li>Ketan Majmudar 2017-05-12

   I created an AVD with current tooling level (25) then it would allow me to build. the AVD that wasn't linked I deleted, but then it kept crashing (as I use genymotion) until I created an android AVD against the installed SDK (25 as mentioned). i'm back up and running now.
   </li>
<li>Chris Barber 2017-05-12

   node-titanium-sdk PR: <a href="https://github.com/appcelerator/node-titanium-sdk/pull/3" rel="nofollow" target="_blank">https://github.com/appcelerator/node-titanium-sdk/pull/3</a>
   node-titanium-sdk@0.2.3 published
   
   TiSDK master PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/9057" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9057</a>
   TiSDK 6_1_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/9058" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9058</a>
   
   To test, open your Android SDK folder, then rename the <code>addons</code> and <code>platforms</code> directories so that Titanium can't find them, then run <code>ti info -t android</code>.</li>
<li>Hans Knöchel 2017-05-12

   LGTM. [~jvennemann] to confirm.</li>
<li>Jan Vennemann 2017-05-13

   Looks good! Did a quick check, no crashes anymore!</li>
<li>Lokesh Choudhary 2017-05-16

   FR passed for backport.</li>
<li>Lokesh Choudhary 2017-05-16

   Backport PR merged.</li>
<li>Lokesh Choudhary 2017-05-16

   Master PR merged.</li>
<li>Lokesh Choudhary 2017-05-16

    Verified the fix in 6.1.0.v20170516103606.
    
    AVD detection does not fail & avd launches successfully if matching SDK is not installed.
    Closing.
    
    Studio Ver:     4.9.0.201705110256
    SDK Ver:        6.1.0.v20170516103606
    OS Ver:         10.12.3
    Xcode Ver:      Xcode 8.3.2
    Appc NPM:       4.2.9
    Appc CLI:       6.2.1
    Ti CLI Ver:     5.0.13
    Alloy Ver:      1.9.11
    Node Ver:       6.10.1
    Java Ver:       1.8.0_101
    </li>
</ol>


<p><a href="/TIMOB/TIMOB-24681.json">JSON Source</a></p>