---
title: "[TIMOB-24695] Android: ImageView.image fails when URL contains multiple question marks"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-06-28T22:03:46.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>imageview</td></tr>
<tr><th>Reporter</th><td>Dan Noa</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2017-05-14T11:39:19.000+0000</td></tr>
<tr><th>Updated</th><td>2017-08-17T01:48:12.000+0000</td></tr>
</table>

<h3>Description</h3>

when the imageView path that contains multiple '?' symbol it will not get be encoded properly on Android.

Sample Url: 
[<a href="http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60?mode=crop&width=333&height=250" rel="nofollow" target="_blank">http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60?mode=crop&width=333&height=250</a>]

Notice there is 2 '?' in the url, the second one is encoded to %%3F by android as shown below:

[<a href="http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60%%3Fmode=crop&width=333&height=250" rel="nofollow" target="_blank">http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60%%3Fmode=crop&width=333&height=250</a>]

I tried using encodeUri but android still appends a % before the %3F symbol.

Steps:
1. Run sample code
2. Check image in the browser to verify the URL is valid.

Actual: Image does not appear
Expected: Image must appear

<code><pre>
var window = Titanium.UI.createWindow({
 });
 
var imageview = Ti.UI.createImageView({
	image:'<a href="http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60?mode=crop&width=333&height=250" rel="nofollow" target="_blank">http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60?mode=crop&width=333&height=250</a>'
})
 
window.add(imageview);
window.open();
</pre></code>

Logs:
[ERROR] :  TiDownloadManager: (pool-3-thread-1) [1302,1302] Exception downloading <a href="http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60%%3Fmode=crop&width=333&height=250" rel="nofollow" target="_blank">http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60%%3Fmode=crop&width=333&height=250</a>
[ERROR] :  TiDownloadManager: java.io.FileNotFoundException: <a href="http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60%%3Fmode=crop&width=333&height=250" rel="nofollow" target="_blank">http://scontent.xx.fbcdn.net.rsz.io/v/t1.0-9/s720x720/17795851_419371511758070_7481565181564022529_n.jpg?oh=7772aea44d2f40fdbd42285ca61d7aac&oe=59771D60%%3Fmode=crop&width=333&height=250</a>
[ERROR] :  TiDownloadManager: 	at com.android.okhttp.internal.huc.HttpURLConnectionImpl.getInputStream(HttpURLConnectionImpl.java:238)
[ERROR] :  TiDownloadManager: 	at java.net.URL.openStream(URL.java:470)
[ERROR] :  TiDownloadManager: 	at org.appcelerator.titanium.util.TiDownloadManager$DownloadJob.run(TiDownloadManager.java:135)
[ERROR] :  TiDownloadManager: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)
[ERROR] :  TiDownloadManager: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)
[ERROR] :  TiDownloadManager: 	at java.lang.Thread.run(Thread.java:818)



<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2017-05-15

   The second URL doesn't even run on normal browsers, it's throwing n 403 error. So probably it's linked to an access token or authorized content, this is no Android issue.</li>
<li>Dan Noa 2017-05-15

   Yes it will not run because it has wrongly been encoded on Android. Same url works perfectly on ios. If you check the sample url i posted, you will see it's a valid one and loads properly in the browser. </li>
<li>Hans Knöchel 2017-05-15

   Ok, it's clear now. So it's not the loading of the URL but the encoding of it. Waiting for support to validate it, but it looks valid for me!</li>
<li>Sharif AbuDarda 2017-05-15

   Hello, I can verify the issue in Android. The image does not load and there is the error. Tested with SDK 6.0.4.GA and CLI 6.2.0. Tested in Android 6.0.2.device. Working for iOS though. Tested with 10.2 simulator. Moving to engineering. </li>
<li>Gary Mathews 2017-05-30

   -master: <code><a href="https://github.com/appcelerator/titanium_mobile/pull/9097" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9097</a></code>-</li>
<li>Joshua Quick 2017-06-28

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/9178" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9178</a></li>
<li>Lokesh Choudhary 2017-06-28

   FR Passed.</li>
<li>Lokesh Choudhary 2017-08-17

   Verified the fix in SDK 7.0.0.v20170816113226 & 6.2.0.v20170816173122.
   
   Closing.
   
   Studio Ver:     4.9.1.201707200100
   SDK Ver:        6.2.0.v20170816173122, 7.0.0.v20170816113226
   OS Ver:         10.12.3
   Xcode Ver:      Xcode 8.3.3
   Appc NPM:       4.2.9
   Appc CLI:       6.2.3
   Ti CLI Ver:     5.0.14
   Alloy Ver:      1.9.13
   Node Ver:       6.10.1
   Java Ver:       1.8.0_101
   Devices:        ⇨ google Pixel --- Android 7.1.1
                   ⇨ google Nexus 5 --- Android 6.0.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-24695.json">JSON Source</a></p>