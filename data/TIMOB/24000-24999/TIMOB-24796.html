---
title: "[TIMOB-24796] iOS: Hybrid CommonJS and Native modules don't handle multiple js files"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-06-15T18:36:20.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>merge-6.1.1, mobilesdk, module, user_experience, validate</td></tr>
<tr><th>Reporter</th><td>Andrea Vitale</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2017-06-08T17:48:05.000+0000</td></tr>
<tr><th>Updated</th><td>2017-06-15T22:48:58.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi, I tested this using 6.1.0.GA and it works only for a single commonjs file.
Suppose that you have a module called it.commonjs.test.module and in your assets folder you have two files called:
it.commonjs.test.module.js
another.module.js
In the second one you have:
<code><pre>
module.exports = {
    sayWelcome: function() {
        Ti.API.info("Welcome from the second commonjs module");
    }
};
</pre></code>
In the first one you have:
<code><pre>
module.exports = {
    sayHello: function() {
        alert("Hello!");
    },
    secondModule: require("it.commonjs.test.module/another.module")
}
</pre></code>
You can successfully build the module but when you try to run an app that requires the it.commonjs.test.module module you get an error like:
<code>[ERROR] Script Error Couldn't find module: it.commonjs.test.module/another.module for architecture: i386</code>
If you try to build the module with 3.5.1.GA sdk everything is working fine.
On Android is working also with 6.1.0.GA.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-24796_62623/hybrid.ios.mod.zip">hybrid.ios.mod.zip</td></td><td>2017-06-08T20:22:14.000+0000</td><td>22491</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2017-06-08

   master/6.2.0: <a href="https://github.com/appcelerator/titanium_mobile/pull/9131" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9131</a>
   6.1.1: <a href="https://github.com/appcelerator/titanium_mobile/pull/9132" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9132</a>
   
   I'm not really sure how this "worked" in 3.5.1, as it appears we've always mangled the file paths to turn '.' to '_' when attempting to load JS assets in a native iOS module - but I can find no version of titanium_prep that actually generated file paths with the same underscore mangling.</li>
<li>Christopher Williams 2017-06-08

   For testing/review:
   I've attached a hybrid iOS native module with two commonjs files in the assets folder. Unzip it, and attempt to build the module and run the example app.js by doing:
   <code><pre>
   unzip hybrid.ios.mod.zip
   cd hybrid.ios.mod
   ti build -p ios
   </pre></code>
   
   Prior to the PR this would complain at runtime about being unable to load the required js files. With the fix in the PR, it should not complain and the log output should show that we were able to load an object with each require call.</li>
<li>Andrea Vitale 2017-06-09

   Tested with my sample project that works only on 3.5.1.GA.
   Verified the fix, everything is working now!
   
   Really thank you.</li>
<li>Abir Mukherjee 2017-06-15

   Passed FR with this environment:
   Node Version: 6.10.3
   NPM Version: 3.10.10
   Mac OS: 10.12.4
   Appc CLI: 6.2.2
   Appc CLI NPM: 4.2.9
   Titanium SDK version: 6.1.1 locally built with the appropriate pr
   Appcelerator Studio, build: 4.9.0.201705302345-39
   Xcode 8.3.2
   Hyperloop 2.1.0 (master) and 2.0.1
   
   I built the module and used the module in the demo app. No errors were seen at any stage, and the app worked as expected.</li>
<li>Abir Mukherjee 2017-06-15

   Verified that the fixes are here:
   SDK 6.1.1.v20170615113917
   SDK 6.2.0.v20170615115004
   Closing ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-24796.json">JSON Source</a></p>