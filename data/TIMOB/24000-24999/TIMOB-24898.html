---
title: "[TIMOB-24898] Android: setting view.borderRadius causes backgroundColor alpha to be ignored"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-07-11T13:43:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.1.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ian Wall</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2017-06-24T04:59:02.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-07T07:00:31.000+0000</td></tr>
</table>

<h3>Description</h3>

The below code loosely simulates how I implemented an overlay tutorial in my app using backgroundColor transparency, set via hex triplets. mainview and label represent app content. containerview is an overlay containing tutorial information, and masking view represents a view that 'darkens' the content until it needs to be highlighted. In the example below, it toggles the highlighting by setting the maskingview backgroundColor  alpha to either 0 or 90% when you click the view. 

Expected result is the alpha of the maskingview backgroundColor changes and the mainview content is visible or masked. Works on both Android and iOS using SDK 5.4.0.GA. Works on iOS using SDK 6.1.0.GA, but not Android. Commenting out setting borderRadius on the maskingview (issue is both at create or runtime) solves the problem on Android.

Steps to reproduce: uncomment the borderRadius setter below, build with 5.4.0.GA on Android. Expected result: clicking on view fades or shows the underlying "Hello". Rebuild with 6.1.0.GA on Android, clicking on view complete hides the underlying view. Comment out borderRadius setter under 6.1.0.GA, works as expected again.

<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor: 'black'
});
 
var mainview = Ti.UI.createView({
	backgroundColor: "#202020",
	width: 200, height: 200
});

var label = Ti.UI.createLabel({
	text: "Hello",
	width: 50,	height: 30,	color: "white"
});

mainview.add(label);

var containerview = Ti.UI.createView({
	backgroundColor: "#00202020",
	width: 300, height: 300
});

var maskingview = Ti.UI.createView({
	width: 200, height: 200, 
	//borderRadius: 6, 
	borderWidth: 1, 
	borderColor: "#ff0000",
	backgroundColor: "#e6202020"
});

containerview.add(maskingview);
win.add(mainview);
win.add(containerview);
 
maskingview.addEventListener('click', function(e) {
	maskingview.backgroundColor = (maskingview.backgroundColor == "#e6202020" ? "#00202020" : "#e6202020");
});
</pre></code>

<h3>Comments</h3>

<ol>
<li>Gary Mathews 2017-06-29

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/9179" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9179</a></li>
<li>Lokesh Choudhary 2017-07-06

   FR Passed.
   PR Merged.</li>
<li>Gary Mathews 2017-07-11

   Jenkins tests are failing due to <code>backgroundColor: null</code>
   
   Reopening to push fix.</li>
<li>Gary Mathews 2017-07-11

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/9214" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9214</a></li>
<li>Abir Mukherjee 2017-07-11

   Changes are seen in SDK 6.2.0.v20170711090338. Closing ticket.</li>
<li>Michael Gangolf 2017-09-02

   There is a little bug in 6.2.0.RC when you don't set a <code>backgroundColor</code> and apply a <code>borderRadius</code> it will disable HW acceleration. But if you set the background color to <code>"transparent"</code> it will keep the acceleration (like it was in 6.1.2.GA)
   
   *Code* (sorry it's an alloy project)
   
   JS
   <code><pre>
   var d = [];
   for (var i = 0; i &lt; 20; ++i) {
   	d.push({
   		viewPlayer: {
   			width: "50%"
   		}
   	});
   }
   $.list_events.sections[0].setItems(d);
   $.index.open();
   </pre></code>
   
   TSS
   <code><pre>
   ".view_event" : {left: 5,right: 5,top: 5,backgroundColor: "#AAA",height: 90,bottom: 5,borderRadius: 4,borderColor: "#DDD",borderWidth: 1}
   "#list_events" : {height: Ti.UI.FILL,width: Ti.UI.FILL}
   ".viewPlayer":{height: Ti.UI.FILL,left:0,backgroundColor: "#f00"}
   
   ".view_player": {
   	left:10,right:10,height: 15,
   	/*backgroundColor: "transparent",*/
   	borderRadius: 4,borderColor: "#999",
   }
   </pre></code>
   
   XML
   <code><pre>
   &lt;Alloy&gt;
   	&lt;Window &gt;
   		&lt;ListView id="list_events" defaultItemTemplate="default"&gt;
   			&lt;Templates&gt;
   				&lt;ItemTemplate name="default"&gt;
   					&lt;View class="view_event"&gt;
   						&lt;View class="view_player"&gt;
   							&lt;View bindId="viewPlayer" class="viewPlayer"/&gt;
   						&lt;/View&gt;
   					&lt;/View&gt;
   				&lt;/ItemTemplate&gt;
   			&lt;/Templates&gt;
   			&lt;ListSection&gt;&lt;/ListSection&gt;
   		&lt;/ListView&gt;
   	&lt;/Window&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   In 6.2.0.RC the movement of the ListView is not smooth (in 6.1.2.GA it is). When you uncomment the line <code>backgroundColor:"transparent"</code> it will be smooth in 6.2.0.RC. </li>
<li>Gary Mathews 2017-09-04

   [~michael] What's interesting is it's actually the opposite. When <code>backgroundColor</code> is not set and <code>borderRadius</code> is set whilst you are running Android 6.0+. HW-acceleration will be enabled. Setting <code>backgroundColor: 'transparent'</code> with the <code>borderRadius</code> set will disable HW-acceleration (which allows transparency to work).
   
   So you are seeing a smoother ListView with HW-acceleration disabled. Android can be temperamental when it comes to HW-acceleration and in your case you are seeing improvements with it disabled.
   
   You could try disabling HW-acceleration in your manifest ([read more](<a href="https://developer.android.com/guide/topics/graphics/hardware-accel.html))" rel="nofollow" target="_blank">https://developer.android.com/guide/topics/graphics/hardware-accel.html))</a>
   <code><pre>
   &lt;application android:hardwareAccelerated="false" ...&gt;
   </pre></code></li>
<li>Michael Gangolf 2017-09-04

   I've put some log in TiUiView (before every disableHWAcceleration() call
   
   *output for transparent backgroundColor (smooth scrolling):*
   
   <code><pre>
   [INFO]  BGColor: (main) [7,167] 0
   [INFO]  BGColor: (main) [160,160] -5592406
   [INFO]  BGColor: (main) [0,160] disable HWAccel because of bgColor 
   [INFO]  TiUIView: (main) [0,160] disableHWAcceleration()
   </pre></code>
   
   *output for no backgroundColor (laggy scrolling)*
   <code><pre>
   [INFO]  BGColor: (main) [4,180] null
   [INFO]  BGColor: (main) [10,190] -5592406
   [INFO]  BGColor: (main) [1,191] disable HWAccel because of bgColor
   [INFO]  TiUIView: (main) [0,191] disableHWAcceleration()
   </pre></code>
   
   So you are right, it is disabling HW acceleration in both cases.
   
   But adding 
   <code><pre>
   &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
   		&lt;manifest&gt;
   			&lt;application android:hardwareAccelerated="false"&gt;
   			&lt;/application&gt;
   		&lt;/manifest&gt;
   	&lt;/android&gt;
   </pre></code>
   doesn't make any difference.
   
   So it looks like there is something else that is responsible for lowering the performance. In 6.1.2.GA it is smooth in both cases. I'm currently checking <code>TiBackgroundDrawable</code>
   </li>
<li>Michael Gangolf 2017-09-04

   [~gmathews] There is an endless <code>draw()</code> loop in <code>TiBackgroundDrawable</code>!
   
   A log in <code>draw()</code> is called once per ListView item when I set the backgroundColor to transparent. When I don't set it it is called constantly! So its not the HW acceleration that is causing the problem it is a constant redraw! But I'm not sure what is calling <code>draw()</code> all the time :)</li>
<li>Gary Mathews 2017-09-04

    [~michael] Uh oh!! Thanks for finding that, I'll take a look!</li>
<li>Gary Mathews 2017-09-07

    </li>
<li>Michael Gangolf 2017-09-07

    Nice, thank you [~gmathews]!</li>
<li>ardy wongso 2017-11-06

    Is it me or it happen again on 6.3.0
    
    for eg: 
    var avatarView = Ti.UI.createImageView({
    		height:'40',width:'40',
    		borderRadius:20,
    		touchEnabled:false,
    		defaultImage:'/icon/ic_blueUser.png',
    		backgroundColor:'#fff',
    	});
    
    when i add above code to view, in 6.1.2 is shows BOX image, in 6.2.2 it shows CIRCLE image, in 6.3.0 it shows CIRCLE image, i think something is wrong with handling border radius.
    
    but when i turn off hardware acceleration (android:hardwareAccelerated = "false") in 6.1.2, 6.2.2 and 6.3.0 it shows circle
    
    it happen on s4 mini 4.4.2, but in other android phone it works fine.
    
    sorry if this not related to main bug.</li>
<li>David van de Meer 2018-08-07

    Hi, 
    
    This (or something similar) seems to have come up again
    
    Titanium SDK 7.2.0 
    Real Device: Lenovo A328 - Android 4.4.2
    Simulator: Genymotion Google Nexus 5 - 4.4.4 - API 19 - 1080x1920
    
    Steps to reproduce:
    1. Build a new clean alloy app
    2. Add the following code to index.js
    3. Notice the top of the child view gets cut off.
    4. To fix - remove borderRadius value and build again and the view will no longer be cut off
    
    <code><pre>
    // create alertView container
    var alertView = Ti.UI.createView({
    	 backgroundColor:'white',
    	 opacity: 0.90,
    	 borderRadius: 5,
    	 width: "85%",
    	 height: '200dp',
    	 layout: 'vertical',
    });
    
    // create alertTitleView
    var alertTitleView = Ti.UI.createView({
      width: Ti.UI.FILL,
      height: Ti.UI.SIZE,
    });
    
    // create alertTitleLabel
    var alertTitleLabel = Ti.UI.createLabel({
      text: "This is a long test title This is a long test title This is a long test title This is a long test title",
      color: 'black',
      textAlign: 'center',
      touchEnabled: false,	
      top: "15dp",
      left: 5,
      right: 5,
      font: {
    			fontSize: '20dp',
    		}
    });
    
    alertTitleView.add(alertTitleLabel);
    alertView.add(alertTitleView);
    
    $.main.backgroundColor = "black";
    
    $.main.add(alertView);
    	  
    $.main.open();
    </pre></code>
    </li>
</ol>


<p><a href="/TIMOB/TIMOB-24898.json">JSON Source</a></p>