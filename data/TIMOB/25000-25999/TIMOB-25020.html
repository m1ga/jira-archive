---
title: "[TIMOB-25020] Android: requestThumbnailImagesAtTimes causes a crash"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-08-23T09:41:53.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.2.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>android, regression</td></tr>
<tr><th>Reporter</th><td>Zakhar Zhuravlev</td></tr>
<tr><th>Assignee</th><td>Yordan Banev</td></tr>
<tr><th>Created</th><td>2017-07-16T13:29:34.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-12T16:39:27.000+0000</td></tr>
</table>

<h3>Description</h3>

*index.js:*
<code><pre>
var button = Ti.UI.createButton({
    title: "record"
});

button.addEventListener('click', recordVideo);

$.win.add(button);
$.win.open();

function recordVideo() {
    var permissionsToRequest = [];

    var audioPermission = "android.permission.RECORD_AUDIO";
    var hasAudioPerm = Ti.Android.hasPermission(audioPermission);
    if (!hasAudioPerm) {
        permissionsToRequest.push(audioPermission);
    }

    var cameraPermission = "android.permission.CAMERA";
    var hasCameraPerm = Ti.Android.hasPermission(cameraPermission);
    if (!hasCameraPerm) {
        permissionsToRequest.push(cameraPermission);
    }

    var storagePermission = "android.permission.READ_EXTERNAL_STORAGE";
    var hasStoragePerm = Ti.Android.hasPermission(storagePermission);
    if (!hasStoragePerm) {
        permissionsToRequest.push(storagePermission);
    }
    if(permissionsToRequest.length &gt; 0) {
        Ti.Android.requestPermissions(permissionsToRequest, function (e) {
            if (e.success) {
                showCamera();
            }
        });
    } else {
        showCamera();
    }
}

function showCamera() {
    Ti.Media.showCamera({
        autohide: false,
        animated: false,
        allowEditing: false,
        success:function(event) {
            var movie = Titanium.Media.createVideoPlayer({
                url:event.media.nativePath,
                backgroundColor:'#111',
                mediaControlStyle: Titanium.Media.VIDEO_CONTROL_EMBEDDED,
                scalingMode:Titanium.Media.VIDEO_SCALING_ASPECT_FILL,
                width:300,
                height:300,
            });
            $.win.add(movie);

            movie.addEventListener('durationavailable', function() {
                movie.requestThumbnailImagesAtTimes([1], Titanium.Media.VIDEO_TIME_OPTION_NEAREST_KEYFRAME, function(response) {
                    Ti.API.info("Thumbnail callback called, success = " + response.success);
                    console.log(response);
                    if(response.success) {

                    }
                });
            });
        },
        cancel:function() {
            console.log("cancel");
        },
        error:function(error) {
            console.log("error");
            console.log(error);
        },
        mediaTypes: [Ti.Media.MEDIA_TYPE_VIDEO],
    });
}
</pre></code>

I'm getting this exception: 

<code><pre>
[WARN]  W/System.err: java.lang.NullPointerException: Attempt to invoke interface method 'boolean android.database.Cursor.moveToNext()' on a null object reference
[WARN]  W/System.err:   at org.appcelerator.titanium.io.TitaniumBlob.init(TitaniumBlob.java:84)
[WARN]  W/System.err:   at org.appcelerator.titanium.io.TitaniumBlob.&lt;init&gt;(TitaniumBlob.java:33)
[WARN]  W/System.err:   at ti.modules.titanium.media.VideoPlayerProxy.requestThumbnailImagesAtTimes(VideoPlayerProxy.java:722)
[WARN]  W/System.err:   at org.appcelerator.kroll.runtime.v8.V8Object.nativeFireEvent(Native Method)
[WARN]  W/System.err:   at org.appcelerator.kroll.runtime.v8.V8Object.fireEvent(V8Object.java:62)
[WARN]  W/System.err:   at org.appcelerator.kroll.KrollProxy.doFireEvent(KrollProxy.java:872)
[WARN]  W/System.err:   at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1095)
[WARN]  W/System.err:   at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:360)
[WARN]  W/System.err:   at ti.modules.titanium.media.VideoPlayerProxy.handleMessage(VideoPlayerProxy.java:395)
[WARN]  W/System.err:   at android.os.Handler.dispatchMessage(Handler.java:98)
[WARN]  W/System.err:   at android.os.Looper.loop(Looper.java:148)
[WARN]  W/System.err:   at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:118)
</pre></code>


<h3>Comments</h3>

<ol>
<li>Yordan Banev 2017-07-25

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/9245" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9245</a></li>
<li>Samir Mohammed 2017-08-22

   [~ybanev] Master is merged, waiting for 6_2_X back-port. </li>
<li>Yordan Banev 2017-08-23

   6_2_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/9347" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9347</a></li>
<li>Samir Mohammed 2017-08-24

   Verified fix in SDK Version: 6.2.0.v20170824074531 and SDK Version: 7.0.0.v20170823165814
   
   Test and other information can be found at: 
   Master: <a href="https://github.com/appcelerator/titanium_mobile/pull/9245" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9245</a>
   6_2_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/9347" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9347</a></li>
<li>Fabian Martinez 2018-02-07

   This bug has returned on SDK 7.0.1.GA. I'm receiving the same error when trying to create a thumbnail from a videoPlayer on android. It is working on iOS.</li>
<li>Yordan Banev 2018-02-08

   [~inzori] I am not able to reproduce the problem. Would be able to provide a code sample/project which does and information about the device you are using?</li>
<li>Fabian Martinez 2018-02-08

   Hi, </li>
<li>Fabian Martinez 2018-02-08

   Hi, this is the code in index.js:
   function doClick(e) {
   	var auxVideoPlayer = Ti.Media.createVideoPlayer({
   		autoplay: false,
   		url: '<a href="http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4" rel="nofollow" target="_blank">http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4</a>',
   		height: 200,
   		width: 300,
   		scalingMode: Ti.Media.VIDEO_SCALING_RESIZE_ASPECT_FILL
   	});
   	$.videoWrapper.add(auxVideoPlayer);
   	auxVideoPlayer.requestThumbnailImagesAtTimes([0], Titanium.Media.VIDEO_TIME_OPTION_NEAREST_KEYFRAME, function (e) {
   		console.log('requested video thumbnail');
   		console.log(e);
   		if (e.success) {
   			var image = Ti.UI.createImageView({
   				top: 0,
   				height: 200,
   				width: 300,
   				image: e.image
   			});
   
   			svView.add(image);
   		}
   		//auxVideoPlayer = null;
   		//$.videoWrapper.removeAllChildren();
   	});
   	$.imageContainer.add(svView);		
   }
   
   $.index.open();
   
   
   Index.tss:
   ".container": {
   	backgroundColor:"white",
   	layout: 'vertical'
   }
   
   "Label": {
   	width: Ti.UI.SIZE,
   	height: Ti.UI.SIZE,
   	color: "#000",
   	top: 10
   }
   
   "#label": {
   	font: {
   		fontSize: 12
   	}
   }
   
   "#imageContainer": {
   	top: 10,
   	touchEnabled: false,	
   }
   "#videoWrapper": {
   	visible: true,
   	top: 10,
   	height: Ti.UI.SIZE,
   	width: Ti.UI.SIZE
   }
   
   Index.xml
   <Alloy>
   	<Window class="container">
   		<Label id="label" onClick="doClick">Load thumb</Label>
   		<View id="videoWrapper" />
   		<View id="imageContainer" />
   	</Window>
   </Alloy>
   
   The error I get is this, it isn't creating the thumb but the video is playable:
   [WARN]  W/System.err: java.lang.NullPointerException: Attempt to invoke interface method 'boolean android.database.Cursor.moveToNext()' on a null object reference
   [WARN]  W/System.err:   at org.appcelerator.titanium.io.TitaniumBlob.init(TitaniumBlob.java:84)
   [WARN]  W/System.err:   at org.appcelerator.titanium.io.TitaniumBlob.<init>(TitaniumBlob.java:33)
   [WARN]  W/System.err:   at ti.modules.titanium.media.VideoPlayerProxy.requestThumbnailImagesAtTimes(VideoPlayerProxy.java:755)
   [WARN]  W/System.err:   at org.appcelerator.kroll.runtime.v8.V8Object.nativeFireEvent(Native Method)
   [WARN]  W/System.err:   at org.appcelerator.kroll.runtime.v8.V8Object.fireEvent(V8Object.java:62)
   [WARN]  W/System.err:   at org.appcelerator.kroll.KrollProxy.doFireEvent(KrollProxy.java:936)
   [WARN]  W/System.err:   at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1159)
   [WARN]  W/System.err:   at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:363)
   [WARN]  W/System.err:   at android.os.Handler.dispatchMessage(Handler.java:98)
   [WARN]  W/System.err:   at android.os.Looper.loop(Looper.java:154)
   [WARN]  W/System.err:   at android.app.ActivityThread.main(ActivityThread.java:6077)
   [WARN]  W/System.err:   at java.lang.reflect.Method.invoke(Native Method)
   [WARN]  W/System.err:   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:865)
   [WARN]  W/System.err:   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:755)
   [ERROR] TiExceptionHandler: (main) [5511,5511] ----- Titanium Javascript Runtime Error -----
   [ERROR] TiExceptionHandler: (main) [0,5511] - In /alloy/controllers/index.js:71,18
   [ERROR] TiExceptionHandler: (main) [0,5511] - Message: Uncaught Attempt to invoke interface method 'boolean android.database.Cursor.moveToNext()' on a null object reference
   [ERROR] TiExceptionHandler: (main) [0,5511] - Source:           auxVideoPlayer.requestThumbnailImagesAtTimes([0], Titanium.Media.VIDEO_TIME_OPTION_NEAREST_KEYFRAME, function (e) {
   [ERROR] V8Exception: Exception occurred at /alloy/controllers/index.js:71: Uncaught Attempt to invoke interface method 'boolean android.database.Cursor.moveToNext()' on a null object reference
   [ERROR] V8Exception: Attempt to invoke interface method 'boolean android.database.Cursor.moveToNext()' on a null object reference
   [WARN]  MediaPlayer: Couldn't open <a href="http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4:" rel="nofollow" target="_blank">http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4:</a> java.io.FileNotFoundException: No content provider: <a href="http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4" rel="nofollow" target="_blank">http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4</a>
   
   
   </li>
<li>Fabian Martinez 2018-02-08

   Sorry for the bad code sent.
   This is the correct index.js. Works on iOS but not android.
   
   function doClick(e) {
   	var svView = Ti.UI.createView({
   		top: 0,
   		height: 200,
   		width: 300
   	});
   	var auxVideoPlayer = Ti.Media.createVideoPlayer({
   		autoplay: false,
   		url: '<a href="http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4" rel="nofollow" target="_blank">http://ve-ep.ember.ltd/assets/media/qa/samplevideo-1280x720-5mb.mp4</a>',
   		height: 200,
   		width: 300,
   		scalingMode: Ti.Media.VIDEO_SCALING_RESIZE_ASPECT_FILL
   	});
   	$.videoWrapper.add(auxVideoPlayer);
   	auxVideoPlayer.requestThumbnailImagesAtTimes([0], Titanium.Media.VIDEO_TIME_OPTION_NEAREST_KEYFRAME, function (e) {
   		console.log('requested video thumbnail');
   		console.log(e);
   		if (e.success) {
   			var image = Ti.UI.createImageView({
   				top: 0,
   				height: 200,
   				width: 300,
   				image: e.image
   			});
   
   			svView.add(image);
   		}
   		//auxVideoPlayer = null;
   		//$.videoWrapper.removeAllChildren();
   	});
   	$.imageContainer.add(svView);		
   }
   
   $.index.open();</li>
<li>Yordan Banev 2018-02-09

    Thank you for the sample. I was able to reproduce the issue.</li>
</ol>


<p><a href="/TIMOB/TIMOB-25020.json">JSON Source</a></p>