---
title: "[TIMOB-25078] Windows: run cmake flag always defaults to Visual Studio 2015 generator"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-08-21T09:15:15.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.1.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.2.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2017-08-09T13:25:20.000+0000</td></tr>
<tr><th>Updated</th><td>2017-08-22T09:30:10.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

When using the <code>--run-cmake</code> flag with VS2017 the generator selected will always be <code>Visual Studio 14 2015</code> this is because the check [here](<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/18d58eb3a3b123ac916017661b83635a28e8caec/templates/module/default/template/windows/plugins/hooks/windows.js#L41)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/18d58eb3a3b123ac916017661b83635a28e8caec/templates/module/default/template/windows/plugins/hooks/windows.js#L41)</a> needs to be data.windowsInfo.selectedVisualStudio

Below is the working code

<code><pre>
function selectVisualStudio(data) {
    if (data.windowsInfo && data.windowsInfo.selectedVisualStudio) {
        var version = data.windowsInfo.selectedVisualStudio.version;
        if (version == '12.0') {
            return 'Visual Studio 12 2013';
        } else if (version == '14.0') {
            return 'Visual Studio 14 2015';
        } else if (/^Visual Studio \w+ 2017/.test(version)) {
            return 'Visual Studio 15 2017';
        }
    }
    return 'Visual Studio 14 2015';
}
</pre></code>

<h4>Steps to reproduce</h4>

You need VS2017 to test this
1. Grab <a href="https://github.com/appcelerator-archive/ti.paint" rel="nofollow" target="_blank">https://github.com/appcelerator-archive/ti.paint</a>
2. Overwrite ti.paint/windows/plugins/hooks/windows.js with the hook [here](<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/18d58eb3a3b123ac916017661b83635a28e8caec/templates/module/default/template/windows/plugins/hooks/windows.js)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/18d58eb3a3b123ac916017661b83635a28e8caec/templates/module/default/template/windows/plugins/hooks/windows.js)</a>
3. Make sure the path at ti.paint/blob/master/windows/CMakeLists.txt#L24, matches your selected
4. Build the module using <code>appc run -p windows --build-only --run-cmake</code>

<h4>Actual</h4>

Errors out with 

<code><pre>
[DEBUG] Run CMake on C:\Users\ewan\Documents\git\ti.paint\windows\Windows10.Win32
[WARN]  CMake Error at CMakeLists.txt:20 (project):
  A Windows Store component with CMake requires both the Windows Desktop SDK
  as well as the Windows Store '10.0' SDK.  Please make sure that you have
  both installed
[INFO]  -- Configuring incomplete, errors occurred!
See also "C:/Users/ewan/Documents/git/ti.paint/windows/Windows10.Win32/CMakeFiles/CMakeOutput.log".
</pre></code>

Checking  ti.paint\windows\Windows10.Win32\CMakeCache.txt shows CMAKE_GENERATOR:INTERNAL is Visual Studio 14 2015

<h4>Expected</h4>

Should select VS2017 generator and build successfully (note that you might still see a failure due to it attempting to build 8.1)

<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2017-08-09

   FYI Hyperloop had similar issue (TIMOB-25077) and here's the fix: <a href="https://github.com/appcelerator/hyperloop.next/pull/200/files" rel="nofollow" target="_blank">https://github.com/appcelerator/hyperloop.next/pull/200/files</a></li>
<li>Kota Iguchi 2017-08-10

   This issue is addressed in the [PR for TIMOB-24189](<a href="https://github.com/appcelerator/titanium_mobile_windows/pull/959/commits/02e554618b29d2a88a44252a4ac5d6ce1a81d475)." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/959/commits/02e554618b29d2a88a44252a4ac5d6ce1a81d475).</a> </li>
<li>Ewan Harris 2017-08-22

   Verified changes in 6.2.0.v20170821203442</li>
</ol>


<p><a href="/TIMOB/TIMOB-25078.json">JSON Source</a></p>