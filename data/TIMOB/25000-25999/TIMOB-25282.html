---
title: "[TIMOB-25282] Windows: saveToPhotoGallery throws exception"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2017-10-09T12:57:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.1.2, Release 7.0.0, Release 6.2.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.0.0</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2017-09-14T16:29:30.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-06T17:49:12.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

Calling Ti.Media.saveToPhotoGallery() throws the following error, running through VS gives more detail and I believe the cause is [to_path here](<a href="https://github.com/appcelerator/titanium_mobile_windows/blob/7f4b3efcac026b1b6037b59ad1904556c826db21/Source/Media/src/Media.cpp#L377)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/blob/7f4b3efcac026b1b6037b59ad1904556c826db21/Source/Media/src/Media.cpp#L377)</a> is null, so the to convert string call is returning an empty string, which then causes an error in the copy call. I believe this is because the Library folders are virtualized [read here](<a href="https://stackoverflow.com/questions/38874259/windows-storage-knownfolders-musiclibrary-path-returns-empty)" rel="nofollow" target="_blank">https://stackoverflow.com/questions/38874259/windows-storage-knownfolders-musiclibrary-path-returns-empty)</a> so they don't have a path, we might need to do something like [this](<a href="https://github.com/Microsoft/Windows-universal-samples/blob/6370138b150ca8a34ff86de376ab6408c5587f5d/Samples/FileAccess/cpp/Scenario1_CreateAFileInThePicturesLibrary.xaml.cpp#L31-L48)" rel="nofollow" target="_blank">https://github.com/Microsoft/Windows-universal-samples/blob/6370138b150ca8a34ff86de376ab6408c5587f5d/Samples/FileAccess/cpp/Scenario1_CreateAFileInThePicturesLibrary.xaml.cpp#L31-L48)</a> to first find the folder for a user, then write to that folder

<code><pre>
[ERROR] ----- Titanium Javascript Runtime Error -----
[ERROR] In app.js: 14,28
[ERROR] Message: Uncaught Error: saveToPhotoGallery: unknown exception
</pre></code>

<code><pre>
var win = Ti.UI.createWindow();
var view = Ti.UI.createView({
    backgroundColor: 'red',
    width: 400,
    height: 400,
    borderRadius: 200
});
win.add(view);
win.open();
var file = Ti.Filesystem.getFile('Logo.png')
Ti.Media.saveToPhotoGallery(file, {
    success: function (e) {
        // log.args('Ti.Media', 'Image saved to photo-gallery successfully!');
        console.log('image done');
    },
    error: function (e) {
        // log.args('Ti.Media', 'Error saving image to photo-gallery: ' + e.error);
        console.log(JSON.stringify(e))
        console.log('image ');
    }
});
</pre></code>

<h4>Steps to reproduce</h4>

<h4>Add the above to an existing app.js and build for Windows</h4>

<h4>Actual</h4>

Error thrown

<h4>Expected</h4>

Image should be written to gallery

<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2017-10-02

   <a href="https://github.com/appcelerator/titanium_mobile_windows/pull/1127" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile_windows/pull/1127</a></li>
<li>Eric Merriman  2018-08-06

   Cleaning up older fixed issues. If this issue should not have been closed as fixed, please reopen.</li>
</ol>


<p><a href="/TIMOB/TIMOB-25282.json">JSON Source</a></p>