---
title: "[TIMOB-25387] Android Ti.App.addEventListener not working when there is an iframe in  local html file"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 6.2.2</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Anthony Chung</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2017-10-04T05:54:50.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-28T19:55:28.000+0000</td></tr>
</table>

<h3>Description</h3>

Test case provided here...
Environment, android, Ti. 6.1.1.GA plus.

[<a href="https://github.com/anthonychung/jira-appcelerator-tests/tree/issues/test-android-iframe-fireevent" rel="nofollow" target="_blank">https://github.com/anthonychung/jira-appcelerator-tests/tree/issues/test-android-iframe-fireevent</a>]

<h4>Android Ti.addEventListener not working when there is an iframe in  local html file</h4>


<code><pre>
&lt;script&gt;
Ti.App.addEventListener("app:fromTitanium", function(e) {
	alert(e.message);
});
&lt;/script&gt;
</pre></code>

This will work when local html has no iframe.
When there is an iframe in android local html content, 
Ti.addEventListener no longer works.

<h4>On iOS This works fine.</h4>
But on Android, having an iframe disables the functionality of the inline javascript Ti.App.addEventListener

<h4>To test</h4>
- run the app in Android, then click "Test without iframe" button, which will load index-noiframe.html with the eventListener, click "Fire Event" and the event will successfully alert.
- close window, then click "Test with iframe" button, which will load index-noiframe.html with the eventListener, click "Fire Event" and the event will not work.

<h3>Comments</h3>

<ol>
<li>Anthony Chung 2017-10-06

   This issue appears to be related to Android webview overwrites the jscontext for the parent, with the child's jscontext.
   Whereas, on ios, it preserves the parent jscontext.
   
   And since the Ti.App.addEventListener is a part of the parent's context (I assume it is injected with __ti_injection into the parent and not the child).  Then ios handles the support for this correctly. But Android is wiping out the parent web application.
   
   This is a critical issue for our application, because the American DOD ADL SCORM standard requires that the parent iframe expose apis for the child eLearning SCORM packages to talk to.
   
   Other frameworks seem to have faced this problem.
   <a href="https://stackoverflow.com/questions/9050949/webview-on-android-ics-iframe-problems-with-android-assets/10210172#10210172" rel="nofollow" target="_blank">https://stackoverflow.com/questions/9050949/webview-on-android-ics-iframe-problems-with-android-assets/10210172#10210172</a>
   
   Part of it is android webview, but another is that it affects the function of the Ti.App.addEventListeners.
   
   [~hknoechel] Have appc clients come across this issue before and is there are workaround? I will follow up also follow up with your official chat/support channel.
   
   Any advice related to this issue would be appreciated.</li>
<li>Motiur Rahman 2017-10-13

   Hello!
   
   I tested the issue and reproduce it with the following environment
   
   Ti SDK: 6.2.2.GA, 6.1.2.GA
   Android Emulator: 7,6
   Android Device: v4.4.2
   
   Steps To Reproduce
   1. Run the following code
   2. Click the button "From Titanium", 
   (event is not firing, this is the issue)
   3. If you remove the iframe from the html code then it works again.
   
   <code><pre>
   var win = Ti.UI.createWindow();
   	var webview = Ti.UI.createWebView({
   		url : '/index-withiframe.html'
   	});
   	var button = Ti.UI.createButton({
   		title : 'fromTitanium',
   		height : '50dp',
   		width : '130dp'
   	});
   	button.addEventListener('click', function(e) {
   		Ti.App.fireEvent('app:fromTitanium', {
   			message : 'event fired from Titanium, handled in WebView'
   		});
   	});
   	Ti.App.addEventListener('app:fromWebView', function(e) {
   		alert(e.message);
   	});
   
   	win.add(webview);
   	win.add(button);
   	win.open();
   
   </pre></code>
   
   <code><pre>
   &lt;html&gt;
   	&lt;head&gt;
   		&lt;script&gt;
   			Ti.App.addEventListener("app:fromTitanium", function(e) {
   	        	alert(e.message);
   	      	});
   		&lt;/script&gt;
   	&lt;/head&gt;
   	&lt;body&gt;
   		
   	&lt;iframe src="blank.html"&gt;&lt;/iframe&gt; 
   	
   	&lt;/body&gt;
   &lt;/html&gt;
   </pre></code>
   <code><pre>
   &lt;html&gt;
   	&lt;head&gt;
   		
   	&lt;/head&gt;
   	&lt;body&gt;
   		&lt;button onclick="Ti.App.fireEvent('app:fromWebView', { message: 'event fired from WebView, handled in Titanium' });"&gt;fromWebView&lt;/button&gt;
   	&lt;/body&gt;
   &lt;/html&gt;
   </pre></code>
   
   Thanks
   </li>
<li>Anthony Chung 2017-10-17

   Hi, is there any news on this issue?
   
   I have been running extra tests.
   In Android, the load event fires twice. This could be causing issues for the ti_injection.
   When I set up listeners on the child. Then it works. But I need the listeners on the parent.
   
   Android has a different event called onPageStarted that is fired when an iframe page is loaded, this can help distinguish from the double load event. If the ti_injection code needs to be adapted, the injection needs to happen on the parent and not the child load event. 
   
   Checking the local html code for the presence of 'iframe' on android can help to avoid doing the injection on the second load event and if something needs to be performed when everything is loaded then we can look for onPageStared on Android.
   
   <a href="https://developer.android.com/reference/android/webkit/WebViewClient.html#onPageStarted(android.webkit.WebView" rel="nofollow" target="_blank">https://developer.android.com/reference/android/webkit/WebViewClient.html#onPageStarted(android.webkit.WebView</a>, java.lang.String, android.graphics.Bitmap)
   
   </li>
<li>Anthony Chung 2017-10-17

   [~hknoechel] any chance of getting your perspective on this issue?</li>
</ol>


<p><a href="/TIMOB/TIMOB-25387.json">JSON Source</a></p>