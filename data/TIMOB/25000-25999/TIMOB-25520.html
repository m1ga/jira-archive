---
title: "[TIMOB-25520] iOS: Add ability to set VALID_ARCHITECTURES to limit supported architectures"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>architecture, cb-tooling, ios, processor</td></tr>
<tr><th>Reporter</th><td>Zakhar Zhuravlev</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2017-11-16T10:26:52.000+0000</td></tr>
<tr><th>Updated</th><td>2019-10-22T15:40:17.000+0000</td></tr>
</table>

<h3>Description</h3>

On android we can specify <armeabi> tag and exclude some abis. 
I need to compile iOS app only for arm64, as far as I understand now I don't have ability to exclude armv7 and armv7s. 
It would be great to have it for iOS as well. 

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2017-11-16

   Thanks for this feature request. It's not planned so far, but could likely be implemented as an external hook pretty easily, as it's just a build-setting in the <code>.pbxproj</code> file. See [this file](<a href="https://github.com/appcelerator-modules/hook-swift-frameworks/blob/master/ti.swiftsupport.js)" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/hook-swift-frameworks/blob/master/ti.swiftsupport.js)</a> for an example of changing the Swift version - it can be changed to specify any other value as well. And of course feel free to submit a pull-request if you feel it should be in the core.</li>
<li>Zakhar Zhuravlev 2018-04-06

   Thank you, Hans. 
   I found examples with native modules only, I want to set architectures for the whole app, should I create plugin for that?</li>
<li>Hans Knöchel 2018-04-06

   Yes, a plugin look forcing the <code>VALID_ARCHS</code> will limit it.</li>
<li>Zakhar Zhuravlev 2018-04-09

   1. create folder: /plugins/myplugin/hooks/myplugin.js
   2. in titapp.xml add: <plugin>myplugin</plugin>
   3. code: 
   <code><pre>
   'use strict';
   
   exports.id = 'myplugin';
   exports.cliVersion = '>=3.2';
   exports.init = init;
   
   function init(logger, config, cli, appc) {
   	cli.on('build.ios.xcodeproject', {
   		pre: function(data) {
   			logger.log('Test plugin');
   		}
   	});
   }
   
   </pre></code>
   
   
   But I don't see this log message, even in trace mode. Have I missed something? 
   Thank you in advance.</li>
<li>Chris Barber 2018-04-09

   [~zozo4kin] You don't need to create a "plugin" in this case. You can simply create a "hooks" directory in the top-level of your project and put <code>myplugin.js</code> in there and the build script will automatically load it. No need to add the <code><plugin></code> to the tiapp.xml.
   
   If you are going to have more than one <code>.js</code> file, only put the main one in the "hooks" directory and put the rest in a subdirectory. The build will blindly require() every <code>.js</code> file in the "hooks" directory.
   
   If you want to continue doing this as a plugin, then you must have a package.json in the root of your "myplugin" folder and you must define all of the <code><plugin></code> tags in a <code><plugins></code> section in the tiapp.xml (just like <code><modules></code>).</li>
<li>Zakhar Zhuravlev 2018-04-10

   Thank you very much.
   It works with "hooks" directory at the root. But it works only with cleaned project. On the second build I get error:
   <code><pre>
   [ERROR] An error occurred during build after 1m 6s 429ms
   [ERROR] Failed to install app on device (0xe8000067)
   [ERROR] For some reason the app failed to install on the device. Try reconnecting your device and check your provisioning profile and entitlements.
   </pre></code>
   
   after "appc ti clean" it works again, but build takes a lot of time with this hook. Approx 3-4 min. </li>
<li>Chris Barber 2018-04-11

   Clean builds are pretty slow. If you change the VALID_ARCHS, then it's probably building each source file multiple times for the various architectures. We used to build for all architectures, but I changed it to ONLY_ACTIVE_ARCH=1 since it didn't make sense to compile for i386 and x64 for simulator builds.
   
   I'm not sure what your hook is changing since I haven't seen the code, but I don't understand why it would break subsequent builds. Maybe our differential build logic doesn't properly detect or handle the derived data when there are extra compiled architectures? Hard to say without testing it myself.</li>
<li>Zakhar Zhuravlev 2018-04-11

   Thank you for help, Chris.
   my code:
   
   <code><pre>
   'use strict';
   
   exports.cliVersion = '>=3.2';
   exports.init = init;
   
   function init(logger, config, cli, appc) {
   	cli.on('build.ios.xcodeproject', {
   		pre: function(data) {
   
               var xobjs = data.args[0].hash.project.objects;
   			Object.keys(xobjs.PBXNativeTarget).forEach(function (targetUuid) {
   				var target = xobjs.PBXNativeTarget[targetUuid];
   				if (target && typeof target === 'object') {
   					xobjs.XCConfigurationList[target.buildConfigurationList].buildConfigurations.forEach(function (buildConf) {
   						var buildSettings = xobjs.XCBuildConfiguration[buildConf.value].buildSettings;
                           buildSettings.VALID_ARCHS = "arm64";
   					});
   				}
   			});
   
   		}
   	});
   }
   
   </pre></code>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-25520.json">JSON Source</a></p>