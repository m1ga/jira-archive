---
title: "[TIMOB-25680] iOS 11.2: DocumentViewer not displaying PDF files (Apple regression)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-01-23T16:44:58.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.0.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.0.2</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>applebug, documentViewer, ios</td></tr>
<tr><th>Reporter</th><td>Motiur Rahman</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2018-01-17T02:01:12.000+0000</td></tr>
<tr><th>Updated</th><td>2018-01-24T16:22:40.000+0000</td></tr>
</table>

<h3>Description</h3>

Issue
Using DocumentViewer on iOS 11.2.X  is not rendering PDF files.

Steps to repro
1. Just run the following test code 
2. At first, place a pdf file in the resource directory.

Expected result:
 .pdf file should show in the DocumentViewer.

Actual result:
 .pdf file is not being shown by the DocumentViewer.

<code><pre>
var win = Ti.UI.createWindow();

// Create a document viewer to preview a PDF file
docViewer = Ti.UI.iOS.createDocumentViewer({
  url : 'example.pdf'
});

docViewer.show();
win.open();

</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25680_63974/example.pdf">example.pdf</td></td><td>2018-01-17T09:45:54.000+0000</td><td>433994</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-01-17

   *EDIT*: There seems to be a breaking change in 11.2 that developers came across (known iOS issue). Basically, iOS 11.2 required developers to copy the PDF to the temporary- or application-support directory before using. Read more about it [here](<a href="https://forums.developer.apple.com/thread/91835)." rel="nofollow" target="_blank">https://forums.developer.apple.com/thread/91835).</a>
   
   We will:
   <h4>File a radar at Apple to provide a fix</h4>
   <h4>Provide a workaround (eventually in both JS and the SDK, so an SDK-update won't necessarily required to workaround this issue)</h4>
   
   Tested with all possible combinations (main-thread, kroll-thread, jscore, ticore) and it works fine. My example code:
   <code><pre>
   var win = Ti.UI.createWindow({
     backgroundColor: '#fff'
   });
   
   var btn = Ti.UI.createButton({
     title: 'Open PDF'
   });
   
   btn.addEventListener('click', function(e) {
     var docViewer = Ti.UI.iOS.createDocumentViewer({
       url : 'example.pdf'
     });
    
     docViewer.show();
   });
   
   win.add(btn);
   win.open();
   </pre></code>
   
   I've also attached my sample PDF file that worked fine. As a side-note: We haven't touched the DocumentViewer API for years, since it's a simple interface which we completely expose already.</li>
<li>Hans Knöchel 2018-01-17

   <h4>Update</h4>
   
   Here is the workaround for the iOS issue, together with detailed documentation about what is happening:
   
   <code><pre>
   var win = Ti.UI.createWindow({
     backgroundColor: '#fff'
   });
   
   var btn = Ti.UI.createButton({
     title: 'Open PDF'
   });
   
   btn.addEventListener('click', openPDF);
   
   win.add(btn);
   win.open();
   
   // Open the PDF file
   function openPDF() {
     var fileName = 'example.pdf';
     
     // For iOS 11.2, workaround the Apple issue by creating a temporary file and
     // reference it. It will be removed from filesystem once the app closes.
     // Read more here: <a href="http://nshipster.com/nstemporarydirectory/" rel="nofollow" target="_blank">http://nshipster.com/nstemporarydirectory/</a>
     if (isiOS11_2()) {
       fileName = fileInTemporaryDirectory(fileName);
     }
     
     var docViewer = Ti.UI.iOS.createDocumentViewer({
       url: fileName
     });
    
     docViewer.show();
   }
   
   // Check if the current device runs iOS 11.2+
   function isiOS11_2() {
   	var version = Ti.Platform.version.split(".");	
   	return (parseInt(version[0]) &gt;= 11 && parseInt(version[1]) &gt;= 2);
   }
   
   // Create a temporary file with the contents of the old file
   // Expects the file to be in the resources directory. If you receive the file 
   // from an API-call, receive pass the Ti.Blob/Ti.File/text to "write" directly.
   function fileInTemporaryDirectory(fileName) {
     var file = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, fileName);
     
     if (!file.exists()) {
       alert('File does not exist in resources!');
       return;
     }
     
     var newFile = Titanium.Filesystem.getFile(Ti.Filesystem.tempDirectory, fileName);
     newFile.createFile();
     
     if (!newFile.exists()) {
       alert('New file could not be created in temporary directory!');
       return;
     }
     
     newFile.write(file);
     
     return newFile.nativePath;
   }
   </pre></code>
   
   Basically, we create a temporary file in /tmp that will be flushed once the app is closed, so it doesn't effect the device's storage. Keeping this issue open to also provide an SDK workaround that detects the type of path provided and fixes it internally. Hopefully iOS fixes this issue in iOS 11.2.x, but let's try to keep as flexible as possible.</li>
<li>Hans Knöchel 2018-01-17

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/9741" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9741</a>
   PR (7_0_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/9742" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9742</a>
   
   Test-Case:
   <h4>Run the above test-case and remove the comment out the <code>isiOS11_2()</code> check. Without this line, the PDF will not be displayed</h4>
   <h4>Comment it in the line if-statement again. It should now work, even with the old SDK (master/7.0.1)</h4>
   <h4>Now uninstall the app, use the PR and repeat steps 1 und 2. They should still display the file without issues</h4>
   
   </li>
<li>Eric Wieber 2018-01-23

   FR Passed. Workaround is working as designed. Document viewer is able to display PDF files in iOS 11.X</li>
<li>Eric Wieber 2018-01-24

   Verified in SDK builds 7.0.2.v20180123170142 & 7.1.0.v20180124063413</li>
</ol>


<p><a href="/TIMOB/TIMOB-25680.json">JSON Source</a></p>