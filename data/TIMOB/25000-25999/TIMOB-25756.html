---
title: "[TIMOB-25756] Android: Restart app on system locale change"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-11-09T21:06:26.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, android:configChanges, locale</td></tr>
<tr><th>Reporter</th><td>Jorge Macias Garcia</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2017-12-19T11:53:17.000+0000</td></tr>
<tr><th>Updated</th><td>2018-11-15T07:31:08.000+0000</td></tr>
</table>

<h3>Description</h3>

Apps in Titanium doesn't restart the activities when locale config has changed and the broadcast event is fired.

From the documentation:

<a href="https://developer.android.com/guide/topics/manifest/activity-element.html#config" rel="nofollow" target="_blank">https://developer.android.com/guide/topics/manifest/activity-element.html#config</a>

"Locale" The locale has changed; the user selected a new text language.

As you can see in the documentation page. If android:configChanges are added to the manifest in an activity block is the app who should handle this changes. If not, the app is restarted by default (as expected).

I found this broadcast handler in the titanium source code but the behaviour isn't as expected.

Adding 'locale' to android:configChange doesn't works.

Generated and modified manifest (adding locale to android:configChanges):

<code><pre>
		&lt;activity android:name=".AppTestActivity" android:label="@string/app_name" android:theme="@style/Theme.Titanium" android:configChanges="keyboardHidden|orientation|fontScale|screenSize|smallestScreenSize|screenLayout|density|locale"&gt;
			&lt;intent-filter&gt;
				&lt;action android:name="android.intent.action.MAIN"/&gt;
				&lt;category android:name="android.intent.category.LAUNCHER"/&gt;
			&lt;/intent-filter&gt;
		&lt;/activity&gt;
</pre></code>

I've tried removing android:configChanges attribute in my custom manifest to get the default behaviour but it is added again.

By default the generated manifest by Titanium has the android:configChanges flag enabled with custom properties. It's Titanium who handles this changes.


TEST APP:

Languages: en, es

Expected behaviour: Settings > Languages > Change language > Come back to app > Activity has been restarted with new language
Current behaviour: Settings > Languages > Change language > Come back to app > Activity hasn't been restarted with new language

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25756_63873/android-lang-behaviour.gif">android-lang-behaviour.gif</td></td><td>2018-01-02T09:57:13.000+0000</td><td>1030671</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25756_64805/android-restart-app-when-language-changed.gif">android-restart-app-when-language-changed.gif</td></td><td>2018-02-05T07:29:29.000+0000</td><td>1817156</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25756_63874/app.zip">app.zip</td></td><td>2018-01-02T09:57:49.000+0000</td><td>7124503</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25756_65842/locale_8.1.gif">locale_8.1.gif</td></td><td>2018-11-09T21:03:44.000+0000</td><td>552702</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2017-12-27

   Hello, Please provide a full reproducible code for us to test. Thanks.</li>
<li>Mostafizur Rahman 2018-01-02

   Hello [~jormagar],
   
   Are you able to sorted this out? If not ,please provide a sample test code to reproduce the issue on our end?
   
   
   Best </li>
<li>Jorge Macias Garcia 2018-01-02

   @Mostafizur Rahman, @Sharif AbuDarna, sorry for the delay. Just updated the ticket.
   </li>
<li>Sharif AbuDarda 2018-02-04

   Hello, With the sample code you provided I wasn't able to reproduce the issue with Android 8.0.0. In SDK 7.0.1.GA. With language change, activity has been restarted with new language. Thanks.</li>
<li>Jorge Macias Garcia 2018-02-05

    !android-restart-app-when-language-changed.gif! 
   
   I recompiled the test app with latest sdk 7.0.1 with Android 8 sim and it's not working. As you can see in the attached gif, you need to kill the app and open it again to get working the changed language.
   
   On iOS platform it is done on the air and not need to kill / restart the app to see the new language.
   
   The right behaviour on Android would be:
   
   - Open app and leave the app on background
   - Go to settings and change language
   - Come back to your running app from recent tasks.
   - App should be restarted by system.</li>
<li>Gary Mathews 2018-03-15

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/9937" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9937</a></li>
<li>Christopher Williams 2018-05-14

   I think given that the PR is still marked a work in progress that this won't make the cut for 7.2.0. Bumping to 7.3.0 for now.</li>
<li>Lokesh Choudhary 2018-09-27

   FR Passed.</li>
<li>Lokesh Choudhary 2018-10-15

   PR Merged.</li>
<li>Keerthi Mahalingam 2018-10-16

    Verified the fix on SDK 7.5.0.v20181015122219 .Works fine. Closing
    <code><pre> 
    Operating System
      Name                        = Mac OS X
      Version                     = 10.13.6
      Architecture                = 64bit
    Node.js
      Node.js Version             = 8.9.1
      npm Version                 = 5.5.1
    Titanium CLI
      CLI Version                 = 5.1.1
    Titanium SDK
      SDK Version                 =7.5.0.v20181015122219
    Device			      =Pixel 2 xl android 8 emulator
    </pre></code></li>
<li>Jorge Macias Garcia 2018-11-09

    It doesn't works fine... test app crashes on Android 8.1 simulator.
    
    Steps:
    
    1. Open test app and send it to background pressing on home button.
    2. Open language settings and set spanish to main language
    3. Open recent apps and select test app, it is restarted as expected. It could work or not.
    
    See attached new GIF
    
    
    
    </li>
<li>Jorge Macias Garcia 2018-11-09

    [Locale changed not solved](<a href="http://personales.upv.es/jormagar/gif/locale_changed_still_fail.gif)" rel="nofollow" target="_blank">http://personales.upv.es/jormagar/gif/locale_changed_still_fail.gif)</a></li>
<li>Lokesh Choudhary 2018-11-09

    [~jormagar], App will soft restart only when there is no locale change event listener. This is by design. I tried but not able to repro the crash.
     !locale_8.1.gif! </li>
<li>Lokesh Choudhary 2018-11-09

    Had reopened to add a gif.</li>
<li>Jorge Macias Garcia 2018-11-10

    You are not trying what I'm reporting.
    
    Follow the steps to get the crash please.</li>
<li>Yordan Banev 2018-11-12

    [~lchoudhary] Can you check what the value of <code>run-on-main-thread</code> in tiapp.xml is in the application you ran? I was able to reproduce the crash with it when the property is set to false.</li>
<li>Lokesh Choudhary 2018-11-13

    [~ybanev], I have it set to <code>true</code>
    <code><pre>
    &lt;property name="run-on-main-thread" type="bool"&gt;true&lt;/property&gt;
    </pre></code></li>
<li>Jorge Macias Garcia 2018-11-15

    @lchoudhary set it to false and see what happens with the app testing again the use case. You will check how it crashes.</li>
</ol>


<p><a href="/TIMOB/TIMOB-25756.json">JSON Source</a></p>