---
title: "[TIMOB-25762] iOS 11.3 beta:  Loading HTML in Webview errors when accessing EventListener"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-02-26T23:05:47.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 5.5.1, Release 6.3.0, Release 7.0.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.1.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>applebug, injection, webview</td></tr>
<tr><th>Reporter</th><td>Victor Vazquez Montero</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2018-02-08T19:51:48.000+0000</td></tr>
<tr><th>Updated</th><td>2018-04-23T11:15:24.000+0000</td></tr>
</table>

<h3>Description</h3>

*Issue*
In the app they have a signature drawing controller, which loads signature.html in webview. The html has Ti.App.addEventListener & Ti.App.fireEvent to communicate between webview and controller. HTML gives error on Ti accessing in html. This is happening in iOS 11.3 beta 1 & beta 2. 

Code works fine on iOS 11.2 and earlier

*Steps to recreate:*
download TestiOSBeta
run project on simulator for iOS 11.3 

*Expected results:*
Drawable canvas and text turn green.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25762_64835/Error.rtf">Error.rtf</td></td><td>2018-02-08T19:50:41.000+0000</td><td>5979</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25762_64833/iOS11.2.png">iOS11.2.png</td></td><td>2018-02-08T19:50:54.000+0000</td><td>42881</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25762_64834/iOS11.3.png">iOS11.3.png</td></td><td>2018-02-08T19:50:54.000+0000</td><td>64162</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25762_64889/test_webview_native.zip">test_webview_native.zip</td></td><td>2018-02-23T10:08:41.000+0000</td><td>42814</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25762_64836/TestIOSBeta.zip">TestIOSBeta.zip</td></td><td>2018-02-08T19:50:38.000+0000</td><td>10009955</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-02-09

   We need to
   * file a bug at Apple as this is a breaking change in a non-major version (nogo). Maybe the fix it before releasing the 11.3 GA
   * Find out what's going on there. I suspect the evaluation may have changed
   * Fix it. Maybe do a 7.0.3 for this in case Apple does not fix it
   
   Test-Case:
   
   *app.js*
   <code><pre>
   var win = Ti.UI.createWindow();
   
   var webView = Ti.UI.createWebView({
   	url: 'test.html'
   });
   
   Ti.App.addEventListener('test', function(event) {
   	alert(event);
   });
   
   win.add(webView);
   win.open();
    
   </pre></code>
   
   *test.html*
   <code><pre>
   &lt;html&gt;
   &lt;head&gt;
   	&lt;script type="text/javascript"&gt;
   		function testEvent() {
   			Ti.App.fireEvent('test', { hello: 'world' });
   		}
   	&lt;/script&gt;
   &lt;/head&gt;
   &lt;body&gt;
   	&lt;button style="margin: 100px;" onclick="testEvent()"&gt;Trigger&lt;/button&gt;
   &lt;/body&gt;
   &lt;/html&gt;
   </pre></code></li>
<li>Hans Knöchel 2018-02-10

   I've files radar #37423632 at Apple to be hopefully followed up soon.</li>
<li>Dan Wilson 2018-02-20

   No fix in the 11.3 beta 3 released today. I'm getting worried that they GA 11.3 and it will break all my existing installs out there with no remedy.
   
   Any movement/acknowledgment on Apple's end?</li>
<li>Anthony Chung 2018-02-21

   This is going to break our apps as well.
   Do you know if this is with webview and wkwebview? 
   
   </li>
<li>Hans Knöchel 2018-02-21

   We are in dialog with Apple to resolve this. It looks like they did not know about the issue before. I will update this issue once we have an update.</li>
<li>Toru 2018-02-23

   Our app also has the same problem.
   It seems the script can not access Ti object at all.
   I am waiting for the update.</li>
<li>Vijay Singh 2018-02-23

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/9877" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9877</a>
   PR (7_1_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/9878" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9878</a>
   
   Note - We should follow to apple to get it fixed from their side also.</li>
<li>Hans Knöchel 2018-02-23

   Apple is investigating our native test case (also attached as "test_webview_native.zip" to this ticket) right now. If they are really not able to fix this in iOS 11.3, we have a workaround ready to be put in the next release. 
   
   You can also apply the above pull request to your current SDK by modifying the "TiUIWebView.m" with the one of the ticket. Please let us know if that works for all of you guys! In addition, I will provide a custom 7.0.2 SDK that is the current GA + this fix. Thanks everyone!
   
   *EDIT*: Custom 7.0.3 build that is basically 7.0.2.GA + the above pull request ~ [Download](<a href="https://www.dropbox.com/s/yqgo91mkpuemc3y/mobilesdk-7.0.3-osx.zip?dl=1)" rel="nofollow" target="_blank">https://www.dropbox.com/s/yqgo91mkpuemc3y/mobilesdk-7.0.3-osx.zip?dl=1)</a></li>
<li>Dan Wilson 2018-02-23

   Hans, I was able to install your modified 7.0.3 build. It actually broke some things on iOS 11.2. I use socket.io within a hidden webview within my application (don't ask -- it's legacy code). 7.0.3 breaks when I call the socket.io connect method. No error message. Just appears to stop processing. 
   
   However, 7.0.3 on 11.3.beta3 gets further than it did before. Previously, it didn't even appear to be loading the local html file. Now, it gets to the same point as 11.2 with the same behavior.</li>
<li>Hans Knöchel 2018-02-23

    [~killroyboy] Some follow up questions then:
    * Did the socket.io implementation work on iOS 11.2 before? If so, can you give an example?
    * What's the exact error message with socket.io now?
    * You said "some things", but only stated the socket.io one, what else?
    
    We could eventually only apply the fix for iOS 11.3 (although the Ti.App.fireEvent tests also passed on 11.2), but if you say that it even breaks 11.2, it's looks like a weird behavior, because iOS 11.2 should be unaffected by this. </li>
<li>Dan Wilson 2018-02-23

    @hknochel Thanks for the response.
    
    1) Yes. The app works fine with 11.2 and 7.0.1.GA. Once I switch to 7.0.3, it fails to connect. I'll try to put together an example.
    2) There is no error message. It just doesn't connect and stops processing the javascript in the html file.
    3) Sorry to be imprecise. The socket.io problem was the only problem I experienced because my entire app is dependent on that socket.io connection.</li>
<li>Hans Knöchel 2018-02-24

    [~killroyboy] Interesting, interesting. Would you mind trying [this build](<a href="https://www.dropbox.com/s/mx0d4naj7rcdw50/mobilesdk-7.0.3-r2-osx.zip?dl=0)" rel="nofollow" target="_blank">https://www.dropbox.com/s/mx0d4naj7rcdw50/mobilesdk-7.0.3-r2-osx.zip?dl=0)</a> to see if it makes a difference? And we definitely need your test case.</li>
<li>Toru 2018-02-24

    Hans, I have tried your builds.
    
    - 7.0.3 r1 with 11.3: Ti object is available, but an error occurs because html does not read external scripts.
    - 7.0.3 r2 with 11.3: It worked fine!
    
    I confirmed that it works well at least in my environment. Great!
    </li>
<li>Hans Knöchel 2018-02-24

    [~toru] That are great news! r2 uses a different approach. [~vijaysingh] Can you update your PR to match my changes or should I file an own one? In any way, this is going into 7.1.0 which is planned for the next weeks. In addition, developers who don't trust Apple to fix the actual issue can use the 7.0.3 build right now. Thanks everyone! </li>
<li>Dan Wilson 2018-02-24

    Hans, I can also confirm that r2 fixed both 11.2 and 11.3 issues for me.
    
    Thanks so much!</li>
<li>Vijay Singh 2018-02-25

    [~hknoechel] I have updated master PR. Can you please update 7_1_X PR. Thanks!</li>
<li>Hans Knöchel 2018-02-25

    All updated!</li>
<li>Eric Wieber 2018-02-26

    FR Passed. HTML does not error in webview when accessing eventListener. Tested using provided sample code, webview suite, and confirming customer responses</li>
<li>Eric Wieber 2018-02-28

    Verified changes are included in SDK builds: 7.1.0.v20180227113527 & 7.2.0.v20180228075644</li>
<li>Anthony Chung 2018-03-01

    [~hknoechel]
    
    How can I install 7.0.3 r2?
    
    I tried appc ti sdk install --branch 7_1_X -d
    but too bleeding edge for me.
    
    I have tried
    appc ti sdk install --branch 7_0_X -d
    
    but is 7.0.3 r2 a specific one?
    
    </li>
<li>Vijay Singh 2018-03-01

    [~threethirds] This change will go in 7.1.0. But you can download it from [here](<a href="https://www.dropbox.com/s/mx0d4naj7rcdw50/mobilesdk-7.0.3-r2-osx.zip?dl=0)." rel="nofollow" target="_blank">https://www.dropbox.com/s/mx0d4naj7rcdw50/mobilesdk-7.0.3-r2-osx.zip?dl=0).</a>  Thanks!</li>
<li>Anthony Chung 2018-03-01

    thanks [~vijaysingh]. appreciate it.</li>
<li>Jignesh Kasundra 2018-04-23

    Hans Knöchel added a comment - 10/Feb/18 9:50 AM
    I've files radar #37423632 at Apple to be hopefully followed up soon.
    
    
    <<< where can I check the status of ticket? I've checked at <a href="https://openradar.appspot.com" rel="nofollow" target="_blank">https://openradar.appspot.com</a> but couldn't find the radar no (#37423632).</li>
<li>Hans Knöchel 2018-04-23

    [~jignesh.igp] <code>37423632</code> is the Apple bug reporter ID. I've just added it to my list of radars on AppSpot: <a href="https://openradar.appspot.com/radar?id=5035922554880000" rel="nofollow" target="_blank">https://openradar.appspot.com/radar?id=5035922554880000</a></li>
<li>Jignesh Kasundra 2018-04-23

    okay. thanks Hans Knöchel</li>
</ol>


<p><a href="/TIMOB/TIMOB-25762.json">JSON Source</a></p>