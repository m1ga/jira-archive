---
title: "[TIMOB-25766] Android: Ti.Utils.base64encode for cannot encode (Image) Ti.Blob anymore. Result = null"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-02-09T19:53:54.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.0.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.0.2</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>regression</td></tr>
<tr><th>Reporter</th><td>Muhammad Ahmed Fahad</td></tr>
<tr><th>Assignee</th><td>Hans Kn√∂chel</td></tr>
<tr><th>Created</th><td>2018-02-09T09:00:47.000+0000</td></tr>
<tr><th>Updated</th><td>2018-02-12T02:25:16.000+0000</td></tr>
</table>

<h3>Description</h3>

Ti SDK: 7.0.2.v20180207091331
Device: Samsung Galaxy S8+
Android: 7.0.0

Works fine with Ti SDK 7.0.1.GA

Test Case: 

<code><pre>
  Ti.Media.showCamera({
    success:function(event) {
      if(event.mediaType === Ti.Media.MEDIA_TYPE_PHOTO) {
        var image = event.media;

        Ti.API.info(Ti.Utils.base64encode(image).text);
      }
    },
    cancel:function() {
    },
    error:function(err) {
      Ti.API.error(err);
    },
    mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO]
  });
</pre></code>

Expect Output: A random encoded string

Actual output: Uncaught TypeError: Cannot read property 'text' of null

<h3>Comments</h3>

<ol>
<li>Muhammad Ahmed Fahad 2018-02-09

   Please try to fix this issue before releasing 7.0.2</li>
<li>Ewan Harris 2018-02-09

   [~fahad86] Thanks for the ticket, I'll move this across to TIMOB
   
   Able to reproduce this issue using
   
   SDK: 7.0.2.v20180207091331
   One Plus 3 7.1.1
   
   This does not occur using SDK 7.0.2.v20180207022213 so the cause appears to be TIMOB-25727
   
   Full code include permissions handling
   
   <code><pre>
   var win = Ti.UI.createWindow();
   win.open();
   
   function takePhoto() {
       Ti.Media.showCamera({
           mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO],
           success: function(event) {
               console.log(event);
               if(event.mediaType === Ti.Media.MEDIA_TYPE_PHOTO) {
                   var image = event.media;
                   Ti.API.info(Ti.Utils.base64encode(image))
                   Ti.API.info(Ti.Utils.base64encode(image).text);
               }
           },
           error: function(e) {
           },
           cancel: function(e) {
           }
       });
   }
   
   
   win.addEventListener('click', () =&gt; {
       var hasCameraPermissions = Ti.Media.hasCameraPermissions();
   
       if (hasCameraPermissions) {
           takePhoto();
       }
   
       Ti.Media.requestCameraPermissions(function(e) {
           takePhoto();
       });
   });
   </pre></code>
   
   <h4>Steps to reproduce</h4>
   
   <h4>Build to Android</h4>
   <h4>Tap screen </h4>
   <h4>Take photo</h4>
   
   <h4>Actual</h4>
   
   Code throws error
   
   <code><pre>
   [INFO]  {"y":0,"x":0,"width":2610,"height":4640,"media":{"height":4640,"type":1,"mimeType":"image/jpeg","text":null,"nativePath":"file:///data/user/0/com.appc.test/app_appdata/tia1518182936027.jpg","width":2610,"length":1720147,"file":{"writable":true,"executable":false,"nativePath":"file:///data/user/0/com.appc.test/app_appdata/tia1518182936027.jpg","name":"tia1518182936027.jpg","symbolicLink":false,"size":1720147,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":true,"executable":false,"nativePath":"file:///data/user/0/com.appc.test/app_appdata","name":"app_appdata","symbolicLink":false,"size":4096,"directoryListing":["tia1518182119535.jpg","tia1518182257927.jpg","tia1518182339714.jpg","tia1518182791965.jpg","tia1518182936027.jpg"],"hidden":false,"readonly":false,"parent":{"writable":true,"executable":false,"nativePath":"file:///data/user/0/com.appc.test","name":"com.appc.test","symbolicLink":false,"size":4096,"directoryListing":["cache","files","databases","shared_prefs","no_backup","app_appdata","code_cache"],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///data/user/0","name":"0","symbolicLink":false,"size":12288,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///data/user","name":"user","symbolicLink":false,"size":4096,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///data","name":"data","symbolicLink":false,"size":4096,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///","name":"","symbolicLink":false,"size":1360,"directoryListing":[],"hidden":false,"readonly":false,"parent":null,"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Blob","bubbleParent":true},"mediaType":"public.image","code":0,"cropRect":{"height":4640,"width":2610,"y":0,"x":0},"success":true}
   [INFO]  null
   [ERROR] TiExceptionHandler: (main) [4238,4238] ----- Titanium Javascript Runtime Error -----
   [ERROR] TiExceptionHandler: (main) [0,4238] - In /app.js:1,317
   [ERROR] TiExceptionHandler: (main) [0,4238] - Message: Uncaught TypeError: Cannot read property 'text' of null
   [ERROR] TiExceptionHandler: (main) [0,4238] - Source: var win=Ti.UI.createWindow();win.open();function takePhoto(){Ti.Media.showCamera({mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO],success:function(event){if(console.log(event),event.mediaType===Ti.Media.MEDIA_TYPE_PHOTO){var image=event.media;Ti.API.info(Ti.Utils.base64encode(image)),Ti.API.info(Ti.Utils.base64encode(image).text)}},error:function(e){},cancel:function(e){}})}win.addEventListener('click',()=&gt;{var hasCameraPermissions=Ti.Media.hasCameraPermissions();hasCameraPermissions&&takePhoto(),Ti.Media.requestCameraPermissions(function(e){takePhoto()})});
   </pre></code>
   
   <h4>Expected</h4>
   
   Logging like the below
   <code><pre>
   [INFO]  {"y":0,"x":0,"width":2610,"height":4640,"media":{"height":4640,"type":1,"mimeType":"image/jpeg","text":null,"nativePath":"file:///data/user/0/com.appc.test/app_appdata/tia1518182339714.jpg","width":2610,"length":1668017,"file":{"writable":true,"executable":false,"nativePath":"file:///data/user/0/com.appc.test/app_appdata/tia1518182339714.jpg","name":"tia1518182339714.jpg","symbolicLink":false,"size":1668017,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":true,"executable":false,"nativePath":"file:///data/user/0/com.appc.test/app_appdata","name":"app_appdata","symbolicLink":false,"size":4096,"directoryListing":["tia1518182119535.jpg","tia1518182257927.jpg","tia1518182339714.jpg"],"hidden":false,"readonly":false,"parent":{"writable":true,"executable":false,"nativePath":"file:///data/user/0/com.appc.test","name":"com.appc.test","symbolicLink":false,"size":4096,"directoryListing":["cache","files","databases","shared_prefs","no_backup","app_appdata","code_cache"],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///data/user/0","name":"0","symbolicLink":false,"size":12288,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///data/user","name":"user","symbolicLink":false,"size":4096,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///data","name":"data","symbolicLink":false,"size":4096,"directoryListing":[],"hidden":false,"readonly":false,"parent":{"writable":false,"executable":false,"nativePath":"file:///","name":"","symbolicLink":false,"size":1360,"directoryListing":[],"hidden":false,"readonly":false,"parent":null,"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Proxy","bubbleParent":true},"apiName":"Ti.Blob","bubbleParent":true},"mediaType":"public.image","code":0,"cropRect":{"height":4640,"width":2610,"y":0,"x":0},"success":true}
   [INFO]  /9j/4QgHRXhpZgAATU0AKgAAAAgACgEPAAIAAAAIAAAAhgEQAAIAAAAOAAAAjgEaAAUAAAABAAAAnAEbAAUAAAABAAAApAEoAAMAAAABAAIAAAExAAIAAAAoAAAArAEyAAIAAAAUAAAA1AITAAMAAAABAAEAAIdpAAQAAAABAAAA6IglAAQAAAABAAAC5gAAAwBPbmVQbHVzAE9ORVBMVVMgQTMwMDMAAAAASAAAAAEAAABIAAAAAU9uZVBsdXMzLXVzZXIgNy4xLjEgTk1GMjZGIDExNCBkZXYta2V5cwAyMDE4OjAyOjA5IDEzOjE4OjU4AAAdgpoABQAAAAEAAAJKgp0ABQAAAAEAAAJSiCIAAwAAAAEAAAAAiCcAAwAAAAEZAAAAkAAABwAAAAQwMjIwkAMAAgAAABQAAAJakAQAAgAAABQAAAJukQEABwAAAAQBAgMAkgEACgAAAAEAAAKCkgIABQAAAAEAAAKKkgMACgAAAAEAAAKSkgcAAwAAAAEAAwAAkgkAAwAAAAEAEAAAkgoABQAAAAEAAAKaknwABwAAAA4AAAKikpAAAgAAAAcAAAKwkpEAAgAAAAcAAAK4kpIAAgAAAAcAAALAoAAABwAAAAQwMTAwoAEAAwAAAAEAAQAAoAIABAAAAAEAAAoyoAMABAAAAAEAABIgoAUABAAAAAEAAALHohcAAwAAAAEAAgAAowEABwAAAAEBAAAApAIAAwAAAAEAAAAApAMAAwAAAAEAAAAApAUAAwAAAAEAHAAApAYAAwAAAAEAAAAAAAAAAAAAAAEAAAARAAAAyAAAAGQyMDE4OjAyOjA5IDEzOjE4OjU4ADIwMTg6MDI6MDkgMTM6MTg6NTgAAAAP2gAAA+gAAADIAAAAZAAAAAAAAABkAAABqgAAAGRNTQAqAAAACAAAAAAAADk2MzU2NQAAOTYzNTY1AAA5NjM1NjUAAAIAAQACAAAABFI5OAAAAgAHAAAABDAxMDAAAAAAAAABAAUABQAAAAEAAAL4AAAAAAAAAMgAAABkAAYBAwADAAAAAQAGAAABGgAFAAAAAQAAA04BGwAFAAAAAQAAA1YBKAADAAAAAQACAAACAQAEAAAAAQAAA14CAgAEAAAAAQAABKEAAAAAAAAASAAAAAEAAABIAAAAAf/Y/9sAhAAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQyAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAEAAJADASIAAhEBAxEB/8QBogAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoLEAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+foBAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKCxEAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDwOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACikpaACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKSloAKKKKACiiigAooooASloooAKKKKACiiigAooooAKKKKACkpaKACiikoAWiiigAooooAKKSloAKKSloAKKKKACiiigAoopKAFooooAKKKKACiiigAopKWgAooooAKKKKACiiigAooooAKKKKACiiigApKWigAooooAKKKSgBaKKKACiiigAooooAKKKKACiiigAooooAKSlpKAFooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACilpKACilpKACiiigAooooAKKKKACiiigAoopaAEooooAKKKWgAooooASloooASiiigAooooAKKKKACiiigApaKKACiiigA7UUUUAFFFFABRRRQAlFFFABRRRQAUtJRQAUtFFABR2oooAKKKO1ABRRRQAUUUUDCiiigBO1FFFAgooooAKWkpaAEpaKKACiiigAooooAKKKKBi0UUUAFFFFAH//2f/k//9RdWFsY29tbSBDYW1lcmEgRGVidWcABQIAAgUAAgACAAAAUUNUVU4ABAAAAAkDAABRQ0FFQwBCEAAAEBETAO/0AADvdAEAAAAAAAAAAAC1ewEAEBETAACZDQAAEJYBDQIAAAEAAwAeAAgAAQCABzgEQCUAAPBA5hJiPqwTX+oAAPBA5hJg6gAA///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
   </pre></code></li>
<li>Hans Kn√∂chel 2018-02-09

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/9813" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9813</a>
   7_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/9812" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9812</a></li>
<li>Joshua Quick 2018-02-09

   I see what was wrong. The issue was that the image blob's byte array was being transcoded from UTF-8 to UTF-16, which changed the binary before being base64 encoded. The old way of calling TiBlob.toBase64() would have preserved the original bytes.</li>
<li>Lokesh Choudhary 2018-02-09

   FR Passed & verified the fix in SDK 7.0.2.v20180209105903.
   
   Studio Ver:     5.0.0.201712081732
   SDK Ver:        7.0.2.v20180209105903
   OS Ver:         10.13.2
   Xcode Ver:      Xcode 9.2
   Appc NPM:       4.2.12-3
   Appc CLI:       7.0.2-master.8
   Daemon Ver:     1.0.1
   Ti CLI Ver:     5.0.14
   Alloy Ver:      1.11.0
   Node Ver:       8.9.1
   NPM Ver:        5.5.1
   Java Ver:       1.8.0_101
   Devices:        ‚á® google Nexus 5 --- Android 6.0.1
                   ‚á® google Nexus 6P --- Android 7.1.2</li>
<li>Lokesh Choudhary 2018-02-09

   Master FR done & merged.</li>
<li>Lokesh Choudhary 2018-02-09

   Verified the fix with SDK 7.1.0.v20180209115809.
   
   Closing.
   
   Studio Ver:     5.0.0.201712081732
   OS Ver:         10.13.2
   Xcode Ver:      Xcode 9.2
   Appc NPM:       4.2.12-3
   Appc CLI:       7.0.2-master.8
   Daemon Ver:     1.0.1
   Ti CLI Ver:     5.0.14
   Alloy Ver:      1.11.0
   Node Ver:       8.9.1
   NPM Ver:        5.5.1
   Java Ver:       1.8.0_101
   Devices:        ‚á® google Nexus 5 --- Android 6.0.1
                   ‚á® google Nexus 6P --- Android 7.1.2
   </li>
<li>Muhammad Ahmed Fahad 2018-02-12

   Thanks all for the quick fix.</li>
</ol>


<p><a href="/TIMOB/TIMOB-25766.json">JSON Source</a></p>