---
title: "[TIMOB-25782] Cannot Access Google Fit Read Result"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Hyperloop</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Yanko Valera</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2018-02-06T17:18:19.000+0000</td></tr>
<tr><th>Updated</th><td>2018-04-05T09:36:07.000+0000</td></tr>
</table>

<h3>Description</h3>

While trying to access Google Fit History data, the onSuccess is called, but the DataReadResponse methods can't be successfully called to retrieve data.

Test code:


<code><pre>
Fitness.getHistoryClient(windowActivity, GoogleSignIn.getLastSignedInAccount(windowActivity))
        .readData(new DataReadRequest.Builder()
            // The data request can specify multiple data types to return, effectively
            // combining multiple data queries into one call.
            // In this example, it's very unlikely that the request is for several hundred
            // datapoints each consisting of a few steps and a timestamp.  The more likely
            // scenario is wanting to see how many steps were walked per day, for 7 days.
            .aggregate(DataType.TYPE_STEP_COUNT_DELTA, DataType.AGGREGATE_STEP_COUNT_DELTA)
            // Analogous to a "Group By" in SQL, defines how data should be aggregated.
            // bucketByTime allows for a time span, whereas bucketBySession would allow
            // bucketing by "sessions", which would need to be defined in code.
            .bucketByTime(1, TimeUnit.DAYS)
            .setTimeRange(startTime, endTime, TimeUnit.MILLISECONDS)
            .build())
        .addOnSuccessListener(new OnSuccessListener({
            onSuccess: function(e) {
                var dataResponse = new DataReadResponse(e);

                console.log("onSuccess()" + e.toString() + "/" + dataResponse.toString());
                console.log("buckets size: " + dataResponse.getDataSets().size());
            }
        }))
        .addOnFailureListener(new OnFailureListener({
            onFailure: function(e) {
                console.log("onFailure()");
            }
        }));
</pre></code>


This error is happening 
[INFO]  onSuccess()com.google.android.gms.fitness.result.DataReadResponse@645f427/com.google.android.gms.fitness.result.DataReadResponse@95706d4

[WARN]  W/System.err: java.lang.NullPointerException: Attempt to invoke virtual method 'java.util.List com.google.android.gms.fitness.result.DataReadResult.getDataSets()' on a null object reference
[WARN]  W/System.err: 	at com.google.android.gms.fitness.result.DataReadResponse.getDataSets(Unknown Source:6)
[WARN]  W/System.err: 	at java.lang.reflect.Method.invoke(Native Method)
[WARN]  W/System.err: 	at hyperloop.BaseProxy.invokeMethod(BaseProxy.java:157)
[WARN]  W/System.err: 	at hyperloop.InstanceProxy.invokeMethod(InstanceProxy.java:184)
[WARN]  W/System.err: 	at hyperloop.BaseProxy.callNativeFunction(BaseProxy.java:129)
[WARN]  W/System.err: 	at org.appcelerator.kroll.runtime.v8.V8Function.nativeInvoke(Native Method)
[WARN]  W/System.err: 	at org.appcelerator.kroll.runtime.v8.V8Function.callSync(V8Function.java:57)
[WARN]  W/System.err: 	at org.appcelerator.kroll.runtime.v8.V8Function.call(V8Function.java:43)
[WARN]  W/System.err: 	at hyperloop.HyperloopInvocationHandler.invoke(HyperloopInvocationHandler.java:58)
[WARN]  W/System.err: 	at java.lang.reflect.Proxy.invoke(Proxy.java:913)
[WARN]  W/System.err: 	at $Proxy0.onSuccess(Unknown Source)
[WARN]  W/System.err: 	at com.google.android.gms.tasks.zzj.run(Unknown Source:27)
[WARN]  W/System.err: 	at android.os.Handler.handleCallback(Handler.java:790)
[WARN]  W/System.err: 	at android.os.Handler.dispatchMessage(Handler.java:99)
[WARN]  W/System.err: 	at android.os.Looper.loop(Looper.java:164)
[WARN]  W/System.err: 	at android.app.ActivityThread.main(ActivityThread.java:6494)
[WARN]  W/System.err: 	at java.lang.reflect.Method.invoke(Native Method)
[WARN]  W/System.err: 	at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:438)
[WARN]  W/System.err: 	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:807)

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25782_64815/googlefittest.zip">googlefittest.zip</td></td><td>2018-02-07T08:58:19.000+0000</td><td>5183082</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-02-06

   Your environment is completely missing, we cannot help until thats available, sorry.</li>
<li>Yanko Valera 2018-02-06

   I'm using SDK7.0.1, Hyperloop 3.0.1/3.0.2. Google Play Fitness API 11.8.0. Testing in Google Nexus 5X running Android 8.1.0 let me know if you need more details</li>
<li>Hans Knöchel 2018-02-07

   [~jvennemann] The <code>java.util.List</code> related method should be fixed in 3.0.2, do you see whats wrong here?</li>
<li>Yanko Valera 2018-02-07

   I've attached the full source code to help to reproduce issue</li>
<li>Mostafizur Rahman 2018-02-12

   [~yankovalera@gmail.com], Thanks for sharing the source code.Tested the sample code on an android device and unable to reproduce the error. Can you please provide the exact test steps to reproduce this on our end?
   
   Best</li>
<li>Yanko Valera 2018-02-12

   </li>
<li>Yanko Valera 2018-03-08

   Hi, were you able to reproduce this issue?
   
   Regards</li>
<li>Hans Knöchel 2018-04-03

   Okay, so I spent some time validating this, since there are no known Android Hyperloop issues where classes are not recognized. I focussed on your following code:
   <code><pre>
   onSuccess: function(e) {
     var dataResponse = new DataReadResponse(e);
    
     console.log("onSuccess()" + e.toString() + "/" + dataResponse.toString());
     console.log("buckets size: " + dataResponse.getDataSets().size());
    }
   </pre></code>
   You are trying to create a new <code>DataReadResponse</code> instance from <code>e</code>, which is weird because the <code>onSuccess</code> callback already returns <code>DataReadResponse dataReadResult</code>, so it's a valid <code>DataReadResponse</code> instance. The concrete error is that <code>dataResponse</code> is null, which may be very possible due to instantiating a custom version of it (cloning it). Looking at [this snippet](<a href="https://github.com/googlesamples/android-fit/blob/master/BasicHistoryApi/app/src/main/java/com/google/android/gms/fit/samples/basichistoryapi/MainActivity.java#L151-L155)" rel="nofollow" target="_blank">https://github.com/googlesamples/android-fit/blob/master/BasicHistoryApi/app/src/main/java/com/google/android/gms/fit/samples/basichistoryapi/MainActivity.java#L151-L155)</a>, they pass the callback property to an [own method](<a href="https://github.com/googlesamples/android-fit/blob/master/BasicHistoryApi/app/src/main/java/com/google/android/gms/fit/samples/basichistoryapi/MainActivity.java#L247-L267)" rel="nofollow" target="_blank">https://github.com/googlesamples/android-fit/blob/master/BasicHistoryApi/app/src/main/java/com/google/android/gms/fit/samples/basichistoryapi/MainActivity.java#L247-L267)</a> and extract the response there. 
   
   So to see if you have a valid instance, you can try the following inside the <code>onSuccess</code>
   <code><pre>
   onSuccess: function(dataResponse) {
     console.log("Size of Buckets: " + dataResponse.getBuckets().size());
     console.log("Size of Data Sets: " + dataResponse.getDataSets().size());
   }
   </pre></code>
   Based on which one if it is non-empty, you can loop them with a typical JS-for-loop and dump the native <code>Bucket</code> or <code>DataSet</code> for it's contents.</li>
<li>Yanko Valera 2018-04-03

   Hi Hans, I've tried your code and now I get
   
   
   <code><pre>
   [ERROR] TiExceptionHandler: (main) [485,961] ----- Titanium Javascript Runtime Error -----
   [ERROR] TiExceptionHandler: (main) [0,962] - Message: Uncaught TypeError: dataResponse.getBuckets is not a function
   [ERROR] TiExceptionHandler: (main) [0,962] - Source: console.log('Size of Buckets: '+dataResponse.getBuckets().size()),
   dataResponse.getBuckets is not a function
   </pre></code>
   
   
   </li>
<li>Hans Knöchel 2018-04-03

    And you renamed <code>e</code> to <code>dataResponse</code>? What does <code>dataResponse</code> consist of when you log it?</li>
<li>Yanko Valera 2018-04-03

    My current code is 
    
    <code><pre>
    onSuccess: function(dataResponse) {
                    console.log(typeof(dataResponse));
                    console.log("Size of Buckets: " + dataResponse.getBuckets().size());
                    console.log("Size of Data Sets: " + dataResponse.getDataSets().size());
                }
    </pre></code>
    
    The log says typeof(dataResponse) is 
    [INFO]  object
    
    </li>
<li>Gary Mathews 2018-04-04

    [~yankovalera@gmail.com] let's see what dataResponse contains:
    <code><pre>
    onSuccess: function(dataResponse) {
        console.log(JSON.stringify(Object.keys(dataResponse), null, 1));
    }
    </pre></code>
    </li>
<li>Yanko Valera 2018-04-05

    This the output
    
    [INFO]  [
    [INFO]  "$native",
    [INFO]  "_hasPointer",
    [INFO]  "_private"
    [INFO]  ]</li>
</ol>


<p><a href="/TIMOB/TIMOB-25782.json">JSON Source</a></p>