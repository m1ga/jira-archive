---
title: "[TIMOB-25799] Android: Cannot build titanium project with JDK 1.9"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-04-02T19:43:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.1.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Satyam Sekhri</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2018-02-23T01:41:34.000+0000</td></tr>
<tr><th>Updated</th><td>2018-04-04T18:37:27.000+0000</td></tr>
</table>

<h3>Description</h3>

When the system has only jdk 9 installed then the titanium project fails to build for android.

Steps to Reproduce:
1. Create a default alloy project
2. build the project for android from command line "appc run -p android"

Actual Result:
The project does not build with following error:
<code><pre>
[ERROR] Failed to run dexer:
[ERROR]
[ERROR] Error: Could not create the Java Virtual Machine.
[ERROR] Error: A fatal exception has occurred. Program will exit.
</pre></code>

Running dexer manually shows the error is actually the following, in the dexer args [here](<a href="https://github.com/appcelerator/titanium_mobile/blob/d3cadc1bcecec20650fae421355e4edffa4876dd/android/cli/commands/_build.js#L4225)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/d3cadc1bcecec20650fae421355e4edffa4876dd/android/cli/commands/_build.js#L4225)</a> we need to swap <code>'-Djava.ext.dirs=' + this.androidInfo.sdk.platformTools.path,</code> to <code>'-classpath', this.androidInfo.sdk.platformTools.path</code>, I don't believe we need to handle this on a per-version basis as Java 1.8 handles the <code>-classpath</code> arg just fine

<code><pre>
-Djava.ext.dirs=/Users/eharris/Library/Android/sdk/platform-tools is not supported.  Use -classpath instead.
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
</pre></code>

<h3>Comments</h3>

<ol>
<li>Kondal Kolipaka 2018-02-23

   Can you run the <code>appc  ti info -t jdk</code> command and see what it prints.
   
   
   <code><pre>
   $ appc  ti info -t jdk
   Appcelerator Command-Line Interface, version 6.2.1
   Copyright (c) 2014-2018, Appcelerator, Inc.  All Rights Reserved.
   
   Preproduction Environment Active
   
   Java Development Kit
     Version                     = 1.8.0_121
     Java Home                   = /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home
   </pre></code>
   
   
   If java home is not configured in the ti info, you can run the below command to configure the java home path.
   
   <code><pre>
   $ appc ti config java.home /path/to/jdk
   </pre></code>
   
   Also, do this:
   
   <code><pre>
   <h4>OS X </h4>
   export JAVA_HOME=/path/to/jdk
   </pre></code>
   </li>
<li>Satyam Sekhri 2018-02-23

   Verified on Windows OS. The issue occurs on Windows as well. Multiple JDK's can remain installed simulataneously. Hence on windows even if JDK 1.9 is installed but JAVA_HOME points to 1.8 version of JDK the build happens fine.
   As soon as the JAVA_HOME starts to point to JDK 1.9 the same issue is seen.
   </li>
<li>Satyam Sekhri 2018-02-23

   Interestingly the appc cli does have issue when using JDK1.9. The included terminal output below shows that despite of env. variable and ti config been set the "appc ti info -t jdk" does not find the jdk.
   If JAVA_HOME was set to JDK 1.8 then the appc cli finds the jdk even without setting the "appc ti config java.home"
   
   From Windows OS:
   <code><pre>
   C:\Users\satyam>echo %JAVA_HOME%
   C:\Program Files\Java\jdk-9.0.4
   
   C:\Users\satyam>appc ti config
   Appcelerator Command-Line Interface, version 7.0.2
   Copyright (c) 2014-2018, Appcelerator, Inc.  All Rights Reserved.
   
   android.ndkPath            = "C:\\AndroidNDK\\android-ndk-r12b"
   android.sdkPath            = "C:\\android-sdk-win"
   app.workspace              = ""
   cli.colors                 = true
   cli.completion             = false
   cli.failOnWrongSDK         = false
   cli.httpProxyServer        = ""
   cli.ignoreDirs             = "^(\\.svn|_svn|\\.git|\\.hg|\\.?[Cc][Vv][Ss]|\\.bzr|\\$RECYCLE\\.BIN)$"
   cli.ignoreFiles            = "^(\\.gitignore|\\.npmignore|\\.cvsignore|\\.DS_Store|\\._.*|[Tt]humbs.db|\\.vspscc|\\.vssscc|\\.sublime-project|\\.sublime-workspace|\\.project|\\.tmproj)$"
   cli.logLevel               = "trace"
   cli.progressBars           = true
   cli.prompt                 = true
   cli.rejectUnauthorized     = true
   cli.width                  = 100
   genymotion.enabled         = true
   genymotion.path            = "C:\\Program Files\\Genymobile\\Genymotion"
   java.home                  = "C:\\Program Files\\Java\\jdk-9.0.4"
   paths.commands             = []
   paths.hooks                = ["C:\\Users\\satyam\\AppData\\Roaming\\Appcelerator\\Appcelerator Studio\\plugins\\com.appcelerator.titanium.liveview.core_1.1.0.1495386242\\node_modules\\liveview\\hook"]
   paths.modules              = []
   paths.plugins              = []
   paths.sdks                 = ["C:\\ProgramData\\Titanium"]
   paths.templates            = []
   sdk.defaultInstallLocation = "C:\\ProgramData\\Titanium"
   sdk.selected               = "7.1.0.v20180222163802"
   user.locale                = "en-us"
   windows.publisherId        = "CN=CAB0209E-F12D-48E4-BEF0-C6C965AB1083"
   
   C:\Users\satyam>appc ti info -t jdk
   Appcelerator Command-Line Interface, version 7.0.2
   Copyright (c) 2014-2018, Appcelerator, Inc.  All Rights Reserved.
   
   Java Development Kit
     Not found
   
   Java Development Kit Issues
     Ã—  JDK (Java Development Kit) not installed.
        If you already have installed the JDK, verify your JAVA_HOME environment variable is correctly
        set.
        The JDK is required for must be manually downloaded and installed from
        <a href="http://appcelerator.com/jdk." rel="nofollow" target="_blank">http://appcelerator.com/jdk.</a>
   
   </pre></code></li>
<li>Ewan Harris 2018-02-23

   I believe this is due to TIMOB-25429, JDK 9 significantly changed the directory structure and consequently the SDK cannot detect it, the daemon can because we use the newer jdklib which handles it [commit](<a href="https://github.com/appcelerator/jdklib/commit/19b21f81301812ce93105619552c311c55e1b00a)" rel="nofollow" target="_blank">https://github.com/appcelerator/jdklib/commit/19b21f81301812ce93105619552c311c55e1b00a)</a>, it should be fairly simple to add these changes to node-appc, I was wary originally due to the Studio incompatability</li>
<li>Satyam Sekhri 2018-02-23

   I believe the issue is related to TIMOB-25429 as [~eharris] mentioned.
   With upcoming release of Studio to support JDK 9 it would be vital to support JDK 9 as well as the older ones in cli as well.</li>
<li>Ewan Harris 2018-02-23

   Made a PR to support JDK 9 detection, <a href="https://github.com/appcelerator/node-appc/pull/127" rel="nofollow" target="_blank">https://github.com/appcelerator/node-appc/pull/127</a>, this only supports JDK 9 detection, I have not ran through tests in the SDK</li>
<li>Ewan Harris 2018-03-28

   Master: <a href="https://github.com/appcelerator/titanium_mobile/pull/9964" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9964</a>
   7_1_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/9965" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9965</a></li>
<li>Lokesh Choudhary 2018-04-02

   FR Passed.
   PR's merged.</li>
<li>Lokesh Choudhary 2018-04-04

   </li>
</ol>


<p><a href="/TIMOB/TIMOB-25799.json">JSON Source</a></p>