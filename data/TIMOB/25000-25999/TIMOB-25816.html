---
title: "[TIMOB-25816] Decide on best practices for polyfilling for ES6+ usage"
---
<table>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-03-04T19:10:45.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>node-titanium-sdk 0.4.12</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2018-02-26T23:15:29.000+0000</td></tr>
<tr><th>Updated</th><td>2019-03-04T19:10:50.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

*I'm making this a story because to me it's something that we need to investigate, discuss and act on*

With the addition of babel in 7.1.0 users can now use new syntax in their applications without worrying about what their targets support. While that is the theory it's not the reality. 

If you review Babels [Learning ES2015](<a href="https://babeljs.io/learn-es2015/)" rel="nofollow" target="_blank">https://babeljs.io/learn-es2015/)</a> guide, some features denote <code>Support via polyfill</code>, this is because babel can only handle syntactical changes (arrow function to function expressions, let/const to var etc.), and for features such as maps and promises it is impossible to transpile these down so babel makes use of polyfills, which instead add these into the JS environment.

To me, there are a two avenues to us handling this

* We distribute [babel-polyfill](<a href="https://www.npmjs.com/package/babel-polyfill)" rel="nofollow" target="_blank">https://www.npmjs.com/package/babel-polyfill)</a> in the SDK
* We pass this on down to the user, either through usage of a module or just requiring them to add the module themselves.
* We evaluate including babel-runtime/transform-runtime in the transpile step <a href="https://babeljs.io/docs/plugins/transform-runtime" rel="nofollow" target="_blank">https://babeljs.io/docs/plugins/transform-runtime</a>

This has been attempted already (kind of) in two ways

* I attempted to add babel-polyfill to an app [~hknoechel] was writing (TIMOB-25740), it didn't go well for me, I believe we could fix this
* [~gmathews] [node-titanium-sdk](<a href="https://github.com/appcelerator/node-titanium-sdk/pull/24)" rel="nofollow" target="_blank">https://github.com/appcelerator/node-titanium-sdk/pull/24)</a> PR, which includes regenerator-runtime to allow apps to use async/await

Here's my first thoughts on drawbacks I see with both ways

* User owned
** Doesn't adhere with our current way of handling this kind of thing where we deal with it

* SDK owned
** Unless we're detect what's needed every app will include it, whether they need it or not.
** We'll need to continually maintain this each release I believe

I looked at how others handle this, and discovered the following

* react-native [rolls its own preset](<a href="https://github.com/facebook/react-native)" rel="nofollow" target="_blank">https://github.com/facebook/react-native)</a>, which appears to be dynamic dependent on an apps usage. Polyfills look to be baked into react-native with them being defined when the [app start](<a href="https://github.com/facebook/react-native/blob/master/Libraries/Core/InitializeCore.js)" rel="nofollow" target="_blank">https://github.com/facebook/react-native/blob/master/Libraries/Core/InitializeCore.js)</a>

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2018-03-01

   I've had some luck with babel-polyfill on iOS after trying this again, I moved Hans' example to an async function for the geolocation <a href="https://github.com/ewanharris/titanium-es6-sample/tree/async_await." rel="nofollow" target="_blank">https://github.com/ewanharris/titanium-es6-sample/tree/async_await.</a> Android currently throws when requiring babel-polyfill, see TIMOB-25826.</li>
<li>Gary Mathews 2018-03-19

   *NOTE*
   - <code>@babel/polyfill</code> is used by <code>ti.es6</code> <a href="https://github.com/appcelerator/ti.es6/blob/master/plugins/ti.es6/1.1.0/hooks/ti.es6.js#L52" rel="nofollow" target="_blank">https://github.com/appcelerator/ti.es6/blob/master/plugins/ti.es6/1.1.0/hooks/ti.es6.js#L52</a>
   </li>
<li>Gary Mathews 2018-06-13

   node-titanium-sdk: <a href="https://github.com/appcelerator/node-titanium-sdk/pull/32" rel="nofollow" target="_blank">https://github.com/appcelerator/node-titanium-sdk/pull/32</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-25816.json">JSON Source</a></p>