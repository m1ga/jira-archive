---
title: "[TIMOB-25839] TiAPI: Touch event coordinate units do not match between platforms"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-01-11T02:28:58.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.0</td></tr>
<tr><th>Components</th><td>Android, iOS</td></tr>
<tr><th>Labels</th><td>android, breaking-change, defaultunit, ios, parity, touch</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-03-06T03:44:25.000+0000</td></tr>
<tr><th>Updated</th><td>2019-01-11T02:29:03.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The (x,y) units provided by View event's "touchstart", "touchmove", "touchend", and "touchcancel" do not match between Android and iOS. Both platforms ignore the "ti.ui.defaultunit" property setting in "tiapp.xml".

On Android, the touch coordinates are always in "px" (ie: pixels).
On iOS, the touch coordinates are always in "dip" (aka: "dp").

*Steps to Reproduce:*
<h4>Build and run the below code on Android.</h4>
<h4>Drag your finger in the gray view.</h4>
<h4>Notice that the blue square does *not* correctly following your finger.</h4>
<h4>Build and run on iOS.</h4>
<h4>Drag your finger in the gray view.</h4>
<h4>Notice that the blue square *correctly* follows your finger.</h4>
<h4>Change "tiapp.xml" property "ti.ui.defaultunit" to "px".</h4>
<h4>Build and run on iOS.</h4>
<h4>Drag your finger in the gray view.</h4>
<h4>Notice that the blue square does *not* correctly following your finger.</h4>
<h4>Build and run on Android.</h4>
<h4>Drag your finger in the gray view.</h4>
<h4>Notice that the blue square *correctly* follows your finger.</h4>

<code><pre>
function onTouch(event) {
	if (event.source == containerView) {
		touchView.center = { x: event.x, y: event.y };
	}
}

var window = Ti.UI.createWindow(
{
	layout: "vertical",
	fullscreen: true,
	theme: "Theme.AppCompat.NoTitleBar",
});
window.add(Ti.UI.createLabel(
{
	text: "Touch Drag Test",
	top: "20dp",
}));
var containerView = Ti.UI.createView(
{
	touchEnabled: true,
	backgroundColor: "gray",
	top: "10dp",
	bottom: "20dp",
	width: "90%",
});
var touchView = Ti.UI.createView(
{
	touchEnabled: false,
	backgroundColor: "#008800",
	width: "100dp",
	height: "100dp",
});
containerView.add(touchView);
containerView.addEventListener("touchstart", onTouch);
containerView.addEventListener("touchmove", onTouch);
containerView.addEventListener("touchend", onTouch);
containerView.addEventListener("touchcancel", onTouch);
containerView.addEventListener("click", onTouch);
containerView.addEventListener("dblclick", onTouch);
containerView.addEventListener("doubletap", onTouch);
window.add(containerView);
window.open();
</pre></code>

*Work-Around:*
The following will work-around this issue on both Android and iOS...

<code><pre>
// Fetch the default unit property set in "tiapp.xml".
var defaultUnit = Ti.App.Properties.getString("ti.ui.defaultunit", "dip");
if (defaultUnit === "dp") {
	defaultUnit = "dip";
} else if (defaultUnit === "system") {
	defaultUnit = (Ti.Platform.name === "android") ? "px" : "dip";
}

// Do the below when a touch event has been received.
function onTouch(event) {
	if (Ti.Platform.name === "android") {
		event.x = Ti.UI.convertUnits(event.x + "px", defaultUnit);
		event.y = Ti.UI.convertUnits(event.y + "px", defaultUnit);
	} else if ((Ti.Platform.name === "iOS") || (Ti.Platform.name === "iPhone OS")) {
		event.x = Ti.UI.convertUnits(event.x + "dip", defaultUnit);
		event.y = Ti.UI.convertUnits(event.y + "dip", defaultUnit);
	}
	touchView.center = { x: event.x, y: event.y };
}
</pre></code>

*Ideal Solution:*
Convert native touch coordinates to use "ti.ui.defaultunit" on both Android and iOS. This way views can easily be dragged since their "x", "y", and "center" properties already respect the "ti.ui.defaultunit" property.
Note that this would be a breaking change.


<h3>Comments</h3>

<ol>
<li>Andrea Vitale 2018-05-04

   Hi have a similar issue using <code><pre>Ti.UI.create2DMatrix().translate(0, 100)</pre></code>
   
   On Android the value <code>100</code> is evaluated as <code>100px</code>, on iOS it is correctly evaluated as <code>100dp</code>.</li>
<li>Joshua Quick 2018-11-01

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10414" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10414</a></li>
<li>Joshua Quick 2018-11-15

   [~Andrea.Vitale], I've written up a separate ticket for the <code>2DMatrix.translate()</code> coordinate issue.
   Please see: [TIMOB-26563]
   
   Thanks for bringing this issue to our attention.</li>
<li>Samir Mohammed 2018-11-30

   *Closing ticket.* Fix verified in SDK Version <code>8.0.0.v20181129161342.</code>
   
   Test and other information can be found at: 
   <a href="https://github.com/appcelerator/titanium_mobile/pull/10414" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10414</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-25839.json">JSON Source</a></p>