---
title: "[TIMOB-25854] Android: Grant WebView permissions for Audio/Video WebRTC streams"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-25T15:26:08.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>audio, engTriage, permissions, video, webview</td></tr>
<tr><th>Reporter</th><td>Michael Gangolf</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-03-11T18:33:18.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-25T15:26:08.000+0000</td></tr>
</table>

<h3>Description</h3>

*Problem*
When opening a WebRTC streaming page in an Android Webview the camera won't be visible since the permissions are not granted in the Webview itself.

*How to/Example*

* Go to <a href="https://palava.tv/" rel="nofollow" target="_blank">https://palava.tv/</a> and click "secret conference"
* use this url for the webview <code>[PALAVA_URL]</code>
* App will connect to this conference room

<code><pre>
var win = Ti.UI.createWindow({
        title: 'Form',
        backgroundColor: 'blue'
});

var www = Ti.UI.createWebView({
        url: "[PALAVA URL]"
});

win.add(www);

var btn  = Ti.UI.createButton({
        title:"refresh",
        bottom:10
})
btn.addEventListener("click",function(){
        www.url = "[PALAVA_URL]";
})
win.add(btn);
win.open();
</pre></code>

Add the permissions to tiapp.xml
<code><pre>
&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
&lt;manifest &gt;
	&lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;
	&lt;uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" /&gt;
	&lt;uses-permission android:name="android.permission.CAMERA"/&gt;
&lt;/manifest&gt;
&lt;/android&gt;
</pre></code>

*Current status*
* Not working with 7.0.2.GA and 7.1.0 (master)

*Test env*
* Android 7
*  HTC A9

*Solution*
* Grand permission in Webview



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-25854_64954/webrtc.mp4">webrtc.mp4</td></td><td>2018-03-11T18:43:23.000+0000</td><td>244306</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Michael Gangolf 2018-03-11

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/9928" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9928</a>
   
   webrtc.mp4 shows a Chromium browser with my phone connected using a webview</li>
<li>Sharif AbuDarda 2018-03-11

   Hello, I was able to verify the issue in Android 8.0.0 With SDK 7.0.2.GA. Need Audio/Video permission. Thanks.</li>
<li>Hans Kn√∂chel 2018-06-28

   PR put on hold during more API design required. See details in the linked PR.</li>
<li>Nikos Poulios 2018-10-03

   This applies also to pages using <input type='file' accept='image/*' />
   User gets only the file picker, no dialog to select camera or gallery and no user prompt to grant external storage and camera permissions. If those permissions are manually enabled by device's App Settings everything works ok</li>
<li>Michael Gangolf 2018-10-03

   [~nipoul] if you can enable them in the app settings you could also use the normal camera/file permissions dialog (Ti.Android.requestPermissions) to enable them.</li>
<li>Nikos Poulios 2018-10-03

   You can use request permissions and then it would be ok, but you don't want to do that before the user is about to use the camera and there is no clean way to figure out that the user clicked on <input type='file' accept='image/*' /> . This should be handled by TiWebChromeClient</li>
<li>Michael Gangolf 2018-10-03

   Thats true. But at least you can use the workaround before. For the WebRTC part there is no workaround because you can't enable that permission by hand. 
   But you are right, it should be taken into consideration when creating a new PR</li>
<li>Nikos Poulios 2018-10-03

   @Joshua Quick Do you think I should make another ticket for camera/storage permissions or do you plan to include those as well?</li>
<li>kosso 2019-05-12

   I've just come up against this issue trying to do something simple with webRTC in a webView. 
   
   Could this be part of a solution? 
   
   <a href="https://developer.android.com/reference/android/webkit/WebChromeClient.html#onPermissionRequest(android.webkit.PermissionRequest)" rel="nofollow" target="_blank">https://developer.android.com/reference/android/webkit/WebChromeClient.html#onPermissionRequest(android.webkit.PermissionRequest)</a>
   
   
   <code>public void onPermissionRequest (PermissionRequest request)</code>
   
   Notify the host application that web content is requesting permission to access the specified resources and the permission currently isn't granted or denied. The host application must invoke PermissionRequest#grant(String[]) or PermissionRequest#deny(). If this method isn't overridden, the permission is denied.
   </li>
<li>Michael Gangolf 2019-05-12

    @kosso: see the PR for more details: <a href="https://github.com/appcelerator/titanium_mobile/pull/9928" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9928</a>
    There I was using <code>onPermissionRequest</code> which "solves" the problem but it will allow all permissions and doesn't ask the user. A better system with a user-permission needs to be added</li>
<li>Joshua Quick 2020-09-16

    This can also be tested with...
    <code><pre>
    var window = Ti.UI.createWindow();
    window.add(Ti.UI.createWebView({
    	url: '<a href="https://mozilla.github.io/webrtc-landing/gum_test.html" rel="nofollow" target="_blank">https://mozilla.github.io/webrtc-landing/gum_test.html</a>',
    }));
    window.open();
    </pre></code>
    
    Mozilla's webpage will test WebRTC for video-only, audio-only, and video+audio.
    Their webpage also has a test for WebRTC screensharing, but there doesn't appear to be a way of supporting this via Google's Java <code>WebView</code>.
    </li>
<li>Joshua Quick 2020-09-19

    PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/12105" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12105</a></li>
<li>Sohail Saddique 2020-10-08

    FR passed for this part of the PR</li>
<li>Samir Mohammed 2020-11-25

    *Closing ticket*. Fix verified in SDK version <code>9.3.0.v20201125050632</code>.
    
    Test and other information can be found at:
    <a href="https://github.com/appcelerator/titanium_mobile/pull/12105" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12105</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-25854.json">JSON Source</a></p>