---
title: "[TIMOB-25859] Android: Delay WebView Ti.App.fireEvent() to be fired after page load"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Do</td></tr>
<tr><th>Resolution Date</th><td>2018-10-24T21:10:00.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, evalJS, webview</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-03-12T21:31:53.000+0000</td></tr>
<tr><th>Updated</th><td>2018-10-24T21:10:50.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The JavaScript within a WebView's HTML can call <code>Ti.App.fireEvent()</code> to communicate with the Titanium JavaScript side. It currently fires events immediately. The problem with this is if the listener immediately calls <code>WebView.evalJS()</code> to communicate back, it'll always timeout on Android if the web page hasn't finished loading yet and the Titanium runtime runs on the main UI thread (the default). This makes it less convenient to use.

*Steps to Reproduce:*
<h4>Build and run attached [^WebViewInteropTest.js] on Android.</h4>
<h4>Observe the Android log.</h4>

*Result:*
An <code>Timeout waiting to evaluate JS</code> warning message appears in the log.

*Expected Result:*
The <code>evalJS()</code> calls should succeed. A countdown message "Reload in: X" should appear in the web page, starting from 5. When it counts down to zero, the page should reload.

*Cause:*
The <code>WebView.evalJS()</code> call will not work until the "load" event has been received from the WebView. This is because Titanium injects a "polling" script into the web page in the <code>WebViewClient.onPageFinished()</code> call...
<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebViewClient.java#L45" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebViewClient.java#L45</a>

This polling script is responsible for fetching/evaluating the script added to the stack by the <code>evalJS()</code> call...
<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebViewBinding.java#L151" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebViewBinding.java#L151</a>

Since <code>evalJS()</code> is getting called before the web page has finished loading, the <code>evalJS()</code> call will always fail with a timeout warning when the Titanium runtime runs on the main UI thread.

*Recommended Solution:*
Queue all <code>Ti.App.fireEvent()</code> calls made within the HTML and do not fire them until the page has finished loading.

*Work-Around:*
Use the new async version of <code>WebView.evalJS()</code> that was introduced into 7.5.0. It does not have this issue.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25859_65770/WebViewInteropTest.js">WebViewInteropTest.js</td></td><td>2018-10-24T21:03:12.000+0000</td><td>2012</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2018-03-12

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/9931" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9931</a></li>
<li>(deactived) Brian Immel 2018-06-25

   Note to [~bimmel]: Update <a href="https://wiki.appcelerator.org/display/guides2/Communication+Between+WebViews+and+Titanium#CommunicationBetweenWebViewsandTitanium-Remotewebcontent" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides2/Communication+Between+WebViews+and+Titanium#CommunicationBetweenWebViewsandTitanium-Remotewebcontent</a> once this release has happened.</li>
<li>Keerthi Mahalingam 2018-10-16

   Waiting for resolving conflicts</li>
<li>Joshua Quick 2018-10-24

   I've confirmed that the async version of <code>WebView.evalJS()</code> does not have this problem, which is a new feature we've added in 7.5.0. See: [TIMOB-25862]</li>
<li>Joshua Quick 2018-10-24

   It is recommended that you use the async version of <code>WebView.evalJS()</code> instead.
   Closing as won't fix.</li>
</ol>


<p><a href="/TIMOB/TIMOB-25859.json">JSON Source</a></p>