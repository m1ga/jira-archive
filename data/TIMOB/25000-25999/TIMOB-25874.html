---
title: "[TIMOB-25874] iOS 11.2: Ti.UI.RefreshControl with Ti.UI.Window.largeTitleEnabled hides spinner"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-05-14T09:18:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 6.3.0, Release 7.1.0, Release 7.0.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.3.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios-11, largetitleenabled, refreshcontrol, spinner</td></tr>
<tr><th>Reporter</th><td>Flavio Bontà</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2018-03-15T18:37:12.000+0000</td></tr>
<tr><th>Updated</th><td>2018-06-20T15:42:05.000+0000</td></tr>
</table>

<h3>Description</h3>

Hi,
I have created a simple navigationWindow in Alloy.
The Window has <code>largeTitleEnabled: true</code>, inside the window I have a simple listView with a refreshControl.
When I run a Pull to Refresh the spinner is hidden by large-title.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25874_64975/328jD.png">328jD.png</td></td><td>2018-03-16T09:15:57.000+0000</td><td>48360</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25874_64974/Simulator Screen Shot - iPhone 8 - 2018-03-15 at 19.30.42.png">Simulator Screen Shot - iPhone 8 - 2018-03-15 at 19.30.42.png</td></td><td>2018-03-15T18:33:18.000+0000</td><td>79981</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-25874_64973/Simulator Screen Shot - iPhone 8 - 2018-03-15 at 19.30.45.png">Simulator Screen Shot - iPhone 8 - 2018-03-15 at 19.30.45.png</td></td><td>2018-03-15T18:33:18.000+0000</td><td>91436</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2018-03-15

   Hello, Please share a full reproducible test code that regenerates the issue for iOS. Thanks.</li>
<li>Flavio Bontà 2018-03-16

   Sorry!!
   <code><pre>
   &lt;Alloy&gt;
   	&lt;NavigationWindow id="index" platform="ios"&gt;
   		&lt;Window id="main"&gt;
   		&lt;/Window&gt;
   	&lt;/NavigationWindow&gt;
   &lt;/Alloy&gt;
   </pre></code>
   
   <code><pre>
   "#main": {
   	title: "test",
   	largeTitleEnabled: true
   }
   </pre></code>
   
   <code><pre>
   var counter = 0;
   
   function genData() {
   	var data = [];
   	var i = 1;
   	for (i = 1; i &lt;= 3; i++) {
   		data.push({ properties: { title: 'ROW ' + (counter + i) } })
   	}
   	counter += 3;
   	return data;
   }
   
   var section = Ti.UI.createListSection();
   section.setHeaderTitle("title");
   section.setItems(genData());
   
   var control = Ti.UI.createRefreshControl({
   	tintColor: 'red'
   })
   
   var listView = Ti.UI.createListView({
   	sections: [section],
   	refreshControl: control
   });
   
   control.addEventListener('refreshstart', function(e) {
   	Ti.API.info('refreshstart');
   	setTimeout(function() {
   		Ti.API.debug('Timeout');
   		section.appendItems(genData());
   		control.endRefreshing();
   	}, 100); //if setTimeout is about 1s the problem not occurs
   })
   
   $.main.add(listView);
   $.index.open();
   </pre></code>
   
   The problem occurs when rest call (in this case simulated with a setTimeout 100ms) is too fast.
   
   In native iOS, the spinner is over the navigationBar (as attachment)
    !328jD.png|thumbnail! 
   </li>
<li>Hans Knöchel 2018-03-16

   Really really interesting! The issue is that we use the <code>addSubview</code> approach for both iOS < 10 and iOS >= 10, but iOS >= 10 support the <code>setRefreshControl:</code> selector that is more proper for this. We will provide a fix for this later today and schedule it for one of the next releases. Thank you for reporting this!</li>
<li>Hans Knöchel 2018-03-19

   So this turned out to be more complex than initially thought: For iOS 10+, the <code>refreshControl</code> property is used instead of adding it as a sub-view - easy! But it also flickers when using together with largeTitleEnabled = true and extendEdges = Not set (or Ti.UI.EXTEND_EDGE_NONE = default). 
   
   Thats why a valid code looks like this:
   <code><pre>
   var window = Ti.UI.createWindow({
     backgroundColor: '#fff',
     title: 'Hello World',
     includeOpaqueBars: true,
   	largeTitleEnabled: true,
     extendEdges: [Ti.UI.EXTEND_EDGE_ALL]
   });
   
   var nav = Ti.UI.iOS.createNavigationWindow({
     window: window
   });
   
   var control = Ti.UI.createRefreshControl({
   })
    
   var listView = Ti.UI.createListView({
   	sections: [Ti.UI.createListSection({ items: [{ properties: { title: 'Test' } }] })],
   	refreshControl: control
   });
    
   control.addEventListener('refreshstart', function(e) {
   	setTimeout(function() {
   		control.endRefreshing();
   	}, 1000); //if setTimeout is about 1s the problem not occurs
   })
    
   window.add(listView);
   nav.open();
   </pre></code>
   The only reason why many developers in the native world didn't see that before is because <code>edgesForExtendedLayout</code> (the native property behind <code>extendEdges</code>) is <code>UIRectEdgeAll</code> by default, but we use <code>UIRectEdgeNone</code> as the default. In Titanium SDK 8, we should change that default behavior to better match the native iOS behavior. I've added a new note to the Ti.UI.RefreshControl docs about this behavior as well and hope it's adopted by the developers.
   
   Let us know if there are follow-up questions regarding this!</li>
<li>Vijay Singh 2018-03-22

   PR : <a href="https://github.com/appcelerator/titanium_mobile/pull/9942" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/9942</a></li>
<li>Samir Mohammed 2018-06-20

   </li>
</ol>


<p><a href="/TIMOB/TIMOB-25874.json">JSON Source</a></p>