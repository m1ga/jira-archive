---
title: "[TIMOB-26029] Android : Titanium.Android.ACTION_HEADSET_PLUG Not working as expected."
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2018-05-17T21:15:54.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.1.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Aminul Islam</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-05-10T16:12:06.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-06T17:37:03.000+0000</td></tr>
</table>

<h3>Description</h3>

We want to detect the current state of headphones connected (true) or disconnected (false). We have an API for that but no example code in documents.
<a href="http://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">http://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Android-property-ACTION_HEADSET_PLUG
I create an example code but not working. 
<code><pre>
function doClick() {
 Ti.Android.unregisterBroadcastReceiver(bc);
}
$.index.open();
var onReceived = function(e) {
 Ti.API.info("received!");
 Ti.API.info('Handling broadcast. &gt;&gt; ' + JSON.stringify(e));
 alert('Handling broadcast. &gt;&gt; ' + JSON.stringify(e));
};
var bc = Ti.Android.createBroadcastReceiver({
 onReceived : onReceived
});
Ti.Android.registerBroadcastReceiver(bc,["Titanium.Android.ACTION_HEADSET_PLUG"]);
</pre></code>
Index.xml
<code><pre>
&lt;Alloy&gt;
 
 &lt;Window class="container"  onClose="doClose" /&gt;
 
&lt;/Alloy&gt;
</pre></code>

Test Environment:
<code><pre>
Operating System
  Name                        = Microsoft Windows 10 Pro
  Version                     = 10.0.16299
  Architecture                = 32bit
  # CPUs                      = 4
  Memory                      = 17091956736
Node.js
  Node.js Version             = 8.9.1
  npm Version                 = 5.5.1
Titanium CLI
  CLI Version                 = 5.1.0
Titanium SDK
  SDK Version                 = 7.1.0.GA
</pre></code>

Thanks 



<h3>Comments</h3>

<ol>
<li>Christopher Williams 2018-05-17

   Isn't this code example just wrong? The second argument to registerBroadcastReceiver should be an array of references to the Ti.Android.ACTION_* constants like so:
   <code><pre>
   Ti.Android.registerBroadcastReceiver(bc, [ Ti.Android.ACTION_HEADSET_PLUG ]);
   </pre></code>
   
   
   (Note that <code>Ti.Android.ACTION_HEADSET_PLUG</code> is a reference to a constant whose value aliases to the correct String necessary under the hood, it itself is **not** a String)</li>
<li>Joshua Quick 2018-05-17

   This is not a bug.
   
   The below code works. I've tested it on real devices running Android OS v4.1 and v8.0. When you connect/disconnect a headset to the Android device, it'll display a "Connected" or "Disconnected" label.
   
   <code><pre>
   // Create a window with label displaying current headset state.
   var window = Ti.UI.createWindow();
   var label = Ti.UI.createLabel();
   window.add(label);
   window.open();
   
   // Register a headset broadcast receiver.
   var receiver = Ti.Android.createBroadcastReceiver({
   	onReceived: function(e) {
   		// Headset has been connected/disconnected. Display current state via label.
   		if (e.intent.action === Ti.Android.ACTION_HEADSET_PLUG) {
   			var isPluggedIn = (e.intent.getIntExtra("state", 0) != 0);
   			label.text = "Headset is " + (isPluggedIn ? "Connected" : "Disconnected");
   		}
   	},
   });
   Ti.Android.registerBroadcastReceiver(receiver, [Ti.Android.ACTION_HEADSET_PLUG]);
   
   // Unregister above broadcast receiver when exiting.
   window.addEventListener("close", function(e) {
   	Ti.Android.unregisterBroadcastReceiver(receiver);
   });
   </pre></code>
   
   Like what Chris has said, they're incorrectly passing the <code>Ti.Android.ACTION_HEADSET_PLUG</code> constant in. They should not be double quoting it. For your info, Titanium's <code>Ti.Android.ACTION_HEADSET_PLUG</code> constant returns string <code>"android.intent.action.HEADSET_PLUG"</code>, which matches Google's constant here...
   <a href="https://developer.android.com/reference/android/content/Intent.html#ACTION_HEADSET_PLUG" rel="nofollow" target="_blank">https://developer.android.com/reference/android/content/Intent.html#ACTION_HEADSET_PLUG</a>
   
   Google documents the intent "extras" for this action (such as "state") here...
   <a href="https://developer.android.com/reference/android/media/AudioManager#ACTION_HEADSET_PLUG" rel="nofollow" target="_blank">https://developer.android.com/reference/android/media/AudioManager#ACTION_HEADSET_PLUG</a>
   </li>
<li>Eric Merriman  2018-08-06

   Closing as invalid. If incorrect, please reopen.</li>
</ol>


<p><a href="/TIMOB/TIMOB-26029.json">JSON Source</a></p>