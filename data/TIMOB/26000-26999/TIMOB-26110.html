---
title: "[TIMOB-26110] Xcode 10: Cannot build application with new (default) build system"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-06-20T14:32:59.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.4.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>cb-tooling</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2018-06-08T00:27:47.000+0000</td></tr>
<tr><th>Updated</th><td>2018-11-01T14:18:39.000+0000</td></tr>
</table>

<h3>Description</h3>

When using Xcode 10 and the new build system, the app build fails because the <project>/build/iphone/build directory is generated by our CLI instead of the actual xcodebuild command. While this was okay in the past, the new build system complains about that. 

I filed a radar at <a href="https://openradar.appspot.com/40906897" rel="nofollow" target="_blank">https://openradar.appspot.com/40906897</a> and talked to the Apple engineers during WWDC. They assume it to be an issue in the new build system, but we can actually fix it on our end by now pre-creating the directory and let xcodebuild create it. I tested it as a local change and it works with both Xcode 10 and 9.

Error:
<code><pre>
[INFO]  Cleaning Xcode derived data
[DEBUG] Invoking: DEVELOPER_DIR=/Applications/Xcode-beta.app/Contents/Developer /Applications/Xcode-beta.app/Contents/Developer/usr/bin/xcodebuild clean
[ERROR] note: Using new build system
[ERROR] error: Could not delete <code>/Users/hknoechel/Documents/Apps/myapp/build/iphone/build</code> because it was not created by the build system and it is not a subfolder of derived data.
[ERROR] ** CLEAN FAILED **
</pre></code>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-06-20

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/10123" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10123</a></li>
<li>Samir Mohammed 2018-08-27

   [~hknoechel] Using 7_4_X (7.4.0.v20180824134643) I get the error below but on Master (7.5.0.v20180824145645) the application runs without issues. 
   
   <code><pre>
   [ERROR] :  note: Using new build system
   [ERROR] :  error: Could not delete <code>/Users/Samir/Desktop/newWS/test3/build/iphone/build</code> because it was not created by the build system and it is not a subfolder of derived data.
   [ERROR] :  ** CLEAN FAILED **
   </pre></code>
   
   *Test Environment*
   <code><pre>
   APPC Studio:  5.1.0.201808080937
   APPC CLI: 7.0.6-Master.5
   iphone 6 simulator (12.0)
   Operating System Name: Mac OS High Sierra
   Operating System Version: 10.13.6
   Node.js Version: 8.9.1
   Xcode 10.0 beta 6
   </pre></code>
   </li>
<li>Samir Mohammed 2018-08-28

   *Closing ticket* Verified fix in SDK version: <code>7.4.0.v20180827125633</code> and <code>7.5.0.v20180827102657.</code>
   
   *Test Steps (FR Passed):*
   <h4>Created a new titanium project </h4>
   <h4>Ran the program ensuring newest beta of XCode is installed along with IOS 12. beta</h4>
   <h4>Application no longer showed the error above in the description and ran without issues</h4>
   
   *Test Environment*
   <code><pre>
   APPC Studio:  5.1.0.201808080937
   APPC CLI: 7.0.6-Master.5
   iphone 6 simulator (12.0)
   Operating System Name: Mac OS High Sierra
   Operating System Version: 10.13.6
   Node.js Version: 8.9.1
   Xcode 10.0 beta 6
   </pre></code>
   </li>
<li>jack sparrow 2018-10-27

   i have same issue any solution  ?</li>
<li>alejandro_capel 2018-10-27

   Hi Jack, it is a very strange thing!!
   
   I have reproduced this issue several times. In my case I have to delete build folder while compiling en iOS simulator. Try to do it.
   
   Regards.</li>
<li>Diego Freniche 2018-10-29

   What I've done is just use inside <code>&lt;ios&gt;</code> tag:
   
   <code><pre>
   &lt;ios&gt;
       &lt;use-new-build-system&gt;false&lt;/use-new-build-system&gt;
   </pre></code>
   </li>
<li>Raymond Verbruggen 2018-10-30

   URGENT!
   
   I have checked-out a SDK 6.3.0 project from subversion in order to implement a small update.
   The same error appears here. Adding the <use-new-build-system>false</use-new-build-system> into the <ios> section does not help.
   
   What to do?</li>
<li>Hans Knöchel 2018-10-30

   [~ray@raymondverbruggen.nl] This change was added in 7.4.0 as part of the general Xcode 10 support. If you cannot update to SDK 7.4.0+ so far, you either need to use Xcode 9 or patch your SDK manually (adding <code>-UseNewBuildSystem=NO</code> to the "xcodebuild" commands (build and clean).</li>
<li>Raymond Verbruggen 2018-10-30

   I cannot update to SDK 7, because the supplier of the Bluetooth module is not willing to update...
   How can I patch the SDK manually?
   
   I checked-out another SDK 6.3.0 project from subversion and that project builds without errors... It is a classic project (from 2012), so not alloy. Is that logical?</li>
<li>Raymond Verbruggen 2018-10-31

    Good morning!
    
    Yesterday evening I checked out two SDK 6.3.0 projects (both alloy) and in the first try it did not got the above error message.
    However when I do a Project-Clean, every project gives the error message.
    
    1) How do I this suggestion from you: adding -UseNewBuildSystem=NO to the "xcodebuild" commands (build and clean)?
    
    2) OR: create a patch that enables SDK 6.x to work with the new build system :)</li>
<li>Chris Barber 2018-10-31

    I suspect the problem stems from this line: <a href="https://github.com/appcelerator/titanium_mobile/blob/7_5_X/iphone/cli/commands/_build.js#L2462-L2463" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/7_5_X/iphone/cli/commands/_build.js#L2462-L2463</a> where we force the new build system when using Xcode 10 or newer. You CANNOT disable the new build system in the <code>tiapp.xml</code> when building with Xcode 10 or newer. We then pass <code>-UseNewBuildSystem=YES</code> into both the <code>xcodebuild clean</code> and <code>xcodebuild build</code> calls.
    
    If I recall correctly, the problem isn't that we're being explicit, but rather that Xcode 10 defaults to the new build system for <code>xcodebuild clean</code> command, but not the <code>build</code> action. So we chose to be explicit to override Xcode's inconsistent default behaviors.
    
    What "we" (myself, Titanium developers, contributors) need to do is install both Xcode 9 and Xcode 10 and test all combinations (clean builds, incremental builds, with flag set in tiapp, vice versa, etc). I'll raise this issue in standup and maybe someone can investigate sooner than I can.</li>
<li>Raymond Verbruggen 2018-10-31

    Beautiful, thank you for your update!
    
    I would prefer to determine on a per-project basis whether to use the new build system or not. For example in the tiapp.xml file.
    For maintenance of apps (I am working with appcelerator already since 2013) I need to be able to do small updates to "old" apps without the need of going for example from SDK 6.3 to 7.4 or so.
    
    I also added some comments in this great blog by Jason Keen: <a href="https://www.appcelerator.com/blog/2018/10/running-xcode-9-xcode-10-side-side/" rel="nofollow" target="_blank">https://www.appcelerator.com/blog/2018/10/running-xcode-9-xcode-10-side-side/</a>
    Maybe there is an opportunity of improving the overall situation.</li>
<li>Chris Barber 2018-11-01

    I tested this with Xcode 9.4.1/iOS 11.4 and Xcode 10.1/iOS 12.1 and with Titanium SDK 7.4.1.GA and sadly I cannot reproduce. I tested both simulator and device builds. I will need to mess around a bit more and see if I can put stuff in <code>build/iphone/build</code> and cause the clean to fail, then try to figure out why.
    
    Can somebody who is encountering this problem try creating a new Alloy app and see if you can reproduce?
    
    I'd like to know:
    * Does this happen for new apps?
    * Does it happen during a clean build or an incremental build?
    * Are you using a Titanium module that could be copying in some assets that are causing the problem?
    * Is this happening for simulator builds, device builds, or both?
    * Are you using the CLI or Studio?
    * What Node.js version? (I doubt this matters, but you never know)</li>
</ol>


<p><a href="/TIMOB/TIMOB-26110.json">JSON Source</a></p>