---
title: "[TIMOB-26113] iOS: Ti.UI.convertUnits does not consult ti.ui.defaultunit property"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-11-14T15:35:52.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2018-06-08T14:34:40.000+0000</td></tr>
<tr><th>Updated</th><td>2018-11-21T15:02:02.000+0000</td></tr>
</table>

<h3>Description</h3>

Looks like iOS does not consult ti.ui.defaultunit property for converting when input units aren't specified. It assumes "dp", which is the default value placed in tiapp.xml.

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-06-12

   [~cwilliams] This ticket says "In Review", but thats probably because it was cloned from another one (TIMOB-26077)? We will take a look.</li>
<li>Hans Knöchel 2018-06-12

   So after looking into this a bit, there is one thing I am wondering about before digging deeper: The method only allows strings, so using it as <code>Ti.UI.convertUnits(20, Ti.UI.UNIT_PX)</code> will cause a type error and <code>Ti.UI.convertUnits('20', Ti.UI.UNIT_PX)</code> works fine. 
   
   After that, the issue is [here](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiDimension.m#L75)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/Classes/TiDimension.m#L75)</a>, where we check for string types before even getting the chance to check for the ti.ui.defaultunit (which is only checked for Number types right now). I would look into Android to see how they prioritize input types and change our implementation based on that. 
   
   *EDIT*: Found a solution that passes all local tests, adding a PR now. Will take the chance to add  unit-tests for the API as well.</li>
<li>Hans Knöchel 2018-06-12

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/10101" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10101</a>
   
   Unit-Tests coming after CR.</li>
<li>Christopher Williams 2018-11-13

   <a href="https://github.com/appcelerator/titanium_mobile/pull/10462" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10462</a></li>
<li>Samir Mohammed 2018-11-21

   *Closing ticket* Verified fix in SDK version <code>8.0.0.v20181120171602</code>. Tested using the following test case: 
   <code><pre>
   const logicalDensityFactor = Ti.Platform.displayCaps.logicalDensityFactor;
   const dpi = Ti.Platform.displayCaps.dpi;
   // When ti.ui.defaultunit is px, test value as Number and String
   Ti.API.info('should be roughly 2.54: ' + Ti.UI.convertUnits(dpi + '', Ti.UI.UNIT_CM));
   Ti.API.info('should be roughly 2.54: ' + Ti.UI.convertUnits(dpi, Ti.UI.UNIT_CM));
   Ti.API.info('should be roughly 1: ' + Ti.UI.convertUnits(logicalDensityFactor + '', Ti.UI.UNIT_DIP));
   Ti.API.info('should be roughly 1: ' + Ti.UI.convertUnits(logicalDensityFactor, Ti.UI.UNIT_DIP));
   Ti.API.info('should be exactly 1: ' + Ti.UI.convertUnits(dpi + '', Ti.UI.UNIT_IN));
   Ti.API.info('should be exactly 1: ' + Ti.UI.convertUnits(dpi, Ti.UI.UNIT_IN));
   Ti.API.info('should be roughly 25.4: ' + Ti.UI.convertUnits(dpi + '', Ti.UI.UNIT_MM));
   Ti.API.info('should be roughly 25.4: ' + Ti.UI.convertUnits(dpi, Ti.UI.UNIT_MM));
   
   // When ti.ui.defaultunit is in, test value as Number and String
   Ti.API.info('should be roughly 2.54: ' + Ti.UI.convertUnits('1', Ti.UI.UNIT_CM));
   Ti.API.info('should be roughly 2.54: ' + Ti.UI.convertUnits(1, Ti.UI.UNIT_CM));
   Ti.API.info('should be roughly ' + (dpi / logicalDensityFactor) + ': ' + Ti.UI.convertUnits('1', Ti.UI.UNIT_DIP));
   Ti.API.info('should be roughly ' + (dpi / logicalDensityFactor) + ': ' + Ti.UI.convertUnits(1, Ti.UI.UNIT_DIP));
   Ti.API.info('should be roughly ' + dpi + ': ' + Ti.UI.convertUnits('1', Ti.UI.UNIT_PX));
   Ti.API.info('should be roughly ' + dpi + ': ' + Ti.UI.convertUnits(1, Ti.UI.UNIT_PX));
   </pre></code>
   
   *Note** Made sure to change <code>ti.ui.defaultunit</code> in the <code>tiapp.xml</code> to the correct unit being tested. 
   
   *Test Environment*
   <code><pre>
   APPC Studio: 5.1.0.201808080937
   iPhone 6 Sim (iOS 12.1)
   APPC CLI: 7.0.6
   Operating System Name: Mac OS Mojave
   Operating System Version: 10.14.1
   Node.js Version: 8.9.1
   Xcode 10.1
   </pre></code>
   
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-26113.json">JSON Source</a></p>