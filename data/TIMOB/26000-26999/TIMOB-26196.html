---
title: "[TIMOB-26196] iOS: Move Ti.Media microphone related APIs to AVAudioRecorder and remove 3rd-party library"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-10-25T10:54:29.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>debt, ti.media</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2018-07-10T19:44:50.000+0000</td></tr>
<tr><th>Updated</th><td>2018-10-25T14:25:13.000+0000</td></tr>
</table>

<h3>Description</h3>

iOS should be using AVAudioRecorder for mic recording related APIs, but is using a very, very old 3rd-party library: [SCListener](<a href="https://github.com/stephencelis/sc_listener)." rel="nofollow" target="_blank">https://github.com/stephencelis/sc_listener).</a> Full affected list of API's:
- startMicrophoneMonitor()
- stopMicrophoneMonitor()
- peakMicrophonePower (property)
- averageMicrophonePower (property)

This does not have to be a breaking change as the newer API's are pretty solid to use. We should also add an example for this into our KitchenSink (cc [~topener])

<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2018-07-10

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/10166" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10166</a>
   
   Test-Case: <a href="https://gist.github.com/hansemannn/1414ea2d11238d1ce99d0528cc4d0cc7" rel="nofollow" target="_blank">https://gist.github.com/hansemannn/1414ea2d11238d1ce99d0528cc4d0cc7</a></li>
<li>Samir Mohammed 2018-10-12

   On SDK Version <code>7.4.1.v20181008103750</code> everything seems to be working fine using the test case mentioned above but on SDK version <code>7.5.0.v20181010051919</code> I see the following error:
   <code><pre>
   [ERROR] :  Script Error {
   [ERROR] :      column = 62;
   [ERROR] :      line = 31;
   [ERROR] :      message = "-[MediaModule hasAudioRecorderPermissions:]: unrecognized selector sent to instance 0x101029400";
   [ERROR] :      nativeStack = "3   CoreFoundation  0x00000001b9a837e8 &lt;redacted&gt; + 1412\n4   CoreFoundation  0x00000001b9a8548c _CF_forwarding_prep_0 + 92\n5   Ti8   0x00000001009db578 Ti8 + 636280\n6   CoreFoundation  0x00000001b9a85630 &lt;redacted&gt; + 144\n7   CoreFoundation  0x00000001b9963560 &lt;redacted&gt; + 292\n8   Ti8   0x0000000100958fbc Ti8 + 102332\n9   Ti8   0x00000001009576a0 Ti8 + 95904\n10  Ti8   0x00000001009c5d00 Ti8 + 548096\n11  Ti8   0x00000001009573c0 Ti8 + 95168\n12  JavaScriptCore  0x00000001c16a6b58 &lt;redacted&gt; + 348\n13  JavaScriptCore  0x00000001c1d90f5c &lt;redacted&gt; + 352\n14  JavaScriptCore  0x00000001c167ddd8 &lt;redacted&gt; + 29992\n15  JavaScriptCore  0x00000001c16766b4 &lt;redacted&gt; + 308\n16  JavaScriptCore  0x00000001c1cee1ac &lt;redacted&gt; + 424\n17  JavaScriptCore  0x00000001c1ea4d1c _ZN3JSC12profiledCallEPNS_9ExecStateENS_15ProfilingReasonENS_7JSValueENS_8CallTypeERKNS_8CallDataES3_RKNS_7ArgListE + 188\n18  JavaScriptCore  0x00000001c16ac08c JSObjectCallAsFunction + 368\n19  Ti8   0x0000000100a63244 Ti8 + 1192516";
   [ERROR] :      sourceURL = "file:///var/containers/Bundle/Application/21AB9986-4D22-4DB1-8F33-27A196B6BC87/Ti8.app/app.js";
   [ERROR] :      stack = "    at [native code]\n    at buttonHandler(/app.js:31:62)";
   [ERROR] :      toJSON = "&lt;KrollCallback: 0x280f2ac40&gt;";
   [ERROR] :  }
   </pre></code>
   </li>
<li>Vijay Singh 2018-10-24

   PR for fixing mentioned issue - <a href="https://github.com/appcelerator/titanium_mobile/pull/10398" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10398</a></li>
<li>Samir Mohammed 2018-10-24

   FR Passed, waiting on Jenkins build and CR.</li>
<li>Jan Vennemann 2018-10-25

   CR passed, Jenkins build is also ready</li>
<li>Samir Mohammed 2018-10-25

   *Closing ticket.* Verified fix in SDK version <code>7.5.0.v20181025051112</code>.
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/10398" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10398</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-26196.json">JSON Source</a></p>