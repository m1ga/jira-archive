---
title: "[TIMOB-26204] Android: TransformAfterLayout NullPointerException in Ti.Animation"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-08-24T01:25:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.2.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android</td></tr>
<tr><th>Reporter</th><td>Sergey Volkov</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2018-07-11T15:21:30.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-24T01:26:11.000+0000</td></tr>
</table>

<h3>Description</h3>

<code><pre>
[ERROR] TiApplication: java.lang.NullPointerException: Attempt to invoke virtual method 'void org.appcelerator.titanium.proxy.TiViewProxy.handlePendingAnimation(boolean)' on a null object reference
[ERROR] TiApplication:  at org.appcelerator.titanium.view.TiUIView$1$1.callAsync(TiUIView.java:549)
[ERROR] TiApplication:  at org.appcelerator.titanium.util.TiAnimationBuilder$AnimatorListener.onAnimationEnd(TiAnimationBuilder.java:1371)
[ERROR] TiApplication:  at com.nineoldandroids.animation.AnimatorSet$AnimatorSetListener.onAnimationEnd(AnimatorSet.java:756)
[ERROR] TiApplication:  at com.nineoldandroids.animation.ValueAnimator.endAnimation(ValueAnimator.java:1034)
[ERROR] TiApplication:  at com.nineoldandroids.animation.ValueAnimator.access$11(ValueAnimator.java:1024)
[ERROR] TiApplication:  at com.nineoldandroids.animation.ValueAnimator$AnimationHandler.handleMessage(ValueAnimator.java:669)
[ERROR] TiApplication:  at android.os.Handler.dispatchMessage(Handler.java:102)
[ERROR] TiApplication:  at android.os.Looper.loop(Looper.java:135)
[ERROR] TiApplication:  at android.app.ActivityThread.main(ActivityThread.java:5221)
[ERROR] TiApplication:  at java.lang.reflect.Method.invoke(Native Method)
[ERROR] TiApplication:  at java.lang.reflect.Method.invoke(Method.java:372)
[ERROR] TiApplication:  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:899)
[ERROR] TiApplication:  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:694)
</pre></code>
<a href="https://github.com/appcelerator/titanium_mobile/blob/0a7dce77bb4fbdd21370512800a61542670e6006/android/titanium/src/java/org/appcelerator/titanium/view/TiUIView.java#L549" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/0a7dce77bb4fbdd21370512800a61542670e6006/android/titanium/src/java/org/appcelerator/titanium/view/TiUIView.java#L549</a>

<h3>Comments</h3>

<ol>
<li>Sergey Volkov 2018-07-11

   Fix:
   <code><pre>
   --- a/android/titanium/src/java/org/appcelerator/titanium/view/TiUIView.java
   +++ b/android/titanium/src/java/org/appcelerator/titanium/view/TiUIView.java
   @@ -546,7 +546,7 @@ public abstract class TiUIView
    					public void callAsync(KrollObject krollObject, HashMap args) {}
    					public void callAsync(KrollObject krollObject, Object[] args) {
    						bTransformPending.set(false);
   -						proxy.handlePendingAnimation(true);
   +						p.handlePendingAnimation(true);
    					}
    				});
    				animBuilder.start(p, v);
   </pre></code>
   </li>
<li>Sharif AbuDarda 2018-07-12

   Hello [~s.volkov], Thanks for the ticket. Our engineering will look into it.</li>
<li>Hans Knöchel 2018-07-12

   [~s.volkov] Can you let us know in which situations this error occurs? A minimal test case would be lit!</li>
<li>Sergey Volkov 2018-07-12

   It happens after closing window with views on which were periodically applied transformation like this
   <code><pre>
   $.indicator.transform = Ti.UI.create2DMatrix().rotate(angle)
   </pre></code>
   I think it will be hard to intentionally reproduce this, crash is happening in callback, by the time view was already released and proxy became <code>null</code>.
   </li>
<li>Sergey Volkov 2018-07-13

   <code><pre>
   var matrix = Ti.UI.create2DMatrix();
   
   function open() {
     var closed = false;
     function rotate(view, angle) {
       if (closed) {
         return;
       }
       console.log('Rotate');
       angle += 45;
       if (angle >= 360) {
         angle -= 360;
       }
       view.transform = matrix.rotate(angle);
       setTimeout(function() {
         rotate(view, angle)
       }, 150)
     }
   
     var window = Ti.UI.createWindow({
       width: Ti.UI.FILL,
       height: Ti.UI.FILL,
       backgroundColor: 'white',
       layout: 'horizontal'
     });
   
     var view = Ti.UI.createImageView({
       width: 50,
       height: 50,
       image: 'assets/images/tab2.png'
     });
   
     rotate(view, 0);
   
     window.addEventListener('close', function onClose() {
       window.removeEventListener('close', onClose);
       console.log('CLOSE');
       closed = true;
     });
     window.add(view);
     window.open();
   }
   
   var win = Ti.UI.createWindow({title: 'TIMOB-26204'});
   var btn = Ti.UI.createButton({title: 'Open window'});
   btn.addEventListener('click', open);
   win.add(btn);
   win.open();
   </pre></code>
   
   1. tap "Open window" button
   2. wait for spinning image
   3. press back button.
   </li>
<li>Hans Knöchel 2018-07-24

   PR (community): <a href="https://github.com/appcelerator/titanium_mobile/pull/10202" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10202</a></li>
<li>Samir Mohammed 2018-07-26

   *Closing ticket*, Verified fix in SDK Version: <code>7.4.0.v20180726102127</code>
   
   *FR Passed (Test Steps):*
   <h4>Created a titanium application with the test case mentioned above </h4>
   <h4>Ran the App</h4>
   <h4>Pressed the "Open window" button</h4>
   <h4>Waited for the spinning image</h4>
   <h4>pressed the back button</h4>
   <h4>Repeated the above steps various times to ensure no error was shown or the application did not crash like previously </h4>
   
   *Test Environment*
   <code><pre>
   APPC Studio: 5.0.0.201712081732
   APPC CLI: 7.0.4
   Nexus 6p Emulator (7.1)
   Operating System Name: Mac OS High Sierra
   Operating System Version: 10.13
   Node.js Version: 8.9.1
   Xcode 9.2
   </pre></code>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-26204.json">JSON Source</a></p>