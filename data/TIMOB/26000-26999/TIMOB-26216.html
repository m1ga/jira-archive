---
title: "[TIMOB-26216] iOS CLI: Incremental build does not remove unencrypted JS files when switching deploy type from "development" to "test""
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-08-24T17:21:44.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>build, cli, ios</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2018-07-18T01:22:16.000+0000</td></tr>
<tr><th>Updated</th><td>2018-09-20T15:14:22.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
There is an iOS incremental build issue where if you build for the iOS Simulator first, then an iOS device afterwards, the resulting iOS app bundle will contain both encrypted <code>.js</code> files an unencrypted plain text <code>.js</code> files. Builds for device (ie: deployment type "test" and "production") must encrypt all <code>.js</code> files.

This is *+not+* an issue with production/release builds.
This is only an issue with debug builds.

*Steps to reproduce:*
<h4>On Mac, open a "Finder" window.</h4>
<h4>Go to an existing Titanium project directory.</h4>
<h4>Delete its "build" directory if it has one.</h4>
<h4>Open a "Terminal" window.</h4>
<h4>In the terminal, <code>cd</code> to the same project directory.</h4>
<h4>Run: <code>appc run -p ios -D development --build-only</code></h4>
<h4>Wait for the build to finish.</h4>
<h4>Run: <code>appc run -p ios -D test --build-only</code></h4>
<h4>Wait for the build to finish.</h4>
<h4>In "Finder", go to directory: <code>./build/iphone/build/Products/Debug-iphonesimulator</code></h4>
<h4>Right click on the app bundle file and select "Show Package Contents" from the popup menu.</h4>

*Result:*
The app bundle for the "test" build contains plain text <code>.js</code> files such as "app.js" when it shouldn't. A "test" build must encrypt all <code>.js</code> files.

*Notes:*
* This is an incremental build issue. The app bundle includes both encrypted <code>.js</code> files and plain text <code>.js</code> files from the previous "development" build.
* I'm not sure if the reverse is true. When doing a "test" build first and then doing a "development" build, the generated <code>ApplicationRouting.m</code> does not contain any assets.

<h3>Comments</h3>

<ol>
<li>Chris Barber 2018-07-18

   The bug is simple. It has nothing to do with device or dist builds, debug vs release, the <code>encryptJS</code> flag, or going back and forth between sim and device builds.
   
   The <code>this.forceCleanBuild</code> check doesn't take into account the <code>\-\-deploy\-type</code> changing, which only changes if you explicitly set it via the command line for a sim or device build.</li>
<li>Hans Knöchel 2018-07-19

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/10187" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10187</a>
   Test-Case: See above (can also be done with <code>ti build</code> instead of <code>appc run</code>)
   
   [~cbarber] I placed it in the <code>forceCleanBuild</code> check so we get a fresh build directory and clean up all old (unencrypted) assets. If works fine locally, let me know your thoughts. Thanks!!
   
   *EDIT*: Can this also be a 7.4.0 or should we wait for 7.4.0?</li>
<li>Samir Mohammed 2018-09-20

   *Closing ticket.* Verified fix in SDK version <code>7.5.0.v20180906093938</code>. Incremental build now removes unencrypted JS files when switching deploy type from "development" to "test".
   
   *FR Passed (Test Steps)*
   Followed the instructions above in the description
   <code><pre>
   On Mac, open a "Finder" window.
   Go to an existing Titanium project directory.
   Delete its "build" directory if it has one.
   Open a "Terminal" window.
   In the terminal, cd to the same project directory.
   Run: appc run -p ios -D development --build-only
   Wait for the build to finish.
   Run: appc run -p ios -D test --build-only
   Wait for the build to finish.
   In "Finder", go to directory: ./build/iphone/build/Products/Debug-iphonesimulator
   Right click on the app bundle file and select "Show Package Contents" from the popup menu.
   </pre></code>
   Know longer able to see unencrypted JS files when switching deploy type from "development" to "test".
   
   *Test Environment*
   <code><pre>
   APPC Studio: 5.1.0.201808080937
   APPC CLI: 7.0.7-master.1
   Operating System Name: Mac OS High Sierra
   Operating System Version: 10.13.6
   Node.js Version: 8.9.1
   Xcode 10.0 GM
   </pre></code>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-26216.json">JSON Source</a></p>