---
title: "[TIMOB-26225] Android: TableView leaks memory when overwriting "data" property"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-07-31T18:20:38.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.2.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>TableView, android, memoryleak</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2018-07-21T07:41:58.000+0000</td></tr>
<tr><th>Updated</th><td>2020-08-31T16:14:21.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
Replacing a <code>TableView</code>'s "data" array property causes a memory leak where the previous array of rows do not get garbage collected.

*Steps to reproduce:*
_(Below requires an Android emulator and Chrome web browser to be installed.)_
<h4>Create a "classic" Titanium project with the below code.</h4>
<h4>Go to the project directory at the command line.</h4>
<h4>Enter: <code>appc ti build -p android --debug-host /127.0.0.1:51388</code></h4>
<h4>Wait for the app to launch. It'll "hang" on the splash screen.</h4>
<h4>In the log, copy the the "chrome-devtools://devtools/bundled/inspector.html?..." URL.</h4>
<h4>Open the Chrome browser and paste the copied URL.</h4>
<h4>In Chrome, select the "Memory" tab.</h4>
<h4>Select the "Allocation instrumentation on timeline" radio button.</h4>
<h4>Click the "Start" button.</h4>
<h4>Select the "Sources" tab.</h4>
<h4>Click the "Resume script execution" toolbar button in top-right corner. Looks like: [>]</h4>
<h4>Wait for the Titanium app to display a TableView.</h4>
<h4>Click the "Reload" button in the bottom-right corner of the app.</h4>
<h4>Click the Android back button.</h4>
<h4>In Chrome, select the "Memory" tab.</h4>
<h4>In Chrome, top-left corner, click the "Stop recording heap profile" toolbar button.</h4>
<h4>Under the "Constructor" column, expand the "Label" tree.</h4>
<h4>Note that 50 Labels are listed under it. These have not been garbage collected.</h4>

<code><pre>
function createTableData() {
	var tableData = [];
	var maxIndex = 50;
//var maxIndex = Math.floor(Math.random() * 100) + 1;
	for (var index = 1; index &lt;= maxIndex; index++) {
		var row = Ti.UI.createTableViewRow();
		row.add(Ti.UI.createLabel({ text: "Row " + index.toString() }));
		tableData.push(row);
	}
	return tableData;
}

var window = Ti.UI.createWindow({ exitOnClose: false });
var container = Ti.UI.createView({
	width: Ti.UI.FILL,
	height: Ti.UI.FILL,
});
var tableView = Ti.UI.createTableView({
	data: createTableData(),
});
container.add(tableView);
var reloadButton = Ti.UI.createButton({
	title: "Reload",
	bottom: "10dp",
	right: "10dp",
});
reloadButton.addEventListener("click", function(e) {
	Ti.API.info("@@@ Reloading table data.");
	tableView.data = createTableData();
});
container.add(reloadButton);
window.add(container);
window.open();
</pre></code>

*Notes:*
* If a <code>TableView</code> is garbage collected, then its rows are correctly garbage collected as well. This is only an issue when overwriting the rows via the "data" property.
* This is an issue for Alloy since its generated code will replace the <code>TableView</code> "data" array any time the model changes via a "fetch", "destroy", "change", "add", "remove", or "reset" event.


<h3>Comments</h3>

<ol>
<li>Gary Mathews 2018-07-26

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/10195" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10195</a>
   7_3_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/10203" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10203</a>
   7_2_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/10197" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10197</a></li>
<li>Sergey Volkov 2018-07-27

   You can't simply call [section.releaseViews()](<a href="https://github.com/appcelerator/titanium_mobile/pull/10195/files#diff-9f3bae7cb02c715af9fc45d9bc16b732R678)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10195/files#diff-9f3bae7cb02c715af9fc45d9bc16b732R678)</a> in cleanupSections, because sometimes you will come into this method from [TTVListAdapter.getView](<a href="https://github.com/appcelerator/titanium_mobile/blob/7_2_X/android/modules/ui/src/java/ti/modules/titanium/ui/widget/tableview/TiTableView.java#L186)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/7_2_X/android/modules/ui/src/java/ti/modules/titanium/ui/widget/tableview/TiTableView.java#L186)</a> (attention on notice).
   [Here](<a href="https://gist.github.com/drauggres/4ab66ec8175665ec277384d0b942afc4)" rel="nofollow" target="_blank">https://gist.github.com/drauggres/4ab66ec8175665ec277384d0b942afc4)</a> is stack trace for this case.</li>
<li>Sergey Volkov 2018-07-27

   Click the "Reload" button until app hangs.
   <code><pre>
   var image = "<a href="https://raw.githubusercontent.com/appcelerator/titanium_mobile/" rel="nofollow" target="_blank">https://raw.githubusercontent.com/appcelerator/titanium_mobile/</a>" +
   		"master/.github/logo-titanium.png";
   
   function createTableData() {
   	var tableData = [];
   	var maxIndex = 50;
   //var maxIndex = Math.floor(Math.random() * 100) + 1;
   	for (var index = 1; index &lt;= maxIndex; index++) {
   		var row = Ti.UI.createTableViewRow();
   		var view = Ti.UI.createView({
   			width: Ti.UI.FILL,
   			height: Ti.UI.SIZE,
   			backgroundColor: '#555'
   		});
   		var url = [image, '?time=', Date.now(), '_', index].join('');
   		view.add(Ti.UI.createImageView({
   			width: 20,
   			height: 20,
   			defaultImage: image,
   			image: url
   		}));
   		row.add(view);
   		tableData.push(row);
   	}
   	return tableData;
   }
   
   var window = Ti.UI.createWindow({ exitOnClose: false });
   var container = Ti.UI.createView({
   	width: Ti.UI.FILL,
   	height: Ti.UI.FILL,
   });
   var tableView = Ti.UI.createTableView({
   	data: createTableData(),
   });
   container.add(tableView);
   var reloadButton = Ti.UI.createButton({
   	title: "Reload",
   	bottom: "10dp",
   	right: "10dp",
   });
   reloadButton.addEventListener("click", function(e) {
   	Ti.API.info("@@@ Reloading table data.");
   	tableView.data = createTableData();
   });
   container.add(reloadButton);
   window.add(container);
   window.open();
   </pre></code></li>
<li>Lokesh Choudhary 2018-08-01

   Verified the fix in SDK's 7.4.0.v20180801012329, 7.3.0.v20180731101200 &  7.2.1.v20180726150551.
   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-26225.json">JSON Source</a></p>