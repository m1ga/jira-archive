---
title: "[TIMOB-26228] Android: Cannot get current activity in native module when using 7.3.0+"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2018-07-25T01:50:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-07-22T13:48:45.000+0000</td></tr>
<tr><th>Updated</th><td>2018-08-06T17:37:03.000+0000</td></tr>
</table>

<h3>Description</h3>

I have a module where I want to configure an SDK by passing the current activity to it automatically  on app start. We have the <code>onCreate</code> method via the <code>@Kroll.onCreate</code> annotation, but neither of the following methods worked there:
- <code>getActivity()</code> (because of the static context)
- <code>TiApplication.getAppRootOrCurrentActivity()</code> errors: 
{quote}
No valid root or current activity found for application instance
{quote}
- TiApplication.getInstance().getCurrentActivity(): Same as above

I also tried invoking them in the constructor of the module but that did not work either. I am trying to prevent a manually <code>initialize()</code> call from the module, so I am wondering if there is a better approach here.

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-07-22

   Update: It seems to not crash with:
   <code><pre>
   	@Override
   	public void onStart(Activity activity) {
   		// Use "activity" from here
   	}
   </pre></code>
   But it still logs this:
   <code><pre>
   [ERROR] TiApplication: (main) [817,864] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [2,866] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [9,875] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [5,880] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [1,881] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [1,882] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [3,885] No valid root or current activity found for application instance
   [WARN]  TiAndroid: (main) [1,886] Application instance no longer available. Unable to get current activity.
   [ERROR] TiApplication: (main) [1,887] No valid root or current activity found for application instance
   [WARN]  TiAndroid: (main) [1,888] Application instance no longer available. Unable to get current activity.
   [WARN]  TiAndroid: (main) [0,888] Application instance no longer available. Unable to get current activity.
   [ERROR] TiApplication: (main) [4,892] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [7,899] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [2,901] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [1,902] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [0,902] No valid root or current activity found for application instance
   </pre></code>
   
   Update 2: It actually works fine in SDK 7.2.0 and does not any warning. Considering this a 7.3.0 regression, updating the ticket accordingly.</li>
<li>Joshua Quick 2018-07-25

   Titanium does not have a Java <code>@Kroll.onCreate</code> annotation.
   Perhaps you mean <code>@Kroll.onAppCreate</code> instead?
   
   If so, then that method will be called when the Android Java <code>Application</code> instance gets created during a cold-start, but before an Android <code>Activity</code> gets created. This is by Google's design, not ours. You cannot fetch an <code>Activity</code> on app startup because no UI has been created yet. So, yes, the getters for an activity should return <code>null</code> at this point. This is the correct behavior.
   
   What you can do instead is override the Java <code>KrollModule.onStart(Activity)</code> method like [~hknoechel] has suggested.
   <a href="https://docs.appcelerator.com/module-apidoc/latest/android/org/appcelerator/kroll/KrollModule.html#onStart(android.app.Activity)" rel="nofollow" target="_blank">https://docs.appcelerator.com/module-apidoc/latest/android/org/appcelerator/kroll/KrollModule.html#onStart(android.app.Activity)</a>
   
   Alternatively, only call the <code>TiApplication.getAppRootOrCurrentActivity()</code> when your module's APIs have been called by JavaScript. An activity is guaranteed to be available then because the JavaScript runtime is created when the splash screen activity gets displayed. The splash screen activity hosts the JavaScript runtime and when you close all activities the JavaScript runtime is terminated. So, this is the best solution.</li>
<li>Joshua Quick 2018-07-25

   This is not a regression. The warnings on startup are harmless. We've reduced the number of warnings on app startup in Titanium 7.4.0. We'll look into getting rid of the rest of the false-positive warnings in the future.</li>
<li>Hans Knöchel 2018-07-25

   [~jquick] I am not feeling good resolving this already. I just tested a few of my other modules and they also spit out the error when accessing our activity and they are not called from <code>onCreate</code>:
   <code><pre>
   [ERROR] TiApplication: (main) [480,515] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [2,517] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [10,527] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [5,532] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [2,534] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [1,535] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [2,537] No valid root or current activity found for application instance
   [WARN]  TiAndroid: (main) [1,538] Application instance no longer available. Unable to get current activity.
   [ERROR] TiApplication: (main) [0,538] No valid root or current activity found for application instance
   [WARN]  TiAndroid: (main) [0,538] Application instance no longer available. Unable to get current activity.
   [WARN]  TiAndroid: (main) [0,538] Application instance no longer available. Unable to get current activity.
   [ERROR] TiApplication: (main) [1,539] No valid root or current activity found for application instance
   [WARN]  ContextImpl: Failed to ensure /dev/null/Android/data/com.appc.firebasedemo/cache: 400
   [ERROR] TiApplication: (main) [9,548] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [1,549] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [0,549] No valid root or current activity found for application instance
   [ERROR] TiApplication: (main) [1,550] No valid root or current activity found for application instance
   </pre></code></li>
<li>Eric Merriman  2018-08-06

   Closing as invalid. If incorrect, please reopen.</li>
</ol>


<p><a href="/TIMOB/TIMOB-26228.json">JSON Source</a></p>