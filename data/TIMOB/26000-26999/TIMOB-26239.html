---
title: "[TIMOB-26239] Android: Window leak in Ti.UI.currentWindow"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-04-23T18:28:39.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.3.0, Release 7.2.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, cache, engSchedule, leak, module, require</td></tr>
<tr><th>Reporter</th><td>Sergey Volkov</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2018-07-26T09:02:38.000+0000</td></tr>
<tr><th>Updated</th><td>2019-04-23T18:28:39.000+0000</td></tr>
</table>

<h3>Description</h3>

Steps to reproduce:
1. Create application, put attached files in <code>Resources</code>
2. Run <code>ti build</code> with <code>--debug-host localhost:8990</code>
3. Open <code>chrome-devtools://</code> link in Chrome
4. Resume script execution, wait for app load
5. In memory tab, press "Take snapshot"
6. In app press "OPEN 2ND WINDOW"
7. In memory tab, press "Take snapshot"
8. In app press "OPEN 3RD WINDOW"
9. In memory tab, press "Take snapshot"
10. In app press back button
11. In memory tab, press "Take snapshot"
12. In app press back button
13. In memory tab, press "Take snapshot"

Now you got five snapshots.
1. Select "Snapshot 2"
2. Change "Summary" to "Comparison", put "Window" in "Class filter"
3. Expand "Window", observe one new "Window" instance, remember @id
4. Select "Snapshot 5", put "Window" in "Class filter"
5. Expand "Window", observe three instance of "Window"
6. Select "Window" instance with @id from (3)
7. Observe "Retainers" below

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26239_65386/0001-Android-fix-Ti.UI.currentWindow-leak.patch">0001-Android-fix-Ti.UI.currentWindow-leak.patch</td></td><td>2018-07-26T09:47:01.000+0000</td><td>3585</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26239_65384/app.js">app.js</td></td><td>2018-07-26T08:57:07.000+0000</td><td>276</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26239_65383/win2.js">win2.js</td></td><td>2018-07-26T08:57:07.000+0000</td><td>333</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26239_65382/win3.js">win3.js</td></td><td>2018-07-26T08:57:07.000+0000</td><td>339</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sergey Volkov 2018-07-26

   In summary: first <code>require</code> (once for each module) cause enclosuring current "Window" in "Ti.UI.currentWindow" which persist in context of this module. Since modules are cached this means that this "Window" (and all its children) will not be collected by gc. 
   
   Same goes for "Ti.UI.currentActivity".</li>
<li>Hans Knöchel 2018-07-26

   The <code>Ti.UI.currentWindow</code> property has been removed since 6.0.0, but I assume you mean the general window scope? cc [~jquick]</li>
<li>Sergey Volkov 2018-07-26

   >The Ti.UI.currentWindow property has been removed since 6.0.0
   It is still there for android, look at the patch in attachments.</li>
<li>Hans Knöchel 2018-07-26

   I see! But shouldn't it be removed there as well? I see that your PR might do exactly that (not an Android pro here) :-)</li>
<li>Joshua Quick 2018-07-26

   This is something we're already actively looking into. Pleas see the below.
   <a href="https://github.com/appcelerator/titanium_mobile/pull/10195" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10195</a>
   </li>
<li>Sergey Volkov 2018-07-27

   It's good to know, but actually that PR does not cover this case. Leak is in <code>titanium.js</code> and not in java side.</li>
<li>Sergey Volkov 2018-08-07

   bq. Status: RESOLVED
   The PR that Joshua mentioned above and both PRs labeled as "TIMOB-26239" are not related to this issue.</li>
<li>Sergey Volkov 2018-08-13

   Hello everyone.
   Just trying to say that nothing has been done yet to address this issue.
   
   P.S. "User mention" feature seems not working (or disabled for me), hope Joshua Quick and Gary Mathews will receive notification anyway.</li>
<li>Joshua Quick 2018-08-15

   We'll re-look into this later. For now, we're rolling with what we've got for 7.3.0 since it has full Android 8 support and targeting it is currently required by Google Play.</li>
<li>Sergey Volkov 2019-03-05

    <a href="https://github.com/appcelerator/titanium_mobile/pull/10749" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10749</a></li>
<li>Gary Mathews 2019-03-21

    8_0_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/10792" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10792</a></li>
<li>Keerthi Mahalingam 2019-03-28

    FR Passed. waiting for resolving  jenkin test failure to merge.</li>
<li>Christopher Williams 2019-04-03

    Merged to 8_0_X and master</li>
<li>Keerthi Mahalingam 2019-04-23

    Verified the fix on SDK 8.1.0.v20190423074844 and 8.0.1.v20190418104938. works as expected.Closing
    <code><pre>
    Name                        = Mac OS X
      Version                     = 10.13.6
    Node.js
      Node.js Version             = 8.9.1
      npm Version                 = 5.5.1
    Titanium CLI
      CLI Version                 = 5.1.1
    Appc cli =7.0.11-70X.1
    Device = one plus 5t android 9
    Emulator =pixel android 8
    Titanium SDK</pre></code></li>
</ol>


<p><a href="/TIMOB/TIMOB-26239.json">JSON Source</a></p>