---
title: "[TIMOB-26292] Windows: Switching to JsRT (Chakra) for better performance"
---
<table>
<tr><th>Type</th><td>Epic</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 7.4.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Windows</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Kota Iguchi</td></tr>
<tr><th>Assignee</th><td>Kota Iguchi</td></tr>
<tr><th>Created</th><td>2018-08-13T00:59:21.000+0000</td></tr>
<tr><th>Updated</th><td>2019-01-08T01:03:12.000+0000</td></tr>
</table>

<h3>Description</h3>

Peformance has been the issue on Windows for a long time. From what I observed, some basic JavaScript operations (like calling constructor, accessing properties and functions) against Titanium proxy objects are simply slow. For instance, creating 200 proxy objects on Windows (Titanium 7.4.0.GA) takes about 2 seconds on Windows locally for me.

<code><pre>
var win = Ti.UI.createWindow({ backgroundColor: 'green' });

win.addEventListener('open', function() {
    var start = +new Date();
    for (var i = 0; i < 200; i++) {
        win.add(Ti.UI.createView({
            width: 50, height: 50, left: i * 10, top: i * 10
        }));
    }
    // setTimeout() effectively push tasks on UI thread.
    // This can be useful when you need to see actual UI response time.
    setTimeout(function() {
        alert((+new Date() - start) + ' seconds elapsed');
    }, 0)
});
win.open(); 
</pre></code>

We have been improving performance overall and have archived huge improvements like TIMOB-23637 but yet we can't keep up with other platforms regarding performance now, I am guessing that huge difference between other platforms (especially between iOS) is that the unavailability of JIT (Just In Time) compiler on our JavaScript engine. On Windows, JIT is not enabled because it is not available yet. It is huge disadvantage regarding performance. 

So this is quite fundamental issue. In order to improve performance, we might want to consider developing JavaScriptCore JIT for Windows, or try switching to Chakra, a JavaScript engine which Microsoft developed, which should have JIT enabled and should provide much better performance unlike our custom JavaScriptCore port. Again this requires big-and-fundamental changes regarding our Titanium (AKA <code>TitaniumKit</code> and <code>HAL</code>) framework overall technically, and I don't think we can archive huge peformance improvements without this.

<h3>Comments</h3>

<ol>
<li>Kota Iguchi 2018-08-14

   According to ChakraCore [JavaScript Runtime (JSRT) reference](<a href="https://github.com/Microsoft/ChakraCore/wiki/JavaScript-Runtime-%28JSRT%29-Reference)" rel="nofollow" target="_blank">https://github.com/Microsoft/ChakraCore/wiki/JavaScript-Runtime-%28JSRT%29-Reference)</a>, it is highly likely feasible to implement part of HAL APIs such as JSValue because ChakraCore has similar APIs like JSValueRef. ChakraCore also provides a way to define native callback functions by using [JsNativeFunction](<a href="https://github.com/Microsoft/ChakraCore/wiki/JsNativeFunction)" rel="nofollow" target="_blank">https://github.com/Microsoft/ChakraCore/wiki/JsNativeFunction)</a> that gives us a way to simulate <code>HAL::JSExport</code> API. One thing I noticed that's missing is the ability to define property callbacks. This is critical because HAL API needs it. So we might want to consider fundamental changes in HAL if we use ChakraCore, like generating getter/setter for Titanium properties by using <code>Object.defineProperties</code> at startup. Luckily ChakraCore provides a way to serialize scripts using [JsSerializeScript](<a href="https://github.com/Microsoft/ChakraCore/wiki/JavaScript-Runtime-%28JSRT%29-Overview#script-serialization-with-lazy-source-loading)" rel="nofollow" target="_blank">https://github.com/Microsoft/ChakraCore/wiki/JavaScript-Runtime-%28JSRT%29-Overview#script-serialization-with-lazy-source-loading)</a>, that may be very useful to pre-parse and lazy-load Titanium classes at runtime. The other downside is that ChakraCore doesn't support iOS and Android. It may be critical because originally HAL and TitaniumKit was aiming to be cross-platform.</li>
</ol>


<p><a href="/TIMOB/TIMOB-26292.json">JSON Source</a></p>