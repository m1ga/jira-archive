---
title: "[TIMOB-26339] iOS: Local notification not triggered when setting repeat (only 7.3.0.GA)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-08-29T06:43:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 7.3.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>ios, notifications</td></tr>
<tr><th>Reporter</th><td>Teun Klijn</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2018-08-27T13:37:36.000+0000</td></tr>
<tr><th>Updated</th><td>2018-11-07T09:26:22.000+0000</td></tr>
</table>

<h3>Description</h3>

I've noticed that local push notifications won't be shown when setting the repeat property, it does show when it's omitted. This seems to have started with SDK 7.3.0.GA.

Example:


<code><pre>
var win = Ti.UI.createWindow({
  backgroundColor: "white",
  layout: "vertical"
});

var repeatSwitch = Ti.UI.createSwitch();

var btn = Ti.UI.createButton({
  top: 50,
  title: "Schedule"
});

btn.addEventListener("click", function() {
  var not = {
    date: new Date(new Date().getTime() + 3000),
    alertTitle: 'Notification',
    alertBody: 'This is a notification',
    badge: 1,
    userInfo: {
      id: '1'
    },
    repeat: repeatSwitch.value ? "daily" : undefined
  };

  console.log('schedule: ' + JSON.stringify(not));

  Ti.App.iOS.scheduleLocalNotification(not);
});

win.add(btn);
win.add(Ti.UI.createLabel({
  text: "Repeat?"
}));
win.add(repeatSwitch);

win.addEventListener("open", function() {
  Ti.App.iOS.registerUserNotificationSettings({
    types: [
      Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,
      Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,
      Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE
    ]
  });
});

win.open();
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26339_65487/TiAppiOSProxy.m">TiAppiOSProxy.m</td></td><td>2018-08-28T12:02:08.000+0000</td><td>50508</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2018-08-27

   Hey there! We refactored the whole notifications-API to use the new UserNotifications framework in iOS 10+. Your issue sounds valid and we'll provide a fix for this early this week. Thank you!</li>
<li>Hans Knöchel 2018-08-28

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10289" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10289</a>
   PR (7_4_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/10291" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10291</a>
   PR (7_3_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/10290" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10290</a>
   
   Test-Case: Above
   
   [~teunklijn@telfort.nl] Can you please do me a favor and replace the attached  [^TiAppiOSProxy.m]  in the following directory:
   <code><pre>
   ~/Library/Application Support/Titanium/mobilesdk/osx/7.3.0.GA/iphone/Classes/TiAppiOSProxy.m
   </pre></code>
   You can make a backup of the old file to be sure. Let me know if it works properly now! Spontaneously, I didn't find a way to test if the notification will be triggered 24 hours later, but the new code looked good :-).</li>
<li>Teun Klijn 2018-08-28

   The attached TiAppiOSProxy.m seems to be identical to the one that I already have, so the notification doesn't trigger yet. I've tried the one from the pull request, but that also doesn't trigger. I could have used the wrong one.</li>
<li>Hans Knöchel 2018-08-28

   [~teunklijn@telfort.nl] Sorry, try again. It was the old one from an earlier Git revision.</li>
<li>Teun Klijn 2018-08-28

   It does work better now, the notification does trigger if you schedule only 1, but if you schedule 2 notifications in a row only the 2nd notification will appear. It doesn't matter if you set repeat or not, for example:
   
   <code><pre>
   var win = Ti.UI.createWindow({
     backgroundColor: "white",
     layout: "vertical"
   });
   
   var repeatSwitch = Ti.UI.createSwitch();
   
   var btn = Ti.UI.createButton({
     top: 50,
     title: "Schedule"
   });
   
   btn.addEventListener("click", function() {
     var not = {
       date: new Date(new Date().getTime() + 3000),
       alertTitle: 'Notification',
       alertBody: 'This is a notification 1',
       badge: 1,
       userInfo: {
         id: '1'
       },
       repeat: repeatSwitch.value ? "daily" : undefined
     };
   
     console.log('schedule: ' + JSON.stringify(not));
   
     Ti.App.iOS.scheduleLocalNotification(not);
   
     not = {
       date: new Date(new Date().getTime() + 6000),
       alertTitle: 'Notification',
       alertBody: 'This is a notification 2',
       badge: 1,
       userInfo: {
         id: '1'
       },
       repeat: repeatSwitch.value ? "daily" : undefined
     };
   
     console.log('schedule: ' + JSON.stringify(not));
   
     Ti.App.iOS.scheduleLocalNotification(not);
   });
   
   win.add(btn);
   win.add(Ti.UI.createLabel({
     text: "Repeat?"
   }));
   win.add(repeatSwitch);
   
   win.addEventListener("open", function() {
     Ti.App.iOS.registerUserNotificationSettings({
       types: [
         Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,
         Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,
         Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE
       ]
     });
   });
   
   win.open();
   </pre></code>
   </li>
<li>Hans Knöchel 2018-08-28

   That probably happens because the default <code>identifier</code> is used if not explicitly set. I noticed that this only happens for the new UserNotifications framework on iOS 10+, so it may be an Apple bug or per design. A simple fix is to assign different <code>identifier</code> strings to make them unique. This also helps to better manage pending / delivered notifications.
   
   *EDIT*: Confirmed to work with the following:
   <code><pre>
   var win = Ti.UI.createWindow({
     backgroundColor: "white",
     layout: "vertical"
   });
    
   var repeatSwitch = Ti.UI.createSwitch();
    
   var btn = Ti.UI.createButton({
     top: 50,
     title: "Schedule"
   });
    
   btn.addEventListener("click", function() {
     var not = {
       date: new Date(new Date().getTime() + 3000),
       alertTitle: 'Notification',
       alertBody: 'This is a notification 1',
       badge: 1,
       identifier: '1',
       userInfo: {
         id: '1'
       },
       repeat: repeatSwitch.value ? "daily" : undefined
     };
    
     console.log('schedule: ' + JSON.stringify(not));
    
     Ti.App.iOS.scheduleLocalNotification(not);
    
     not = {
       date: new Date(new Date().getTime() + 6000),
       alertTitle: 'Notification',
       alertBody: 'This is a notification 2',
       identifier: '2',
       badge: 1,
       userInfo: {
         id: '1'
       },
       repeat: repeatSwitch.value ? "daily" : undefined
     };
    
     console.log('schedule: ' + JSON.stringify(not));
    
     Ti.App.iOS.scheduleLocalNotification(not);
   });
    
   win.add(btn);
   win.add(Ti.UI.createLabel({
     text: "Repeat?"
   }));
   win.add(repeatSwitch);
    
   win.addEventListener("open", function() {
     Ti.App.iOS.registerUserNotificationSettings({
       types: [
         Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,
         Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,
         Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE
       ]
     });
   });
    
   win.open();
   </pre></code></li>
<li>Teun Klijn 2018-08-28

   That does indeed work! Thank you for your help.</li>
<li>Hans Knöchel 2018-08-28

   I just pushed another commit to make notifications on iOS 10+ unique by default, to match the iOS < 10 behavior for now. It internally generates a UUID-string that is also injected into the "userInfo.id" if not already set, so it can be used to identifier them later again. Does that match your expectations of the API?</li>
<li>Teun Klijn 2018-08-28

   Yes that does match my expectations.</li>
<li>Samir Mohammed 2018-08-29

    Verified fix in SDK version <code>7.5.0.v20180828231421</code> and <code>7.3.1.v20180828234519</code>.
    
    *Test Steps FR*
    <h4>Created a new titanium project </h4>
    <h4>Added the code from the description in to the application </h4>
    <h4>Ran the program </h4>
    <h4>Enabled scheduled push notifications</h4>
    <h4>Pressed schedule </h4>
    <h4>Went to the home screen  </h4>
    <h4>Able to see the push notifications trigger</h4>
    <h4>Created a new application with the second test case in the comments </h4>
    <h4>followed the steps above (3-7)</h4>
    <h4>Able to see both notifications trigger </h4>
    
    *Test Environment*
    <code><pre>
    APPC Studio:  5.1.0.201808080937
    APPC CLI: 7.0.6-Master.5
    iphone 6 simulator (11.2)
    iphone 6 simulator (9.3)
    Operating System Name: Mac OS High Sierra
    Operating System Version: 10.13.6
    Node.js Version: 8.9.1
    Xcode 10.0 beta 6
    </pre></code>
    
    *Note:* Waiting for the 7_4_X build from Jenkins.
    </li>
<li>Samir Mohammed 2018-08-29

    *Closing Ticket* Verified fix in SDK Version <code>7.4.0.v20180829012158</code> With the above steps.</li>
<li>David van de Meer 2018-11-07

    Hi, it seems like this has now broken the scheduling of local notification when you DO NOT set "repeat"
    
    The code below will never fire the notification
    <code><pre>
    	// The following code snippet schedules an alert to be sent within three seconds
    	var notification = Ti.App.iOS.scheduleLocalNotification({
    		category: "TEST",
    		alertAction: 'Read now',
    		alertBody: 'Custom message',
    		date: new Date(new Date().getTime() + 30000),
    		//repeat: "never",
    		//The following URL is passed to the application
    		userInfo: {
    			"task": "test2"
    		}
    	});
    </pre></code>
    </li>
<li>David van de Meer 2018-11-07

    </li>
</ol>


<p><a href="/TIMOB/TIMOB-26339.json">JSON Source</a></p>