---
title: "[TIMOB-26382] Android: "appc run" should dismiss screen-lock before running built app"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Reopened</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, build, cli, run</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-09-11T20:33:43.000+0000</td></tr>
<tr><th>Updated</th><td>2018-10-23T21:16:20.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
When doing an "appc run" to an Android device with the screen powered off or the screen-lock shown, the app will be ran in the background. The Android device will not automatically turn on the screen and dismiss the screen-lock. Ideally, it should.

*Reason:*
UI events such as "postlayout" will not occur in an Android app while it is running in the background. This is especially an issue for automated testing.

*Recommended Solution:*
Google recommends to invoke the "menu" key to dismiss the screen-lock for automated test.
<a href="https://developer.android.com/studio/test/monkeyrunner" rel="nofollow" target="_blank">https://developer.android.com/studio/test/monkeyrunner</a>

We can do this via the "adb" command line as follows. Note that we need to invoke the "menu" key twice. Once to power on the screen (if off) and a second time to dismiss the screen-lock.
<code><pre>
adb shell input keyevent KEYCODE_MENU
adb shell input keyevent KEYCODE_MENU
</pre></code>


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2018-09-11

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10318" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10318</a></li>
<li>Lokesh Choudhary 2018-09-13

   FR Passed.
   
   Waiting for CR.</li>
<li>Lokesh Choudhary 2018-09-18

   PR Merged.</li>
<li>Michael Gangolf 2018-09-23

   Just a quick note because I was a bit confused and found this ticket:
   
   When I compile an app now  (latest 7.5.0) and my screen is not switched off it will go into "edit home screen" mode and back to the first home screen before starting the app (I was on the third screen). Luckly It doesn't change anything on the screens but the behaviour is different and at first very confusing. 
   
   Here is a video: <a href="http://migaweb.de/ti_home_bug.mp4" rel="nofollow" target="_blank">http://migaweb.de/ti_home_bug.mp4</a></li>
<li>Lokesh Choudhary 2018-09-24

   [~michael], Yes I have confirmed it with [~jquick] & its expected due to the only way this change can be done. You will see this when app is complied & installed using studio or CLI. If launched manually after the first install you won't see this behaviour.</li>
<li>Michael Gangolf 2018-09-24

   you could check
   <code>adb shell dumpsys power | grep 'mHolding'</code>
   before. It will output:
   
   <code><pre>
     mHoldingWakeLockSuspendBlocker=true  // lock true/false
     mHoldingDisplaySuspendBlocker=true   // screen on/off
   </pre></code></li>
<li>Joshua Quick 2018-09-24

   Hmm... the behavior is harmless and doesn't bother me. But if this behavior bothers [~michael] and [~lchoudhary], then it might bother others too. I don't want this to turn into a tech-support issue for us. I'll have to re-think this.
   
   _*Edit:*_
   _[~michael], your solution doesn't work on all devices. Have a look at the stackoverflow link below. I'd prefer to stick to public APIs to make this work, but we may be out of luck in this case._
   <a href="https://stackoverflow.com/questions/35275828/is-there-a-way-to-check-if-android-device-screen-is-locked-via-adb" rel="nofollow" target="_blank">https://stackoverflow.com/questions/35275828/is-there-a-way-to-check-if-android-device-screen-is-locked-via-adb</a>
   </li>
<li>Lokesh Choudhary 2018-09-24

   Reopening for now.</li>
<li>Michael Gangolf 2018-09-25

   [~jquick] ah ok. But keep in mind that the "menu - menu" won't bring any benefit when your device has a pin/fingerprint lock and is switched off, since it won't unlock them (which I guess most user devices use). Perhaps we could check if it's an emulator or not. </li>
<li>Joshua Quick 2018-10-23

    Let's revert this change for now. I don't want this to turn into a tech-support issue.
    
    PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10396" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10396</a>
    
    Note that the intention of this change was to help with automated testing systems. Perhaps an alternative solution would be to run the "adb" command like I was doing via build plugin instead. Something to ponder later.</li>
</ol>


<p><a href="/TIMOB/TIMOB-26382.json">JSON Source</a></p>