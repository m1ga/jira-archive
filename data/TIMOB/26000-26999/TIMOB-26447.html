---
title: "[TIMOB-26447] Android 8: Unable open PDF on some devices"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-10-24T17:50:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.4.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shuo Liang</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2018-10-09T09:19:59.000+0000</td></tr>
<tr><th>Updated</th><td>2018-10-24T17:50:53.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

Customer is trying to download the pdf from remote server using URL, save them to external or application directory and then open them in external pdf viewer using intent. Like example in post <a href="https://www.appcelerator.com/blog/2015/08/appcelerator-pdf-viewer-demo/." rel="nofollow" target="_blank">https://www.appcelerator.com/blog/2015/08/appcelerator-pdf-viewer-demo/.</a> But throwing following error on Android 8.

<code><pre>
[ERROR] : TiFileProxy: (KrollRuntimeThread) [9574,75852] IOException encountered 
[ERROR] : TiFileProxy: java.io.FileNotFoundException: /storage/emulated/0/com.edf.mobile/EDF Bill 10 August 2018.pdf (Permission denied) 
[ERROR] : TiFileProxy: at java.io.FileOutputStream.open0(Native Method) 
[ERROR] : TiFileProxy: at java.io.FileOutputStream.open(FileOutputStream.java:287) 
[ERROR] : TiFileProxy: at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:223) 
[ERROR] : TiFileProxy: at org.appcelerator.titanium.io.TiFile.getOutputStream(TiFile.java:304) 
[ERROR] : TiFileProxy: at org.appcelerator.titanium.io.TiFile.open(TiFile.java:368) 
[ERROR] : TiFileProxy: at org.appcelerator.titanium.io.TiFile.write(TiFile.java:414) 
[ERROR] : TiFileProxy: at org.appcelerator.titanium.TiFileProxy.write(TiFileProxy.java:331) 
[ERROR] : TiFileProxy: at org.appcelerator.kroll.runtime.v8.V8Object.nativeCallProperty(Native Method) 
[ERROR] : TiFileProxy: at org.appcelerator.kroll.runtime.v8.V8Object.callProperty(V8Object.java:75) 
[ERROR] : TiFileProxy: at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1208) 
[ERROR] : TiFileProxy: at android.os.Handler.dispatchMessage(Handler.java:101) 
[ERROR] : TiFileProxy: at android.os.Looper.loop(Looper.java:164) 
[ERROR] : TiFileProxy: at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:117) 
</pre></code>

<h4>Note</h4>

The strange problem is not happening to all model of devices. For example

On Android 7
Seems all devices work well. At least, all the test devices are working well.

On Android 8
Moto G device which is on android 8 worked fine.
but others, like Google Pixel or Samsung Note 8, will get above error. 

<h4>Example code</h4>
<code><pre>
function testPDF() {
	var tempFile = Titanium.Filesystem.getFile(Titanium.Filesystem.isExternalStoragePresent() ? Titanium.Filesystem.externalStorageDirectory : Titanium.Filesystem.applicationDataDirectory, '/' + 'EDF Bill ' + e.source.text + '.pdf'); 
	var appfilepath = tempFile.nativePath; 

	var url = "<a href="http://www.mbta.com/uploadedfiles/Documents/Schedules_and_Maps/Rapid%20Transit%20w%20Key%20Bus.pdf" rel="nofollow" target="_blank">http://www.mbta.com/uploadedfiles/Documents/Schedules_and_Maps/Rapid%20Transit%20w%20Key%20Bus.pdf</a>";
	var xhr = Ti.Network.createHTTPClient(); 

	xhr.onload = function() { 
		tempFile.write(this.responseData); 
		try{ 
			Ti.Android.currentActivity.startActivity(Ti.Android.createIntent({ 
				action: Ti.Android.ACTION_VIEW, 
				type: 'application/pdf', 
				data: appfilepath 
			})); 
		} catch(e) { 
			Ti.API.info('error trying to launch activity, e = '+e); 
			alert('No PDF apps installed!'); 
		} 
	};
 
	xhr.onerror = function() { 
		alert("Cannot retrieve PDF from web site") ;
	}; 

	xhr.timeout = 10000; 
	xhr.open("GET", url); 
	xhr.send();
}
</pre></code>

Please check this asap, very important function for customer's app. 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26447_65698/test.js">test.js</td></td><td>2018-10-11T10:15:42.000+0000</td><td>2370</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Gary Mathews 2018-10-10

   It's correct that they need to add the required storage permissions into the <code>tiapp.xml</code>. But on later Android versions they also need to request storage permissions:
   
   For example, they could amend their <code>onload</code> to request storage permissions:
   <code><pre>
   xhr.onload = function() {
       Ti.Filesystem.requestStoragePermissions(function (e) {
           if (e.success) {
               tempFile.write(this.responseData);
               try{
                   Ti.Android.currentActivity.startActivity(Ti.Android.createIntent({
                       action: Ti.Android.ACTION_VIEW,
                       type: 'application/pdf',
                       data: appfilepath
                   }));
               } catch(e) {
                   Ti.API.info('error trying to launch activity, e = '+e);
                   alert('No PDF apps installed!');
               }
           } else {
               Ti.API.error('could not obtain required storage permissions!');
           }
       });
   };
   </pre></code></li>
<li>Gary Mathews 2018-10-11

   You will want write permissions too:
   <code><pre>
   Ti.Android.requestPermissions(
       [ 'android.Manifest.permission.READ_EXTERNAL_STORAGE', 'android.permission.WRITE_EXTERNAL_STORAGE' ],
       function (e) {
           if (e.success) {
               tempFile.write(this.responseData);
               try{
                   Ti.Android.currentActivity.startActivity(Ti.Android.createIntent({
                       action: Ti.Android.ACTION_VIEW,
                       type: 'application/pdf',
                       data: appfilepath
                   }));
               } catch(e) {
                   Ti.API.info('error trying to launch activity, e = '+e);
                   alert('No PDF apps installed!');
               }
           } else {
               Ti.API.error('could not obtain required storage permissions!');
           }
       }
   );
   </pre></code></li>
</ol>


<p><a href="/TIMOB/TIMOB-26447.json">JSON Source</a></p>