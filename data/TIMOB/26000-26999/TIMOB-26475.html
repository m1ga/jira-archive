---
title: "[TIMOB-26475] Adding willclose event on window"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>ios</td></tr>
<tr><th>Reporter</th><td>Ani Sinanaj</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2018-09-05T14:23:27.000+0000</td></tr>
<tr><th>Updated</th><td>2018-10-20T22:31:22.000+0000</td></tr>
</table>

<h3>Description</h3>

What happened:

<h4>Index</h4>
<h4>Added a map to a secondary window</h4>
<h4>Added many annotations to the map with a custom view each</h4>
<h4>Running the app:</h4>
<h4>* From the index, I open the secondary window containing the map. I let it load some annotations, then go back.</h4>
<h4>* The app crashes</h4>

From the logs, it read that some objects were not cleaned before closing the window. 
Listening to the close event didn't work since it is fired after the window has closed.

Added a <code>willclose</code> event to do all the cleanup before actually closing the window. 

Commit <a href="https://github.com/caffeinalab/titanium_mobile/commit/849717ced4f7a0b7c33439a70c7cac056b33400d" rel="nofollow" target="_blank">https://github.com/caffeinalab/titanium_mobile/commit/849717ced4f7a0b7c33439a70c7cac056b33400d</a>

PR to come

<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2018-09-05

   It looks like rather Ti.Map should be improved to handle this than a new, iOS-only event. Also, the "blur" event comes pretty close to this state, which is called before the "close" event.</li>
<li>Ani Sinanaj 2018-09-06

   If I remember correctly, I tried the blur event and it didn't resolve my issue. Probably improving Ti.Map would be necessary, nevertheless I think exposing <code>willclose</code> isn't a bad idea. It may be useful.</li>
</ol>


<p><a href="/TIMOB/TIMOB-26475.json">JSON Source</a></p>