---
title: "[TIMOB-26542] Android: Add Ti.App "close" event support"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-09-10T22:17:58.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, app, close, event, parity</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-11-10T03:04:51.000+0000</td></tr>
<tr><th>Updated</th><td>2019-10-03T10:51:59.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The <code>Ti.App</code> module supports a "close" event that is currently only supported by iOS. This event gets fired just before the application get terminated by the operating system.
<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.App-event-close

We should add support on Android for parity. However, the "close" event should be fired just before Titanium's JavaScript runtime gets terminated instead. The reason is because pressing the back button on the root window will terminate Titanium's JavaScript runtime (which is okay) but the Android application process will still be alive in the background (this keeps its notifications alive in the status bar). Tapping the app icon again will create a new JavaScript runtime and re-execute the "app.js" while re-using the same application process. This is the normal native Android behavior.

This feature may be useful to "hyperloop" developers who need to do cleanup operations upon exit.

*Code Example:*
<code><pre>
Ti.App.addEventListener("close", function() {
	Ti.API.info("### App 'close' event was fired.");
});
Ti.UI.createWindow().open();
</pre></code>

*Recommended Solution:*
Remove the existing "close" firing event code in the Java <code>TiRootActivity.onDestroy()</code> method. It doesn't work because the JavaScript runtime has already been terminated by this point. It's too late.
[TiRootActivity.java](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/titanium/src/java/org/appcelerator/titanium/TiRootActivity.java)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/titanium/src/java/org/appcelerator/titanium/TiRootActivity.java)</a>

Instead, use the new Java <code>KrollRuntime.OnDisposingListener</code> that we've added to Titanium 8.0.0. This listener will be called just before the JavaScript runtime gets terminated/disposed.
[KrollRuntime.java](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/runtime/common/src/java/org/appcelerator/kroll/KrollRuntime.java)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/runtime/common/src/java/org/appcelerator/kroll/KrollRuntime.java)</a>


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-01-19

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10637" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10637</a></li>
<li>Keerthi Mahalingam 2019-01-29

   FR Passed. Waiting for CR to merge.</li>
<li>Ebenezer Boateng 2019-10-03

   Improvement verified in SDK version 8.3.0.v20191002165629</li>
</ol>


<p><a href="/TIMOB/TIMOB-26542.json">JSON Source</a></p>