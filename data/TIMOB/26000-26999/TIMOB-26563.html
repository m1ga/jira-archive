---
title: "[TIMOB-26563] TiAPI: 2DMatrix translate() coordinate units do not match between platforms"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2018-12-03T13:53:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>2dmatrix, android, animation, breaking-change, ios, parity, scale, unit</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-11-15T02:40:46.000+0000</td></tr>
<tr><th>Updated</th><td>2018-12-03T14:02:49.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The <code>2DMatrix.translate()</code> method's (x,y) values are handled inconsistently between platforms.

On Android, the units are expected to be pixels (aka: "px").
On iOS, the units are expected to be dips (aka: "dp").

The <code>translate()</code> method should be changed to use the units assigned to the "tiapp.xml" file's "ti.ui.defaultunit" property. This way they would be handled consistently between platforms and the units which match the coordinates used by the window's views (makes the math easier to calculate).

*Steps to reproduce:*
For this animation test, a blue square is supposed to move from the top-left corner to the bottom-right corner.
<h4>Set "tiapp.xml" property "ti.ui.defaultunit" to "dp".</h4>
<h4>Build and run on iOS.</h4>
<h4>Notice that the blue square correctly animated to bottom-right corner. (This is good.)</h4>
<h4>Set "tiapp.xml" property "ti.ui.defaultunit" to "px".</h4>
<h4>Build and run on iOS.</h4>
<h4>Notice that the blue square moves off screen, past the bottom-right corner. (This is the bug.)</h4>
<h4>Build and run on Android.</h4>
<h4>Notice that the blue square correctly animated to bottom-right corner. (This is good.)</h4>
<h4>Set "tiapp.xml" property "ti.ui.defaultunit" to "dp".</h4>
<h4>Build and run on Android.</h4>
<h4>Notice that the blue square does not reach the bottom-right corner. (This is the bug.)</h4>

<code><pre>
var SQUARE_SIZE = 80;
var window = Ti.UI.createWindow({
	backgroundColor: "white",
	fullscreen: true,
});
var squareView = Ti.UI.createView({
	backgroundColor: "blue",
	left: 0,
	top: 0,
	width: SQUARE_SIZE,
	height: SQUARE_SIZE,
});
window.add(squareView);
window.addEventListener("postlayout", function() {
	if (!squareView.wasAnimated) {
		var windowSize = window.size;
		var newX = windowSize.width - SQUARE_SIZE;
		var newY = windowSize.height - SQUARE_SIZE;
		var animation = Ti.UI.createAnimation({
			transform: Ti.UI.create2DMatrix().translate(newX, newY),
			duration: 2000,
		});
		squareView.wasAnimated = true;
		squareView.animate(animation);
	}
});
window.open();
</pre></code>

*Note:*
This is not an issue with <code>2DMatrix.scale()</code> since scaling is a "relative" operation. Versus translations works with "absolute" coordinates.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2018-11-15

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10472" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10472</a></li>
<li>Samir Mohammed 2018-11-29

   *FR Passed.* Awaiting for CR.</li>
<li>Samir Mohammed 2018-12-03

   *Closing ticket.* Verified fix in SDK Version <code>8.0.0.v20181130132038</code>.
   
   Test and other information can be found at: 
   <a href="https://github.com/appcelerator/titanium_mobile/pull/10472" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10472</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-26563.json">JSON Source</a></p>