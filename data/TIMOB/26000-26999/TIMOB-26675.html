---
title: "[TIMOB-26675] Android: Add getLastLocation to FusedLocationProvider"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.2.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>android, geolocation</td></tr>
<tr><th>Reporter</th><td>Michael Gangolf</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2018-12-20T18:28:38.000+0000</td></tr>
<tr><th>Updated</th><td>2021-10-19T20:44:53.000+0000</td></tr>
</table>

<h3>Description</h3>

The current implementation of the <code>FuseLocationProvider</code> is not using the <code>getLastLocation()</code> method:
<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/geolocation/src/java/ti/modules/titanium/geolocation/android/FusedLocationProvider.java" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/geolocation/src/java/ti/modules/titanium/geolocation/android/FusedLocationProvider.java</a>

According to <a href="https://developer.android.com/training/location/retrieve-current#java" rel="nofollow" target="_blank">https://developer.android.com/training/location/retrieve-current#java</a> you can use <code>getLastLocation()</code> on the provider.


Adding this to the Java file mentioned above:
<code><pre>
fusedLocationClient.getLastLocation().addOnSuccessListener(new OnSuccessListener<Location>() {
    @Override
    public void onSuccess(Location location)
    {
        // Got last known location. In some rare situations this can be null.
        if (location != null) {
            Log.i("Fused", "Location: " + location);
        }
    }
});
</pre></code>

works fine, it just needs to transfer those values to the JS <code>location</code> event .

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2018-12-20

   Thanks for the feature ticket. Our engineers will look into it. Thanks.</li>
<li>Michael Gangolf 2021-10-19

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/13133" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/13133</a>
   
   had this in my queue for a longer time :)</li>
<li>Ahmed Mohamed 2021-10-19

   <code>getLastLocation</code> will get the last cached location in the device and that's sometimes far from the current location. let us say an app request location data on day 1 so this location will be the last location requested on the device then after 30 days if no other app make a new location request then <code>getLastLocation</code> will get that same old location that was requested since 30 days ago
   
   So I don't think <code>getLastLocation</code> should fire <code>location</code>
   
   If you want to try it please use my ti.locationservices module
   <a href="https://github.com/AhmedMSayed/ti.locationservices" rel="nofollow" target="_blank">https://github.com/AhmedMSayed/ti.locationservices</a></li>
<li>Michael Gangolf 2021-10-19

   Thanks for the feedback [~ahmed.mohamed20320]! I have to check it again but shouldn't that be covered by the included timestamp? But you are right, if you don't check that it can be very wrong. I'll have a look again.
   
   
   BTW: I'm using the userLocation event of ti.map since that is using internal map stuff by Google and returned a proper fix quicker than geoolaction in my tests.
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-26675.json">JSON Source</a></p>