---
title: "[TIMOB-26682] Android: ES6 template strings causing memory leak + crash"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Duplicate</td></tr>
<tr><th>Resolution Date</th><td>2020-12-04T20:31:20.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Abir Mukherjee</td></tr>
<tr><th>Created</th><td>2018-12-30T15:05:53.000+0000</td></tr>
<tr><th>Updated</th><td>2020-12-04T20:31:20.000+0000</td></tr>
</table>

<h3>Description</h3>

When using the following example on Android (with ES6+ enabled), the app crashes:
<code><pre>
const stringVar = 'myString';
const numberVar = 1.337;
const myValue = <code>${stringVar}${numberVar.toFixed(2).toLocaleString()} €</code>;
</pre></code>
Error:
<code><pre>
[ERROR] TiExceptionHandler: (main) [428,32694] ti:/titanium.js:146
[ERROR] TiExceptionHandler: 	value: function(property, value) {
[ERROR] TiExceptionHandler:                 ^
[ERROR] TiExceptionHandler: RangeError: Maximum call stack size exceeded
[ERROR] TiExceptionHandler:     at Label.value (ti:/titanium.js:146:17)
[ERROR] TiExceptionHandler:     at onSummaryChanged (/alloy/controllers/trip/detail/expenses/index.js:113:34)
</pre></code>
The whole thing works fine on iOS. Please provide a workaround, thx!

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2019-01-01

   [~hknoechel], does this definitely not happen when not using transpilation? There's nothing there that will be transpiled against that V8 version as far as I can see, I built an app with that code and am not seeing any signs. I also left an app running for 5 minutes and it didn't seem to crash for me. Is it an instant thing or a slow thing for you?
   
   If you're sure the issue is down to template literals you could try using string concatenation <code>const myValue = stringVar + numberVar.toFixed(2).toLocaleString() + ' €';</code></li>
<li>Rene Pot 2019-10-29

   I took another look at this ticket. It doesn't seem to cause any issues on my side (using SDK 8.2.1 & CLI 7.1.1). [~hknoechel] can you confirm for me your status on this ticket? Do you still have the problem or did it go away for you?</li>
<li>Hans Knöchel 2019-11-04

   We workarounded by writing an own native module for date formatting and haven't looked into it again. So no prio for us anymore.</li>
<li>Joshua Quick 2020-12-04

   I tested this with the newest Titanium and it doesn't crash on Android.
   As of Titanium 9.1.0, we added <code>toLocaleString()</code> support on Android as well as other <code>Intl</code> related APIs. So, I think we can close this.
   
   *Side Note:*
   Doing a <code>myNumber.toFixed(2).toLocaleString()</code> won't "localize" the number to a string since <code>toFixed()</code> returns a string. You can do the following instead.
   <code><pre>
   const stringVar = 'myString';
   const numberVar = 1.337;
   //const myValue = <code>${stringVar}${numberVar.toFixed(2).toLocaleString('de-DE')} €</code>;
   const myValue = <code>${stringVar}${numberVar.toLocaleString(Ti.Locale.currentLocale, { maximumFractionDigits: 2, minimumFractionDigits: 2 })} €</code>;
   </pre></code>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-26682.json">JSON Source</a></p>