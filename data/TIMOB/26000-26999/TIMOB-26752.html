---
title: "[TIMOB-26752] Android: Add support for `onActivityResult` callback method for activity"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>n/a</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Prashant Saini</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2018-12-14T05:25:46.000+0000</td></tr>
<tr><th>Updated</th><td>2019-01-28T22:16:15.000+0000</td></tr>
</table>

<h3>Description</h3>

Currently we have onCreate, onPause, onResume, etc callback methods available for an activity, but we do not have any *onActivityResult* callback method due to which many things are not doable easily and straight-forward in Titanium.

e.g.
1- Google Location API library allows to enable location from within the app itself without going into the device settings. But this API call returns the result in native *onActivityResult* method.
2- Some image-cropping or scanner libraries' results are returned in native *onActivityResult* method. (<a href="https://github.com/ArthurHub/Android-Image-Cropper)" rel="nofollow" target="_blank">https://github.com/ArthurHub/Android-Image-Cropper)</a>

At present, we cannot achieve this without creating modules which is cumbersome when we already have Hyperloop. 

With Hyperloop we can call native *startActivityForResult* method on third-party libraries but we cannot get their results back to the activity as Hyperloop is unable to let us define *TiActivityResultHandler* interface methods nor we can cast a native Intent to Titanium intent so we can use Titanium's *startActivityForResult* method callback.

It makes Hyperloop less usable if anything is to be returned in <code>onActivityResult</code> method. We hope to see this improvement in SDK 8.x.x itself as it will give more flexibilities in using Hyperloop.

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2018-12-14

   Alternatively, you can use Titanium's <code>Ti.Android.Activity.startActivityForResult()</code> JavaScript method. It's 2nd argument accepts a callback which will be called by Titanium's internal <code>onActivityResult()</code> method.
   <a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Android.Activity-method-startActivityForResult
   
   Are you able to use this approach instead?</li>
<li>Prashant Saini 2018-12-15

   </li>
<li>Rainer Schleevoigt 2019-01-20

   I have the same issue with a third party SDK.
   
   The interace calls a methd with one paramter (currentActivity) and send the result to onActivityResult...
   
   The SDK opens a new activity by  Fidel.present(TiApplication.getInstance().getCurrentActivity());
   <a href="https://github.com/FidelLimited/fidel-android" rel="nofollow" target="_blank">https://github.com/FidelLimited/fidel-android</a>
   
   Need support.
   
   </li>
<li>Rainer Schleevoigt 2019-01-20

   I cannot use <code>startActivityForResult()</code> because the SDK only exports the method for opening the new activity, the activity self is private and I have no access. Is there a solution without patch of Titanium SDK?</li>
<li>Hans Knöchel 2019-01-27

   Any update here? I am trying to use the [Matisse](<a href="https://github.com/zhihu/Matisse/)" rel="nofollow" target="_blank">https://github.com/zhihu/Matisse/)</a> library which returns data via this callback. I tried hooking into the lifecycle like Ti.Facebook does [here](<a href="https://github.com/appcelerator-modules/ti.facebook/blob/master/android/src/facebook/ActivityWorkerProxy.java#L51)" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.facebook/blob/master/android/src/facebook/ActivityWorkerProxy.java#L51)</a>, but it doesn't seem to be called.
   
   Unfortunately, the <code>public void onCreate(Activity activity, Bundle savedInstanceState)</code> signature is only available in <code>KrollProxy</code> instances, not <code>KrollModule</code> ones. So I used <code>public void onStart(Activity activity)</code> there, but it doesn't get called either. My code:
   
   <code><pre>
   @Override
   public void onStart(Activity activity)
   {
   	((TiBaseActivity) activity).addOnActivityResultListener(this);
   }
   
   @Override
   public void onActivityResult(Activity activity, int requestCode, int resultCode, Intent data)
   {
   	Log.w(LCAT, "onActivityResult called");
   }
   </pre></code>
   My class <code>implements</code> both <code>OnActivityResultEvent</code> and <code>OnInstanceStateEvent</code>. 
   
   *EDIT*: Found a proper way!</li>
<li>Rainer Schleevoigt 2019-01-27

   If onCreate is only available for proxies then we could implement the interface in a proxy. I implemented Ti.Paypal with this pattern.
   
   In my project I decompiled the aar, found the name of new activity and used it in <code>launchActivityForResult</code>
   
   
   <code><pre>
   @Kroll.method
   public void present() {
   	final TiActivitySupport support = (TiActivitySupport) TiApplication.getAppCurrentActivity();
   	final Intent intent = new Intent(TiApplication.getInstance().getApplicationContext(),
   			EnterCardDetailsActivity.class);
   	Fidel.FIDEL_LINK_CARD_REQUEST_CODE = support.getUniqueResultCode();
   			support.launchActivityForResult(intent, Fidel.FIDEL_LINK_CARD_REQUEST_CODE, this);
   }
   </pre></code>
   
   and
   
   <code><pre>
   public class TifidelModule extends KrollModule implements TiActivityResultHandler { ……… }
   </pre></code>
   
   and 
   <code><pre>
   @Override
   public void onResult(Activity dummy, int requestCode, int resultCode, Intent data) {
   	if (requestCode == Fidel.FIDEL_LINK_CARD_REQUEST_CODE) {
   		if (data != null && data.hasExtra(Fidel.FIDEL_LINK_CARD_RESULT_CARD)) {
   			LinkResult card = (LinkResult) data.getParcelableExtra(Fidel.FIDEL_LINK_CARD_RESULT_CARD);
   			HashMap<String, Object> event = new HashMap<String, Object>();
   			event.put("accountId", card.accountId);
          }
      }
   }
   
   </pre></code>
   
    </li>
<li>Rainer Schleevoigt 2019-01-27

   What I have understood:
   
   You try to add this listener in onStart, but it will not called.
   </li>
<li>Joshua Quick 2019-01-28

   Let's not hijack [~prashant_saini]'s ticket please. It might cause confusion.
   
   This ticket is about doing this 100% in JavaScript and hyperloop, without having to write any Java code. [~hknoechel], [~titanium@webmasterei-hamburg.de], it looks like you 2 are coding in Java... in which case, there is a solution available to you now. [~titanium@webmasterei-hamburg.de], I believe I've already helped you in ticket [AC-6111]? If not, perhaps we can continue our conversation there if you don't mind. [~hknoechel], perhaps what I've written there might help you too, but it sounds like you have already solved it. (I'm recommending that you use "ti.barcode" as an example since it's simpler.)
   </li>
<li>Rainer Schleevoigt 2019-01-28

   My issue is solved because I could read the class name from decompiled jar. Sorry for "hijacking" this was not my intrention.</li>
<li>Joshua Quick 2019-01-28

    No worries. :)</li>
</ol>


<p><a href="/TIMOB/TIMOB-26752.json">JSON Source</a></p>