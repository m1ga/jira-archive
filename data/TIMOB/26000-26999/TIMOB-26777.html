---
title: "[TIMOB-26777] Android: Window UI disappears when connecting/disconnecting keyboard"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-05-29T17:42:11.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.2</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, engSchedule, keyboard, manifest, tiapp.xml</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2019-01-29T22:58:27.000+0000</td></tr>
<tr><th>Updated</th><td>2019-05-29T17:42:11.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The Titanium window UI will disappear when doing the following on Android:
* Connect or disconnect a bluetooth keyboard.
* Open or close a phone's slide-out keyboard. (Like the old Droid devices.)

*Steps to reproduce:*
<h4>Connect a bluetooth keyboard to an Android device.</h4>
<h4>Launch a Titanium app on that device.</h4>
<h4>Turn off the bluetooth keyboard (or pull the batteries out).</h4>

*Result:*
The UI disappears when the keyboard disconnects.

*Cause:*
Titanium generates an "AndroidManifest.xml" when doing an Android build. The Titanium <code>&lt;activity/&gt;</code> elements have an "android:configChanges" attribute which are missing the "keyboard" value. This is needed to override the Android OS' default behavior of destroying the activity and recreating it when a keyboard disconnects. (We overriding the "orientation" change event for the same reason.)
<a href="https://developer.android.com/guide/topics/manifest/activity-element#config" rel="nofollow" target="_blank">https://developer.android.com/guide/topics/manifest/activity-element#config</a>

*Recommended Solution:*
We need to updating Titanium's "AndroidManifest.xml" template and/or "_build.js" to automatically add the "keyboard" setting to all activities that do not load UI from XML such as the root activity, TiActivity, JSActivity, etc.

*Work-Around:*
Add the following to the "tiapp.xml" to override the the "keyboard" handling yourself. Note that the activity name is based on the app's name. If the app's name is "MyAppName", then the activity name will be "MyappnameActivity".
<code><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
		&lt;manifest&gt;
			&lt;application&gt;
				&lt;activity android:name=".MyappnameActivity" android:configChanges="keyboard|keyboardHidden|orientation|fontScale|screenSize|smallestScreenSize|screenLayout|density"&gt;
					&lt;intent-filter&gt;
						&lt;action android:name="android.intent.action.MAIN"/&gt;
						&lt;category android:name="android.intent.category.LAUNCHER"/&gt;
					&lt;/intent-filter&gt;
				&lt;/activity&gt;
				&lt;activity android:name="org.appcelerator.titanium.TiActivity" android:configChanges="keyboard|keyboardHidden|orientation|fontScale|screenSize|smallestScreenSize|screenLayout|density"/&gt;
			&lt;/application&gt;
		&lt;/manifest&gt;
	&lt;/android&gt;
&lt;/ti:app&gt;
</pre></code>



<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-05-11

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10884" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10884</a></li>
<li>Joshua Quick 2019-05-18

   PR (8.0.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/10900" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10900</a></li>
<li>Keerthi Mahalingam 2019-05-21

   FR passed. jenkin is failing test. waiting for resolving jenkin failure to merge</li>
<li>Keerthi Mahalingam 2019-05-29

   Verified the fix on SDK 8.0.2.v20190525084235 and 8.1.0.v20190524131922. no window dispappears when bluetooth keyboard connected/disconnected. Works as expected.
   
   <code><pre>Test Environment:
   Operating System
     Name                        = Mac OS X
     Version                     = 10.13.6
     Architecture                = 64bit
     # CPUs                      = 8
     Memory                      = 17179869184
   Node.js
     Node.js Version             = 8.9.1
     npm Version                 = 5.5.1
   Titanium CLI
     CLI Version                 = 5.1.1
   Titanium SDK
     SDK Version                 = 8.0.2.v20190525084235 and 8.1.0.v20190524131922
   Device = pixel 2 android 9
   </pre></code></li>
</ol>


<p><a href="/TIMOB/TIMOB-26777.json">JSON Source</a></p>