---
title: "[TIMOB-26811] iOS: Memory leak in Ti.Network.HTTPClient"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-04-25T10:31:22.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Luke Lu</td></tr>
<tr><th>Assignee</th><td>Jan Vennemann</td></tr>
<tr><th>Created</th><td>2019-01-31T03:34:16.000+0000</td></tr>
<tr><th>Updated</th><td>2019-04-25T10:31:22.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>
After upgrade sdk version from 6.3.0 to 7.4.1/7.5.0, IOS start to have a big memory leak issue when making api requests. The app is going to crash when memory are too high. 

<h4>How to reproduce </h4>
I have create a simple app with only one api request which will be called every 10 seconds, you can build the app from <a href="https://github.com/lukeluluke/simpleApp.git" rel="nofollow" target="_blank">https://github.com/lukeluluke/simpleApp.git</a>
1. Clone the project and build with sdk v7.5.0.GA
2. Use Instruments to monitor the memory usage and leaks
3.  You will find the memory keep increasing , and the are memory leaks for almost each api request. 
4. Rebuild the app with sdk v.6.3.0.GA.
5. Use Instruments to monitor the memory usage and leaks
6. You will see the is only one leak in the beginning

I have attached the screenshots of profiling tool

<h4>Update</h4>
I have upgraded xcode to latest version, and removed the setInterval function, memory leaks still exist when trigger api calls manually. Please see screenshots below. 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26811_66117/v6.3.0.GA.png">v6.3.0.GA.png</td></td><td>2019-01-31T03:34:09.000+0000</td><td>468078</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26811_66116/v7.5.0.GA_memory_leak.png">v7.5.0.GA_memory_leak.png</td></td><td>2019-01-31T03:34:09.000+0000</td><td>658861</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26811_66122/v7.5.0.GA_xcode_10_production_app.png">v7.5.0.GA_xcode_10_production_app.png</td></td><td>2019-02-01T00:28:54.000+0000</td><td>403039</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26811_66123/v7.5.0.GA.xcode_10_simpleApp_remove_setInterval.png">v7.5.0.GA.xcode_10_simpleApp_remove_setInterval.png</td></td><td>2019-02-01T00:29:32.000+0000</td><td>433169</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26811_66137/v8.0.0.v20190123061938_memory_leak.png">v8.0.0.v20190123061938_memory_leak.png</td></td><td>2019-02-07T02:47:31.000+0000</td><td>667702</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Luke Lu 2019-01-31

   I know this is not the correct project to report, but this is the only project I can select when creating the issue</li>
<li>Rakhi Mitro 2019-01-31

   [~luke_lu],
   Thanks for reporting this. Can you please try using the upper Xcode version 10/10.1 and let us know the results.</li>
<li>Jan Vennemann 2019-01-31

   [~luke_lu], you are using <code>setInterval</code> to make the request. There is a known leak in 7.5.0.GA related to timers that was fixed in TIMOB-26688. This fix is included in the upcoming 7.5.1.GA release. You can already check it out via <code>ti sdk install -b 7_5_X</code>.</li>
<li>Luke Lu 2019-01-31

   For our production app, it has memory leaks and crash a lot since upgraded sdk from v6.3.0.GA to  v7.4.1.GA.  When we profiling the memory usage, we found memory will increase for each api request, that is why I use setInterval function to simulate multiple api requests. </li>
<li>Rakhi Mitro 2019-02-03

   [~luke_lu],
   Did you manage to check using ti sdk install -b 7_5_X?</li>
<li>Luke Lu 2019-02-05

   I have tried 7_5_X and 8_0_X, memory leaks still exist. I have updated the test app's git repository, you can test the newest code. Thanks</li>
<li>Rakhi Mitro 2019-02-06

   Hello,
   
   Our engineering team verified the fix on  SDK 8.0.0.v20190123061938 in branch 8_0_X. Can you try using the following version and let us know the results.
   
   *appc ti sdk install 8.0.0.v20190123061938*.</li>
<li>Luke Lu 2019-02-07

   Hi Rakhi, 
   
   i have installed 8.0.0.v20190123061938, but it doesn't help. I can still see the memory leaks by using Instruments. Please see attached screenshot. Can you please review the code of sample app (only a fews lines), are there something we need to do after make api calls.
   
   Thanks
    !v8.0.0.v20190123061938_memory_leak.png|thumbnail! 
    
   
   </li>
<li>Jan Vennemann 2019-02-07

   [~luke_lu], these look different then those from your previous example. I'll take a look!</li>
<li>Jan Vennemann 2019-02-08

    Alright, after some comparison between 6.3 and 7.X it seems like we indeed leak some memory in our HTTP client. Moving this to TIMOB for further investigation.</li>
<li>Jan Vennemann 2019-02-08

    PR: <a href="https://github.com/appcelerator/APSHTTPClient/pull/48" rel="nofollow" target="_blank">https://github.com/appcelerator/APSHTTPClient/pull/48</a></li>
<li>Jan Vennemann 2019-02-18

    PRs to update the APSHTTPClient library in the SDK:
    
    PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10704" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10704</a>
    PR (8_0_X): <a href="https://github.com/appcelerator/titanium_mobile/pull/10705" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10705</a></li>
<li>Jan Vennemann 2019-03-11

    PR (aps_sdk): <a href="https://github.com/appcelerator/aps_sdk/pull/332" rel="nofollow" target="_blank">https://github.com/appcelerator/aps_sdk/pull/332</a></li>
<li>Jan Vennemann 2019-03-19

    [~ssekhri], add the following below [this line](<a href="https://github.com/lukeluluke/simpleApp/blob/e6c265c2dc0b7073a3da50feabb0ec2f616b4d6b/SimpleProject2/app/controllers/index.js#L22v)" rel="nofollow" target="_blank">https://github.com/lukeluluke/simpleApp/blob/e6c265c2dc0b7073a3da50feabb0ec2f616b4d6b/SimpleProject2/app/controllers/index.js#L22v)</a> to force the HTTP client to get cleared immediately.
    
    <code><pre>
    xhr = null;
    </pre></code>
    
    Otherwise it might take a while until the JS GC kicks in and actually deletes the client and all of its resources (including the leaking objects). You should now no longer see any leaks related to networking.</li>
<li>Jan Vennemann 2019-03-19

    Ok, there still seems to be an issue with leaking objects. I tried with a forced garbage collection and in fact the leaks now only show after a GC. Giving this another pass tomorrow.</li>
<li>Satyam Sekhri 2019-03-25

    FR Passed. Merged to master and 8_0_X</li>
<li>Luke Lu 2019-04-03

    </li>
<li>Samir Mohammed 2019-04-25

    </li>
</ol>


<p><a href="/TIMOB/TIMOB-26811.json">JSON Source</a></p>