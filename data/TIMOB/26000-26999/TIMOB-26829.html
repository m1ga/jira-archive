---
title: "[TIMOB-26829] iOS: Titanium.Media.openMusicLibrary returns empty items on iOS 9.3.5"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-04-25T12:00:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.1.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>alessandro la rocca</td></tr>
<tr><th>Assignee</th><td>Jan Vennemann</td></tr>
<tr><th>Created</th><td>2019-02-07T10:29:44.000+0000</td></tr>
<tr><th>Updated</th><td>2019-04-25T12:00:09.000+0000</td></tr>
</table>

<h3>Description</h3>

It works on iOS 10 or later, but fails on iOS 9.3.5

To reproduce:
- select a song
- music library will return an item
- stringify will print an empty item
- trying to read the title property on the item crashes the app

<code><pre>
var win = Ti.UI.createWindow({
    backgroundColor: '#fff'
});
 
var btn = Ti.UI.createButton({
    title: 'Trigger'
});

btn.addEventListener('click', function() {
    if (Ti.Media.hasMusicLibraryPermissions()) {
        openMusicLibrary();
    } else {
        Ti.Media.requestMusicLibraryPermissions(function(e) {
            if (!e.success) {
                alert("No permissions!");
                return;
            }
            openMusicLibrary();
        })
    }
});
 
win.add(btn);
win.open();
 
function openMusicLibrary() {
    Ti.Media.openMusicLibrary({
		allowMultipleSelections : true,
		success : function(event) {
			// this will be printed
		        Ti.API.info(JSON.stringify(event));
			// this crashes the app even if items &gt; 0
         		Ti.API.info('title = ' + event.items[0].title);	
		},
		cancel : function() {
			alert("Aborting ");
		},
		error : function(error) {
			// called when there's an error
			var a = Titanium.UI.createAlertDialog({
				title : 'Music Library'
			});
			if (error.code == Titanium.Media.NO_MUSIC_PLAYER) {
				a.setMessage('Please run this test on device.');
			} else {
				a.setMessage('Unexpected error: ' + error.code);
			}
			a.show();
		}
	});
}
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26829_66161/log.txt">log.txt</td></td><td>2019-02-15T07:46:30.000+0000</td><td>8354</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26829_66138/log.txt">log.txt</td></td><td>2019-02-07T11:13:29.000+0000</td><td>101028</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-26829_66169/New Test  18-2-19 10-19 PM.crash">New Test  18-2-19 10-19 PM.crash</td></td><td>2019-02-18T16:28:01.000+0000</td><td>44511</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Rakhi Mitro 2019-02-07

   Hello,
   Thanks for reporting this. Would you mind providing more information for the issues you are experiencing? It would be great if you can share the complete error logs using the following command:
   *appc run -p ios -T simulator -l trace*</li>
<li>alessandro la rocca 2019-02-07

   This is the log directly from my app, not the sample I copied before. Anyway the specific code to get items by music gallery is the same. [^log.txt] 
   
   When I try to read the "title" property of the first item selected, the app crashes. </li>
<li>Fazlul Haque 2019-02-14

   Hello [~alarocca],
   
   I have tested this issue on my end and cannot reproduce the same crash on 7.5.0.GA. Please try the below code on your end and let us know. 
   *Test Code:*
   app.js
   <code><pre>
   var win = Ti.UI.createWindow({
   	backgroundColor : '#fff'
   });
   
   var btn = Ti.UI.createButton({
   	title : 'Trigger'
   });
   
   btn.addEventListener('click', function() {
   	if (Ti.Media.hasMusicLibraryPermissions()) {
   		openMusicLibrary();
   	} else {
   		Ti.Media.requestMusicLibraryPermissions(function(e) {
   			if (!e.success) {
   				alert("No permissions!");
   				return;
   			}
   			openMusicLibrary();
   		});
   	}
   });
   
   win.add(btn);
   win.open();
   
   function openMusicLibrary() {
   	Ti.Media.openMusicLibrary({
   		allowMultipleSelections : true,
   		mediaTypes : Titanium.Media.MUSIC_MEDIA_TYPE_MUSIC | Titanium.Media.MUSIC_MEDIA_TYPE_ANY_AUDIO,
   		success : function(event) {
   			// called when media returned from the MusicLibrary
   			console.log(event.items[0]);
   			console.log(event.items[0].title);
   		},
   		cancel : function() {
   			alert("Aborting ");
   		},
   		error : function(error) {
   			// called when there's an error
   			var a = Titanium.UI.createAlertDialog({
   				title : 'Music Library'
   			});
   			if (error.code == Titanium.Media.NO_MUSIC_PLAYER) {
   				a.setMessage('Please run this test on device.');
   			} else {
   				a.setMessage('Unexpected error: ' + error.code);
   			}
   			a.show();
   		}
   	});
   }
   </pre></code>
   
   tiapp.xml file
   <code><pre>
   &lt;/dict&gt;
   	&lt;/plist&gt;
          &lt;key&gt;NSAppleMusicUsageDescription&lt;/key&gt;
   	&lt;string&gt;Play using while you are hiking&lt;/string&gt;
   	&lt;/dict&gt;
   &lt;/plist&gt;
   </pre></code>
   
   Thanks</li>
<li>alessandro la rocca 2019-02-15

   Thanks Fazlul, unfortunately even your code crashes on iOS 9.3.5 while it works on later iOS versions. Did you try it on a device running iOS 9.3.5?
   
   I just added a log on success to print the event. After this, the app crashes and does not print anything else.
   
   INFO] :   Finished building the application in 10s 626ms
   [INFO] :   Installing app on device: iPad
   [INFO] :   App successfully installed on device: iPad
   Please manually launch the application
   -- Start application log -----------------------------------------------------
   [INFO] :   Test 1.0 (Powered by Titanium 7.5.0.2e5a7423d0)
   [INFO] :   {"type":"success","representative":{},"types":1,"code":0,"success":true,"items":[{}],"source":{}}
   -- End application log -------------------------------------------------------
   
   
   <code><pre>
   function openMusicLibrary() {
   	Ti.Media.openMusicLibrary({
   		allowMultipleSelections : true,
   		mediaTypes : Titanium.Media.MUSIC_MEDIA_TYPE_MUSIC | Titanium.Media.MUSIC_MEDIA_TYPE_ANY_AUDIO,
   		success : function(event) {
   			// called when media returned from the MusicLibrary
   			console.log(JSON.stringify(event));
   			console.log(event.items[0]);
   			console.log(event.items[0].title);
   		},
   		cancel : function() {
   			alert("Aborting ");
   		},
   		error : function(error) {
   			// called when there's an error
   			var a = Titanium.UI.createAlertDialog({
   				title : 'Music Library'
   			});
   			if (error.code == Titanium.Media.NO_MUSIC_PLAYER) {
   				a.setMessage('Please run this test on device.');
   			} else {
   				a.setMessage('Unexpected error: ' + error.code);
   			}
   			a.show();
   		}
   	});
   }
   </pre></code>
   
    [^log.txt] </li>
<li>Fazlul Haque 2019-02-15

   Hi [~alarocca], Thanks for your feedback. Do you get this crash only iOS version iOS 9.3.5?. If you have any others device can you also check on that device and let us know?  Actually, I have tested it upper iOS version</li>
<li>alessandro la rocca 2019-02-15

   Yes, only iOS 9.3.5 does not work. Upper iOS versions works properly.</li>
<li>Fazlul Haque 2019-02-15

   Thanks for the information. Yes, it's not working on iOS 9.3.5. I am going to assign it to our R&D team and they will take an action soon. Thanks</li>
<li>Jan Vennemann 2019-02-27

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/10729" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10729</a></li>
<li>Samir Mohammed 2019-04-17

   FR Passed, waiting on Jenkins build.</li>
<li>Samir Mohammed 2019-04-25

    *Closing ticket*, changes present in SDK Version <code>8.1.0.v20190423134840</code>.
    
    Test and other information can be found at: 
    <a href="https://github.com/appcelerator/titanium_mobile/pull/10729" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10729</a>
    </li>
</ol>


<p><a href="/TIMOB/TIMOB-26829.json">JSON Source</a></p>