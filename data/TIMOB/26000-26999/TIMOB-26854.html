---
title: "[TIMOB-26854] iOS: Crash when handling user-activies"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-06-14T22:17:12.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.1.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2019-02-23T19:24:19.000+0000</td></tr>
<tr><th>Updated</th><td>2019-06-14T22:17:12.000+0000</td></tr>
</table>

<h3>Description</h3>

When trying to handle user activities, the app experiences a hard crash because the underlaying completion handler passed to the <code>NSOrderedSet</code> is GC'd due to a memory leak. It can be fixed by properly <code>copy</code>'ing the completion handler.

I scanned other parts of the SDK where this can happen and fixed some more cases as well. I also fixed some duplicate method definitions / leftovers from the SDK 8 Swift support migration.

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2019-02-23

   Pull: <a href="https://github.com/appcelerator/titanium_mobile/pull/10725" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10725</a>
   Test-Case: Run any app that uses handoff / UserActivity API's, like described [here](<a href="https://wiki.appcelerator.org/display/guides2/Handoff+User+Activities)." rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides2/Handoff+User+Activities).</a></li>
<li>Hans Knöchel 2019-05-02

   [~vijaysingh] Is there a chance to get this merged into master / 8.1.0 soon? It's approved already and would need to be manually patched on every SDK update right now.</li>
<li>Satyam Sekhri 2019-05-21

   FR passed. No crash observed during handoff. Tested between three devices one iOS 9 and two iOS 12 device. Also tested the handoff immediately after launch on first device and after a while. No crash observed.</li>
<li>Satyam Sekhri 2019-06-14

   Verified on:
   Mac OS 10.14.3
   Ti SDK: 8.1.0.v20190611140242
   Appc CLI: 7.0.11
   Node: 10.13.0
   XCode: 10.2.1</li>
</ol>


<p><a href="/TIMOB/TIMOB-26854.json">JSON Source</a></p>