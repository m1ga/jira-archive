---
title: "[TIMOB-27067] Android: UI sometimes disappears on Android 9.0 and higher when battery saver turns on/off"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-05-24T18:18:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.2</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, battery, engSchedule, manifest, tiapp.xml</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2019-05-07T21:53:34.000+0000</td></tr>
<tr><th>Updated</th><td>2019-05-24T18:18:05.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
On Android 9.0 and higher, a Titanium window's UI may disappear when the system's battery optimizer turn on or off. This can happen if the XML activities defined in the "tiapp.xml" are missing "android:configChanges" value "uiMode".

This issue can be reproduced consistently in an Android 9 (API 28) emulator.

*Steps to reproduce:*
<h4>Create a new Titanium Classic "Default Project".</h4>
<h4>Build and run on an Android 9 (aka: API 28) emulator.</h4>
<h4>In the Android emulator's toolbar, click the "..." button.</h4>
<h4>An "Extended Controls" window will open next to the emulator.</h4>
<h4>Click on the "Battery" tab in this window.</h4>
<h4>Go to the "Charge level" and lower it to 10%.</h4>
<h4>Click the "Charge connection" drop-down and change it from "AC charger" to "None" (or vice-versa).</h4>
<h4>In the emulator, if it asks if you want to enable the battery optimizer, tap "Yes".</h4>
<h4>Notice that the Titanium app's UI disappears.</h4>
<h4>Press the Android "Back" button.</h4>
<h4>Relaunch the app. (The UI will appear as normal.)</h4>
<h4>Click the emulator's "Charge connection" drop-down and change it back to "AC charger".</h4>
<h4>Notice that the Titanium app's UI disappears again.</h4>

*Cause:*
The "AndroidManifest.xml" that is being generated by Titanium's build system is missing a setting. We need to add "uiMode" to every Titanium <code>&lt;activity/&gt;</code> elements "android:configChanges" attribute.

*Work-Around:*
You can work-around this issue by adding the following "activity" XML settings to the "tiapp.xml" file. The key thing here is to add all of the missing "configChanges" values. Particularly the "uiMode" value which solves this ticket's specific issue.
<code><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
		&lt;manifest&gt;
			&lt;application&gt;
				&lt;activity android:name="org.appcelerator.titanium.TiActivity" android:configChanges="density|fontScale|keyboard|keyboardHidden|layoutDirection|locale|mcc|mnc|navigation|orientation|screenLayout|screenSize|smallestScreenSize|touchscreen|uiMode"/&gt;
				&lt;activity android:name="org.appcelerator.titanium.TiTranslucentActivity" android:configChanges="density|fontScale|keyboard|keyboardHidden|layoutDirection|locale|mcc|mnc|navigation|orientation|screenLayout|screenSize|smallestScreenSize|touchscreen|uiMode" android:theme="@style/Theme.Titanium.Translucent"/&gt;
			&lt;/application&gt;
		&lt;/manifest&gt;
	&lt;/android&gt;
&lt;/ti:app&gt;
</pre></code>


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-05-11

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10884" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10884</a></li>
<li>Joshua Quick 2019-05-18

   PR (8.0.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/10900" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10900</a></li>
<li>Keerthi Mahalingam 2019-05-21

   FR passed. jenkin is failing test. waiting for resolving jenkin failure to merge</li>
<li>Keerthi Mahalingam 2019-05-24

   Verified the fix on sdk 8.0.2.v20190522031334 and 8.1.0.v20190523084559. No Ui disappears. Works as expected.
   {CODE}
     Name                        = Mac OS X
     Version                     = 10.13.6
     Architecture                = 64bit
     # CPUs                      = 8
     Memory                      = 17179869184
   Node.js
     Node.js Version             = 8.9.1
     npm Version                 = 5.5.1
   Titanium CLI
     CLI Version                 = 5.1.1
   Titanium SDK
     SDK Version                 = 8.0.2.v20190522031334 and 8.1.0.v20190523084559
   Emulator =Pixel xl android 9.pixel android 9
   Device = s5 samsung android 6
   Cli =7.0.11
   {CODE}</li>
</ol>


<p><a href="/TIMOB/TIMOB-27067.json">JSON Source</a></p>