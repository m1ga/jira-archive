---
title: "[TIMOB-27084] Android: "tiapp.xml" is unable to override "AndroidManifest.xml" settings defined in AAR or "timodule.xml""
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-05-23T20:02:44.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.0.2</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>aar, android, build, engSchedule, manifest, tiapp.xml, timodule</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2019-05-17T03:53:11.000+0000</td></tr>
<tr><th>Updated</th><td>2019-05-23T20:02:44.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The "tiapp.xml" file's "AndroidManifest.xml" settings is unable to override the XML elements such as <code>&lt;activity/&gt;</code>, <code>&lt;receiver/&gt;</code>, etc. that are defined in a native module's "timodule.xml" or a native AAR library's embedded "AndroidManifest.xml".

*Example Use-Case:*
Microsoft's authentication library (aka: MSAL) requires the app developer to override its <code>com.microsoft.identity.client.BrowserTabActivity</code> in the app project's "AndroidManifest.xml" and add an intent-filter to it. This is needed the Chrome web browser app will return the end-user back to the app that requested single-signon.
<a href="https://github.com/Azure-Samples/ms-identity-android-native" rel="nofollow" target="_blank">https://github.com/Azure-Samples/ms-identity-android-native</a>

*Steps to Reproduce:*
<h4>Create a Titanium Classic "Default Project".</h4>
<h4>Insert the android manifest XML settings below into the "tiapp.xml" file.</h4>
<h4>Create the follow subfolders under the project: <code>./platform/android</code></h4>
<h4>Copy this ticket's [^msal-0.2.2.aar] file to the <code>./platform/android</code> folder.</h4>
<h4>Build the app for Android.</h4>
<h4>Go to the project's <code>./build/android</code> directory via Finder/WindowsExplorer.</h4>
<h4>Open the "AndroidManifest.xml" file.</h4>
<h4>Notice that the <code>&lt;intent-filter/&gt;</code> shown below was not injected into the "AndroidManifest.xml" file. _(This is the bug.)_</h4>

<code><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
		&lt;manifest&gt;
			&lt;application&gt;
				&lt;activity android:name="com.microsoft.identity.client.BrowserTabActivity"&gt;
					&lt;intent-filter&gt;
						&lt;action android:name="android.intent.action.VIEW"/&gt;
						&lt;category android:name="android.intent.category.DEFAULT"/&gt;
						&lt;category android:name="android.intent.category.BROWSABLE"/&gt;
						&lt;data android:scheme="msauth" android:host="my.domain.com" android:path="my-path"/&gt;
					&lt;/intent-filter&gt;
				&lt;/activity&gt;
			&lt;/application&gt;
		&lt;/manifest&gt;
	&lt;/android&gt;
&lt;/ti:app&gt;
</pre></code>

*Recommended Fix:*
We should change the <code>finalAndroidManifest</code> merge order in the SDK's "_build.js" script [here](<a href="https://github.com/appcelerator/titanium_mobile/blob/2a16df7481b0a3331d2f56365463f0a9a8031d09/android/cli/commands/_build.js#L3909)." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/2a16df7481b0a3331d2f56365463f0a9a8031d09/android/cli/commands/_build.js#L3909).</a> The order should be:
<h4><code>this.androidLibraries.forEach(/* finalAndroidManifest.merge(am) */)</code></h4>
<h4><code>this.modules.forEach(/* finalAndroidManifest.merge(am) */)</code></h4>
<h4><code>finalAndroidManifest.merge(customAndroidManifest)</code></h4>
<h4><code>finalAndroidManifest.merge(tiappAndroidManifest)</code></h4>

----
*Work-Around:*
Delete the XML setting that you want to override from the "timodule.xml" file or AAR file. Note that you can unzip an AAR file, change its embedded "AndroidMainfest.xml" file, and then re-zip it. Changing the AAR library's extension from ".aar" to ".zip" is an easy way to unzip it.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-27084_66610/msal-0.2.2.aar">msal-0.2.2.aar</td></td><td>2019-05-17T03:27:40.000+0000</td><td>158980</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-05-17

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/10884" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10884</a></li>
<li>Joshua Quick 2019-05-18

   PR (8.0.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/10900" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10900</a></li>
<li>Keerthi Mahalingam 2019-05-21

   FR passed. jenkin is failing test. waiting for resolving jenkin failure to merge</li>
<li>Keerthi Mahalingam 2019-05-23

   Verified the fix on SDK 8.1.0.v20190523084559 and 8.0.2.v20190522031334. Works as expected.
   {CODE}
   Operating System
     Name                        = Mac OS X
     Version                     = 10.13.6
     Architecture                = 64bit
     # CPUs                      = 8
     Memory                      = 17179869184
   Node.js
     Node.js Version             = 8.9.1
     npm Version                 = 5.5.1
   Titanium CLI
     CLI Version                 = 5.1.1
   Titanium SDK
     SDK Version                 = 8.1.0.v20190523084559 and 8.0.2.v20190522031334
   Cli =7.0.11
   Studio =5.1.2.201903111843
   {CODE}</li>
</ol>


<p><a href="/TIMOB/TIMOB-27084.json">JSON Source</a></p>