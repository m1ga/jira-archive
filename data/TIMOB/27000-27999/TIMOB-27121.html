---
title: "[TIMOB-27121] iOS: Infinite recursion crash"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 8.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2019-06-03T18:25:16.000+0000</td></tr>
<tr><th>Updated</th><td>2019-06-15T21:27:41.000+0000</td></tr>
</table>

<h3>Description</h3>

Seen on our CI build nodes when the test suite crashed.

Here's the log prior to crash:
<code><pre>
[2019-06-03T17:59:55.477Z] [INFO] :   !TEST_START: responseHeadersBug
[2019-06-03T17:59:55.477Z] [WARN] :   Automatic setter methods for properties are deprecated in SDK 8.0.0 and will be removed in SDK 9.0.0. Please modify the property in standard JS style: obj.timeout = value; or obj['timeout'] = value;
[2019-06-03T17:59:56.625Z] [WARN] :   Automatic getter methods for properties are in SDK 8.0.0 and will be removed in SDK 9.0.0. Please access the property in standard JS style: obj.allResponseHeaders or obj['allResponseHeaders']
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_END: {"state":"passed","duration":964,"suite":"Titanium.Network.HTTPClient","title":"responseHeadersBug","message":""}
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_START: requestHeaderMethods
[2019-06-03T17:59:56.625Z] [WARN] :   Automatic setter methods for properties are deprecated in SDK 8.0.0 and will be removed in SDK 9.0.0. Please modify the property in standard JS style: obj.timeout = value; or obj['timeout'] = value;
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_END: {"state":"passed","duration":103,"suite":"Titanium.Network.HTTPClient","title":"requestHeaderMethods","message":""}
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_START: sendData
[2019-06-03T17:59:56.625Z] [WARN] :   Automatic setter methods for properties are deprecated in SDK 8.0.0 and will be removed in SDK 9.0.0. Please modify the property in standard JS style: obj.timeout = value; or obj['timeout'] = value;
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_END: {"state":"passed","duration":141,"suite":"Titanium.Network.HTTPClient","title":"sendData","message":""}
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_END: {"state":"skipped","duration":0,"suite":"Titanium.Network.HTTPClient","title":"clearCookiePositiveTest","message":""}
[2019-06-03T17:59:56.625Z] [INFO] :   !TEST_START: clearCookieUnaffectedCheck
[2019-06-03T17:59:56.625Z] [WARN] :   Automatic setter methods for properties are deprecated in SDK 8.0.0 and will be removed in SDK 9.0.0. Please modify the property in standard JS style: obj.timeout = value; or obj['timeout'] = value;
[2019-06-03T18:00:02.522Z] [INFO] :   Second Load
[2019-06-03T18:00:11.433Z] -- End simulator log ---------------------------------------------------------
[2019-06-03T18:00:11.433Z] Failed to finish test suite before app crashed and logs ended!
script returned exit code 1
</pre></code>

The attached crash log gives the details, and it's pretty clearly in an infinite recursion loop in TiBindingTiValueToNSObject and TiBindingTiValueToNSDictionary - presumably some object with a circular reference?

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27121_66665/mocha_2019-06-03-110012_macos-rocket.crash">mocha_2019-06-03-110012_macos-rocket.crash</td></td><td>2019-06-03T18:25:12.000+0000</td><td>186135</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2019-06-15

   It has to be an API (probably a Ti.Network cookie) that passes a type to the core that cannot be handled by other JSCore types. If that happens inside <code>TiBindingTiValueToNSObject</code>, then <code>TiBindingTiValueToNSDictionary</code> is called as a fallback. Long story short, the issue likely was that [this line](<a href="https://github.com/appcelerator/titanium-mobile-mocha-suite/blob/31d9061b6754f30c6ced1b5ecc60f259cabbc078/Resources/ti.network.httpclient.test.js#L310)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium-mobile-mocha-suite/blob/31d9061b6754f30c6ced1b5ecc60f259cabbc078/Resources/ti.network.httpclient.test.js#L310)</a> in the test suite did not properly unwrap the received headers when calling <code><a href="https://my.appcelerator.com/auth/login" rel="nofollow" target="_blank">https://my.appcelerator.com/auth/login</a></code>, so if the URL did not pass <code>Set-Cookie</code>, then the getter internally still checks for the key using <code>\[\[\[self response\] headers\] valueForKey:args\]</code>, resulting in a object check with an undefined / non-string key. Still can be something else, but rewriting the test case should have fixed it. It seems like it was just removed, so maybe someone can clean it up and this ticket will be done as well.</li>
</ol>


<p><a href="/TIMOB/TIMOB-27121.json">JSON Source</a></p>