---
title: "[TIMOB-27191] Android: Ti.Filesystem.getFile is not tolerant of file: URIs without file:// prefix"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-10-15T14:02:30.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 8.0.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2019-06-27T14:11:05.000+0000</td></tr>
<tr><th>Updated</th><td>2019-10-30T14:58:41.000+0000</td></tr>
</table>

<h3>Description</h3>

A URI like this: "file:/data/user/0/com.appcelerator.testApp.testing/cache/_tmp/rmdir1561643019762/myfile.txt" should be valid and supported.

However, Android's logic uses some string matching rather than URI parsing to handle the value and it appears to use incorrect logic when the file URI does not have the two trailing slashes before the path.

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2019-10-15

   Merged to master, since this was a very specific bug fix needed for the Node compatible fs shim, and I included test cases that exposed and proved the fix.</li>
<li>Samir Mohammed 2019-10-30

   Closing ticket, fix verified in SDK version `<code> Tested with variations of the test case in: <a href="https://github.com/appcelerator/titanium_mobile/pull/11098/files#diff-f9ca2bcf4d55586a8d003e3c0bd51db5." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11098/files#diff-f9ca2bcf4d55586a8d003e3c0bd51db5.</a> e.g:
   
   <code><pre>
         const appJSURI = isIOS ? 'app.js' : 'app://app.js'; // iOS doesn't support app: uris!
   			const appJS = Ti.Filesystem.getFile(appJSURI);
   
   			// Generate a file:// URI for the temp dir. Android reports one as-is, iOS reports an sbolute filepath so we pre-pend file:// to it
   			// file:///data/user/0/com.appcelerator.testApp.testing/cache/_tmp on Android
   			// Note also, that IOS reports trailing slash, Android does not
   			const prefix = isIOS ? </code>file://${Ti.Filesystem.tempDirectory}<code> : </code>${Ti.Filesystem.tempDirectory}/<code>;
   			fileURI = </code>${prefix}app.js<code>;
   			console.log(</code>[1] Copying app.js to ${fileURI}<code>);
   			appJS.copy(fileURI);
   			noSchemeTempAppJS = fileURI.substring(7); // should be /data/user/0/com.appcelerator.testApp.testing/cache/_tmp/app.js
   			console.log(</code>[2] Copy's file path should be: ${noSchemeTempAppJS}<code>);
   
   			const appDataPrivateJS = </code>${Ti.Filesystem.applicationDataDirectory}/appdata-private.js<code>;
   			appJS.copy(appDataPrivateJS);
   			console.log(</code>[3] Copying app.js to ${appDataPrivateJS}`);
   </pre></code>
   
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11098" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11098</a>
   
   </li>
<li>Samir Mohammed 2019-10-30

   SDK Version ^ 8.3.0.v20191028152746</li>
</ol>


<p><a href="/TIMOB/TIMOB-27191.json">JSON Source</a></p>