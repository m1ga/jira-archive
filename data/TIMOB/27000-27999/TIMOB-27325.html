---
title: "[TIMOB-27325] Android: Adding <uses-library/> within "tiapp.xml" file's <manifest/> block creates invalid entry in "AndroidManifest.xml""
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-01-10T15:19:42.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, cb-tooling, engSchedule, library, manifest, tiapp.xml, xml</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2019-08-09T02:56:59.000+0000</td></tr>
<tr><th>Updated</th><td>2020-01-10T15:19:42.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
Adding a <code>&lt;uses-library/&gt;</code> element within the "tiapp.xml" file's <code>&lt;manifest/&gt;</code> block will create an invalid entry within the generated "AndroidManifest.xml" when doing a build.

*Note:*
The <code>&lt;uses-library/&gt;</code> entry is supposed to go within the <code>&lt;application/&gt;</code> block, not the <code>&lt;manifest/&gt;</code> block. So, doing this would have been invalid anyways. This makes this bug a very minor issue.
<a href="https://developer.android.com/guide/topics/manifest/uses-library-element" rel="nofollow" target="_blank">https://developer.android.com/guide/topics/manifest/uses-library-element</a>

*Steps to reproduce:*
<h4>Setting a project's "tiapp.xml" with the <code>&lt;uses-library/&gt;</code> entry below.</h4>
<h4>Build the project.</h4>
<h4>Open Finder or Window Explorer.</h4>
<h4>Go to project's subdirectory: <code>./build/android</code></h4>
<h4>Open the "AndroidManifest.xml" file.</h4>

<code><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
		&lt;manifest&gt;
			&lt;uses-library android:name="com.google.android.maps"/&gt;
		&lt;/manifest&gt;
	&lt;/android&gt;
&lt;/ti:app&gt;
</pre></code>

*Result:*
The following invalid XML element can be found within the "AndroidManifest.xml" file. This doesn't prevent the app from running, but it's still not good that this is there.
<code><pre>
&lt;uses-library&gt;[object Object]&lt;/uses-library&gt;
</pre></code>

*Expected Result:*
Build system should either omit the <code>&lt;uses-library/&gt;</code> entry or add it as-is.

*Solution:*
As noted above, the <code>&lt;uses-library/&gt;</code> is supposed to go within the <code>&lt;application/&gt;</code> block. So, all Titanium app devs should be doing the following instead. The build system will correctly inject this into the "AndroidManifest.xml" file.
<code><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ti:app xmlns:ti="<a href="http://ti.appcelerator.org" rel="nofollow" target="_blank">http://ti.appcelerator.org</a>"&gt;
	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
		&lt;manifest&gt;
			&lt;application&gt;
				&lt;uses-library android:name="com.google.android.maps"/&gt;
			&lt;/application&gt;
		&lt;/manifest&gt;
	&lt;/android&gt;
&lt;/ti:app&gt;
</pre></code>


<h3>Comments</h3>

<ol>
<li>Chris Barber 2019-10-02

   I think this is as simple as removing <code>&lt;uses-library&gt;</code> as a valid tag name under the <code>&lt;manifest&gt;</code>:
   
   <a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/cli/lib/AndroidManifest.js#L376" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/cli/lib/AndroidManifest.js#L376</a>
   and
   <a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/cli/lib/AndroidManifest.js#L558" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/cli/lib/AndroidManifest.js#L558</a></li>
<li>Gary Mathews 2019-12-16

   [~jquick] I see this is _In QE Testing_, is there a PR for this?</li>
<li>Joshua Quick 2019-12-16

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11339" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11339</a>
   
   [~gmathews], sorry about that. The above gradle PR solves it because the "AndroidManifest.xml" is merged/validated by Google's build tools. There is already a test written on that PR verifying that this issue will (rightfully) trigger a build failure.</li>
<li>Lokesh Choudhary 2019-12-20

   FR Passed.
   PR Merged.</li>
<li>Samir Mohammed 2020-01-10

   Closing ticket, fix verified in SDK Version <code>9.0.0.v20200109153329</code>.
   
   Test and other information can be found at: 
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11339" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11339</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-27325.json">JSON Source</a></p>