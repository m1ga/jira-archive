---
title: "[TIMOB-27386] iOS: Correctly decode push notification token"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-09-16T09:28:53.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 8.2.0, Release 8.1.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.2.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>engSchedule</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2019-09-09T13:12:07.000+0000</td></tr>
<tr><th>Updated</th><td>2021-01-06T08:42:46.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

On iOS 13 registering for push notifications returns an invalid device token, this is because the way we decode the device token has been broken by apple (although it seems it wasnt a recommended way anyways)

See <a href="https://github.com/OneSignal/OneSignal-iOS-SDK/pull/509" rel="nofollow" target="_blank">https://github.com/OneSignal/OneSignal-iOS-SDK/pull/509</a>

<code><pre>
Ti.App.iOS.addEventListener('usernotificationsettings', function registerForPush() {
 
    // Remove event listener once registered for push notifications
    Ti.App.iOS.removeEventListener('usernotificationsettings', registerForPush); 
 
    Ti.Network.registerForPushNotifications({
        success: deviceTokenSuccess,
        error: deviceTokenError,
        callback: receivePush
    });
});
 
// Register notification types to use
Ti.App.iOS.registerUserNotificationSettings({
    types: [
        Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,
        Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,
        Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE
    ]
});
 
// Process incoming push notifications
function receivePush(e) {
    alert('Received push: ' + JSON.stringify(e));
}
// Save the device token for subsequent API calls
function deviceTokenSuccess(e) {
	console.log('Yay it worked!');
	console.log(e);
}
 
function deviceTokenError(e) {
	console.log('Failed to register for push notifications! ' + e.error);
	console.log(e);
}
</pre></code>

<h4>Steps to reproduce</h4>

1. Add the below code to an app.js or alloy.js

<h4>Actual</h4>

The device token printed looks like 
<code><pre>
{length=32,bytes=0x17b4427542a3d1e6a4d69d976b4539bc...7edb18a21200a8d2}
</pre></code>

<h4>Expected</h4>

The device token should look like

<code><pre>
17b4427542a3d1e6a4d69d976b4539bcf227f216b02b5fd97edb18a21200a8d2
</pre></code>

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2019-09-09

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/11202" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11202</a>
   8_2_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/11203" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11203</a></li>
<li>Ewan Harris 2019-09-10

   fixed 8_2_X PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/11207" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11207</a></li>
<li>Samir Mohammed 2019-09-10

   FR Passed. Waiting on Jenkins builds for Master and 8_2_X.</li>
<li>Christopher Williams 2019-09-12

   master PR was already merged. Merged 8_2_X PR.</li>
<li>Samir Mohammed 2019-09-16

   Closing ticket. Fix verified in SDK version <code>8.2.0.v20190912104344</code> and SDK version <code>8.3.0.v20190913104800</code>.
   
   Test and other information can be found at: 
   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/11202" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11202</a>
   8_2_X: <a href="https://github.com/appcelerator/titanium_mobile/pull/11203" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11203</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-27386.json">JSON Source</a></p>