---
title: "[TIMOB-27434] Android: Re-layout of deeply nested views can cause performance issues as of 7.5.0"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-10-10T15:16:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 7.5.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.2.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, engSchedule, regression, view</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2019-10-02T02:10:44.000+0000</td></tr>
<tr><th>Updated</th><td>2020-10-05T08:19:23.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
If you have very deeply nested views (say 15 or more), then anything that causes them to be re-laid out can cause noticeable performance issues as of Titanium 7.5.0.

*Steps to reproduce:*
<h4>Build and run the below code on Android.</h4>
<h4>Tap and hold on the text within the <code>TextField</code>.</h4>
<h4>Notice that the app hangs for a couple of seconds.</h4>
<h4>Rotate the device to landscape.</h4>
<h4>Notice that the app hangs for a couple of seconds.</h4>

<code><pre>
var window = Ti.UI.createWindow();
var rootView = Ti.UI.createView({ width: Ti.UI.FILL, height: Ti.UI.FILL });
var topView = rootView;
for (var index = 0; index < 20; index++) {
	var nextView = Ti.UI.createView({ width: Ti.UI.FILL, height: Ti.UI.FILL });
	topView.add(nextView);
	topView = nextView;
}
var textField = Ti.UI.createTextField({
	value: "Hello World",
	width: "80%",
});
topView.add(textField);
window.add(rootView);
window.open();
</pre></code>

*Cause:*
This regression was introduced in 7.5.0 when we added the "extendSafeArea" and "safeAreaPadding" feature. The performance issue is caused by our Java [TiCompositeLayout.onApplyWindowInsets()](<a href="https://github.com/appcelerator/titanium_mobile/blob/3b925d3b89e0d59bf89b846bfa127e9656746dbf/android/titanium/src/java/org/appcelerator/titanium/view/TiCompositeLayout.java#L460)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/3b925d3b89e0d59bf89b846bfa127e9656746dbf/android/titanium/src/java/org/appcelerator/titanium/view/TiCompositeLayout.java#L460)</a> method when you have deeply nested views (say 15 or more layers). The dispatched window inset handling appears to get exponentially worse the more views you have nested. Especially since each child view that applies those insets triggers a request-layout.

*Work-around:*
Only known work-around is to not nest your views so deeply. Try not to nest more than 10 layers deep.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-10-02

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11253" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11253</a>
   PR (8.2.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/11254" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11254</a>
   </li>
<li>Hans Kn√∂chel 2019-10-02

   We have many candidates for this issue and will try it out immediately, thank you!</li>
<li>Lokesh Choudhary 2019-10-03

   FR Passed.
   Waiting for jenkins to merge.</li>
<li>Christopher Williams 2019-10-08

   Merged to master and 8_2_X</li>
<li>Sohail Saddique 2019-10-10

   Fix verified with build: 8.2.1.v20191009074714
   
   App no longer hangs upon long press. Ticket closed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-27434.json">JSON Source</a></p>