---
title: "[TIMOB-27459] iOS: App crashes when error happens in fetching location"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-10-15T14:22:05.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 8.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 8.3.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>engSchedule, iOS</td></tr>
<tr><th>Reporter</th><td>suhas.kumbhar</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2019-10-07T20:47:27.000+0000</td></tr>
<tr><th>Updated</th><td>2019-10-15T15:42:27.000+0000</td></tr>
</table>

<h3>Description</h3>

After upgrading to 8.2.0.GA.
- App crashes as soon as I switch to Airplane mode
- App crashes on app launch with same error

Terminating app due to uncaught exception 'NSInvalidArgumentException'

I have attached a sample app using geolocation. Code snipped is same as mentioned in documentation.

This is iOS app. This is always reproducible.
Xcode - 10.3
node - v10.16.3

Same code 
works fine if built with 8.0.1.GA
Crashes if built with  8.2.0.GA

Attached- 
1. Screen recording of crash
2. Sample app project
3. Sample app ipa

Crash log:
<code><pre>

default	15:18:01.721620 -0500	GeolocationCrash	{"msg":"delivering locations to client's delegate", "self":"0x2824b8680", "delegate":"0x155d072b0"}
default	15:18:01.797652 -0500	GeolocationCrash	-[GeolocationModule fireEvent:withObject:errorCode:message:]: unrecognized selector sent to instance 0x155d072b0
default	15:18:01.797787 -0500	GeolocationCrash	[ERROR] Application received error: -[GeolocationModule fireEvent:withObject:errorCode:message:]: unrecognized selector sent to instance 0x155d072b0
    0   CoreFoundation                      0x00000001c2e649a0 8D0042D6-AED4-39A5-9EE6-10D9A4CCD8E3 + 1227168
    1   libobjc.A.dylib                     0x00000001c2b8d0a4 objc_exception_throw + 56
    2   CoreFoundation                      0x00000001c2d6843c 8D0042D6-AED4-39A5-9EE6-10D9A4CCD8E3 + 193596
    3   CoreFoundation                      0x00000001c2e68e08 8D0042D6-AED4-39A5-9EE6-10D9A4CCD8E3 + 1244680
    4   CoreFoundation                      0x00000001c2e6abec _CF_forwarding_prep_0 + 92
    5   GeolocationCrash                    0x0000000104f9888c GeolocationCrash + 346252
    6   CoreLocation                        0x00000001c5f8de0c CLClientStopVehicleHeadingUpdates + 72136
    7   CoreLocation                        0x00000001c5f774a4 CLClientInvalidate + 1400
    8   CoreFoundation                      0x00000001c2de2614 8D0042D6-AED<â€¦>
default	15:18:01.797995 -0500	GeolocationCrash	*** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '-[GeolocationModule fireEvent:withObject:errorCode:message:]: unrecognized selector sent to instance 0x155d072b0'
*** First throw call stack:
(0x1c2e6498c 0x1c2b8d0a4 0x1c2d6843c 0x1c2e68e08 0x1c2e6abec 0x104f9888c 0x1c5f8de0c 0x1c5f774a4 0x1c2de2614 0x1c2de1db4 0x1c2ddd4ec 0x1c2ddc8bc 0x1ccc41328 0x1c6e716d4 0x104f48bd8 0x1c2c67460)
default	15:18:01.823594 -0500	backboardd	Connection removed: IOHIDEventSystemConnection uuid:FB3D98B9-260A-414D-81A4-762AFAC211FD pid:1891 process:GeolocationCrash type:Passive entitlements:0x0 caller:BackBoardServices: <redacted> + 380 attributes:{
    HighFrequency = 0;
    bundleID = "com.svm.TMXFieldServTest";
    pid = 1891;
} inactive:0 events:0 mask:0x0
default	15:18:01.838460 -0500	ReportCrash	cr_update: Parsing corpse data for process GeolocationCrash [pid 1891]

</pre></code>



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-27459_67015/Crash_ScreenRecording.mov">Crash_ScreenRecording.mov</td></td><td>2019-10-07T20:45:32.000+0000</td><td>7377180</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-27459_67013/GeolocationCrash_8.2.ipa">GeolocationCrash_8.2.ipa</td></td><td>2019-10-07T20:46:01.000+0000</td><td>9146579</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-27459_67016/GeolocationCrash  10-7-19, 5-08 PM.crash">GeolocationCrash  10-7-19, 5-08 PM.crash</td></td><td>2019-10-07T22:11:05.000+0000</td><td>68615</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-27459_67014/GeolocationCrashSampleAppCode.zip">GeolocationCrashSampleAppCode.zip</td></td><td>2019-10-07T20:45:52.000+0000</td><td>5710506</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2019-10-07

   Hello, Can you please share the trace log of the crash? Thanks.</li>
<li>suhas.kumbhar 2019-10-07

   I don't see any track logs in IDE after crash - I exported crash log from xcode - please check if this is what you want.
   
    [^GeolocationCrash  10-7-19, 5-08 PM.crash] </li>
<li>suhas.kumbhar 2019-10-09

   just checking, is it being looked into?</li>
<li>Vijay Singh 2019-10-09

   Test Case - 
   
   <code><pre>
   var win = Ti.UI.createWindow();
   var btn = Ti.UI.createButton({
       title: 'Show Location'
   });
   
   btn.addEventListener('click', function() {    
       Ti.Geolocation.accuracy = Ti.Geolocation.ACCURACY_HIGH;
       var whenInUsePermission = Ti.Geolocation.hasLocationPermissions(Ti.Geolocation.AUTHORIZATION_WHEN_IN_USE);
   	var alwaysPermission = Ti.Geolocation.hasLocationPermissions(Ti.Geolocation.AUTHORIZATION_ALWAYS);
       if (whenInUsePermission || alwaysPermission) {
           getLocation();
        } else {
           Ti.Geolocation.requestLocationPermissions(Ti.Geolocation.AUTHORIZATION_ALWAYS, function(e) {
               if (e.success) {
                   getLocation();
               } else {
                   alert('could not obtain location permissions');
               }
           });
       }
   });
   
   win.add(btn);
   win.open();
   
   function getLocation() {
       Ti.Geolocation.addEventListener('location', function(e) {
           alert(JSON.stringify(e, null, 2));
       });
   }
   </pre></code>
   </li>
<li>Vijay Singh 2019-10-09

   PR - <a href="https://github.com/appcelerator/titanium_mobile/pull/11273" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11273</a></li>
<li>Sohail Saddique 2019-10-14

   FR: Passed. I have confirmed that this issue affects > iOS 12. This does not affect < iOS 12. PR Merged.
   
   *Test Environment*
   Studio Ver:     5.1.4.201909061933
   SDK Ver:        8.3.0 (PR-11273)
   OS Ver:         10.14.6
   Xcode Ver:      Xcode 11.1
   Appc NPM:       4.2.15
   Appc CLI:       7.1.1
   Alloy Ver:      1.14.1
   Node Ver:       10.16.3
   NPM Ver:        6.11.3
   Devices:        iPhone 7 (iOS 13), iPhone 6 (iOS 12), iPhone 6 (iOS 11)
   </li>
<li>Sohail Saddique 2019-10-15

   Verified with build: 8.3.0.v20191015062903.
   
   Ticked closed.</li>
<li>suhas.kumbhar 2019-10-15

   Thanks</li>
</ol>


<p><a href="/TIMOB/TIMOB-27459.json">JSON Source</a></p>