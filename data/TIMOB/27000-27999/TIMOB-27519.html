---
title: "[TIMOB-27519] Android: Semantic Colors with alpha value"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-05-26T17:31:52.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.1.0</td></tr>
<tr><th>Components</th><td>n/a</td></tr>
<tr><th>Labels</th><td>android, darkmode, engSchedule, parity</td></tr>
<tr><th>Reporter</th><td>Michael Gangolf</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2019-09-21T17:54:43.000+0000</td></tr>
<tr><th>Updated</th><td>2020-08-25T00:41:08.000+0000</td></tr>
</table>

<h3>Description</h3>



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-27519_67039/0001-fix-android-semantic-colors-with-alpha-value.patch">0001-fix-android-semantic-colors-with-alpha-value.patch</td></td><td>2019-10-10T09:53:12.000+0000</td><td>2504</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Kn√∂chel 2019-09-22

   Are you sure it doesn't use the alpha value? This works for us:
   <code><pre>
   {
       "mainColor": {
           "dark": {
               "color: "#000000",
               "alpha: "50"
           },
           "light": {
               "color: "#ffffff",
               "alpha: "50"
           }
       }
   }
   </pre></code></li>
<li>Michael Gangolf 2019-09-22

   </li>
<li>Sergey Volkov 2019-09-30

   Ti.UI.fetchSemanticColor() on Android (and I assume iOS < 13) returns only <code>"color"</code>, and is loosing the <code>"alpha"</code>:
   <a href="https://github.com/appcelerator/titanium_mobile/blob/3b925d3b89e0d59bf89b846bfa127e9656746dbf/common/Resources/ti.internal/extensions/ti/ti.ui.js#L55" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/3b925d3b89e0d59bf89b846bfa127e9656746dbf/common/Resources/ti.internal/extensions/ti/ti.ui.js#L55</a>
   
   To fix it, I put this code into my alloy.js (based on [iphone/cli/commands/_build.js#generateSemanticColors](<a href="https://github.com/appcelerator/titanium_mobile/blob/3b925d3b89e0d59bf89b846bfa127e9656746dbf/iphone/cli/commands/_build.js#L5802)):" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/3b925d3b89e0d59bf89b846bfa127e9656746dbf/iphone/cli/commands/_build.js#L5802)):</a>
   <code><pre>
   (function() {
     const osVersion = parseInt(Ti.Platform.version.split('.')[0]);
   
     if (Ti.App.iOS && osVersion >= 13) {
       return;
     }
     const colorset = require('/semantic.colors.json');
     const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
     const fallbackColor = 'black'; // To match iphone/Classes/TiUIiOSProxy.m#fetchSemanticColor
   
     const hexToRgb = function hexToRgb(hex) {
       let alpha = 1;
       let color = hex;
       if (hex.color) {
         alpha = hex.alpha / 100; // convert from 0-100 range to 0-1 range
         color = hex.color;
       }
       // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
       color = color.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);
   
       const r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(color);
       return r ? <code>rgba(${parseInt(r[1], 16)}, ${parseInt(r[2], 16)}, ${parseInt(r[3], 16)}, ${alpha.toFixed(3)})</code>: null;
     };
     Ti.UI.fetchSemanticColor = function(name) {
       if (!colorset[name]) {
         return fallbackColor;
       }
       const color = colorset[name][Ti.UI.semanticColorType];
       if (typeof color === 'string') {
         return color;
       }
       if (!color || typeof color !== 'object') {
         return fallbackColor;
       }
       if (color['color'] && color['alpha']) {
         const result = hexToRgb(color);
         if (result) {
           return result;
         }
       }
       return fallbackColor;
     }
   })();
   
   if (Alloy && Alloy.CFG && Alloy.CFG.color) {
     const colorset = require('/semantic.colors.json');
   
     Object.keys(colorset).forEach(name => {
       const color = Ti.UI.fetchSemanticColor(name);
       console.log(<code>Alloy.CFG.color[${name}]: ${color}</code>);
       Alloy.CFG.color[name] = color;
     });
   }
   </pre></code></li>
<li>Sergey Volkov 2019-10-10

   I attached patch for the SDK with fix for this issue.
   Will send a PR after the ticket is approved (don't like commits without reference to ticket).</li>
<li>Sharif AbuDarda 2019-11-03

   Hello [~s.volkov], Please share the PR here. Moving to TIMOB. </li>
<li>Sergey Volkov 2019-11-05

   <a href="https://github.com/appcelerator/titanium_mobile/pull/11315" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11315</a></li>
<li>Christopher Williams 2020-05-21

   <a href="https://github.com/appcelerator/titanium_mobile/pull/11315" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11315</a></li>
<li>Christopher Williams 2020-05-26

   merged to master for 9.1.0 target</li>
</ol>


<p><a href="/TIMOB/TIMOB-27519.json">JSON Source</a></p>