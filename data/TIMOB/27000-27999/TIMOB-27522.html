---
title: "[TIMOB-27522] WebView: onlink and beforeload are not consistent across platforms"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2019-12-10T16:18:09.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 8.2.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>engSchedule, parity</td></tr>
<tr><th>Reporter</th><td>Giorgio Mandolini</td></tr>
<tr><th>Assignee</th><td>Jan Vennemann</td></tr>
<tr><th>Created</th><td>2019-10-24T15:30:33.000+0000</td></tr>
<tr><th>Updated</th><td>2019-12-10T16:18:09.000+0000</td></tr>
</table>

<h3>Description</h3>

What happens:

- on iOS both the <code>onlink</code> function and the <code>beforeload</code> event are called when setting  <code>html</code>, while on Android this happens only for <code>beforeload</code>.

- on iOS both the <code>onlink</code> function and the <code>beforeload</code> event are called also for embeds (like iframe) while on Android this not happen at all.

This is causing me some trouble working on iOS because of "false positive" events that I need to distinguish as user clicks or normal page loading.

I'd like to suggest a PR where

*solution 1:*

- iOS will send <code>onlink</code> only when navigation type is <code>WKNavigationTypeLinkActivated</code>
- beforeload event will expose the <code>isMainFrame</code> indication to indicate if it was generated on the main page or an iframe.

_or:_

*solution 2:*

- iOS will send <code>onlink</code> only when navigation type is <code>WKNavigationTypeLinkActivated</code>
- beforeload event is generated only if <code>navigationAction.targetFrame.isMainFrame</code> is true

At the moment I've implemented in the PR the first solution, since iOS is already a little different from Android because it already exposes the platform specific attribute <code>navigationType</code>

See the [PR](<a href="https://github.com/appcelerator/titanium_mobile/pull/11295)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11295)</a>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27522_67086/app.js">app.js</td></td><td>2019-10-24T15:20:23.000+0000</td><td>1019</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27522_67085/logs.txt">logs.txt</td></td><td>2019-10-24T15:21:58.000+0000</td><td>2850</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2019-10-24

   The "onlink" callback is only intended to be invoked when the end-user taps/click on a link. It's not supposed to be invoked when loading a page via the "url"/"html" properties or when navigation programmatically via the HTML's own JavaScript code. If this is the behavior that you are seeing on iOS, then the native iOS code needs to be changed to match Android's behavior. (Android can't replicate iOS' WebView behavior in this case anyways.)
   </li>
<li>Giorgio Mandolini 2019-10-25

   Thanks for the clarification Joshua, actually the iOS webview calls the onlink callback too many times (details on logs), so it would be better to implement the solution #1 and stop iOS to send events when they are not user generated.</li>
<li>Joshua Quick 2019-11-06

   [~gmandolini]'s PR can be found here:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11295" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11295</a>
   </li>
<li>Satyam Sekhri 2019-11-27

   FR Passed. Webview onLink is not called along with beforeLoad when setting html. It is fired when a link in the html is clicked and the link is being navigated.</li>
<li>Satyam Sekhri 2019-11-27

   Waiting for Jenkins build to pass</li>
<li>Lokesh Choudhary 2019-12-04

   PR Merged.</li>
<li>Sohail Saddique 2019-12-10

   Fix verified on build: 9.0.0.v20191209135132. onlink does not fire unnecessarily unless by manual user navigation.
   
   Ticket closed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-27522.json">JSON Source</a></p>