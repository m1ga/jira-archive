---
title: "[TIMOB-27710] TiAPI: Support optional callback functions for async methods that typically fire events"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.2.0</td></tr>
<tr><th>Components</th><td>TiAPI</td></tr>
<tr><th>Labels</th><td>engSchedule</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2020-01-08T15:04:34.000+0000</td></tr>
<tr><th>Updated</th><td>2021-10-07T16:04:52.000+0000</td></tr>
</table>

<h3>Description</h3>

We have a number of basic operations that rely on event listener based usage to handle notifying when the operation is "complete". While this works, it can lead to a lot of boilerplate code for hanging simple one-time callback logic when the operation is complete.

i.e. We often have a single listener on Ti.UI.Window#close() where we want to clean up after the windows is closed. Compare:
<code><pre>
win.addEventListener('close', function listener (e) {
  win.removeEventListener('close', listener); // clean up this callback listener
  // do whatever other cleanup we want
});
win.close();

// versus

window.close(e =&gt; {
  // do whatever other cleanup we want
});
</pre></code>

It would be good to review our APIs and the events we fire and see if they are explicitly tied to methods called by the developer - and if so, provide optional callback functions as the final arguments so that developers could use a more Node.JS style usage and streamline cases where you only expect a single listener/callback (though for backwards compatibility and for supporting multiple listeners we shoulder retain the event firing as well).

Note that this would also position us well to add "shims" to convert these methods calls into Promise-based APIs at the JS level.
<code><pre>
win.close().then(e =&gt; {
  // do whatever other cleanup we want
});
// or...
const closeEvent = await win.close();
// do whatever other cleanup we want
</pre></code>

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2020-01-08

   Potential targets:
   - <code>Ti.UI.Window#close()</code>
   - <code>Ti.UI.Window#open()</code>
   - <code>Ti.UI.View#hide()</code>
   - <code>Ti.UI.View#show()</code>
   - <code>Ti.UI.View</code> subclasses with <code>blur()</code> and <code>focus()</code> methods (i.e. TextField, SearchBar, TextArea)
   - <code>Ti.UI.RefreshControl#beginRefreshing()</code>
   - <code>Ti.UI.RefreshControl#endRefreshing()</code>
   - <code>Titanium.UI.ImageView#pause()</code>
   - <code>Titanium.UI.ImageView#resume()</code>
   - <code>Titanium.UI.ImageView#start()</code>
   - <code>Titanium.UI.ImageView#stop()</code>
   
   Note that <code>Ti.UI.View#animate()</code> already supports an optional callback for this exact same use-case/style.
   
   Also note that in all these cases, these methods are already operating asynchronously so behavior isn't changing/breaking (form sync to async). They simply were typically firing off events when the operation finished.</li>
<li>Christopher Williams 2020-01-08

   Faintly related to TIMOB-25536 - Basically I think Gary's ti.es6 project could potentially be another means of doing the callback -> Promise API wrapping, since I think he's sort of baked that in to the shim generation? cc [~gmathews]</li>
<li>Christopher Williams 2020-02-12

   Another potential method: <code>Ti.App.iOS.registerUserNotificationSettings</code> - users have to register an event listener 'usernotificationsettings' to handle the success/failure of this method call async. This feels ripe for a callback/Promise.</li>
<li>Gary Mathews 2021-05-12

   Linking to a list of potential methods of interest <a href="https://github.com/appcelerator/titanium_mobile/pull/10554#issuecomment-737611822" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10554#issuecomment-737611822</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-27710.json">JSON Source</a></p>