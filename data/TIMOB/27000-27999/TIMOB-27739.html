---
title: "[TIMOB-27739] Android: Location permissions not auto-added when using Ti.Geolocation API as of 9.0.0"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-01-30T23:58:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, build, geolocation, location, permission, regression</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-01-25T05:05:12.000+0000</td></tr>
<tr><th>Updated</th><td>2020-01-30T23:58:21.000+0000</td></tr>
</table>

<h3>Description</h3>

_This issue was caught before release._

*Summary:*
When doing a "device" or "production" build, Titanium's build system is supposed to auto-add the below permissions to the "AndroidManifest.xml" when the app uses the <code>Ti.Geolocation</code> APIs.
* <code>android.permission.ACCESS_COARSE_LOCATION</code>
* <code>android.permission.ACCESS_FINE_LOCATION</code>

This has stopped working as of Titanium 9.0.0 (before release).

*Steps to reproduce:*
<h4>Set up a Classic app with the below code.</h4>
<h4>Build and run on an Android device. (Not an emulator.)</h4>
<h4>Notice app reports error:  <code>Failed to acquire location permission</code></h4>

app.js
<code><pre>
function monitorLocation() {
	function start() {
		Ti.Geolocation.addEventListener("location", function(e) {
			label.text = JSON.stringify(e, null, 4);
			Ti.API.info("@@@ location received: " + JSON.stringify(e));
		});
	}
	var hasPermission = Ti.Geolocation.hasLocationPermissions(Ti.Geolocation.AUTHORIZATION_WHEN_IN_USE);
	if (!hasPermission) {
		Ti.Geolocation.requestLocationPermissions(Ti.Geolocation.AUTHORIZATION_WHEN_IN_USE, function(e) {
			Ti.API.info("@@@ permission result: " + JSON.stringify(e));
			if (e.success) {
				start();
			} else {
				label.text = "\nFailed to acquire location permission from end-user.";
			}
		});
	} else {
		start();
	}
}
var window = Ti.UI.createWindow();
var scrollView = Ti.UI.createScrollView({
	layout: "vertical",
	scrollType: "vertical",
	width: Ti.UI.FILL,
	height: Ti.UI.FILL,
});
var label = Ti.UI.createLabel({
	text: "\nWaiting for GPS data...",
	top: (Ti.App.iOS ? "25dp" : "5dp"),
	height: Ti.UI.SIZE,
	left: "5dp",
	right: "5dp",
	bottom: "5dp",
});
scrollView.add(label);
window.add(scrollView);
window.addEventListener("open", function(e) {
	monitorLocation();
});
window.open();
</pre></code>



<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-01-25

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11450" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11450</a></li>
<li>Satyam Sekhri 2020-01-27

   FR Passed.
   Waiting for Jenkins.</li>
<li>Christopher Williams 2020-01-30

   merged to master for 9.0.0</li>
<li>Satyam Sekhri 2020-01-30

   Verified on:
   Mac OS: 10.15.1
   SDK: 9.0.0.v20200130113429
   Appc CLI: 7.1.2
   JDK: 11.0.4
   Node: 10.16.3
   Studio: 6.0.0.201911251516
   Device: Pixel3(v9.0) device, Pixel3(v10.0) emulator</li>
</ol>


<p><a href="/TIMOB/TIMOB-27739.json">JSON Source</a></p>