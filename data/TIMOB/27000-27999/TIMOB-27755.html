---
title: "[TIMOB-27755] Android: Add NDK side-by-side support"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-04-15T18:03:17.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.0.1</td></tr>
<tr><th>Components</th><td>Android, CLI</td></tr>
<tr><th>Labels</th><td>android, build, ndk, sdk</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-02-08T04:45:57.000+0000</td></tr>
<tr><th>Updated</th><td>2020-04-15T18:03:17.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
As of 2019, Google introduced a new NDK "side-by-side" feature which allows you to install multiple NDK versions under the Android SDK directory. All new NDK versions are downloaded to the side-by-side directory and it replaces the old "ndk-bundle" directory.

*Example:*
The folder structure appear as follows on macOS...
<code>~/Library/Android/sdk/ndk/19.2.5345600</code>
<code>~/Library/Android/sdk/ndk/20.1.5948922</code>
<code>~/Library/Android/sdk/ndk/21.0.5935234</code>
<code>~/Library/Android/sdk/ndk/21.0.6113669</code>

There will be an "ndk" directory under the "Android/sdk" directory. Each subdirectory under "ndk" will be the version number of the installed NDK.

*Old Behavior:*
Before the NDK side-by-side feature existed, Android Studio used to install the NDK under the Android SDK directory as shown below. Updating the NDK version used to replace the old version. Android Studio no longer installs to this directory.
<code>~/Library/Android/sdk/ndk-bundle</code>

*To be done:*
The CLI should search for the installed NDK directory in the following order.
<h4>The "ANDROID_NDK" environment variable, if set.</h4>
<h4>The newest NDK side-by-side version subdirectory, if available.</h4>
<h4>The "ndk-bundle" directory.</h4>

We will need to update the code here...
<a href="https://github.com/appcelerator/node-titanium-sdk/blob/master/lib/android.js" rel="nofollow" target="_blank">https://github.com/appcelerator/node-titanium-sdk/blob/master/lib/android.js</a>

*Note:*
This is important for macOS Catalina. Google does not currently digitally sign the NDK tools. So, downloading/installing the NDK zip from Google's website will cause macOS Catalina to request the end-user's permission to execute the NDK tools. However, if you download the NDK via Android Studio (which is digitally signed), the installed NDK will inherit its permissions and you will not have this issue.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-02-22

   PR: <a href="https://github.com/appcelerator/node-titanium-sdk/pull/143" rel="nofollow" target="_blank">https://github.com/appcelerator/node-titanium-sdk/pull/143</a>
   PR: <a href="https://github.com/appcelerator/node-titanium-sdk/pull/186" rel="nofollow" target="_blank">https://github.com/appcelerator/node-titanium-sdk/pull/186</a></li>
<li>Joshua Quick 2020-04-09

   In our current <code>9_0_X</code> branch, after the <code>9.0.0.GA</code> release, app builds will fail if you do the following.
   <h4>Uninstall NDK if currently installed.</h4>
   <h4>Open Android Studio's preferences window.</h4>
   <h4>Go to: Appearances & Behavior -> System Settings -> Android SDK</h4>
   <h4>Click on the "SDK Tools" tab.</h4>
   <h4>Check the "NDK (Side by side)" option.</h4>
   <h4>Click the OK button.</h4>
   <h4>Attempt to build a Titanium app.</h4>
   
   <code><pre>
   [ERROR] [GRADLE] FAILURE: Build failed with an exception.
   [ERROR] [GRADLE] 
   [ERROR] [GRADLE] * What went wrong:
   [ERROR] [GRADLE] Execution failed for task ':app:stripDebugDebugSymbols'.
   [ERROR] [GRADLE] &gt; No version of NDK matched the requested version 20.0.5594570. Versions available locally: 20.1.5948944, 21.0.5935234
   </pre></code>
   
   This ticket solves this issue because Titanium will correctly find the Android Studio installed NDK and provide it to the app build.
   
   *Notes:*
   - The app will build successfully if you do not have the NDK installed. You will get a warning about the NDK being missing instead.
   - Google requires the NDK because the app includes C/C++ libraries and wants to strip debug symbols from them. This is something they changed as of Android gradle tool v3.5.0.
   </li>
<li>Joshua Quick 2020-04-13

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11627" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11627</a>
   PR (9.0.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/11626" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11626</a></li>
<li>Satyam Sekhri 2020-04-14

   FR Passed.
   Waiting for Jenkins build on master.</li>
<li>Lokesh Choudhary 2020-04-14

   PR's Merged.</li>
<li>Satyam Sekhri 2020-04-15

   Verified on:
   Mac OS: 10.15.4
   SDK: 9.0.1.v20200415071927, 9.1.0.v20200415075143
   Appc CLI: 8.0.0
   JDK: 11.0.4
   Node: 10.17.0
   Studio: 6.0.0.202003181504
   Device: Pixel3(v10.0) emulator,</li>
</ol>


<p><a href="/TIMOB/TIMOB-27755.json">JSON Source</a></p>