---
title: "[TIMOB-27779] Android: Setting "labels" via TabbedBar "click" event hangs app"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-08-11T15:04:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 8.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, hang, tabbedbar</td></tr>
<tr><th>Reporter</th><td>Tony Lau</td></tr>
<tr><th>Assignee</th><td>Riduanul Islam</td></tr>
<tr><th>Created</th><td>2019-12-10T06:32:33.000+0000</td></tr>
<tr><th>Updated</th><td>2020-08-11T15:04:56.000+0000</td></tr>
</table>

<h3>Description</h3>

*Steps to reproduce:*
<h4>Build and run the below code on Android.</h4>
<h4>Tap on one of the tabs.</h4>
<h4>Notice that the app hangs.</h4>

<code><pre>
var window = Ti.UI.createWindow();
var tabbedBar = Ti.UI.createTabbedBar();
tabbedBar.labels = ["One", "Two", "Three"];
tabbedBar.addEventListener("click", function() {
	console.log(new Date() + " tbrSortTLby Click event triggerred");
	tabbedBar.labels = ['Three', 'Four', 'Five'];
});
window.add(tabbedBar);
window.open();
</pre></code>

*Cause:*
Setting the "labels" property causes the "click" event to be fired. So, setting "labels" within a "click" event listener will cause infinite recursion to occur which will eventually cause a crash.

*Work-Around:*
Defer setting the "labels" property via <code>setTimeout()</code> within the "click" listener.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27779_67192/AndroidSandBox.zip">AndroidSandBox.zip</td></td><td>2019-12-28T09:22:31.000+0000</td><td>8669614</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27779_67191/AndroidTabbedBarTrace.log">AndroidTabbedBarTrace.log</td></td><td>2019-12-28T09:20:52.000+0000</td><td>334019</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27779_67189/Trace log pic.png">Trace log pic.png</td></td><td>2019-12-24T15:39:48.000+0000</td><td>45075</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Riduanul Islam 2019-12-20

   Hi, 
   I've tested this issue in 3 different pattern but failed to reproduce this. 
   Can you try this below code and help us to reproduce this: 
   <code><pre>
   var window = Ti.UI.createWindow();
   var tabbedBar = Ti.UI.createTabbedBar();
   tabbedBar.labels = ["One", "Two", "Three"];
   window.add(tabbedBar);
   window.open();
   </pre></code>
   If you have another reproducible steps, let us know the full steps with code, also provide us the full log from command line.
   My Testing environments are following:
   <code><pre>
   Operating System
     Name                        = Mac OS X
     Version                     = 10.14.6
     Architecture                = 64bit
     # CPUs                      = 4
     Memory                      = 8589934592
   
   Node.js
     Node.js Version             = 8.9.4
     npm Version                 = 6.5.0
   
   Titanium CLI
     CLI Version                 = 5.2.2
   
   Titanium SDK
     SDK Version                 = 8.3.0.GA
   Device: Samsung Galaxy J7, android version-8.1.0
   Targeting Android SDK API: 29
   </pre></code></li>
<li>Tony Lau 2019-12-23

   The crash occur after the Window is opened with the tabbed bar displayed, and then try to change the labels in code.
   
   tabbedBar.labels = ["Four", "Five", "Six"];
   
   </li>
<li>Riduanul Islam 2019-12-24

   Hi Tony Lau, 
   Can you share complete trace log with us? 
   
   See this image below for details information: 
   !Trace log pic.png|thumbnail! 
   
   Thanks.</li>
<li>Tony Lau 2019-12-28

   I created a new project AndroidSandBox and able to reproduce the repeat "click" issue.
   
   index.html
   <Alloy>
   	<Window class="container" backgroundColor="blue">
   			<View id='sortlistbar'>
   				<TabbedBar id='tbrSortTLby' onClick='tbrSortTLbyClicked'>
   					<Labels>
   						<Label>One</Label>
   						<Label>Two</Label>
   						<Label>Three</Label>
   					</Labels>
   				</TabbedBar>	
   			</View>	
   	</Window>
   </Alloy>
   
   
   index.js
   function tbrSortTLbyClicked() {
   	Ti.API.debug(new Date() + " tbrSortTLby Click event triggerred");
   	$.tbrSortTLby.labels = ['Three','Four','Five'];
   
   };
   $.index.open();
   
   index.tss
   ".container": {
   	backgroundColor:"white"
   }
   
   "Label": {
   	width: Ti.UI.SIZE,
   	height: Ti.UI.SIZE,
   	color: "#000"
   }
   
   "#label": {
   	font: {
   		fontSize: 12
   	}
   }
   
   '#sortlistbar': {
   	top: '10%',
   	bottom: '0%',
   	height: '6%',
   	width: '98%',
   }
   
   '#tbrSortTLby': {
   	left: 0,
   	width: '85%',
   	font: {
   		fontSize: '18dip'
   	},
   	height:Ti.UI.FILL,
   	right: '5%'
   }
   
   
   </li>
<li>Tony Lau 2019-12-28

   Click on any of the labels. e.g "One", the labels cahnged to "Four", "Five" and "Six" as expected but the trace log showed the click event is continuously triggered. Detail trace log and project code attached.
   
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 6 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   zygote: Do partial code cache collection, code=29KB, data=22KB
   [INFO] :   zygote: After code cache collection, code=29KB, data=22KB
   [INFO] :   zygote: Increasing code cache capacity to 128KB
   
   
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 1 line
   [DEBUG] :  Sat Dec 28 2019 01:01:19 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:20 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 7 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:20 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:20 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 6 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:20 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   zygote: Do partial code cache collection, code=61KB, data=42KB
   [INFO] :   zygote: After code cache collection, code=61KB, data=42KB
   [INFO] :   zygote: Increasing code cache capacity to 256KB
   [DEBUG] :  Sat Dec 28 2019 01:01:20 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 35 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:20 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:21 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 26 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:21 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:21 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:21 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 25 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:21 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:22 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [INFO] :   chatty: uid=10088(u0_a88) com.mysandbox.android identical 43 lines
   [DEBUG] :  Sat Dec 28 2019 01:01:22 GMT-0800 (PST) tbrSortTLby Click event triggerred
   [DEBUG] :  Sat Dec 28 2019 01:01:22 GMT-0800 (PST) tbrSortTLby Click event triggerred
   
    </li>
<li>Tony Lau 2020-02-17

   Need more info? Hope this can be fixed in SDK 9</li>
<li>Michael Gangolf 2020-02-23

   Since you are setting new labels inside the click event I think it will trigger the event again because it is selecting the first new value. Chaging it to this:
   <code><pre>
   var changed = false;
   
   function tbrSortTLbyClicked() {
   	if (!changed) {
   		$.tbrSortTLby.removeEventListener("click", tbrSortTLbyClicked);
   		console.log(new Date() + " tbrSortTLby Click event triggerred");
   		$.tbrSortTLby.labels = ['Three', 'Four', 'Five'];
   		$.tbrSortTLby.addEventListener("click", tbrSortTLbyClicked);
   		changed = true;
   	} else {
   
   	}
   }
   
   
   $.index.open();
   </pre></code>
   
   will remove the event listener, change the labels and add it again. No loop. Also added a "changed" variable so you will be able to select one of the new values inside the new labels.
   
   When the bar is created it will first set the values and then attach the select-listener:
   <a href="https://github.com/appcelerator/titanium_mobile/blob/0558c28b54dfb195d7a5c22851060e416e9811f8/android/modules/ui/src/java/ti/modules/titanium/ui/widget/TiUITabbedBar.java#L86-L87" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/0558c28b54dfb195d7a5c22851060e416e9811f8/android/modules/ui/src/java/ti/modules/titanium/ui/widget/TiUITabbedBar.java#L86-L87</a>
   when you change the values now the listener is catching the select event and that will trigger the click:
   <a href="https://github.com/appcelerator/titanium_mobile/blob/0558c28b54dfb195d7a5c22851060e416e9811f8/android/modules/ui/src/java/ti/modules/titanium/ui/widget/TiUITabbedBar.java#L325-L345" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/0558c28b54dfb195d7a5c22851060e416e9811f8/android/modules/ui/src/java/ti/modules/titanium/ui/widget/TiUITabbedBar.java#L325-L345</a>
   
   So you have to remove the click event before changing the value or you could do that inside the SDK when setting new labels.</li>
<li>Michael Gangolf 2020-02-23

   PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/11495" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11495</a>
   
   classic test code:
   <code><pre>
   var window = Ti.UI.createWindow();
   var tabbedBar = Ti.UI.createTabbedBar();
   tabbedBar.labels = ["One", "Two", "Three"];
   tabbedBar.addEventListener("click", function() {
   	console.log(new Date() + " tbrSortTLby Click event triggerred");
   	tabbedBar.labels = ['Three', 'Four', 'Five'];
   })
   window.add(tabbedBar);
   window.open();
   </pre></code></li>
<li>Samir Mohammed 2020-03-27

   FR passed, waiting on Jenkins build.</li>
<li>Samir Mohammed 2020-07-22

    Looks like this will need a back port for 9_1_X now. </li>
<li>Joshua Quick 2020-07-22

    PR (9.1.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/11838" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11838</a></li>
<li>Christopher Williams 2020-07-23

    merged PRs to master and 9_1_X. Manually cherry-picked to 9_3_X</li>
<li>Samir Mohammed 2020-08-11

    *Closing ticket*. Bug Fixed in SDK version <code>9.1.0.v20200810120239</code>, <code>9.2.0.v20200810085310</code> and <code>9.3.0.v20200810090511</code>.
    
    *Test and other information can be found at:*
    <a href="https://github.com/appcelerator/titanium_mobile/pull/11495" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11495</a>
    <a href="https://github.com/appcelerator/titanium_mobile/pull/11838" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11838</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-27779.json">JSON Source</a></p>