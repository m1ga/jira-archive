---
title: "[TIMOB-27807] Android: convertPointToView() returns pixels instead of default units"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.0.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>2020-Q4, android, breaking-change, drag, parity, touch, unit</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-03-12T01:49:55.000+0000</td></tr>
<tr><th>Updated</th><td>2020-12-11T13:04:38.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
Titanium's <code>View.convertPointToView()</code> method is hardcoded to return pixels on Android. The returned coordinates should be using the "ti.ui.defaultunit" assigned to the "tiapp.xml" instead, which defaults to "dp".

iOS returns "dp", not pixels. So, this is a parity issue.

*Steps to reproduce:*
<h4>Build and run the below on Android.</h4>
<h4>Attempt to drag one of the squares onscreen.</h4>
<h4>Notice the square disappears.</h4>
<h4>Uncomment the <code>Ti.Android</code> code block below. _(Converts pixels to dp.)_</h4>
<h4>Rebuild for Android.</h4>
<h4>Notice that dragging a square now works.</h4>
<h4>Build and run on iOS.</h4>
<h4>Notice that dragging a square now works.</h4>

<code><pre>
function createDragSquare(top, left, color) {
	var view = Ti.UI.createView({
		touchEnabled: true,
		backgroundColor: color,
		center: { x: left + 50, y: top + 50 },
		width: 100,
		height: 100,
	});
	view.addEventListener("touchmove", function(event) {
		var parentPoint = view.convertPointToView({ x: event.x, y: event.y }, window);
//		if (Ti.Android) {
//			parentPoint.x = Ti.UI.convertUnits(parentPoint.x + "px", "dip");
//			parentPoint.y = Ti.UI.convertUnits(parentPoint.y + "px", "dip");
//		}
		Ti.API.info("@@@ touch point: (" + parentPoint.x + ", " + parentPoint.y + ")");
		view.center = parentPoint;
		event.cancelBubble = true;
	});
	return view;
}

var window = Ti.UI.createWindow({ backgroundColor: "white" });
window.add(createDragSquare(40, 40, "red"));
window.add(createDragSquare(120, 120, "green"));
window.add(createDragSquare(200, 200, "blue"));
window.open();
</pre></code>

*Work-Around:*
Convert the <code>convertPointToView()</code> method's returned results from pixels to dp only on Android as shown below.
<code><pre>
var parentPoint = view.convertPointToView({ x: event.x, y: event.y }, window);
if (Ti.Android) {
	parentPoint.x = Ti.UI.convertUnits(parentPoint.x + "px", "dip");
	parentPoint.y = Ti.UI.convertUnits(parentPoint.y + "px", "dip");
}
</pre></code>


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-12-05

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/12320" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12320</a></li>
<li>Samir Mohammed 2020-12-11

   FR Passed, waiting on Jenkins build.</li>
</ol>


<p><a href="/TIMOB/TIMOB-27807.json">JSON Source</a></p>