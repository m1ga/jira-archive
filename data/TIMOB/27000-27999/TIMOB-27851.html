---
title: "[TIMOB-27851] iOS: Ti.Network.createHTTPClient memory leak"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-05-05T21:09:58.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.0.2</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Joe Finnigan</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2020-04-16T11:40:50.000+0000</td></tr>
<tr><th>Updated</th><td>2020-05-05T21:09:59.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>
HTTPClient is leaking memory causing an eventual crash, appears to have only been introduced in 9.0.0.GA, could be regression on this issue: TIMOB-26811

<h4>How to reproduce</h4>
This sample will fire 20 url fetches every 1 second, it clearly shows the memory leak in xcode instruments. Do not run for long too long...

Index.js
<code><pre>
var triggerLoop = function() {
  _.times(20, fetchUrl);
};

function fetchUrl() {
      var client = Ti.Network.createHTTPClient({
        onload: function(e) {
            client = null;
        },
        onerror: function(e) {
          client = null;
        },
        timeout: 1000
      });
      client.open(
        "GET",
        "<a href="https://example.com/" rel="nofollow" target="_blank">https://example.com/</a>"
      );
      client.send();
      console.log("Fetching Url");
}

setInterval(triggerLoop,1000);
</pre></code>

If you monitor with xcode leaks profiler, you will see a large amount of leaks from CFNetwork, I have attached the screenshots of profiling tool results.




<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27851_67337/Screenshot 2020-04-16 at 12.19.54.png">Screenshot 2020-04-16 at 12.19.54.png</td></td><td>2020-04-16T11:38:44.000+0000</td><td>57597</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-27851_67336/Screenshot 2020-04-16 at 12.20.01.png">Screenshot 2020-04-16 at 12.20.01.png</td></td><td>2020-04-16T11:38:45.000+0000</td><td>316150</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Satyam Sekhri 2020-04-16

   I could reproduce the leak as mentioned in the details using the test code provided.
   However the issue doesn't seems to be a regression in 9.0.0.GA. Using the same test app similar leaks at a similar rate were observed in older SDK builds as well. Tried with titanium SDK build 9.0.0.GA, 8.3.1.GA, 8.3.0.GA and 8.0.0.GA
   
   Verified on:
   Mac OS: 10.15.4
   Appc CLI: 8.0.0, 7.1.2
   Node: 10.16.3
   Studio: 6.0.0.202003181504
   Xcode: 11.4, 11.2.1
   iOS Device: iPhone 7(v12.4.5)</li>
<li>Joe Finnigan 2020-04-17

   The app that I discovered this in was previously using Ti SDK 8.0.1.v20190326110553 and didn't exhibit the leak, granted not running this exact test code but its very close.</li>
<li>Vijay Singh 2020-04-20

   PR (master) - <a href="https://github.com/appcelerator/titanium_mobile/pull/11649" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11649</a>
   PR (9_0_X) - <a href="https://github.com/appcelerator/titanium_mobile/pull/11650" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11650</a>
   PR (app_sdk) - <a href="https://github.com/appcelerator/aps_sdk/pull/343" rel="nofollow" target="_blank">https://github.com/appcelerator/aps_sdk/pull/343</a></li>
<li>Hans Kn√∂chel 2020-04-24

   Can you please provide a bit of insight on which version caused the regression? It's important for knowing if we're affected or not. Thank you!</li>
<li>Satyam Sekhri 2020-04-28

   [~hknoechel] I tried as far back as 7.5.0.GA and could reproduce the leaks related to CFNetwork on 7.5.0.GA as well using the test code in the ticket. Hope this helps.</li>
<li>Satyam Sekhri 2020-04-28

   FR Passed</li>
<li>Satyam Sekhri 2020-05-05

   No CFNetwork leaks seen.
   
   Verified on:
   Mac OS: 10.15.4
   SDK: 9.1.0.v20200505112143, 9.0.2.v20200505111803
   Appc CLI: 8.0.0
   Node: 10.16.3
   Studio: 6.0.0.202003181504
   Xcode: 11.4
   iOS Device: iPhone 7(v12.4.5), iPhone X(v13.4), iOS simulator 13.4</li>
</ol>


<p><a href="/TIMOB/TIMOB-27851.json">JSON Source</a></p>