---
title: "[TIMOB-27864] iOS: Support for new iOS 13 background tasks"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>2020-Q4</td></tr>
<tr><th>Reporter</th><td>Jan Vennemann</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2020-04-24T18:20:56.000+0000</td></tr>
<tr><th>Updated</th><td>2021-08-20T14:35:10.000+0000</td></tr>
</table>

<h3>Description</h3>

With iOS 13 a new framework for handling background tasks was added: [BackgroundTasks](<a href="https://developer.apple.com/documentation/backgroundtasks)" rel="nofollow" target="_blank">https://developer.apple.com/documentation/backgroundtasks)</a>

We should add support for this new framework.

* Can be used to periodically launch the app in the background and do some work
* Two types of tasks are available: A short refresh task and processing task that can take minutes to complete.

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2020-06-19

   Initial WIP PR: <a href="https://github.com/appcelerator/titanium_mobile/pull/11689" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11689</a></li>
<li>Vijay Singh 2021-01-23

   PR  - <a href="https://github.com/appcelerator/titanium_mobile/pull/12411" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12411</a></li>
<li>Hans Kn√∂chel 2021-01-23

   Thank you for covering this! Question: What's the difference of this API compared to the existing API? It would be great to have some docs around it. Also two questions:
   
   1. Can this be triggered from silent push notifications?
   2. What are the limits regarding network requests?
   
   An example would help a lot here. It's a superb feature!</li>
<li>Vijay Singh 2021-01-26

   Test Case - 
   
   <code><pre>
   const win = Ti.UI.createWindow({
       backgroundColor: '#fff'
   });
   
   const label = Ti.UI.createLabel({
       text: 'Background task',
   });
   
   win.add(label);
   win.open();
   
   Ti.App.iOS.registerBackgroundTask({
   	'identifier': 'com.test.bgrefresh',
   	'type': Ti.App.iOS.BACKGROUND_TASK_TYPE_REFRESH,
   });
   
   Ti.App.iOS.registerBackgroundTask({
   	'identifier': 'com.test.bgprocessing',
   	'type': Ti.App.iOS.BACKGROUND_TASK_TYPE_PROCESS,
   	'powerConnect': true,
   	'networkConnect': true
   });
   
   Ti.App.iOS.addEventListener('backgroundfetch', function(e) {
       Ti.API.info('backgroundfetch: ' + JSON.stringify(e));
   
       label.text = 'backgroundfetch';
   
       Ti.App.iOS.endBackgroundHandler(e.handlerId);
   });
   
   Ti.App.iOS.addEventListener('backgroundprocess', function(e) {
       Ti.API.info('backgroundprocess: ' + JSON.stringify(e));
   
       label.text = 'backgroundprocess';
    
       Ti.App.iOS.endBackgroundHandler(e.handlerId);
   });
   </pre></code>
   
   How to test -
   One can not test it simply as we are not sure when system will invoke the app from background.
   1.  Create a sample app with given test case and add  keys <code>BGTaskSchedulerPermittedIdentifiers</code> and <code>UIBackgroundModes </code> with relevant values in tiapp.xml.
   2. Run it on device (not simulator).
   3. Open the generated Xcode project (.xcodeproj) in Xcode from build/iPhone folder.
   4. Select the target, select Build Phases->  click on ' +' and select 'New Run Script Phase'.
   5. Paste following script in Run Script.
   <code><pre>
   cp ${SRCROOT}/build/Products/Debug-iphoneos/${CONTENTS_FOLDER_PATH}/_index_.json ${BUILT_PRODUCTS_DIR}/${CONTENTS_FOLDER_PATH}/_index_.json
   </pre></code>
   6. Now run the app in device using Xcode.
   7. Bring the app in background and then bring it to foreground. Then in Xcode press pause button in debugger.
   8. Paste 
   <code><pre>
   e -l objc -- (void)[[BGTaskScheduler sharedScheduler] _simulateLaunchForTaskWithIdentifier:@"com.test.bgrefresh"]
   </pre></code>
   and enter. It should change the label text.
   
   Note -  For step 7 & 8 you can follow Testing section of  [this](<a href="https://www.andyibanez.com/posts/modern-background-tasks-ios13/)" rel="nofollow" target="_blank">https://www.andyibanez.com/posts/modern-background-tasks-ios13/)</a>
   </li>
<li>Ewan Harris 2021-08-20

   We're removing this ticket from 10.1.0 due to the large scope and uncertainty given multiple PRs</li>
</ol>


<p><a href="/TIMOB/TIMOB-27864.json">JSON Source</a></p>