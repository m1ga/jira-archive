---
title: "[TIMOB-27866] CLI: ti clean with a forked SDK and --project-dir option exits with GracefulShutdown error"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2021-02-11T12:09:53.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.0.0</td></tr>
<tr><th>Fix Version/s</th><td>titanium 5.3.0</td></tr>
<tr><th>Components</th><td>CLI</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Ewan Harris</td></tr>
<tr><th>Created</th><td>2020-04-27T17:16:28.000+0000</td></tr>
<tr><th>Updated</th><td>2021-02-11T12:10:00.000+0000</td></tr>
</table>

<h3>Description</h3>

*I'm still trying to figure this one out, but I think the title is the main bits at play*

<h4>Description</h4>

When calling clean like so <code>ti clean --project-dir <path></code> and the tiapp SDK version and selected SDK version do not match I'm seeing the CLI log an uncaughtError exception that appears to be due to the <code>throw new cli.GracefulShutdown();</code> (I believe).

My current theories are as follows (update: both of these are wrong) :

* Some form of dependency update causing the <code>instanceof</code> check [here](<a href="https://github.com/appcelerator/titanium/blob/6a41ba410e51a7a3388e4d71c76508d89cac9836/lib/cli.js#L513)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium/blob/6a41ba410e51a7a3388e4d71c76508d89cac9836/lib/cli.js#L513)</a> to fail because of how JS works with that kinda thing
* Possibly the async.js upgrade borking? Maybe it changed how throw works?

<h4>Steps to reproduce</h4>

1. Change your selected SDK (ti sdk select) and your tiapp SDK
2. Run <code>ti clean --project-dir <path></code>

<h4>Actual</h4>

CLI errors after attempting to fork

<h4>Expected</h4>

Fork should occur successfully and CLI should not error out

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2020-04-27

   logs
   
   <code><pre>
   $titanium clean --project-dir /Users/awam/git/testing_apps/kitchensink-v2
    [INFO]   tiapp.xml <sdk-version> set to  8.3.0.GA , but current Titanium SDK set to  8.3.2
    [INFO]   Forking correct SDK command:  "/Users/awam/.nvm/versions/node/v12.16.2/bin/node" "/Users/awam/git/titanium/bin/titanium" "clean" "--sdk" "8.3.0.GA" "--project-dir" "/Users/awam/git/testing_apps/kitchensink-v2"
   
    [LiveView]  [GracefulShutdown [Error]]
    [DEBUG]  Detecting plugins in  /Users/awam/git/testing_apps/kitchensink-v2/plugins
    [DEBUG]  Detected plugin:  ti.alloy  @  /Users/awam/git/testing_apps/kitchensink-v2/plugins/ti.alloy
    [DEBUG]  Looking for Titanium plugin id= ti.alloy  version= 1.0
    [INFO]   Found Titanium plugin id= ti.alloy  version= 1.0
    [DEBUG]  Deleting all platform build directories
   [DEBUG] Resources directory of /Users/awam/git/testing_apps/kitchensink-v2/app has been emptied
   [INFO]  Project cleaned successfully in 45ms
   </pre></code></li>
<li>Ewan Harris 2020-04-29

   This one was bugging me today so I took a look. I believe it's due to TIMOB-23247 (forking in ti clean never existed before this) and needs to be fixed by copying the <code>build.config</code> hook in tisdk3fixes in titanium to a <code>clean.config</code> hook</li>
<li>Ewan Harris 2020-10-19

   PR: <a href="https://github.com/appcelerator/titanium/pull/402" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium/pull/402</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-27866.json">JSON Source</a></p>