---
title: "[TIMOB-27887] Android: Support WebAssembly in V8"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-20T16:15:13.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2020-05-07T15:43:56.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-20T16:15:13.000+0000</td></tr>
</table>

<h3>Description</h3>

I tried to use protobufjs npm package, and found on a simulator session that it crashed when trying to load WebAssembly baked into the long.js code here:
<a href="https://github.com/dcodeIO/long.js/blob/master/src/long.js#L16" rel="nofollow" target="_blank">https://github.com/dcodeIO/long.js/blob/master/src/long.js#L16</a>

Here's the output:
<code><pre>
[ERROR] v8:
[ERROR] v8:
[ERROR] v8: #
[ERROR] v8: # Fatal error in , line 0
[ERROR] v8: #
[ERROR] v8: WebAssembly is not supported in no-embed builds. no-embed builds are deprecated. See
[ERROR] v8:  - <a href="https://groups.google.com/d/msg/v8-users/9F53xqBjpkI/9WmKSbcWBAAJ" rel="nofollow" target="_blank">https://groups.google.com/d/msg/v8-users/9F53xqBjpkI/9WmKSbcWBAAJ</a>
[ERROR] v8:  - <a href="https://crbug.com/v8/8519" rel="nofollow" target="_blank">https://crbug.com/v8/8519</a>
[ERROR] v8:  - <a href="https://crbug.com/v8/8531" rel="nofollow" target="_blank">https://crbug.com/v8/8531</a>
[ERROR] v8:
[ERROR] v8: #
[ERROR] v8: #
[ERROR] v8: #
[ERROR] v8: #FailureMessage Object: 0xffd4aea0
[INFO]  v8: # 00xc6501835
[INFO]  v8: # 10xc64f856a
[INFO]  v8: # 20xc6a805fa
[INFO]  v8: # 30xc6a82ec1
[INFO]  v8: # 40xc6a8abd3
[INFO]  v8: # 50xc6a8ab3b
[INFO]  v8: # 60xc6a5e7ba
[INFO]  v8: # 70xc6a8853b
[INFO]  v8: # 80xc6ab0bb6
[INFO]  v8: # 90xc65819cf
[INFO]  v8: #100xc6580b8c
[INFO]  v8: #110xc6580500
[INFO]  v8: #120xc6580221
[INFO]  v8: #130xc5e02add
[INFO]  v8:
</pre></code>

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2020-05-07

   I should note that even if we can't support WebAssembly, we should not crash, but throw an Error so that the fallback code could run.</li>
<li>Joshua Quick 2020-05-20

   [~gmathews], I think the solution is to build V8 with the following command line argument...
   <code><pre>
   v8_enable_embedded_builtins=true
   </pre></code>
   
   ...in our shell script below. This script currently sets this argument to <code>false</code>.
   <a href="https://github.com/appcelerator/v8_titanium/blob/master/build_v8.sh" rel="nofollow" target="_blank">https://github.com/appcelerator/v8_titanium/blob/master/build_v8.sh</a>
   
   This is based on the info I've read here...
   <a href="https://groups.google.com/forum/#" rel="nofollow" target="_blank">https://groups.google.com/forum/#</a>!msg/v8-users/9F53xqBjpkI/9WmKSbcWBAAJ
   </li>
<li>Gary Mathews 2020-05-27

   v8_titanium: <a href="https://github.com/appcelerator/v8_titanium/pull/52" rel="nofollow" target="_blank">https://github.com/appcelerator/v8_titanium/pull/52</a>
   v8_snapshot: <a href="https://github.com/appcelerator/v8_snapshot/commit/47a7b0ede1c548b24b8efb6aff4e562cb5f5c1a7" rel="nofollow" target="_blank">https://github.com/appcelerator/v8_snapshot/commit/47a7b0ede1c548b24b8efb6aff4e562cb5f5c1a7</a>
   titanium_mobile: <a href="https://github.com/appcelerator/titanium_mobile/pull/11736" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11736</a></li>
<li>Gary Mathews 2020-07-28

   titanium_mobile: <a href="https://github.com/appcelerator/titanium_mobile/pull/11849" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11849</a></li>
<li>Christopher Williams 2020-08-17

   merged to 9_3_X for 9.3.0 target</li>
<li>Samir Mohammed 2020-09-22

   FR Passed, Tested using the test cases from: <a href="https://github.com/appcelerator/titanium_mobile/pull/11849." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11849.</a>
   
   *Test Environment*
   <code><pre>
   MacOS Big Sur: 11.0 Beta 7
   Java Version: 1.8.0_242
   Android NDK: 21.3.6528147
   Node.js: 12.18.1
   ""NPM":"5.0.0","CLI":"8.1.1""
   Pixel Xl (10)</pre></code>
   </li>
<li>Samir Mohammed 2020-11-20

   *Closing ticket*. New Feature verified in SDK version <code>9.3.0.v20201119063936</code>.
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11849" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11849</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-27887.json">JSON Source</a></p>