---
title: "[TIMOB-27888] iOS: circular references in require don't work"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2021-01-13T16:11:56.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>engSchedule</td></tr>
<tr><th>Reporter</th><td>Christopher Williams</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2020-05-07T15:53:01.000+0000</td></tr>
<tr><th>Updated</th><td>2021-01-29T17:11:53.000+0000</td></tr>
</table>

<h3>Description</h3>

While Android's require implementation is able to handle circular references - iOS is not.

This is due to the underlying implementations - where Android is written in JS and mimics Node.js, while iOS is native. There's multiple possible solutions here:
- Use rollup under the hood on apps as part of our build process.
- Migrate iOS to use a shared require implementation with Android

I personally prefer the second, but it'd take some re-architecting of how iOS starts up - and it's unclear to me how we'd tweak Android to use a require implementation under common rather than the one baked into the the runtime (the JS is baked in as bytes and executed early).

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2021-01-13

   Merged to master (along with large refactor to help unify require implementations cross-platform). Unit tests confirm the fix.</li>
<li>Samir Mohammed 2021-01-29

   *Closing ticket*, verified in SDK version <code>10.0.0.v20210126123332</code>.
   
   *+Test case:+*
   app.js
   <code><pre>
   const b = require('./b');
   
   b.log();
   
   exports.value = 'a thing';
   
   b.log();
   
   </pre></code>
   
   b.js
   <code><pre>
   const a = require('./app.js');
   
   exports.log = function () {
    console.log(a.value);
   }
   
   </pre></code>
   
   *+Test Environment+*
   
   <code><pre>
   MacOS Big Sur: 11.1 
   Xcode: 12.3
   Java Version: 1.8.0_242
   Android NDK: 21.3.6528147
   Node.js: 12.18.1
   ""NPM":"5.0.0","CLI":"8.1.1""
   iPhone 8 14.4
   </pre></code>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-27888.json">JSON Source</a></p>