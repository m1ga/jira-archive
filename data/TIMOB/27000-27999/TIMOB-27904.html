---
title: "[TIMOB-27904] Android: Incremental build duplicates "bootstrap.json" entries as of 8.1.0"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-06-08T14:05:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 8.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.0.3</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, bootstrap, build, incremental, regression</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-05-21T20:24:46.000+0000</td></tr>
<tr><th>Updated</th><td>2020-06-08T14:05:41.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
If a project contains a JS file ending with <code>*.bootstrap.js</code>, then every Android incremental build performed will duplicate its entry within our <code>ti.internal/bootstrap.json</code> file. This causes the bootstrap JS file to be executed multiple times on startup.

This regression was introduced in Titanium 8.1.0.

*Note:*
This only negatively impacts bootstraps that have an <code>execute()</code> function such as [ti.playservices](<a href="https://github.com/appcelerator-modules/ti.playservices/blob/master/android/Resources/ti.playservices/ti.playservices.bootstrap.js)" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/ti.playservices/blob/master/android/Resources/ti.playservices/ti.playservices.bootstrap.js)</a>, because that function will end up being invoked multiple times.

*Steps to reproduce:*
<h4>Create a Titanium app project.</h4>
<h4>Copy the below <code>test.bootstrap.js</code> to the <code>Resources</code> directory.</h4>
<h4>Build and run on Android.</h4>
<h4>Notice a bootstrap dialog appears once. _(This is good.)_</h4>
<h4>Build and run on Android again.</h4>
<h4>Notice *two* bootstrap dialogs appear on startup. _(This is bad.)_</h4>
<h4>Build and run on Android again.</h4>
<h4>Notice *three* bootstrap dialogs appear on startup. _(This is bad.)_</h4>

\\
<code>./Resources/test.bootstrap.js</code>
<code><pre>
Ti.API.info("### Bootstrap was required-in.");

var wasExecuted = false;
exports.execute = function(finished) {
	Ti.API.info("### Bootstrap execute() method was called.");
	var message = "This is the bootstrap dialog.";
	if (wasExecuted) {
		message = "Uh-oh!!! Bootstrap was wrongly executed again.";
	}
	var dialog = Ti.UI.createAlertDialog({
		message: message,
		buttonNames: ['OK'],
		cancel: 0,
		persistent: true,
	});
	dialog.addEventListener('click', finished);
	dialog.addEventListener('cancel', finished);
	dialog.show();
	wasExecuted = true;
};
</pre></code>

*Cause:*
The incremental build changes made in Titanium 8.1.0 by [TIMOB-27043] moved bootstrap script finding code to our core [process-js-task.js](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/cli/lib/tasks/process-js-task.js)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/cli/lib/tasks/process-js-task.js)</a> file. The iOS <code>_build.js</code> was changed to not fetch bootstrap scripts itself anymore... but the same as not done in Android's <code>_build.js</code> which is why the entries are being duplicated.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-05-21

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11727" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11727</a></li>
<li>Satyam Sekhri 2020-05-26

   FR Passed.
   Waiting for Jenkins build</li>
<li>Joshua Quick 2020-06-02

   PR (9.0.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/11745" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11745</a></li>
<li>Ewan Harris 2020-06-08

   Verified changes in 9.0.3.v20200608051820 and 9.1.0.v20200604104832.
   
   Closing ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-27904.json">JSON Source</a></p>