---
title: "[TIMOB-27926] TiAPI: Expose a way to track unhandled promises"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2020-06-02T15:56:00.000+0000</td></tr>
<tr><th>Updated</th><td>2020-06-02T15:56:00.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

We currently expose the [uncaughtException](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.App-event-uncaughtException) event on <code>Titanium.App</code> to handle errors that get thrown but not handled. However this does not include unhandled promise rejections or errors from within async functions

As we include core-js there is a default handler for unhandled error in promises that can also be overriden by a user like below, but this means that there is no integration with something like ACA, or the error dialog.

<code><pre>
global.onunhandledrejection = e =&gt; console.log('unhandled', e.reason, e.promise);
</pre></code>

From testing also, we are not consistent across platforms. On iOS an async function will be caught by <code>onunhandledrejection</code> as it is transpiled down to promises, but on android the error will be swallowed

Below is code that throws 3 types of errors

<code><pre>
const win = Ti.UI.createWindow()
const lbl = Ti.UI.createLabel({ text: 'Callback error', top: 100 });
lbl.addEventListener('click', () =&gt; {
	console.log('throwing from callback');
	throw new Error('Callback error');
});
const lbl2 = Ti.UI.createLabel({ text: 'Promise thrown', top: 250 });
lbl2.addEventListener('click', () =&gt; {
	Promise.resolve()
		.then(() =&gt; {
			console.log('throwing from promise');
			throw new Error('Promise thrown error')
		})
});
const lbl3 = Ti.UI.createLabel({ text: 'Async thrown', top: 400 });
lbl3.addEventListener('click', async () =&gt; {
	console.log('throwing from async');
	throw new Error('Async function thrown error');
});
Ti.App.addEventListener('uncaughtException', (e) =&gt; {
	console.log('uncaughtException handler');
	console.log(e);
});
win.add(lbl);
win.add(lbl2);
win.add(lbl3);
win.open();
</pre></code>


I'm unsure on the expected result here, it might make sense for us to ensure that errors from async functions/promises are handled via the uncaughtException event

<h3>Comments</h3>

<p>No comments</p>

<p><a href="/TIMOB/TIMOB-27926.json">JSON Source</a></p>