---
title: "[TIMOB-27994] iOS: itemclick event its firing instead of a move event when ordering items in a list (iOS 13+)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>None</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-07-29T19:27:30.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.0.3</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.1.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Samir Mohammed</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2020-07-01T13:25:45.000+0000</td></tr>
<tr><th>Updated</th><td>2021-02-16T07:37:09.000+0000</td></tr>
</table>

<h3>Description</h3>

When using iOS13 or 14 the itemclick event is fired when moving items in a listView instead of a Move event listener.

*Test Case:*
<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor : 'white'
});

var data = [];
var listSections = [];
var fruitsData;
var vegData;

var plainTemplate = {
	childTemplates : [{
		type : 'Ti.UI.Label', // Use a label
		bindId : 'rowtitle', // Bind ID for this label
		properties : {// Sets the Label.left property
			left : '10dp',
			// backgroundColor : 'blue',
		}
	}, {
		type : 'Ti.UI.Label', // Use a button
		bindId : 'label', // Bind ID for this button
		properties : {// Sets several button properties
			width : '80dp',
			height : '40dp',
			right : '10dp',
			text : 'press me',
			touchEnabled : false
		}
	}],
};

function report(e) {
	Ti.API.info(e.type);
}

var listView = Ti.UI.createListView({
	templates : {
		'plain' : plainTemplate
	},
	defaultItemTemplate : 'plain',
	editing : true,
	pruneSectionsOnEdit  : true
});

var listArray = [{
	id : "1001",
	title : "Apple",
	moduleId : "Fruits"
},{
	id : "1002",
	title : "carrot",
	moduleId : "Vegetables"
}, {
	id : "1003",
	title : "Banana",
	moduleId : "Fruits"
}, {
	id : "1004",
	title : "Capsicum",
	moduleId : "Vegetables"
}, {
	id : "1005",
	title : "Brinjal",
	moduleId : "Vegetables"
}, {
	id : "1006",
	title : "Papaya",
	moduleId : "Fruits"
}, {
	id : "1007",
	title : "PineApple",
	moduleId : "Fruits"
}, {
	id : "1008",
	title : "LadiesFinger",
	moduleId : "Vegetables"
}
];

function getIndex(array, itemId){
	var actualIndex;
	array.findIndex(function(arrayObj,index){
		if(arrayObj.id.toString() === itemId.toString()){
			actualIndex = index;
		}
	});
	return actualIndex;
}

var sourceItemId;
var targetItemId;
var insertBefore = false;

listView.addEventListener('itemclick', function(e){
	alert('Item click fired::::::::');
});

listView.addEventListener('move', function(e) {
	Ti.API.info('Move event listener::::::::' + JSON.stringify(e));
	Ti.API.info('e.itemId:::::' + JSON.stringify(e.itemId));
	sourceItemId = e.itemId;
});

function setModuleItems(moduleData){
	var listItems = [];
	moduleData.forEach(function(listArrayItem){
		listItems.push({
		rowtitle : {
			text : listArrayItem.title
		},
		label :{
			text : "Press Me"
		},
		properties : {
			itemId : listArrayItem.id,
			canEdit : true,
			canMove : true
		}
	});
	});
	return listItems;
}

if(listArray.length > 0){
	fruitsData = listArray.filter(listArrayObj => listArrayObj.moduleId === "Fruits");
	vegData = listArray.filter(listArrayObj => listArrayObj.moduleId === "Vegetables");

	if(fruitsData.length !== 0){
		var fruitsSection = Ti.UI.createListSection({
			headerTitle :"Fruits"
		});
		listSections.push(fruitsSection);
		fruitsSection.setItems(setModuleItems(fruitsData));
	}
	if(vegData.length !== 0){
		var vegSection = Ti.UI.createListSection({
			headerTitle :"Vegetables"
		});
		listSections.push(vegSection);
		vegSection.setItems(setModuleItems(vegData));
	}
}
listView.sections = listSections;
win.add(listView);
win.open(); 
</pre></code>

*Test Steps*
<h4>Create a Titanium application </h4>
<h4>Copy the code above into the <code>app.js</code></h4>
<h4>Run the app on a iOS 13/14 device</h4>
<h4>Move one of the items in the listView around</h4>
<h4>Notice a click event is fired </h4>
<h4>Rerun application on a device/sim < iOS13</h4>
<h4>Move one of the items in the listView around</h4>
<h4>Notice Move event listener is fired and logged </h4>

*Expected result*
Following should be logged:
<code><pre>
[INFO]  Move event listener::::::::{"itemId":"1001","itemIndex":0,"targetItemIndex":3,"section":{},"targetSectionIndex":0,"sectionIndex":0,"targetSection":{},"bubbles":false,"type":"move","source":{"canScroll":true,"caseInsensitiveSearch":true,"horizontalWrap":true,"visible":true,"touchEnabled":true,"dictTemplates":{"plain":{}},"defaultItemTemplate":"plain","editing":true,"pruneSectionsOnEdit":true},"cancelBubble":false}
</pre></code>


<h3>Comments</h3>

<ol>
<li>Vijay Singh 2020-07-02

   1. In my test behavior is as below -
         a) For iOS < 13 only 'move' event is fired. 
         b) For iOS 13+ 'move' event as well as 'itemclick' event is fired.
   
   2. While debugging I can see that in native iOS 13+
   <code><pre>
   - (void)tableView:(UITableView *)tableView accessoryButtonTappedForRowWithIndexPath:(NSIndexPath *)indexPath
   </pre></code>
    delegate method is also called, which is invoking 'itemclick' event. In iOS < 13, it is not called.
   
   
   +Solution/Workaround -+
    In this case (for iOS 13+), ['itemclick'](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.ListView-event-itemclick) has property 'accessoryClicked'  set to 'true'. 
   So apply a condition in your code with help of property 'accessoryClicked'.
   e.g. Modify 'itemclick' event listener as below -
   
   <code><pre>
   listView.addEventListener('itemclick', function(e){
   	if (listView.editing == true && e.accessoryClicked == true) {
   		Ti.API.info('Ignore itemclick event. It is fired while moving rows');
   	} else {
   		alert('Item click fired::::::::');
   	}
   });
   </pre></code>
   </li>
<li>Vijay Singh 2020-07-06

   PR - <a href="https://github.com/appcelerator/titanium_mobile/pull/11805" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11805</a></li>
<li>Satyam Sekhri 2020-07-08

   FR Passed</li>
<li>Satyam Sekhri 2020-07-29

   Verified on:
   Mac OS: 10.15.4
   SDK: 9.1.0.v20200727104531
   Appc CLI: 8.1.0-master.7
   JDK: 11.0.4
   Node: 10.17.0
   Studio: 6.0.0.202005141803
   Xcode: 12.0 beta
   Device: iOS simulator 14.0 beta, 13.5, 12.2, 11.4</li>
</ol>


<p><a href="/TIMOB/TIMOB-27994.json">JSON Source</a></p>