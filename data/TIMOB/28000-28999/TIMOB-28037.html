---
title: "[TIMOB-28037] iOS: Relative path require not working with node_modules"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2021-03-10T16:05:16.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>griffin-app, ios, node_modules, require</td></tr>
<tr><th>Reporter</th><td>Brenton House</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2020-07-22T22:26:03.000+0000</td></tr>
<tr><th>Updated</th><td>2021-06-16T15:45:25.000+0000</td></tr>
</table>

<h3>Description</h3>

On iOS, when doing a relative path require from within a file that exists in node_modules, a runtime error occurs:  [ERROR]     message = "Couldn't find module: ./subdir/test3 for architecture: x86_64";

I've created a standalone test project for this issue here:  <a href="https://github.com/brentonhouse/TIMOB-28037" rel="nofollow" target="_blank">https://github.com/brentonhouse/TIMOB-28037</a>


<h3>Comments</h3>

<ol>
<li>Jan Vennemann 2020-07-22

   This seems to be a general issue when doing lazy requires of relative paths in subfolders on iOS. We only store one global "working directory" which we update while evaluating files, and reset it once done. Requires that are evaluated later, e.g. calling require in a function exported by a module, will then use a wrong base dir to resolve the relative path.</li>
<li>Brenton House 2020-09-02

   FYI - I am able to workaround this issue using a babel plugin in Turbo that resolves static relative paths for all require statements to the absolute path of the module that is being loaded.   This fixes a majority of the cases and should serve as a solid workaround until this issue is resolved.</li>
<li>Brenton House 2020-09-02

   It seems that files in the node_modules directory are skipped from babel processing.  I can fix that in Turbo as well but I am not sure what the original intention was with skipping these. </li>
<li>Jan Vennemann 2020-09-16

   [~bhouse], not 100% sure right now if we specifically exclude <code>node_modules</code> or babel does it on its own, but files inside <code>node_modules</code> are generally expected to be ready-to-use without any transpilation needs. That's because <code>node_modules</code> can get pretty huge and processing all files in there would unnecessarily slow down the build </li>
<li>Christopher Williams 2021-02-25

   <a href="https://github.com/appcelerator/titanium_mobile/pull/11447" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11447</a></li>
<li>Christopher Williams 2021-03-10

   Fixed in <a href="https://github.com/appcelerator/titanium_mobile/pull/11693" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11693</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-28037.json">JSON Source</a></p>