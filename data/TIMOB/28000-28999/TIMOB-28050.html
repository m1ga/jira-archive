---
title: "[TIMOB-28050] Android: Investigate "package visibility" handling on Android 11"
---
<table>
<tr><th>Type</th><td>Story</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-25T15:15:16.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, canOpenUrl, email, emaildialog, intent, openUrl</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-07-25T01:49:05.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-25T15:15:16.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
Android 11 requires developers to add a new <code><query/></code> entries into the "AndroidManifest.xml" for all intents passed to the Java <code>resolveActivity()</code> and <code>queryIntentActivities()</code> methods or else they will return <code>false</code> or an empty collection respectively.
<a href="https://developer.android.com/preview/privacy/package-visibility" rel="nofollow" target="_blank">https://developer.android.com/preview/privacy/package-visibility</a>
<a href="https://developer.android.com/preview/privacy/package-visibility-use-cases#open-a-file" rel="nofollow" target="_blank">https://developer.android.com/preview/privacy/package-visibility-use-cases#open-a-file</a>

Google lists which Java APIs are not affected below. The <code>startActivity()</code> and <code>startActivityForResult()</code> methods are not impacted. Intents referencing their own app are fine too.
<a href="https://developer.android.com/preview/privacy/package-visibility#use-cases-not-affected" rel="nofollow" target="_blank">https://developer.android.com/preview/privacy/package-visibility#use-cases-not-affected</a>

*Impact:*
The following Titanium methods are impacted by this:
* [Ti.Platform.canOpenURL()](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Platform-method-canOpenURL)
* [Ti.Platform.openURL()](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.Platform-method-openURL)
* [Ti.UI.EmailDialog.isSupported()](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.EmailDialog-method-isSupported)

*To-Do:*
* Our <code>openURL()</code> method should not call the Java <code>resolveActivity()</code> anymore so that it won't require the <code><query/></code> block. However, our <code>canOpenURL()</code> should continue to use it and we'll need to document the need for this. (Note that iOS requires a "LSApplicationQueriesSchemes" plist setting for this method as well for the same reasons.)
* Ideally, our build system should auto-inject the <code><query/></code> block needed if the app's code contains a <code>createEmailDialog()</code> method call.

The <code>canOpenURL()</code> and <code>openURL()</code> methods should log an error if a <code><query/></code> entry is needed.

*Test:*
The below PR has test code for <code>canOpenURL()</code> and <code>openURL()</code> which tests several different URLs.
<a href="https://github.com/appcelerator/titanium_mobile/pull/10881" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/10881</a>


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-08-28

   Regarding the [EmailDialog.isSupported()](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.EmailDialog-method-isSupported) method, a <code><queries/></code> block was not required a on a physical Pixel 3a device running Android 11, but it was required in the Android 11 emulator.
   
   Injecting the following into the "AndroidManifest.xml" will make our <code>isSupported()</code> method work.
   <code><pre>
   <manifest>
   	<queries>
   		<intent>
   			<action android:name="android.intent.action.SEND"/>
   			<data android:mimeType="message/rfc822"/>
   		</intent>
   	</queries>
   </manifest>
   </pre></code>
   </li>
<li>Joshua Quick 2020-08-29

   PR (9.3.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/11985" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11985</a></li>
<li>Christopher Williams 2020-10-26

   merged to 9_3_X branch, backport cherry-picked to master for 9.3.0 target</li>
<li>Samir Mohammed 2020-11-25

   *Closing ticket*. Fix verified in SDK version <code>9.3.0.v20201125050632</code>.
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11985" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11985</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-28050.json">JSON Source</a></p>