---
title: "[TIMOB-28057] Android: Modify WebView to use scoped storage for <input/> file selection"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-25T15:26:03.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>WebView, android, file</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-07-30T03:14:57.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-25T15:26:03.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
If a webpage displayed by <code>Ti.UI.WebView</code> has an <code>&lt;input type="file"/&gt;</code> element for taking camera photos, then our Android code will save the photo to "public" external storage which is no longer allowed due to Android's "scoped storage" rules. The photo must be saved to a different location.

*Note:*
An example on how to implement file/image selection in HTML can be found here...
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" rel="nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file</a>

*To-Do:*
Our [TiWebChromeClient.java](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebChromeClient.java)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebChromeClient.java)</a> code needs to replace its usage of the following method call.
<code>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES)</code>

Best solution would be to let the camera app store the photo to its default location and use a <code>ContentResolver</code> to retrieve an <code>InputStream</code> to the photo.

There is also an Android 11 "package visibility" issue in our [TiWebChromeClient.java](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebChromeClient.java)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/modules/ui/src/java/ti/modules/titanium/ui/widget/webview/TiWebChromeClient.java)</a> code where we use the Java <code>resolveActivity()</code> method. We should remove our usage of this method since it will require a <code>&lt;query/&gt;</code> element in the "AndroidManifest.xml" to work. Instead, wrap the <code>startActivityForResult()</code> method call with a try/catch block in case no activity was found.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28057_67543/flower.mp4">flower.mp4</td></td><td>2020-09-12T03:12:28.000+0000</td><td>1128375</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28057_67553/WebViewSelectImageTest.js">WebViewSelectImageTest.js</td></td><td>2020-09-19T02:49:31.000+0000</td><td>1085</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28057_67554/WebViewSelectVideoTest.js">WebViewSelectVideoTest.js</td></td><td>2020-09-19T02:49:31.000+0000</td><td>1172</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-09-19

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/12105" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12105</a></li>
<li>Sohail Saddique 2020-10-08

   FR passed for this part of the PR</li>
<li>Samir Mohammed 2020-11-25

   *Closing ticket*. Fix verified in SDK version <code>9.3.0.v20201125050632</code>.
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/12105" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12105</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-28057.json">JSON Source</a></p>