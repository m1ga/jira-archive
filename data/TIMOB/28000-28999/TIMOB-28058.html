---
title: "[TIMOB-28058] Android: Change Ti.Filesystem \"temp\" APIs to use app's cache folder"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-20T15:14:14.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, file, filesystem, storage, tempdir</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-07-30T04:09:15.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-20T15:14:14.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
The following APIs need to use app's scoped storage and avoid external storage.
* Ti.Filesystem.createTempDirectory()
* Ti.Filesystem.createTempFile()
* Ti.Filesystem.tempDirectory

*Note 1:*
We should write temp files according to Google's docs in the link below. They expect us to explicitly set the temp directory to the app's cache directory.
<a href="https://developer.android.com/training/data-storage/app-specific#internal-create-cache" rel="nofollow" target="_blank">https://developer.android.com/training/data-storage/app-specific#internal-create-cache</a>

*Note 2:*
Our <code>Ti.Filesystem.tempDirectory</code> property return...
<code><pre>
./&lt;AppCacheDir&gt;/_tmp
</pre></code>

Our <code>Ti.Filesystem.createTempFile()</code> and <code>Ti.Filesystem.createTempDirectory()</code> methods should change their base directory to the below to avoid collision with the above folder.
<code><pre>
./&lt;AppCacheDir&gt;/.titanium/tmp
</pre></code>

*Note 3:*
Our [TiTempFileHelper.java](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/runtime/common/src/java/org/appcelerator/kroll/util/TiTempFileHelper.java)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/runtime/common/src/java/org/appcelerator/kroll/util/TiTempFileHelper.java)</a> code (used to acquire a temp directory path) will use <code>getExternalCacheDir()</code> or <code>getCacheDir()</code> depending on if it has access to external storage or not. This may not be a good idea since the temp directory can suddenly change at runtime due to...
* End-user granting permission, making it dynamically switch to external storage.
* End-user ejects SD card, which makes temp path switch to internal storage.

It would be better for the path to be consistent for the app's lifetime. So, it should be hardcoded to internal storage via <code>getCacheDir()</code> like Google's examples.

*Note 4:*
Our HTTP response cache should favor internal storage's cache directory for improved security/privacy. That is what Google suggests in the link below and is what the Chrome browser app does. External storage is best used for large files intended to be shared (like downloaded files).
<a href="https://developer.android.com/reference/android/net/http/HttpResponseCache" rel="nofollow" target="_blank">https://developer.android.com/reference/android/net/http/HttpResponseCache</a>

If we do this, then we can remove our <code>startExternalStorageMonitor()</code> related code in [TiApplication.java](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/android/titanium/src/java/org/appcelerator/titanium/TiApplication.java)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/android/titanium/src/java/org/appcelerator/titanium/TiApplication.java)</a> and hard-code our <code>TiResponseCache</code> to always be the default. This means HTTP response caching will alway be enabled, even if you don't have external storage permission.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-10-07

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/12161" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12161</a></li>
<li>Satyam Sekhri 2020-10-19

   FR Passed.
   Waiting for Jenkins build.</li>
<li>Christopher Williams 2020-10-19

   Merged to master for 9.3.0 target</li>
<li>Samir Mohammed 2020-11-20

   *Closing ticket*. Improvement verified in SDK version <code>9.3.0.v20201119063936</code>.
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/12161" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12161</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-28058.json">JSON Source</a></p>