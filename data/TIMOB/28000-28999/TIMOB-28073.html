---
title: "[TIMOB-28073] Android: DateTimeFormat mishandles some combinations of settings on Android 8"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-08-11T11:24:17.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.1.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>DateTimeFormat, Intl, android, date</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-08-07T03:06:24.000+0000</td></tr>
<tr><th>Updated</th><td>2021-01-18T08:20:37.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
If you set up <code>Intl.DateTimeFormat</code> to use 12-hour time and fractional digits on Android 8.x, then it will log an error and output a different format. This is not an issue on older or new Android OS versions.

*Steps to reproduce:*
<h4>Build and run the below code on Android 8.</h4>
<h4>Notice an error gets logged: <code>Failed to generate 'best' date pattern.</code></h4>
<h4>Notice displayed date is <code>"3/31/20 8:15 PM"</code> which doesn't match format settings.</h4>

<code><pre>
var date = new Date(Date.UTC(2020, 2, 31, 20, 15, 30, 123));
var formatter = new Intl.DateTimeFormat('en-US', {
	year: 'numeric',
	month: '2-digit',
	day: '2-digit',
	hour: 'numeric',
	minute: '2-digit',
	second: '2-digit',
	fractionalSecondDigits: 3,
	hour12: true,
	timeZone: 'UTC'
});
var window = Ti.UI.createWindow();
window.add(Ti.UI.createLabel({ text: formatter.format(date) }));
window.open();
</pre></code>

*Result:*
The following error gets logged...
<code><pre>
[ERROR] DateTimeFormatProxy: (main) [37,37] Failed to generate 'best' date pattern.
[ERROR] DateTimeFormatProxy: java.lang.IllegalArgumentException: Illegal pattern character 'b'
[ERROR] DateTimeFormatProxy: 	at java.text.SimpleDateFormat.compile(SimpleDateFormat.java:870)
[ERROR] DateTimeFormatProxy: 	at java.text.SimpleDateFormat.initialize(SimpleDateFormat.java:684)
[ERROR] DateTimeFormatProxy: 	at java.text.SimpleDateFormat.&lt;init&gt;(SimpleDateFormat.java:623)
</pre></code>

*Expected Result:*
No error should be logged.
The displayed date should be...
<code><pre>
03/31/2020, 8:15:30.123 PM
</pre></code>

*Cause:*
This is a bug on Google's end. It is adding invalid format character <code>'b'</code> for the AM/PM component when it should be using format character <code>'a'</code> instead. This used to be a bug in Oracle's JDK as well...
<a href="https://bugs.openjdk.java.net/browse/JDK-8209047" rel="nofollow" target="_blank">https://bugs.openjdk.java.net/browse/JDK-8209047</a>

Titanium was correctly catching the exception and falling-back to use a basic date/time format, but unfortunately that means it won't match the given format settings. (Having the fallback is still a good thing.)


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-08-07

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11874" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11874</a></li>
<li>Christopher Williams 2020-08-07

   merged to master, auto-backported and merged to 9_1_X and 9_3_X</li>
<li>Samir Mohammed 2020-08-11

   *Closing ticket*. Improvement verified in SDK version <code>9.1.0.v20200810120239</code>, <code>9.2.0.v20200810085310</code> and <code>9.3.0.v20200810090511</code>. Tested using the test case mentioned above.
   
   *Test and other information can be found at:*
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11874" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11874</a>
   
   *Test Environment*
   <code><pre>
   MacOS Big Sur: 11.0 Beta
   Xcode: 12.0 Beta 
   Java Version: 1.8.0_242
   Android NDK: 21.3.6528147
   Node.js: 12.18.1
   ""NPM":"5.0.0","CLI":"8.1.0-master.5""
   API29 Pixel XL emulator
   </pre></code></li>
</ol>


<p><a href="/TIMOB/TIMOB-28073.json">JSON Source</a></p>