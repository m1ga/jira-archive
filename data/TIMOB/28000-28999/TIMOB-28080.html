---
title: "[TIMOB-28080] Android: Add "tapjacking" prevention features"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-13T14:26:29.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, security, touch</td></tr>
<tr><th>Reporter</th><td>K Sakthivel </td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2017-09-14T05:21:26.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-13T14:26:29.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
"Tapjacking" is an Android exploit where a malicious app can display a translucent system overlay on top of other apps with the intent of intercepting touches or to trick the end-user into tapping the overlay app instead of the intended app.

We need new properties/events to prevent and detect this.

*Solution:*
* Add boolean property "filterTouchesWhenObscured" to all <code>Ti.UI.View</code> derived types. When set <code>true</code>, will prevent all touch/click related events that have passed through another app's overlay window.
* Add event "touchfiltered" to <code>Ti.UI.Button</code> to be fired if "filterTouchesWhenObscured" is set <code>true</code> and the touch event was filtered due to an overlay. This event is intended to display an alert dialog to the end-user explaining the reason why the action was blocked.
* Add boolean property "obscured" to all touch/click related events. Will be <code>true</code> if touch event passed through another app's overlay and "filterTouchesWhenObscured" is <code>false</code>. Allows app developer to do manual filtering.

*Note 1:*
The attached  [^AppcOverlay.apk] is an Android test app made by us to display a system overlay. We can use this to test the "obscure" touch event handling/filtering.

*Note 2:*
This was requested by customer K. Sakthivel. Please see attached conversation  [^Chat - Motiur.docx] with tech-support.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28080_67497/AppcOverlay.apk">AppcOverlay.apk</td></td><td>2020-08-26T03:18:06.000+0000</td><td>1692778</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28080_63255/Chat - Motiur.docx">Chat - Motiur.docx</td></td><td>2017-09-14T05:20:36.000+0000</td><td>47633</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Sharif AbuDarda 2017-11-12

   Hello, Please share some native doc on this. Is this achievable natively? Thanks.</li>
<li>Srinivasan Pulipakkam 2020-08-11

   [~lchoudhary] Can you please log which Android security patch you are referring to ( version number if any) or link to the patch.</li>
<li>Joshua Quick 2020-08-11

   I believe the only solution for this is to leverage the Java <code>View.setFilterTouchesWhenObscured()</code> and/or <code>View.onFilterTouchEventForSecurity()</code> methods.
   <a href="https://developer.android.com/reference/android/view/View#security" rel="nofollow" target="_blank">https://developer.android.com/reference/android/view/View#security</a>
   
   The simplest solution may be to call [setFilterTouchesWhenObscured(true)](<a href="https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured(boolean))" rel="nofollow" target="_blank">https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured(boolean))</a> on every Titanium managed <code>Ti.UI.View</code> by default... and see if we can avoid adding a new Titanium API (less is more).
   
   That said, we'll need to double check if this negatively impacts Titanium's translucent modal windows. I think it steals all touch events, which would make it okay to use, but we'll have to test it and find out.</li>
<li>Joshua Quick 2020-08-11

   Also, setting <code>android:exported="false"</code> to an activity in the "AndroidManifest.xml" will avoid the tapjacking issue too. Although Titanium should not set this by default on the root activity because it would prevent its intent-filters from working. We should definitely not do this with JSActivities either. Setting "exported" to <code>false</code> by default for all other Titanium activities would be fine (like <code>TiActivity</code> which is used by the JS <code>Ti.UI.Activity</code>) but I don't know if that will help us if the root activity is exported. We would have to test this out to confirm.</li>
<li>Joshua Quick 2020-08-21

   From looking at Google's own examples, they only filter touches on buttons... including dialog buttons.
   <a href="https://github.com/search?q=org%3Aaosp-mirror+setFilterTouchesWhenObscured&type=Code" rel="nofollow" target="_blank">https://github.com/search?q=org%3Aaosp-mirror+setFilterTouchesWhenObscured&type=Code</a>
   
   On our end, we should a boolean "filterTouchesWhenObscured" property to <code>Ti.UI.View</code>, <code>Ti.UI.AlertDialog</code>, and <code>Ti.UI.OptionsDialog</code>. It should default to <code>false</code> to maintain backward compatibility, which means app developers will need to opt-in to this feature by setting it to the individual views/buttons themselves. I'm thinking it should be opt-in because end-users do install system overlay apps (perhaps unknowingly at times).
   
   We might want to provide a "touchobscured" event to <code>Ti.UI.Button</code> to detect when a button has been tapped on while an overlay is on top of it. The reason is because the end-user might not know an overlay is onscreen and will be confused as to why the button doesn't work if filtered. We can't provide this event to all views unfortunately because it involves deriving from the class and overriding its [onFilterTouchEventForSecurity()](<a href="https://developer.android.com/reference/android/view/View#onFilterTouchEventForSecurity(android.view.MotionEvent))" rel="nofollow" target="_blank">https://developer.android.com/reference/android/view/View#onFilterTouchEventForSecurity(android.view.MotionEvent))</a> method.</li>
<li>Joshua Quick 2020-08-26

   PR (9.3.x): <a href="https://github.com/appcelerator/titanium_mobile/pull/11962" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11962</a></li>
<li>Samir Mohammed 2020-09-28

   FR passed, Waiting on Jenkins build. </li>
<li>Samir Mohammed 2020-11-13

   *Closing ticket*. Fix verified in SDK version <code>9.3.0.v20201111030553</code>.
   
   Test and other information can be found at:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11962" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11962</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-28080.json">JSON Source</a></p>