---
title: "[TIMOB-28093] TiAPI: Add properties "uprightWidth" and "uprightHeight" to Ti.Blob"
---
<table>
<tr><th>Type</th><td>Improvement</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-09-10T13:24:02.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.2.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, blob, exif, iOS, image, jpeg, orientation</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-08-20T21:41:13.000+0000</td></tr>
<tr><th>Updated</th><td>2020-09-10T13:24:02.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
When a Titanium <code>Blob</code> wraps an image, its "width" and "height" properties provide the "decoded" image's dimensions. Unfortunately, Android's native image loading APIs ignore a JPEG's EXIF orientation, meaning the image is loaded as-is (no rotation applied). While our <code>ImageView</code> and other APIs will correctly handle the EXIF orientation, the blob's "width" and "height" is for the unrotated image which makes it difficult to do manual layouts (ex: calculate letterbox scaling).

*Proposed Solution:*
Add the following properties to Titanium <code>Blob</code>:
* uprightWidth
* uprightHeight

The above properties will return what the image width and height should be when a JPEG's EXIF orientation is applied onscreen. If the image is not a JPEG or the JPEG has no EXIF orientation, then these properties will return the same values as "width" and "height".

And since iOS loads images in the upright positions, the above properties will always return the same values as "width" and "height".

*Use-Case:*
Developers need the image's actual width and height to do things like letterbox scaling. For example...
<code><pre>
var scale = Math.min(
	Ti.UI.convertUnits(window.size.width, Ti.UI.UNIT_PX) / imageBlob.width,
	Ti.UI.convertUnits(window.size.height, Ti.UI.UNIT_PX) / imageBlob.height);
imageView.image = imageBlob;
imageView.width = imageBlob.width * scale;
imageView.height = imageBlob.height * scale;
</pre></code>

If the JPEG is loaded sideways (ie: its EXIF orientation is ignored), then the above will scale the image wrong.

*Note:*
This is an interim solution. A better solution would be to completely refactor Titanium's image loading code and decode the image in the upright position (pre-rotated). This will be a huge undertaking that is best done in a major Titanium release version. But when we do this, Android's "uprightWidth" and "uprightHeight" properties will match "width" and "height" just like iOS.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28093_67496/DownloadImageBlobTest.js">DownloadImageBlobTest.js</td></td><td>2020-08-21T00:12:10.000+0000</td><td>2904</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-08-21

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/11936" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11936</a></li>
<li>Michael Gangolf 2020-08-21

   [~jquick] Awesome! Will try that in my app later today</li>
<li>Michael Gangolf 2020-08-21

   Merged it into my custom 9_1_x and works fine! Now I now if I have to switch my values or not (y)</li>
<li>Samir Mohammed 2020-08-26

   FR Passed, Waiting on Jenkins build and 9_3_X build.</li>
<li>Samir Mohammed 2020-09-10

   *Closing ticket*. Improvement verified in SDK version <code>9.2.0.v20200908050955</code>, and <code>9.3.0.v20200908051946</code>.
   
   *Test and other information can be found at:*
   <a href="https://github.com/appcelerator/titanium_mobile/pull/11936" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/11936</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-28093.json">JSON Source</a></p>