---
title: "[TIMOB-28116] Xcode 12: Cannot build modules anymore"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-09-10T16:00:21.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.2.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.2.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Christopher Williams</td></tr>
<tr><th>Created</th><td>2020-09-09T11:00:35.000+0000</td></tr>
<tr><th>Updated</th><td>2020-09-22T23:07:43.000+0000</td></tr>
</table>

<h3>Description</h3>

Since a few beta versions, it's not possible to build modules (like Ti.Facebook) with Xcode 12 anymore. Make sure Xcode 12 is selected (<code>sudo xcode-select -s /Applications/Xcode-beta.app</code>) and build the module with <code>ti build -p ios --build-only</code>.

The error is:
<code><pre>
[ERROR] Failed to generate universal binary (code 1):
[ERROR] fatal error: /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/lipo: ti.facebook/ios/build/Release-iphoneos/libfacebook.a and ti.facebook/ios/build/Release-iphonesimulator/libfacebook.a have the same architectures (arm64) and can't be in the same fat output file
</pre></code>

<h3>Comments</h3>

<ol>
<li>Christopher Williams 2020-09-09

   Hey [~hknoechel] - the long story short is that with Xcode 12, Apple is adding arm64 simulator as a target/arch combo. That "clashes" with arm64 device. So trying to create a "fat universal binary" doesn't work. We have to move over to xcframeworks (or explicitly exclude arm64 sim). The work is already done in the macOS support PR (since that already requires move to xcframeworks). 
   
   You can try to build with that PR, our wait until we land that PR (or the xcframeworks support separately). Or you can do what the linked tickets did and hack a short-term fix of just excluding arm64 sim.</li>
<li>Christopher Williams 2020-09-09

   <a href="https://github.com/appcelerator/titanium_mobile/pull/12026" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12026</a></li>
<li>Hans Knöchel 2020-09-10

   Thanks Chris! The PR can btw be tested with <a href="https://github.com/hansemannn/titanium-widget-kit" rel="nofollow" target="_blank">https://github.com/hansemannn/titanium-widget-kit</a> which is also affected by this change.</li>
<li>Christopher Williams 2020-09-10

   [~hknoechel] A quick note if you didn't create the module from the template in one of the xcframework PRs - I had to hack in a reference to TitaniumKit.xcframework for a swift based module. The module template sticks in an absolute path pointing to the version of the xcframework from the SDK used to create the module. In apple-sign-in, I use <code>$TITANIUM_SDK</code> to build the path which works when building from CLI, but not in the Xcode project: <a href="https://github.com/appcelerator-modules/titanium-apple-sign-in/pull/16/files#diff-ab2479047e1642c6a102069cd6069bb2R24" rel="nofollow" target="_blank">https://github.com/appcelerator-modules/titanium-apple-sign-in/pull/16/files#diff-ab2479047e1642c6a102069cd6069bb2R24</a></li>
<li>Hans Knöchel 2020-09-11

   Good to know! I just pulled latest master and tried migrating the module in [this commit](<a href="https://github.com/hansemannn/titanium-widget-kit/commit/0cde540c4bbe169e3ce6f3ad248cee8bb3894c8b)" rel="nofollow" target="_blank">https://github.com/hansemannn/titanium-widget-kit/commit/0cde540c4bbe169e3ce6f3ad248cee8bb3894c8b)</a>, but it still fails (with a different error now):
   <code><pre>
   [TRACE] [xcode-macos] #import &lt;TitaniumKit/TiBase.h&gt;
   [TRACE] [xcode-macos]         ^
   [TRACE] [xcode-macos] /Users/hans/Documents/dev/titanium/titanium-widget-kit/ios/Classes/TiWidgetkitModule.swift:11:8: error: could not build Objective-C module 'TitaniumKit'
   [TRACE] [xcode-macos] import TitaniumKit
   [TRACE] [xcode-macos]        ^
   [ERROR] [xcode-macos] ** ARCHIVE FAILED **
   [ERROR] [xcode-macos] The following build commands failed:
   [ERROR] [xcode-macos] 	CompileSwift normal arm64 /Users/hans/Documents/dev/titanium/titanium-widget-kit/ios/Classes/TiWidgetkitModule.swift
   [ERROR] [xcode-macos] 	CompileSwiftSources normal arm64 com.apple.xcode.tools.swift.compiler
   [ERROR] [xcode-macos] 	CompileSwift normal x86_64 /Users/hans/Documents/dev/titanium/titanium-widget-kit/ios/Classes/TiWidgetkitModule.swift
   [ERROR] [xcode-macos] 	CompileSwiftSources normal x86_64 com.apple.xcode.tools.swift.compiler
   [ERROR] [xcode-macos] (4 failures)
   </pre></code>
   
   It works when building in Xcode (CMD+B), but the CLI is required to package it. Same happens btw when creating a new Swift module from the scratch.</li>
</ol>


<p><a href="/TIMOB/TIMOB-28116.json">JSON Source</a></p>