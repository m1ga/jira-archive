---
title: "[TIMOB-28189] Android: Opening TabGroup crashes when using AppCompat theme as of 9.3.0"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2020-11-24T18:41:04.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>TabGroup, android, open, regression, theme</td></tr>
<tr><th>Reporter</th><td>Joshua Quick</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2020-10-13T00:05:51.000+0000</td></tr>
<tr><th>Updated</th><td>2020-11-24T18:41:04.000+0000</td></tr>
</table>

<h3>Description</h3>

*Summary:*
When the app is using a <code>Theme.AppCompat</code> derived theme, opening a <code>TabGroup</code> will throw an exception as of Titanium 9.3.0 stating the app needs to use <code>Theme.MaterialComponents</code>. It should only throw this exception when using the "badge" or "badgeColor" property.

This regression was caught before release.

*Steps to reproduce:*
<h4>Create a Classic Titanium app project.</h4>
<h4>Copy the below <code>&lt;application/&gt;</code> theme to project's "tiapp.xml" file.</h4>
<h4>Copy the below "app.js" to the project.</h4>
<h4>Build and run on Android.</h4>

tiapp.xml
<code><pre>
&lt;ti:app&gt;
	&lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
		&lt;manifest&gt;
			&lt;application android:theme="@style/Theme.AppCompat"/&gt;
		&lt;/manifest&gt;
	&lt;/android&gt;
&lt;/ti:app&gt;
</pre></code>

app.js
<code><pre>
function createTab(title) {
	var window = Ti.UI.createWindow({ title: title });
	window.add(Ti.UI.createLabel({ text: title + " View" }));
	var tab = Ti.UI.createTab({
		title: title,
		window: window,
	});
	return tab;
}

var tabGroupSettings = {
	tabs: [createTab("Tab 1"), createTab("Tab 2"), createTab("Tab 3")],
};
if (OS_ANDROID) {
	tabGroupSettings.shiftMode = false;
	tabGroupSettings.style = Ti.UI.Android.TABS_STYLE_BOTTOM_NAVIGATION;
}
var tabGroup = Ti.UI.createTabGroup(tabGroupSettings);
tabGroup.open();
</pre></code>

*Result:*
App crashes with the following exception...
<code><pre>
[ERROR] TiExceptionHandler: (main) [206,322] Unable to start activity ComponentInfo{com.appcelerator.testing/org.appcelerator.titanium.TiActivity}: java.lang.IllegalArgumentException: The style on this component requires your app theme to be Theme.MaterialComponents (or a descendant).
[ERROR] TiExceptionHandler:
[ERROR] TiExceptionHandler:     com.google.android.material.internal.ThemeEnforcement.checkTheme(ThemeEnforcement.java:248)
[ERROR] TiExceptionHandler:     com.google.android.material.internal.ThemeEnforcement.checkMaterialTheme(ThemeEnforcement.java:222)
[ERROR] TiExceptionHandler:     com.google.android.material.badge.BadgeDrawable.&lt;init&gt;(BadgeDrawable.java:361)
[ERROR] TiExceptionHandler:     com.google.android.material.badge.BadgeDrawable.createFromAttributes(BadgeDrawable.java:294)
[ERROR] TiExceptionHandler:     com.google.android.material.badge.BadgeDrawable.create(BadgeDrawable.java:262)
[ERROR] TiExceptionHandler:     com.google.android.material.bottomnavigation.BottomNavigationMenuView.getOrCreateBadge(BottomNavigationMenuView.java:647)
[ERROR] TiExceptionHandler:     com.google.android.material.bottomnavigation.BottomNavigationView.getOrCreateBadge(BottomNavigationView.java:674)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.tabgroup.TiUIBottomNavigationTabGroup.updateBadge(TiUIBottomNavigationTabGroup.java:296)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.tabgroup.TiUIBottomNavigationTabGroup.updateDrawablesAfterNewItem(TiUIBottomNavigationTabGroup.java:195)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.tabgroup.TiUIBottomNavigationTabGroup.addTabItemInController(TiUIBottomNavigationTabGroup.java:171)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.tabgroup.TiUIAbstractTabGroup.addTab(TiUIAbstractTabGroup.java:263)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.tabgroup.TiUIBottomNavigationTabGroup.addTab(TiUIBottomNavigationTabGroup.java:65)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.TabGroupProxy.handlePostOpen(TabGroupProxy.java:480)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.TabGroupProxy.onWindowActivityCreated(TabGroupProxy.java:462)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiBaseActivity.onCreate(TiBaseActivity.java:756)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiActivity.onCreate(TiActivity.java:47)
[ERROR] TiExceptionHandler:     android.app.Activity.performCreate(Activity.java:8000)
[ERROR] TiExceptionHandler:     android.app.Activity.performCreate(Activity.java:7984)
[ERROR] TiExceptionHandler:     android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1309)
[ERROR] TiExceptionHandler:     android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3422)
[ERROR] TiExceptionHandler:     android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3601)
[ERROR] TiExceptionHandler:     android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:85)
[ERROR] TiExceptionHandler:     android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)
[ERROR] TiExceptionHandler:     android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)
[ERROR] TiExceptionHandler:     android.app.ActivityThread$H.handleMessage(ActivityThread.java:2066)
[ERROR] TiExceptionHandler:     android.os.Handler.dispatchMessage(Handler.java:106)
[ERROR] TiExceptionHandler:     android.os.Looper.loop(Looper.java:223)
[ERROR] TiExceptionHandler:     android.app.ActivityThread.main(ActivityThread.java:7656)
[ERROR] TiExceptionHandler:     java.lang.reflect.Method.invoke(Native Method)
[ERROR] TiExceptionHandler:     com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)
[ERROR] TiExceptionHandler:     com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)
</pre></code>

*Expected Result:*
Should not crash if the [Tab.badge](<a href="https://docs.appcelerator.com/platform/latest/#" rel="nofollow" target="_blank">https://docs.appcelerator.com/platform/latest/#</a>!/api/Titanium.UI.Tab-property-badge) property is not set. However, if the code does set this property, then this error does make sense because it can't natively work without using a <code>Theme.MaterialComponents</code> derived theme. So, it should only throw or log the exception when this property is assigned.


<h3>Comments</h3>

<ol>
<li>Joshua Quick 2020-10-13

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/12175" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12175</a></li>
<li>Samir Mohammed 2020-10-21

   FR Passed, waiting on Jenkins build.</li>
<li>Christopher Williams 2020-10-21

   merged to master for 9.3.0 target</li>
<li>Lokesh Choudhary 2020-11-24

   Closing.</li>
</ol>


<p><a href="/TIMOB/TIMOB-28189.json">JSON Source</a></p>