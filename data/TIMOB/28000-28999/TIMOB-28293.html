---
title: "[TIMOB-28293] Android: Setting a ListView marker out of bounds throws an exception"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>Release 9.3.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 9.3.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>ListView, android, marker, regression</td></tr>
<tr><th>Reporter</th><td>Ewan Harris</td></tr>
<tr><th>Assignee</th><td>Gary Mathews</td></tr>
<tr><th>Created</th><td>2020-12-17T15:23:27.000+0000</td></tr>
<tr><th>Updated</th><td>2021-01-07T20:37:35.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Description</h4>

When calling setMarker with an itemIndex or sectionIndex value that is greater than the total items or sections an error like below is thrown. This did not occur in 9.2.2.GA

<code><pre>
[ERROR] TiExceptionHandler: (main) [76,76] /app.js:12
[ERROR] TiExceptionHandler: listView.addMarker({
[ERROR] TiExceptionHandler:          ^
[ERROR] TiExceptionHandler: Error: Index: 1, Size: 1
[ERROR] TiExceptionHandler:     at /app.js:12:10
[ERROR] TiExceptionHandler:     at Module._runScript (ti:/module.js:587:9)
[ERROR] TiExceptionHandler:     at Module.load (ti:/module.js:106:7)
[ERROR] TiExceptionHandler:     at Module.loadJavascriptText (ti:/module.js:436:9)
[ERROR] TiExceptionHandler:     at Module.loadAsFile (ti:/module.js:488:15)
[ERROR] TiExceptionHandler:     at Module.loadAsFileOrDirectory (ti:/module.js:410:20)
[ERROR] TiExceptionHandler:     at Module.require (ti:/module.js:239:23)
[ERROR] TiExceptionHandler:     at Module.global.Module.require (&lt;embedded&gt;:5050:34)
[ERROR] TiExceptionHandler:     at require (ti:/module.js:550:15)
[ERROR] TiExceptionHandler:     at global.require (&lt;embedded&gt;:5034:10)
[ERROR] TiExceptionHandler:
[ERROR] TiExceptionHandler:     java.util.ArrayList.get(ArrayList.java:437)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.listview.ListViewProxy.getSectionByIndex(ListViewProxy.java:207)
[ERROR] TiExceptionHandler:     ti.modules.titanium.ui.widget.listview.ListViewProxy.addMarker(ListViewProxy.java:72)
[ERROR] TiExceptionHandler:     org.appcelerator.kroll.runtime.v8.V8Runtime.nativeRunModule(Native Method)
[ERROR] TiExceptionHandler:     org.appcelerator.kroll.runtime.v8.V8Runtime.doRunModule(V8Runtime.java:172)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiApplication.launch(TiApplication.java:872)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiLaunchActivity.loadScript(TiLaunchActivity.java:96)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiRootActivity.loadScript(TiRootActivity.java:500)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiLaunchActivity.onResume(TiLaunchActivity.java:177)
[ERROR] TiExceptionHandler:     org.appcelerator.titanium.TiRootActivity.onResume(TiRootActivity.java:519)
[ERROR] V8Exception: Exception occurred at /app.js:12: Uncaught Error: Index: 1, Size: 1
</pre></code>

<code><pre>
var win = Ti.UI.createWindow({backgroundColor: 'gray' });
var listView = Ti.UI.createListView();
var sections = [];
var vegSection = Ti.UI.createListSection({ headerTitle: 'Vegetables' });
var vegDataSet = [
    {properties: { title: 'Carrots'}},
    {properties: { title: 'Potatoes'}},
];
vegSection.items = vegDataSet;
sections.push(vegSection);
listView.sections = sections;
listView.addMarker({
	itemIndex: 0,
	sectionIndex: 1
});
win.add(listView);
win.open();
</pre></code>

<h4>Steps to reproduce</h4>

1. Add the code below to an existing app.js
2. Run on Android

<h4>Actual</h4>

Runtime error and RSOD

<h4>Expected</h4>

-Maybe a warning log given that technically this is an error case?- <- This is wrong, see comment

Marker should be setup and work correctly

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28293_67754/ListViewMarkerTest.js">ListViewMarkerTest.js</td></td><td>2020-12-17T20:34:25.000+0000</td><td>1430</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Ewan Harris 2020-12-17

   Did some testing on 9.2.2.GA and it appears that setting a marker that doesn't exist yet works totally fine, and will work correctly when it exists in future. With the below code, after adding a new section and scrolling to the bottom the marker event will have fired
   
   <code><pre>
   var win = Ti.UI.createWindow({backgroundColor: 'gray' });
   var btn = Ti.UI.createButton({ title: 'click', top: 35 });
   btn.addEventListener('click', () =&gt; {
   	listView.appendSection(Ti.UI.createListSection({
   		headerTitle: 'added after click',
   		items: addRows(50)
   	}));
   });
   win.add(btn);
   var listView = Ti.UI.createListView({ top: 100 });var sections = [];
   
   sections.push(Ti.UI.createListSection({
   	headerTitle: 'Fruits',
   	items: addRows(100)
   }));
   
   listView.sections = sections;
   win.add(listView);
   win.open();
   
   listView.addMarker({
   	itemIndex: 25,
   	sectionIndex: 1
   });
   
   listView.addEventListener('marker', (e) =&gt; {
   	console.log('marker fired');
   });
   
   function addRows(total) {
   	const arr = [];
   	for (let i = 0; i &lt; total; i++) {
   		arr.push({ 
   			properties: {
   				title: <code>Label = ${i}</code>
   			}
   		});
   	}
   	return arr;
   }
   
   </pre></code></li>
<li>Gary Mathews 2020-12-17

   master: <a href="https://github.com/appcelerator/titanium_mobile/pull/12350" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12350</a></li>
<li>Joshua Quick 2020-12-17

   The below test script is a practical use-case for ListView markers where when you scroll to the bottom, it loads more rows, and when you scroll to the bottom again it loads more rows. It doesn't test for the bug mentioned on this ticket, but it is another common way of implementing markers.
    [^ListViewMarkerTest.js] </li>
<li>Satyam Sekhri 2021-01-05

   FR Passed.
   Waiting for Jenkins build.</li>
<li>Christopher Williams 2021-01-07

   merged to master, backport for 9_3_X merged to 9.3.1 target.</li>
</ol>


<p><a href="/TIMOB/TIMOB-28293.json">JSON Source</a></p>