---
title: "[TIMOB-28324] iOS: image from filereader function not being called "
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2021-05-18T18:28:50.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.0.0, Release 9.3.3</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>file, iOS, image</td></tr>
<tr><th>Reporter</th><td>Samir Mohammed</td></tr>
<tr><th>Assignee</th><td>Vijay Singh</td></tr>
<tr><th>Created</th><td>2021-01-20T10:49:12.000+0000</td></tr>
<tr><th>Updated</th><td>2021-05-18T18:28:54.000+0000</td></tr>
</table>

<h3>Description</h3>

On iOS the 2nd image which is being read in by filereader is not being loaded but on Android it works as expected. 

*+Test Case:+*
<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor:'white'
});


var earthFile,
  earthFileStream,
  earthBuffer;

function fileReader(args) {
  if (args.bytesProcessed === -1) {
    Ti.API.error('Done');
    Ti.API.info(earthBuffer.toBlob().height + ' . ' + earthBuffer.toBlob().width + ' . ' + earthBuffer.toBlob().mimeType);
    earthImage.image = earthBuffer.toBlob();
    Ti.API.info(earthImage.image.height + ' . ' + earthImage.image.width + ' . ' + earthImage.image.mimeType);
    earthBuffer.release();
    earthImage.animate({
      opacity: 1,
      duration: 100
    });
  } else {
    Ti.API.error(args.bytesProcessed + ' of ' + args.totalBytesProcessed);
    if (earthBuffer === null) {
      earthBuffer = Ti.createBuffer();
    }
    earthBuffer.append(args.buffer);
  }
}

function loadEarth() {
  earthImage.image = null;
  earthImage.opacity = 0;
  earthFile = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, '/Earth.jpg');
  earthFileStream = Ti.Filesystem.openStream(Ti.Filesystem.MODE_READ, earthFile.nativePath);
  earthBuffer = null;
  Ti.Stream.pump(earthFileStream, fileReader, 512, true);
}

var fishImage = Ti.UI.createImageView({
  left: '10dp',
  top: '10dp',
  right: '10dp',
  height: '200dp',
  image: '/ClownFish.jpg'
});
win.add(fishImage);

var earthImage = Ti.UI.createImageView({
  left: '10dp',
  bottom: '10dp',
  right: '10dp',
  height: '200dp',
  opacity: 0
});
earthImage.addEventListener('singletap', loadEarth);
win.add(earthImage);

loadEarth();
win.open();
</pre></code>


*+Test Steps:+*
<h4>Create an application with the test case above </h4>
<h4>Make sure app thinning is disabled in the tiapp.xml</h4>
<h4>add the two images attached below into the resources folder </h4>
<h4>Run application on iOS </h4>

*+Actual result:+*
2nd image does not load and nothing is logged in the console.

*+Expected result:+*
2nd image should load and log the following 
<code><pre>
[ERROR]  Done
[INFO]   1600 . 2560 . image/jpeg
[INFO]   1600 . 2560 . image/jpeg
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28324_67774/ClownFish.jpg">ClownFish.jpg</td></td><td>2021-01-20T10:49:08.000+0000</td><td>1044897</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28324_67773/Earth.jpg">Earth.jpg</td></td><td>2021-01-20T10:49:10.000+0000</td><td>1860714</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Vijay Singh 2021-03-16

   Workaround is add following line - 
      earthFileStream.addEventListener('pump', fileReader);
    inside function loadEarth .
   </li>
<li>Vijay Singh 2021-03-18

   PR - <a href="https://github.com/appcelerator/titanium_mobile/pull/12616" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12616</a></li>
<li>Satyam Sekhri 2021-03-22

   FR Passed.
   Waiting for Jenkins build</li>
<li>Christopher Williams 2021-03-23

   merged to master, 10_0_X and 9_3_X branches.</li>
</ol>


<p><a href="/TIMOB/TIMOB-28324.json">JSON Source</a></p>