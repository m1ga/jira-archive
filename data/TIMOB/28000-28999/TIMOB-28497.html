---
title: "[TIMOB-28497] iOS: Hierarchy error occurs with SplitWindow and NavigationWindow as of 10.0.0"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2021-07-20T09:46:20.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 10.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 10.0.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>NavigationWindow, SplitWindow, ios, regression</td></tr>
<tr><th>Reporter</th><td>Brian Garc√≠a</td></tr>
<tr><th>Assignee</th><td>Joshua Quick</td></tr>
<tr><th>Created</th><td>2021-06-24T08:09:59.000+0000</td></tr>
<tr><th>Updated</th><td>2021-07-20T09:46:20.000+0000</td></tr>
</table>

<h3>Description</h3>

With SDK 10.0.0.GA and the following example, iOS throws the error below. In lower versions it works properly

<code><pre>
&lt;Alloy&gt;
  &lt;SplitWindow backgroundColor="white" showMasterInPortrait="true"&gt;

    &lt;!-- First window is the masterView --&gt;
    &lt;NavigationWindow&gt;
      &lt;Window title="Master View"&gt;
        &lt;ListView&gt;
          &lt;ListSection headerTitle="Some items"&gt;
            &lt;ListItem title="Item 1" /&gt;
            &lt;ListItem title="Item 2" /&gt;
            &lt;ListItem title="Item 3" /&gt;
          &lt;/ListSection&gt;
        &lt;/ListView&gt;
      &lt;/Window&gt;
    &lt;/NavigationWindow&gt;

    &lt;!-- Second window is the detailView --&gt;
    &lt;NavigationWindow&gt;
      &lt;Window title="Detail View"&gt;
        &lt;Label&gt;I am the detail view.&lt;/Label&gt;
      &lt;/Window&gt;
    &lt;/NavigationWindow&gt;
  &lt;/SplitWindow&gt;
&lt;/Alloy&gt;
</pre></code>



<code><pre>
'UIViewControllerHierarchyInconsistency', reason: 'child view controller:&lt;UINavigationController: 0x7fda2d885000&gt; should have parent view controller:&lt;TiViewController: 0x7fda2ac61920&gt; but requested parent is:&lt;TiRootViewController: 0x7fda2c02a200&gt;'
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-28497_67944/SplitWithNavChildWindows.png">SplitWithNavChildWindows.png</td></td><td>2021-06-25T03:47:10.000+0000</td><td>886855</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Joshua Quick 2021-06-25

   I made a Classic version of your Alloy app in pure JS and it worked fine...
   <code><pre>
   const masterWindow = Ti.UI.createWindow({ title: "Master View" });
   masterWindow.add(Ti.UI.createListView({
   	sections: [
   		Ti.UI.createListSection({
   			items: [
   				{ properties: { title: "Row 1" } },
   				{ properties: { title: "Row 2" } },
   				{ properties: { title: "Row 3" } },
   			],
   		}),
   	],
   }));
   
   const detailWindow = Ti.UI.createWindow({ title: "Detail View" });
   detailWindow.add(Ti.UI.createLabel({ text: "Hello World!" }));
   
   const splitWindow = Ti.UI.iOS.createSplitWindow({
   	detailView: Ti.UI.createNavigationWindow({ window: detailWindow }),
   	masterView: Ti.UI.createNavigationWindow({ window: masterWindow }),
   	backgroundColor: "white",
   	showMasterInPortrait: true,
   });
   splitWindow.open();
   </pre></code>
    !SplitWithNavChildWindows.png|thumbnail! 
   
   ----
   
   However, if I wrap the <code>SplitWindow</code> within a <code>NavigationWindow</code>, it *crashes* as of Titanium 10.0.0. This is happening because there is a <code>NavigationWindow</code> within a <code>NavigationWindow</code> which will cause this exception. Your Alloy XML isn't set up to do this, but I'm *guessing* Alloy is wrongly setting it up this way when it does the JS code generation.
   
   <code><pre>
   const masterWindow = Ti.UI.createWindow({ title: "Master View" });
   masterWindow.add(Ti.UI.createListView({
   	sections: [
   		Ti.UI.createListSection({
   			items: [
   				{ properties: { title: "Row 1" } },
   				{ properties: { title: "Row 2" } },
   				{ properties: { title: "Row 3" } },
   			],
   		}),
   	],
   }));
   
   const detailWindow = Ti.UI.createWindow({ title: "Detail View" });
   detailWindow.add(Ti.UI.createLabel({ text: "Hello World!" }));
   
   const splitWindow = Ti.UI.iOS.createSplitWindow({
   	detailView: Ti.UI.createNavigationWindow({ window: detailWindow }),
   	masterView: Ti.UI.createNavigationWindow({ window: masterWindow }),
   	backgroundColor: "white",
   	showMasterInPortrait: true,
   });
   Ti.UI.createNavigationWindow({ window: splitWindow }).open();
   </pre></code>
   
   <code><pre>
   [INFO]  *** Terminating app due to uncaught exception 'UIViewControllerHierarchyInconsistency', reason: 'child view controller:&lt;UINavigationController: 0x7fd9c586a600&gt; should have parent view controller:&lt;TiViewController: 0x7fd9c60157a0&gt; but requested parent is:&lt;TiRootViewController: 0x7fd9c581c400&gt;'
   [INFO]  *** First throw call stack:
   [INFO]  (
   [INFO]          0   CoreFoundation                      0x00007fff20422fba __exceptionPreprocess + 242
   [INFO]          1   libobjc.A.dylib                     0x00007fff20193ff5 objc_exception_throw + 48
   [INFO]          2   CoreFoundation                      0x00007fff20422e98 -[NSException initWithCoder:] + 0
   [INFO]          3   UIKitCore                           0x00007fff23f89a24 -[UIViewController _addChildViewController:performHierarchyCheck:notifyWillMove:] + 329
   [INFO]          4   ClassicAppTest                      0x000000010660f4e4 -[TiUINavigationWindowProxy windowDidOpen] + 100
   </pre></code>
   
   </li>
<li>Joshua Quick 2021-06-25

   I've confirmed that ticket [TIMOB-27865] has caused this regression.
   
   It's caused by the new <code>\[TiUINavigationWindowProxy windowDidOpen\]</code> method added...
   <a href="https://github.com/appcelerator/titanium_mobile/pull/12233/files#diff-370f5f4b50cfdee279868eb38fb97f1954436094edbe253d4b3805e99725e65f" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12233/files#diff-370f5f4b50cfdee279868eb38fb97f1954436094edbe253d4b3805e99725e65f</a>
   
   *Possible Solution:*
   I think we need to change the [TiWindowProxy. windowHoldingController ](<a href="https://github.com/appcelerator/titanium_mobile/blob/master/iphone/TitaniumKit/TitaniumKit/Sources/API/TiWindowProxy.m#L506-L513)" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/blob/master/iphone/TitaniumKit/TitaniumKit/Sources/API/TiWindowProxy.m#L506-L513)</a> method to be walk up the view hierarchy to find the first parent controller like this...
   <code><pre>
   - (UIViewController *)windowHoldingController
   {
     for (UIResponder *responder = [[self view].superview nextResponder]; responder != nil; responder = [responder nextResponder]) {
       if ([responder isKindOfClass:[UIViewController class]]) {
         return (UIViewController *) responder;
       }
     }
     return [[TiApp app] controller];
   }
   </pre></code>
   </li>
<li>Joshua Quick 2021-06-28

   PR (master): <a href="https://github.com/appcelerator/titanium_mobile/pull/12930" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/12930</a></li>
<li>Ewan Harris 2021-07-20

   Merged to master and 10_0_X</li>
</ol>


<p><a href="/TIMOB/TIMOB-28497.json">JSON Source</a></p>