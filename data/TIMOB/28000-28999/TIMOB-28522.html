---
title: "[TIMOB-28522] iOS: Cannot exclude iOS only modules from universal build"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Open</td></tr>
<tr><th>Resolution</th><td>Unresolved</td></tr>

<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Hans Knöchel</td></tr>
<tr><th>Assignee</th><td>Unknown</td></tr>
<tr><th>Created</th><td>2021-08-13T14:45:55.000+0000</td></tr>
<tr><th>Updated</th><td>2021-08-17T09:35:48.000+0000</td></tr>
</table>

<h3>Description</h3>

We have a native SDK which is iOS only, so we want to exclude it from the module build (which is easy to do in Xcode by unchecking it in the Build Phases tab and wrapping the iOS-only code with <code>#if !TARGET_OS_MACCATALYST</code> statements. But unfortunately, the Titanium module CLI (_buildModule.js) still thinks we use it because it only checks if the file exists, not the Xcode setting of the file.

An alternative would be to mark the module iOS only in the tiapp.xml by having something like <code>&lt;module platform="ios" exclude="mac_catalyst"&gt;...&lt;/module&gt;</code> or <code>platform="ios"</code> vs <code>platform="ios_catalyst"</code>.

Without one of the solution, the Mac support is not finished I think. An example of how the files are marked in the .pbxproj file is attached. The problematic module source is attached as well. Compile it and you will notice the warning:
<code><pre>
[WARN]  The module is using frameworks (BytedanceOpenPlatformSDK.framework,SCSDKCoreKit.framework,SCSDKCreativeKit.framework,TikTokOpenSDK.framework) that do not support simulator arm64. Excluding simulator arm64. The app using this module may fail if you're on an arm64 Apple Silicon device.
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-28522_67960/Bildschirmfoto 2021-08-13 um 16.46.27.png">Bildschirmfoto 2021-08-13 um 16.46.27.png</td></td><td>2021-08-13T14:47:10.000+0000</td><td>337493</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Hans Knöchel 2021-08-15

   PR (to be verified): <a href="https://github.com/appcelerator/titanium_mobile/pull/13022" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/13022</a>
   
   In theory, because we explicitely make the frameworks only available on iOS (in the .xcodeproj) + have guards to only import the frameworks for iOS, it should be okay. Of course, the modules are still not compatible with macOS then, but the app can simply exclude those features until the libraries are ready.</li>
<li>Ewan Harris 2021-08-16

   [~hknoechel] I think maybe doing this via excluding a module in the tiapp might be better? It means that existing modules could be ignored without requiring they be recompiled.
   
   I had filed TIMOB-28245 to allow this, and I think doing it using the existing <code>--target</code> options would be best rather than introducing a new syntax</li>
<li>Hans Knöchel 2021-08-16

   Yep, probably! Also, my fix does not work because the build still tries to evaluate them at a later build stage. But the <code>--target</code> alone will not help because even the iOS Simulator does not run on an Apple Silicon device (thats the biggest issue right now).</li>
<li>Hans Knöchel 2021-08-17

   Using TIMOB-28525, this will be less critical and only relevant for macOS apps. But still, it would definitely improve the macOS adoption :-)</li>
</ol>


<p><a href="/TIMOB/TIMOB-28522.json">JSON Source</a></p>