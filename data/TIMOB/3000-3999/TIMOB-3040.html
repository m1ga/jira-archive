---
title: "[TIMOB-3040] Android: If image stored directly in Resources/images, referencing it causes too many unnecessary exceptions"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-05-05T15:21:15.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.7.0, Sprint 2011-12</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, release-1.7.0, reported-1.5.1</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:35:18.000+0000</td></tr>
<tr><th>Updated</th><td>2011-05-05T15:21:15.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>"Failcase" is, for example, the Table View Layout 2 test in
KitchenSink. It's not really a "failure" since the test actually
works. But behind the scenes a bunch of exceptions -- handled
exceptions -- are happening, very likely affecting performance.</p>
<p>You can see it happening if you run KS with <code>&lt;property
type="bool" name="ti.android.debug"&gt;true&lt;/property&gt;</code>
in tiapp.xml. Run <code>adb logcat</code> at the command line, then
-- with KS running in your emulator -- go to the Views -&gt; Table
Views -&gt; Layout 2 test. As the test loads, watch logcat
scrolling by -- you'll end up seeing a ton of exceptions. If you
then scroll up and down on the table view in the test, you'll see a
ton more exceptions being logged in logcat.</p>
<p>Alternatively, you can watch me doing it here:</p>
<p><a href=
"<a href="http://screencast.com/t/FD9E6klYe" rel="nofollow" target="_blank">http://screencast.com/t/FD9E6klYe</a>"><a href="http://screencast.com/t/FD9E6klYe" rel="nofollow" target="_blank">http://screencast.com/t/FD9E6klYe</a></a></p>
<p>What's happening is this: Because the image path begins with
Resources/images -- which is one of our standard locations to check
for density-specific images -- we do the density image name
mangling and check to see if the image exists as an Android
resource. The checking to see if it's a resource uses reflection
(see <code>TiRHelper.locateResource</code>), and has to accept the
fact that an exception will be raised if the resource doesn't
exist. It handles that fine (and sends it to logcat if debug is
turned on -- which is what we're seeing in that video) and the
result is that our <code>loadDrawable</code> method ends up
successfully finding the image file in the standard file system.
But I imagine those exceptions are expensive. The problem is that
-- unlike successful finds of a resource image -- we do
<strong>not</strong> cache the failures. So it tries <strong>every
time</strong> to load the same image as a resource that doesn't
exist.</p>
<p>I think putting images into the Resources/images folder is
probably a fairly common pattern for app developers. So we could
perhaps improvement performance for these people by caching
resource lookup failures to avoid going through the series of
exceptions over and over again.</p></div>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/b47d085bb43a5bc9b885ee89d7067eddccbbc8db"
   title=
   "Changeset [b47d085bb43a5bc9b885ee89d7067eddccbbc8db]">[b47d085bb43a5bc9b885ee89d7067eddccbbc8db]</a>)
   When looking up Resource/android/images/xxx images in the android
   resources, don't bother checking for android system resources,
   since by definition you're looking for a project-specific resource.
   Saves one lookup. [<a href="/projects/32238/tickets/3040" title=
   "Ticket #3040">#3040</a>] <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/b47d085bb43a5bc9b885ee89d7067eddccbbc8db" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/b47d085bb43a5bc9b885ee89d7067eddccbbc8db</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/b47d085bb43a..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/b47d085bb43a...</a></a></p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Hmm, as usual one of my commits not listed automatically. The
   main commit for this item is:</p>
   <p><a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/e7beec84f5209141bd" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e7beec84f5209141bd</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/e7beec84f520..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e7beec84f520...</a></a></p></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>QE Testing: follow the elaborate :) instructions up in the
   description, and (in the pre-fix version of the SDK) you'll see a
   bunch of exceptions scrolling by in logcat (they will be
   categorized as "TiRHelper"). Then, after installing the fixed
   version, you won't see those exceptions anymore.</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-3040.json">JSON Source</a></p>