---
title: "[TIMOB-3058] Android: If heavyweight window's JS code immediately opens a lightweight window, lightweight window is never seen"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T02:00:48.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.6.0 M09</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, defect, lifecycle_refactor, regression, release-1.6.0, reported-1.6.0, rplist</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:35:46.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T02:00:48.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>The fail case is the KS -&gt; Controls -&gt; Slider -&gt;
Min/Max Range test. When you run it, you only see a black
window.</p>
<p>It's a very strangely written test, and I'm pretty sure it's
actually a mistake (the way it's written). (Nevertheless, it should
-- and did -- work.)</p>
<p>It's strange because when you tap the row to start the test, it
opens a new window (as do basically all of our KS tests) using
tabgroup.open(win) (thus that new window is heavy). That window has
its own url property. And in the JS of that URL, a second window
(light) is created and opened in order to display the test. (This
second window is obviously totally unnecessary, but anyway...)</p>
<p>The reason we see a blank window is because it's the heavy
window that is showing. (The JS for the heavy window does not
contain any code that puts a view on the window.) The lightweight
window never gets seen. And we can see why in this screen shot of
some logcat output that I've annotated:</p>
<p><a href=
"<a href="https://skitch.com/billdawson/rpdeu/projects-grep-137x29" rel="nofollow" target="_blank">https://skitch.com/billdawson/rpdeu/projects-grep-137x29</a>"><a href="https://skitch.com/billdawson/rpdeu/projects-grep-137x29" rel="nofollow" target="_blank">https://skitch.com/billdawson/rpdeu/projects-grep-137x29</a></a></p>
<p>So when the lightweight window starts opening, the heavyweight
window hasn't finished opening yet (obviously, since part of the
code running when the heavyweight window opens is to open the
lightweight window.) And when a lightweight window is created
(constructor of <code>TiUIWindow</code>), it immediately runs
through <code>handleWindowCreated</code> and
<code>handleBooted</code>, thus putting out its layout right away.
Meanwhile the heavyweight window has to wait until its
<code>handleBooted</code> gets called. When it does, the
heavyweight window puts <strong>its</strong> layout on the
activity, thus hiding the lightweight window's layout.</p>
<p>So the test is bizarre and probably should be changed. But the
use case of having a heavy open a light immediately is perhaps
valid. Like maybe the heavy's code checks some condition and if it
exists they want to popup a light window for a second to display an
elaborate message with an OK button that closes the light so its
re-shows the heavy.</p>
<p>'N' stuff, and yeah but no but yeah but no.</p></div>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/1e82b2497cc81acafb60841154e3ba1e82744677"
   title=
   "Changeset [1e82b2497cc81acafb60841154e3ba1e82744677]">[1e82b2497cc81acafb60841154e3ba1e82744677]</a>)
   [<a href="/projects/32238/tickets/3058" title=
   "Ticket #3058">#3058</a> state:fixed-in-qa] in
   TiBaseActivity.onCreate, set the window handler so that any
   lightweight windows drawn in heavyweight window's JS will be
   visible. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/1e82b2497cc81acafb60841154e3ba1e82744677" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/1e82b2497cc81acafb60841154e3ba1e82744677</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/1e82b2497cc8..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/1e82b2497cc8...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p><a href="/projects/32238/changesets/INFO" title=
   "Changeset [INFO]">[INFO]</a> Titanium SDK version: 1.6.0 (02/08/11
   20:55 bd9d124...) galaxy tab (2.2.2) G1 (1.6) Nexus S (2.3) sim
   2.1</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-3058.json">JSON Source</a></p>