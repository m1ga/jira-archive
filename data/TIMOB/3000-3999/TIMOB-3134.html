---
title: "[TIMOB-3134] Android: Alert Dialog appears behind activities and is invisible to user"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Trivial</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-05-03T14:09:46.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.7.0, Sprint 2011-16</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>android, enterprise, regression, release-1.7.0, reported-1.6.0, rplist</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-04-15T03:37:45.000+0000</td></tr>
<tr><th>Updated</th><td>2011-05-03T14:09:46.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><h1>Problem</h1>
<p>When an alert dialog and a modal window are launched at the same
time, they end up racing each other to see who displays first. This
causes an exception to be thrown.</p>
<h1>Regression</h1>
<p>In 1.5.0, the alert dialog would show over the modal window, and
no exception would be thrown. This has been introduced since
then.</p>
<h1>Sample Code</h1>
<pre>
<code class=
"javascript">var tabGroup = Titanium.UI.createTabGroup();
 
// main window
var tmpWindow = Titanium.UI.createWindow({  
    backgroundColor: 'green',
});
var tmpTab = Titanium.UI.createTab({  
    window:tmpWindow,
    title:'first'
});
 
tabGroup.addTab(tmpTab);
tabGroup.open();
 
Login = {};
 
Login.loginDialog = Ti.UI.createWindow({
   backgroundColor: 'red',
});
 
Login.loginDialog.open({modal:true});
 
var alertDialog = Titanium.UI.createAlertDialog({
    title: 'Welcome',
    message: 'Stuff in here',
    buttonNames: ['red pill', 'blue pill']
});
alertDialog.show();</code>
</pre>
<h1>Trace Log</h1>
<pre>
<code>[TRACE] E/WindowManager( 586): Activity org.appcelerator.jss.JssActivity has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@43ec9740 that was originally added here
[TRACE] E/WindowManager( 586): android.view.WindowLeaked: Activity org.appcelerator.jss.JssActivity has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@43ec9740 that was originally added here
[TRACE] E/WindowManager( 586): at android.view.ViewRoot.&lt;init&gt;(ViewRoot.java:247)
[TRACE] E/WindowManager( 586): at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:148)
[TRACE] E/WindowManager( 586): at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:91)
[TRACE] E/WindowManager( 586): at android.view.Window$LocalWindowManager.addView(Window.java:424)
[TRACE] E/WindowManager( 586): at android.app.Dialog.show(Dialog.java:241)
[TRACE] E/WindowManager( 586): at ti.modules.titanium.ui.widget.TiUIActivityIndicator.handleShow(TiUIActivityIndicator.java:200)
[TRACE] E/WindowManager( 586): at ti.modules.titanium.ui.widget.TiUIActivityIndicator.show(TiUIActivityIndicator.java:124)
[TRACE] E/WindowManager( 586): at ti.modules.titanium.ui.ActivityIndicatorProxy.handleShow(ActivityIndicatorProxy.java:45)
[TRACE] E/WindowManager( 586): at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:212)
[TRACE] E/WindowManager( 586): at android.os.Handler.dispatchMessage(Handler.java:95)
[TRACE] E/WindowManager( 586): at android.os.Looper.loop(Looper.java:123)
[TRACE] E/WindowManager( 586): at android.app.ActivityThread.main(ActivityThread.java:4627)
[TRACE] E/WindowManager( 586): at java.lang.reflect.Method.invokeNative(Native Method)
[TRACE] E/WindowManager( 586): at java.lang.reflect.Method.invoke(Method.java:521)
[TRACE] E/WindowManager( 586): at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)
[TRACE] E/WindowManager( 586): at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)
[TRACE] E/WindowManager( 586): at dalvik.system.NativeStart.main(Native Method)</code>
</pre>
<h1>Workaround</h1>
<p>The workaround is to remove the race -- only open one, and when
it is finished, launch the second. Therefore, the workaround for
the sample code would be the following (thanks belong to Marshall
Culpepper for this workaround):</p>
<pre>
<code class=
"javascript">Login.loginDialog.addEventListener("open", function(e) {
    var alertDialog = Titanium.UI.createAlertDialog({
        title: 'Welcome',
        message: 'Stuff in here',
        buttonNames: ['red pill', 'blue pill']
    });
    alertDialog.show();
});
Login.loginDialog.open({ modal: true });</code>
</pre>
<h1>Tested On</h1>
<p>Titanium SDK version: 1.6.0 (02/10/11 14:34 9db0685...)<br>
BROKEN on Android Simulator 2.2</p>
<h2>Associated Helpdesk Ticket</h2>
<p><a href=
"<a href="http://developer.appcelerator.com/helpdesk/view/72761" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/72761</a>"><a href="http://developer.appcelerator.com/helpdesk/view/72761" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/72761</a></a></p></div>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-04-15

   <div><p>Technically it's not a race condition, and it's not really
   related to modality. That's not an exception either, it's a stack
   trace Android is giving us, basically saying "Hey you leaked a
   window, if you want to know which window is leaked, here's the code
   path that created that window." I.e., no exception is thrown.</p>
   <p>It's not a race condition because, in fact, the alert dialog is
   being shown -- it's the window being leaked. You just can't see it
   because it's behind everything. When you back out of the tabgroup,
   the application closes while that window (the alert) is still
   showing, thus that complaint by Android.</p>
   <p>So I'm gonna go ahead and change the title here, just to be
   anal. :)</p>
   <p>Here's a much simpler test case to show this behavior:</p>
   <pre>
   <code class=
   "javascript">Ti.UI.createWindow({exitOnClose:true,fullscreen:false, backgroundColor:'blue'}).open();
   Ti.UI.createAlertDialog({message:'.'}).show();</code>
   </pre></div></li>
<li>Bill Dawson 2011-04-15

   <div><p>Trace with some notes. It's from running the two-liner app.js I
   show above. I'm putting this here so I don't "lose it". :)</p>
   <p><a href=
   "<a href="https://img.skitch.com/20110406-mtb9dq7txs42f835dx88xe5231.png" rel="nofollow" target="_blank">https://img.skitch.com/20110406-mtb9dq7txs42f835dx88xe5231.png</a>"><a href="https://img.skitch.com/20110406-mtb9dq7txs42f835dx88xe5231.png" rel="nofollow" target="_blank">https://img.skitch.com/20110406-mtb9dq7txs42f835dx88xe5231.png</a></a></p></div></li>
<li>Bill Dawson 2011-04-25

   I got the failcase to work by adding code that notices if the activity stack is in flux and, if so, delays the call to the alert dialog.
   
   However, I *strongly* recommend against using code like that in the fail case.  In a sense, there was some luck involved that this ever worked in 1.5.x.  The reason is because of the way Android activities work.  For an alert dialog to be visible, it is important that it appear "above" the topmost Activity in the Android activity stack.  
   
   What is the topmost Activity when <code>alertDialog.show()</code> is called in the fail case app.js?  Is it the "root" Activity, which is the Activity that runs when the application launches and executes app.js?  Or is it the Activity that is created when the <code>TabGroup</code> opens? ( <code>TabGroup</code> s have their own Activity).  Or is it the Activity created by the modal window being opened (a modal window causes its own Activity)?
   
   In other words, there are three Activities involved in that app.js code sequence.  The launching of the <code>TabGroup</code> and the modal <code>Window</code> create two of those Activities, and their launches are _asynchronous_.  When <code>alertDialog.show()</code> comes around, which of those three Activities is going to be "current"?  It's dangerous to assume that the modal window's activity will be current.
   
   It's better to be sure that the modal window (atop of which you want the dialog to show, else it won't be visible) has opened by putting the call to <code>alertDialog.show()</code> in an <code>open</code> event listener for that modal window:
   
   <code><pre>
   var alertDialog = Titanium.UI.createAlertDialog({
       title: 'Welcome',
       message: 'Stuff in here',
       buttonNames: ['red pill', 'blue pill']
   });
   Login = {};
    
   Login.loginDialog = Ti.UI.createWindow({
      backgroundColor: 'red',
   });
   
   Login.loginDialog.addEventListener('open', function(){
      alertDialog.show();
   });
   Login.loginDialog.open({modal:true});
   
   </pre></code></li>
</ol>


<p><a href="/TIMOB/TIMOB-3134.json">JSON Source</a></p>