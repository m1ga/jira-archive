---
title: "[TIMOB-3211] iOS: Facebook module loggedIn never true when Safari restricted"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-04-17T02:01:11.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Sprint-2011-08</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>defect, facebook, ios, release-1.6.1, release-1.7.0, rplist</td></tr>
<tr><th>Reporter</th><td>Jon Alter</td></tr>
<tr><th>Assignee</th><td>Ralf Pfeiffer</td></tr>
<tr><th>Created</th><td>2011-04-15T03:39:36.000+0000</td></tr>
<tr><th>Updated</th><td>2011-04-17T02:01:11.000+0000</td></tr>
</table>

<h3>Description</h3>

<div><p>When you restrict Safari and authorize() or us the facebook
button, everything seems to work properly but loggedIn is never
true and the facebook button never changes to 'logout'</p>
<p>Step 0: restrict Safari via
(Settings&gt;General&gt;Restrictions)<br>
Step 1: install app<br>
Step 2: click the 'loggedIn' button<br>
Step 3: Label says false<br>
Step 4: click 'authorize()' or Facebook button and login<br>
Step 5: notice FB button still says Login<br>
Step 6: click the 'loggedIn' button<br>
Step 7: Label says false</p>
<pre>
<code class="javascript">var win = Titanium.UI.createWindow({  
    backgroundColor:'#fff'
});

Titanium.Facebook.appid = '187692147928682';
Titanium.Facebook.permissions = ['publish_stream'];

var statusLabel = Ti.UI.createLabel({
    text: 'click status',
    top: 0,
    width: 300,
    height: 60
});

var statusButton = Titanium.UI.createButton({
    title: 'loggedIn',
    bottom: 300,
    width: 300,
    height: 60
});
statusButton.addEventListener('click', function(e) {
    Ti.API.info('Facebook loggedIn: '+Ti.Facebook.loggedIn);
    statusLabel.text = 'Facebook loggedIn: '+Ti.Facebook.loggedIn;
});

var fbAuthButton = Titanium.UI.createButton({
    title: 'authorize()',
    bottom: 100,
    width: 300,
    height: 60
});
fbAuthButton.addEventListener('click', function(e) {
    Titanium.Facebook.authorize();
});

var fbButton = Titanium.Facebook.createLoginButton({
    'style': 'wide',
    'sessionProxy': '<a href="http://api.appcelerator.net/p/fbconnect/" rel="nofollow" target="_blank">http://api.appcelerator.net/p/fbconnect/</a>',
    bottom: 50,
    height: 30,
    width: 300
});

win.add(statusLabel);
win.add(statusButton);
win.add(fbAuthButton);
win.add(fbButton);
win.open();</code>
</pre>
<h3>Tested on</h3>
<p>TiSDK 1.6.0GA, iOS 4.2.1, iPhone4</p>
<h3>Associated Helpdesk Ticket</h3>
<p><a href=
"<a href="http://developer.appcelerator.com/helpdesk/view/75411" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/75411</a>"><a href="http://developer.appcelerator.com/helpdesk/view/75411" rel="nofollow" target="_blank">http://developer.appcelerator.com/helpdesk/view/75411</a></a></p></div>

<h3>Comments</h3>

<ol>
<li>Jon Alter 2011-04-15

   <div><p>You will need to copy Info.plist to the root dir of your project
   and You&#8217;ll need to edit the CFBundleURLSchemes array to
   include the URL that Facebook uses to restart your app after login
   is completed:</p>
   <pre>
   <code>        &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;
           &lt;array&gt;
                   ... OTHER URL SCHEMES HERE ...
                   &lt;string&gt;fb187692147928682&lt;/string&gt;
           &lt;/array&gt;</code>
   </pre></div></li>
<li>Stephen Tramer 2011-04-15

   <div><p>Unable to duplicate outside Titanium as an Apple bug. But filed
   a bug with facebook: <a href=
   "<a href="http://bugs.developers.facebook.net/show_bug.cgi?id=15427" rel="nofollow" target="_blank">http://bugs.developers.facebook.net/show_bug.cgi?id=15427</a>"><a href="http://bugs.developers.facebook.net/show_bug.cgi?id=15427" rel="nofollow" target="_blank">http://bugs.developers.facebook.net/show_bug.cgi?id=15427</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/5c7aa560eeb4f35ae3765e1c1aca4112f796e8b7"
   title=
   "Changeset [5c7aa560eeb4f35ae3765e1c1aca4112f796e8b7]">[5c7aa560eeb4f35ae3765e1c1aca4112f796e8b7]</a>)
   [<a href="/projects/32238/tickets/3211" title=
   "Ticket #3211">#3211</a> state:fixed-in-qa] Patched the Facebook
   iOS SDK to properly handle redirects to the app requesting
   authorization. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/5c7aa560eeb4f35ae3765e1c1aca4112f796e8b7" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/5c7aa560eeb4f35ae3765e1c1aca4112f796e8b7</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/5c7aa560eeb4..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/5c7aa560eeb4...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p><a href="/projects/32238/changesets/INFO" title=
   "Changeset [INFO]">[INFO]</a> Titanium SDK version: 1.7.0 (02/25/11
   08:42 8a239f5) iphone 4 (4.2.1), more testing needed before
   closing</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/166e80359cd31faf017680ad4a20d9fc0e5a0e30"
   title=
   "Changeset [166e80359cd31faf017680ad4a20d9fc0e5a0e30]">[166e80359cd31faf017680ad4a20d9fc0e5a0e30]</a>)
   [<a href="/projects/32238/tickets/3211" title=
   "Ticket #3211">#3211</a> state:fixed-in-qa] Patched the Facebook
   iOS SDK to properly handle redirects to the app requesting
   authorization. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/166e80359cd31faf017680ad4a20d9fc0e5a0e30" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/166e80359cd31faf017680ad4a20d9fc0e5a0e30</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/166e80359cd3..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/166e80359cd3...</a></a></p></div></li>
<li>Thomas Huelbert 2011-04-15

   <div><p>fix looks good on 4.01-4.2.1, but still seeing the bad behavior
   (fb button not reflecting log in status) on 3.1.3</p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/e7e8f673a79528456cec1493e0013f0db884bc6f"
   title=
   "Changeset [e7e8f673a79528456cec1493e0013f0db884bc6f]">[e7e8f673a79528456cec1493e0013f0db884bc6f]</a>)
   [<a href="/projects/32238/tickets/3211" title=
   "Ticket #3211">#3211</a>] Fix for 3.1.x login auth. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/e7e8f673a79528456cec1493e0013f0db884bc6f" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e7e8f673a79528456cec1493e0013f0db884bc6f</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/e7e8f673a795..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/e7e8f673a795...</a></a></p></div></li>
<li>Jeff Haynie 2011-04-15

   <div><p>(from <a href=
   "/projects/32238/changesets/547be3825a21e9572a55452d86892e0f4cbfff0d"
   title=
   "Changeset [547be3825a21e9572a55452d86892e0f4cbfff0d]">[547be3825a21e9572a55452d86892e0f4cbfff0d]</a>)
   [<a href="/projects/32238/tickets/3211" title=
   "Ticket #3211">#3211</a>] Fix for 3.1.x login auth. <a href=
   "<a href="https://github.com/appcelerator/titanium_mobile/commit/547be3825a21e9572a55452d86892e0f4cbfff0d" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/547be3825a21e9572a55452d86892e0f4cbfff0d</a>">
   <a href="https://github.com/appcelerator/titanium_mobile/commit/547be3825a21..." rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/547be3825a21...</a></a></p></div></li>
<li>Natalie Huynh 2011-04-15

   <div><p>Tested with Titanium SDK version: 1.7.0 (03/02/11 13:57
   5d8c78a)<br>
   iPhone 3g 3.1.2<br>
   iPhone 4 4.2.1</p></div></li>
<li>Don Thorp 2011-04-15

    <div><p>This was fixed after 1_6_1_GA so changed release tag to
    release-1.6.1 and added release-1.7.0</p></div></li>
</ol>


<p><a href="/TIMOB/TIMOB-3211.json">JSON Source</a></p>