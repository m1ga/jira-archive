---
title: "[TIMOB-3380] Android: PRAGMA statements that set data don't work"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2014-04-08T23:11:48.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>2014 Sprint 07 SDK, Release 3.3.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>exalture, module_database, qe-closed-3.3.0, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Grambo</td></tr>
<tr><th>Assignee</th><td>Sunila</td></tr>
<tr><th>Created</th><td>2011-04-15T03:43:34.000+0000</td></tr>
<tr><th>Updated</th><td>2014-05-05T11:17:56.000+0000</td></tr>
</table>

<h3>Description</h3>

On android, when running the following select statement: "PRAGMA user_version=5;" the user_version is never updated. The same statement works fine when manually ran through sqlite3.

I've looked into the code in TiDatabaseProxy.java and it seems that any pragma statements are automatically put through the rawQuery function, which shouldn't be used for queries that insert data.

Seems that the fix for ticket TIMOB-2147 probably introduced this issue.

I've attached a patch that I think should fix the issue, although I've not tested it yet as I don't have a proper build environment set up for titanium mobile.

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-3380_18312/titanium_pragma_fix.patch">titanium_pragma_fix.patch</td></td><td>2011-04-15T03:43:34.000+0000</td><td>1044</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Mark Ruys 2013-05-29

   This is not an iOS, but Android issue. Attached patch seems to work.</li>
<li>Sunila 2014-03-27

   Execute PRAGMA statements using execSQL if it has =
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/5540" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5540</a></li>
<li>Sunila 2014-04-08

   Test case
   After executing the code, TITLE should have value 5
   
           var db = Ti.Database.open('mydb');
   	db.execute("PRAGMA user_version=5;");
   	var user_version = db.execute("PRAGMA user_version;");
   	if(user_version.getRowCount()){
   		do{
   		Ti.API.info("##### TITLE: "+user_version.field(0));
   		var user_version = user_version.next();
   		Ti.API.info('## Next: '+user_version);
   		}while( user_version );
   	}</li>
<li>Priya Agarwal 2014-05-05

   Verified with:
   Appc-Studio:3.3.0.201405011408
   sdk:3.3.0.v20140502133323
   acs:1.0.14
   alloy:1.4.0-dev
   npm:1.3.2
   titanium:3.3.0-dev
   titanium-code-processor:1.1.1
   xcode:5.1.1
   Device:Iphone5(7.1),LG-P970(V4.0.4)</li>
<li>Priya Agarwal 2014-05-05

   Used the above mentioned test code and getting the expected output.</li>
</ol>


<p><a href="/TIMOB/TIMOB-3380.json">JSON Source</a></p>