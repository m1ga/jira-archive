---
title: "[TIMOB-4201] iOS: Ti.Platform.displayCaps is undefined if called from another context"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2011-06-20T09:59:37.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-24</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>regression</td></tr>
<tr><th>Reporter</th><td>Jon Alter</td></tr>
<tr><th>Assignee</th><td>Blain Hamon</td></tr>
<tr><th>Created</th><td>2011-05-24T11:27:14.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-02T21:06:50.000+0000</td></tr>
</table>

<h3>Description</h3>

If you call Ti.Platform.displayCaps from a different context it says that it is undefined.

Step 1: run the code below
Step 2: notice the error when you click the button
Step 3: when you call the same function from the same context it works fine.

app.js
<code><pre>
var app ={
	getWidth : function(){
		return Ti.Platform.displayCaps.platformWidth;
	}
};

var win = Ti.UI.createWindow({  
    backgroundColor:'white',
	fullscreen: true
});

var button = Ti.UI.createButton({
	title: 'Width',
	top: 100,
	height: 40,
	width: 200
});
button.addEventListener('click', function(e){
	// alert( app.getWidth() );
	var newWin = Ti.UI.createWindow({  
	    backgroundColor:'blue',
		url: 'win1.js'
	});
	newWin.app = app;
	newWin.open();
});

win.add(button);
win.open();
</pre></code>

win1.js
<code><pre>
(function(){
	var win = Ti.UI.currentWindow;
	alert( win.app.getWidth() );
})();
</pre></code>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-4201_18986/4201.crash">4201.crash</td></td><td>2011-06-06T14:54:11.000+0000</td><td>20774</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-4201_18562/Screen shot 2011-05-24 at 11.12.44 AM.png">Screen shot 2011-05-24 at 11.12.44 AM.png</td></td><td>2011-05-24T11:27:14.000+0000</td><td>37977</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Jon Alter 2011-05-25

   <h4>Associated Helpdesk Ticket</h4>
   <a href="http://appc.me/c/APP-783212" rel="nofollow" target="_blank">http://appc.me/c/APP-783212</a></li>
<li>Dawson Toth 2011-05-25

   <h4>Second Associated Helpdesk Ticket</h4>
   <a href="http://appc.me/c/APP-367438" rel="nofollow" target="_blank">http://appc.me/c/APP-367438</a></li>
<li>Dawson Toth 2011-05-25

   <h4>Where The Regression Happened</h4>
   I just tested this on a build I made last night from the latest source, and it is working again. So sometime between 1.6.2 and 1.7.0.RC1 this regressed, and from 1.7.0.RC1 to now it was fixed.
   
   <h4>Works With</h4>
   Titanium SDK version: 1.8.0 (05/24/11 16:32 ce16436)
   (pulled from GitHub, built myself)
   
   <h4>Tested With</h4>
   <code><pre>
   Ti.App.Dawson = {
       createRedBox: function() {
           var v = Ti.UI.createView({ backgroundColor: 'red', width: 50, height: 50 });
           v.add(Ti.UI.createLabel({ text: 'Hello!' })); //This line fails with an exception saying v is undefined.
           alert(Ti.Platform.displayCaps.platformWidth);
           return v;
       }
   };
   Ti.UI.createWindow({ url: 'sub.js', backgroundColor: 'white' }).open();
   </pre></code>
   <code><pre>
   Ti.UI.currentWindow.add(Ti.App.Dawson.createRedBox());
   </pre></code></li>
<li>Blain Hamon 2011-06-03

   If it's working now, let's call it fixed.</li>
<li>Eric Merriman  2011-06-06

   Now it crashes.
   
   Mon Jun  6 14:41:35 unknown ReportCrash[4648] <Notice>: Formulating crash report for process timob4201[4647]
   Mon Jun  6 14:41:35 unknown ReportCrash[4648] <Error>: Saved crashreport to /var/mobile/Library/Logs/CrashReporter/timob4201_2011-06-06-144135_Pippen.plist using uid: 0 gid: 0, synthetic_euid: 501 egid: 0
   Mon Jun  6 14:41:35 unknown com.apple.launchd[1] <Warning>: (UIKitApplication:com.appcelerator.4201[0xea7b]) Job appears to have crashed: Trace/BPT trap
   Mon Jun  6 14:41:35 unknown SpringBoard[28] <Warning>: Application 'timob4201' exited abnormally with signal 5: Trace/BPT trap
   
   See attached crash log.</li>
<li>Blain Hamon 2011-06-13

   Tempted to mark this is invalid; For reasons of safety, creating proxies in the wrong context is disallowed (It leads to deadlocks or crashes) and so displayCaps, since it wasn't defined previously and would be in the wrong context, is not registered.
   
   If you absolutely must make cross-context calls, refer to Ti.Platform.displayCaps in the JS file beforehand.</li>
<li>Blain Hamon 2011-06-20

   No objections to marking this invalid. Creating a proxy cross-context (That includes accessing previously un-accessed globals) was intentionally disallowed to stop things from crashing.</li>
<li>Lee Morris 2017-03-02

   Closed as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-4201.json">JSON Source</a></p>