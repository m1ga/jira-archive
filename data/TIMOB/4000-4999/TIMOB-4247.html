---
title: "[TIMOB-4247] New socket API prevents catching App events once connected"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2011-06-21T09:01:19.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-25, Release 1.8.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>1.7, ipass1, module_network</td></tr>
<tr><th>Reporter</th><td>jordi domenech</td></tr>
<tr><th>Assignee</th><td>Stephen Tramer</td></tr>
<tr><th>Created</th><td>2011-05-28T05:59:35.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-28T21:08:46.000+0000</td></tr>
</table>

<h3>Description</h3>

Although I can open a socket connection with the new API socket.open(), the thread where I create and open the connection is unable to catch events (Ti.App.addEventListener) fired with (Ti.App.fireEvent).

See demonstration below. Edit lines 6 & 7 with host+port of ant socket server (I cannot reveal my client's server).
The event is neither fired nor catched.
BUT, if you comment line 25 you'll see all is working as usual.

<code><pre>
var demo = Ti.UI.createWindow({
}),
socket = null;

socket = Titanium.Network.Socket.createTCP({
	host: "server.ip",
	port: "server.socketPort",
	connected: function(e) {
		Ti.API.info("socket: connected");

		var readBuffer = Ti.createBuffer({length:1024}),
		bytesRead = 0;
		while((bytesRead = socket.read(readBuffer))&gt;-1) {
			var stringData = Ti.Codec.decodeString({source: readBuffer, length: bytesRead});
			Ti.API.info("socket: received " + bytesRead + " bytes:" + stringData);
			readBuffer.clear(); // clear the buffer before the next read
		}
		socket.close();
	},
	error: function(e) {
		Ti.API.info("socket: error");
		socket.close();
	}
});
socket.connect();  // comment this, then works as usual

Ti.App.addEventListener('ack', function() {
	Ti.API.info("ack catched");
});

setInterval(function() {
	Ti.API.info("firing ack");
	Ti.App.fireEvent('ack');
}, 3000);


demo.open();
</pre></code>

Code also available at [<a href="https://gist.github.com/999073" rel="nofollow" target="_blank">https://gist.github.com/999073</a>]

<h3>Comments</h3>

<ol>
<li>Paul Dowsett 2011-05-30

   In order for us to progress this issue, please edit your ticket to include a proper [Use-case](<a href="http://wiki.appcelerator.org/display/guides/Contributing+to+Titanium#ContributingtoTitanium-CreatingGoodUsecases)." rel="nofollow" target="_blank">http://wiki.appcelerator.org/display/guides/Contributing+to+Titanium#ContributingtoTitanium-CreatingGoodUsecases).</a>
   
   Please also use the latest 1.7.X continuous build, and include the version, date and hash here.
   
   Kindly read the [Submitting Bug Reports](<a href="http://wiki.appcelerator.org/display/guides/Contributing+to+Titanium#ContributingtoTitanium-SubmittingBugReports)" rel="nofollow" target="_blank">http://wiki.appcelerator.org/display/guides/Contributing+to+Titanium#ContributingtoTitanium-SubmittingBugReports)</a> guide before raising tickets.
   
   Thank you</li>
<li>jordi domenech 2011-05-30

   Hi,
   Sorry, I was in a hurry when I wrote the ticket. 
   
   So, I made a very simple app.js with the use case:
   <a href="https://gist.github.com/999073" rel="nofollow" target="_blank">https://gist.github.com/999073</a>
   
   Edit lines 6 & 7 with host+port of ant socket server, I could not reveal my client's server.
   
   I realize that the event is neither fired nor catched.
   
   BUT, if you comment line 25 you'll see all is working as usual.
   
   I didn't download the 1.7.X continuous build, my workflow is with github. I forked your repo, fetch and checkout your 1_7_X branch, I mean I have the newest code.
   
   Hope this helps, let me know if you anything more, I'm very happy to contribute.</li>
<li>Paul Dowsett 2011-05-30

   jordi, are you saying that you have compiled the SDK?  If so, it won't be possible for us to reproduce the same conditions. Hence, would you test it using one of the packages from our [CI Builds](<a href="http://wiki.appcelerator.org/display/guides/Continuous+Builds)" rel="nofollow" target="_blank">http://wiki.appcelerator.org/display/guides/Continuous+Builds)</a> site?
   
   Note that when you launch an app, the Titanium version, date and hash will be logged to the console.
   
   Once you have provided this information, I can move this issue to the relevant project.
   
   Thanks in advance
   
   </li>
<li>Paul Dowsett 2011-05-30

   btw, to confirm, you do put quotes around your host and port lines, don't you?</li>
<li>jordi domenech 2011-05-30

   i do :) 
   actually, it works, I mean the socket is opened and works like a charm, writes/reads data. The problem is with the events.
   
   Yes, I compiled the SDK from source. Anyway, I've downloaded the last CI, made a clean build and the problem persists. The console says:
   [DEBUG] Xcode 4.0.2 (it also happens with 4.0.0)
   [DEBUG] Build version 4A2002a
   [INFO] MyApp/1.0 (1.7.0.8be59d3...)
   
   I cannot see Ti version, date and hash. I'm using Titanium Developer 1.2.2, as Titanium Studio started to crash for a memory problem (and I'm unable to make it work again) a couple of weeks ago.
   
   </li>
<li>Paul Dowsett 2011-05-30

   Thanks for the info, Jordi - moving this ticket to the correct project.</li>
<li>Stephen Tramer 2011-06-21

   This is expected behavior. The issue is that once the socket is connected, socket.read() is called - read() is a blocking call on ALL I/O streams by convention. This means until data is received by the socket, ALL activity in the current JS thread is blocked.
   
   The solution is to use the asynchronous Ti.Stream.read() method. Sockets should, except in very rare cases, use asynchronous read/write. Doing otherwise can result in issues such as windows not closing, events not being fired, stale UI, poor interaction, and other issues.</li>
<li>Lee Morris 2017-03-28

   Closing ticket as invalid.</li>
</ol>


<p><a href="/TIMOB/TIMOB-4247.json">JSON Source</a></p>