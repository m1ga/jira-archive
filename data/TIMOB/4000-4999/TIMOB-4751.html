---
title: "[TIMOB-4751] Random crash using getElementsByTagName to parse XML"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2011-08-01T11:54:31.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-31</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>bad_access, callback, xmlparsing</td></tr>
<tr><th>Reporter</th><td>Davide Bertola</td></tr>
<tr><th>Assignee</th><td>Blain Hamon</td></tr>
<tr><th>Created</th><td>2011-07-20T05:10:22.000+0000</td></tr>
<tr><th>Updated</th><td>2012-02-09T14:02:43.000+0000</td></tr>
</table>

<h3>Description</h3>



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-4751_21926/stacktrace.txt">stacktrace.txt</td></td><td>2011-07-21T02:50:43.000+0000</td><td>1590</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Davide Bertola 2011-07-22

   I don't know if it's useful but we discovered that we can workaround the crash rewriting the code like this
   
   <code><pre>
   Titanium.UI.setBackgroundColor('#000');
   
   var app = {};
   
   var win = Ti.UI.createWindow({
   	title: "Nope"
   });
   
   var test = Ti.XML.parseString ("<stops><lat>ciao</lat></stops>");
   var result = [];
   function crashIt () {
   	for (var i=0; i<1000; i++) {
   		setTimeout (function () {
   			var foo = test.getElementsByTagName ("lat").item (0).text;
   			result.push (i + " - " + foo);
   		}, 1);
   	}
   }
   crashIt ();
   
   //Ti.API.debug (result);
   
   win.open ();
   </pre></code></li>
<li>Davide Bertola 2011-07-22

   inside KrollObject, in function ConvertIdTiValue around line 266 we have
   
   <code><pre>
   	else if ([obj isKindOfClass:[KrollMethod class]])
   	{
   		KrollContext * ourContext = [(KrollMethod *)obj context];
   		if (context == ourContext)
   		{
   			return [(KrollMethod *)obj jsobject];
   		}
   		return TiObjectMake(jsContext,KrollMethodClassRef,obj);
   	}
   </pre></code>
   
   disabling the internal IF seems to fix the crash, but don't know why
   
   <code><pre>
   	else if ([obj isKindOfClass:[KrollMethod class]])
   	{
   		KrollContext * ourContext = [(KrollMethod *)obj context];
   		if (context == ourContext && 0)
   		{
   			return [(KrollMethod *)obj jsobject];
   		}
   		return TiObjectMake(jsContext,KrollMethodClassRef,obj);
   	}
   </pre></code>
   
   I hope this helps</li>
<li>Eduardo Gomez 2011-07-27

   <h4>Associated HD ticket</h4>
   A PRO customer relies on this, <a href="http://appc.me/c/APP-414331" rel="nofollow" target="_blank">http://appc.me/c/APP-414331</a>
   
   <h4>Repro sequence</h4>
   Once this snippet code starts working and parsing XML data, occasionally app crashes.
   <code><pre>
   var xhr = Ti.Network.createHTTPClient();
   xhr.open("GET","<a href="http://v2.0.news.tmg.s3.amazonaws.com/feeds/news.xml" rel="nofollow" target="_blank">http://v2.0.news.tmg.s3.amazonaws.com/feeds/news.xml</a>");
               xhr.onload = function()
               {
                   try 
                   {
                       var doc = this.responseXML.documentElement;
                       var items = doc.getElementsByTagName("item");
                       var x = 0;
                       var doctitle = doc.evaluate("//channel/title/text()").item(0).nodeValue;
   
   
   
                       for (var c=0, l=items.length;c<l;c++)               
                           {
                           var item = items.item(c);
   
                               var elemTitle = item.getElementsByTagName("title").item(0).text;
                               Ti.API.info('-> '+elemTitle);
   
                               var elemUrl = item.getElementsByTagName("link").item(0).text;
                                        Ti.API.info('-> '+elemUrl);
                               //Get and format the date
   
                               var origDate = item.getElementsByTagName("pubDate").item(0).text;   
   
                               var date_arr = origDate.split(" ");
   
                               var elemDate = date_arr[2]+" "+date_arr[1]+", "+date_arr[3];
   
                               //Push to the array
                               articlesData.push({
                                   title:elemTitle,
                                   url:elemUrl,
                                   date:elemDate
                               });
   
                           }
                           Ti.App.Properties.setList('articlesProp', articlesData);
   
                   }
                   catch(E)
                   {
                       alert(E);
                   }
               };
   
           xhr.send();
   </pre></code></li>
<li>Blain Hamon 2011-08-01

   As of Aug 1, could not crash on device or simulator. Given the crash log given, it's highly likely that this was fixed by the new TiJSCore update that happened recently.</li>
<li>Thomas Huelbert 2012-02-09

   closing as we are not able to reproduce using master (1.9.0 Feb 9 2012 09:46 rd47ce8a4)</li>
</ol>


<p><a href="/TIMOB/TIMOB-4751.json">JSON Source</a></p>