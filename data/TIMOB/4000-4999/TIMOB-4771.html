---
title: "[TIMOB-4771] Android:  apiXmlNodeCloneNode fails with exception"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-01-04T16:15:57.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.1</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-30, Release 1.8.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>module_xml, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Opie Cyrus</td></tr>
<tr><th>Assignee</th><td>Eric Merriman </td></tr>
<tr><th>Created</th><td>2011-07-25T15:17:27.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-19T12:46:11.000+0000</td></tr>
</table>

<h3>Description</h3>

When trying to clone node, exception is thrown:

"07-25 16:29:33.160 13642 13651 E KrollMethod: (kroll$1: app://app.js) [7,2569] Exception calling kroll method cloneNode, invocation: null ]
07-25 16:29:33.160 13642 13651 E KrollMethod: org.w3c.dom.DOMException
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.apache.harmony.xml.dom.NodeImpl.setNameNS(NodeImpl.java:228)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.apache.harmony.xml.dom.ElementImpl.<init>(ElementImpl.java:51)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.apache.harmony.xml.dom.DocumentImpl.createElementNS(DocumentImpl.java:337)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.apache.harmony.xml.dom.DocumentImpl.shallowCopy(DocumentImpl.java:157)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.apache.harmony.xml.dom.DocumentImpl.cloneOrImportNode(DocumentImpl.java:209)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.apache.harmony.xml.dom.NodeImpl.cloneNode(NodeImpl.java:77)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at ti.modules.titanium.xml.NodeProxy.cloneNode(NodeProxy.java:122)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at ti.modules.titanium.xml.NodeProxyBindingGen$24.invoke(NodeProxyBindingGen.java:931)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.appcelerator.kroll.KrollMethod.call(KrollMethod.java:51)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.appcelerator.titanium.kroll.KrollCoverage$KrollFunctionCoverage.call(KrollCoverage.java:213)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.mozilla.javascript.Interpreter.interpretLoop(Interpreter.java:1701)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.mozilla.javascript.Interpreter.interpret(Interpreter.java:854)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.mozilla.javascript.InterpretedFunction.call(InterpretedFunction.java:164)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.mozilla.javascript.ContextFactory.doTopCall(ContextFactory.java:426)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.mozilla.javascript.ScriptRuntime.doTopCall(ScriptRuntime.java:3177)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.mozilla.javascript.InterpretedFunction.call(InterpretedFunction.java:162)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.appcelerator.titanium.testharness.Test_harnessActivity$1.run(Test_harnessActivity.java:90)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.appcelerator.titanium.TiMessageQueue.handleMessage(TiMessageQueue.java:219)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at android.os.Handler.dispatchMessage(Handler.java:95)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at android.os.Looper.loop(Looper.java:143)
07-25 16:29:33.160 13642 13651 E KrollMethod: 	at org.appcelerator.titanium.kroll.KrollHandlerThread.run(KrollHandlerThread.java:86)
07-25 16:29:33.551 13642 13651 D dalvikvm: GC_FOR_MALLOC freed 9833 objects / 572048 bytes in 95ms
07-25 16:29:33.840 13642 13651 W TiConvert: (kroll$1: app://app.js) [14,3258] Unsupported type class org.appcelerator.kroll.KrollProxy$1
07-25 16:29:33.918 13642 13651 D dalvikvm: GC_FOR_MALLOC freed 9055 objects / 556920 bytes in 54ms"


<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-07-26

   Google bug that is fixed in Honeycomb:
   
   <a href="http://code.google.com/p/android/issues/detail?id=2735" rel="nofollow" target="_blank">http://code.google.com/p/android/issues/detail?id=2735</a></li>
<li>Bill Dawson 2011-07-26

   Changed <code>NodeProxy</code> code to simply display warning when <code>cloneNode</code> called in pre-Honeycomb versions.  Use this as test case and try both in pre-Honeycomb and Honeycomb or later:
   
   <code><pre>
   //Titanium.Network // (workaround for TIMOB-3465)
   var xmlString = '&lt;a b="c"&gt;&lt;d e="f"/&gt;&lt;/a&gt;';
   var doc = Ti.XML.parseString(xmlString);
   var elem = doc.documentElement.firstChild;
   if (Ti.Platform.osname === 'android' &&
   		!isNaN(parseInt(Ti.Platform.version)) &&
   		parseInt(Ti.Platform.version) &lt; 3) {
   	Ti.API.warn("Call to .clone() will probably throw DOMException.  You should also see another warning from core code prior to the exception.");
   }
   var clone = elem.cloneNode(false);
   </pre></code>
   
   * In pre-Honeycomb (pre-3.0) you should get a DOMException on screen.  Check logcat, look above the exception stack traces, and make sure you see two warnings, one from the Javascript code above (and thus beginning with <code>W/TiAPI</code>) and one from our <code>NodeProxy</code> (thus beginning with <code>W/TiNodeProxy</code>).
   
   * In Honeycomb or later, you should get no exceptions, and you should not see any of the two warning messages described in the previous bullet.</li>
<li>Don Thorp 2011-07-29

   review and test.</li>
<li>Natalie Huynh 2011-12-06

   Tested with 1.8.0.1.v20111205164258 v8/rhino on
   Galaxy 10.1 (3.1)
   Droid 1 (2.2.2)
   Nexus S (2.3.6)
   Emulator (4.0)
   
   Pre-HoneyComb: Do not get DOMException but get this warning
   W/TiAPI   ( 1885): Call to .clone() will probably throw DOMException.  You should also see another warning from core code prior to the exception.
   W/TiNodeProxy( 1885): (KrollRuntimeThread) [497,711] cloneNode will often throw exception in versions prior to Honeycomb.
   </li>
<li>Natalie Huynh 2011-12-06

   open to add label</li>
<li>Michael Pettiford 2012-01-04

   Reopening/closing to add/remove labels</li>
</ol>


<p><a href="/TIMOB/TIMOB-4771.json">JSON Source</a></p>