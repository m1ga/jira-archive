---
title: "[TIMOB-5434] Android: require() in a non-root context breaks any include() statements below it."
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-01-09T13:48:17.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-42, Release 1.7.4, Release 1.8.0</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>module_module, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-10-04T18:26:18.000+0000</td></tr>
<tr><th>Updated</th><td>2012-10-24T21:04:40.000+0000</td></tr>
</table>

<h3>Description</h3>

If an app has a second (or third, or fourth...) Javascript execution context (via a window being opened with a <code>url</code> property), a <code>require()</code> statement anywhere in that context will break any <code>include()</code> statements below it.

Reproduction of the failcase (and test of the fix):

In a new app use this app.js:

<code><pre>
Ti.UI.createWindow({
	url: "win.js", // causes new JS context
	backgroundColor: "#000",
	exitOnClose: true
}).open();
</pre></code>

And this win.js:

<code><pre>
require("module"); // Don't need return value, just important that this runs.
Ti.include("included.js");
alert("The included word is " + includedWord);
</pre></code>

And this module.js:

<code><pre>
exports.x = function() {}; //not important
</pre></code>

And this included.js:

<code><pre>
var includedWord = "test";
</pre></code>

When you run that, you'll get an error in the failcase, saying that <code>includedWord</code> is not defined.

When testing the fix, you should see an alert dialog telling you "The included word is test".

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2011-10-04

   Pull request ready:
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/526" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/526</a></li>
<li>Alan Vaghti 2011-10-06

   Closing.
   
   Passed as expected on Nexus One running 2.2.2 with SDK 1.8.0.v20111006001414.</li>
<li>Bill Dawson 2011-10-21

   Re-opening b/c will need to be re-tested with changes coming for TIMOB-5748</li>
<li>Bill Dawson 2011-10-21

   New pull request ready:
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/578" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/578</a></li>
<li>Mark Burggraf 2011-11-11

   This problem is still occurring for me on 1.7.x (both 1.7.5 and the current 1.7.6 build as of Nov 10, 2011).
   
   I am including event handlers into a CommonJS module via Ti.include, but they're not showing up at runtime.</li>
<li>Mark Burggraf 2011-11-11

   I take that back.  The events get included.  However, the included events refer to functions in the main (CommonJS) file, but it can't see them.  I get an error "Cannot find function xxxx in object [object Object]".</li>
<li>Natalie Huynh 2011-12-06

   Tested with 1.8.0.1.v20111205164258 v8/rhino on
   Galaxy 10.1 (3.1)
   Droid 1 (2.2.2)
   Nexus S (2.3.6)
   Emulator (4.0)</li>
<li>Dustin Hyde 2012-01-09

   Added label: qe-testadded.</li>
</ol>


<p><a href="/TIMOB/TIMOB-5434.json">JSON Source</a></p>