---
title: "[TIMOB-5436] iOS: Expose SystemAlert"
---
<table>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2016-10-31T16:16:15.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 6.1.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>qe-6.1.0</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Hans Knöchel</td></tr>
<tr><th>Created</th><td>2011-10-05T02:03:15.000+0000</td></tr>
<tr><th>Updated</th><td>2016-11-17T17:58:56.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Feature</h4>
Not all sounds that an app plays are media, so we should expose the SystemAlert through the Media module. This will let developers choose the most appropriate way to play a sound.

<h4>Example Usage</h4>
<code><pre>
var systemAlert = Ti.Media.createSystemAlert({
    url: 'bad.wav'
});

for (var i = 0; i &lt; 10; i++) {
    systemAlert.play();
    var until = new Date().getTime() + 300;
    while (until &gt; new Date().getTime()) {}
}
</pre></code>

<h4>Example Implementation</h4>
<code><pre>
#import "TiProxy.h"
#import "TiUtils.h"
#import &lt;AudioToolbox/AudioServices.h&gt;

@interface TiMediaSystemAlertProxy : TiProxy {
    NSURL* url;
    TiFile *tempFile;
    SystemSoundID sound;
}
    
@property (nonatomic,readonly) NSURL *url;

-(void)play:(id)args;

@end
</pre></code>

<code><pre>
#import "TiMediaSystemAlertProxy.h"

@implementation TiMediaSystemAlertProxy

#pragma mark Proxy Lifecycle

-(id)init
{
    return [super init];
}

-(void)_destroy
{
    if (sound) {
        AudioServicesDisposeSystemSoundID(sound);
    }
    RELEASE_TO_NIL(url);
    [super _destroy];
}

#pragma mark System Sound

-(NSURL*)url
{
    return url;
}
-(void)setUrl:(id)url_
{
    RELEASE_TO_NIL(url);
    
    if ([url_ isKindOfClass:[NSString class]])
    {
        url = [[TiUtils toURL:url_ proxy:self] retain];
        
        if ([url isFileURL]==NO)
        {
            // we need to download it and save it off into temp file
            NSData *data = [NSData dataWithContentsOfURL:url];
            NSString *ext = [[[url path] lastPathComponent] pathExtension];
            tempFile = [[TiFile createTempFile:ext] retain]; // file auto-deleted on release
            [data writeToFile:[tempFile path] atomically:YES];
            RELEASE_TO_NIL(url);
            url = [[NSURL fileURLWithPath:[tempFile path]] retain];
        }
    }
    else if ([url_ isKindOfClass:[TiBlob class]])
    {
        TiBlob *blob = (TiBlob*)url_;
        //TODO: for now we're only supporting File-type blobs
        if ([blob type]==TiBlobTypeFile)
        {
            url = [[NSURL fileURLWithPath:[blob path]] retain];
        }
    }
    else if ([url_ isKindOfClass:[TiFile class]])
    {
        url = [[NSURL fileURLWithPath:[(TiFile*)url_ path]] retain];
    }
    
    if (sound) {
        AudioServicesDisposeSystemSoundID(sound);
    }
    AudioServicesCreateSystemSoundID((CFURLRef)url, &sound);
}

-(void)play:(id)args
{
    if (url == nil)
        return;
    AudioServicesPlayAlertSound(sound);
}

@end
</pre></code>

<h4>Android Implementation</h4>
I'm not sure what the corresponding feature on Android would be.

<h3>Comments</h3>

<ol>
<li>Flavio De Stefano 2016-09-19

   <a href="https://github.com/appcelerator/titanium_mobile/pull/8396" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/8396</a></li>
<li>Hans Knöchel 2016-10-31

   Test-case for QE:
   <code><pre>
   var systemAlert = Ti.Media.createSystemAlert({
       url: 'test.wav'
   });
    
   var win = Ti.UI.createWindow({
       backgroundColor: "#fff"
   });
   
   var btn = Ti.UI.createButton({
       title: "Play 10 sounds"
   });
   
   btn.addEventListener("click", function() {
   	for (var i = 0; i &lt; 10; i++) {
   	    systemAlert.play();
   	    var until = new Date().getTime() + 300;
   	    while (until &gt; new Date().getTime()) {}
   	}
   });
   
   win.add(btn);
   win.open();
   </pre></code></li>
<li>Harry Bryant 2016-11-17

   Verified as fixed, SystemAlert is now supported on iOS9 & iOS10.
   
   Tested On:
   iPhone 6 Plus 10.1.1 Device & Simulator
   iPhone 5S 9.3.5 Device
   Mac OS Sierra (10.12.1)
   Ti SDK: 6.1.0.v20161116071014
   Appc Studio: 4.8.0.201611121409
   Appc NPM: 4.2.8
   App CLI: 6.1.0-14
   Xcode 8.1
   Node v4.4.7
   
   *Closing ticket.*</li>
</ol>


<p><a href="/TIMOB/TIMOB-5436.json">JSON Source</a></p>