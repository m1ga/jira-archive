---
title: "[TIMOB-5878] Android: Titanium.UI.TextArea does not decode UTF8 character correctly. "
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-04-18T10:38:45.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.3</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.0.2, Release 2.1.0, Sprint 2012-08, Release 1.8.3</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>api, module_textarea, parity, qe-manualtest</td></tr>
<tr><th>Reporter</th><td>Qing Gao</td></tr>
<tr><th>Assignee</th><td>Ping Wang</td></tr>
<tr><th>Created</th><td>2011-10-26T12:36:59.000+0000</td></tr>
<tr><th>Updated</th><td>2014-08-07T22:28:41.000+0000</td></tr>
</table>

<h3>Description</h3>

TextArea does not decode UTF8 character correctly.

<h4>Repro Steps</h4>
Step 1: Open Kitchen Sink on Android 
Step 2: Go to Platform - XHR - UTF-8 + GET/POST

Expected result: The string "€漢字" should be shown in the textarea.
Actual result: Some garbage characters was shown.

<h4>Workaround</h4>
In Javascript code, call the following decode function to decode what returns from HttpClient's responseText.
<code><pre>
var myDecode = function (utftext) {
		var string = "";
		var i = 0;
		var c = c1 = c2 = 0;
 
		while ( i &lt; utftext.length ) {
 
			c = utftext.charCodeAt(i);
 
			if (c &lt; 128) {
				string += String.fromCharCode(c);
				i++;
			}
			else if((c &gt; 191) && (c &lt; 224)) {
				c2 = utftext.charCodeAt(i+1);
				string += String.fromCharCode(((c & 31) &lt;&lt; 6) | (c2 & 63));
				i += 2;
			}
			else {
				c2 = utftext.charCodeAt(i+1);
				c3 = utftext.charCodeAt(i+2);
				string += String.fromCharCode(((c & 15) &lt;&lt; 12) | ((c2 & 63) &lt;&lt; 6) | (c3 & 63));
				i += 3;
			}
 
		}
 
		return string;
}
</pre></code>

<h4>Associated Helpdesk Ticket</h4>
<a href="http://appc.me/c/APP-589719" rel="nofollow" target="_blank">http://appc.me/c/APP-589719</a>
 


<h3>Comments</h3>

<ol>
<li>Ping Wang 2011-10-31

   The sample fails because in Android, the function getResponseText() in TiHTTPClient.java uses charset=HTTP.DEFAULT_CONTENT_CHARSET which is "ISO-8859-1" as the default to encode responseData to a string when the http response doesn't specify a charset. The corresponding iOS code uses "UTF-8" as the default and the sample runs fine in iOS. The HTTP spec says using a default charset value of "ISO-8859-1" in <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.7.1" rel="nofollow" target="_blank">http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.7.1</a> . Need a parity discussion with iOS.</li>
<li>MAIRDUMONT GmbH & Co. KG 2012-03-26

   Uhm... any chances to get this resolved in, let's say, Mobile SDK 2.0?
   Would like to get rid of the decode function for Android.</li>
<li>Natalie Huynh 2012-05-07

   Tested with 2.0.2.v20120505151714 with Samsung Nexus S 4.0.4</li>
</ol>


<p><a href="/TIMOB/TIMOB-5878.json">JSON Source</a></p>