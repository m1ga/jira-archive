---
title: "[TIMOB-5958] Regression: require() for non-CommonJS, when called from a require()d CommonJS, assumes ".js", crashes app"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-01-09T14:37:01.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 1.8.0.1</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>dr-list, regression</td></tr>
<tr><th>Reporter</th><td>Shawn Lipscomb</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2011-11-02T07:17:07.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-19T12:44:27.000+0000</td></tr>
</table>

<h3>Description</h3>

Using SDK 1.8.0.v20111010113820 and later, when a native module is require()d from within a CommonJS module, the following runtime error is generated (immediately upon running the app in the Android emulator):

{panel:title=Error| borderStyle=dashed| titleBGColor=red| bgColor=white}
ReferenceError: "NOT_FOUND" is not defined. (app://com.thirdpartycompany.specialmodule.js#1)
{panel} 

In SDK 1.8.0.v20110913...., there is no problem.

Simply using require() to pull in the native module works fine, as long as it is called from a js file that hasn't been require()d into the app (e.g. app.js).

From the error message (ReferenceError: "NOT_FOUND" is not defined. (app://com.thirdpartycompany.specialmodule.js#1)), it's obvious that Titanium is appending ".js" to the module name, assuming it is a CommonJS module.  But it is a *native* module, so Titanium shouldn't being trying to append ".js" to it.

My "require()" call is like this;

<code><pre>
var SpecialModule=require('com.thirdpartycompany.specialmodule');
</pre></code>

In the Application Installer window, I can see that it found the module:

<code><pre>
[DEBUG] Detecting modules in C:\Titanium\Workspace\MyApp\modules
[DEBUG] Detected module for android: com.thirdpartycompany.specialmodule 1.9 @ C:\Titanium\Workspace\MyApp\modules\android\com.thirdpartycompany.specialmodule\1.9
</pre></code>

According to Bill Dawson:
_...using the require for a native module inside a commonjs module. I can imagine what's happening there -- while executing the commonjs require, rhino likely hijacks "require", meaning our "require" gets ignored so it mises that step that checks first for a native module. I'll find a solution._

Simple sample code:
<code><pre>
var Procs=require('CommonProcs'); // my commonJS unit

var TheWindow=Ti.UI.createWindow({
                  layout:'vertical',
                  exitOnClose:true,
                  navBarHidden:true 
                });
var TheLabel=Ti.UI.createLabel({
        color:'white',
        text:'Hello World',
        font:{fontSize:'18dp',fontFamily:'Helvetica Neue'},
        width:'auto'
     });
TheWindow.add(TheLabel);
                
TheWindow.open();
</pre></code>

<code><pre>
var SpecialModule=require('com.thirdpartycompany.specialmodule');

exports.Foo=function()
{
  SpecialModule.Bar();
};
</pre></code>

I have also attached an actual project example that can be run.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-5958_23988/RequireNativeTest.zip">RequireNativeTest.zip</td></td><td>2011-11-02T07:17:07.000+0000</td><td>377605</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Kevin Whinnery 2011-11-22

   I know we're still working on enabling modules in master, but it would be cool if this one could get worked on shortly after that integration happens.  Thanks...</li>
<li>Bill Dawson 2012-01-05

   @SHAWN can you verify if this is an issue still for you with the production 1.8.0.1?  Thank you</li>
<li>Shawn Lipscomb 2012-01-06

   Bill, I'm trying to get my test project to run on 1.8.0.1.  Can't get the 2.0 version of the AdMod module to work at all (same problem as multiple Q&A posters are having).  I will let you know when I have a result.</li>
<li>Shawn Lipscomb 2012-01-06

   Got it working.  This bug has proven to be fixed in SDK 1.8.0.1 with V8.  Thanks Bill!</li>
<li>Thomas Huelbert 2012-01-19

   closing</li>
</ol>


<p><a href="/TIMOB/TIMOB-5958.json">JSON Source</a></p>