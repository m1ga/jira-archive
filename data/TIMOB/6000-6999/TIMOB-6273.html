---
title: "[TIMOB-6273] Database installation folder issue related to iCloud"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2011-12-06T16:25:33.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.5, Release 1.8.0, Release 1.8.0.1</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2011-49, Release 1.7.6, Release 1.8.0.1</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Qing Gao</td></tr>
<tr><th>Assignee</th><td>Stephen Tramer</td></tr>
<tr><th>Created</th><td>2011-11-21T16:50:09.000+0000</td></tr>
<tr><th>Updated</th><td>2012-02-03T16:09:21.000+0000</td></tr>
</table>

<h3>Description</h3>

Since iOS 5 and iCloud integration Apple has stated that the database should be placed according to iOS Data Storage Guidelines but Ti.Database.install always installs database into the Library/Application Support/database folder. Apple rejects Apps which does not follow this rule. We need to change our SDK accordingly.

<h4>iOS Data Storage Guidelines</h4>
<a href="http://developer.apple.com/icloud/documentation/data-storage/" rel="nofollow" target="_blank">http://developer.apple.com/icloud/documentation/data-storage/</a>

<h4>Associated Helpdesk Tickert</h4>
<a href="http://appc.me/c/APP-316734" rel="nofollow" target="_blank">http://appc.me/c/APP-316734</a>

<h3>Comments</h3>

<ol>
<li>heenok 2011-11-30

   When this bug will be fix ? Really annoying. Thanks.</li>
<li>Stephen Tramer 2011-12-06

   Databases will actually need to be stored in either <code>&lt;Application_Home&gt;/Documents</code> or <code>&lt;Application_Home&gt;/Library/Private Documents</code>. See this QA note: <a href="https://developer.apple.com/library/ios/#qa/qa1719/_index.html" rel="nofollow" target="_blank">https://developer.apple.com/library/ios/#qa/qa1719/_index.html</a></li>
<li>Stephen Tramer 2011-12-06

   <h4>TESTING</h4>
   ----
   
   SIMULATOR:
   
   *NOTE:* Paths for earlier apps which ran the database test may still have the old path in them (<code>Application Support/database</code>). You should clean your simulator apps directory before running this test.
   
   <h4>Launch KitchenSink -> Platform -> Database </h4>
   <h4>Click the buttons on the test and verify output</h4>
   <h4>In the Terminal app on your desktop, go to <code>$HOME/Library/Application Support/iPhone Simulator/5.0/Applications</code></h4>
   <h4>Run the following command: <code>find . -name 'mydb.sql'</code></h4>
   #* All results should include the path <code>Library/Private Documents/mydb.sql</code>
   <h4>Run the following command: <code>find . -name 'quotes.sql'</code></h4>
   #* All results should include the path <code>Library/Private Documents/quotes.sql</code>
   
   DEVICE:
   Run only steps 1 & 2 above
   
   SUBMISSION:
   If possible (i.e. you have a distribution certificate) submit an app which uses databases (this requires manual review from Apple, I assume) and check for any rejection messages containing the following:
   
   {quote}
   We found that your app does not follow the iOS Data Storage Guidelines, which is not in compliance with the App Store Review Guidelines.
   
   In particular, we found that the app is storing too much data in the incorrect location.
   {quote}
   
   </li>
<li>Wilson Luu 2011-12-06

   Closing bug. Verified fix on:
   
   OS: Mac OS X Lion
   Titanium Studio, build: 1.0.7.201112060130
   SDK build: 1.8.0.1.v20111205164258
   Devices: iOS Simulator 4.3, iOS Simulator 5.0, ipod 3rd Gen (4.0.2), iphone 4S (5.0.1), ipad 2 (4.3.5)
   
   Note: Did not test for SUBMISSION. As per Thomas, we do not have anything to submit to the Apple Store.</li>
<li>Qing Gao 2011-12-06

   There are some real cases from customer's Apps approved by Apple in the associated helpdesk ticket.</li>
<li>heenok 2011-12-15

   Do we need to set Library/Private Documents/ with the DNBU flag ? (if yes, how ?)
   
   Thanks.</li>
<li>Stephen Tramer 2011-12-15

   heenok -
   
   You can (and it's recommended). There's a new property on <code>Titanium.Database.DB</code> called <code>file</code>, which returns a <code>Titanium.Filesystem.File</code> object. On this object, you can set the DNBU flag via the <code>remoteBackup</code> property, by setting it to <code>false</code>. Note that this actually prevents ALL backups, not just to iCloud.</li>
<li>Wilson Luu 2011-12-16

   Tested again. Did not find any new bugs. Verified on:
   
   OS: Mac OS X Lion
   SDK build: 1.8.0.1-20111216011148
   Titanium Studio, build: 1.0.7.201112152014
   Devices: iOS Simulator 4.3, iOS Simulator 5.0, iPhone (5.0.1)
   
   Note: Did not test SUBMISSION. QE already submitted an app around the time of this writing.</li>
<li>Martijn Kooij 2011-12-16

   I apologize if I am completely out of order by posting here.
   
   But according to the iOS Data Storage Guidelines:
   "1. Only documents and other data that is user-generated, or that cannot otherwise be recreated by your application, should be stored in the <Application_Home>/Documents directory and will be automatically backed up by iCloud."
   
   shouldn't we at least be able to indicate that our Ti.Database is indeed user-generated and does indeed require to be synced and backed up?</li>
<li>Stephen Tramer 2011-12-16

    Martijn -
    
    This is a feature request. Please feel free to file one.</li>
<li>Martijn Kooij 2011-12-16

    Will do.
    
    Apart from that I think I also found that the migration of an existing database in the Lib/App support/database does not work. After installing my app on my iPhone for testing I had lost all my data and my default "master" database was used instead.
    
    Inspecting the app's data folder showed that the original app support/database db was still there, and a new default database was created in private documents.
    
    1.9.0.v20111216103134</li>
<li>Stephen Tramer 2011-12-16

    Martjin -
    
    Can you file a bug for that as well, along with a test case that you can verify demonstrates the problem?</li>
</ol>


<p><a href="/TIMOB/TIMOB-6273.json">JSON Source</a></p>