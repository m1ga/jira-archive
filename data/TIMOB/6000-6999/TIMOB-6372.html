---
title: "[TIMOB-6372] Android: Back button not closing windows in CommonJS modules"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2011-12-05T13:00:52.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>branch-v8, dr-list</td></tr>
<tr><th>Reporter</th><td>Matthew Apperson</td></tr>
<tr><th>Assignee</th><td>Allen Yeung</td></tr>
<tr><th>Created</th><td>2011-11-29T19:29:13.000+0000</td></tr>
<tr><th>Updated</th><td>2012-01-11T13:32:57.000+0000</td></tr>
</table>

<h3>Description</h3>

Description:
On android app builds and runs correctly, but after the first click, the app ceases to respond to further clicks. This does not occur on Win 7 or Linux 10.04.

Steps to reproduce:
1) Create a new mobile project and replace contents of resources dir with contents of attached zip
2) Launch in android emulator
3) Click the button
4) Click "back" hardware button 
5) Click the button again

Result:
App does nothing with further clicks of the button

Expected:
Each button click opens the second window

Note:
If you add an event listener like so:
<code><pre>
detailContainerWindow.addEventListener('android:back', function(e) {
    detailContainerWindow.close();
});
</pre></code>
The code works as expected

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-6372_24376/Resources 2.zip">Resources 2.zip</td></td><td>2011-11-29T19:29:13.000+0000</td><td>739177</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Matthew Apperson 2011-12-05

   Issue already resolved due to a fix in an unknown ticket</li>
<li>Ivan Skugor 2011-12-09

   Hello.
   
   
   It seems that this issue still exists and is not directly connected to CommonJS.
   
   
   The problem seem to exist when heavyweight window is created and "android:back" event listener is attached to it. Here is my test case:
   
   
   <code><pre>
   var win = Ti.UI.createWindow({
   	fullscreen: true,
   	backgroundColor: '#f00'
   });
   
   var button = Ti.UI.createButton({
   	title: 'Click me!'
   });
   
   button.addEventListener('click', function() {
   	var newWin = Ti.UI.createWindow({
   		modal: true,
   		backgroundColor: '#0f0'
   	});
   	
   	newWin.addEventListener('android:back', function() {
   		Ti.API.debug(typeof newWin.close);
   		Ti.API.debug(typeof this.close);
                   Ti.API.debug(this);
   	});
   	
   	newWin.open();
   });
   
   win.add(button);
   
   win.open();
   </pre></code>
   
   
   Environment on which I'm testing on:
   
   * Titanium SDK version: 1.8.0.1 (12/08/11 23:42 00e9d8f...)
   * Android 3.1 (Thinkpad tablet)
   * Windows XP
   * Titanium Studio, build: 1.0.7.201112080131
   
   
   
   To see the issue, you need to run this example, click on button and then press hardware back-button. You should see that green window didn't close. Furthermore, in DDMS output you should see:
   
   undefined
   function
   [object global]
   
   That is second issue that I noticed, "this" inside window's event handler is wrongly set to global object instead of window object.
   
   
   
   Hope this clears this issue. If you have questions, please let me know.
   
   
   
   Cheers.</li>
<li>Ivan Skugor 2011-12-09

   Further investigation has shown that there exists one more issue - window "close" event is being fired twice.
   
   
   Modified test case looks like this:
   
   <code><pre>
   var win = Ti.UI.createWindow({
   	fullscreen: true,
   	backgroundColor: '#f00'
   });
   
   var button = Ti.UI.createButton({
   	title: 'Click me!'
   });
   
   button.addEventListener('click', function() {
   
   	var newWin = Ti.UI.createWindow({
   		modal: true,
   		backgroundColor: '#0f0'
   	});
   	
   	var newButton = Ti.UI.createButton({
   		title: 'Close me!'
   	});
   	
   	newButton.addEventListener('click', function() {
   		newWin.close();
   	});
   	
   	newWin.addEventListener('close', function() {
   		Ti.API.info('Close event');
   		Ti.API.debug(this);
   	});
   	
   	newWin.add(newButton);
   	
   	newWin.open();
   });
   
   win.add(button);
   
   win.open();
   </pre></code>
   
   
   The output in DDMS:
   
   Close event
   [object global]
   Close event
   [object TiBaseWindow]
   
   
   So, as you can see, "close" event is fired twice and in first case "this" is set to incorrect value.
   
   
   Also, if following line is added to window's "close" event handler:
   
   <code><pre>
   Ti.API.debug(this.close);
   </pre></code>
   
   internal Titanium workings are revealed, which shouldn't be desirable.
   
   
   
   Cheers.</li>
<li>Wilson Luu 2012-01-10

   </li>
<li>Wilson Luu 2012-01-11

   </li>
</ol>


<p><a href="/TIMOB/TIMOB-6372.json">JSON Source</a></p>