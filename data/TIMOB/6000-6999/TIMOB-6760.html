---
title: "[TIMOB-6760] Parity: Inconsistent XHR behavior handling 304 Not Modified status code on Android and iOS"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2017-08-01T22:27:01.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.7.5, Release 1.8.0.1, Release 3.2.0, Release 3.2.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>api, exalture, parity, supportTeam</td></tr>
<tr><th>Reporter</th><td>Eduardo Gomez</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2011-12-19T12:00:59.000+0000</td></tr>
<tr><th>Updated</th><td>2017-08-01T22:27:01.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
There seems to be an issue in XHR handling a 304 Not Modified status code on Android and iOS. 

<h4>On Android the XHR.onerror function is called but on iOS the XHR.onload function is called.</h4>

<h4>Repro sequence</h4>
<code><pre>
var url = "http://localhost:8080/test";
Titanium.API.debug( "Sending GET request to " + url );

var xhr = Titanium.Network.createHTTPClient();

xhr.onload = function()
{
    Titanium.API.debug( "XHR onload()" );
    Titanium.API.debug( xhr );
    Titanium.API.debug( "Response " + xhr.status );
    Titanium.API.debug( "Response text " + xhr.responseText )
};

xhr.onerror = function( e )
{
    Titanium.API.debug( "XHR error()" );
    Titanium.API.debug( xhr );
    Titanium.API.debug( "Response " + xhr.status );
    Titanium.API.debug( "Response text " + xhr.responseText )
    Titanium.API.debug( e );  
};

xhr.open( "GET", url );
xhr.send();
</pre></code>


<h4>iOS logs</h4>

<h4>Here is the GET request and response for the 304 Not Modified status code on iOS:</h4>

{noformat}
GET /test HTTP/1.1
Host: localhost:8080
User-Agent: Appcelerator Titanium/1.8.0.r05ee9f48.d10.17 (iPhone Simulator/5.0; iPhone OS; en_US;)
Accept-Encoding: gzip
X-Requested-With: XMLHttpRequest
Connection: keep-alive

HTTP/1.1 304 Not Modified
Server: Apache-Coyote/1.1
X-Powered-By: Servlet 2.5; JBoss-5.0/JBossWeb-2.1
Cache-Control: no-transform, no-store, no-cache, private
Date: Fri, 16 Dec 2011 20:12:37 GMT
{noformat}


<h4>Here is the output from Titanium Studio on iOS:</h4>

{noformat}
[DEBUG] Sending GET request to http://localhost:8080/test
[DEBUG] XHR onload()
[object TiNetworkClient]
[DEBUG] Response 304
[DEBUG] Response text undefined
{noformat}


<h4>Android logs</h4>

<h4>Here is the GET request and response for the 304 Not Modified status code on Android:</h4>

{noformat}
GET /test HTTP/1.1
X-Requested-With: XMLHttpRequest
User-Agent: 
Host: localhost:8080
Connection: Keep-Alive

HTTP/1.1 304 Not Modified
Server: Apache-Coyote/1.1
X-Powered-By: Servlet 2.5; JBoss-5.0/JBossWeb-2.1
Cache-Control: no-transform, no-store, no-cache, private
Date: Fri, 16 Dec 2011 20:16:23 GMT
{noformat}

<h4>Here is the output from Titanium Studio on Android:</h4>

{noformat}
[INFO] Sending GET request to http://localhost:8080/test
[INFO] XHR error()
[INFO] [Ti.Network.HTTPClient]
[INFO] Response 304
[INFO] Response text 
{noformat}


<h4>Titanium Studio also outputted the following stacktrace on Android:</h4>

{noformat}
E/TiHttpClient(  413): (TiHttpClient-1) [5,5480] HTTP Error (org.apache.http.client.HttpResponseException): Not Modified
E/TiHttpClient(  413): org.apache.http.client.HttpResponseException: Not Modified
E/TiHttpClient(  413):  at ti.modules.titanium.network.TiHTTPClient$LocalResponseHandler.handleResponse(TiHTTPClient.java:222)
E/TiHttpClient(  413):  at ti.modules.titanium.network.TiHTTPClient$LocalResponseHandler.handleResponse(TiHTTPClient.java:182)
E/TiHttpClient(  413):  at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:657)
E/TiHttpClient(  413):  at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:637)
E/TiHttpClient(  413):  at ti.modules.titanium.network.TiHTTPClient$ClientRunnable.run(TiHTTPClient.java:1050)
E/TiHttpClient(  413):  at java.lang.Thread.run(Thread.java:1019)
I/TiHttpClient(  413): (TiHttpClient-1) [5,5485] Sending error Not Modified
D/TiAPI   (  413): (kroll$2: file:///android_asset/Resources/app.js) [3,5488] XHR error()
D/TiAPI   (  413): (kroll$2: file:///android_asset/Resources/app.js) [6,5494] [Ti.Network.HTTPClient]
D/TiAPI   (  413): (kroll$2: file:///android_asset/Resources/app.js) [4,5498] Response 304
D/TiAPI   (  413): (kroll$2: file:///android_asset/Resources/app.js) [2,5500] Response text 
D/TiAPI   (  413): (kroll$2: file:///android_asset/Resources/app.js) [3,5503] {"error":"Not Modified","source":"[Ti.Network.HTTPClient]"}
[INFO] {"error":"Not Modified","source":"[Ti.Network.HTTPClient]"}
{noformat}


<h4>Additional info</h4>
The Apache HTTP Client exception in the Android stack trace caused for any NON 2XX status:

<a href="http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/HttpResponseException.html" rel="nofollow" target="_blank">http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/HttpResponseException.html</a>

2xx series are successful by Status Code Definitions, further reference here: 

<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" rel="nofollow" target="_blank">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>


<h4>Customer's remarks</h4>
"Although Android is throwing the exception the real problem seems to be that on Android XHR.onerror is called when a 304 status code is returned but on iOS XHR.onload is called. Rather than having the same success logic in both methods we ended up reworking our solution to use a 200 OK response since both platforms handle that in the XHR.onload method. Because of the rework of this issue is no longer blocking us. I created the ticket in case other users were seeing similar behavior."


<h4>Associated HD ticket</h4>
APP-163995

<h3>Comments</h3>

<ol>
<li>Don Thorp 2011-12-19

   From the XHR spec: <a href="http://www.w3.org/TR/2009/WD-XMLHttpRequest-20091119/" rel="nofollow" target="_blank">http://www.w3.org/TR/2009/WD-XMLHttpRequest-20091119/</a>
   
   For 304 Not Modified responses that are a result of a user agent generated conditional request the user agent must act as if the server gave a 200 OK response with the appropriate content. The user agent must allow setRequestHeader() to override automatic cache validation by setting request headers (e.g., If-None-Match, If-Modified-Since), in which case 304 Not Modified responses must be passed through. [RFC2616]</li>
<li>Kevin Whinnery 2012-09-10

   This is happening for all non 2xx status codes as of 2.1.2.GA - you can check for error status codes in onload on iOS to work around it, but this is definitely a parity issue worth addressing.</li>
<li>Kevin Whinnery 2012-09-10

   FWIW I think Android is handling this correctly - the onerror callback should be fired for any non 2xx status codes.</li>
<li>Lee Morris 2017-08-01

   Closing due to inactivity. If this issue still exists, please raise a new ticket.</li>
</ol>


<p><a href="/TIMOB/TIMOB-6760.json">JSON Source</a></p>