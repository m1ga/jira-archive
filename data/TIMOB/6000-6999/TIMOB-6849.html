---
title: "[TIMOB-6849] iOS: Application hangs when trying to parse LARGE set of data using JSON.parse()"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2012-03-27T13:47:32.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0.1</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Francisco Antonio Duran Ramirez</td></tr>
<tr><th>Assignee</th><td>Stephen Tramer</td></tr>
<tr><th>Created</th><td>2011-12-22T13:04:21.000+0000</td></tr>
<tr><th>Updated</th><td>2014-06-19T12:43:41.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

Application hangs on parsing Very Lage amount data.

<h4>Reproducible steps:</h4>
 
1. Run the code below
2. See the console

Notice that Titanium still stucks on JSON.parse().

<h4>Expected behavior:</h4>

Customer wants to parse his information.


<h4>Tested with the next specs:</h4>

Simulator
Titanium Studio, build: 1.0.8.201112191627
Titanium SDK: 1.8.0.1.v20111220190134 , 1.8.0.1.RC3, 1.7.5 & 1.9.0.v20111221123134
iOS SDK: 5.0

<code><pre>

[INFO] Application started
[INFO] i13399/1.0 (1.8.0.1.v20111220190134.f3575f8)
[INFO] LOGIN REQUEST WAS SENT: <a href="http://mobilisticstorage.cloudapp.net/login/spoad@acorndistributors.com/c1AxMjM0" rel="nofollow" target="_blank">http://mobilisticstorage.cloudapp.net/login/spoad@acorndistributors.com/c1AxMjM0</a>
[INFO] LOGIN RESPONSE TEXT: "53c0f5e4-d9ff-47e8-9196-95f378786e43"
[INFO] LOGIN RESPONSE OBJECT: 53c0f5e4-d9ff-47e8-9196-95f378786e43
[INFO] GET DATA REQUEST WAS SENT: <a href="http://mobilisticstorage.cloudapp.net/dashboard/salesperson?apikey=53c0f5e4-d9ff-47e8-9196-95f378786e43" rel="nofollow" target="_blank">http://mobilisticstorage.cloudapp.net/dashboard/salesperson?apikey=53c0f5e4-d9ff-47e8-9196-95f378786e43</a>
[INFO] GET DATA RESPONSE TEXT LENGTH: 5439224
</pre></code>

<code><pre>

[INFO] Application started
[INFO] i13399/1.0 (1.8.0.1.RC3.c903964)
[INFO] LOGIN REQUEST WAS SENT: <a href="http://mobilisticstorage.cloudapp.net/login/spoad@acorndistributors.com/c1AxMjM0" rel="nofollow" target="_blank">http://mobilisticstorage.cloudapp.net/login/spoad@acorndistributors.com/c1AxMjM0</a>
[INFO] LOGIN RESPONSE TEXT: "53c0f5e4-d9ff-47e8-9196-95f378786e43"
[INFO] LOGIN RESPONSE OBJECT: 53c0f5e4-d9ff-47e8-9196-95f378786e43
[INFO] GET DATA REQUEST WAS SENT: <a href="http://mobilisticstorage.cloudapp.net/dashboard/salesperson?apikey=53c0f5e4-d9ff-47e8-9196-95f378786e43" rel="nofollow" target="_blank">http://mobilisticstorage.cloudapp.net/dashboard/salesperson?apikey=53c0f5e4-d9ff-47e8-9196-95f378786e43</a>
[INFO] GET DATA RESPONSE TEXT LENGTH: 5439224
</pre></code>

<code><pre>

[INFO] Application started
[INFO] i13399/1.0 (1.7.5.ab20af7)
[INFO] LOGIN REQUEST WAS SENT: <a href="http://mobilisticstorage.cloudapp.net/login/spoad@acorndistributors.com/c1AxMjM0" rel="nofollow" target="_blank">http://mobilisticstorage.cloudapp.net/login/spoad@acorndistributors.com/c1AxMjM0</a>
[INFO] LOGIN RESPONSE TEXT: "53c0f5e4-d9ff-47e8-9196-95f378786e43"
[INFO] LOGIN RESPONSE OBJECT: 53c0f5e4-d9ff-47e8-9196-95f378786e43
[INFO] GET DATA REQUEST WAS SENT: <a href="http://mobilisticstorage.cloudapp.net/dashboard/salesperson?apikey=53c0f5e4-d9ff-47e8-9196-95f378786e43" rel="nofollow" target="_blank">http://mobilisticstorage.cloudapp.net/dashboard/salesperson?apikey=53c0f5e4-d9ff-47e8-9196-95f378786e43</a>
[INFO] GET DATA RESPONSE TEXT LENGTH: 5439224
</pre></code>

<h4>Helpdesk</h4>
APP-547691              

 
 

<h3>Comments</h3>

<ol>
<li>Stephen Tramer 2011-12-22

   This is an incoming set of 5MB of data - even parsing this on a desktop machine is slow (even with very, very fast specialized JSON parsers), and for mobile devices, it will be even slower. We can upgrade our JSON parser, but for data of this size, it will not keep the application from "hanging" while it processes a payload this large.
   
   The reason for this is that JSON.parse() is meant to be serialized and synchronous - and Javascript is a serialized and synchronous language. We do have plans to offer threading support in a future release, which will make it possible to perform tasks like JSON deserialization as a background task, 
   
   JSON is generally intended to be used for relatively lightweight datagrams (certainly under 5MB). I'm unsure what the intention behind such a large payload is, but there are some other options for processing:
   
   * Retrieve specific data as requested via SQL queries
   * Cache information locally after an initial retrieval
   * Split data into smaller payloads that can be processed on an "as-needed" basis
   
   If this data must be processed in a complete chunk and cannot be divided in any way, the following is recommended: 
   
   * Present an activity indicator in a window before JSON begins loading, and lock UI activity
   * Parse the JSON
   * Hide the activity indicator and unlock UI
   
   This prevents your app from appearing unresponsive while the data is processed.</li>
<li>Alexander Konovkov 2011-12-24

   Stephen, actually it parses such large data ok, but it fails to iterate through it with four <code>indexOf</code> function calls on each iteration.</li>
<li>Stephen Tramer 2011-12-27

   Alexander -
   
   Sorry, I missed part of the initial bug report. This could be an issue having nothing to do with JSON data but instead the ability to iterate over the parsed object due to its unusually large size. We will be taking a closer look at the problem.</li>
<li>Stephen Tramer 2011-12-28

   Deleted an earlier comment with bad source code. The following works:
   
   <code><pre>
   var jsonStr = '{"foo":"bar"}';
   var jsonObj = {"foo":"bar"};
   
   var xhr = Ti.Network.createHTTPClient();
   xhr.onload = function(e) {
   	Ti.API.info("BEFORE PARSE: "+jsonStr);
   //	var obj = null;
   	var obj = JSON.parse(jsonStr);
   	Ti.API.info("AFTER PARSE: "+obj);
   };
   Ti.API.info("obj->str: "+JSON.stringify(jsonObj));
   Ti.API.info("Outside onload: "+JSON.parse(jsonStr));
   xhr.open('GET', '<a href="http://appcelerator.com" rel="nofollow" target="_blank">http://appcelerator.com</a>');
   xhr.send();
   </pre></code>
   
   Note that if we change the <code>jsonStr</code> to be a bad JSON value (such as <code>"{foo:bar}"</code>) then we throw an exception in the callback which is not properly handled. This leads me to believe two things:
   
   * The 5.2 MB JSON contains an error
   * We need to properly log exceptions during all callbacks and display them in a reasonable fashion</li>
<li>Stephen Tramer 2011-12-28

   I'm currently running jsonlint on the information dump to see if it contains any errors... and it's been running for 40 minutes and still isn't done. I'm going to run it through a specialized parsing/validation tool, but do not expect it to run any faster.
   
   This is on a 2GHz Intel Core i7; significantly faster than any mobile device.
   
   This ticket may be marked as INVALID based on the results of a specialized parser run. It's also worth noting that we would have to upgrade to a new version of JSCore with completely rewritten JSON processing internals to make any speed improvements.</li>
<li>Stephen Tramer 2011-12-28

   After running for over an hour, jsonlint produced the following error:
   
   <code><pre>
   Error: Parse error on line 1:
   ...iseTotal":21.7111000
   -----------------------^
   Expecting '}', ','
   </pre></code>
   
   Either it ran out of buffer space (possible) or there is an actual JSON error.</li>
<li>Stephen Tramer 2011-12-28

   Resolving as invalid as per issues with the JSON payload and amount of processing time required to handle it under any circumstances.
   
   It is worth noting that most libraries which ship with a test for a "large" JSON payload consider such a payload to be around 9kb.</li>
<li>Thomas Huelbert 2012-01-23

   closing based on Stevens comments</li>
</ol>


<p><a href="/TIMOB/TIMOB-6849.json">JSON Source</a></p>