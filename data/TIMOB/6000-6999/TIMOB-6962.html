---
title: "[TIMOB-6962] Android: Media - AudioPlayer continues downloading the file even after stop or destroying the object"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Critical</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Invalid</td></tr>
<tr><th>Resolution Date</th><td>2012-02-10T00:06:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>n/a</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>tc-more-info</td></tr>
<tr><th>Reporter</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Assignee</th><td>Opie Cyrus</td></tr>
<tr><th>Created</th><td>2011-12-29T23:02:09.000+0000</td></tr>
<tr><th>Updated</th><td>2012-02-10T00:06:27.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>PROBLEM DESCRIPTION</h4>
If you create an AudioPlayer, it will continue downloading the file, even if you stop the player, or actually even if you destroy the player. 

<h4>EXPECTED RESULTS</h4>
If the AudioPlayer is set to null, should not continue downloading the file while waiting for Garbage collecting. 

<h4>ACTUAL RESULTS</h4>
The player continues downloading the file, even if was set to null.

<h4>TEST CASE</h4>

<h4>Paste the code into app.js</h4>
<h4>Run it into Android</h4>
<h4>Press Play. Check the message "General Available Memory". </h4>
<h4>Pause the player. You will see that the General Available Memory it will be down by 24 bytes (or so), each 5 seconds.</h4>
<h4>Press "Delete" button. The player will be set to null.</h4>

<code><pre>
var win = Titanium.UI.createWindow();

var sound = Titanium.Media.createAudioPlayer({url:'<a href="http://www.wav-sounds.com/answering_machine/rappin.wav" rel="nofollow" target="_blank">http://www.wav-sounds.com/answering_machine/rappin.wav</a>'});

sound.addEventListener('progress',function(){
	Ti.API.info("Available Memory:"+Ti.Platform.getAvailableMemory());
});

//
// PLAY
//
var play = Titanium.UI.createButton({
	title:'Play',
	height:40,
	width:145,
	left:10,
	top:10
});
play.addEventListener('click', function()
{
	sound.play();
});
win.add(play);

//
// PAUSE
//
var pause = Titanium.UI.createButton({
	title:'Pause',
	height:40,
	width:145,
	right:10,
	top:10
});
pause.addEventListener('click', function()
{
	sound.pause();
});
win.add(pause);

//
// STOP
//
var stop = Titanium.UI.createButton({
	title:'Stop',
	height:40,
	width:145,
	right:10,
	top:60
});
stop.addEventListener('click', function()
{
	sound.stop();
});
win.add(stop);

var bdelete = Titanium.UI.createButton({
	title:'Delete',
	height:40,
	width:145,
	left:10,
	top:60
});
bdelete.addEventListener('click', function()
{
	sound = null; 
});
win.add(bdelete);

setInterval(function(){
	Ti.API.info("General Available Memory:"+Ti.Platform.getAvailableMemory());
	}, 5000);

win.open();

</pre></code>



<h3>Comments</h3>

<ol>
<li>Paul Dowsett 2011-12-30

   Mauro, thanks for raising this. Would you please complete the environment field, in accordance with the [JIRA Ticket Checklist](<a href="https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-JIRATicketChecklist)?" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-JIRATicketChecklist)?</a> Then I can move this to the main project.
   
   Thank you</li>
<li>Neeraj Gupta 2012-01-03

   We should not put "community" as a customer as many of our bugs are reported by community and this field indicates customer priority issues.</li>
<li>Opie Cyrus 2012-01-06

   There is a fix for this ticket being made which addresses the failure of calls to destroy() not actually stopping the download for remote source.  That having been said, setting the player to null is not a valid mechanism for stopping the active media player.  A developer should call destroy() in order to shutdown the player correctly rather than just setting the player to null.
   
   When pausing the player, the media player implementation itself within Android may continue to buffer content which can explain the the memory footprint described .
   
   When testing the change, please change the handle for the "Destroy" button click to:
   <code><pre>
   sound.destroy();
   sound = null; 
   </pre></code>
   </li>
<li>Opie Cyrus 2012-01-06

   Upon further review, there is actually no platform change required.  Against current master, the memory foot print behaves correctly when calling release() on the AudioPlayer without any additional changes.  Please use release() rather than destroy() mentioned above as this is more consistent with the the other player management calls on Android.</li>
<li>Mauro Parra-Miranda 2012-01-06

   </li>
<li>Opie Cyrus 2012-01-06

   It should also be noted that there is an upcoming fix for general GC behavior but as you cannot guarantee when a GC occurs, this behavior (setting player to null) should not be depended upon for shutting down media players and cleaning up resources.  It should be noted that on V8, when the player is released the reported footprint stays almost completely static (droid2 2.2).</li>
</ol>


<p><a href="/TIMOB/TIMOB-6962.json">JSON Source</a></p>