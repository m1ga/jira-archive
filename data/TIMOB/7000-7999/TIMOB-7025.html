---
title: "[TIMOB-7025] iOS: CommonJS - JavaScript module require()d by a url-based Window can't see Ti.Network"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2018-03-12T14:24:53.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0.1, Release 3.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Shawn Lipscomb</td></tr>
<tr><th>Assignee</th><td>Ingo Muschenetz</td></tr>
<tr><th>Created</th><td>2012-01-06T10:39:56.000+0000</td></tr>
<tr><th>Updated</th><td>2018-03-12T15:55:10.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
A CommonJS (JavaScript) module which is require()d by a url-based Window (a window created with the 'url' property) from inside of that window's 'open' event tries to access Ti.Network.online, but instead a runtime error is produced:
<code><pre>
[ERROR] Script Error = Result of expression 'Ti.Network' [undefined] is not an object.
</pre></code>
Please see the attached project (code repeated at the bottom of this description).  It's a 5-step process to expose this error.  The attached code has been minimized down from an actual project, so while it may look weird and seem to contain unnecessary steps, keep in mind that this is an excerpt from a real project with a real problem.  I have reduced it down to the bare minimum necessary to reproduce the problem.

The normal workaround of adding a reference to "Ti.Network" in app.js does *not work* in this case.

Another problem that is evident in the example:
- In app.js, you shouldn't have to reference "Ti.App" to get past the use of Ti.App in deep.js, but without that line in app.js, you get the same "undefined" error on Ti.App.

The problem does *not occur on Android*...the app works fine.

<h4>Steps to Reproduce</h4>
- Unzip the attached project and run it to the iPhone simulator.
- Look at the console log.
- Right after "** trying Network", you will see this error
<code><pre>
[ERROR] Script Error = Result of expression 'Ti.Network' [undefined] is not an object.
</pre></code>

<h4>Expected Result</h4>
The app should run without error and give the console message "** Network is there!".

<h4>Testcase Code</h4>
<code><pre>
var Sequencer=require('Sequencer');
Sequencer.SetML('deep',require('deep'));

Ti.App; // without this here, the Ti.App in deep.js crashes.
Ti.Network; // this workaround doesn't work.

var w1=Ti.UI.createWindow({url:'win1.js'});
w1.Sequencer=Sequencer;
w1.open();
</pre></code>
<code><pre>
Ti.API.info('** Loading Sequencer');

exports.ML={};


exports.SetML=function(Prop,Val)
{
  exports.ML[Prop]=Val;
};


exports.GetML=function()
{
  return exports.ML;
};
</pre></code>
<code><pre>
exports.RegisterWindowLoadEvent=function(TheWindow,OnLoadEvent)
{
  Ti.App.CurrentWindow=TheWindow;
  Ti.App.CurrentWindow.addEventListener('open',OnLoadEvent);
};
</pre></code>
<code><pre>
var Sequencer=Ti.UI.currentWindow.Sequencer;
deep=Sequencer.GetML().deep;

deep.RegisterWindowLoadEvent(Ti.UI.currentWindow,MainWinLoad);


function MainWinLoad()
{
  Ti.API.info('** MainWinLoad');
  Ti.API.info('** step 1');
  var Killer=require('win2');
  Ti.API.info('** step 2');
}
</pre></code>

<code><pre>
Ti.API.info('** trying Network');
  if (Ti.Network.online)
    Ti.API.info('** Network is there!');
Ti.API.info('** done trying Network');
</pre></code>


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-7025_24955/TiNamespaceTest.zip">TiNamespaceTest.zip</td></td><td>2012-01-06T10:39:56.000+0000</td><td>745908</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Shawn Lipscomb 2012-01-06

   </li>
<li>Paul Dowsett 2012-01-06

   If only all tickets were as well defined as this! Thank you, Shawn, I have escalated it immediately. :)</li>
<li>Shawn Lipscomb 2012-01-07

   Thanks, Paul.  It took me 1 whole work day to reduce this down to a small reproducable case from the actual project...it gave me one hell of a headache.</li>
<li>Stephen Tramer 2012-02-07

   Note that the following version of <code>win1</code> *does* work, for the same reasons that the above <code>app.js</code> does (namely, it preloads the module into the right context):
   
   <code><pre>
   var Sequencer=Ti.UI.currentWindow.Sequencer;
   deep=Sequencer.GetML().deep;
   
   Ti.Network; // Pre-loads Ti.Network into this context
   deep.RegisterWindowLoadEvent(Ti.UI.currentWindow,MainWinLoad);
   
   
   function MainWinLoad()
   {
     Ti.API.info('** MainWinLoad');
     Ti.API.info('** step 1');
     var Killer=require('win2');
     Ti.API.info('** step 2');
   }
   </pre></code>
   
   The problem is that the require()d module has its *page* in the context in which it was evaluated, which in this case, is always <code>app.js</code>. But the module is *executed* in <code>win1.js</code> and that's where the discrepancy comes from. This can only really be resolved by moving to single context, either within the app or changing the iOS infrastructure.
   
   Currently there is still the restriction that modules must be require()ed in the context in which they are evaluated.</li>
<li>Shameer Jan 2013-04-19

   Issue reproduces 
   
   Tested with
   
   Titanium Studio, build: 3.0.1.201212181159
   Titanium SDK version: 3.1.0 
   Titanium SDK version: 3.0.2 
   iOS iPhone Simulator: iOS SDK version: 6.0
   </li>
<li>Rene Pot 2018-03-12

   url-based window is no longer supported</li>
</ol>


<p><a href="/TIMOB/TIMOB-7025.json">JSON Source</a></p>