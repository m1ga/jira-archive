---
title: "[TIMOB-7030] iOS: TableView - click event contains incorrect data when searchbar filter active"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-04-02T20:14:29.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.6.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.0.0, Sprint 2012-06</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>module_tableview, qe-testadded</td></tr>
<tr><th>Reporter</th><td>James David Low</td></tr>
<tr><th>Assignee</th><td>Blain Hamon</td></tr>
<tr><th>Created</th><td>2011-12-07T06:25:34.000+0000</td></tr>
<tr><th>Updated</th><td>2012-11-07T18:33:43.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

TableView click event has wrong data when you are current running a seach and then click the detail button. If you do a search in TableView and click the detail button of the first search result it will give you the rowData from the first row when there is no search. If you tap the row itself it gives you the correct data. I have tracked this down to TiUITableView.m (see patch below).

<h4>Test Case</h4>

TableTest.zip:

Included a full demo app that shows the problem in action. Instructions for running:
<h4>Run in iPhone simulator</h4>
<h4>Click a table row detail button to show it by default shows the correct values</h4>
<h4>Type "third" in the search bar for the table view</h4>
<h4>Click the table row detail button to show that when searching it shows the wrong data when searching</h4>

<code><pre>
var tabGroup = Ti.UI.createTabGroup();
var win = Ti.UI.createWindow({});
var tab = Ti.UI.createTab({
  title: 'Table Test',
  window: win
});

var data = [
  {title: 'First Row', hasDetail: true},
  {title: 'Second Row', hasDetail: true},
  {title: 'Third Row', hasDetail: true},
  {title: 'Forth Row', hasDetail: true},
  {title: 'Fifth Row', hasDetail: true}
];

var search = Ti.UI.createSearchBar({
  returnKeyType: Ti.UI.RETURNKEY_DONE
});

var tableView = Ti.UI.createTableView({
  data: data,
  search: search
});

tableView.addEventListener('click', function (e) {
  alert('Click Event. index: ' + e.index + ', Title: ' + e.row.title);
});
win.add(tableView);
tabGroup.addTab(tab);
tabGroup.open();
</pre></code>

<h4>Solution</h4>

<code><pre>
- (void)tableView:(UITableView *)ourTableView accessoryButtonTappedForRowWithIndexPath:(NSIndexPath *)indexPath
{
	BOOL search = NO;
	if (allowsSelectionSet==NO || [ourTableView allowsSelection]==NO)
	{
		[ourTableView deselectRowAtIndexPath:indexPath animated:YES];
	}
	if(ourTableView != tableview)
	{
		search = YES;
	}
	[self triggerActionForIndexPath:indexPath fromPath:nil tableView:ourTableView wasAccessory:YES search:search name:@"click"];
}
</pre></code>

<h4>Logs</h4>

See attached build log


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-7030_24970/build.log">build.log</td></td><td>2012-01-08T15:51:27.000+0000</td><td>1068547</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-7030_24969/TableTest.zip">TableTest.zip</td></td><td>2012-01-08T15:39:27.000+0000</td><td>2319864</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-7030_24971/TiUITableView.m">TiUITableView.m</td></td><td>2012-01-08T15:51:27.000+0000</td><td>66407</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>James David Low 2011-12-07

   When you click accessory buttons when you're running a search on a table view, the wrong row data is passed to the click event. This is because unlike the main click delegate (didSelectRowAtIndexPath) it does not take into account that a search is currently being run.
   
   This has been around since at least 1.4.0 or so, maybe even earlier. I keep changing my local code in ever new version of Titanium that is released. Its a few line fix so would be really good if it was fixed in the Titanium master code.
   
   I've filled in a pull request here: <a href="https://github.com/appcelerator/titanium_mobile/pull/866" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/866</a>
   
   I also filled in the form for contributing to the Titanium project quite a while a go with my github id jamesdlow</li>
<li>James David Low 2011-12-07

   I'm also actually a paying titanium member, but jira wouldn't let me raised this against the TIMOB project directly.</li>
<li>Paul Dowsett 2011-12-28

   James
   
   Thanks for raising this ticket, and for your efforts in creating a patch.
   
   In order for me to escalate it to the core team, however, and also accept the Pull Request, all the fields in this ticket must be complete. Please check it against the [JIRA Ticket Checklist](<a href="https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-JIRATicketChecklist)" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-JIRATicketChecklist)</a>, and add any missing information.
   
   Furthermore, a simple test case must be included and run without modification, as per the [Creating a Test Case](<a href="https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-CreatingaTestCase)" rel="nofollow" target="_blank">https://wiki.appcelerator.org/display/guides/How+to+Submit+a+Bug+Report#HowtoSubmitaBugReport-CreatingaTestCase)</a> section.
   
   I will mark this resolved for now. Please reopen it once it is complete, and I will move it to the main project.
   
   Cheers</li>
<li>James David Low 2012-01-08

   Hi,
   I've updated with the requested info.
   
   Thanks,
   James</li>
<li>Paul Dowsett 2012-01-08

   Thank you very much for this, James, I'm moving it across.
   </li>
<li>Paul Dowsett 2012-01-08

   Apologies, would you complete the environment field, and then I will definitely be able to move it! ;)
   Most importantly, what version of ios have you seen this issue with, and have you tested in the simulator, and/or seen it on a device?
   
   Thanks</li>
<li>James David Low 2012-01-08

   Hi Paul, Updated with the relevant information. It has basically affected all version of Titanium/iOS since I've started using it.</li>
<li>Paul Dowsett 2012-01-09

   Thanks, James. I will move it over but, for completeness, I was hoping for the device that you have tested it on. If that's just the simulator, would you state that?
   
   Thanks</li>
<li>James David Low 2012-01-09

   Oh its not just the simulator. On my app that I've implemented a fix for its run the most on iOS 4.3 and 5.0 and mainly using Titanium 1.7.3, but I've been manually updating TiUITableView.m with this fix every time a new SDK is released at least since 1.6.0.</li>
<li>James David Low 2012-01-09

    Oh its not just the simulator. On my app that I've implemented a fix for its run the most on iOS 4.3 and 5.0 and mainly using Titanium 1.7.3, but I've been manually updating TiUITableView.m with this fix every time a new SDK is released at least since 1.6.0.</li>
<li>Stephen Tramer 2012-03-12

    Assigning to Blain, as he is in charge of processing the pull request.</li>
<li>Blain Hamon 2012-03-12

    Community pull #866 processed. Credit to James Low.</li>
<li>Wilson Luu 2012-03-15

    Closing bug. Verified fix on:
    
    SDK build: 2.0.0.v20120315123246
    Titanium Studio, build: 2.0.0.201203142055
    xcode: 4.2
    Device: iphone 4s (5.0.1)</li>
<li>Michael Pettiford 2012-04-02

    Reopening/closing to add/remove labels</li>
</ol>


<p><a href="/TIMOB/TIMOB-7030.json">JSON Source</a></p>