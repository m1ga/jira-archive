---
title: "[TIMOB-7396] iOS: Annotation eventListener firing only twice"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-04-04T09:41:02.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.0.1, Release 2.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.0.0, Sprint 2012-06</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>module_map, parity, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Francisco Antonio Duran Ramirez</td></tr>
<tr><th>Assignee</th><td>Sabil Rahim</td></tr>
<tr><th>Created</th><td>2012-01-25T11:01:20.000+0000</td></tr>
<tr><th>Updated</th><td>2012-04-04T09:41:02.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

Annotation eventListener firing only twice

<h4>Reproducible steps:</h4>

1. Run the code below in iOs.
Please see the attached video: iOS-1.9.0.v20120111233134 CI Build-5.0.1 iOS SDK

2. Run the code below in Android
Please see the attached video: Android-1.9.0.v20120111233134 CI Build-Android 2.3.3

Notice that in Android. You can press the Detail button several times, and the message of the alert
is still appearing.

<h4>Expected behavior:</h4>

Customer wants to have the same behavior in iOS like the video:
Android-1.9.0.v20120111233134 CI Build-Android 2.3.3

<h4>Tested with the next specs:</h4>

Simulator
Android version : 2.3.3

iPhone 4
Version of the device: 5.0.1

Titanium Studio, build: 1.0.9.201201240756
Titanium SDK: 1.8.0.1 & 1.9.0.v20120111233134

Samsung Fit
Android version of the device: 2.2.1

<h4>Code:</h4>
<code><pre>
var win = Ti.UI.createWindow(
{
	title : 'Annotations'
});

var addButton= Ti.UI.createButton(
{
	style : Ti.UI.iPhone.SystemButton.PLAIN,
	title : 'Add Annotation',
	color : 'black',
	width : 130,
	height : 32,
	top:5
	
});

var myMap = Titanium.Map.createView(
{
	mapType : Titanium.Map.STANDARD_TYPE,
	region : {latitude: 37, longitude: -97,latitueDelta: 10, longitudeDelta: 10},
	animate : true,
	regionFit : true,
	userLocation : false,
});

win.add(myMap);
win.add(addButton);

addButton.addEventListener('click', function()
{
	var x = 10
	var lat = 37.422502;
	var lon = -122.08554998;
		
	for(i = 0; i &lt; x; i++)
	{	
		var myButton = Ti.UI.createButton(
		{
			//style : Ti.UI.iPhone.SystemButton.INFO_DARK,
			title : 'Detalis',
			height : 32,
			width : 70,
			id : i
		});
		
		myButton.addEventListener('click', function()
		{
			alert(this.id);
		});
		
		var myAnnotation = Ti.Map.createAnnotation(
		{
			latitude : lat,
			longitude : lon,
			title : 'Google HQ   ',
			subtitle : 'sdfsda',
			animate : true,
			pincolor : Ti.Map.ANNOTATION_RED,
			leftView : myButton
		});

		myMap.addAnnotation(myAnnotation);
		
		lat += 1.3*0.3;
		lon += 2.5*0.1;
	}
});

win.open();

</pre></code>


<h4>Helpdesk</h4>
APP-526569
           

 

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-7396_25321/Android-1.9.0.v20120111233134 CI Build-Android 2.3.3.mov">Android-1.9.0.v20120111233134 CI Build-Android 2.3.3.mov</td></td><td>2012-01-25T11:01:20.000+0000</td><td>6528702</td></tr>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-7396_25320/iOS-1.9.0.v20120111233134 CI Build-5.0.1 iOS SDK.mov">iOS-1.9.0.v20120111233134 CI Build-5.0.1 iOS SDK.mov</td></td><td>2012-01-25T11:01:20.000+0000</td><td>2360545</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Francisco Antonio Duran Ramirez 2012-01-26

   <h4>Workaround:</h4>
   <code><pre>
   var win = Ti.UI.createWindow({
   		title : 'Annotations'
   });
   var addButton= Ti.UI.createButton({
   		style : Ti.UI.iPhone.SystemButton.PLAIN,
   		title : 'Add Annotation',
   		bottom : '5dp',
   		color : 'black',
   		width : 130,
   		height : 32,
   		left : 0
   });
   
   
   
   var myMap = Titanium.Map.createView({
   		mapType : Titanium.Map.STANDARD_TYPE,
   		region : {latitude: 37, longitude: -97,
   				 latitueDelta: 10, longitudeDelta: 10},
   		animate : true,
   		regionFit : true,
   		userLocation : false,
   });
   
   win.add(myMap);
   win.add(addButton);
   
   //create an array to store annotations
   var myAnnotations = [];
   
   addButton.addEventListener('click', function(){
   	var x = 10
   	var lat = 37.422502;
   	var lon = -122.08554998;
   		
   	for(i = 0; i &lt; x; i++){	
   		var myButton = Ti.UI.createButton({
   			title : 'Detalis',
   			height : 32,
   			width : 70,
   			id : i
   
   		});
   		myButton.addEventListener('click', function(){
   			alert(this.id);
   		});
   		
   		var myAnnotation = Ti.Map.createAnnotation({
   			latitude : lat,
   			longitude : lon,
   			title : 'Google HQ   ',
   			subtitle : 'sdfsda',
   			animate : true,
   			pincolor : Ti.Map.ANNOTATION_RED,
   			leftView : myButton
   		});
                  //store annotation into array
   		myAnnotations.push(myAnnotation);
   		
   		lat += 1.3*0.3;
   		lon += 2.5*0.1;
   	}
           //add annotation array to map
   	myMap.addAnnotations(myAnnotations);
   });
   
   win.open();
   
   </pre></code></li>
<li>Neeraj Gupta 2012-03-18

   PR #1735 merged.</li>
<li>Sabil Rahim 2012-03-18

   additional test case 
   
   <code><pre>
   var win = Ti.UI.createWindow(
   {
   	title : 'Annotations'
   });
   
   var addButton= Ti.UI.createButton(
   {
   	style : Ti.UI.iPhone.SystemButton.PLAIN,
   	title : 'Add Annotation',
   	color : 'black',
   	width : 130,
   	height : 32,
   	right : 5,
   	top:5
   	
   });
   
   
   var myMap = Titanium.Map.createView(
   {
   	mapType : Titanium.Map.STANDARD_TYPE,
   	region : {latitude: 37, longitude: -97,latitueDelta: 10, longitudeDelta: 10},
   	animate : true,
   	regionFit : true,
   	userLocation : false,
   });
   
   win.add(myMap);
   win.add(addButton);
   
   addButton.addEventListener('click', function()
   {
   	var x = 10
   	var lat = 37.422502;
   	var lon = -122.08554998;
   		
   	for(i = 0; i &lt; x; i++)
   	{	
   		var myButton = Ti.UI.createButton(
   		{
   			//style : Ti.UI.iPhone.SystemButton.INFO_DARK,
   			title : 'Detalis',
   			height : 32,
   			width : 70,
   			id : i
   		});
   		
   		myButton.addEventListener('click', function()
   		{
   			alert(this.id);
   		});
   		
   		var myAnnotation = Ti.Map.createAnnotation(
   		{
   			latitude : lat,
   			longitude : lon,
   			title : 'Google HQ   ',
   			subtitle : 'sdfsda',
   			animate : true,
   			pincolor : Ti.Map.ANNOTATION_RED,
   			leftView : myButton
   		});
   
   		myMap.addAnnotation(myAnnotation);
   		
   		lat += 1.3*0.3;
   		lon += 2.5*0.1;
   	}
   });
   var setAnnotationButton = Ti.UI.createButton(
   {
   	style : Ti.UI.iPhone.SystemButton.PLAIN,
   	title : 'Set Annotation',
   	color : 'black',
   	width : 130,
   	height : 32,
   	left : 5,
   	top:5
   	
   });
   win.add(setAnnotationButton);
   setAnnotationButton.addEventListener('click', function()
   {
   	var x = 10
   	var lat = 37.422502;
   	var lon = -122.08554998;
   	
   	var annotationsArray =[];
   	for(i = 0; i &lt; x; i++)
   	{	
   		var myButton = Ti.UI.createButton(
   		{
   			//style : Ti.UI.iPhone.SystemButton.INFO_DARK,
   			title : 'Detalis',
   			height : 32,
   			width : 70,
   			id : i
   		});
   		
   		myButton.addEventListener('click', function()
   		{
   			alert(this.id);
   		});
   		
   		var myAnnotation = Ti.Map.createAnnotation(
   		{
   			latitude : lat,
   			longitude : lon,
   			title : 'Google HQ   ',
   			subtitle : 'sdfsda',
   			animate : true,
   			pincolor : Ti.Map.ANNOTATION_RED,
   			leftView : myButton
   		});
   
   		annotationsArray.push(myAnnotation);
   		
   		lat += 1.3*0.3;
   		lon += 2.5*0.1;
   	}
   	myMap.setAnnotations(annotationsArray);
   });
   var removeAllAnnotationButton = Ti.UI.createButton(
   {
   	style : Ti.UI.iPhone.SystemButton.PLAIN,
   	title : 'Remove Annotation',
   	color : 'black',
   	width : 130,
   	height : 32,
   	top:50
   	
   });
   win.add(removeAllAnnotationButton);
   removeAllAnnotationButton.addEventListener('click', function()
   {
   	myMap.removeAllAnnotations();
   });
   win.open();
   </pre></code></li>
<li>Anshu Mittal 2012-03-19

   Closing bug. Annotation eventListener gets fired any number of times.
   Verified fix on:
   
   SDK build: 2.0.0.v20120319003254
   Titanium Studio, build: 2.0.0.201203182248
   Device: Simulator, Android(v 2.3.3),iPhone 4(v 5.0.1), Nexus1(v 2.2)
   </li>
<li>Michael Pettiford 2012-04-04

   Reopening/closing to add/remove labels</li>
</ol>


<p><a href="/TIMOB/TIMOB-7396.json">JSON Source</a></p>