---
title: "[TIMOB-7474] Android: Support selecting what ABI to target when using V8 runtime."
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-12-21T05:43:49.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.0.2, Release 3.0.0, Release 1.8.3</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.1.3, Release 3.0.0, Sprint 2012-18 Core</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>SupportTeam, core, module_build, qe-review, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Josh Roesslein</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2012-01-30T14:45:13.000+0000</td></tr>
<tr><th>Updated</th><td>2013-01-03T16:00:57.000+0000</td></tr>
</table>

<h3>Description</h3>

Allow developer to specify in tiapp.xml which ABI to support when using V8 runtime.
Currently we always bundle both ABI versions of the native library. If the developer only wishes
to support one ABI version to cut down size of the APK they may choose to do so.

<a href="http://developer.appcelerator.com/question/131313/why-are-both-rhino-and-v8-bundled-in-the-apk" rel="nofollow" target="_blank">http://developer.appcelerator.com/question/131313/why-are-both-rhino-and-v8-bundled-in-the-apk</a>

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-7474_30853/log2.2.0CI.txt">log2.2.0CI.txt</td></td><td>2012-08-29T11:01:50.000+0000</td><td>1084</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2012-08-28

   <h4>Testing Notes</h4>
   
   <h4>Not specifying an ABI</h4>
   
   * Create a new app.
   
   * Build and launch it on a device.  Make sure it runs.  (This step just tests that the most common use case -- not specifying an ABI -- is not broken.)
   
   * Also go down to the command line, navigate to your project's build/android/bin folder, and run <code>unzip -l app.apk</code>.  In the output, make sure you see libraries for both armeabi and armeabi-v7a.  Like in this sample output:
   
   <code><pre>
       11716  08-29-12 01:13   lib/armeabi/libtiverify.so
     5532236  08-29-12 00:20   lib/armeabi/libkroll-v8.so
      393604  08-29-12 00:20   lib/armeabi/libstlport_shared.so
       11768  08-29-12 01:13   lib/armeabi-v7a/libtiverify.so
     5510044  08-29-12 00:20   lib/armeabi-v7a/libkroll-v8.so
      393496  08-29-12 00:20   lib/armeabi-v7a/libstlport_shared.so
   </pre></code>
   
   <h4>Specifying one ABI</h4>
   
   * Edit the tiapp.xml and add the <abi> element to the <android> section and make it look like this:
   
   <code><pre>
   &lt;android xmlns:android="<a href="http://schemas.android.com/apk/res/android" rel="nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"&gt;
   	&lt;abi&gt;armeabi&lt;/abi&gt;
   &lt;/android&gt;
   </pre></code>
   
   * Build and launch the app on device.  Make sure it runs.
   
   * Also go down to the command line, navigate to your project's build/android/bin folder, and run <code>unzip -l app.apk</code>.  In the output, make sure you see libraries for *only* armeabi, *not* armeabi-v7a.  Like in this sample output:
   
   <code><pre>
       11716  08-29-12 01:13   lib/armeabi/libtiverify.so
     5532236  08-29-12 00:20   lib/armeabi/libkroll-v8.so
      393604  08-29-12 00:20   lib/armeabi/libstlport_shared.so
   </pre></code>
   
   <h4>Specifying "all"</h4>
   
   * We also support explicitly specifying "all", which is the same as removing the <abi> element altogether. But test it by replacing "armeabi" with "all" in tiapp.xml's <abi> element.
   
   * Build and run the app, make sure it works.
   
   * Go down to the command line and again run <code>unzip -l app.apk</code> and make sure you see libs for both armeabi and armeabi-v7a, like in the first test above.
   
   <h4>Specifying multiple ABIs, comma-separated.</h4>
   
   * We also support comma-separated list of ABIs to package libs for.  So replace "all" with "armeabi,armeabi-v7a" (no space).
   
   * Build and run, make sure it works.
   
   * Go down to the command line and again run <code>unzip -l app.apk</code> and make sure you see libs for both armeabi and armeabi-v7a, like in the first test above.
   
   </li>
<li>Bill Dawson 2012-08-28

   PR ready
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/2848/" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2848/</a></li>
<li>Josh Roesslein 2012-08-28

   Is extending the android manifest really the only option for specifying the ABIs?
   I think it might be better if we use a property tag. Example:
   
   <code><pre>
       &lt;property name="ti.android.abi"&gt;armabi, armabi-v7a&lt;/property&gt;
   </pre></code>
   </li>
<li>Bill Dawson 2012-08-29

   I'm not putting it in the manifest section, but in the <android> section (not <android><manifest> in other words.)  I know the <android> section has a tendency to look like the manifest because we pre-supply the android xml namespace for convenience in case someone _does_ put in the manifest section.  But its purpose is not solely to house the manifest.  For example, another build-time setting is in there (<tool-api-level>).
   
   <property> tags become runtime SharedPreferences and should only be used if the values are needed at runtime, which is why we support the optional "type" attribute for them.  We may not be 100% consistent about using them only when values are needed at runtime, but it certainly _should_ be that way.</li>
<li>Josh Roesslein 2012-08-29

   Bill, okay that seems logical. Yeah I did confuse the <android> tag as being part of Android's manifest schema.</li>
<li>Josh Roesslein 2012-08-29

   Mauro, please use file attachments for logs so the comments section doesn't explode in length.
   A quick look of the log only seems to show a HTTPClient socket error (possible connection issue?).</li>
<li>Bill Dawson 2012-08-31

   2_1_X cherry-pick PR ready.  *Do not merge until 2.1.2 is released and build/titanium_version.py shows 2.1.3.*
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/2859" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2859</a></li>
<li>Tamila Smolich 2012-09-05

   Verified ability to specify in tiapp.xml which ABI to support when using V8 runtime.
   Now developers can specify one ABI (armeabi or armeabi-v7a) or all ABIs.
   New feature was verified using Bill's test steps by building the app and packaging as well.
   
   Note:
   If the app was built for device with spicifying "all" ABIs, you'll find in /build/android/bin/app.apk\ Folder/lib not only "armeabi" and "armeabi-v7a", but also "x86". I discussed with Josh and this is expected behavior.
   
   
   Verified on:
   Titanium Studio, build: 2.1.2.201208301612
   Titanium SDK, build: 2.1.3.v20120904163110
   OS: Mac OS X Lion 10.7.4</li>
</ol>


<p><a href="/TIMOB/TIMOB-7474.json">JSON Source</a></p>