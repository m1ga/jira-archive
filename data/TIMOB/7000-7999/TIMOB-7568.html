---
title: "[TIMOB-7568] iOS: Using CommonJS Modules in Core Ti SDK"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>New Feature</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-02-13T17:33:13.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.0.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-04, Release 2.0.0, Release 1.8.2</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Dawson Toth</td></tr>
<tr><th>Created</th><td>2012-02-07T14:02:26.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-16T22:02:54.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Feature</h4>
Add support for CommonJS modules to be included in the Titanium Mobile SDK itself, and automatically injected in to the Ti.* namespace.

<h4>Why</h4>
We are now developing several modules to be included in the core distribution that are CommonJS modules. Android has precedent for this (Ti.Yahoo.*), but iOS does not.

<h4>Test</h4>
An example "test.js" could be included in Ti SDK:
<code><pre>
(function (Ti, Titanium, exports) {
    var Test;
    if (Titanium == undefined /* Android */) {
        Test = {};
        exports.bootstrap = function (TiSDK) {
            Ti = Titanium = TiSDK;
            return Test;
        };
    }
    else {
        Test = exports;
    }
    
    Test.retrieveSuccessLabel = function () {
        return Ti.UI.createLabel({
            text: 'Success!', textAlign: 'center',
            color: '#000'
        });
    };
})(Ti, Titanium, exports);
</pre></code>

On Android it would need to be bootstrapped (to follow the existing convention yahoo.js sets forth) in titanium.js:
<code><pre>
Titanium.Test = require('test').bootstrap(Titanium);
</pre></code>
But on iOS it can simply be require'd normally.

It would be used in an app like this:
<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor: '#fff'
});
win.add(Ti.Test.retrieveSuccessLabel());
win.open();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Neeraj Gupta 2012-02-07

   We need this support to integrate ACS CommonJS module.</li>
<li>Dawson Toth 2012-02-08

   PR opened for one solution:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/1373" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/1373</a>
   
   In addition to the changes to TiHost.m and KrollBridge.mm, the following steps need to be taken to include the example CommonJS compiled module in core for iOS:
   
   1. Create a module named "test" with ID "test". All JavaScript must be in assets/test.js.
   2. Compile it and unzip to a temporary directory.
   3. Copy libtest.a to iphone/lib/libtest.a in Titanium Mobile.
   4. Add libtest.a to titanium.xcodeproj.
   5. In site_scons/package.py, duplicate and update line 246 to copy libtest.a to the SDK distribution.
   6. In support/iphone/builder.py, duplicate and update lines 1013-1014 to add a check to copy libtest.a if it does not already exist.
   7. In support/iphone/iphone.py, duplicate and update line 116 to get a reference to libtest.a's path.
   8. In support/iphone/iphone.py, duplicate and update line 122 to copy libcloud.a to generated projects.</li>
<li>Lee Morris 2017-03-16

   Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-7568.json">JSON Source</a></p>