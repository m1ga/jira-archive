---
title: "[TIMOB-7850] Android: Can't upload files via HTTPClient (parity issue)"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-03-12T14:27:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.0.0, Release 1.8.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.0.0, Sprint 2012-06</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>module_network, parity, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Mauro Parra-Miranda</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2012-02-29T13:22:03.000+0000</td></tr>
<tr><th>Updated</th><td>2014-03-13T17:45:14.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
Customer wants to upload a file thru a webservice. When we test this code in iOS, works like a charm. When trying to upload with Android, it fails. (same webservice, user, etc).

<h4>Actual Results</h4>
The file can't be uploaded when running the program from Android

<h4>Expected results</h4>
The app being able to upload files to the webservice

<h4>Test case</h4>

1. Create a new mobile project
2. Paste the code
3. Run it
4. Press "Click" button
5. See the logs

<code><pre>
var win = Titanium.UI.createWindow({
	backgroundColor : '#FFFFFF',
	exitOnClose : true,
	navBarHidden : true
});

var imageView = Titanium.UI.createImageView({
	image : 'KS_nav_ui.png',
	height : '46dp',
	width : '43dp',
	top:'10dp'
});

win.add(imageView);

var button = Titanium.UI.createButton({
	title : 'Click',
	top:'100dp'
});

button.addEventListener('click', function() {
	uploadImage();
});

win.add(button);

win.open();

function uploadImage() {
	var request = '<a href="http://app.cardfiler.com/cardfiler/c/" rel="nofollow" target="_blank">http://app.cardfiler.com/cardfiler/c/</a>' + 'UploadCardPhoto';
	Titanium.API.error('Web Service Call ' + request);

	var req = Titanium.Network.createHTTPClient({
		timeout : 60000,
		onload : function(e) {
			Titanium.API.error('Web Service Response - On Image Upload ' + this.responseText);
			var data = JSON.parse(this.responseText)
			if(data.status == true) {
				Titanium.API.error('uToken is ' + Titanium.App.Properties.getString('uToken'));
				var alertDialog = Titanium.UI.createAlertDialog({
					title : 'Alert',
					message : data,
					buttonNames : ['OK']
				});
				alertDialog.show();
			} /* else {
				Titanium.API.error('Response Status false ' + data.message + ' Code ' + data.code);
				var alertDialog = Titanium.UI.createAlertDialog({
					title : 'Alert',
					message : data,
					buttonNames : ['OK']
				});
				alertDialog.show();
			}*/
		},
		onerror : function(e) {
			Titanium.API.error('Web Service Response - On Error' + this.responseText);
			var alertDialog = Titanium.UI.createAlertDialog({
				title : 'Alert',
				message : Titanium.Locale.getString('internet_connection_not_available'),
				buttonNames : ['OK']
			});
			alertDialog.show();
		}
	});
	req.open('POST', request);
	req.setRequestHeader("ContentType", "multipart/form-data");
	req.send({
		'aToken' : '60113f81-6f06-4acc-8002-2c0066f88619',
		'uToken' : '9c7ab91c-fccd-4282-b611-c5dec7e402d8',
		'fileType' : 2,
		'fileObject' : imageView.toBlob()
	});
}
</pre></code>

<h3>Comments</h3>

<ol>
<li>AvtarSingh Suchariya 2012-03-08

   Replace following code with line no. 68 to 73 
   
   if(Titanium.Platform.name == 'android') {
   
       req.send({
   
           'aToken' : Titanium.Locale.getString('app_token_only'),
   
           'uToken' : Titanium.App.Properties.getString('uToken'),
   
           'fileType' : '2', // Only Change, Added single quote for Android
   
           'fileObject' : blob
   
       });
   
   } else {
   
       req.send({
   
           'aToken' : Titanium.Locale.getString('app_token_only'),
   
           'uToken' : Titanium.App.Properties.getString('uToken'),
   
           'fileType' : 2, // Only Change, No change needed for IPhone
   
           'fileObject' : blob
   
       });
   
   }
   
   </li>
<li>Hieu Pham 2012-03-08

   Thanks for the feedback. PR <a href="https://github.com/appcelerator/titanium_mobile/pull/1610" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/1610</a> is being reviewed. This should be fixed in 2.0 Release and you will no longer need to use that workaround.</li>
<li>Marshall Culpepper 2012-03-11

   This is a side-effect of our Kroll conversion layer. Unfortunately, since <code>req.send</code> accepts an object, we must convert every Number we encounter in the object as a Java Double so we don't lose precision when the data is passed into our Java implementation. In practice, this conversion means that when the Java code does a <code>toString()</code> on the Double object, the result will be <code>2.0</code> for a JS literal of <code>2</code>.
   
   There isn't an easy way for us to solve this unfortunately, short of completely rewriting our binding layer, which we won't have time for in 2.0. Since the workaround of just quoting the value is working for this use case, it's recommend that you use this workaround until we can find a suitable solution
   
   </li>
<li>Allen Yeung 2012-03-12

   </li>
<li>Michael Pettiford 2012-03-19

   Closing issue
   
   Tested with Ti Studio build 2.0.0.201203182248
   Ti Mob SDK 2.0.0.v20120319003254 hash r60b6da4c
   OSX Lion 10.7.3
   Nexus S OS 2.3.6
   
   Verified that this works correctly in v8</li>
<li>jithinpv 2013-11-25

   Anvil test case added.
   PR link:
   <a href="https://github.com/appcelerator/titanium_mobile/pull/5011" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/5011</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-7850.json">JSON Source</a></p>