---
title: "[TIMOB-8494] iOS: MapView - in Ti 1.8.2 stale images are shown when adding new image annotations after removeAllAnnotations()"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Cannot Reproduce</td></tr>
<tr><th>Resolution Date</th><td>2013-04-02T11:25:29.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 1.8.2</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.0.2</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>n/a</td></tr>
<tr><th>Reporter</th><td>Olivier Morandi</td></tr>
<tr><th>Assignee</th><td>Shameer Jan</td></tr>
<tr><th>Created</th><td>2012-03-06T02:33:29.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-21T21:32:56.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

Test scenario:

1. add an annotation with image on the map
2. remove all annotations
3. add a new annotation with different image

Expected:

* Different annotations should show different images

Actual:

* Only the image of the first annotation is shown each time an annotation is added


Offending commit in TiMobile is:
<a href="https://github.com/appcelerator/titanium_mobile/commit/cec61736bb171c6dd05463cf8d8b593dded07fa8" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/commit/cec61736bb171c6dd05463cf8d8b593dded07fa8</a>



<h4>Test case</h4>

<code><pre>
var win = Titanium.UI.createWindow({backgroundColor: 'white'});

var createAnnotationWithImage = function(image) {
	return Ti.Map.createAnnotation({
		latitude:37.390749,
		longitude:-122.081651,
		image: image
	});
};

var mapview = Titanium.Map.createView({
	region: {latitude:37.337681,longitude:-122.038193,animate:true,latitudeDelta:0.04, longitudeDelta:0.04}
});


function update_annotations() {
	mapview.removeAllAnnotations();
	mapview.annotations = [createAnnotationWithImage('image_1.png')];
}

mapview.annotations = [createAnnotationWithImage('image_0.png')];

setTimeout(update_annotations, 4000);

win.add(mapview);

win.open();
</pre></code>



<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-8494_26048/image_0.png">image_0.png</td></td><td>2012-03-06T02:33:30.000+0000</td><td>164</td></tr>
<tr><td><a href="https://jira-attachments.tisdk.com/TIMOB/TIMOB-8494_26049/image_1.png">image_1.png</td></td><td>2012-03-06T02:33:30.000+0000</td><td>234</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Johnny Wong 2012-03-26

   Olivier -- Do you have a workaround for this one in the mean time? We're crushed by this one bug at the moment .... Thanks</li>
<li>Olivier Morandi 2012-03-26

   A possible *temporary* workaround is to revert the commit I mentioned in the ticket in your Ti SDK.
   In other words you open the <code>iphone/Classes/TiMapView.m</code> file under your 1.8.2 sdk and replace line 649:
   
   <code><pre>
   annView = (MKAnnotationView*) [mapView dequeueReusableAnnotationViewWithIdentifier:identifier];
   </pre></code>
   
   with:
   
   <code><pre>
   if (![ann needsRefreshingWithSelection])	  	
   {
       annView = (MKAnnotationView*) [mapView dequeueReusableAnnotationViewWithIdentifier:identifier];	  	
   }
   </pre></code>
   </li>
<li>Olivier Morandi 2012-03-26

   ok my code formatting didn't work, sorry</li>
<li>Ivan Skugor 2012-03-26

   There is edit option here (on a contrary to QA :) ) and code syntax: { code }mycode{ code }. Just remove spaces from "code" tags. :)</li>
<li>Olivier Morandi 2012-03-27

   Thx Ivan, I hate Jira ;-)</li>
<li>Alfred Chiesa 2012-05-24

   I can confirm this is a bug.</li>
<li>Shameer Jan 2013-04-02

   Issue does not reproduces 
   
   Tested with
   
   Titanium Studio, build: 3.0.1.201212181159
   Titanium SDK version: 3.1.0 
   Titanium SDK version: 3.0.2 
   iOS iPhone Simulator: iOS SDK version: 6.0
   </li>
<li>Lee Morris 2017-03-21

   Closing ticket as the issue cannot be reproduced.</li>
</ol>


<p><a href="/TIMOB/TIMOB-8494.json">JSON Source</a></p>