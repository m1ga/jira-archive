---
title: "[TIMOB-9085] iOS: \"this\" value in event listener is set to child component when child component is clicked"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Medium</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-09-12T04:07:28.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-15 Core, Release 3.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>core, module_view, qe-review, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Federico Casali</td></tr>
<tr><th>Assignee</th><td>Neeraj Gupta</td></tr>
<tr><th>Created</th><td>2012-04-27T13:27:46.000+0000</td></tr>
<tr><th>Updated</th><td>2013-11-07T05:52:33.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
"this" value in event listener is set to child component when child component is clicked.

<h4>Steps to reproduce</h4>

<code><pre>
var win = Ti.UI.createWindow({
    backgroundColor: '#000',
    navBarHidden: true
});
 
var view = Ti.UI.createView({ width: '100%', height: '100%', backgroundColor: '#f00' });
 
view.addEventListener('click', function(e){
    Ti.API.info('View click');
    Ti.API.info(this);
});
var button = Ti.UI.createButton({width:150, height:150, title: 'Click me!' });

view.add(button);
win.add(view);

win.open();
</pre></code>

Result: Click on the button and see the output. "this" value produces "[object TiUIButton]".

Expected result: "this" inside event listener should point to UI object to which that listener is attached (the output should produce "[object TiUIView]").

This works as expected on Android.

<h3>Comments</h3>

<ol>
<li>Stephen Tramer 2012-07-17

   Technically both of these behaviors are incorrect according to the JavaScript standard. The <code>this</code> object in a callback should always refer to the callback function itself.</li>
<li>Ivan Skugor 2012-07-18

   Hi Stephen.
   
   
   I don't think that is true. "this" inside function depends on a context from which function is called (if it is not called as a constructor). I don't think it can ever be a function itself. Detailed explanation of "this" value inside function code can be found here: <a href="http://dmitrysoshnikov.com/ecmascript/chapter-3-this/#this-value-in-the-function-code" rel="nofollow" target="_blank">http://dmitrysoshnikov.com/ecmascript/chapter-3-this/#this-value-in-the-function-code</a>
   
   
   Things can get tricky when host objects are involved because nothing is specified. But, if we check how things are implemented in DOM environment, we can see that behavior is exact as this ticket describes:
   
   <code><pre>
   &lt;html&gt;
   
   	&lt;head&gt;
   		&lt;title&gt;Test&lt;/title&gt;
   		&lt;script type="text/javascript"&gt;
   			window.onload = function() {
   
   				var btn = document.getElementById("btn");
   
   				btn.addEventListener('click', function() {
   					alert(this);
   				}, false);
   
   			}
   		&lt;/script&gt;
   	&lt;/head&gt;
   
   	&lt;body id="main"&gt;
   		&lt;button id="btn"&gt;Click me!&lt;/button&gt;
   	&lt;/body&gt;
   
   &lt;/html&gt;
   </pre></code>
   
   If you run this in some browser (except older IEs :D ) and you click on a button, you'll get alert dialog with message: [object HTMLButtonElement]
   
   
   If event is attached to the "body" of HTML document (change to this: var btn = document.getElementById("main"); )
   
   and button is clicked, alert dialog message is: [object HTMLBodyElement]
   
   
   I tested in latest Chrome.
   
   
   
   That seems like the case this ticket describes.
   
   
   Logically, event listener should be attached to host object and "this" value inside that listener should always reference that host object.</li>
<li>Max Stepanov 2012-07-19

   PR merged <a href="https://github.com/appcelerator/titanium_mobile/pull/2593" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2593</a></li>
<li>Anshu Mittal 2012-09-12

   Reopening to update labels</li>
<li>Shameer Jan 2013-11-07

   Anvil testcase PR <a href="https://github.com/appcelerator/titanium_mobile/pull/4887" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4887</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-9085.json">JSON Source</a></p>