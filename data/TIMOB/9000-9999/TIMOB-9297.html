---
title: "[TIMOB-9297] iOS: External (native) module with commonjs file in it can only be built once"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-05-31T20:17:47.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.1.0, Sprint 2012-11 Core</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>core, qe-port</td></tr>
<tr><th>Reporter</th><td>Bill Dawson</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2012-05-29T12:57:15.000+0000</td></tr>
<tr><th>Updated</th><td>2012-08-28T04:43:55.000+0000</td></tr>
</table>

<h3>Description</h3>

If an iOS module project has a file named <code>assets/[moduleid].js</code> then that javascript file is compiled and actually becomes the module itself (in lieu of the native, Objective-C code).  If you create a module project and add such a file, you will only be able to compile the module project one time.

<h4>Fail Case / Test Case</h4>

* Create an iOS module project (not going through those steps here.)  For purposes of this example, let's say the module has the id "ti.testmod".

* Create a JS file <code>assets/[moduleid].js</code>.  In my example, you would create <code>assets/ti.testmod.js</code>.

* Put some miscellaneous <code>exports</code> code in that Js file, such as:

<code><pre>
exports.hello = function() { return "hello world"; };
</pre></code>

* Build the module project.

* Build the module project again.  This second time, it will fail with a bunch of "redefinition of ..." errors.  Example:

<code><pre>

/Users/bill/tmp/mods/barker/Classes/TiBarkerModuleAssets.m:29:16: error: redefinition of 'data'
                static UInt8 data[] = {
                             ^
/Users/bill/tmp/mods/barker/Classes/TiBarkerModuleAssets.m:12:16: note: previous definition is here
                static UInt8 data[] = {
                             ^
/Users/bill/tmp/mods/barker/Classes/TiBarkerModuleAssets.m:37:17: error: redefinition of 'ranges'
        static NSRange ranges[] = {
                       ^
/Users/bill/tmp/mods/barker/Classes/TiBarkerModuleAssets.m:20:17: note: previous definition is here
        static NSRange ranges[] = {
</pre></code>

* If you're testing my fix branch, you should _not_ get the failures, of course.

The reason is that the template-replacement code (where we dump in the results of running titanium prep on the javascript) is slightly wrong and is stacking up the code each time prep is run, rather than replacing the existing code.

<h3>Comments</h3>

<ol>
<li>Bill Dawson 2012-05-29

   PR Ready:
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/2287" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2287</a></li>
<li>Blain Hamon 2012-05-31

   Pull merged</li>
<li>Anshu Mittal 2012-08-28

   Verified on:
   SDK:2.2.0.v20120827143312
   Studio:2.1.2.201208201549
   
   
   Modules with commonjs file in it can be built any number of times successfully.</li>
</ol>


<p><a href="/TIMOB/TIMOB-9297.json">JSON Source</a></p>