---
title: "[TIMOB-9387] Android: close() is ignored when executed from an "open" event handler"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-06-18T12:54:41.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.0.0, Release 2.1.0, Release 2.0.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.1.0, Sprint 2012-12 API</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>api, module_window, qe-testadded, regression</td></tr>
<tr><th>Reporter</th><td>Davide Cassenti</td></tr>
<tr><th>Assignee</th><td>Hieu Pham</td></tr>
<tr><th>Created</th><td>2012-05-18T07:56:57.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-10T06:19:54.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
A call to a window's close() method is ignored when it is executed from that window's "open" event handler.

Works in SDK 1.8.2
Broken in SDK 2.0.2.GA

<h4>Expected behavior</h4>
The window should open for a moment, fully display, and then close.

<h4>Actual behavior</h4>
The window opens, shows, and stays there, as if no close() were called.

app.js:
<code><pre>
var win1 = Ti.UI.createWindow({  
  backgroundColor:'#fff',
  exitOnClose:true,
  navBarHidden:false
});

var label1 = Ti.UI.createLabel({
  color:'#999',
  text:'I am Window 1',
  font:{fontSize:20,fontFamily:'Helvetica Neue'},
  textAlign:'center',
  width:Ti.UI.SIZE,
  top:100
});
win1.add(label1);

var btn1 = Ti.UI.createButton({
  title:'Open 2nd window',
  width:Ti.UI.SIZE,
  left:10,
  top:175
});
function DoBtn1Click()
{
  var win2=Ti.UI.createWindow({
                  url:'win2.js',
                  layout:'vertical',
                  exitOnClose:false,
                  navBarHidden:false
                });
  win2.open();
}
btn1.addEventListener('click',DoBtn1Click);
win1.add(btn1);
win1.open();
</pre></code>

<h4>win2.js:</h4>
<code><pre>var win2=Ti.UI.currentWindow;

Ti.API.info('setting open event handler');
win2.addEventListener('open',Win2Load);
function Win2Load()
{
  Ti.API.info('open event handler executing');
  win2.close();
  Ti.API.info('open event handler done');
}

var label2 = Ti.UI.createLabel({
  color:'red',
  text:'I am Window 2.\nIf you can read this, then the close() failed.',
  font:{fontSize:20,fontFamily:'Helvetica Neue'},
  textAlign:'center',
  width:Ti.UI.SIZE,
  top:100
});
win2.add(label2);

Ti.API.info('end of js code');
</pre></code>

<h4>Additional notes</h4>
By replacing:

<code><pre>
win2.close();
</pre></code>

with this:

<code><pre>
setTimeout(function() {
  win2.close();
}, 500);
</pre></code>

The window closes correctly also in 2.0.2.GA

<h3>Comments</h3>

<ol>
<li>Hieu Pham 2012-06-14

   Another test case: 
   <code><pre>
   var win1 = Ti.UI.createWindow({  
     backgroundColor:'#fff',
     exitOnClose:true,
     navBarHidden:false
   });
    
   var label1 = Ti.UI.createLabel({
     color:'#999',
     text:'I am Window 1',
     font:{fontSize:20,fontFamily:'Helvetica Neue'},
     textAlign:'center',
     width:Ti.UI.SIZE,
     top:100
   });
   win1.add(label1);
    
   var btn1 = Ti.UI.createButton({
     title:'Open 2nd window',
     width:Ti.UI.SIZE,
     left:10,
     top:175
   });
   function DoBtn1Click()
   {
     var win2=Ti.UI.createWindow({
                     //url:'win1.js',
                     layout:'vertical',
                     exitOnClose:false,
                     navBarHidden:false
                   });
                   
     win2.addEventListener('open',Win2Load);
     function Win2Load()
     {
        win2.close();
     }
     win2.open();
   }
   btn1.addEventListener('click',DoBtn1Click);
   win1.add(btn1);
   win1.open();  
   </pre></code>
   
   1. Click on button. You should see another window opens for a split second then closes.</li>
<li>Michael Pettiford 2012-06-18

   Closing issue
   
   Tested with Ti Studio build 2.1.0.201206172244
   Ti Mobile SDK2.1.0.v20120618134156 hash r00905cd0
   OSX Lion 10.7.3
   Nexus S OS 4.0.4
   
   The expected behavior is shown</li>
<li>Shameer Jan 2013-12-10

   Anvil testcase PR <a href="https://github.com/appcelerator/titanium_mobile/pull/4967" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4967</a>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-9387.json">JSON Source</a></p>