---
title: "[TIMOB-9492] iOS: loss of reference to functions using event handlers "
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-07-16T09:39:27.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0, Release 2.0.1</td></tr>
<tr><th>Fix Version/s</th><td>Release 3.0.0, Sprint 2012-19 Core, 2012 Sprint 19</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>core, module_media, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Federico Casali</td></tr>
<tr><th>Assignee</th><td>Max Stepanov</td></tr>
<tr><th>Created</th><td>2012-06-11T17:44:43.000+0000</td></tr>
<tr><th>Updated</th><td>2013-07-16T09:39:27.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem description</h4>
A function defined inside an event listener, without an external reference, fails to be invoked after a few calls.

<h4>Steps to reproduce and sample code:</h4>
1. Run the sample code below.
2. Launch app, tap "Open Camera" button.
3. Tap "Take Photo" button, alert displays for success callback it's correctly triggered.
4. Tap "Take Photo" button again and repeat multiple times to simulate taking photo photos in succession. Success callback does not fire.
5. Tap "Close Camera" button, camera does not close.

<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor: '#efefef',
	title: 'Test'
});

openCameraButton = Ti.UI.createButton({
	style: Ti.UI.iPhone.SystemButtonStyle.BORDERED,
	title: 'Open Camera'
});

openCameraButton.addEventListener('click', function(e) {
	var cameraOverlay = Ti.UI.createView();
	
	var takePhotoButton = Ti.UI.createButton({
		backgroundColor: '#fff',
		backgroundSelectedColor: '#efefef',
		borderColor: '#000',
		borderRadius: 17,
		borderWidth: 1,
		bottom: 65,
		color: '#000',
		height: 34,
		opacity: 0.4,
		title: 'Take Photo',
		width: 100
	});
	
	var closeCameraButton = Ti.UI.createButton({
		backgroundColor: '#fff',
		backgroundSelectedColor: '#efefef',
		borderColor: '#000',
		borderRadius: 17,
		borderWidth: 1,
		bottom: 65,
		color: '#000',
		height: 34,
		opacity: 0.4,
		right: 10,
		title: 'Close Camera',
		top: 10,
		width: 150
	});
	
	takePhotoButton.addEventListener('click', function(e) {
		Ti.Media.takePicture();
	});
	
	closeCameraButton.addEventListener('click', function(e) {
		alert('closing camera');
		Ti.Media.hideCamera();
	});
	
	cameraOverlay.add(takePhotoButton);
	cameraOverlay.add(closeCameraButton);
	
	Ti.Media.showCamera({
		success: function(e) {
			alert('success callback');
		},
		cancel: function() {
			Ti.API.info('cancel callback');
		},
		error: function(e) {
			Ti.API.info('error callback');
		},
		allowEditing: false,
		animated: false,
		autohide: false,
		mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO],
		overlay: cameraOverlay,
		saveToPhotoGallery: false,
		showControls: false
	});
});

win.add(openCameraButton);
win.open();
</pre></code>


<h4>Additional notes</h4>
In the sample code above, objects are defined inside 'openCameraButton.addEventListener' function. 
Moving them outside of the function will solve the problem for this particular case.
Looks like to the references to the objects in the function are lost (maybe after items have been garbage collected).

Tickets references: <a href="http://support.appcelerator.com/tickets/APP-397683" rel="nofollow" target="_blank">http://support.appcelerator.com/tickets/APP-397683</a> and <a href="http://support.appcelerator.com/tickets/APP-499212" rel="nofollow" target="_blank">http://support.appcelerator.com/tickets/APP-499212</a>

<h3>Comments</h3>

<ol>
<li>Max Stepanov 2012-09-13

   PR pending <a href="https://github.com/appcelerator/titanium_mobile/pull/2942" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2942</a></li>
<li>Natalie Huynh 2012-12-04

   Tested with 3.0.0.v20121130200208 on iPhone 4 5.1.1</li>
<li>Priya Agarwal 2013-07-16

   Reopening just to updated label.</li>
<li>Priya Agarwal 2013-07-16

   Updated label.
   Verified with:
   
   Titanium Studio:3.1.2.201307091843
   Titanium SDK: 3.1.2.v20130710144553
   acs:1.0.3
   alloy:1.1.3
   npm:1.2.14
   titanium:3.1.1
   titanium-code-processor:1.0.1
   OS: OSX 10.8
   Device:iphone4(v5.1)
   Xcode: 4.5.1
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-9492.json">JSON Source</a></p>