---
title: "[TIMOB-9502] iOS: Focus and open events don't fire on first window when require() is used"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2013-09-17T21:26:54.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.1.0, Sprint 2012-12 API, 2013 Sprint 19, 2013 Sprint 19 API, Release 3.1.3, Release 3.2.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>api, module_window, qe-testadded, regression, titanbeta, triage</td></tr>
<tr><th>Reporter</th><td>Shawn Lipscomb</td></tr>
<tr><th>Assignee</th><td>Vishal Duggal</td></tr>
<tr><th>Created</th><td>2012-06-12T12:47:48.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-02T09:14:53.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
There is a regression in mobile SDK 2.1.0.v20120608174150 that causes an intermittent failure of open and focus events at the Window level.  Sometimes neither event will fire.  Sometimes the open event fires but the focus event won't.

<h4>Testcase</h4>
Use the sample project that is attached.  This code is reduced down from a much larger app.  I have reduced it down as far as I can and still demonstrate the problem.  You'll notice that much of the code in the require()d and/or include()d units is not executed, but removing it hides the problem.  During testing, I noticed that volume of code seemed to affect the reproducibility of the problem.

Just run the app, and look at the console log.  You may need to run it several times!  In my testing, it failed more often than it succeeded.

<h4>Expected Result</h4>
In the console log you should see:
{panel}
== Loading Procs
== Loading Themes
top
bottom
MainWinLoad fired
MainWinFocus fired from [object Object]
{panel}

<h4>Actual Result</h4>
{panel}
== Loading Procs
== Loading Themes
top
bottom
{panel}

sometimes the "MainWinLoad fired" line will show up, and sometimes the "MainWinFocus fired from [object Object]" line also appears.


<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-9502_28293/FocusOpenMemoryTest.zip">FocusOpenMemoryTest.zip</td></td><td>2012-06-12T12:47:48.000+0000</td><td>128897</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Vishal Duggal 2012-06-13

   Pull pending <a href="https://github.com/appcelerator/titanium_mobile/pull/2385" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2385</a></li>
<li>Shawn Lipscomb 2012-06-15

   HD ticket: [APP-152528](<a href="https://support.appcelerator.com/tickets/APP-152528)" rel="nofollow" target="_blank">https://support.appcelerator.com/tickets/APP-152528)</a></li>
<li>Shawn Lipscomb 2012-06-15

   Verified fixed in SDK 2.1.0.v20120615132253. Thanks!</li>
<li>Michael Pettiford 2012-06-19

   Closing issue
   
   Tested with Ti Studio build 2.1.0.201206172244
   Ti Mobile SDK 2.1.0.v20120618154152 hash r7830c03d
   OSX Lion 10.7.3
   iPhone 4S OS 5.1
   
   The expected behavior is shown</li>
<li>Neha Chhabra 2012-07-12

   Reopening to update labels.</li>
<li>Priya Agarwal 2013-09-17

   Tested Environment:
   
   Appcelerator Studio: 3.1.3.201309132456
   SDK: 3.1.3.v20130916153052
   acs:1.0.6
   alloy:1.2.2-cr
   npm:1.3.2
   titanium:3.1.2
   titanium-code-processo:1.0.2
   OSX: 10.8.4
   Xcode:5.0 GM seed
   Device:ipad3(v7.0),iphone4s(v7.0)and ipodtouch3(v6.1.3)
   
   
   Expected Result on console logs are:
   
   == Loading Procs
   == Loading Themes
   top
   bottom
   MainWinLoad fired
   MainWinFocus fired from [object Object]
   
   Getting the expected console logs with 3.1.2.GA sdk build but with 3.1.3.v20130916153052 build not getting the expected result.
   
   Focus event is not being fired on first window when require() is used.</li>
<li>Olga Romero 2013-09-17

   I do NOT see [INFO] : MainWinFocus fired from [object Object]
   
   The rest is as expected:
   [INFO] : == Loading Procs
   [INFO] : == Loading Themes
   [INFO] : top
   [INFO] : bottom
   [INFO] : MainWinLoad fired
   
   Tested with:
   Appcelerator Studio: 3.1.3.201309132456
   Titanium SDK, build: 3.1.3.v20130916153052
   Mac osx  10.8.4 Mountain Lion
   Xcode5
   alloy@1.2.2-cr
   CLI version : 3.1.2
   Devices: 
   iPhone4(iOS7 GM seed)
   iPhone5 iOS7(11A465)</li>
<li>Vishal Duggal 2013-09-17

   Test Code
   
   <code><pre>
   ########app.js#######
   Ti.UI.backgroundColor = 'white';
   
   var win = Ti.UI.createWindow({
       backgroundColor : "#fff",
       url:'testWin.js',
       title:'URL WINDOW',
       layout:'vertical'
   });
   
   
   var nav = Ti.UI.iOS.createNavigationWindow({
       window:win
   })
   
   win.addEventListener('open',function(){
       Ti.API.info('GOT OPEN EVENT IN MAIN CONTEXT')
   })
   
   win.addEventListener('focus',function(){
       Ti.API.info('GOT FOCUS EVENT IN MAIN CONTEXT')
   })
   
   
   var mainWin = Ti.UI.createWindow();
   
   var btn = Ti.UI.createButton({
       title:'OPEN'
   })
   
   btn.addEventListener('click',function(){
       nav.open();
   })
   
   mainWin.add(btn);
   
   mainWin.open();
   
   
   ########testWin.js########
   
   var curWin = Ti.UI.currentWindow;
   
   var l1 = Ti.UI.createLabel({
   	top:20,
   	text:'WAITING FOR OPEN EVENT'
   })
   
   var l2 = Ti.UI.createLabel({
   	top:10,
   	text:'WAITING FOR FOCUS EVENT'
   })
   
   curWin.add(l1);
   curWin.add(l2);
   
   
   curWin.addEventListener('open',function(){
   	l1.text = 'GOT OPEN EVENT IN URL CONTEXT';
   })
   
   curWin.addEventListener('focus',function(){
   	l2.text = 'GOT FOCUS EVENT IN URL CONTEXT';
   })
   
   </pre></code></li>
<li>Vishal Duggal 2013-09-17

   Pull pending
   
   master - <a href="https://github.com/appcelerator/titanium_mobile/pull/4705" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4705</a>
   3_1_X - <a href="https://github.com/appcelerator/titanium_mobile/pull/4706" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4706</a></li>
<li>Priya Agarwal 2013-09-18

    Verified the fix on:
    
    Appcelerator Studio: 3.1.3.201309132456
     SDK: 3.1.3.v20130917141554 
    acs:1.0.6
     alloy:1.2.2-cr 
    npm:1.3.2
     titanium:3.1.2 
    titanium-code-processo:1.0.3-cr 
    OSX: 10.8.4
     Xcode:5.0 GM seed
     Device: ipod touch2(v7.0)
    
    Using both the code verified the focus and open event of window being fired.
    Hence closing the issue as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-9502.json">JSON Source</a></p>