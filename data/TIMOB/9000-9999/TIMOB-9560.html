---
title: "[TIMOB-9560] iOS: addEventListener via call()/apply() fails with exception"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-07-12T14:48:24.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.0.2</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-14 Core, Release 3.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>core, parity, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Tony Lukasavage</td></tr>
<tr><th>Assignee</th><td>Max Stepanov</td></tr>
<tr><th>Created</th><td>2012-06-14T16:44:35.000+0000</td></tr>
<tr><th>Updated</th><td>2014-01-31T18:45:51.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

When a proxy's <code>addEventListener</code> or <code>removeEventListener</code> is called via Javascript's <code>call()</code> or <code>apply()</code> functions, as demonstrated in Test Case #1, you get the following exception on iOS:

<code><pre>
[ERROR] Script Error = 'undefined' is not a function (evaluating 'al.call(win, 'click', function(e) { alert('clicked window'); })') at app.js (line 5).
</pre></code>

The same call will work fine on Android and Mobileweb. On the other hand, calling these function without the call() function, as demonstrated in Test Case #2, fails on Android:

<code><pre>
[ERROR][TiJSError(  352)] (main) [607,2357] ----- Titanium Javascript Runtime Error -----
[ERROR][TiJSError(  352)] (main) [3,2360] - In ti:/events.js:176,9
[ERROR][TiJSError(  352)] (main) [7,2367] - Message: Uncaught TypeError: Object #<Object> has no method '_hasListenersForEventType'
[ERROR][TiJSError(  352)] (main) [0,2367] - Source: 			this._hasListenersForEventType(type, true);
[ERROR][V8Exception(  352)] Exception occurred at ti:/events.js:176: Uncaught TypeError: Object #<Object> has no method '_hasListenersForEventType'
</pre></code> 

but works on iOS and Mobileweb.

<h4>Test Case #1</h4>

<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor: '#fff'
});
var al = win.addEventListener;
al.call(win, 'click', function(e) { alert('clicked window'); });
// al.apply(win, ['click', function(e) { alert('clicked window'); }]);
win.open();
</pre></code>

<h4>Test Case #2</h4>

<code><pre>
var win = Ti.UI.createWindow({
	backgroundColor: '#fff'
});
var al = win.addEventListener;
al('click', function(e) { alert('clicked window'); });
win.open();
</pre></code>

<h4>Expected Result</h4>

Test Case #1 for calling the <code>addEventListener</code> and <code>removeEventListener</code> functions should function properly on Android, iOS, and Mobileweb with <code>call()</code> and <code>apply()</code>.

<h3>Comments</h3>

<ol>
<li>Jeff Haynie 2012-06-14

   We need to add test case for apply too</li>
<li>Ivan Skugor 2012-06-14

   IMHO, second test case should not work since "var al = win.addEventListener;" unbinds "win" from that function (and changes "this" value to point to global object). Similar thing does not work in DOM environment. 
   
   
   First test case opens Pandora's box. What if you do something like this:
   
   
   <code><pre>
   var win = Ti.UI.createWindow({
       backgroundColor: '#fff'
   });
   var button = Ti.UI.createButton({ title: 'Click me' });
   var al = win.addEventListener;
   al.call(button, 'click', function(e) { alert('clicked button'); });
   win.add(button);
   win.open();
   </pre></code>
   
   Or this:
   
   <code><pre>
   var win = Ti.UI.createWindow({
       backgroundColor: '#fff'
   });
   var customObject = {};
   var al = win.addEventListener;
   al.call(customObject, 'customEvent', function(e) { alert('Test'); });
   win.open();
   </pre></code>
   
   That should work in theory. In practice ... don't know. :)</li>
<li>Tony Lukasavage 2012-06-15

   <code>apply()</code> added in Test Case #1. Ivan , you're probably right, I updated the Expected Result to indicate that Test Case #1 should work for all platforms.</li>
<li>Max Stepanov 2012-07-11

   Complete test cases:
   <code><pre>
   var win = Ti.UI.createWindow({
       backgroundColor: '#fff'
   });
   var al = win.addEventListener;
   
   // test 1
   //al.call(win, 'click', function(e) { alert('clicked window'); });
   
   // test 2
   //al.apply(win, ['click', function(e) { alert('clicked window'); }]);
   
   // test 3
   //al('click', function(e) { alert('clicked window'); });
   
   // test 4
   //Ti.UI.createWindow().addEventListener.call(win, 'click', function(e) { alert('clicked window'); });
   
   // test 5
   //Ti.UI.createWindow().addEventListener.apply(win, ['click', function(e) { alert('clicked window'); }]);
   
   win.open();
   </pre></code></li>
<li>Max Stepanov 2012-07-11

   PR pending <a href="https://github.com/appcelerator/titanium_mobile/pull/2541" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2541</a></li>
</ol>


<p><a href="/TIMOB/TIMOB-9560.json">JSON Source</a></p>