---
title: "[TIMOB-9662] Android: Nested CommonJS Modules Replace Existing CommonJS Modules"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-06-21T11:36:39.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Release 2.1.0, Sprint 2012-13 Core</td></tr>
<tr><th>Components</th><td>Android</td></tr>
<tr><th>Labels</th><td>core, look1, regression</td></tr>
<tr><th>Reporter</th><td>Dawson Toth</td></tr>
<tr><th>Assignee</th><td>Bill Dawson</td></tr>
<tr><th>Created</th><td>2012-06-20T12:43:43.000+0000</td></tr>
<tr><th>Updated</th><td>2017-03-16T22:04:27.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>
When nesting CommonJS modules, module definitions can override existing CommonJS module definitions. This is a regression introduced sometime in the last month, though I do not have a specific point.

<h4>Reproduction</h4>
Attached "NestedConfusionReproduction.zip". Extract it to the Resources directory of an app, and run it on any Android environment. (Note that in this reduced reproduction, moving some of the requires around can avoid this bug. But in larger projects, or more complicated require scenarios, it cannot be so easily avoided.)

<h4>What's Happening Wrong in Reproduction</h4>
The app does the following:

- app.js require's a specific view (ti.cloud.ui/buttons/chooseAPhoto).
- The specific view requires a generic view (ti.cloud.ui/buttons/generic).
- Both views require a single utility module (ti.cloud.ui/utils) and store it in a variable U.

When the generic view's createView method is called, it alerts the U variable. It also alerts a fresh require of the utility module. The expected behavior is these two would output the same thing, right? But the alert shows that both are messed up: U contains buttons/generic and the fresh require contains buttons/chooseAPhoto. (Each has unique methods, so it is easy to tell which module has been passed to alert.)

<h3>Attachments</h3>

<table>
<thead>
<tr><th>File</th><th>Date</th><th>Size</th></tr><thead>
<tbody>
<tr><td><a href="https://jira-attachments.titaniumsdk.com/TIMOB/TIMOB-9662_28550/NestedConfusionReproduction.zip">NestedConfusionReproduction.zip</td></td><td>2012-06-20T12:43:43.000+0000</td><td>1650</td></tr>
</tbody>
<table>

<h3>Comments</h3>

<ol>
<li>Dawson Toth 2012-06-20

   Added an additional reproduction explanation.</li>
<li>Bill Dawson 2012-06-20

   I've got this pinned down I think. Working on fix.</li>
<li>Bill Dawson 2012-06-20

   Pull request ready
   
   <a href="https://github.com/appcelerator/titanium_mobile/pull/2443" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2443</a></li>
<li>Ivan Skugor 2012-06-21

   </li>
<li>Dawson Toth 2012-06-21

   Tested with the latest CI, and everything's working great again (as far as my testing shows).
   
   @Neeraj: I'm pretty confident I've duplicated [TC-987] with this ticket. The behavior Ivan reported is identical to what I was seeing.</li>
<li>Bill Dawson 2012-06-21

   i think this was mistakenly reopened</li>
<li>Lee Morris 2017-03-16

   Closing ticket as fixed.</li>
</ol>


<p><a href="/TIMOB/TIMOB-9662.json">JSON Source</a></p>