---
title: "[TIMOB-9806] MobileWeb: Parity issue with HTTPClient send data that contains a blob"
---
<table>
<tr><th>GitHub Issue</th><td>n/a</td></tr>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>Low</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Won't Fix</td></tr>
<tr><th>Resolution Date</th><td>2017-06-26T21:54:34.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>n/a</td></tr>
<tr><th>Components</th><td>MobileWeb</td></tr>
<tr><th>Labels</th><td>js, parity</td></tr>
<tr><th>Reporter</th><td>Jeff English</td></tr>
<tr><th>Assignee</th><td>Chris Barber</td></tr>
<tr><th>Created</th><td>2012-06-26T15:42:58.000+0000</td></tr>
<tr><th>Updated</th><td>2018-04-04T23:20:26.000+0000</td></tr>
</table>

<h3>Description</h3>

Attempting to send data where one of the properties is a blob will fail when making an HTTP client request on MobileWeb. An example of this is manifested when trying to upload a photo to ACS. 

This issue was identified when running the updated ti.cloud Anvil tests.

This works on iOS and Android platforms. If you examine the source code on iOS and Android you will notice that there is special handling for blob properties.

The following example demonstrates the issue:
<code><pre>
var sessionID;
var apikey = '&lt;YOUR API KEY HERE&gt;';
var userid = '&lt;YOUR USERID HERE&gt;';
var password = '&lt;YOUR PASSWORD HERE&gt;';
var photoFileName = 'appcelerator.jpg'; // Replace with the name of an image file located in your Resources folder

var login = function() {
    var data = {
        login: userid,
        password: password
    }
	
    var xhr = Ti.Network.createHTTPClient({
        onerror: function(e) {
            Ti.API.error("ERROR");
        },
        onload: function(e) {
            Ti.API.info("LOGGED IN");
            var json = this.responseText;
            var data = JSON.parse(json);
            if (data && data.meta) {
                sessionID = data.meta.session_id;
                createPhoto();
            }
        }
    });
	
    xhr.open("POST", "<a href="https://api.cloud.appcelerator.com/v1/users/login.json?key=" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/users/login.json?key=</a>" + apikey);
    xhr.send(data);
}

var createPhoto = function() {
    var data = {
        photo: Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, photoFileName).read(),
        suppress_response_codes: 'true',
    };
	
    var xhr = Ti.Network.createHTTPClient({
        onerror: function(e) {
            Ti.API.error("ERROR");
        },
        onload: function(e) {
            Ti.API.info("CREATED");
            Ti.API.info(this.responseText);
        }
    });
	
    xhr.open("POST", "<a href="https://api.cloud.appcelerator.com/v1/photos/create.json?key=" rel="nofollow" target="_blank">https://api.cloud.appcelerator.com/v1/photos/create.json?key=</a>" + apikey + "&_session_id=" + sessionID);
    xhr.send(data);
}

login();
</pre></code>

<h3>Comments</h3>

<ol>
<li>Chris Barber 2012-07-17

   The problem stems from Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, photoFileName).read() returning a Blob, which then invokes the Blob's toString() method. toString() on a blob will return a data uri with the binary image file base64 encoded.
   
   To fix it, we need to update the urlEncode function in Ti._.lang to check if the value is a binary Ti.Blob, then base64 decode it and then uri encode it.</li>
<li>Lee Morris 2017-06-26

   Resolving as "Won't Fix" as MobileWeb has been deprecated.</li>
<li>Eric Merriman  2018-04-04

   Closing as will not fix.</li>
</ol>


<p><a href="/TIMOB/TIMOB-9806.json">JSON Source</a></p>