---
title: "[TIMOB-9890] iOS: Adding and deleting tableview rows programmatically does not return correct number of rows"
---
<table>
<tr><th>Type</th><td>Bug</td></tr>
<tr><th>Priority</th><td>High</td></tr>
<tr><th>Status</th><td>Closed</td></tr>
<tr><th>Resolution</th><td>Fixed</td></tr>
<tr><th>Resolution Date</th><td>2012-08-02T09:27:42.000+0000</td></tr>
<tr><th>Affected Version/s</th><td>Release 2.1.0</td></tr>
<tr><th>Fix Version/s</th><td>Sprint 2012-14 API, Release 2.1.1, Release 3.0.0</td></tr>
<tr><th>Components</th><td>iOS</td></tr>
<tr><th>Labels</th><td>SupportTeam, api, module_tableviewrow, qe-testadded</td></tr>
<tr><th>Reporter</th><td>Varun Joshi</td></tr>
<tr><th>Assignee</th><td>Vishal Duggal</td></tr>
<tr><th>Created</th><td>2012-07-05T14:23:43.000+0000</td></tr>
<tr><th>Updated</th><td>2013-12-10T05:54:15.000+0000</td></tr>
</table>

<h3>Description</h3>

<h4>Problem</h4>

The number of rows are not printed correctly on the console after removing rows from the tableview. 

Please run the sample code below to reproduce the issue. We add rows using addRows() method and remove using removeRows() method providing the number of rows to be added or removed as arguments. It looks like the table data is manipulated asynchronously. 

The workaround is to put a time interval wait for the table data changes to take effect. (Uncomment the passedTest() method to implement this workaround). 

*Note that you will see that the UI is updated, but the data[0].rows data structure is only updated after a delay*

<h4>Code Sample</h4>

{noformat}


// this sets the background color of the master UIView (when there are no windows/tab groups on it)
Titanium.UI.setBackgroundColor('#000');


//
// create base UI tab and root window
//
var win1 = Titanium.UI.createWindow({  
    title:'Tab 1',
    backgroundColor:'#fff'
});

var table = Ti.UI.createTableView( {
        backgroundColor:'white',
        top: 0
    });

win1.add(table);

win1.open();

//passedTest();

failedTest();


/**
 * This test passes because we wait for the delete to complete before running the assertion
 */
function passedTest() {
    
    Ti.API.info("Running passed test");
    
    // add 1 row
    addRows(5);
    
    // should have 5 rows
    assertRowCount(5);
    
    // remove 1 row
    removeRows(1);
    
    // wait for the delete to complete - should have 4 rows
    waitForRowCount(4);
    
    Ti.API.info("Finishing passedHi Tim test");
}

/**
 * This test fails because the delete is apparently asynchronous
 */
function failedTest() {
    
    Ti.API.info("Running failed test");
    
    // add 1 row
    addRows(5);
    
    // should have 5 rows
    assertRowCount(5);
    
    // remove 1 row
    removeRows(1);
    
    // should have 4 rows
    assertRowCount(4);
    
    Ti.API.info("Finishing failed test");
}

function waitForRowCount(expectedCount) {
    var timer = setInterval(function () {
        if (table.data[0].rows && table.data[0].rows.length == expectedCount) {
            clearInterval(timer);
            assertRowCount(expectedCount);
        }
    }, 100);    
}

function assertRowCount(expectedCount) {
    var actualCount = 0;
    if (table.data[0].rows) {
        actualCount = table.data[0].rows.length;
    }
    
    if (actualCount == expectedCount) {
        Ti.API.info("Row count is correct - expected: "+expectedCount+" found: "+actualCount);
    } else {
        Ti.API.error("Row count is incorrect - expected: "+expectedCount+" found: "+actualCount);
    }
}

function removeRows(count) {
    
    if (!table.data[0] || table.data[0].rows.rowCount < count) {
        return; 
    }
    var tableData = table.data[0].rows;
    
    for (i=0;i<count;i++) {
        tableData.pop();
    }
    
    table.data = tableData;
}

function addRows(count) {
    var tableData;
    if (table.data[0]) {
        tableData = table.data[0].rows;
    } else {
        tableData = new Array();
    }
    
    for (i=0;i<count;i++) {
    
        var row = Ti.UI.createTableViewRow({
            hasChild: false,
            touchEnabled:false,
            selectionStyle:'none',
            height:Ti.UI.FILL
        });
        
        var rowView = Ti.UI.createView({
            width:Titanium.Platform.displayCaps.platformWidth
        }); 
        
        var rowLabel = Ti.UI.createLabel({
            color:'black',
            text:'row '+i
        });
        rowView.add(rowLabel);
        row.add(rowView);
        
        tableData.push(row);
    }
    table.data = tableData;
}

{noformat}



<h3>Comments</h3>

<ol>
<li>Vishal Duggal 2012-07-09

   Pull pending <a href="https://github.com/appcelerator/titanium_mobile/pull/2522" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2522</a></li>
<li>Vishal Duggal 2012-07-12

   Pull pending <a href="https://github.com/appcelerator/titanium_mobile/pull/2545" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/2545</a> against 2_1_X</li>
<li>Satyam Sekhri 2012-07-16

   Correct number of rows returned on adding and removing rows. Verified on: 
   Titanium Studio: 2.1.1.201207161421
   Titanium SDK: 2.1.1.v2012071618060
   iOS: iPhone Simulator 5.0</li>
<li>Neha Chhabra 2012-08-02

   Reopening issue to update the labels.</li>
<li>Shameer Jan 2013-12-10

   Anvil testcase PR <a href="https://github.com/appcelerator/titanium_mobile/pull/4940" rel="nofollow" target="_blank">https://github.com/appcelerator/titanium_mobile/pull/4940</a>
   </li>
</ol>


<p><a href="/TIMOB/TIMOB-9890.json">JSON Source</a></p>